var isFreshLoad=!0,downloadDashboardProcessStatusInfo="",isDownoadItemStatusDialogBinded=!1,objectSelected=[],validData=[],successtext="Success",isDeleteDownloadDashboardDialogBinded=!1;function getDeleteDownloadDashboardDetails(e,t,a){var o=[];o.push({JobId:a,ItemId:t,Name:e}),$.ajax({type:"POST",url:deleteDownloadDashboardUrl,data:{data:JSON.stringify(o)},success:function(e){$("#delete-download-dashboard-area").html(e),ejs.popups.hideSpinner(document.getElementById("delete-download-dashboard-dialog"))}})}function onStatusClick(){ejs.popups.showSpinner(document.getElementById("download_item_status"));var e=document.getElementById("ProgressStages");$("#DownlodDashboardStatus").html(e),$("#ProgressStages").show(),setTimeout(function(){var e=$("#DownloadItemGrid").data("ejGrid"),t=e.getCurrentViewData()[e.getIndexByRow($("#DownloadItemGrid .e-gridcontent tr.e-row[aria-selected *='true']"))];if($("#progress-stages").empty(),null!=t&&null!=t.Stages&&null!=t.Stages)for(i=0;i<t.Stages.length;i++)t.Stages[i].Status==DownloadandUploadJobStatus.InProgress?$("#progress-stages").append('<li class="col-12 no-padding"><div class="loader-blue loader-icon col-xs-2 no-padding" id="upload-dashboard-progress-loader-icon"><svg class="circular"><circle class="path" cx="8" cy="8" r="6" fill="none" stroke-width="2" stroke-miterlimit="10"></circle></svg></div><span class="progress-info col-xs-10 no-padding">'+t.Stages[i].Label+"</span ></li >"):t.Stages[i].Status==DownloadandUploadJobStatus.Success?$("#progress-stages").append('<li class="col-12 no-padding"><i class="su su-success col-xs-2 no-padding"><span class="su-success path1"></span><span class="su-success path2"></span></i><span class="progress-info col-xs-10 no-padding">'+t.Stages[i].Label+"</span ></li >"):t.Stages[i].Status==DownloadandUploadJobStatus.Failed?$("#progress-stages").append('<li class="col-12 no-padding"><i class="su su-failure col-xs-2 no-padding"><span class="su-failure path1"></span><span class="su-failure path2"></span><span class="su-failure path3"></span><span class="su-failure path4"></span></i><span class="progress-info col-xs-10 no-padding">'+t.Stages[i].Label+'<span id="error-message" style="display: none;">'+t.Stages[i].ErrorMessage+'</span><span id="click-know-more">'+window.Server.App.Localization.KnowMore+"</span ></span ></li > "):t.Stages[i].Status==DownloadandUploadJobStatus.YetToStart&&$("#progress-stages").append('<li class="col-12 no-padding"><i class="su su-schedule-status col-xs-2 no-padding yet-to-start"></i><span class="progress-info col-xs-10 no-padding">'+t.Stages[i].Label+"</span ></li >");e=document.getElementById("download_item_status").ej2_instances;e[0].header='<span class="dialog-header-with-subtitle"><span class ="dialog-header-title">'+window.Server.App.Localization.DownloadDashboard+'</span><span class="item-name">'+t.ItemName+"</span></span>",e[0].show()},50),ejs.popups.hideSpinner(document.getElementById("download_item_status"))}function closeStatusInfo(){downloadDashboardProcessStatusInfo.hide()}function CheckboxFunctions(){var e=$("#DownloadItemGrid .checkbox-row:checked").length,t=$("#DownloadItemGrid").data("ejGrid");new ej.DataManager(t.model.dataSource).executeLocal(t.model.query).result.filter(function(e){return e.Status===window.Server.App.Localization.Success}).length==objectSelected.length?($(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),$("#checkbox-header").prop("checked",!0),$(".download-icon-offline-tab").hide(),$("#DownloadItemGrid tr.e-columnheader th:last-child").hide()):0<e?($(".e-headercelldiv .checkbox-header-label").addClass("indeterminate"),$("#checkbox-header").prop("checked",!1),$(".download-icon-offline-tab").hide(),$("#DownloadItemGrid tr.e-columnheader th:last-child").hide()):($(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),$("#checkbox-header").prop("checked",!1),$(".download-icon-offline-tab").show(),$("#DownloadItemGrid tr.e-columnheader th:last-child").show())}function pushUrl(e){isFreshLoad?(history.replaceState(e,null,window.location.pathname+"?tab="+e),isFreshLoad=!1):history.pushState(e,null,window.location.pathname+"?tab="+e)}function fnOnUserGridActionBegin(e){var t,a=$("#search-downloaded-items").val(),o=(this.model.query._params.push({key:"searchKey",value:a}),[]),a=createLoader("DownloadItemGrid");if(this.element.ejWaitingPopup({template:$("#"+a)}),0<e.model.filterSettings.filteredColumns.length){for(t=0;t<e.model.filterSettings.filteredColumns.length;t++){var d=e.model.filterSettings.filteredColumns[t];o.push({PropertyName:d.field,FilterType:d.operator,FilterKey:d.value})}this.model.query._params.push({key:"filterCollection",value:o})}}function fnCreate(e){$("#checkbox-header").change(headCheckboxOnChange)}function headCheckboxOnChange(e){var t=$("#DownloadItemGrid").data("ejGrid");if(1==$("#checkbox-header").prop("checked")){objectSelected=objectSelected.filter(e=>e.Status===window.Server.App.Localization.Success);var a=new ej.DataManager(t.model.dataSource).executeLocal(t.model.query).result.filter(function(e){return e.Status===window.Server.App.Localization.Success});$(".checkbox-row").each(function(){$(this).prop("disabled")||($(this).prop("checked",!0),0)}),$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(objectSelected.length)),$("#bulk-download").attr("disabled",!1),$(".e-headercelldiv .checkbox-header-label").addClass("indeterminate"),t.multiSelectCtrlRequest=!0,t.selectRows(0,$(".checkbox-row").length+$(".checkbox-row-disabled").length);for(var o=0;o<$(".checkbox-row-disabled").length;o++){var d=$(".checkbox-row-disabled"),d=$($(d[o]).closest("td").parent()).index();t.selectRows(d)}objectSelected=[],objectSelected=$.extend(!0,objectSelected,a),isSafari&&$(".checkbox-header-label").addClass("check")}else $(".checkbox-row").prop("checked",!1),$(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),objectSelected=[],t.clearSelection(),isSafari&&$(".checkbox-header-label").removeClass("check"),$(".dashboard-selected-count").text("Selected ("+objectSelected.length+")"),$("#bulk-download").attr("disabled",!0);CheckboxFunctions()}function setHeaderCheckedStatus(e){null!=e.getRows()&&(e=new ej.DataManager(e.model.dataSource).executeLocal(e.model.query).result.filter(function(e){return e.Status===window.Server.App.Localization.Success}),objectSelected=objectSelected.filter(e=>e.Status===window.Server.App.Localization.Success),e.length===objectSelected.length&&0<objectSelected.length?$("#checkbox-header").prop("checked",!0):$("#checkbox-header").prop("checked",!1))}function fnOnUserGridActionComplete(e){var t=$("#DownloadItemGrid").data("ejGrid"),a=($("#checkbox-header").prop("enabled",!1),$("#checkbox-header").change(headCheckboxOnChange),t.multiSelectCtrlRequest=!0,t.clearSelection(),document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(function(e){new bootstrap.Tooltip(e,{container:"body"})}),showOrHideGridPager("#DownloadItemGrid"),t.model.query.queries),o=a.map(function(e,t){return e.fn});if(a.splice(o.indexOf("onPage"),1),searchdata=new ej.DataManager(t.model.currentViewData).executeLocal(t.model.query),validData=$.grep(searchdata.result,function(e){return e.Status==successtext}),"paging"==e.requestType||"sorting"==e.requestType||"refresh"==e.requestType||"filtering"==e.requestType||"searching"==e.requestType){objectSelected=objectSelected.filter(e=>e.Status===window.Server.App.Localization.Success);for(var d=0;d<t.model.currentViewData.length;d++){var n=t.model.currentViewData[d],s=n.ItemId+"-"+n.JobId;-1!=jQuery.inArray(JSON.stringify(n),$.map(objectSelected,JSON.stringify))&&($("#DownloadItemGrid .checkbox-row#row-check"+s).prop("checked",!0),t.selectRows($($("#DownloadItemGrid .checkbox-row#row-check"+s).closest("td").parent()).index()))}0!=objectSelected.length&&objectSelected.length===searchdata.result.length?$("#checkbox-header").prop("enabled",!0):$("#checkbox-header").prop("enabled",!1),$(".checkbox-row-disabled").length==searchdata.result.length?$("#checkbox-header").prop("disabled",!0):$("#checkbox-header").prop("disabled",!1)}}function fnRecordClick(e){var a,t,o;e.columnName==window.Server.App.Localization.Action&&e.data.Status==window.Server.App.Localization.Success&&(a=e.data,(t=[]).push({JobId:a.JobId,ItemId:a.ItemId,Name:a.ItemName}),ejs.popups.createSpinner({target:document.getElementById("server-app-container")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("server-app-container")),$.ajax({type:"POST",url:downloadItemUrl,data:{data:JSON.stringify(t)},xhrFields:{responseType:"blob"},success:function(e){var t=document.createElement("a"),e=window.URL.createObjectURL(e);t.href=e,t.download=a.ItemName+".bbix",document.body.append(t),t.click(),t.remove(),window.URL.revokeObjectURL(e),ejs.popups.hideSpinner(document.getElementById("server-app-container"))}})),e.columnName!=window.Server.App.Localization.DownloadItemStatus&&(objectSelected=objectSelected.filter(e=>e.Status===window.Server.App.Localization.Success),t=$("#DownloadItemGrid").data("ejGrid"),e.row.find(".checkbox-row").is(":checked")?(t.multiSelectCtrlRequest=!0,-1==jQuery.inArray(JSON.stringify(e.data),$.map(objectSelected,JSON.stringify))?objectSelected.push(e.data):t.selectRows(e.row.index())):(t.multiSelectCtrlRequest=!0,t.selectRows(e.row.index()),-1!=(o=jQuery.inArray(JSON.stringify(e.data),$.map(objectSelected,JSON.stringify)))&&(objectSelected.splice(o,1),validData.splice(o,1),t.selectRows(e.row.index()))),setHeaderCheckedStatus(t))}$(document).ready(function(){var e,t='<span class="dialog-header-with-subtitle"><span class ="dialog-header-title">'+window.Server.App.Localization.DownloadDashboard+'</span><span class="item-name"></span></span>',t=(isDownoadItemStatusDialogBinded?((e=document.getElementById("download_item_status").ej2_instances)[0].header=t,e[0].show()):((a=document.createElement("div")).setAttribute("id","download_item_status"),document.getElementById("base-container").appendChild(a),(e=new ejs.popups.Dialog({showOnInit:!1,visible:!1,allowDraggable:!1,enableResize:!1,width:460<window.innerWidth?"456px":window.innerWidth-10,height:"auto",showHeader:!1,isModal:!0,enableModal:!0,closeOnEscape:!0,header:t,showCloseIcon:!0,content:document.getElementById("DownlodDashboardStatus"),buttons:[{click:function(){e.hide(),$("#DownloadItemGrid").data("ejGrid").clearSelection()},buttonModel:{isPrimary:!0,cssClass:"app-btn-primary",content:window.Server.App.Localization.OKButton}}]})).appendTo(a),isDownoadItemStatusDialogBinded=!0),ejs.popups.createSpinner({target:document.getElementById("download_item_status")}),ejs.popups.setSpinner({type:"Material"}),$("#DownloadItemGrid").data("ejGrid")),a=t.model.pageSettings.totalRecordsCount%t.model.pageSettings.pageSize,a=1<t.model.pageSettings.totalPages?t.model.pageSettings.totalRecordsCount-a:t.model.pageSettings.totalRecordsCount;$(".checkbox-row-disabled").length==a&&$("#checkbox-header").prop("disabled",!0),$(document).on("click",".delete-download-dashboard",function(e){var t,a,o='<span class="dialog-header-with-icon"><span class ="dialog-header-title"><i class="su su-delete dialog-header-icon"></i>&nbsp;&nbsp;'+window.Server.App.Localization.DeleteDownloadDashboard+"</span></span>",d=$(this).attr("data-itemName"),n=$(this).attr("data-itemId"),s=$(this).attr("data-jobId");isDeleteDownloadDashboardDialogBinded?((a=document.getElementById("delete-download-dashboard-dialog").ej2_instances)[0].header=o,a[0].show()):((t=document.createElement("div")).setAttribute("id","delete-download-dashboard-dialog"),document.getElementById("server-app-container").appendChild(t),(a=new ejs.popups.Dialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,width:460<window.innerWidth?"400px":window.innerWidth-10,height:"auto",showHeader:!1,animationSettings:{effect:"Zoom"},isModal:!0,enableModal:!0,closeOnEscape:!0,header:o,showCloseIcon:!0,content:document.getElementById("delete-download-dashboard-area"),buttons:[{buttonModel:{cssClass:"app-btn-danger delete-downloaded-dashboard",content:window.Server.App.Localization.YesButton}},{click:function(){a.hide()},buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.NoButton}}]})).appendTo(t),isDeleteDownloadDashboardDialogBinded=!0),ejs.popups.createSpinner({target:document.getElementById("delete-download-dashboard-dialog")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("delete-download-dashboard-dialog")),getDeleteDownloadDashboardDetails(d,n,s)})}),$(document).on("click",".delete-downloaded-dashboard",function(){var e=$("#hidden-itemName").val(),t=$("#hidden-itemId").val(),a=$("#hidden-jobId").val(),o=[],d=(o.push({JobId:a,ItemId:t,Name:e}),ejs.popups.showSpinner(document.getElementById("delete-download-dashboard-dialog")),document.getElementById("delete-download-dashboard-dialog").ej2_instances);doAjaxPost("POST",deleteDownloadedDashboard,{data:JSON.stringify(o)},function(e){var t;ejs.popups.hideSpinner(document.getElementById("delete-download-dashboard-dialog")),d[0].hide(),e.Status?((t=$("#DownloadItemGrid").data("ejGrid")).dataSource(e.Result),t=new ej.DataManager(t.model.dataSource).executeLocal(t.model.query).result.filter(function(e){return e.Status===window.Server.App.Localization.Success}),objectSelected=t,$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(objectSelected.length)),CheckboxFunctions(),successToast(window.Server.App.Localization.DeletedDownloadedDashboardFileSuccessfully,5e3,e.ETag)):warningToast(window.Server.App.Localization.DeleteDownloadedDashboardFileError,e.StatusMessage,e.ETag,window.Server.App.Localization.DeleteDownloadDashboard)})}),$(document).on("click","#click-know-more",function(){$(this).parent().find("#error-message").is(":visible")?($(this).parent().find("#error-message").hide(),$(this).text(window.Server.App.Localization.KnowMore)):($(this).parent().find("#error-message").show(),$(this).text(window.Server.App.Localization.KnowLess))}),$(document).on("click","#clear-downloadfiles-search",function(){var e=$(this).prevAll("input"),t="#"+(e=""==e||null==e||e.length<=0?$(this).prev("div").find("input"):e).attr("id");e.val(""),$("#clear-downloadfiles-search").css("display","none"),""==e.val()&&(PerformSearch(t),$("#clear-downloadfiles-search").siblings("span.su-search").css("display","block")),$("#checkbox-header").prop("checked",!1),$(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),CheckboxFunctions()}),$(document).on("click",'a[data-bs-toggle="tab"]',function(e){pushUrl($(e.target).attr("href").replace("#",""))}),$(document).on("click",'#DownloadItemGrid input[type="checkbox"]',function(){var e=$("#DownloadItemGrid .checkbox-row:checked").length;objectSelected=objectSelected.filter(e=>e.Status===window.Server.App.Localization.Success),$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(objectSelected.length)),0<e?$("#bulk-download").attr("disabled",!1):0==objectSelected&&$("#bulk-download").attr("disabled",!0)}),$(document).on("click","#DownloadItemGrid .checkbox-row",function(){CheckboxFunctions()}),$(document).on("click","#bulk-download",function(e){for(var t=[],a=$("#DownloadItemGrid").data("ejGrid"),o=objectSelected.filter(e=>e.Status===window.Server.App.Localization.Success),t=[],d=0;d<o.length;d++)null!=o[d]&&t.push({JobId:o[d].JobId,ItemId:o[d].ItemId,Name:o[d].ItemName});ejs.popups.createSpinner({target:document.getElementById("server-app-container")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("server-app-container")),$.ajax({type:"POST",url:bulkDownloadUrl,data:{data:JSON.stringify(t)},xhrFields:{responseType:"blob"},success:function(e){var t=document.createElement("a"),e=window.URL.createObjectURL(e);t.href=e,t.download="dashboard collection.zip",document.body.append(t),t.click(),t.remove(),window.URL.revokeObjectURL(e),$(".checkbox-row").prop("checked",!1),$("#checkbox-header").prop("checked",!1),$(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),$("#bulk-download").attr("disabled",!0),objectSelected=[],$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(0)),a.clearSelection(),ejs.popups.hideSpinner(document.getElementById("server-app-container"))}}),$(".download-icon-offline-tab").show(),$("#DownloadItemGrid tr.e-columnheader th:last-child").show()});