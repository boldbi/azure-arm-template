var isFreshLoad=!0,downloadDashboardProcessStatusInfo="",isDownoadItemStatusDialogBinded=!1,objectSelected=[],validData=[],successtext="Success",isDeleteDownloadDashboardDialogBinded=!1;function getDeleteDownloadDashboardDetails(e,a,t){var o=[];o.push({JobId:t,ItemId:a,Name:e}),$.ajax({type:"POST",url:deleteDownloadDashboardUrl,data:{data:JSON.stringify(o)},success:function(e){$("#delete-download-dashboard-area").html(e),ejs.popups.hideSpinner(document.getElementById("delete-download-dashboard-dialog"))}})}function onStatusClick(){ejs.popups.showSpinner(document.getElementById("download_item_status"));var e=document.getElementById("ProgressStages");$("#DownlodDashboardStatus").html(e),$("#ProgressStages").show(),setTimeout(function(){var e=$("#DownloadItemGrid").data("ejGrid"),a=e.getCurrentViewData()[e.getIndexByRow($("#DownloadItemGrid .e-gridcontent tr.e-row[aria-selected *='true']"))];if($("#progress-stages").empty(),null!=a&&null!=a.Stages&&null!=a.Stages)for(i=0;i<a.Stages.length;i++)a.Stages[i].Status==DownloadandUploadJobStatus.InProgress?$("#progress-stages").append('<li class="col-xs-12 no-padding"><div class="loader-blue loader-icon col-xs-2 no-padding" id="upload-dashboard-progress-loader-icon"><svg class="circular"><circle class="path" cx="8" cy="8" r="6" fill="none" stroke-width="2" stroke-miterlimit="10"></circle></svg></div><span class="progress-info col-xs-10 no-padding">'+a.Stages[i].Label+"</span ></li >"):a.Stages[i].Status==DownloadandUploadJobStatus.Success?$("#progress-stages").append('<li class="col-xs-12 no-padding"><i class="su su-success col-xs-2 no-padding"><span class="su-success path1"></span><span class="su-success path2"></span></i><span class="progress-info col-xs-10 no-padding">'+a.Stages[i].Label+"</span ></li >"):a.Stages[i].Status==DownloadandUploadJobStatus.Failed?$("#progress-stages").append('<li class="col-xs-12 no-padding"><i class="su su-failure col-xs-2 no-padding"><span class="su-failure path1"></span><span class="su-failure path2"></span><span class="su-failure path3"></span><span class="su-failure path4"></span></i><span class="progress-info col-xs-10 no-padding">'+a.Stages[i].Label+'<span id="error-message" style="display: none;">'+a.Stages[i].ErrorMessage+'</span><span id="click-know-more">'+window.Server.App.Localization.KnowMore+"</span ></span ></li > "):a.Stages[i].Status==DownloadandUploadJobStatus.YetToStart&&$("#progress-stages").append('<li class="col-xs-12 no-padding"><i class="su su-schedule-status col-xs-2 no-padding yet-to-start"></i><span class="progress-info col-xs-10 no-padding">'+a.Stages[i].Label+"</span ></li >");e=document.getElementById("download_item_status").ej2_instances;e[0].header='<span class="dialog-header-with-subtitle"><span class ="dialog-header-title">'+window.Server.App.Localization.DownloadDashboard+'</span><span class="item-name">'+a.ItemName+"</span></span>",e[0].show()},50),ejs.popups.hideSpinner(document.getElementById("download_item_status"))}function closeStatusInfo(){downloadDashboardProcessStatusInfo.hide()}function CheckboxFunctions(){var e=$("#DownloadItemGrid .checkbox-row:checked").length;e==$("#DownloadItemGrid .checkbox-row").length-$("#DownloadItemGrid .checkbox-row:disabled").length?($(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),$("#checkbox-header").prop("checked",!0),$(".download-icon-offline-tab").hide(),$("#DownloadItemGrid tr.e-columnheader th:last-child").hide()):0<e?($(".e-headercelldiv .checkbox-header-label").addClass("indeterminate"),$("#checkbox-header").prop("checked",!1),$(".download-icon-offline-tab").hide(),$("#DownloadItemGrid tr.e-columnheader th:last-child").hide()):($(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),$("#checkbox-header").prop("checked",!1),$(".download-icon-offline-tab").show(),$("#DownloadItemGrid tr.e-columnheader th:last-child").show())}function pushUrl(e){isFreshLoad?(history.replaceState(e,null,window.location.pathname+"?tab="+e),isFreshLoad=!1):history.pushState(e,null,window.location.pathname+"?tab="+e)}function fnOnUserGridActionBegin(e){var a,t=$("#search-downloaded-items").val(),o=(this.model.query._params.push({key:"searchKey",value:t}),[]),t=createLoader("DownloadItemGrid");if(this.element.ejWaitingPopup({template:$("#"+t)}),0<e.model.filterSettings.filteredColumns.length){for(a=0;a<e.model.filterSettings.filteredColumns.length;a++){var d=e.model.filterSettings.filteredColumns[a];o.push({PropertyName:d.field,FilterType:d.operator,FilterKey:d.value})}this.model.query._params.push({key:"filterCollection",value:o})}t=$("#DownloadItemGrid").data("ejGrid");objectSelected=[],null!=t.model.currentViewData&&objectSelected.length==t.model.currentViewData.length||($("#checkbox-header").prop("checked",!1),$(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),$("#bulk-download").attr("disabled",!0),"paging"!=e.requestType&&"searching"!=e.requestType)||$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(0))}function fnCreate(e){$("#checkbox-header").change(headCheckboxOnChange)}function headCheckboxOnChange(e){var a=0,t=$("#DownloadItemGrid").data("ejGrid");if(1==$("#checkbox-header").prop("checked")){$(".checkbox-row").each(function(){$(this).prop("disabled")||($(this).prop("checked",!0),a++)}),$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(a)),$("#bulk-download").attr("disabled",!1),$(".e-headercelldiv .checkbox-header-label").addClass("indeterminate"),t.multiSelectCtrlRequest=!0,t.selectRows(0,$(".checkbox-row").length+$(".checkbox-row-disabled").length);for(var o=0;o<$(".checkbox-row-disabled").length;o++){var d=$(".checkbox-row-disabled"),d=$($(d[o]).closest("td").parent()).index();t.selectRows(d)}objectSelected=[],objectSelected=$.extend(!0,objectSelected,searchdata.result),isSafari&&$(".checkbox-header-label").addClass("check")}else $(".checkbox-row").prop("checked",!1),$(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),objectSelected=[],t.clearSelection(),isSafari&&$(".checkbox-header-label").removeClass("check"),$(".dashboard-selected-count").text("Selected ("+a+")"),$("#bulk-download").attr("disabled",!0);CheckboxFunctions()}function setHeaderCheckedStatus(e){null!=e.getRows()&&(validData.length===objectSelected.length&&0<objectSelected.length?$("#checkbox-header").prop("checked",!0):$("#checkbox-header").prop("checked",!1))}function fnOnUserGridActionComplete(e){var a=$("#DownloadItemGrid").data("ejGrid"),t=($("#checkbox-header").prop("enabled",!1),$("#checkbox-header").change(headCheckboxOnChange),a.multiSelectCtrlRequest=!0,a.clearSelection(),$('[data-toggle="tooltip"]').tooltip({container:$("body")}),showOrHideGridPager("#DownloadItemGrid"),a.model.query.queries),o=t.map(function(e,a){return e.fn}),d=(t.splice(o.indexOf("onPage"),1),searchdata=new ej.DataManager(a.model.currentViewData).executeLocal(a.model.query),validData=$.grep(searchdata.result,function(e){return e.Status==successtext}),[]);if($.map(searchdata.result,function(e){-1!=jQuery.inArray(JSON.stringify(e),$.map(objectSelected,JSON.stringify))&&d.push(e)}),objectSelected=[],objectSelected=$.extend(!0,objectSelected,d),"paging"==e.requestType||"sorting"==e.requestType||"refresh"==e.requestType||"filtering"==e.requestType||"searching"==e.requestType){for(var n=0;n<a.model.currentViewData.length;n++){var s=a.model.currentViewData[n],l=s.UserId;-1!=jQuery.inArray(JSON.stringify(s),$.map(objectSelected,JSON.stringify))&&($("#user_grid .checkbox-row#row-check"+l).prop("checked",!0),a.selectRows($($("#user_grid .checkbox-row#row-check"+l).closest("td").parent()).index()))}0!=objectSelected.length&&objectSelected.length===searchdata.result.length?$("#checkbox-header").prop("enabled",!0):$("#checkbox-header").prop("enabled",!1),$(".checkbox-row-disabled").length==searchdata.result.length?$("#checkbox-header").prop("disabled",!0):$("#checkbox-header").prop("disabled",!1)}}function fnRecordClick(e){var t,a,o;e.columnName==window.Server.App.Localization.Action&&e.data.Status==window.Server.App.Localization.Success&&(t=e.data,(a=[]).push({JobId:t.JobId,ItemId:t.ItemId,Name:t.ItemName}),ejs.popups.createSpinner({target:document.getElementById("server-app-container")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("server-app-container")),$.ajax({type:"POST",url:downloadItemUrl,data:{data:JSON.stringify(a)},xhrFields:{responseType:"blob"},success:function(e){var a=document.createElement("a"),e=window.URL.createObjectURL(e);a.href=e,a.download=t.ItemName+".bbix",document.body.append(a),a.click(),a.remove(),window.URL.revokeObjectURL(e),ejs.popups.hideSpinner(document.getElementById("server-app-container"))}})),e.columnName!=window.Server.App.Localization.DownloadItemStatus&&(a=$("#DownloadItemGrid").data("ejGrid"),e.row.find(".checkbox-row").is(":checked")?(a.multiSelectCtrlRequest=!0,-1==jQuery.inArray(JSON.stringify(e.data),$.map(objectSelected,JSON.stringify))?objectSelected.push(e.data):a.selectRows(e.row.index())):(a.multiSelectCtrlRequest=!0,a.selectRows(e.row.index()),-1!=(o=jQuery.inArray(JSON.stringify(e.data),$.map(objectSelected,JSON.stringify)))&&(objectSelected.splice(o,1),a.selectRows(e.row.index()))),setHeaderCheckedStatus(a))}$(document).ready(function(){var e,a='<span class="dialog-header-with-subtitle"><span class ="dialog-header-title">'+window.Server.App.Localization.DownloadDashboard+'</span><span class="item-name"></span></span>',a=(isDownoadItemStatusDialogBinded?((e=document.getElementById("download_item_status").ej2_instances)[0].header=a,e[0].show()):((t=document.createElement("div")).setAttribute("id","download_item_status"),document.getElementById("base-container").appendChild(t),(e=new ejs.popups.Dialog({showOnInit:!1,visible:!1,allowDraggable:!1,enableResize:!1,width:460<window.innerWidth?"456px":window.innerWidth-10,height:"auto",showHeader:!1,isModal:!0,enableModal:!0,closeOnEscape:!0,header:a,showCloseIcon:!0,content:document.getElementById("DownlodDashboardStatus"),buttons:[{click:function(){e.hide(),$("#DownloadItemGrid").data("ejGrid").clearSelection()},buttonModel:{isPrimary:!0,cssClass:"app-btn-primary",content:window.Server.App.Localization.OKButton}}]})).appendTo(t),isDownoadItemStatusDialogBinded=!0),ejs.popups.createSpinner({target:document.getElementById("download_item_status")}),ejs.popups.setSpinner({type:"Material"}),$("#DownloadItemGrid").data("ejGrid")),t=a.model.pageSettings.totalRecordsCount%a.model.pageSettings.pageSize,t=1<a.model.pageSettings.totalPages?a.model.pageSettings.totalRecordsCount-t:a.model.pageSettings.totalRecordsCount;$(".checkbox-row-disabled").length==t&&$("#checkbox-header").prop("disabled",!0),$(document).on("click",".delete-download-dashboard",function(e){var a,t,o='<span class="dialog-header-with-icon"><span class ="dialog-header-title"><i class="su su-delete dialog-header-icon"></i>&nbsp;&nbsp;'+window.Server.App.Localization.DeleteDownloadDashboard+"</span></span>",d=$(this).attr("data-itemName"),n=$(this).attr("data-itemId"),s=$(this).attr("data-jobId");isDeleteDownloadDashboardDialogBinded?((t=document.getElementById("delete-download-dashboard-dialog").ej2_instances)[0].header=o,t[0].show()):((a=document.createElement("div")).setAttribute("id","delete-download-dashboard-dialog"),document.getElementById("server-app-container").appendChild(a),(t=new ejs.popups.Dialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,width:460<window.innerWidth?"400px":window.innerWidth-10,height:"auto",showHeader:!1,animationSettings:{effect:"Zoom"},isModal:!0,enableModal:!0,closeOnEscape:!0,header:o,showCloseIcon:!0,content:document.getElementById("delete-download-dashboard-area"),buttons:[{buttonModel:{cssClass:"app-btn-danger delete-downloaded-dashboard",content:window.Server.App.Localization.YesButton}},{click:function(){t.hide()},buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.NoButton}}]})).appendTo(a),isDeleteDownloadDashboardDialogBinded=!0),ejs.popups.createSpinner({target:document.getElementById("delete-download-dashboard-dialog")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("delete-download-dashboard-dialog")),getDeleteDownloadDashboardDetails(d,n,s)})}),$(document).on("click",".delete-downloaded-dashboard",function(){var e=$("#hidden-itemName").val(),a=$("#hidden-itemId").val(),t=$("#hidden-jobId").val(),o=[],d=(o.push({JobId:t,ItemId:a,Name:e}),ejs.popups.showSpinner(document.getElementById("delete-download-dashboard-dialog")),document.getElementById("delete-download-dashboard-dialog").ej2_instances);doAjaxPost("POST",deleteDownloadedDashboard,{data:JSON.stringify(o)},function(e){ejs.popups.hideSpinner(document.getElementById("delete-download-dashboard-dialog")),d[0].hide(),e.Status?($("#DownloadItemGrid").data("ejGrid").dataSource(e.Result),successToast(window.Server.App.Localization.DeletedDownloadedDashboardFileSuccessfully,5e3,e.ETag)):warningToast(window.Server.App.Localization.DeleteDownloadedDashboardFileError,e.StatusMessage,e.ETag,window.Server.App.Localization.DeleteDownloadDashboard)})}),$(document).on("click","#click-know-more",function(){$(this).parent().find("#error-message").is(":visible")?($(this).parent().find("#error-message").hide(),$(this).text(window.Server.App.Localization.KnowMore)):($(this).parent().find("#error-message").show(),$(this).text(window.Server.App.Localization.KnowLess))}),$(document).on("click","#clear-downloadfiles-search",function(){var e=$(this).prevAll("input"),a="#"+(e=""==e||null==e||e.length<=0?$(this).prev("div").find("input"):e).attr("id");e.val(""),$("#clear-downloadfiles-search").css("display","none"),""==e.val()&&(PerformSearch(a),$("#clear-downloadfiles-search").siblings("span.su-search").css("display","block")),$("#checkbox-header").prop("checked",!1),$(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate")}),$(document).on("click",'a[data-toggle="tab"]',function(e){pushUrl($(e.target).attr("href").replace("#",""))}),$(document).on("click",'#DownloadItemGrid input[type="checkbox"]',function(){var e=$("#DownloadItemGrid .checkbox-row:checked").length;$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(e)),0<e?$("#bulk-download").attr("disabled",!1):$("#bulk-download").attr("disabled",!0)}),$(document).on("click","#DownloadItemGrid .checkbox-row",function(){CheckboxFunctions()}),$(document).on("click","#bulk-download",function(e){for(var a=[],t=$("#DownloadItemGrid").data("ejGrid"),o=t.getSelectedRecords(),a=[],d=0;d<o.length;d++)null!=o[d]&&a.push({JobId:o[d].JobId,ItemId:o[d].ItemId,Name:o[d].ItemName});ejs.popups.createSpinner({target:document.getElementById("server-app-container")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("server-app-container")),$.ajax({type:"POST",url:bulkDownloadUrl,data:{data:JSON.stringify(a)},xhrFields:{responseType:"blob"},success:function(e){var a=document.createElement("a"),e=window.URL.createObjectURL(e);a.href=e,a.download="dashboard collection.zip",document.body.append(a),a.click(),a.remove(),window.URL.revokeObjectURL(e),$(".checkbox-row").prop("checked",!1),$("#checkbox-header").prop("checked",!1),$(".e-headercelldiv .checkbox-header-label").removeClass("indeterminate"),$("#bulk-download").attr("disabled",!0),objectSelected=[],$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(0)),t.clearSelection(),ejs.popups.hideSpinner(document.getElementById("server-app-container"))}}),$(".download-icon-offline-tab").show(),$("#DownloadItemGrid tr.e-columnheader th:last-child").show()});