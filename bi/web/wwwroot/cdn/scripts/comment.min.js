var cursorPos,Paste,createHiddenEditable,isFocusable,initialLine,initialPosition,targetElement,itemId,dataManger,elementNode,getAllCommentAjax,deletedCommentId,dashboardItemId,parentUrl,isActionCompleted=!1,isAdmin=!1,userList=[],date=new Date,commentAction={Add:0,Edit:1,Delete:2,GetComments:3},isEmbedCode=parent.embedConfig.IsEmbedCode,parentItemId=parent.parentItemId,dashboardTypeId=parent.isMultiTab?"#"+parent.$(".e-content .e-active").attr("data-designer-id"):"#dashboard",ejType=isSydjViewer?"BoldBIDashboardDesigner":"ejDashboardViewer",parentRefUrl=window.location!=window.parent.location?document.referrer:document.location.href.replace(document.location.pathname+document.location.search,""),iframeRefUrl=(parentUrl=""==parentRefUrl?"":parentRefUrl.match(/:\/\/(.[^/]+)/)[1],window.location.href),iframeUrl=iframeRefUrl.match(/:\/\/(.[^/]+)/)[1];function GetAllComments(e,t,a,n,o,i){parent.$("#comment-module-container-loader-icon").hide(),parent.isMultiTab&&!isEmbedCode?GetItemWatch(e,o,0):parent.isMultiTab||isEmbedCode?isEmbedCode&&(s={itemId:e,parentItemId:o,userId:userId,isWidgetRequest:"widget"==t.toLowerCase()},getItemWatchAjax=parent.ajaxPostCall("POST",getItemWatchUrl,s,null,getItemWatchResult,null,null)):GetItemWatch(e,"",userId),parentDashboardId=parent.$("#isMultiDashboard").attr("data-parent-id");showWaitingPopup("parent-scroll-element");var s={orderBy:n,skip:0,take:0,itemType:t,itemId:e,dashboardItemId:a,commentAction:commentAction.GetComments,parentDashboardId:parentDashboardId,parentItemId:o,commentId:i};getAllCommentAjax=parent.ajaxPostCall("POST",getAllCommentsUrl,s,null,getCommentsResult,null,completeCommentResult)}function completeCommentResult(e){$(".post-message > p > img").on("load",function(){refreshCommentScroller()}),generateProfileAvatar()}function getCommentsResult(e){if(e){if(1==e.Status){$(".view-heading").css("display","block"),parent.$("#commentModuleContainer").hasClass("displayNone")?parent.$("#widgetCommentModuleContainer").hasClass("displayNone")?$($(".header-section a")[0]).css("display","none"):$($(".header-section a")[0]).css("display","block"):($($(".header-section a")[0]).css("display","block"),parent.$("#widget-loader-icon").hide());var t=ConstructTree(e.Comments,null);$(".comment-list").html(t),$(".comment-list").find(".post").find(".post").find(".children").addClass("no-left-padding"),$("#comment_count").text(e.ActiveCommentsCount),0==e.ActiveCommentsCount&&($("#comment_action_slider").click(),$(".additional-content").html("<h7>"+window.Server.App.Localization.NoComments+"</h7>")),$('[data-bs-toggle="tooltip"]').tooltip(),hideWaitingPopup("parent-scroll-element"),$("body").removeClass("displayNone"),refreshCommentScroller(),document.URL;if(-1<parent.document.URL.indexOf("comment=")){var a="#comment-"+getUrlVars(parent.document.URL.split("#")[0]).comment;if($(a).find("span.time-ago:first").click(),$(a).find(".post-content:first").addClass("highlight-comment"),-1<parent.document.URL.indexOf("isreply=true")&&$(a).find(".reply-comment").first().click(),i_am_ie9){$(a).find(".post-content:first").css("backgroundColor","hsl(46,76%,82%");for(var n=3e3,o=82;o<=100;o+=.1)n+=10,!function(e){setTimeout(function(){$(a).find(".post-content:first").css("backgroundColor","hsl(46,76%,"+e+"%)"),$(a).find(".post-content:first").removeClass("highlight-comment")},n)}(o)}else setTimeout(function(){$(a).find(".post-content:first").css({transition:"background-color 10s ease-in-out","background-color":"inherit"})},40),setTimeout(function(){$(a).find(".post-content:first").attr("style",""),$(a).find(".post-content:first").removeClass("highlight-comment")},7e3)}addTarget_blank()}else hideWaitingPopup("parent-scroll-element");-1==parent.document.URL.indexOf("comment=")&&refreshCommentScroller()}}function refreshCommentScroller(){var e,t,a,n=($("#comment_action_area").hasClass("isHide")?$("#comment_submit_container"):$("#comment_action_area")).outerHeight();"true"==$("#isWidgetComment").val()&&"undefined"!==itemId&&(parent.$("#widget-comment-module-container-loader-icon").hide(),a=$("#list_container").outerHeight()+n+$(".count-sort").outerHeight()+$(".additional-content").outerHeight(),e=(isSydjViewer?parent.$("[data-widget-id='"+itemId+"']"):parent.$("#"+itemId)).offset().top,a<(t=$(window.parent).height()-e)||550<t?parent.$("#widgetCommentModuleContainer").css({top:e<0?0:e}):parent.$("#widgetCommentModuleContainer").css({top:e-(556-t)<0?0:e-(556-t)}),0<550-a?parent.$("#widgetCommentModuleContainer").css({height:a}):(parent.$("#widgetCommentModuleContainer").css({height:550}),$("#scroll-element").children().addClass("e-content")),e=parent.$("#widgetCommentModuleContainer").height()-(n+$(".count-sort").outerHeight()),t=parent.$("#widgetCommentModuleContainer").width()-2,$("#scroll-element").ejScroller({height:e,width:t,scrollerSize:7,buttonSize:0,enableTouchScroll:"false"!=parent.$("#is_mobile").val()}),(a=$("#scroll-element").ejScroller("instance")).model.height=e,a.refresh()),"true"!=$("#isWidgetComment").val()&&(parent.$("#comment-module-container-loader-icon").hide(),$("#scroll-element").children().addClass("e-content"),e=parent.$("#commentModuleContainer").height()-(n+$(".count-sort").outerHeight()+$(".header-section").outerHeight()),parent.isMultiTab&&(e-="true"==parent.$("#is_mobile").val()?0:parent.$(".e-tab-header").height()),t=parent.$("#commentModuleContainer").width()-2,$("#scroll-element").ejScroller({height:e,width:t,scrollerSize:7,buttonSize:0,enableTouchScroll:"false"!=parent.$("#is_mobile").val()}),(a=$("#scroll-element").ejScroller("instance")).model.height=e,a.refresh())}function ConstructTree(e,t){var a="";if(null!=e)for(var n=0;n<e.length;n++){var o=0;if(0<e[n].Replies.length)for(var i=0;i<e[n].Replies.length;i++)e[n].Replies[i].IsActive&&(o+=1);e[n].IsActive?(a=(a+="<li id='comment-"+e[n].Id+"'data-comment-id='"+e[n].Id+"' class='post collapse in'><div class='post-content'><div class='avatar-container'> <div class='user' data-userid='"+e[n].UserId+"'><div class='profile-pic-tag avatar' data-id='"+e[n].IdPReferenceId+"' data-type='user' data-display-name='"+e[n].UserDisplayName+"' data-image-size='32'></div></div></div><div class='post-body'> <header><span class='post-byline col-xs-5 no-padding'><span title='"+e[n].UserDisplayName+"'class='author publisher-anchor-color'>"+e[n].UserDisplayName+"</span></span><menu>")+"<li class='reply' title='"+window.Server.App.Localization.ReplyButton+"' data-bs-toggle='tooltip' data-placement='bottom'> <a class='reply-comment'><span class='su su-reply'></span> </a></li>",!0!==isAdmin&&e[n].UserId!=$("#userName").val()&&null==t||(a+="<span class='dropdown-toggle option-icon' title='"+window.Server.App.Localization.Action+"' data-bs-toggle='dropdown'><span class='su su-options-horizontal'></span></span><ul class='dropdown-menu' role='menu'>",e[n].UserId==$("#userName").val()&&(a+="<li class='edit' title='"+window.Server.App.Localization.EditButton+"' data-bs-toggle='tooltip' data-placement='top'> <a class='edit-comment'><span>"+window.Server.App.Localization.EditButton+"</span> </a></li>"),!0!==isAdmin&&e[n].UserId!=$("#userName").val()||(a+="<li class='delete' title='"+window.Server.App.Localization.Delete+"' data-bs-toggle='tooltip' data-placement='top'> <a class='delete-comment'><span>"+window.Server.App.Localization.Delete+"</span> </a></li>"),null!=t&&(a+="<li class='parent' data-parent-id='"+t.Id+"' title='"+window.Server.App.Localization.Replied.format(t.UserDisplayName)+"' data-bs-toggle='tooltip' data-placement='top'> <a class='parent-name'><span>"+window.Server.App.Localization.ShowParent+"</span> </a></li></ul>")),e[n].TimeZoneName=GetClientTimeZone(e[n].CreatedDate),a=(a+="</menu><span class='post-meta col-xs-9 no-padding'><a "+commentPermalinkHelper(e[n].Id)+" class='permalink'><span class='time-ago' title='"+e[n].CreatedDateString+" - "+e[n].TimeZoneName+"'data-html='false' data-bs-toggle='tooltip' data-placement='right'>"+e[n].TimeAgo+"</span></a></span> </header> <div class='post-body-inner'><div class='edit-post displayNone'></div><div class='post-message'>"+SplitUserDisplayName(e[n].HtmlComment,e[n].MarkdownComment)+"</div><div class='markDownComment hidden'>"+e[n].MarkdownComment+"</div> </div></div><div class='reply-form-container displayNone'></div><div class='col-12 reply-count "+(0<o?"hasChild":"")+"'><div class='col-xs-6 child-count'><span class='count-text'>"+o+"</span><span class='count-label'> "+(1!=o&&0!=o?window.Server.App.Localization.Replies:window.Server.App.Localization.Reply)+"</span></div><div class='col-xs-6 no-padding collapse-icon-container'><span class='su ")+(0<o?"su-vertical-collapse collapse-icon' title='"+window.Server.App.Localization.Collapse+"'></span>":"collapse-icon' data-bs-toggle='collapse'></span>")+"</div></div></div><ul class='children'>"):(a+="<li id='comment-"+e[n].Id+"'data-comment-id='"+e[n].Id+"' class='post'><div class='post-content'><div class='avatar-container'><div class='profile-pic-tag avatar' data-id='"+e[n].IdPReferenceId+"' data-type='user' data-display-name='"+e[n].UserDisplayName+"' data-image-size='32'></div></div><div class='post-body'> <header><span class='post-byline col-xs-5 no-padding'></span><span class='post-meta col-xs-9 hidden no-padding'><a "+commentPermalinkHelper(e[n].Id)+" class='permalink'><span class='time-ago' title='"+e[n].CreatedDateString+" - "+e[n].TimeZoneName+"'data-html='false' data-bs-toggle='tooltip' data-placement='right'>"+e[n].TimeAgo+"</span></a></span><menu class='deleted-post'><li class='reply' > <span class='su su-reply'></span> </li><span class='dropdown-toggle option-icon' ><span class='su su-options-horizontal'></span></span></menu></header> <div class='post-body-inner'><div class='post-message deleted-message'><span class='su su-warning'></span><span>"+window.Server.App.Localization.DeletedMessage+"</span></div> </div></div><div class='col-12 reply-count "+(0<o?"hasChild":"")+"'><div class='col-xs-6 child-count'><span class='count-text'>"+o+"</span><span class='count-label'> "+(1!=o&&0!=o?window.Server.App.Localization.Replies:window.Server.App.Localization.Reply)+"</span></div><div class='col-xs-6 no-padding'>",0<o&&(a+="<span class='su su-vertical-collapse collapse-icon' data-bs-toggle='collapse'</span>"),a+="</div></div></div><ul class='children'>"),0<e[n].Replies.length?a+=ConstructTree(e[n].Replies,e[n])+"</ul> </li>":a+="</ul> </li>"}return a}function customMarkdownParser(e){var t=/(?:\@\ (.*?)\ )/g,a=$("#itemType").attr("data-item-type").toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()}),n=new EasyMDE({element:$("#temp")[0],spellChecker:!1,autoDownloadFontAwesome:!1});if(null!=(o=(r=e).match(/(?:\@\ (\[.*?\])\ )/g)))for(var o=jQuery.unique(o),i=0;i<o.length;i++)var s=SplitUserDisplayName(o[i],o[i]),r=r.replace(o[i],"<span class='cm-usercontainer'>"+s+"</span>");if(null!=r.match(t))for(var l=jQuery.unique(r.match(t)),i=0;i<l.length;i++){var d=new RegExp(l[i],"g");r=r.replace(d,"<span class='cm-groupcontainer'>"+l[i]+"</span>")}if(null!=(c=r.match(/(@all)/g)))for(var c=jQuery.unique(c),i=0;i<c.length;i++){d=new RegExp(c[i],"g");r=r.replace(c[i],"<span class='cm-allcontainer'>"+c[i]+"</span>")}r=n.options.previewRender(r);for(var e=$("<div></div>").html(r),m=$(e).find("a"),p=0;p<m.length;p++)m[p].setAttribute("target","_blank");for(var u=$(e).find("img"),p=0;p<u.length;p++)if(u[p].setAttribute("target","_blank"),-1!==u[p].src.indexOf("image-"))for(var h=u[p].src.split("/"),i=0;i<h.length;i++)-1!==h[i].indexOf("image-")&&(u[p].src=rootUrl+"/content/images/commentimages/"+a+"/"+itemId+"/"+h[i]);return r=$(e).html()}function renderMde(e){e=new EasyMDE({element:$(e)[0],status:!1,spellChecker:!1,autoDownloadFontAwesome:!1,toolbar:[{name:"bold",action:EasyMDE.toggleBold,className:"su su-bold",title:"Bold"},{name:"italic",action:EasyMDE.toggleItalic,className:"su su-italic",title:window.Server.App.Localization.Italic},{name:"heading",action:EasyMDE.toggleHeadingSmaller,className:"su su-header",title:window.Server.App.Localization.Heading},"|",{name:"quote",action:EasyMDE.toggleBlockquote,className:"su su-quote",title:window.Server.App.Localization.Quote},{name:"unordered-list",action:EasyMDE.toggleUnorderedList,className:"su su-list-ul",title:window.Server.App.Localization.Generic},{name:"ordered-list",action:EasyMDE.toggleOrderedList,className:"su su-list-ol",title:window.Server.App.Localization.Number},"|",{name:"link",action:EasyMDE.drawLink,className:"su su-link",title:window.Server.App.Localization.Link},{name:"image",action:EasyMDE.drawImage,className:"su su-image",title:window.Server.App.Localization.Image},{name:"uploadImage",className:"su su-upload-image",title:window.Server.App.Localization.UploadImage},{name:"preview",action:EasyMDE.togglePreview,className:"su su-preview no-disable",title:window.Server.App.Localization.Preview}],previewRender:function(e){return customMarkdownParser(e)}});return"comment-image-file"==$(".su-upload-image").attr("id")?$(".su-upload-image").attr("id","comment-image-edit-file"):$(".su-upload-image").attr("id","comment-image-file"),e}function getUrlVars(e){var n={};e.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,a){n[t]=a});return n}function addTarget_blank(){$("ul#commentList li .post-message").find("a").attr("target","_blank")}function truncateUrl(){var e=parent.window.location.href.split("#")[0],t=e.indexOf("?comment="),a=e.indexOf("&comment="),n=e.substr(0,e.indexOf("/dashboards")+1),o=e.substr(0,e.indexOf("/widgets")+1);return 0<n.length?e=e.replace(n,"/"):0<o.length&&(e=e.replace(o,"/")),0<t?e=e.slice(0,e.lastIndexOf("?comment=")):0<a&&(e=e.slice(0,e.lastIndexOf("&comment="))),e}function getRelativePath(e){var t=$("#itemType").attr("data-item-type").toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()}),a=e.match(/(?:\!\[\]\((.*?)\))/g),n=[];if(null!=a){for(var o=0;o<a.length;o++)n[o]=a[o].split(/[\(\\!\[\ \]\\)\s]+/),n[o]=$.grep(n[o],function(e){return e});for(var i,s=0;s<n.length;s++)n[s]=n[s].toString(),-1!==n[s].indexOf("image-")&&(i=rootUrl+"/content/images/commentimages/"+t+"/"+itemId+"/"+n[s])&&(n[s]="![]("+n[s]+")",e=e.replace(n[s],"![]("+i+")"))}return e}function pasteImageReader(e){var t=$("#itemType").attr("data-item-type").toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()}),e={DataUrl:e,itemId:itemId,itemType:t,parentDashboardId:parentDashboardId};parent.ajaxPostCall("POST",commentImageUrl,e,null,pasteCommentImages,null,null)}function pasteCommentImages(e){""!==e&&-1!==e.indexOf("image-")&&cursorPos.codemirror.replaceSelection(" ![]("+e+")"),hideWaitingPopup("parent-scroll-element")}function autoCompletes(e,t){n=e;var a,n=window.event?n.keyCode:n.which||void 0;38===n?((a=jQuery.Event("keydown")).keyCode=38,a.which=38,$("#autocomplete-input").trigger(a)):40===n?((a=jQuery.Event("keydown")).keyCode=40,a.which=40,$("#autocomplete-input").trigger(a)):13===n?(e.preventDefault(),$("ul.e-ul li.e-hover").attr("id")):(autoCompleteRefresh(t),$("#autocomplete-input").val(t),$("#autocomplete-input").ejAutocomplete("enable"),$("#autocomplete-input").ejAutocomplete("search"),$("#autocomplete-input").ejAutocomplete("hide"))}function getCaretCharacterOffsetWithin(e){var t,a,n=0,o=e.ownerDocument||e.document,i=o.defaultView||o.parentWindow;return void 0!==i.getSelection?0<(t=i.getSelection()).rangeCount&&((a=(i=i.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(e),a.setEnd(i.endContainer,i.endOffset),n=a.toString().length):(t=o.selection)&&"Control"!=t.type&&(i=t.createRange(),(a=o.body.createTextRange()).moveToElementText(e),a.setEndPoint("EndToEnd",i),n=a.text.length),n}function onSelect(e){$("#scroll-element").ejScroller("enable");var t,a=$("ul.e-ul li.e-hover").attr("id"),n=(""!=a&&null!=a&&""!=(n=a.split("-"))&&null!=n&&(t=n[0],a.split(/-(.+)?/)[1]),initialPosition.line),a=initialPosition.ch,o=initialLine.length;targetElement.focus(),cursorPos.codemirror.setSelection({line:n,ch:0},{line:n,ch:o}),cursorPos.codemirror.replaceSelection(initialLine),cursorPos.codemirror.setSelection({line:n,ch:a},{line:n,ch:a}),userList.push(e.item.Name+"|~"+e.item.IdPReferenceId),"User"==t?cursorPos.codemirror.replaceSelection("@ ["+e.item.Name+"] "):cursorPos.codemirror.replaceSelection("@ "+e.value+" "),$("#autocomplete-input").ejAutocomplete("disable"),$("#autocomplete-input_suggestion").attr("style","display:none !important;")}function onOpen(){var e,t,a=$("#autocomplete-input").data("ejAutocomplete").scrollerObj,a=(a.model.height=135,a.model.buttonSize=0,a.model.scrollerSize=9,a.refresh(),$("#autocomplete-input_suggestion").attr("style","display:block !important; z-index: 9;"),document.getElementById("autocomplete"));$(a).length&&(e=(a=$(a)[0].getBoundingClientRect()).left,a=a.top+30,t=$("#autocomplete-input_suggestion").width(),$("#autocomplete-input_suggestion").height(),$(parent.$("#commentModuleContainer")[0]).height(),e+t<$(parent.$("#commentModuleContainer")[0]).width()?$("#autocomplete-input_suggestion").css("left",e):$("#autocomplete-input_suggestion").css("left",e-t+16),$("#autocomplete-input_suggestion").css("top",a),$("#autocomplete-input_suggestion").addClass("usermention-suggestionlist"))}function autoCompleteRefresh(e){var t=e;clearTimeout(window.timer),window.timer=setTimeout(function(){autosuggestion(t)},400)}function autosuggestion(e){$.xhrPool.abortAll();var t=(0<parent.$("#widget_Comment").length?parent.$("#widget_Comment"):parent.$("#dashboard_Comment")).attr("data-item-id");$("#autocomplete-input_suggestion").css("display","none"),""!=e.trim()&&(e={searchWord:e,itemId:parent.isMultiTab?parentItemId:t,parentId:parent.$("#isMultiDashboard").attr("data-parent-id")},parent.ajaxPostCall("GET",userMentionDataSourceUrl,e,null,userMentionDataList,null,null))}function userMentionDataList(e){$("#autocomplete-input_suggestion").css("display","none");var t=$("#autocomplete-input").data("ejAutocomplete");t.model.dataSource=JSON.parse(e),t._OnTextEnter(),onOpen()}function splitUserMention(e){var e=$(e).children().find(".CodeMirror-code"),t=!1,a=[],n=[],o=[],s=[],r=/(?:\@\ (.*?)\ )/,l=($(e)[0].getElementsByClassName("cm-usercontainer"),$(e)[0].getElementsByClassName("cm-groupcontainer")),e=$(e)[0].getElementsByClassName("cm-allcontainer"),d=userList;if(userList=[],l.length)for(i=0;i<l.length;i++)n[i]=r.exec(l[i].textContent),n[i]&&a.push(n[i][1]);return e.length?t=!0:($.each(d,function(e,t){-1===$.inArray(t,o)&&o.push(t)}),$.each(a,function(e,t){-1===$.inArray(t,s)&&s.push(t)})),{uniqueUsersValue:o,uniqueGroupValue:s,mentionedAll:t}}function userMentionInitializing(e,t){var o,i,s,r,a,n,l,d,c=e.target,m=e.keyCode||e.which;cursorPos.value();64===m&&(targetElement=c,0==$("#autocomplete-trigger").length)&&(m='<span id="autocomplete"><span id="autocomplete-trigger">@</span><span id="autocomplete-search-text" contenteditable></span></span>',cursorPos.codemirrorIgnore,a=cursorPos.codemirror.getCursor(),o=(initialPosition=a).line,i=a.ch,s=cursorPos.codemirror.getLine(o),r=(initialLine=s).length,a="",(d=cursorPos.codemirror.findWordAt({line:o,ch:i}).anchor.ch)==(n=cursorPos.codemirror.findWordAt({line:o,ch:i}).head.ch)-1&&r==i||0==d&&0==n||" "==s[i-1]&&null==s[i]?((l=$(t).children().find(".CodeMirror-code").children())&&($(l[o].firstChild).append(m),a=$("#autocomplete-search-text"),$(a[0]).focus()),e.preventDefault(),$("#scroll-element").ejScroller("disable")):i!=d&&(" "!=s[i-1]||" "!=s[i+1]&&" "!=s[i])||(cursorPos.codemirror.setSelection({line:o,ch:i},{line:o,ch:r}),n=cursorPos.codemirror.getSelection(),cursorPos.codemirror.replaceSelection(""),(l=$(t).children().find(".CodeMirror-code").children())&&(d=l[o].firstChild,$(d).append(m),d.append(n),a=$("#autocomplete-search-text"),$(a[0]).focus()),e.preventDefault(),$("#scroll-element").ejScroller("disable")),$("#autocomplete-search-text").on("keydown",function(e){var e=e.keyCode||e.which,t=$("#autocomplete-search-text").text(),a=getCaretCharacterOffsetWithin(document.getElementById("autocomplete-search-text"));8===e&&0==a&&($("#autocomplete-input_suggestion").css("display","none"),removingUserMentionContainer(c,t,o,i,r,s))}),$("#autocomplete-search-text").on("blur",function(e){$("#scroll-element").ejScroller("enable")}),$("#autocomplete-search-text").on("keyup",function(e){var t,a=e.keyCode||e.which,n=($("#scroll-element").ejScroller("enable"),$("#autocomplete-search-text").text());getCaretCharacterOffsetWithin(document.getElementById("autocomplete-search-text"));27===a||33===a||9===a||36===a?removingUserMentionContainer(c,n,o,i,r,s):13===a?(e.preventDefault(),a=$("ul.e-ul li.e-hover").attr("id"),""!=(t=$("ul.e-ul li.e-hover").text())&&"No suggestions"!=t?onSelect({id:a,value:t}):removingUserMentionContainer(c,n,o,i,r,s)):autoCompletes(e,n)}),$(".CodeMirror").on("click",function(){var e="";$("#autocomplete-search-text").length&&$("#autocomplete").length&&(e=(e="@"+$("#autocomplete-search-text").text()).trim(),c.focus(),cursorPos.codemirror.setSelection({line:initialPosition.line,ch:0},{line:initialPosition.line,ch:initialLine.length}),cursorPos.codemirror.replaceSelection(initialLine),cursorPos.codemirror.setSelection({line:initialPosition.line,ch:initialPosition.ch},{line:initialPosition.line,ch:initialPosition.ch}),cursorPos.codemirror.replaceSelection(e),$("#autocomplete-input").ejAutocomplete("disable"),$("#autocomplete-input_suggestion").attr("style","display:none !important;"))}))}function displaySuggestionList(){$("#autocomplete-input_suggestion").css("display","none")}function removingUserMentionContainer(e,t,a,n,o,i){$("#scroll-element").ejScroller("enable");var s="";$("#autocomplete-search-text").length&&$("#autocomplete").length&&(s=(s="@"+t).trim(),$("#autocomplete-input").ejAutocomplete("disable"),$("#autocomplete-input_suggestion").attr("style","display:none !important;"),e.focus(),cursorPos.codemirror.setSelection({line:a,ch:0},{line:a,ch:o}),cursorPos.codemirror.replaceSelection(i),cursorPos.codemirror.setSelection({line:a,ch:n},{line:a,ch:n}),cursorPos.codemirror.replaceSelection(s),$("#autocomplete-input").ejAutocomplete("disable"),$("#autocomplete-input_suggestion").attr("style","display:none !important;"))}function ajaxSetup(){$.xhrPool=[],$.xhrPool.abortAll=function(){$(this).each(function(e,t){t.abort()}),$.xhrPool.length=0},$.ajaxSetup({beforeSend:function(e){$.xhrPool.push(e)},complete:function(e){e=$.xhrPool.indexOf(e);-1<e&&$.xhrPool.splice(e,1)}})}function commentPermalinkHelper(e){return"href='#comment-"+e+"'"}function SplitUserDisplayName(n,e){var o=/\[|\]\\|\|\~.*?]/g,e=e.match(/(?:\@\ (.*?)\ )/g);return null!=e&&$.each(e,function(e,t){var a=t.replace(o,"");n=n.replace(t,a)}),n}function GetClientTimeZone(e){return String(String(new Date(e)).split("(")[1]).split(")")[0]}function resetItemIdForMultiTab(e){var t;parent.isMultiTab&&(t=parent.$(".e-content.e-lib.e-touch").find(".e-active").index(),dashboardItemId=parent.multiTabDashboardDetails[t].Id,"dashboard"==e.toLowerCase())&&(itemId=dashboardItemId)}function GetItemWatch(e,t,a){var n=$("#itemType").attr("data-item-type").toLowerCase();void 0===n||"dashboard"!=n.toLowerCase()&&"widget"!=n.toLowerCase()||$.ajax({url:getItemWatchUrl.web,data:{itemId:e,parentId:t,userId:a,isWidgetRequest:"widget"==n.toLowerCase()},type:"POST",success:function(e){e.Status&&(e.isWatched?($("#watchItem").val("Unwatch").removeClass("watch").addClass("unwatch").attr("data-original-title",window.Server.App.Localization.Unwatch),$("#watch-text").removeClass("watch").addClass("unwatch")):($("#watchItem").val("Watch").removeClass("unwatch").addClass("watch").attr("data-original-title",window.Server.App.Localization.Watch),$("#watch-text").removeClass("unwatch").addClass("watch")),isAdmin=e.isAdmin)}})}function getItemWatchResult(e){e&&1==e.Status&&(e.IsWatched?($("#watchItem").val("Unwatch").removeClass("watch").addClass("unwatch").attr("data-original-title",window.Server.App.Localization.Unwatch),$("#watch-text").removeClass("watch").addClass("unwatch")):($("#watchItem").val("Watch").removeClass("unwatch").addClass("watch").attr("data-original-title",window.Server.App.Localization.Watch),$("#watch-text").removeClass("unwatch").addClass("watch")),isAdmin=e.IsAdmin)}$(document).ready(function(){dataManager=null,ajaxSetup();var e=ej.Query().from("userMentionList").select("Name","Type"),u=($("#autocomplete-input").ejAutocomplete({allowSorting:!1,dataSource:dataManger,width:"200px",popupHeight:"135px",filterType:"contains",query:e,fields:{text:"Name",key:"Type"},select:"onSelect",create:"displaySuggestionList",actionSuccess:"displaySuggestionList",open:"displaySuggestionList"}),void 0!==$("#itemType").attr("data-item-type")?$("#itemType").attr("data-item-type").toLowerCase():"dashboard"),h=(dashboardItemId=parent.isMultiTab?(e=parent.$(".e-content.e-lib.e-touch").find(".e-active").index(),parent.multiTabDashboardDetails[e].Id):parent.$("#dashboard_Comment").attr("data-item-id"),parent.$("#dashboard_Comment").attr("data-category-name")),g=parent.$("#dashboard_Comment").attr("data-item-name"),f=(parentDashboardId=parent.$("#isMultiDashboard").attr("data-parent-id"),parent.$("#widget_Comment").attr("data-item-id")),w=parent.$("#widget_Comment").attr("data-item-name"),e=getUrlVars(parent.window.location.href.split("#")[0]).comment,v=(void 0!==itemId&&"undefined"!==itemId&&"true"==$("#isWidgetComment").val()&&GetAllComments(itemId,u,dashboardItemId,"1",parentItemId,e),(itemId=parent.isMultiTab&&void 0!==u&&"dashboard"==u.toLowerCase()?dashboardItemId:itemId)!=dashboardItemId&&(itemId=dashboardItemId),renderMde("#rte-post"));function s(e){var t;null!=e&&e.Status?(e.Comments[0].TimeZoneName=GetClientTimeZone(e.Comments[0].CreatedDate),t="<li id='comment-"+e.Comments[0].Id+"'data-comment-id='"+e.Comments[0].Id+"' class='post'><div class='post-content'><div class='avatar-container'> <div class='user' data-userid='"+e.Comments[0].UserId+"'><div class='profile-pic-tag avatar' data-id='"+e.Comments[0].IdPReferenceId+"' data-type='user' data-display-name='"+e.Comments[0].UserDisplayName+"' data-image-size='32'></div> </div></div><div class='post-body'> <header><span class='post-byline col-xs-5 no-padding'><span title='"+e.Comments[0].UserDisplayName+"'class='author publisher-anchor-color'>"+e.Comments[0].UserDisplayName+"</span><span class='su su-status-active'></span></span><menu><li class='reply' title='"+window.Server.App.Localization.ReplyButton+"' data-bs-toggle='tooltip' data-placement='bottom'> <a class='reply-comment'><span class='su su-reply'></span> </a></li><span class='dropdown-toggle option-icon' title='"+window.Server.App.Localization.Action+"' data-bs-toggle='dropdown'><span class='su su-options-horizontal'></span></span><ul class='dropdown-menu' role='menu'><li class='edit' title='"+window.Server.App.Localization.EditButton+"'  data-bs-toggle='tooltip' data-placement='top'> <a class='edit-comment'><span>"+window.Server.App.Localization.EditButton+"</span> </a></li><li class='delete' title='"+window.Server.App.Localization.Delete+"'  data-bs-toggle='tooltip' data-placement='top'> <a class='delete-comment'><span>"+window.Server.App.Localization.Delete+"</span> </a></li></menu><span class='post-meta col-xs-9 no-padding'><a "+commentPermalinkHelper(e.Comments[0].Id)+" class='permalink'><span class='time-ago' title='"+e.Comments[0].CreatedDateString+" - "+e.Comments[0].TimeZoneName+"' data-html='false' data-bs-toggle='tooltip' data-placement='right'>"+e.Comments[0].TimeAgo+"</span></a></span> </header> <div class='post-body-inner'><div class='edit-post displayNone'></div><div class='post-message'>"+SplitUserDisplayName(e.Comments[0].HtmlComment,e.Comments[0].MarkdownComment)+"</div><div class='markDownComment hidden'>"+e.Comments[0].MarkdownComment+"</div></div> <div class='footer'></div></div><div class='reply-form-container displayNone'></div><div class='col-12 reply-count'><div class='col-xs-6 child-count'><span class='count-text'>0</span><span class='count-label'> "+window.Server.App.Localization.Reply+"</span></div><div class='col-xs-6 no-padding collapse-icon-container'><span class='su collapse-icon' data-bs-toggle='collapse' data-target=''></span></div></div></div><ul class='children'></ul> </li>",$(".sort-old").hasClass("sort-active")?$(".comment-list").append(t):$(".comment-list").prepend(t),$(".additional-content").html(""),t=parseInt($("#comment_count").text()),$("#comment_count").text(t+1),$('[data-bs-toggle="tooltip"]').tooltip(),v.value(""),$("#comment_action_area").show(),$(".watch-action").hasClass("watch")&&($("#watchItem").val("Unwatch"),$("#watchItem").removeClass("watch").addClass("unwatch"),$("#watch-text").removeClass("watch").addClass("unwatch"),$("#watchItem").attr("data-original-title",window.Server.App.Localization.Unwatch)),hideWaitingPopup("parent-scroll-element"),$("#comment_action_area").removeClass("isHide"),$("#comment_action_area").show(),$("#comment_submit_container").hide(),refreshCommentScroller(),addTarget_blank(),$("#comment-"+e.Comments[0].Id).find("span.time-ago:first").click(),0==t&&("dashboard"==u?(isSydjViewer?(parent.isMultiTab?parent.$(".e-content.e-lib.e-touch").find(".e-active").find("#dashboard-comment"):parent.$("#dashboard-comment")).removeClass("su-without-comment").addClass("su-with-comment"):(parent.$(dashboardTypeId).data(ejType).toggleDashboardComment(),parent.$("ul.options li#comments span.su-without-comment").addClass("su-with-comment").removeClass("su-without-comment")),"true"==parent.$("#is_mobile").val()&&parent.$("#comment-li .server-comment").removeClass("su su-without-comment").addClass("su su-with-comment")):(null!=parent.$(dashboardTypeId).data(ejType)&&(isSydjViewer?parent.$("[data-widget-id='"+itemId+"']").find(".su-without-comment").first().removeClass("su-without-comment").addClass("su-with-comment"):parent.$(dashboardTypeId).data(ejType).dynamicwithCommentIconChange(itemId)),null!=parent.$("#widget").data(ejType)&&(wid=parent.$(".e-dbrd-control-container").attr("id"),isSydjViewer?parent.$("[data-widget-id='"+wid+"']").find(".su-without-comment").first().removeClass("su-without-comment").addClass("su-with-comment"):parent.$("#widget").data(ejType).dynamicwithCommentIconChange(wid),parent.$(".server-comment").removeClass("su-without-comment").addClass("su-with-comment")))),$(".post-message > p > img").on("load",function(){refreshCommentScroller()})):(hideWaitingPopup("parent-scroll-element"),parent.frames[1].messageBox("su-open",window.Server.App.Localization.AddComment,window.Server.App.Localization.AddCommentFail,"success",function(){parent.frames[1].onCloseMessageBox()})),generateProfileAvatar()}function C(e){null!=e&&e.Status?($("#save-edit").parentsUntil(".post").find(".post-message").html(SplitUserDisplayName(e.Comments[0].HtmlComment,e.Comments[0].MarkdownComment)),$("#save-edit").parentsUntil(".post").find(".markDownComment").html(e.Comments[0].MarkdownComment),$("#save-edit").parentsUntil(".post").find(".post-message").removeClass("displayNone"),$(".watch-action").hasClass("watch")&&($("#watchItem").val("Unwatch"),$("#watchItem").removeClass("watch").addClass("unwatch"),$("#watch-text").removeClass("watch").addClass("unwatch"),$("#watchItem").attr("data-original-title",window.Server.App.Localization.Unwatch)),hideWaitingPopup($("#save-edit").parentsUntil(".post").find(".edit-post")),$(".edit-post").addClass("displayNone"),$(".edit-post").html(""),refreshCommentScroller(),addTarget_blank()):(parent.frames[1].messageBox("su-open",window.Server.App.Localization.EditComment,window.Server.App.Localization.EditCommentFail,"success",function(){parent.frames[1].onCloseMessageBox()}),hideWaitingPopup($("#save-edit").parentsUntil(".post").find(".edit-post")))}function l(e){(null!=e&&e.Status?(e.Comments[0].TimeZoneName=GetClientTimeZone(e.Comments[0].CreatedDate),addComment="<li id='comment-"+e.Comments[0].Id+"'data-comment-id='"+e.Comments[0].Id+"' class='post collapse in'><div class='post-content'><div class='avatar-container'> <div class='user' data-userid='"+e.Comments[0].UserId+"'><div class='profile-pic-tag avatar' data-id='"+e.Comments[0].IdPReferenceId+"' data-type='user' data-display-name='"+e.Comments[0].UserDisplayName+"' data-image-size='32'></div></div></div><div class='post-body'> <header><span class='post-byline col-xs-5 no-padding'><span title='"+e.Comments[0].UserDisplayName+"'class='author publisher-anchor-color'>"+e.Comments[0].UserDisplayName+"</span><span class='su su-status-active'></span></span><menu>",addComment+="<li class='reply' title='"+window.Server.App.Localization.ReplyButton+"'data-bs-toggle='tooltip' data-placement='bottom'> <a class='reply-comment'><span class='su su-reply'></span> </a></li><span class='dropdown-toggle option-icon' title='"+window.Server.App.Localization.Action+"' data-bs-toggle='dropdown'><span class='su su-options-horizontal'></span></span><ul class='dropdown-menu' role='menu'><li class='edit' title='"+window.Server.App.Localization.EditButton+"'  data-bs-toggle='tooltip' data-placement='top'> <a class='edit-comment'><span>"+window.Server.App.Localization.EditButton+"</span> </a></li><li class='delete' title='"+window.Server.App.Localization.Delete+"'  data-bs-toggle='tooltip' data-placement='top'> <a class='delete-comment'><span>"+window.Server.App.Localization.Delete+"</span> </a></li><li class='parent' data-parent-id='"+e.Comments[0].ParentId+"' title = '"+window.Server.App.Localization.Replied.format($("#replyComment").parents(".post").find(".author").attr("title"))+"'> <a class='parent-name'><span>"+window.Server.App.Localization.ShowParent+"</span> </a></li></ul></menu><span class='post-meta col-xs-9 no-padding'><a "+commentPermalinkHelper(e.Comments[0].Id)+" class='permalink'><span class='time-ago' title='"+e.Comments[0].CreatedDateString+" - "+e.Comments[0].TimeZoneName+"'data-html='false' data-bs-toggle='tooltip' data-placement='right'>"+e.Comments[0].TimeAgo+"</span></a></span> </header> <div class='post-body-inner'><div class='edit-post displayNone'></div><div class='post-message'>"+SplitUserDisplayName(e.Comments[0].HtmlComment,e.Comments[0].MarkdownComment)+"</div><div class='markDownComment hidden'>"+e.Comments[0].MarkdownComment+"</div> </div> <div class='footer'></div></div><div class='reply-form-container displayNone'></div><div class='col-12 reply-count'><div class='col-xs-6 child-count'><span class='count-text'>0</span><span class='count-label'> "+window.Server.App.Localization.Reply+"</span></div><div class='col-xs-6 no-padding collapse-icon-container'><span class='su collapse-icon' data-bs-toggle='collapse' data-target=''></span></div></div></div><ul class='children'></ul> </li>",$("#post-reply").closest(".post-content").siblings().prepend(addComment),$(".reply-form-container").html(""),$("#replyComment").addClass("displayNone"),$(".comment-list").find(".post").find(".post").find(".children").addClass("no-left-padding"),$("#comment_count").text(parseInt($("#comment_count").text())+1),$('[data-bs-toggle="tooltip"]').tooltip(),$("#replyComment").parent().find(".count-text").text(parseInt($("#replyComment").parent().find(".count-text").text())+1),1==parseInt($("#replyComment").parent().find(".count-text").text())?$("#replyComment").parent().find(".count-label").text(" "+window.Server.App.Localization.Reply):$("#replyComment").parent().find(".count-label").text(" "+window.Server.App.Localization.Replies),$("#replyComment").parent().find(".collapse-icon").addClass("su-vertical-collapse"),$("#replyComment").parent().find(".reply-count").addClass("hasChild"),$(".watch-action").hasClass("watch")&&($("#watchItem").val("Unwatch"),$("#watchItem").removeClass("watch").addClass("unwatch"),$("#watch-text").removeClass("watch").addClass("unwatch"),$("#watchItem").attr("data-original-title",window.Server.App.Localization.Unwatch)),hideWaitingPopup("replyComment"),$("#replyComment").removeClass("e-waitingpopup e-js"),$(".reply-form-container").attr("id",""),refreshCommentScroller(),addTarget_blank(),generateProfileAvatar):($("#replyComment").addClass("displayNone"),hideWaitingPopup("replyComment"),$(".reply-form-container").attr("id",""),parent.frames[1].messageBox("su-open",window.Server.App.Localization.ReplyButton,window.Server.App.Localization.ReplyFail,"success",function(){parent.frames[1].onCloseMessageBox()}),refreshCommentScroller))()}function i(e){var t,a;parent.onCloseMessageBox(),$("#messageBox_wrapper-loader-icon").hide(),$("#messageBox_wrapper").ejWaitingPopup("hide"),null!=e&&e?(e=deletedCommentId,parent.successToast(window.Server.App.Localization.DeleteCommentSuccess,7e3),""==$("#"+e).find(".children").html()||1==$("#"+e).find(".user").length?$("#"+e).html(""):($("#"+e).find(".avatar-container:first").html("<img src='"+avatarUrl+"' class='avatar'>"),$("#"+e).find(".post-body:first").html("<header><span class='post-byline col-xs-5 no-padding'></span><span class='post-meta col-xs-9 no-padding'></span><menu class='deleted-post'><li class='reply' > <span class='su su-reply'></span> </li><span class='dropdown-toggle option-icon' ><span class='su su-options-horizontal'></span></span></menu> </header> <div class='post-body-inner'><div class='post-message deleted-message'><span class='su su-warning'></span><span>"+window.Server.App.Localization.DeletedMessage+"</span></div> </div>")),0==$("#"+e).parents(".post:first").find(".post-content").find(".user").length&&$("#"+e).parents(".post:first").html(""),t=parseInt($("#comment_count").text()),$("#comment_count").text(t-1),1==(a=parseInt($("#"+e).parents(".post:first").find(".count-text:first").html()))&&($("#"+e).parents(".post:first").find(".collapse-icon:first").removeClass("su-vertical-collapse"),$("#"+e).parents(".post:first").find(".reply-count:first").removeClass("hasChild")),2==a&&$("#"+e).parents(".post:first").find(".count-label:first").html(" reply"),$("#"+e).parents(".post:first").find(".count-text:first").html(a-1),refreshCommentScroller(),1==t&&("dashboard"==u?((isSydjViewer?parent.isMultiTab?parent.$(".e-content.e-lib.e-touch").find(".e-active").find("#dashboard-comment"):parent.$("#dashboard-comment"):(parent.$(dashboardTypeId).data(ejType).toggleDashboardComment(),parent.$("ul.options li#comments span.su-with-comment"))).removeClass("su-with-comment").addClass("su-without-comment"),$(".additional-content").html("<h7>"+window.Server.App.Localization.NoComments+"</h7>"),"true"==parent.$("#is_mobile").val()&&parent.$("#comment-li .server-comment").removeClass("su su-with-comment").addClass("su su-without-comment")):(null!=parent.$(dashboardTypeId).data(ejType)&&(isSydjViewer?parent.$("[data-widget-id='"+itemId+"']").find(".su-with-comment").first().removeClass("su-with-comment").addClass("su-without-comment"):parent.$(dashboardTypeId).data(ejType).dynamicwithoutCommentIconChange(itemId),$(".additional-content").html("<h7>"+window.Server.App.Localization.NoComments+"</h7>")),null!=parent.$("#widget").data(ejType)&&(wid=parent.$(".e-dbrd-control-container").attr("id"),isSydjViewer?parent.$("[data-widget-id='"+wid+"']").find(".su-with-comment").first().removeClass("su-with-comment").addClass("su-without-comment"):parent.$("#widget").data(ejType).dynamicwithoutCommentIconChange(wid),$(".additional-content").html("<h7>"+window.Server.App.Localization.NoComments+"</h7>"),parent.$(".server-comment").removeClass("su-with-comment").addClass("su-without-comment"))))):parent.warningToast(window.Server.App.Localization.DeleteCommentFail)}function a(e){e?($("#watchItem").val("Unwatch"),$("#watchItem").removeClass("watch").addClass("unwatch"),$("#watch-text").removeClass("watch").addClass("unwatch"),$("#watchItem").attr("data-original-title",window.Server.App.Localization.Unwatch)):parent.frames[1].messageBox("su-eye",window.Server.App.Localization.AddWatch,window.Server.App.Localization.WatchFail,"success",function(){parent.frames[1].onCloseMessageBox()}),$(".watch-action").removeClass("disable-post")}function n(e){e?($("#watchItem").val("Watch"),$("#watchItem").removeClass("unwatch").addClass("watch"),$("#watch-text").removeClass("unwatch").addClass("watch"),$("#watchItem").attr("data-original-title",window.Server.App.Localization.Watch)):parent.frames[1].messageBox("su-eye",window.Server.App.Localization.Unwatch,window.Server.App.Localization.UnWatchFail,"success",function(){parent.frames[1].onCloseMessageBox()}),$(".watch-action").removeClass("disable-post")}cursorPos=v,$("#comment_action_slider").click(function(){cursorPos=v.value(""),v.isPreviewActive()&&v.togglePreview(),$(".reply-form-container").html(""),$(".reply-form-container").addClass("displayNone"),$(".reply-form-container").attr("id",""),$(".edit-post").addClass("displayNone"),$(".post-message").removeClass("displayNone"),$(".edit-post").html(""),$("#comment_action_area").hide(),$("#comment_submit_container").show(),$("#comment_action_area").addClass("isHide"),$(".error-message").html(""),refreshCommentScroller(),setTimeout(function(){cursorPos.codemirror.focus(),cursorPos.codemirror.setCursor({line:0,ch:0})},500)}),$("#comment_submit_container > .CodeMirror").on("keypress","textarea",function(e){4e3<=v.value().length?e.preventDefault():userMentionInitializing(e,elementNode=$("#comment_submit_container > .CodeMirror"))}),$(document).on("click",".header-comment-close",function(){v.value(""),$("#comment_action_area").removeClass("isHide"),$("#comment_action_area").show(),$("#comment_submit_container").hide(),refreshCommentScroller()}),$(".sort-new").click(function(){GetAllComments(itemId,u,dashboardItemId,"1",parentItemId),$(".sort-new").addClass("sort-active"),$(".sort-new").removeClass("sort-inactive"),$(".sort-old").addClass("sort-inactive"),$(".sort-old").removeClass("sort-active")}),$(".sort-old").click(function(){GetAllComments(itemId,u,dashboardItemId,"0",parentItemId),$(".sort-new").addClass("sort-inactive"),$(".sort-new").removeClass("sort-active"),$(".sort-old").addClass("sort-active"),$(".sort-old").removeClass("sort-inactive")}),$(document).on("focus","textarea",function(){$("textarea").pastableTextarea()}),$(document).on("click","#post-comment",function(){var e="";e=parent.isMultiTab?(t=parent.$(".e-content.e-lib.e-touch").find(".e-active").index(),parent.multiTabDashboardDetails[t].Id):parent.$("#dashboard_Comment").attr("data-item-id"),resetItemIdForMultiTab(u);var t=splitUserMention($("#comment_submit_container > .CodeMirror")),a=truncateUrl(),n=a.split("?"),o="",n=(o=(o=1<n.length?n[1]:o).includes("embed_signature")||o.includes("isembed")?"":o,a.split("/")),o=(parent.isMultiTab||("dashboard"==u.toLowerCase()?a=""!=o?"/"+n[1]+"/"+dashboardItemId+"/"+h+"/"+g+"?"+o:"/"+n[1]+"/"+dashboardItemId+"/"+h+"/"+g:"widget"==u.toLowerCase()&&(a="true"==$("#isWidgetComment").val()?""!=o?"/"+n[1]+"/"+dashboardItemId+"/"+h+"/"+g+"?"+o:"/"+n[1]+"/"+dashboardItemId+"/"+h+"/"+g:"/"+n[1]+"/"+f+"/"+w)),v.value()),n=v.options.previewRender(o).replace("#",""),i=(o=getRelativePath(o)).replace("http://","").replace("https://","").replace("(","").replace(")","").replace("![]","");isEmptyOrWhitespace(n.replace(/<[^>]*>!/gi,""))||isEmptyOrWhitespace(i)?$(".error-message").html("<span class='validate-fail'>"+window.Server.App.Localization.CommentValidator+"</span>"):4e3<o.length?$(".error-message").html("<span class='validate-fail'>"+window.Server.App.Localization.CommentLengthValidator+"</span>"):($(".comment-area").val(""),$(".error-message").html(""),showWaitingPopup("parent-scroll-element"),n={itemId:"widget"!=u&&itemId!=e?e:itemId,comment:o,itemType:u,dashboardItemId:dashboardItemId,url:decodeURI(a),UniqueUsersValue:t.uniqueUsersValue,UniqueGroupValue:t.uniqueGroupValue,MentionedAll:t.mentionedAll,currentDate:date,CommentAction:commentAction.Add,parentItemId:parentItemId},parent.ajaxPostCall("POST",addCommentUrl,n,null,s,null,null))}),$(document).on("click",".edit-comment",function(){var s="",e=(s=parent.isMultiTab?(e=parent.$(".e-content.e-lib.e-touch").find(".e-active").index(),parent.multiTabDashboardDetails[e].Id):parent.$("#dashboard_Comment").attr("data-item-id"),v.value(""),$(this).parents("menu").siblings(".post-meta").find("a.permalink")),t=$(e).attr("href").split("comment-")[1],a=(void 0===t&&(t=$(e).attr("href").split("comment=")[1]),$(e).attr("href","#comment-"+t),$(e).attr("target",""),$(this).parents(".post").attr("data-comment-id")),r=($("#comment_action_area").removeClass("isHide"),$("#comment_action_area").show(),$("#comment_submit_container").hide(),$(".reply-form-container").html(""),$(".reply-form-container").addClass("displayNone"),$(".reply-form-container").attr("id",""),$(".edit-post").addClass("displayNone"),$(".post-message").removeClass("displayNone"),$(".edit-post").html(""),$(this).closest("div").find(".edit-post").html("<div class='edit'><textarea id='edit_comment_"+a+"' class='form-control edit-text' placeholder='' style='overflow: hidden;'></textarea><span class='message'>*"+window.Server.App.Localization.CommentWords+"</span><span class='error-message-edit'></span><div class='temp-post'><button class='edit-cancel secondary-button app-btn-secondary pull-right'>"+window.Server.App.Localization.CancelButton+"</button><button id ='save-edit' class='primary-button app-btn-primary pull-right' type='submit'>"+window.Server.App.Localization.SaveButton+"</button></div></div>"),renderMde("#edit_comment_"+a)),n=(cursorPos=r,$(this).closest("div").find(".post-message").addClass("displayNone"),$(this).closest("div").find(".edit-post").removeClass("displayNone"),refreshCommentScroller(),$(e).find("span.time-ago").click(),$(this).closest("div").find(".markDownComment").text()),o=n.match(/(?:\!\[\]\((.*?)\))/g),i=[];if(null!=o){for(var l=0;l<o.length;l++)i[l]=o[l].split(/[\(\\!\[\ \]\\)\s]+/),i[l]=$.grep(i[l],function(e){return e});for(var d=0;d<i.length;d++)if(i[d]=i[d].toString(),-1!==i[d].indexOf("image-"))for(var c=i[d].split("/"),m=0;m<c.length;m++)-1!==c[m].indexOf("image-")&&(n=n.replace(i[d],c[m]))}r.value(n),setTimeout(function(){cursorPos.codemirror.focus()},200),cursorPos.codemirror.setCursor({line:n.length,ch:n.length}),"false"==parent.$("#is_mobile").val()&&$("#save-edit").prop("disabled","true");var p=$(this).closest("div").find(".markDownComment").text();$(".CodeMirror").on("keypress keyup","textarea",function(e){var t=r.value();4e3<=t.length?e.preventDefault():userMentionInitializing(e,elementNode=$("#edit_comment_"+a).parent()),p!=t.trim()?$("#save-edit").removeAttr("disabled"):$("#save-edit").prop("disabled","true")}),$(".editor-toolbar").on("click",function(e){$("textarea").keypress()}),$("#save-edit").on("click",function(){resetItemIdForMultiTab(u);var e=truncateUrl(),t=e.split("?"),a="",t=(a=(a=1<t.length?t[1]:a).includes("embed_signature")||a.includes("isembed")?"":a,e.split("/"));parent.isMultiTab||("dashboard"==u.toLowerCase()?e=""!=a?"/"+t[1]+"/"+dashboardItemId+"/"+h+"/"+g+"?"+a:"/"+t[1]+"/"+dashboardItemId+"/"+h+"/"+g:"widget"==u.toLowerCase()&&(e="true"==$("#isWidgetComment").val()?""!=a?"/"+t[1]+"/"+dashboardItemId+"/"+h+"/"+g+"?"+a:"/"+t[1]+"/"+dashboardItemId+"/"+h+"/"+g:"/"+t[1]+"/"+f+"/"+w));var a=getRelativePath(r.value()),t=$(this).closest(".post").attr("data-comment-id"),n=splitUserMention($("#edit_comment_"+t).parent()),o=r.options.previewRender(a).replace("#",""),i=a.replace("http://","").replace("https://","").replace("(","").replace(")","").replace("![]","");isEmptyOrWhitespace(o.replace(/<[^>]*>!/gi,""))||isEmptyOrWhitespace(i)?($(".edit-text").addClass("inactive-box"),$(".error-message-edit").html("<span class='validate-fail'>"+window.Server.App.Localization.CommentValidator+"</span>")):4e3<a.length?($(".reply-text").addClass("inactive-box"),$(".error-message-edit").html("<span class='validate-fail'>"+window.Server.App.Localization.CommnetLengthValidator+"</span>")):(showWaitingPopup($("#save-edit").parentsUntil(".post").find(".edit-post")),o={itemId:"widget"!=u&&itemId!=s?s:itemId,comment:a,commentId:t,itemType:u,dashboardItemId:dashboardItemId,url:decodeURI(e),uniqueUsersValue:n.uniqueUsersValue,uniqueGroupValue:n.uniqueGroupValue,mentionedAll:n.mentionedAll,commentAction:commentAction.Edit,currentDate:date,parentItemId:parentItemId},parent.ajaxPostCall("POST",editCommentUrl,o,null,C,null,null))}),$(".edit-cancel").on("click",function(){$(".post-message").removeClass("displayNone"),$(".edit-post").addClass("displayNone"),$(".edit-post").html(""),$(".error-message-edit").html(""),refreshCommentScroller()})}),$(document).on("click",".reply-comment",function(){var s="",e=(s=parent.isMultiTab?(e=parent.$(".e-content.e-lib.e-touch").find(".e-active").index(),parent.multiTabDashboardDetails[e].Id):parent.$("#dashboard_Comment").attr("data-item-id"),v.value(""),$(this).parents("menu").siblings(".post-meta").find("a.permalink")),t=$(e).attr("href").split("comment-")[1],t=(void 0===t&&(t=$(e).attr("href").split("comment=")[1]),$(e).attr("href","#comment-"+t),$(e).attr("target",""),$(this).parents(".post").attr("data-comment-id")),r=($("#comment_action_area").removeClass("isHide"),$("#comment_action_area").show(),$("#comment_submit_container").hide(),$(".post-message").removeClass("displayNone"),$(".edit-post").addClass("displayNone"),$(".edit-post").html(""),$(".reply-form-container").html(""),$(".reply-form-container").addClass("displayNone"),$(".reply-form-container").attr("id",""),$(this).closest("div").parent().parent().find(".reply-form-container").html("<textarea id='replyto_comment_"+t+"' class='form-control reply-text' maxlength='4000' style='overflow: hidden;'></textarea><span class='message'>*"+window.Server.App.Localization.CommentWords+"</span><div class='reply-comment-footer'><span class='error-message-reply'></span><button class='reply-cancel secondary-button app-btn-secondary float-end'>"+window.Server.App.Localization.CancelButton+"</button><input id='post-reply' class='primary-button app-btn-primary float-end' value='"+window.Server.App.Localization.ReplyButton+"' type='submit'></div>"),renderMde("#replyto_comment_"+t));cursorPos=r,$(this).closest("div").parent().parent().find(".reply-form-container").attr("id","replyComment"),$("#replyComment").removeClass("displayNone"),refreshCommentScroller(),$(e).find("span.time-ago").click(),setTimeout(function(){cursorPos.codemirror.focus()},200),cursorPos.codemirror.setCursor({line:0,ch:0}),$("#replyComment > .CodeMirror").on("keypress","textarea",function(e){4e3<=r.value().length?e.preventDefault():userMentionInitializing(e,elementNode=$("#replyComment > .CodeMirror"))}),$("#post-reply").on("click",function(){resetItemIdForMultiTab(u);var e=truncateUrl(),t=e.split("?"),a="",t=(a=(a=1<t.length?t[1]:a).includes("embed_signature")||a.includes("isembed")?"":a,e.split("/")),a=(parent.isMultiTab||("dashboard"===u.toLowerCase()?e=""!==a?"/"+t[1]+"/"+dashboardItemId+"/"+h+"/"+g+"?"+a:"/"+t[1]+"/"+dashboardItemId+"/"+h+"/"+g:"widget"===u.toLowerCase()&&(e="true"===$("#isWidgetComment").val()?""!==a?"/"+t[1]+"/"+dashboardItemId+"/"+h+"/"+g+"?"+a:"/"+t[1]+"/"+dashboardItemId+"/"+h+"/"+g:"/"+t[1]+"/"+f+"/"+w)),r.value()),t=splitUserMention($("#replyComment > .CodeMirror")),a=getRelativePath(a),n=$(this).closest(".post").attr("data-comment-id"),o=r.options.previewRender(a).replace("#",""),i=a.replace("http://","").replace("https://","").replace("(","").replace(")","").replace("![]","");isEmptyOrWhitespace(o.replace(/<[^>]*>!/gi,""))||isEmptyOrWhitespace(i)?($(".reply-text").addClass("inactive-box"),$(".error-message-reply").html("<span class='validate-fail'>"+window.Server.App.Localization.ReplyValidator+"</span>")):4e3<a.length?($(".reply-text").addClass("inactive-box"),$(".error-message-reply").html("<span class='validate-fail'>"+window.Server.App.Localization.ReplyContentLength+"</span>")):(showWaitingPopup("replyComment"),o={itemId:"widget"!=u&&itemId!=s?s:itemId,comment:a,parentId:n,itemType:u,dashboardItemId:dashboardItemId,url:decodeURI(e),uniqueUsersValue:t.uniqueUsersValue,uniqueGroupValue:t.uniqueGroupValue,mentionedAll:t.mentionedAll,currentDate:date,CommentAction:commentAction.Add,parentItemId:parentItemId},parent.ajaxPostCall("POST",addCommentUrl,o,null,l,null,null))}),$(".reply-cancel").on("click",function(){$("#replyComment").addClass("displayNone"),$(".reply-form-container").html(""),$(".reply-form-container").attr("id",""),$(".error-message-reply").html(""),refreshCommentScroller()})}),$(document).on("click",".delete-comment",function(){var t="",a=(t=parent.isMultiTab?(e=parent.$(".e-content.e-lib.e-touch").find(".e-active").index(),parent.multiTabDashboardDetails[e].Id):parent.$("#dashboard_Comment").attr("data-item-id"),resetItemIdForMultiTab(u),isActionCompleted=!1,truncateUrl()),e=a.split("?"),n="",e=(n=(n=1<e.length?e[1]:n).includes("embed_signature")||n.includes("isembed")?"":n,a.split("/")),o=(parent.isMultiTab||("dashboard"===u.toLowerCase()?a=""!==n?"/"+e[1]+"/"+dashboardItemId+"/"+h+"/"+g+"?"+n:"/"+e[1]+"/"+dashboardItemId+"/"+h+"/"+g:"widget"===u.toLowerCase()&&(a="true"===$("#isWidgetComment").val()?""!==n?"/"+e[1]+"/"+dashboardItemId+"/"+h+"/"+g+"?"+n:"/"+e[1]+"/"+dashboardItemId+"/"+h+"/"+g:"/"+e[1]+"/"+f+"/"+w)),$(this).closest(".post").attr("data-comment-id")),n=$(this).closest(".post").attr("id");deletedCommentId=n,parent.messageBox("su-delete",window.Server.App.Localization.DeleteComment,window.Server.App.Localization.DeleteCommentConfirm,"error",function(){var e;isActionCompleted||(isActionCompleted=!0,e=parent.createLoader("messageBox_wrapper"),$("#messageBox_wrapper").ejWaitingPopup({template:parent.$("#"+e)}),$("#messageBox_wrapper").ejWaitingPopup("show"),e={itemId:"widget"!=u&&itemId!=t?t:itemId,commentId:o,itemType:u,dashboardItemId:dashboardItemId,url:decodeURI(a),commentAction:commentAction.Delete,currentDate:date,parentItemId:parentItemId},parent.ajaxPostCall("POST",deleteCommentUrl,e,null,i,null,null))})}),$(document).on("click",".watch-action",function(){var e,t;parent.isMultiTab&&(e=parent.$(".e-content.e-lib.e-touch").find(".e-active").index(),itemId=parent.multiTabDashboardDetails[e].Id),$(this).hasClass("disable-post")||($(".watch-action").addClass("disable-post"),$(this).hasClass("watch")?(t={itemId:itemId,isWatch:!0,currentDate:date,parentItemId:parentItemId},parent.ajaxPostCall("POST",watchUrl,t,null,a,null,null)):(t={itemId:itemId,isWatch:!1,currentDate:date,parentItemId:parentItemId},parent.ajaxPostCall("POST",unWatchUrl,t,null,n,null,null)))}),$(document).on("click",".parent",function(){var t="#comment-"+$(this).attr("data-parent-id"),e=$(t).find(".permalink:first").attr("href").split("comment-")[1];if(void 0===e&&(e=$(t).find(".permalink:first").attr("href").split("comment=")[1]),$(t).find(".permalink:first").attr("href","#comment-"+e),$(t).find(".permalink:first").attr("target",""),$(t).isOnScreen()||$(t).find(".time-ago:first").click(),$(t).find(".post-content:first").addClass("highlight-comment"),i_am_ie9){$(t).find(".post-content:first").addClass("highlight-comment");for(var a=3e3,n=82;n<=100;n+=.1)a+=10,!function(e){setTimeout(function(){$(t).find(".post-content:first").css("backgroundColor","hsl(46,76%,"+e+"%)"),$(t).find(".post-content:first").removeClass("highlight-comment")},a)}(n)}else setTimeout(function(){$(t).find(".post-content:first").css({transition:"background-color 5s ease-in-out","background-color":"inherit"})},20),setTimeout(function(){$(t).find(".post-content:first").attr("style",""),$(t).find(".post-content:first").removeClass("highlight-comment")},4e3)}),$(document).on("mousedown",".permalink",function(e){var t;"undefined"==typeof(postId=$(this).attr("href").split("comment-")[1])&&(postId=$(this).attr("href").split("comment=")[1]),2!=e.which&&3!=e.which||(t=parent.document.URL,-1!=parent.window.location.href.indexOf("?comment")||-1==parent.window.location.href.indexOf("?")?(t=t.split("?comment=")[0],$(this).attr("href",t+"?comment="+postId)):(t=t.split("&comment=")[0],$(this).attr("href",t+"&comment="+postId)),$(this).attr("target","_blank")),1==e.which&&($(this).attr("href","#comment-"+postId),$(this).attr("target",""))}),$(document).on("click",".hasChild",function(){$(this).find(".collapse-icon").hasClass("su-vertical-expand")?($(this).find(".collapse-icon").parents(".post-content").siblings("ul.children").slideDown("slow",function(){refreshCommentScroller()}),$(this).find(".collapse-icon").addClass("su-vertical-collapse"),$(this).find(".collapse-icon").removeClass("su-vertical-expand"),$(this).find(".collapse-icon").parents(".reply-count").removeClass("expanded"),$(this).find(".collapse-icon").attr("title",window.Server.App.Localization.Collapse)):($(this).find(".collapse-icon").parents(".post-content").siblings("ul.children").slideUp("slow",function(){refreshCommentScroller()}),$(this).find(".collapse-icon").addClass("su-vertical-expand"),$(this).find(".collapse-icon").removeClass("su-vertical-collapse"),$(this).find(".collapse-icon").parents(".reply-count").addClass("expanded"),$(this).find(".collapse-icon").attr("title",window.Server.App.Localization.Expand))}),$(document).on("mouseover","#comment-image-file,#comment-image-edit-file",function(){var t,e=$.now(),a=$("#itemType").attr("data-item-type").toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()});$("#comment-image-file,#comment-image-edit-file").ejUploadbox({saveUrl:fileUploadUrl+"?imageType=commentimage&&timeStamp="+e+"&&itemId="+itemId+"&&itemType="+a,autoUpload:!0,showFileDetails:!1,multipleFilesSelection:!1,buttonText:{browse:""},width:"29px",height:"29px",showBrowseButton:!1,extensionsAllow:".PNG,.png,.jpg,.JPG,.jpeg,.JPEG",begin:function(){showWaitingPopup("parent-scroll-element")},fileSelect:function(e){$(".confirmatioMessage").hide(),t=e.files[0].extension.toLowerCase(),e.files[0].name},error:function(e){hideWaitingPopup("parent-scroll-element"),".png"!=t&&".jpg"!=t&&".jpeg"!=t?$(".error-message").html("<span class='validate-fail'>"+window.Server.App.Localization.FileFormatNotsupport+"</span>"):$(".error-message").html("<span class='validate-fail'>"+window.Server.App.Localization.InternalServerError+"</span>")},complete:function(e){""!=e.responseText&&-1!==e.responseText.indexOf("image-")&&(e=" ![]("+e.responseText.split(";")[1]+")",$("textarea").focus(),cursorPos.codemirror.replaceSelection(e),hideWaitingPopup("parent-scroll-element"),$("textarea").keypress())}}),$("#comment-image-file_SelectButton,#comment-image-file,#comment-image-edit-file,.e-uploadinput").attr("title",window.Server.App.Localization.UploadImage)}),parent.$("#commentImage_popup").BoldBIDashboardDialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,showHeader:!1,enableModal:!0,close:"commentImageDialogClose",closeOnEscape:!0}),$(document).on("click",".post-message > p > img",function(){var e,t,a,n=$(".base-comment-container").hasClass("widget-comment")?$(window).height()+300:$(window).height(),o=(null==parent.$(dashboardTypeId).width()?parent.$("#widget"):parent.$(dashboardTypeId)).width(),i=$(this).attr("src"),s=new Image;s.src=i,$(s).on("load",function(){e=s.width,t=s.height,a=t<n?40<n-t?t:t=n-.07*n:t=null!=parent.$("#widget").height()?t-(t-n+40):t-(t-n+20),parent.$("#commentImage_popup_wrapper").css({height:a}),parent.$("#commentImage_popup_image,#commentImage_popup,#PopupContainer,#commentImage_popup_wrapper .e-dialog-scroller").css({height:t}),a=e<=o&&e<=900?40<o-e?e:e=o-.07*o:e=.68*o,parent.$("#commentImage_popup_wrapper").css({width:a}),parent.$("#commentImage_popup_image,#commentImage_popup,#PopupContainer,#commentImage_popup_wrapper .e-dialog-scroller").css({width:e}),parent.$("#commentImage_popup_image").attr("src",i),parent.$("#commentImage_popup").removeClass("hidden"),parent.$("#commentImage_popup").BoldBIDashboardDialog("open")})}),$(window).resize(function(){refreshCommentScroller()})}),$.fn.isOnScreen=function(){windowHeight=$("#list_container").outerHeight();var e=(textAreaHeight=($("#comment_action_area").hasClass("isHide")?$("#comment_submit_container"):$("#comment_action_area")).outerHeight())+$(".count-sort").outerHeight();return(offsetTop=this.offset().top)>=e&&offsetTop<=windowHeight},$.fn.pastableTextarea=function(){for(var e,t=0,a=this.length;t<a;t++)(e=this[t])._pastable||$(e).is(":not(textarea, input:text)")||(Paste.mountTextarea(e),e._pastable=!0);return this},createHiddenEditable=function(){return $(document.createElement("div")).attr("contenteditable",!0).attr("aria-hidden",!0).attr("tabindex",-1).css({width:1,height:1,position:"fixed",left:-100,overflow:"hidden"})},isFocusable=function(e,t){var a,n=void 0,o=void 0,i=void 0,s=e.nodeName.toLowerCase();return"area"===s?(a=(n=e.parentNode).name,!(!e.href||!a||"map"!==n.nodeName.toLowerCase())&&0<(o=$("img[usemap='#"+a+"']")).length&&o.is(":visible")):(/^(input|select|textarea|button|object)$/.test(s)?(i=!e.disabled)&&(n=$(e).closest("fieldset")[0])&&(i=!n.disabled):i="a"===s&&e.href||t,(i=i||$(e).is("[contenteditable]"))&&$(e).is(":visible"))},Paste=function(){function i(e,t){var u;this._container=e,this._target=t,this._container=$(this._container),this._target=$(this._target).addClass("pastable"),this._container.on("paste",(u=this,function(e){var t,a,n,o,i,s,r,l,d,c,m,p;if(showWaitingPopup("parent-scroll-element"),u._paste_event_fired=!0,null!=(null!=(d=e.originalEvent)?d.clipboardData:void 0))if((t=e.originalEvent.clipboardData).items)for(o=0,s=(c=t.items).length;o<s;o++){if((n=c[o]).type.match(/^image\//)){(l=new FileReader).onload=function(e){return u._handleImage(e.target.result)},l.readAsDataURL(n.getAsFile()),e.preventDefault();break}"text/plain"===n.type&&n.getAsString(function(e){setTimeout(function(){return hideWaitingPopup("parent-scroll-element"),u._target.trigger("pasteText",{text:e})},1)})}else-1!==Array.prototype.indexOf.call(t.types,"text/plain")&&(p=t.getData("Text"),setTimeout(function(){return hideWaitingPopup("parent-scroll-element"),u._target.trigger("pasteText",{text:p})},1)),u._checkImagesInContainer(function(e){return u._handleImage(e)});if(t=window.clipboardData)if(null!=(p=t.getData("Text"))&&p.length)setTimeout(function(){return hideWaitingPopup("parent-scroll-element"),u._target.trigger("pasteText",{text:p}),u._target.trigger("_pasteCheckContainerDone")},1);else{for(i=0,r=(m=t.files).length;i<r;i++)a=m[i],u._handleImage(URL.createObjectURL(a));u._checkImagesInContainer(function(e){})}return setTimeout(function(){hideWaitingPopup("parent-scroll-element")},1e3),null}))}return i.prototype._target=null,i.prototype._container=null,i.mountNonInputable=function(e){var t=new i(createHiddenEditable().appendTo(e),e);return $(e).on("click",function(e){if(!isFocusable(e.target,!1))return t._container.focus()}),t._container.on("focus",function(){return $(e).addClass("pastable-focus")}),t._container.on("blur",function(){return $(e).removeClass("pastable-focus")})},i.mountTextarea=function(a){var n,o;return DataTransfer.prototype.__lookupGetter__("items")?this.mountContenteditable(a):(o=new i(createHiddenEditable().insertBefore(a),a),n=!1,$(a).on("keyup",function(e){return 17!==(e=e.keyCode)&&224!==e||(n=!1),null}),$(a).on("keydown",function(e){var t;return 17!==(t=e.keyCode)&&224!==t||(n=!0),(n=null!=e.ctrlKey&&null!=e.metaKey?e.ctrlKey||e.metaKey:n)&&86===e.keyCode&&(o._textarea_focus_stolen=!0,o._container.focus(),o._paste_event_fired=!1,setTimeout(function(){if(!o._paste_event_fired)return $(a).focus(),o._textarea_focus_stolen=!1},1)),null}),$(a).on("paste",function(){}),$(a).on("focus",function(){if(!o._textarea_focus_stolen)return $(a).addClass("pastable-focus")}),$(a).on("blur",function(){if(!o._textarea_focus_stolen)return $(a).removeClass("pastable-focus")}),$(o._target).on("_pasteCheckContainerDone",function(){return $(a).focus(),o._textarea_focus_stolen=!1}),$(o._target).on("pasteText",function(e,t){t=t.text;return cursorPos.codemirror.replaceSelection(t),hideWaitingPopup("parent-scroll-element"),$(a).trigger("change")}))},i.mountContenteditable=function(e){new i(e,e);return $(e).on("focus",(hideWaitingPopup("parent-scroll-element"),function(){return $(e).addClass("pastable-focus")})),$(e).on("blur",function(){return hideWaitingPopup("parent-scroll-element"),$(e).removeClass("pastable-focus")})},i.prototype._handleImage=function(e){var t=new Image;return t.crossOrigin="anonymous",t.onload=function(){var e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,e.width,e.height);try{pasteImageReader(e.toDataURL("image/png"))}catch(e){hideWaitingPopup("parent-scroll-element")}},t.onerror=void 0,t.src=e},i.prototype._checkImagesInContainer=function(n){for(var o,i,s=Math.floor(1e3*Math.random()),e=this._container.find("img"),t=0,a=e.length;t<a;t++)(o=e[t])["_paste_marked_"+s]=!0;return setTimeout((i=this,function(){var e,t,a=i._container.find("img");for(0==a.length&&hideWaitingPopup("parent-scroll-element"),e=0,t=a.length;e<t;e++)(o=a[e])["_paste_marked_"+s]||(n(o.src),$(o).remove());return i._target.trigger("_pasteCheckContainerDone")}),1)},i}(),$(document).on("click","#close-comment",function(){$(".view-heading").css("display","none"),$(".header-section a").css("display","none"),parent.$("#commentImage_popup").BoldBIDashboardDialog("close"),parent.$("#commentModuleContainer").addClass("displayNone"),parent.$("#delete_popup_iframe").addClass("displayNone"),parent.$("#dashboard-comment").removeClass(" highlight-icon"),parent.$("#widgetCommentModuleContainer").addClass("displayNone"),"true"==parent.$("#is_mobile").val()&&(parent.$(dashboardTypeId).show(),parent.$("#server-mobile-navbar .server-comment").hasClass("active"))&&(parent.$("#server-mobile-navbar a.active").removeClass("active"),parent.$("#server-mobile-navbar .su-nav-dashboard").addClass("active")),parent.$(".options").css("right","0px"),parent.$(".options li").removeClass("active"),iframeUrl==parentUrl?(parent.isMultiTab&&(parent.$(".e-content.e-lib.e-touch").css("width",$(parent.window).width()),parent.$(".e-content.e-lib.e-touch").css("height",$(parent.window).height()-40)),parent.$(dashboardTypeId).css("width",$(parent.window).width()-parent.$(".options").outerWidth()+"px"),parent.getDashboardInstance().resizeDashboard()):parent.$(".su-sidebar-collapse").is(":visible")||(parent.$(dashboardTypeId).css("width",parent.document.body.clientWidth-40),$(parent.parent.document.body).find("#item-viewer").css("width",parent.document.body.clientWidth-5))});