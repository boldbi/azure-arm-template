var isFirstRequest=!1,isItemDeleteDialogBinded=!1,webhookLogStartDateTime="",webhookLogEndDateTime="";function setTimpickerValue(){webhookLogEndDateTime="True"==webhookActivityLogTimeFomat?(webhookLogStartDateTime="00:00","23:59"):(webhookLogStartDateTime="12:00 AM","11:59 PM")}function openWebhookLogDetails(){var t=angular.element("[ng-controller=WebhookLogInfoCtrl]").scope(),e=$("#webhookLogGrid").ejGrid("instance"),e=e.getCurrentViewData()[e.getIndexByRow($("tr.e-row[aria-selected *='true']"))];showWaitingPopup($("#server-app-container")),$.ajax({type:"GET",url:getWebhookLogDetails,data:{webhookLogId:e.Id},success:function(e){e.status&&(t.openWebhookLogInfoDialog(e.Data),""!=e.FileContent&&($("#download-file-content").text(e.FileName),$("#download-file-content").attr("data-original-title",e.FileName),$("#download-file-content").attr("href",e.FileContent),$("#download-file-content").attr("download",e.FileName),$("[data-toggle='tooltip']").tooltip()),hideWaitingPopup($("#server-app-container")))}})}function fnWebhookLogActionBegin(e){var t,o=[];if(0<e.model.filterSettings.filteredColumns.length){for(t=0;t<e.model.filterSettings.filteredColumns.length;t++){var a=e.model.filterSettings.filteredColumns[t];o.push({PropertyName:a.field,FilterType:a.operator,FilterKey:a.value})}this.model.query._params.push({key:"filterCollection",value:o})}}function DateRangeLocalization(){var e={customPicker:window.Server.App.Localization.CustomPicker,watermarkText:window.Server.App.Localization.SelectRange};"undefined"!=typeof BoldBIDashboard?BoldBIDashboard.DateRangePicker.Locale["en-US"]=e:ej.DateRangePicker.Locale["en-US"]=e}function fnOnGridLoad(e){e.model.dataSource.adaptor=new ej.UrlAdaptor,e.model.enableTouch=!1}function fnActionBegin(e){isFirstRequest=!0;var t,o=$("#search-webhooks-grid").val(),a=(this.model.query._params.push({key:"searchKey",value:o}),[]),o=createLoader("webhooksGridSettings");if(this.element.ejWaitingPopup({template:$("#"+o)}),0<e.model.filterSettings.filteredColumns.length){for(t=0;t<e.model.filterSettings.filteredColumns.length;t++){var n=e.model.filterSettings.filteredColumns[t];a.push({PropertyName:n.field,FilterType:n.operator,FilterKey:n.value})}this.model.query._params.push({key:"filterCollection",value:a})}}function rowBound(){isFirstRequest=isFirstRequest&&!1}function getDeleteWebhookDetails(e){$.ajax({type:"POST",url:deleteWebhookDetailsUrl,data:{webhookId:e},success:function(e){$("#item-delete-confirmation").html(e),$("#delete-popup-container .dialog-body").addClass("text-left").removeClass("text-center"),ejs.popups.hideSpinner(document.getElementById("delete-item-dialog"))}})}function deletewebhookConfirmation(){ejs.popups.showSpinner(document.getElementById("delete-item-dialog"));var e=$("#delete-webhook").attr("data-item-id"),t=$(".item-name").html();$.ajax({type:"POST",url:deleteWebhookConfirmationUrl,data:{webhookId:e},success:function(e){e.status?(ejs.popups.hideSpinner(document.getElementById("delete-item-dialog")),successToast(window.Server.App.Localization.DeleteSuccess.format(t),7e3),$("#webhooksGridSettings").data("ejGrid").refreshContent()):($("#item-delete-confirmation_wrapper").ejWaitingPopup("hide"),warningToast(null!=e.permissionDenied&&e.permissionDenied?window.Server.App.Localization.PermissionWarningAlert:window.Server.App.Localization.DeleteWebhookFailMessage.format(t),null!=e.permissionDenied&&e.permissionDenied?null:e.message,null,window.Server.App.Localization.DeleteWebhook)),document.getElementById("delete-item-dialog").ej2_instances[0].hide()}})}function activateWebhook(e){$.ajax({type:"POST",url:window.activateWebhookUrl,data:{webhookId:e},success:function(e){e.status?(refreshWehbookGrid(),ShowWaitingProgress(".share-popup-header","hide"),successToast(window.Server.App.Localization.ActivateWebhookSuccess,7e3)):warningToast(null!=e.permissionDenied&&e.permissionDenied?window.Server.App.Localization.PermissionWarningAlert:window.Server.App.Localization.ActivateWebhookFailed,null!=e.permissionDenied&&e.permissionDenied?null:e.message,null,window.Server.App.Localization.ActivateWebhook)}})}function deactivateWebhook(e){$.ajax({type:"POST",url:deactivateWebhookUrl,data:{webhookId:e},success:function(e){e.status?(refreshWehbookGrid(),ShowWaitingProgress(".share-popup-header","hide"),successToast(window.Server.App.Localization.DeactivateWebhookSuccess,7e3)):warningToast(null!=e.permissionDenied&&e.permissionDenied?window.Server.App.Localization.PermissionWarningAlert:window.Server.App.Localization.DeactivateWebhookFailed,null!=e.permissionDenied&&e.permissionDenied?null:e.message,null,window.Server.App.Localization.DeactivateWebhook)}})}function refreshWehbookGrid(){$("#webhooksGridSettings").ejWaitingPopup("show"),1===$(".default-pages").length?($("#body").ejWaitingPopup("show"),location.reload()):$("#webhooksGridSettings").data("ejGrid").refreshContent()}$(document).ready(function(){$("[data-toggle='tooltip'], .selectpicker").tooltip(),$("#datePicker").ejDateRangePicker({dateFormat:webhookActivityLogDateFormat,locale:"en-US",buttonText:{apply:window.Server.App.Localization.Apply,cancel:window.Server.App.Localization.CancelButton,reset:window.Server.App.Localization.Reset},ranges:[{label:window.Server.App.Localization.Today,range:[new Date,new Date]},{label:window.Server.App.Localization.Yesterday,range:[new Date((new Date).setDate((new Date).getDate()-1)),new Date((new Date).setDate((new Date).getDate()-1))]},{label:window.Server.App.Localization.LastDays.format("7"),range:[new Date((new Date).setDate((new Date).getDate()-7)),new Date]},{label:window.Server.App.Localization.LastDays.format("15"),range:[new Date((new Date).setDate((new Date).getDate()-14)),new Date]},{label:window.Server.App.Localization.LastDays.format("30"),range:[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},{label:window.Server.App.Localization.LastDays.format("60"),range:[new Date((new Date).setMonth((new Date).getMonth()-2)),new Date]},{label:window.Server.App.Localization.ThisWeek,range:[new Date((new Date).setDate((new Date).getDate()-(new Date).getDay())),new Date((new Date).setDate((new Date).getDate()-(new Date).getDay()+6))]},{label:window.Server.App.Localization.ThisMonth,range:[new Date((new Date).getFullYear(),(new Date).getMonth(),1),new Date((new Date).getFullYear(),(new Date).getMonth()+1,0)]}]})}),$(document).on("click","#webhook-log-filter-apply-button",function(){$.ajax({type:"GET",url:integarationPagePermissionUrl,data:{scope:SettingsScopes.Integrations},success:function(e){var t,o,a,n;e.status?(setTimpickerValue(),t=$("#datePicker").val().split("-"),n=""!=$.trim(t[0])?$.trim(t[0])+" "+webhookLogStartDateTime:"",t=""!=$.trim(t[1])?$.trim(t[1])+" "+webhookLogEndDateTime:"",o=null==$("#select-webhook-event").val()?"":$("#select-webhook-event").val(),a=$("#webhookLogGrid").data("ejGrid"),n=ej.DataManager({url:filterWebhookLogsUrl+"?startDate="+n+"&endDate="+t+"&eventType="+o,adaptor:new ej.UrlAdaptor}),a.dataSource(n),a.model.pageSettings.currentPage=1):e.permissionDenied&&warningToast(window.Server.App.Localization.AdminPageAccessWarningAlert+" "+window.Server.App.Localization.ReloadPage)}})}),$(document).on("click",".webhook-log-info",function(){openWebhookLogDetails()}),serverApp.controller("WebhookLogInfoCtrl",["$scope","$timeout",function(o,a){o.WebhookLogDetail=null,o.closeItemInfo=function(){$("#webhookLog-info-popup").ejDialog("close")},o.openWebhookLogInfoDialog=function(e){var t=JSON.parse(e.RequestData),t=(null==t.FileContent?$(".webhook-log-file-content").css("display","none"):$(".webhook-log-file-content").css("display","block"),delete t.FileContent,JSON.stringify(t,null,2));o.WebhookLogDetail=e,$("#webhookLog-info-popup").ejDialog({width:480<window.innerWidth?"400px":window.innerWidth-10+"px",height:"548px",showOnInit:!1,allowDraggable:!1,enableResize:!1,showHeader:!1,enableModal:!0}),$("#webhookLog-info-popup").ejDialog("open"),$("#webhookLog-info-popup").ejDialog("refresh"),document.getElementById("request-message").innerText=t,a(function(){o.$apply()},100)}}]),$(document).ready(function(){var e;-1<window.location.href.indexOf("?isRedirectedFromEdit")&&(successToast(window.Server.App.Localization.EditWebhookSuccess,7e3),e=(e=window.location.href).substring(0,e.lastIndexOf("?")),history.replaceState(null,null,e))}),$(document).on("click",".search-accounts",function(){var e=$("#webhooksGridSettings").data("ejGrid");e.model.pageSettings.currentPage=1,e.refreshContent()}),$(document).on("click","#delete-webhook",function(e){$("#delete-item-name").html($(this).attr("data-name")),$("#delete-webhook").attr("data-item-id",$(this).attr("data-item-id"));var t,o,a=$(this).attr("data-item-id"),n=$(this).attr("data-name"),n=(document.getElementById("item-delete-confirmation").style.display="block",'<span class="dialog-header-with-subtitle"><span class ="dialog-header-title">'+window.Server.App.Localization.DeleteWebhook+' </span><span class="item-name">'+n+"</span></span>");isItemDeleteDialogBinded?((o=document.getElementById("delete-item-dialog").ej2_instances)[0].header=n,o[0].show()):((t=document.createElement("div")).setAttribute("id","delete-item-dialog"),document.getElementById("webhooksGridSettings").appendChild(t),(o=new ejs.popups.Dialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,width:460<window.innerWidth?"450px":window.innerWidth-10,height:"auto",showHeader:!1,animationSettings:{effect:"Zoom"},isModal:!0,enableModal:!0,closeOnEscape:!0,header:n,showCloseIcon:!0,content:document.getElementById("item-delete-confirmation"),buttons:[{click:function(e){deletewebhookConfirmation()},buttonModel:{cssClass:"app-btn-danger",content:window.Server.App.Localization.YesButton}},{click:function(){o.hide()},buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.NoButton}}]})).appendTo(t),isItemDeleteDialogBinded=!0),ejs.popups.createSpinner({target:document.getElementById("delete-item-dialog")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("delete-item-dialog")),getDeleteWebhookDetails(a)}),$(document).on("click",".deactivate-webhook",function(e){$(".deactivate-webhook").attr("data-item-id",$(this).attr("data-item-id")),deactivateWebhook($(this).attr("data-item-id"))}),$(document).on("click",".activate-webhook",function(e){$(".activate-webhook").attr("data-item-id",$(this).attr("data-item-id")),activateWebhook($(this).attr("data-item-id"))}),$.views.converters("toLowerCase",function(e){return e.toLowerCase()});