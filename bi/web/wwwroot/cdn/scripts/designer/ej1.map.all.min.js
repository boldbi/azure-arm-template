/*!
*  filename: ej1.map.all.min.js
*  version : 6.14.12
*  Copyright Syncfusion Inc. 2001 - 2023. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(t,r,u){r.widget("BoldBIDashboardMap","BoldBIDashboard.datavisualization.Map",{validTags:["div"],_initPrivateProperties:function(){this._rootgroup=null;this._bubblegroup=null;this._scale=1;this._prevDistance=0;this._tileTranslatePoint={x:0,y:0};this._translatePoint={x:0,y:0};this._prevPoint=null;this._Tiles=[];this._prevScale=0;this._tileDiv=null;this._containerWidth=500;this._containerHeight=400;this._baseTranslatePoint={x:0,y:0};this._isDragging=!1;this._prevLevel=1;this._startPoint={x:0,y:0};this._stopPoint={x:0,y:0};this.mouseClickable=!1;this._browser=null;this._baseScale=0;this._mapBounds=null;this._svgns="http://www.w3.org/2000/svg";this._ispanning=!1;this._dragStartX=0;this._isNavigationPressed=!1;this._iskeyboardKeysPressed=!1;this._isPolygonSelected=!1;this._dragStartY=0;this._width=350;this._height=350;this._isMapCoordinates=!0;this._margintop=0;this._marginleft=0;this._svgDocument=null;this._tooltipElement=null;this._templateDiv=null;this._scrollLegendDiv=null;this._legendContainer=null;this._legendDiv=null;this._legendDivHeight=0;this._legendDivWidth=0;this._mapContainer=null;this._isSVG=!0;this._VMLPathFractionCount=0;this._sliderControl=null;this._isTileMap=!1;this._isRendered=!1;this._urlTemplate=null;this._polylineCount=0;this._pointscount=0;this._isPinching=!1;this._groupSize=null;this._groupBorder={x:0,y:0};this._duplicateItems=[];this._duplicateItemValue=null},defaults:{enableRightClick:!1,enableRTL:!1,background:"white",zoomSettings:{minValue:1,maxValue:100,factor:1,level:1,enableZoomOnSelection:!1,enableZoom:!0},centerPosition:null,enableResize:!0,isResponsive:!0,enableAnimation:!1,draggingOnSelection:!1,navigationControl:{enableNavigation:!1,content:null,orientation:"vertical",absolutePosition:[0,0],dockPosition:"centerleft"},enableLayerChangeAnimation:!1,enablePan:!0,baseMapIndex:0,shapeSelected:"",markerSelected:"",zoomedIn:"",onRenderComplete:"",refreshed:"",panned:"",zoomedOut:"",mouseover:"",mouseleave:"",click:"",doubleClick:"",legendItemRendering:"",shapeRendering:"",bubbleRendering:"",onLoad:"",layers:[]},observables:["baseMapIndex","enablePan","enableResize","enableAnimation","zoomSettings.level","zoomSettings.minValue","zoomSettings.maxValue","zoomSettings.factor","zoomSettings.enableZoom","zoomSettings.enableZoomOnSelection","navigationControl.enableNavigation","navigationControl.orientation","navigationControl.absolutePosition","navigationControl.dockPosition",],_tags:[{tag:"layers",attr:["legendSettings.showLegend","legendSettings.positionX","legendSettings.positionY","legendSettings.type","legendSettings.labelOrientation","legendSettings.title","legendSettings.mode","legendSettings.position","legendSettings.dockOnMap","legendSettings.dockPosition","legendSettings.leftLabel","legendSettings.rightLabel","bubbleSettings.showBubble","bubbleSettings.valuePath","bubbleSettings.minValue","bubbleSettings.maxValue","bubbleSettings.color","enableSelection","enableMouseHover","showTooltip","showMapItems","mapItemsTemplate","shapeData","dataSource","shapePropertyPath","shapeDataPath","layerType","bingMapType","urltemplate","shapeSettings.highlightColor","shapeSettings.highlightBorderWidth","shapeSettings.selectionColor","shapeSettings.fill","shapeSettings.strokeThickness","shapeSettings.selectionStrokeWidth","shapeSettings.stroke","shapeSettings.selectionStroke","shapeSettings.highlightStroke","shapeSettings.colorValuePath","shapeSettings.valuePath","shapeSettings.autoFill","shapeSettings.enableGradient",[{tag:"markers",attr:["label","latitude","longitude"],singular:"marker"},{tag:"bubbleSettings.colorMappings.rangeColorMapping",attr:["from","to","color"],singular:"bubblerangeColorMap"},{tag:"bubbleSettings.colorMappings.equalColorMapping",attr:["value","color"],singular:"bubbleequalColorMap"},{tag:"shapeSettings.colorMappings.rangeColorMapping",attr:["from","to","color"],singular:"shaperangeColorMap"},{tag:"shapeSettings.colorMappings.equalColorMapping",attr:["value","color"],singular:"shapeequalColorMap"},{tag:"subLayers",attr:["legendSettings.showLegend","legendSettings.positionX","legendSettings.positionY","legendSettings.type","legendSettings.labelOrientation","legendSettings.title","legendSettings.mode","legendSettings.position","legendSettings.dockOnMap","legendSettings.dockPosition","legendSettings.leftLabel","legendSettings.rightLabel","bubbleSettings.showBubble","bubbleSettings.valuePath","bubbleSettings.minValue","bubbleSettings.maxValue","bubbleSettings.color","enableSelection","enableMouseHover","showTooltip","showMapItems","mapItemsTemplate","shapeData","dataSource","shapePropertyPath","shapeDataPath","layerType","bingMapType","key","urltemplate","shapeSettings.highlightColor","shapeSettings.highlightBorderWidth","shapeSettings.selectionColor","shapeSettings.fill","shapeSettings.strokeThickness","shapeSettings.selectionStrokeWidth","shapeSettings.stroke","shapeSettings.selectionStroke","shapeSettings.highlightStroke","shapeSettings.colorValuePath","shapeSettings.valuePath","shapeSettings.autoFill","shapeSettings.enableGradient",[{tag:"markers",attr:["label","latitude","longitude"],singular:"marker"},{tag:"bubbleSettings.colorMappings.rangeColorMapping",attr:["from","to","color"],singular:"bubblerangeColorMap"},{tag:"bubbleSettings.colorMappings.equalColorMapping",attr:["value","color"],singular:"bubbleequalColorMap"},{tag:"shapeSettings.colorMappings.rangeColorMapping",attr:["from","to","color","highlightcolor"],singular:"shaperangeColorMap"},{tag:"shapeSettings.colorMappings.equalColorMapping",attr:["value","color"],singular:"shapeequalColorMap"}],],singular:"subLayer"}]],singular:"layer"}],enableZoom:r.util.valueFunction("zoomSettings.enableZoom"),enableZoomOnSelection:r.util.valueFunction("zoomSettings.enableZoomOnSelection"),zoomLevel:r.util.valueFunction("zoomSettings.level"),minZoom:r.util.valueFunction("zoomSettings.minValue"),zoomFactor:r.util.valueFunction("zoomSettings.factor"),maxZoom:r.util.valueFunction("zoomSettings.maxValue"),baseMapIndex:r.util.valueFunction("baseMapIndex"),enablePan:r.util.valueFunction("enablePan"),enableResize:r.util.valueFunction("enableResize"),enableAnimation:r.util.valueFunction("enableAnimation"),enableNavigation:r.util.valueFunction("navigationControl.enableNavigation"),orientation:r.util.valueFunction("navigationControl.orientation"),absolutePosition:r.util.valueFunction("navigationControl.absolutePosition"),dockPosition:r.util.valueFunction("navigationControl.dockPosition"),dataTypes:{layers:"array"},_destroy:function(){this._unWireEvents();_isSVG?t(this.element).removeClass("e-datavisualization-map e-js").find("#svgDocument").remove():t(this.element).removeClass("e-datavisualization-map e-js").find("#rootGroup").remove()},_setModel:function(n){var i,r;for(i in n)switch(i){case"zoomSettings":this.enableZoom()&&this.zoom(this.zoomLevel());break;case"baseMapIndex":this.baseMapIndex(n[i]);r=this;this.enableAnimation()?(this.model.enableLayerChangeAnimation=!0,t(this._mapContainer).animate({opacity:0},500,function(){r.refresh()})):this.refresh();break;case"background":t(this._mapContainer).css("background-image",this.model.background)}},_layers:function(n,t){t=="shapeSettings.fill"||t=="shapeSettings.strokeThickness"||t=="shapeSettings.selectionColor"||t=="shapeSettings.highlightColor"?this.clearShapeSelection():t=="showMapItems"||t=="dataSource"?this.refreshLayers():this.refresh()},_layers_markers:function(){this.refreshMarkers()},_layers_subLayers:function(n,t){t=="showMapItems"||t=="dataSource"?this.refreshLayers():this.refresh()},_init:function(){var n=this;this._navigationStyle=null;this.navigationControlData=null;this._initPrivateProperties();t.each(this.model.layers,function(t){n._layerInitialize(t)});this._mapContainer=this.element;t(this._mapContainer).css({overflow:"hidden"});document.documentMode==8&&t(this._mapContainer).css({overflow:"hidden",position:"relative"});this.refresh();this._isRendered=!0;_isSVG&&t(this._svgDocument).pinchZoom(this._rootgroup,this)},_layerInitialize:function(n){var i=this;this.model.layers[n]!=null?t.each(this.model.layers,function(n,r){r=i._checkArrayObject(r,n);var u=new f;t.extend(u,r);t.extend(r,u);t.each(r.subLayers,function(n,r){r=i._checkArrayObject(r,n);var u=new f;t.extend(u,r);t.extend(r,u)})}):this.layers[0]=new f},_checkArrayObject:function(n,i){var r=this;return t.each(n,function(n,t){if(t instanceof Array)r._checkArrayObject(t,n);else if(t!=null&&typeof t=="object"){var u=new f;r._loadIndividualDefaultValues(t,u,typeof n=="number"?i:n)}}),n},_loadIndividualDefaultValues:function(n,i,r){var u=null,f=this;return t.each(i,function(n,t){if(r==n){u=t;return}}),u instanceof Array&&(u=u[0]),t.each(n,function(n,t){t instanceof Array?f._checkArrayObject(t,r):t!=null&&typeof t=="object"&&f._loadIndividualDefaultValues(t,t,typeof n=="number"?r:n)}),t.extend(u,n),t.extend(n,u),n},_refreshWithAnimation:function(){this.model.layers[this.baseMapIndex()]._setMapItemsPositionWithAnimation(this);for(var n=0;n<this.model.layers[this.baseMapIndex()].subLayers.length;n++)this.model.layers[this.baseMapIndex()].subLayers[n]._setMapItemsPositionWithAnimation(this)},_resizeShape:function(){this.model.layers[this.baseMapIndex()]._resizeShapes(this);for(var n=0;n<this.model.layers[this.baseMapIndex()].subLayers.length;n++)this.model.layers[this.baseMapIndex()].subLayers[n]._resizeShapes(this)},_refrshLayers:function(){this.model.layers[this.baseMapIndex()]._setMapItemsPosition(this);for(var n=0;n<this.model.layers[this.baseMapIndex()].subLayers.length;n++)this.model.layers[this.baseMapIndex()].subLayers[n]._setMapItemsPosition(this)},_panTileMap:function(n,t,i){var u=Math.pow(2,this.zoomLevel())*256,r;this._tileTranslatePoint.x=n/2-u/2;this._tileTranslatePoint.y=t/2-u/2;r=this._convertTileLatLongtoPoint(i[0],i[1]);this._tileTranslatePoint.x-=r.x-n/2;this._tileTranslatePoint.y-=r.y-t/2},_generateTiles:function(n){var w=navigator.language||navigator.userLanguage,b,k,f,o,s,h,i,p,c,u,l,a,v;this.Tiles=[];b=k=Math.pow(2,n);var y=this.model.layers[this.baseMapIndex()],d=Math.min(k,(-this._tileTranslatePoint.y+this._height)/256+1),g=Math.min(b,(-this._tileTranslatePoint.x+this._width)/256+1),nt=-(this._tileTranslatePoint.x+256)/256,tt=-(this._tileTranslatePoint.y+256)/256;for(f=Math.round(nt);f<Math.round(g);f++)for(o=Math.round(tt);o<Math.round(d);o++)s=256*f+this._tileTranslatePoint.x,h=256*o+this._tileTranslatePoint.y,s>-256&&s<=this._width&&h>-256&&h<this._height&&f>=0&&o>=0&&(i=new e(f,o),i.left=s,i.top=h,i.src=y.layerType==r.datavisualization.Map.LayerType.Bing?this._getBingMap(i,y.key,y.bingMapType,w):this._urlTemplate.replace("level",this.zoomLevel()).replace("tileX",i.X).replace("tileY",i.Y),this.Tiles.push(i));for(p=t.extend(!0,[],this.Tiles),c=0;c<this.model.layers[this.baseMapIndex()].subLayers.length;c++)if(u=this.model.layers[this.baseMapIndex()].subLayers[c],u.layerType==r.datavisualization.Map.LayerType.OSM||u.layerType==r.datavisualization.Map.LayerType.Bing)for(l=0;l<p.length;l++)a=p[l],v=t.extend(!0,{},a),v.src=u.layerType==r.datavisualization.Map.LayerType.Bing?this._getBingMap(v,u.key,u.bingMapType,w):u.urlTemplate.replace("level",this.zoomLevel()).replace("tileX",a.X).replace("tileY",a.Y),this.Tiles.push(v);this._arrangeTiles()},_getBingMap:function(n,t,i,u){for(var f,s,h,e="",o=this.zoomLevel();o>0;o--)f=0,s=1<<o-1,(n.X&s)!=0&&f++,(n.Y&s)!=0&&(f+=2),e=e+""+f;return h=i==r.datavisualization.Map.BingMapType.Aerial?"A,G":i==r.datavisualization.Map.BingMapType.AerialWithLabel?"A,G,L":"G,VE,BX,L,LA","http://ak.dynamic.t2.tiles.virtualearth.net/comp/ch/"+e+"?mkt="+u+"&ur=IN&it="+h+"&shading=hill&og=45&n=z&Key="+t},_arrangeTiles:function(){var n=t.templates("<div><div style='position:absolute;left:{{:left}}px;top:{{:top}}px;height:{{:height}}px;width:{{:width}}px;'><img src={{:src}}><\/img><\/div><\/div>"),i=n.render(this.Tiles),r=this._mapContainer[0].children[0];this._tileDiv.html(i)},_generatePath:function(){var n=this.model.layers[this.baseMapIndex()],e=this.baseMapIndex(),f="",i,o,s;for(this._polylineCount=0,this._pointscount=0,_isSVG=window.SVGSVGElement?!0:!1,n.layerType==r.datavisualization.Map.LayerType.Geometry?n!=u&&n.shapeData!=null&&(n._isBaseLayer=!0,this._isTileMap=!1,this._scale=this.zoomLevel(),f=this._readShapeData(n,e,null)):(this._isTileMap=!0,this._scale=Math.pow(2,this.zoomLevel()-this.zoomFactor())),i=0;i<n.subLayers.length;i++)n.subLayers[i].layerType==r.datavisualization.Map.LayerType.Geometry&&n.subLayers[i].shapeData!=null&&(n.subLayers[i]._isBaseLayer=!1,f+=this._readShapeData(n.subLayers[i],e,i));_isSVG?(o='<div style="position:relative;" id="tileDiv"/><svg xmlns="http://www.w3.org/2000/svg" style= "overflow:hidden;z-index:0;float:left;left:0,top:0"id="svgDocument"> <g id="rootGroup">'+f+"<\/g><\/svg>",this._mapContainer.html(o),this._svgDocument=this.element.find("#svgDocument")[0],this._tileDiv=this.element.find("#tileDiv")):(document.createStyleSheet().addRule(".vml","behavior:url(#default#VML);display:inline-block"),document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),s='<div id="tileDiv"/><v:group   id = "rootGroup" style="position:absolute; width:'+this._width+"px;height:"+this._height+'px;" coordorigin = "0 0" coordsize="'+this._width+" "+this._height+'">'+f+"<\/v:group>",this._mapContainer.html(s),this._tileDiv=this.element.find("#tileDiv"),this._bubblegroup=this._createGroup(!1,"bubbleGroup"),this._bubblegroup.style.position="absolute",this.element.append(this._bubblegroup));(n.layerType==r.datavisualization.Map.LayerType.OSM||n.layerType==r.datavisualization.Map.LayerType.Bing)&&(this._urlTemplate=n.urlTemplate,this.model.centerPosition!=null?this._panTileMap(this._width,this._height,this.model.centerPosition):this._panTileMap(this._width,this._height,[0,0]),this._generateTiles(this.zoomLevel()),_isSVG&&t(this._svgDocument).css("position","relative"));_isSVG&&t(this._mapContainer).css("position","relative");this._rootgroup=this.element.find("#rootGroup")[0];this._on(t(this.element),r.eventType.mouseDown,{map:this},this.dragDown);this._on(t(this.element),r.eventType.mouseMove,{map:this},this.dragMove);this._on(t(this.element),r.eventType.mouseUp,{map:this},this.dragUp)},_calculateBBox:function(n,t,i){var u=maxLatitude=minLongitude=maxLongitude=0,h=!1,o={minLatitude:0,maxLatitude:0,minLongitude:0,maxLongitude:0},s,r,e,f;if(n!=null&&n.length>0)for(r=0;r<n.length;r++)s=n[r],coords=s.geometry!=null?s.geometry.coordinates:s.coordinates,this._isMultipolygon(coords)?this._calculateMultiPolygonBBox(coords,o,r>0):this._calculatePolygonBBox(coords,o,r>0);if(u=o.minLatitude,maxLatitude=o.maxLatitude,minLongitude=o.minLongitude,maxLongitude=o.maxLongitude,i!=null&&i.length>0)for(r=0;r<i.length;r++)s=i[r],subData=s.geometry.coordinates,h?(u=Math.min(u,subData[1]),maxLatitude=Math.max(maxLatitude,subData[1]),minLongitude=Math.min(minLongitude,subData[0]),maxLongitude=Math.max(maxLongitude,subData[0])):(u=maxLatitude=subData[1],minLongitude=maxLongitude=subData[0],h=!0);if(t!=null&&t.length>0)for(r=0;r<t.length;r++)for(e=t[r].geometry==null?t[r].coordinates:t[r].geometry.coordinates,f=0;f<e.length;f++)h?(u=Math.min(u,e[f][1]),maxLatitude=Math.max(maxLatitude,e[f][1]),minLongitude=Math.min(minLongitude,e[f][0]),maxLongitude=Math.max(maxLongitude,e[f][0])):(u=maxLatitude=e[f][1],minLongitude=maxLongitude=e[f][0],h=!0);return this._groupSize!=null||this._isMapCoordinates||(this._groupSize={minX:minLongitude,maxX:maxLongitude,minY:u,maxY:maxLatitude}),[[minLongitude,u],[maxLongitude,maxLatitude]]},_isMultipolygon:function(n){return n.length>0&&n[0].length>0&&n[0][0].length>0&&n[0][0][0].length>0},_calculateMultiPolygonBBox:function(n,t,i){for(var r=0;r<n.length;r++)t=this._calculatePolygonBBox(n[r],t,i||r>0);return!0},_calculatePolygonBBox:function(n,t,i){for(var r,u,e=n.length,f=0;f<e;f++)if(r="",e>1?(r=n[f][0],r.length<=2&&(r=n[f])):r=n[f],r.length>2)for(u=0;u<r.length;u++)r[u][1]!=null&&r[u][0]!=null&&(i?(t.minLatitude=Math.min(t.minLatitude,r[u][1]),t.maxLatitude=Math.max(t.maxLatitude,r[u][1]),t.minLongitude=Math.min(t.minLongitude,r[u][0]),t.maxLongitude=Math.max(t.maxLongitude,r[u][0])):(t.minLatitude=t.maxLatitude=r[u][1],t.minLongitude=t.maxLongitude=r[u][0],i=!0));else r[1]!=null&&r[0]!=null&&(i?(t.minLatitude=Math.min(t.minLatitude,r[1]),t.maxLatitude=Math.max(t.maxLatitude,r[1]),t.minLongitude=Math.min(t.minLongitude,r[0]),t.maxLongitude=Math.max(t.maxLongitude,r[0])):(t.minLatitude=t.maxLatitude=r[1],t.minLongitude=t.maxLongitude=r[0],i=!0));return t},_readShapeData:function(n,t,i){var e=this,u,f;if(n.shapeData!=null)if(typeof n.shapeData=="string")u=new r.DataManager(n.shapeData),f=r.Query().from(n),u.executeQuery(f).done(function(r){if(r.result!=null)return e._getPathCollection(r.result,n,t,i)});else return this._getPathCollection(n.shapeData,n,t,i)},_getFactor:function(){var n,t,i,r;if(this._mapBounds!=null){var u=this._convertTileLatLongtoPointForShapes(this._mapBounds[0][1],this._mapBounds[0][0],this._mapBounds),f=this._convertTileLatLongtoPointForShapes(this._mapBounds[1][1],this._mapBounds[1][0],this._mapBounds),r=i=1;n=f.y-u.y;t=f.x-u.x}else n=500,t=500;return i=n<this._height?parseFloat(Math.abs(this._height/n+"e+1").toString().split(".")[0]/10):this._height/n,r=t<this._width?parseFloat(Math.abs(this._width/t+"e+1").toString().split(".")[0]/10):this._width/t,Math.min(r,i)},_getPathCollection:function(n,i,f,e){var bt="",ot="",st="",yt,y,p,w,b,ft,ai,ii,k,kt,dt,gt,ni,it,vi,ri,ui,pt,wt,ct,g,et,c,n,o,l,ht,v,d,s,ti,fi,h,at,vt,a,lt,nt,ei;if(n.features!=null?(st=new r.DataManager(n.features),ot="geometry.type",i._isBaseLayer&&(this._mapBounds=n.bbox)):n.geometries!=null&&(st=new r.DataManager(n.geometries),ot="type",i._isBaseLayer&&n.bbox!=null&&(this._mapBounds=[[n.bbox[0],n.bbox[1]],[n.bbox[2],n.bbox[3]]])),n.geometries!=null||n.features!=null){var oi=r.Query().from(i).where(ot,r.FilterOperators.equal,"LineString"),si=r.Query().from(i).where(ot,r.FilterOperators.equal,"Polygon"),hi=r.Query().from(i).where(ot,r.FilterOperators.equal,"MultiPolygon"),tt=st.executeLocal(oi),rt=st.executeLocal(si),ci=r.Query().from(i).where(ot,r.FilterOperators.equal,"Point"),ut=st.executeLocal(ci),li=st.executeLocal(hi);if(this._polylineCount=this._polylineCount+tt.length,this._pointscount=this._pointscount+ut.length,t.merge(rt,li),i._isBaseLayer&&i.geometryType==r.datavisualization.Map.GeometryType.Normal&&(this._isMapCoordinates=!1),this._mapBounds==null&&i._isBaseLayer?this._mapBounds=this._calculateBBox(rt,tt,ut):this._mapBounds==null&&(this._mapBounds=[[-180,-85],[180,85]]),lt=this._getFactor(),i._newBounds=[],yt="",this._groupSize!=null&&(y=this._groupSize.minX,p=this._groupSize.maxX,w=this._groupSize.minY,b=this._groupSize.maxY),ft=!0,ut.length>0)for(h=0;h<ut.length;h++)k=ut[h],ai="",c=k.geometry.coordinates,n=[],o=[],n.push({lat:parseFloat(c[1]),lng:parseFloat(c[0])}),ht=0,v=n[0],latitude=v.lat,longitude=v.lng,s=this._convertTileLatLongtoPointForShapes(latitude,longitude,this._mapBounds,lt),d=this._mapBounds,longitude>=d[0][0]&&longitude<=d[1][0]&&latitude>=d[0][1]&&latitude<=d[1][1]?(ft?(y=p=s.x,w=b=s.y,ft=!1):(y=Math.min(y,s.x),p=Math.max(p,s.x),w=Math.min(w,s.y),b=Math.max(b,s.y)),_isSVG?o.push({x:s.x,y:s.y,lat:v.lat,lng:v.lng}):o.push({x:s.x-5/this._scale,y:s.y-5/this._scale,lat:v.lat,lng:v.lng}),_isSVG?yt+='<circle cx="'+o[0].x+'" cy="'+o[0].y+'" r="'+i.shapeSettings.radius/this._scale+'" stroke="'+i.shapeSettings.stroke+'" stroke-width="'+i.shapeSettings.strokeThickness+'" fill="'+i.shapeSettings.fill+'" />':(ii='<v:oval display="block" fill="'+i.shapeSettings.fill+'" style="position:absolute;top: '+o[0].y+"px;left:"+o[0].x+"px;width:"+10/this._scale+"px;height:"+10/this._scale+"px;stroke-width:"+i.shapeSettings.strokeThickness+'px;"><\/v:oval>',yt+=ii)):(ut.splice(h,1),h--);if(rt.length>0)for(h=0;h<rt.length;h++){if(k=rt[h],vi=h,kt=0,ni=!1,gt={},k.properties&&(ri=typeof k.properties.centerX=="number"?k.properties.centerX:u,ui=typeof k.properties.centerY=="number"?k.properties.centerY:u,gt={centerX:ri,centerY:ui}),it=k.geometry!=null?k.geometry.coordinates:k.coordinates,dt=it[0][0].length,pt=it.length,pt>1)for(wt=it,ct=0;ct<wt.length;ct++)dt<wt[ct][0].length&&(dt=wt[ct][0].length,kt=ct);for(g="",et=0;et<pt;et++){if(c="",pt>1?(c=it[et][0],c.length<=2&&(c=it[et])):c=it[et],n=[],o=[],c.length>2)for(a=0;a<c.length;a++)n.push({lat:parseFloat(c[a][1]),lng:parseFloat(c[a][0])});else if(this._isMultipolygon(it)){for(l=0;l<c.length;l++)if(c[l].length>2)for(a=0;a<c[l].length;a++)n.push({lat:parseFloat(c[l][a][1]),lng:parseFloat(c[l][a][0])})}else n.push({lat:parseFloat(c[1]),lng:parseFloat(c[0])});for(ht=0;ht<n.length-1||n.length==1&&ht==0;ht++)v=n[ht],latitude=v.lat,longitude=v.lng,d=this._mapBounds,(this._isTileMap||longitude>=d[0][0]&&longitude<=d[1][0]&&latitude>=d[0][1]&&latitude<=d[1][1])&&(s=this._convertTileLatLongtoPointForShapes(latitude,longitude,d,lt),ft?(y=p=s.x,w=b=s.y,ft=!1):(y=Math.min(y,s.x),p=Math.max(p,s.x),w=Math.min(w,s.y),b=Math.max(b,s.y)),_isSVG?o.push({x:s.x,y:s.y,lat:v.lat,lng:v.lng}):o.push({x:s.x,y:s.y,lat:v.lat,lng:v.lng}));if(et==kt&&(ti=this._findMidPointofPoylgon(o,gt),ti&&(i._newBounds.push(ti),ni=!0)),o.length>0)if(_isSVG){for(g+="M"+o[0].x+","+o[0].y,l=1;l<o.length;l++)g+=","+o[l].x+","+o[l].y;g+="Z"}else{for(g+="m"+parseInt(o[0].x)+","+parseInt(o[0].y),g+=" l"+parseInt(o[0].x)+","+parseInt(o[0].y),l=1;l<o.length;l++)g+=","+parseInt(o[l].x)+","+parseInt(o[l].y);g+=" e"}}g!=""?(fi=this._id+"_layerIndex"+f+(r.util.isNullOrUndefined(e)?"":"_sublayerIndex"+e)+"_shapeIndex"+h,bt+=_isSVG?'<path class="mapShape" stroke='+i.shapeSettings.stroke+" stroke-width="+i.shapeSettings.strokeThickness/this._scale+" fill= "+i.shapeSettings.fill+' d="'+g+'"  stroke-linejoin= round stroke-linecap= square id="'+fi+'"><\/path>':'<v:shape  style="width:'+this._width+"px;height:"+this._height+'px;"  coordsize="'+this._width+" "+this._height+'" coordorigin="0 0" strokecolor='+i.shapeSettings.stroke+" stroke-width="+i.shapeSettings.strokeThickness/this._scale+'px" fillcolor= '+i.shapeSettings.fill+' path="'+g+'"><\/v:shape>',ni||i._newBounds.push({x:0,y:0})):(rt.splice(h,1),h--)}if(tt.length>0)for(h=0;h<tt.length;h++){for(at=tt[h].geometry==null?tt[h].coordinates:tt[h].geometry.coordinates,vt="",a=0;a<at.length;a++)lt=this._getFactor(),nt=this._convertTileLatLongtoPointForShapes(at[a][1],at[a][0],this._mapBounds,lt),ft?(y=p=nt.x,w=b=nt.y,ft=!1):(y=Math.min(y,nt.x),p=Math.max(p,nt.x),w=Math.min(w,nt.y),b=Math.max(b,nt.y)),vt+=nt.x+","+nt.y,a!=at.length-1&&(vt+=",");bt+=_isSVG?"<polyline stroke="+i.shapeSettings.stroke+" stroke-width="+i.shapeSettings.strokeThickness/this._scale+' fill="transparent" stroke-width="1" points="'+vt+'" ><\/polyline>':'<v:polyline coordsize="'+this._width+","+this._height+'" coordorigin="0 0" strokecolor='+i.shapeSettings.stroke+" strokeweight="+i.shapeSettings.strokeThickness/this._scale+'px" fillcolor='+i.shapeSettings.fill+'  points="'+vt+'"/>'}return this._isMapCoordinates&&(this._groupSize={minX:y,maxX:p,minY:w,maxY:b}),ei=[].concat(rt,tt),i._polygonData=t.merge(ei,ut),bt+yt}return i._polygonData=[],null},_createGroup:function(n,t){var i;return i=document.createElement("<v:group class="+t+">"),i.style.width=this._width+"px",i.style.height=this._height+"px",i.coordorigin="0 0",i.coordsize=this._width+" "+this._height,n&&(this._rootgroup=i,i.style.left="20px",i.style.top="20px"),i},_generatePaletteColorsForShape:function(n,t,i,r){r!=null&&(t.shapeSettings.highlightColor=r.highlightColor,t.shapeSettings.highlightStroke=r.highlightStroke,t.shapeSettings.selectionColor=r.SelectionColor,t.shapeSettings.selectionStroke=r.SelectionStroke);_isSVG?n.setAttribute("fill",i[t._prevPaletteIndex]):n.fillcolor=i[t._prevPaletteIndex];t._prevPaletteIndex=t._prevPaletteIndex+1;t._prevPaletteIndex>i.length-1&&(t._prevPaletteIndex=0)},_drawCustomBubble:function(n,i,r,u,f,e,o,s,h,c,l,a){var y,g,nt,v,k,tt,p,w,b,d;n.bubbleSettings!=null&&n.bubbleSettings.valuePath!=null&&(c?v=document.createElementNS(f._svgns,"circle"):(g=i.id+"_bubble_"+e,nt='<v:oval class="mapBubble" id='+g+' display="block" style="position:absolute;top: 0px;left:0px;width:100px;height:100px;stroke-width:0px;"><v:fill opacity="0.9"/><\/v:oval>',this._bubblegroup.innerHTML=this._bubblegroup.innerHTML+nt,v=document.getElementById("bubble_"+e)),k=f._reflection(u,n.bubbleSettings.valuePath),tt=f._reflection(u,n.bubbleSettings.colorValuePath),y=this._isTileMap?this._convertTileLatLongtoPoint(u.latitude,u.longitude):this._convertTileLatLongtoPointForShapes(u.latitude,u.longitude,this._mapBounds,this._getFactor()),n._bounds.push({x:isNaN(y.x)?a.x:y.x,y:isNaN(y.y)?a.y:y.y,isMultiBubble:!0}),n.bubbleSettings.colorMappings!=null?n._fillColors(tt,n.bubbleSettings.colorMappings,v,this,r,o,!0):(p=n.bubbleSettings.color,p=p.indexOf(",")?p.split(",")[0]:p,c?v.setAttribute("fill",p):(v.strokecolor=p,v.fillcolor=p)),w=f._getRatioOfBubble(n.bubbleSettings.minValue,n.bubbleSettings.maxValue,k,s,h),c?(t(v).attr({cx:isNaN(y.x)?a.x:y.x,cy:isNaN(y.y)?a.y:y.y,id:i.id+"_bubble_"+dataIndex,"fill-opacity":n.bubbleSettings.bubbleOpacity,r:isNaN(w)?0:w,"class":"mapBubble"}),f.enableAnimation()&&!this._isTileMap&&t(v).css("display","none")):t(v).css({height:2*w+"px",width:2*w+"px"}),n.bubbleSettings.showTooltip==!0?(b=t("<div class='bubbleToolTip'  style='position:absolute;display:none;z-index:9999'/>"),d=null,n.bubbleSettings.tooltipTemplate!=null?d=n.bubbleSettings.tooltipTemplate:t(b).append('<div class="bubbleToolTip"  style="margin-left:10px;margin-top:-25px;"><div class="defaultToolTip"><p style="margin-top:-4px"><label  style="color:rgb(27, 20, 20);font-size:14px;font-weight:normal;font-family:Segoe UI">'+k+"<\/label><\/p><\/div><\/div>"),t(v).mouseenter({htmlobj:b,templateID:d,itemsrc:u},f._bubbleEnterFunction),t(v).mousemove({htmlobj:b},f._bubbleOverFunction),t(v).mouseleave({htmlobj:b},f._bubbleleaveFunction)):t(v).css("pointer-events","none"),c&&l.appendChild(v),n._bubbles.push(v),n._mapItems.push(t("<div><\/div>")))},_renderLayers:function(n,i,f){var ct,lt,ti,vi,fi,vt,ei,ut,yt,pt,w,o,v,l,nt,a,oi,kt,yi,et,pi,dt,tt,g,ht,c,wi,bi,y,ot,st,hi,gt,b,p,ni,d;n._prevPaletteIndex=0;n._initializeLocalValues();n.selectedItems==null&&(n.selectedItems=[]);var nr=this._rootgroup,ci=this._svgDocument,s=this,e=n,ki=n.alternateDataPath||n.alternatePropertyPath,h=e.bubbleSettings,it=[],rt=[],k=[];if(e.dataSource!=null&&h!=null&&h.valuePath!=null)for(h.colorValuePath==null&&h.valuePath!=null&&(h.colorValuePath=h.valuePath.indexOf(",")!=-1?null:h.valuePath),b=0;b<e.dataSource.length;b++)for(g=h.valuePath.split(","),c=0;c<g.length;c++){if(ht=g[c],k[c]=parseFloat(this._reflection(e.dataSource[b],ht)),isNaN(k[c])&&(ct=this._reflection(e.dataSource[b],h.bubblePath),ct))for(k[c]=0,lt=0;lt<ct.length;lt++)ti=parseFloat(this._reflection(ct[lt],ht)),isNaN(ti)||(k[c]+=ti);b!=0?k[c]>rt[c]||rt[c]==null?rt[c]=k[c]:(k[c]<it[c]||it[c]==null)&&(it[c]=k[c]):it[c]=rt[c]=k[c]}if(this._generateTooltipForLayers(e),n._renderedShapes=e.dataSource,e.shapeData!=null){var ii=[],ri,at=e.shapeData,ui="",li=[],ai=[];if(at.features!=null?(ui=new r.DataManager(at.features),ri="geometry.type"):at.geometries!=null&&(ui=new r.DataManager(at.geometries),ri="type"),vi=r.Query().from(e).where(ri,r.FilterOperators.equal,"Point"),fi=ui.executeLocal(vi),e.dataSource!=null)for(vt=0;vt<e.dataSource.length;vt++){for(ei=e.dataSource[vt],ut=s._reflection(ei,e.shapeDataPath),ut!=null&&(ut=ut.toLowerCase()),yt="",pt=0;pt<fi.length;pt++)if(yt=fi[pt].properties[e.shapePropertyPath].toLowerCase(),yt==ut&&h.showBubble){ai.push(ei);li.push(yt);break}ii.push(ut)}for(w=0;w<e._polygonData.length;w++){var ft=e._polygonData[w].properties,wt=s._reflection(ft,e.shapePropertyPath),bt,tr=e.bubbleSettings.colorPath;if(wt!=null&&typeof wt=="string"&&(bt=wt.toLowerCase()),o=this._rootgroup.childNodes[w+i],_isSVG?o.setAttribute("fill",e.shapeSettings.fill):(o.fillcolor=e.shapeSettings.fill,o.strokecolor=e.shapeSettings.stroke),v={},l=e._newBounds[w],l==null&&(l={x:0,y:0}),e.shapeSettings.autoFill)switch(e.shapeSettings.colorPalette){case r.datavisualization.Map.ColorPalette.Palette1:this._generatePaletteColorsForShape(o,e,e.colorPalettes.Palette1,e._colorPaletteSettings.Palette1);break;case r.datavisualization.Map.ColorPalette.Palette2:this._generatePaletteColorsForShape(o,e,e.colorPalettes.Palette2,e._colorPaletteSettings.Palette2);break;case r.datavisualization.Map.ColorPalette.Palette3:this._generatePaletteColorsForShape(o,e,e.colorPalettes.Palette3,e._colorPaletteSettings.Palette3);break;case r.datavisualization.Map.ColorPalette.CustomPalette:this._generatePaletteColorsForShape(o,e,e.shapeSettings.customPalette,null)}if(nt=ii.indexOf(bt),nt=nt<0&&ki?e._checkAlternatePath(e,ft,bt,ii):nt,nt!==!1&&nt!=-1&&(a=e.dataSource[nt],oi=wt,a.shape=o,a.shapeIndex=w,a._showBubble=!0,a!=null)){if(o!=null&&(kt=oi),yi=ai[li.indexOf(bt)],yi&&l.x==0&&l.y==0&&(l.x=parseFloat(t(o).attr("cx")),l.y=parseFloat(t(o).attr("cy"))),n._bounds.push(l),e.showMapItems&&(et=t("<div class='mapItems' style='display:block;position:absolute;pointer-events: none;'><\/div>"),et[0].className=oi,s._templateDiv.append(et),t(et).css({left:l.x,top:l.y}),pi=e.mapItemsTemplate==null?t(" <div><label>{{:"+e.shapeSettings.valuePath+"}}<\/label><\/div>").render(a):t("#"+e.mapItemsTemplate).render(a),t(et).html(pi),n._mapItems.push(et)),dt=s._reflection(a,e.shapeSettings.colorValuePath),tt=r.util.isNullOrUndefined(e.shapeSettings.shapeFillColor)?e.shapeSettings.fill:e.shapeSettings.shapeFillColor,e.shapeSettings.colorMappings!=null||e.shapeSettings.colorPath?(e.shapeSettings.colorValuePath==null&&(e.shapeSettings.colorValuePath=e.shapeSettings.valuePath),dt==null||e.shapeSettings.autoFill||((e.legendSettings!=null&&e.legendSettings.mode==r.datavisualization.Map.LegendMode.Interactive||e.shapeSettings.enableGradient)&&e.shapeSettings.colorMappings.rangeColorMapping!=null?(v.legendrect=e._updateLegendRange(dt,e,o,a),v.legendrect!=u&&(tt=v.legendrect.color),_isSVG?o.setAttribute("fill",tt):o.fillcolor=tt):(r.util.isNullOrUndefined(e.shapeSettings.shapeFillColor)||(_isSVG?o.setAttribute("fill",tt):o.fillcolor=tt),e._fillColors(dt,e.shapeSettings.colorMappings,o,f,a,ft)))):e.shapeSettings.autoFill||(_isSVG?o.setAttribute("fill",tt):(o.fillcolor=tt,o.strokecolor=e.shapeSettings.stroke)),h.showBubble&&h!=null&&h.valuePath!=null)for(g=this.sortbyRadius(h,it,rt,a,h.valuePath.split(",")),c=0;c<g.length;c++){c!=0&&n._bounds.push(l);ht=g[c].valuePath;_isSVG?y=document.createElementNS(s._svgns,"circle"):(wi=o.id+"_bubble_"+kt,bi='<v:oval class="mapBubble" id='+wi+' display="block" style="position:absolute;top: 0px;left:0px;width:100px;height:100px;stroke-width:0px;"><v:fill opacity="0.9"/><\/v:oval>',this._bubblegroup.innerHTML=this._bubblegroup.innerHTML+bi,y=document.getElementById("bubble_"+kt));var di=g[c].bubbleValue,gi=s._reflection(a,h.colorPath||h.colorValuePath),si=h.color.indexOf(",")?h.color.split(",")[c]:h.color;if(_isSVG?y.setAttribute("fill",si):(y.strokecolor=si,y.fillcolor=si),(h.colorMappings!=null||h.colorPath!=null)&&e._fillColors(gi,h.colorMappings,y,this,e.dataSource[nt],ft,!0),ot=g[c].radius,_isSVG?(t(y).attr({cx:l.x,cy:l.y,id:o.id+"_bubble_"+w,"fill-opacity":h.bubbleOpacity,r:isNaN(ot)?0:ot,"class":"mapBubble"}),s.enableAnimation()&&!this._isTileMap&&t(y).css("display","none")):t(y).css({height:2*ot+"px",width:2*ot+"px"}),h.showTooltip==!0?(st=t("<div class='bubbleToolTip'  style='position:absolute;display:none;z-index:9999'/>"),hi=null,h.tooltipTemplate!=null?hi=h.tooltipTemplate:t(st).append('<div class="bubbleToolTip"  style="margin-left:10px;margin-top:-25px;"><div class="defaultToolTip"><p style="margin-top:-4px"><label  style="color:rgb(27, 20, 20);font-size:14px;font-weight:normal;font-family:Segoe UI">'+di+"<\/label><\/p><\/div><\/div>"),t(y).mouseenter({htmlobj:st,templateID:hi,itemsrc:a},s._bubbleEnterFunction),t(y).mousemove({htmlobj:st},s._bubbleOverFunction),t(y).mouseleave({htmlobj:st},s._bubbleleaveFunction)):t(y).css("pointer-events","none"),_isSVG?(ci.appendChild(y),n._bubbles.push(y)):n._bubbles.push(y),a[h.bubblePath]!=null)for(gt=a[h.bubblePath],b=0;b<gt.length&&gt[b];b++)this._drawCustomBubble(n,o,a,gt[b],s,kt,ft,it[c],rt[c],_isSVG,ci,l)}v.data=a}n.labelSettings!=null&&n.labelSettings.showLabels&&n.labelSettings.labelPath!=null&&e.geometryType!=r.datavisualization.Map.GeometryType.Normal&&(ni=s._reflection(ft,n.labelSettings.labelPath),ni!=null&&(l==null,p=t("<div class='labelStyle'id='"+this._id+"labelStyle_"+w+"'><\/div>"),t(p).css({"pointer-events":"none",position:"absolute"}),p[0].innerHTML=ni,this._templateDiv.append(p),n.legendSettings.showLegend&&n.legendSettings.dockOnMap&&n.legendSettings.dockPosition=="top"?t(this._templateDiv).css({"margin-top":this._margintop}):n.legendSettings.showLegend&&n.legendSettings.dockOnMap&&n.legendSettings.dockPosition=="left"&&t(this._templateDiv).css({"margin-left":this._marginleft}),t(p).css({left:l.x,top:l.y}),s._off(t(p),r.eventType.mouseUp,s._polyClickFunction),s._on(t(p),r.eventType.mouseUp,{Param1:null,Param2:n,Param3:o},s._polyClickFunction),s._off(t(p),r.eventType.mouseLeave,s._polyLeaveFunction),s._on(t(p),r.eventType.mouseLeave,{Param1:n,map:this},s._polyLeaveFunction),p[0].setAttribute("nodeValue",o.getAttribute("fill")),n._labelCollection.push(p),n._labelBounds.push(l),n._labelData.push(ni)));v.shapeIndex=w;v.shape=o;v.shapeData=n._polygonData[w];s._off(t(p),r.eventType.mouseMove,s._polyMoveFunction);s._on(t(p),r.eventType.mouseMove,{Param1:e,Param2:v},s._polyMoveFunction);o!=null&&(d=null,_isSVG?(d=o.getAttribute("fill"),d=="undefined"&&(d=n.shapeSettings.fill),o.setAttribute("nodeValue",d)):(d=o.fillcolor.value,d=="undefined"&&(d=n.shapeSettings.fill),o.style.behavior=d));s.enableZoomOnSelection()&&t(o).hover(function(){t(this).css("cursor","pointer")},function(){t(this).css("cursor","auto")});n._mapShapes.push(v);t(o).mouseenter({Param1:e,Param2:v,map:s},s._polyEnterFunction);this._off(t(o),r.eventType.mouseDown,s._polyMouseDown);this._on(t(o),r.eventType.mouseDown,{Param1:v,Param2:e},s._polyMouseDown);this._off(t(o),r.eventType.mouseUp,s._polyClickFunction);this._on(t(o),r.eventType.mouseUp,{Param1:v,Param2:e,Param3:o},s._polyClickFunction);this._off(t(o),r.eventType.mouseMove,s._polyMoveFunction);this._on(t(o),r.eventType.mouseMove,{Param1:e,Param2:v},s._polyMoveFunction);this._off(t(o),r.eventType.mouseLeave,s._polyLeaveFunction);this._on(t(o),r.eventType.mouseLeave,{Param1:e,Param2:v,map:this},s._polyLeaveFunction);this._off(t(o),r.eventType.mouseUp,s._polyUpFunction);this._on(t(o),r.eventType.mouseUp,{Param1:v,Param2:e,Param3:o},s._polyUpFunction);w==0&&(this._legendDiv==null&&(this._legendDiv=t("<div class='LegendDiv'/>")),e.legendSettings!=null&&(e.shapeSettings.colorMappings!=null||e.shapeSettings.colorPath!=null)&&(e.legendSettings.type==u||e.legendSettings.type==r.datavisualization.Map.LegendType.Layers)&&e._generateLegends(this),this.model.enableRTL&&e.shapeSettings.colorMappings&&e.shapeSettings.colorMappings.rangeColorMapping?e.shapeSettings.colorMappings.rangeColorMapping.reverse():this.model.enableRTL&&e.shapeSettings.colorMappings&&e.shapeSettings.colorMappings.equalColorMapping&&e.shapeSettings.colorMappings.equalColorMapping.reverse(),e.legendSettings!=null&&(h.colorMappings!=null||h.colorPath!=null)&&e.legendSettings.type==r.datavisualization.Map.LegendType.Bubbles&&e._generateBubbleLegends(this),e.shapeSettings.colorMappings!=null&&e.shapeSettings.colorMappings.rangeColorMapping!=null&&e.shapeSettings.colorMappings.rangeColorMapping.sort(this._orderByNameAscending),h.colorMappings!=null&&h.colorMappings.rangeColorMapping!=null&&h.colorMappings.rangeColorMapping.sort(this._orderByNameAscending))}}e._isBaseLayer&&e.geometryType==r.datavisualization.Map.GeometryType.Normal&&e.labelSettings.showLabels&&(e._generateLabels(this),e._labelSizeCalculation(this),this._applyTransform(this._scale,this._translatePoint))},sortbyRadius:function(n,t,i,r,u){for(var e=[],o,s,f=0;f<u.length;f++)o=this._reflection(r,u[f]),s=this._getRatioOfBubble(n.minValue,n.maxValue,o,t[f],i[f]),e.push({valuePath:u[f],radius:s,bubbleValue:o});return e.sort(function(n,t){return t.radius-n.radius}),e},validateBubblePosition:function(n,t,i){var e=[],o=[],f,u,r;if(i=parseFloat(i),!this.isPointInPolygon(n,t,!0)){for(f=0,r=0;r<n.length;r++)u={x:(n[r].x+this._translatePoint.x)*this._scale,y:(n[r].y+this._translatePoint.y)*this._scale},(u.y<t.y&&f.y>=t.y||f.y<t.y&&u.y>=t.y)&&(u.x<t.x?e.push(u.x):o.push(u.x)),f=u;(!e.length>0||!o.length>0)&&(e.length>0&&(r=t.x+i,this.isPointInPolygon(n,{x:r-2,y:t.y},!0)||(r=r-2),t.x=parseFloat(r-2-i)),o.length>0&&(r=t.x-i,this.isPointInPolygon(n,{x:r+2,y:t.y},!0)||(r=r+2),t.x=parseFloat(r+2+i)))}return t},isPointInPolygon:function(n,t,i){var o,r,e,u,f;if(n==null)return!0;for(o=!1,u=0,f=n.length-1;u<n.length;f=u++)r={x:n[u].x,y:n[u].y},e={x:n[f].x,y:n[f].y},i&&(r={x:(n[u].x+this._translatePoint.x)*this._scale,y:(n[u].y+this._translatePoint.y)*this._scale},e={x:(n[f].x+this._translatePoint.x)*this._scale,y:(n[f].y+this._translatePoint.y)*this._scale}),r.y>t.y!=e.y>t.y&&t.x<(e.x-r.x)*(t.y-r.y)/(e.y-r.y)+r.x&&(o=!o);return o},dragDown:function(n){var r=n.data.map,t=r.model.layers[0],i=this._mapContainer,u;if(n.type=="mousedown"?(r._startPoint={x:n.pageX-i[0].offsetLeft,y:n.pageY-i[0].offsetTop},r._stopPoint={x:n.pageX-i[0].offsetLeft,y:n.pageY-i[0].offsetTop}):n.type=="touchstart"?(r._startPoint={x:n.originalEvent.changedTouches[0].pageX-i[0].offsetLeft,y:n.originalEvent.changedTouches[0].pageY-i[0].offsetTop},r._stopPoint={x:n.originalEvent.changedTouches[0].pageX-i[0].offsetLeft,y:n.originalEvent.changedTouches[0].pageY-i[0].offsetTop}):n.type=="MSPointerDown"&&(r._startPoint={x:n.originalEvent.pageX-i[0].offsetLeft,y:n.originalEvent.pageY-i[0].offsetTop},r._stopPoint={x:n.originalEvent.pageX-i[0].offsetLeft,y:n.originalEvent.pageY-i[0].offsetTop}),r.mouseClickable=!0,r.model.draggingOnSelection&&t._prevSelectedShapes.length>0){for(u=0;u<t._prevSelectedShapes.length;u++)t._prevSelectedShapes[u].setAttribute("class","mapShape"),_isSVG?(t._prevSelectedShapes[u].setAttribute("fill",t._prevSelectedShapes[u].getAttribute("nodeValue")),t._prevSelectedShapes[u].setAttribute("stroke",t.shapeSettings.stroke),t._prevSelectedShapes[u].setAttribute("stroke-width",t.shapeSettings.strokeThickness/this._scale)):(t.fillcolor=t._prevSelectedShapes[u].getAttribute("nodeValue"),t.strokecolor=t.shapeSettings.stroke,t.strokeweight=t.shapeSettings.strokeThickness/this._scale);t._prevSelectedShapes=[]}},dragMove:function(n){var i=n.data.map,o=i.model.layers[0],f,e,r=this._mapContainer,u;i.model.draggingOnSelection&&i.mouseClickable&&(i.ispanning=!1,n.type=="mousemove"?i._stopPoint={x:n.pageX-r[0].offsetLeft,y:n.pageY-r[0].offsetTop}:n.type=="touchmove"?i._stopPoint={x:n.originalEvent.changedTouches[0].pageX-r[0].offsetLeft,y:n.originalEvent.changedTouches[0].pageY-r[0].offsetTop}:n.type=="MSPointerMove"&&(i._stopPoint={x:n.originalEvent.pageX-r[0].offsetLeft,y:n.originalEvent.pageY-r[0].offsetTop}),t(".e-mapDragSelection").remove(),u=t('<div class = "e-mapDragSelection"><\/div>'),f=Math.abs(i._stopPoint.x-i._startPoint.x),e=Math.abs(i._stopPoint.y-i._startPoint.y),t(u).css({top:Math.min(i._startPoint.y,i._stopPoint.y),left:Math.min(i._startPoint.x,i._stopPoint.x),width:f,height:e,position:"absolute","z-index":100}),t(u).appendTo("#maps"))},dragUp:function(n){var i=n.data.map,s=Math.abs(i._stopPoint.x-i._startPoint.x),h=Math.abs(i._stopPoint.y-i._startPoint.y),e=i.model.layers[0],o=this._mapContainer,u,r,f;if(i.model.draggingOnSelection){for(t(".e-mapDragSelection").remove(),t(".e-mapDragSelection").css({display:"none"}),i.mouseClickable=!1,u=0;u<i.model.layers[0]._mapShapes.length;u++)r=i.model.layers[0]._mapShapes[u].shape,f=r.getBoundingClientRect(),f.left-o[0].offsetLeft+f.width<Math.min(i._startPoint.x,i._stopPoint.x)||Math.min(i._startPoint.x,i._stopPoint.x)+s<f.left-o[0].offsetLeft||f.top-o[0].offsetTop+f.height<Math.min(i._startPoint.y,i._stopPoint.y)||Math.min(i._startPoint.y,i._stopPoint.y)+h<f.top-o[0].offsetTop||i.model.layers[0]._contains(e._prevSelectedShapes,r)||e._prevSelectedShapes.push(r);for(u=0;u<e._prevSelectedShapes.length;u++)r=e._prevSelectedShapes[u],f=r.getBoundingClientRect(),r.removeSelectionCSS||r.setAttribute("class","e-mapSelectedShape mapShape"),_isSVG&&(r.setAttribute("fill",e.shapeSettings.selectionColor),r.setAttribute("stroke",e.shapeSettings.selectionStroke),r.setAttribute("stroke-width",e.shapeSettings.selectionStrokeWidth/i._scale))}},isIntersectBubbles:function(){for(var r,n,i,t=[],u=0;u<this.model.layers.length;u++)for(r=this.model.layers[u],Array.prototype.push.apply(t,r._bubbleCollection),n=0;n<r.subLayers.length;n++)Array.prototype.push.apply(t,r.subLayers[n]._bubbleCollection);for(n=0;n<t.length;n++){var f=t[n].getAttribute("cx"),e=t[n].getAttribute("cy"),h=t[n].getAttribute("r");for(i=n+1;i<t.length;i++){var o=t[i].getAttribute("cx"),s=t[i].getAttribute("cy"),c=t[i].getAttribute("r"),l=Math.sqrt((f-o)*(f-o)+(e-s)*(e-s)),a=parseFloat(h)+parseFloat(c);if(l<=a)return!0}}return!1},_zooming:function(n,t){var i=this._getCurrentPoint(t);n>=120?this._zoomingIn(i.x,i.y,t):this._zoomingOut(i.x,i.y,t)},_zoomingIn:function(n,t,i){var r=this,f,e,u;r.enableZoom()&&r.zoomLevel()>=r.minZoom()&&r.zoomLevel()<=r.maxZoom()&&(f=r._scale,e={x:n,y:t},r._prevScale=f,this._isTileMap?(this._tileZoom(r.zoomLevel()-r.zoomFactor(),r.zoomLevel(),e),u=r.zoomLevel(),r.zoomLevel(r.zoomLevel()+r.zoomFactor()),this._generateTiles(this.zoomLevel()),r._translatePoint.x=(r._tileTranslatePoint.x-.5*Math.pow(2,u))/Math.pow(2,u),r._translatePoint.y=(r._tileTranslatePoint.y-.5*Math.pow(2,u))/Math.pow(2,u),r._scale=Math.pow(2,u)):(r._prevPoint={x:r._translatePoint.x,y:r._translatePoint.y},r._translatePoint.x-=(r._width/r._scale-r._width/(r._scale+r.zoomFactor()))/(r._width/n),r._translatePoint.y-=(r._height/r._scale-r._height/(r._scale+r.zoomFactor()))/(r._height/t),r._scale=f+r.zoomFactor(),r.zoomLevel(r.zoomLevel()+r.zoomFactor())),r._trigger("zoomedIn",{originalEvent:i,zoomLevel:r.zoomLevel()}),r._applyTransform(r._scale,r._translatePoint),r._refrshLayers(),r._resizeShape(),r._updateSliderValue())},_zoomingOut:function(n,t,i){var r=this,u,f,e;r.enableZoom()&&(r.zoomLevel()>this.minZoom()?(u=r._scale,f={x:n,y:t},r._prevScale=u,r._isTileMap?(r._tileZoom(r.zoomLevel()+r.zoomFactor(),r.zoomLevel(),f),e=r.zoomLevel(),r.zoomLevel(r.zoomLevel()-r.zoomFactor()),r._generateTiles(r.zoomLevel()),r._translatePoint.x=(r._tileTranslatePoint.x-.5*Math.pow(2,r.zoomLevel()-r.zoomFactor()))/Math.pow(2,r.zoomLevel()-r.zoomFactor()),r._translatePoint.y=(r._tileTranslatePoint.y-.5*Math.pow(2,r.zoomLevel()-r.zoomFactor()))/Math.pow(2,r.zoomLevel()-r.zoomFactor()),r._scale=Math.pow(2,r.zoomLevel()-r.zoomFactor())):r._scale>1&&(r._prevPoint={x:r._translatePoint.x,y:r._translatePoint.y},r._translatePoint.x-=(r._width/r._scale-r._width/(r._scale-r.zoomFactor()))/(r._width/n),r._translatePoint.y-=(r._height/r._scale-r._height/(r._scale-r.zoomFactor()))/(r._height/t),r._scale=r._scale-r.zoomFactor(),r.zoomLevel(r.zoomLevel()-r.zoomFactor())),r.zoomLevel()<r.minZoom()&&(r.zoomLevel(r.minZoom()),r.zoom(r.zoomLevel())),r._applyTransform(r._scale,r._translatePoint),r._refrshLayers(),r._resizeShape(),r._updateSliderValue()):r.zoom(r.minZoom(),!1),r._trigger("zoomedOut",{originalEvent:i,zoomLevel:r.zoomLevel()}))},_getRatioOfBubble:function(n,t,i,r,u){var f=Math.max(Math.abs(i-r),1),e=Math.max(Math.abs(u-r),1),o=f/e;return bubbleRadius=t*o,bubbleRadius<n&&i!=null?bubbleRadius=n:bubbleRadius>t&&(bubbleRadius=t),bubbleRadius},_reflection:function(n,i){var r=n,f,e,o;if(i!=null&&n!=null){for(f=i.split("."),e=0,f.push(i);e<f.length;e++)n!=u&&r!=null&&(o=r.hasOwnProperty(f[e]),o&&t.each(r,function(n,t){if(n==f[e])return r=t,!1}));return r}return null},clearShapeSelection:function(){var t=this.baseMapIndex(),n;for(this.model.layers[t]._clearShapeWidth(this._scale),n=0;n<this.model.layers[t].subLayers.length;n++)this.model.layers[t].subLayers[n]._clearShapeWidth(this._scale)},shapeSelectionOnResize:function(){var t=this.baseMapIndex(),n;for(this.model.layers[t]._shapeSelection(),n=0;n<this.model.layers[t].subLayers.length;n++)this.model.layers[t].subLayers[n]._shapeSelection()},refreshMarkers:function(){var t=this.baseMapIndex(),n;for(this.model.layers[t]._generateMarkerForLayers(this),n=0;n<this.model.layers[t].subLayers.length;n++)this.model.layers[t].subLayers[n]._generateMarkerForLayers(this)},_generateTooltipForLayers:function(n){var i,r,u;n.showTooltip&&(i=document.documentMode==8?document.querySelectorAll("shapeToolTip"):document.getElementsByClassName("shapeToolTip"),i!=null&&i.length==0?(r=t("<div class='shapeToolTip' style='display:none;position:absolute;z-index:1000;pointer-events:none;'><\/div>"),t(document.body).append(r),n._tooltipElement=r):n._tooltipElement=i[0],n.tooltipTemplate==null&&(u=n.shapeSettings.valuePath,u!=null&&(n.tooltipTemplate="defaultTooltip",this._mapContainer.append(t('<div  id="defaultTooltip" style="display:none;"><div style="margin-left:10px;margin-top:-25px;"><div class="defaultToolTip"><p style="margin-top:-4px"><label  style="color:rgb(27, 20, 20);font-size:14px;font-weight:normal;font-family:Segoe UI">{{:#data["'+u+'"]}}<\/label><\/p><\/div><\/div><\/div>')))))},_orderByNameAscending:function(n,t){return n.Range==t.Range?0:n.Range>t.Range?1:-1},_resizingContainer:function(){this._scale=this._isTileMap?Math.pow(2,this.zoomLevel()-1):1;this._isTileMap?(this._translatePoint.x=this._tileTranslatePoint.x/this._scale,this._translatePoint.y=this._tileTranslatePoint.y/this._scale):(this._translatePoint.x=this._tileTranslatePoint.x/this._scale,this._translatePoint.y=this._tileTranslatePoint.y/this._scale);this._applyTransform(this._scale,this._translatePoint);this.zoomLevel()>1&&(this._scale=this._isTileMap?Math.pow(2,this.zoomLevel()-this.zoomFactor()):this.zoomLevel(),this._applyTransform(this._scale,this._previosTranslatePoint));this._baseScale=1;this._baseTranslatePoint={x:this._translatePoint.x*2,y:this._translatePoint.y*2}},_calculateMarginConditions:function(){var n=this._calculateMinMax();this._translatePoint.y>n.maxY?this._translatePoint.y=n.maxY:this._translatePoint.y<n.minY&&(this._translatePoint.y=n.minY);this._translatePoint.x>n.maxX?this._translatePoint.x=n.maxX:this._translatePoint.x<n.minX&&(this._translatePoint.x=n.minX)},_calculateMinMax:function(){var n=this._groupBorder,t,i,r,u;return this._containerHeight*this._scale<=this._height?(i=(this._height-this._containerHeight*this._scale)/(2*this._scale)-n.y,u=(this._height-this._containerHeight*this._scale)/(2*this._scale)-n.y):(i=-n.y+1,u=(this._height-this._containerHeight*this._scale)/this._scale-n.y-1),this._containerWidth*this._scale<=this._width?(t=(this._width-this._containerWidth*this._scale)/(2*this._scale)-n.x,r=(this._width-this._containerWidth*this._scale)/(2*this._scale)-n.x):(t=-n.x+1,r=(this._width-this._containerWidth*this._scale)/this._scale-n.x-1),{minX:r,maxX:t,minY:u,maxY:i}},_findMidPointofPoylgon:function(n,t){var e,r,i,tt,f;if(n.length>0){if(e=0,r=0,t.centerX==u&&t.centerY==u){var ut=0,k=n.length,o=n[0],v=o.x,d=o.x,y=o.y,g=o.y,l,a,s,h,c=0,nt;for(f=ut;f<=k-1;f++)nt=n[f],l=nt.x,a=nt.y,f==k-1?(s=o.x,h=o.y):(tt=n[f+1],s=tt.x,h=tt.y),c=c+Math.abs(l*h-s*a),e=e+Math.abs((l+s)*(l*h-s*a)),r=r+Math.abs((a+h)*(l*h-s*a));c=.5*c;e=1/(4*c)*e;r=1/(4*c)*r}else{for(var ft=n.length,p=Number.MAX_VALUE,d=-p,v=p,g=-p,y=p;ft--;)i=n[ft],d=Math.max(d,i.x),v=Math.min(v,i.x),g=Math.max(g,i.y),y=Math.min(y,i.y);e=v+(d-v)*(t.centerX!=u?t.centerX:.5);r=y+(g-y)*(t.centerY!=u?t.centerY:.5)}var it={x:0,y:0},w={x:0,y:0},rt={x:0,y:0},b={x:0,y:0};for(f=ut;f<=k-1;f++)i=n[f],i.x>e?i.y<r&&r-i.y<r-it.y?it={x:i.x,y:i.y}:i.y>r&&(w.y==0||i.y-r<w.y-r)&&(w={x:i.x,y:i.y}):i.y<r&&r-i.y<r-rt.y?rt={x:i.x,y:i.y}:i.y>r&&(b.y==0||i.y-r<b.y-r)&&(b={x:i.x,y:i.y});return{x:e,y:r,rightMin:it,rightMax:w,leftMin:rt,leftMax:b,points:n}}},_convertPointToLatLong:function(n,t,i,r){var u,f,e;return i==null&&(i=[[-180,-85],[180,85]]),u=this._isTileMap?Math.pow(2,1)*256:r==null?Math.min(this._height,this._width):Math.min(this._height,this._width)*r,f=Math.min(n,0,u-1)/u-.5,e=.5-Math.min(t,0,u-1)/u,latitude=90-360*Math.atan(Math.exp(-e*2*Math.PI))/Math.PI,longitude=360*f,{x:latitude,y:longitude}},_convertTileLatLongtoPointForShapes:function(n,t,i,r){var u,s,f,h,e,o;return i==null&&(i=[[-180,-85],[180,85]]),u=this._isTileMap?Math.pow(2,1)*256:r==null?Math.min(this._height,this._width):Math.min(this._height,this._width)*r,s=(t+180)/360,f=Math.sin(n*Math.PI/179.5),f==-1&&(f=-.5),h=.5-Math.log((1+f)/(1-f))/(4*Math.PI),this._isMapCoordinates?(e=Math.min(Math.max(s*u+.5,0),u-1),o=Math.min(Math.max(h*u+.5,0),u-1)):r!=null?(e=Math.abs((t-this._mapBounds[0][0])*r),o=Math.abs((this._mapBounds[1][1]-n)*r)):(e=t,o=n),{x:e,y:o}},_convertTileLatLongtoPoint:function(n,t){var u=Math.pow(2,this.zoomLevel())*256,e=(t+180)/360,f=Math.sin(n*Math.PI/180),o=.5-Math.log((1+f)/(1-f))/(4*Math.PI),i,r;return this._isMapCoordinates?(i=e*u+.5+this._tileTranslatePoint.x,r=o*u+.5+this._tileTranslatePoint.y):factor!=null?(i=Math.abs((t-this._mapBounds[0][0])*factor),r=Math.abs((this._mapBounds[1][1]-n)*factor)):(i=t,r=n),{x:i,y:r}},_convertLatLongtoPointforMarker:function(n,t){var r=this._getFactor(),i=this._convertTileLatLongtoPointForShapes(n,t,this._mapBounds,r);return{x:(i.x+this._translatePoint.x)*this._scale,y:(i.y+this._translatePoint.y)*this._scale}},_animate:function(n){function s(n,t){return n[0]==t[0]?null:(t[1]-n[1])/(t[0]-n[0])}function h(n,t){return t===null?n[0]:n[1]-t*n[0]}this._calculateMarginConditions();t(this._rootgroup).stop(!0,!1);this._sliderControl!=null&&t(this._sliderControl).stop(!0,!1);var i=this,e={x:this._translatePoint.x,y:this._translatePoint.y},r=[this._prevPoint.x,this._prevPoint.y],u=[this._translatePoint.x,this._translatePoint.y];var f=s(r,u),c=h(r,f),l=u[0]-r[0],a=u[1]-r[1],v=this._scale-this._prevScale,o=this._scale;this._updateSliderValue();t(this._rootgroup).animate({count:10},{duration:n,step:function(n,t){var u=i._prevScale+n*(v/t.end),e=r[0]+n*(l/t.end)/(u/o),s;s=f==null?r[1]+n*(a/t.end):f*e+c;_isSVG?(u<1&&(u=1,e=i._initialTransform.x,s=i._initialTransform.y),i._rootgroup.setAttribute("transform","scale("+u+") translate("+e+", "+s+")")):(i._rootgroup.coordorigin=-e+","+-s,i._rootgroup.coordsize=i._width/u+","+i._height/u);i._translatePoint.x=e;i._translatePoint.y=s;i._scale=u;i._refrshLayers();i._resizeShape()},complete:function(){i._translatePoint.x=e.x;i._translatePoint.y=e.y;i._scale=o;this.count=0}})},_applyTransform:function(n,t){this._scale=n;this._translatePoint=t;this._isTileMap||this._calculateMarginConditions();this._translatePoint.x!=Number.POSITIVE_INFINITY&&this._translatePoint.y!=Number.POSITIVE_INFINITY&&(_isSVG?(this._rootgroup.setAttribute("transform","scale("+this._scale+") translate("+this._translatePoint.x+", "+this._translatePoint.y+")"),this._initialTransform={x:this._translatePoint.x,y:this._translatePoint.y}):(this._rootgroup.coordorigin=-this._translatePoint.x+","+-this._translatePoint.y,this._rootgroup.coordsize=this._width/n+","+this._height/n))},_mouseMove:function(n){var t,i,f,e,r,u;n.type=="touchmove"&&n.originalEvent.touches.length>1?this._isPinching=!0:(t=this,t.ispanning&&t.enablePan()&&(n.preventDefault(),n.type=="mousemove"?i={x:n.pageX,y:n.pageY}:n.type=="touchmove"?i={x:n.originalEvent.changedTouches[0].pageX,y:n.originalEvent.changedTouches[0].pageY}:n.type=="MSPointerMove"&&(i={x:n.originalEvent.pageX,y:n.originalEvent.pageY}),this._isTileMap&&(f=this._tileTranslatePoint.x-(this._dragStartX-i.x),e=this._tileTranslatePoint.y-(this._dragStartY-i.y),this._tileTranslatePoint.x=f,this._tileTranslatePoint.y=e,this._generateTiles(this.zoomLevel())),r=t._translatePoint.x-(t._dragStartX-i.x)/t._scale,u=t._translatePoint.y-(t._dragStartY-i.y)/t._scale,(r!=t._translatePoint.x||u!=t._translatePoint.y)&&(t._isDragging=!0),this._translatePoint.x=r,this._translatePoint.y=u,t._applyTransform(t._scale,t._translatePoint),t._dragStartX=i.x,t._dragStartY=i.y,t._refrshLayers()))},_svgMouseLeave:function(){var n=this;n.ispanning=!1},_mouseWheel:function(n){if(this.enableZoom()){this.enableAnimation()&&t(this._rootgroup).stop(!0,!1);var i=n.originalEvent,r=n;_isSVG||(i=n);n.target.className!="LegendDiv"&&n.target.className!="e-defaultLegendLabel"&&(i.preventDefault?i.preventDefault():r.preventDefault(),_isSVG?this._zooming(n.originalEvent.wheelDelta,n.originalEvent):this._zooming(n.originalEvent.wheelDelta,i))}},_mouseButtonUp:function(n){var t=this;t.ispanning&&t._trigger("panned",{originalEvent:n});t.ispanning=!1},_mouseUp:function(){this.ispanning=!1;this._isDragging=!1},_mapClick:function(n){var r,i,t;if(this.model.click!=""&&(i={model:this.model,data:{event:n}},this._trigger("click",i)),this.model.layers[this.baseMapIndex()].legendSettings.toggleVisibility)for(this.model.layers[this.baseMapIndex()]._legendToggleVisibility(this.model.layers[this.baseMapIndex()],n,this),t=0;t<this.model.layers[this.baseMapIndex()].subLayers.length;t++)this.model.layers[this.baseMapIndex()].subLayers[t]._legendToggleVisibility(this.model.layers[this.baseMapIndex()].subLayers[t],n,this);this.model.doubleClick!=""&&(r=new Date,this._doubleTapTimer!=null&&r-this._doubleTapTimer<300&&(i={model:this.model,data:{event:n}},this._trigger("doubleClick",i)),this._doubleTapTimer=r)},_mouseButtonDown:function(n){var i,r;this._isPinching=!1;n.target.className!="e-vhandle"&&(this._isNavigationPressed=!1,this.enableAnimation()&&(t(this._rootgroup).stop(!0,!1),this._sliderControl!=null&&t(this._sliderControl).stop(!0,!1)),n.type=="touchstart"&&n.originalEvent.touches.length>1||(this.model.doubleClick!=""?window.setTimeout(n.preventDefault,10):n.preventDefault(),n.type=="mousedown"?i={x:n.pageX,y:n.pageY}:n.type=="touchstart"?i={x:n.originalEvent.changedTouches[0].pageX,y:n.originalEvent.changedTouches[0].pageY}:n.type=="MSPointerDown"&&(i={x:n.originalEvent.pageX,y:n.originalEvent.pageY}),r=this,r.ispanning=!0,r._dragStartX=i.x,r._dragStartY=i.y))},_getCurrentPoint:function(n){var t=this._mapContainer,i=n.pageX-t.offset().left,r=n.pageY-t.offset().top;return{x:i,y:r}},_legendDoubleClick:function(n){for(var t=n.target;t.parentNode!=null&&t.parentNode.className!="ScrollLegendDiv e-scroller e-js e-widget";)t=t.parentNode;t.parentNode!=null&&t.parentNode.className=="ScrollLegendDiv e-scroller e-js e-widget"&&(this._isNavigationPressed=!0)},_doubleClick:function(n){var t=this,f=t.zoomLevel(),r,u,i;t._legendDoubleClick(n);this._isNavigationPressed||n.target.className.toString().indexOf("e-icon1")!=-1||(r=this._getCurrentPoint(n),t.enableZoom()&&t.zoomLevel()+t.zoomFactor()>=t.minZoom()&&t.zoomLevel()+t.zoomFactor()<=t.maxZoom()&&(u=t._scale,t._prevScale=u,this._isTileMap?(this._tileZoom(t.zoomLevel()-t.zoomFactor(),t.zoomLevel(),r),i=t.zoomLevel(),t.zoomLevel(t.zoomLevel()+t.zoomFactor()),this._generateTiles(this.zoomLevel()),t._translatePoint.x=(t._tileTranslatePoint.x-.5*Math.pow(2,i))/Math.pow(2,i),t._translatePoint.y=(t._tileTranslatePoint.y-.5*Math.pow(2,i))/Math.pow(2,i),t._scale=Math.pow(2,i)):(t._prevPoint={x:t._translatePoint.x,y:t._translatePoint.y},t._translatePoint.x-=(t._width/t._scale-t._width/(t._scale+t.zoomFactor()))/(t._width/r.x),t._translatePoint.y-=(t._height/t._scale-t._height/(t._scale+t.zoomFactor()))/(t._height/r.y),t._scale=u+t.zoomFactor(),t.zoomLevel(t.zoomLevel()+t.zoomFactor())),f<t.zoomLevel()&&t._trigger("zoomedIn",{originalEvent:null,zoomLevel:t.zoomLevel()}),t.enableAnimation()&&!this._isTileMap?t._animate(600):(t._applyTransform(t._scale,t._translatePoint),t._refrshLayers(),t._resizeShape()),t._updateSliderValue()))},_tileZoom:function(n,t,i){var c=this,r;if(t>0&&t<20){this._tileDiv.html("");r=Math.pow(2,n)*256;i==u&&(i={x:this._width/2,y:this._height/2});var f=Math.pow(2,t)*256,e=(i.x-this._tileTranslatePoint.x)/r*100,o=(i.y-this._tileTranslatePoint.y)/r*100,s=e*f/100,h=o*f/100;this._tileTranslatePoint.x=i.x-s;this._tileTranslatePoint.y=i.y-h}},_bubbleEnterFunction:function(n){if(n.data.templateID!=null){var i=t("#"+n.data.templateID).render(n.data.itemsrc);t(n.data.htmlobj).html(i)}return t(document.body).append(n.data.htmlobj),t(n.data.htmlobj).css("display","block").css({left:n.pageX+8+"px",top:n.pageY+6+"px"})},_bubbleleaveFunction:function(n){return t(n.data.htmlobj).remove(),t(n.data.htmlobj).css("display","none")},_bubbleOverFunction:function(n){return t(n.data.htmlobj).css("display","block").css({left:n.pageX+8+"px",top:n.pageY+6+"px"})},_polyEnterFunction:function(n){var i=n.data.Param1,f=n.data.Param2.shape,o=n.data.map,s=t.grep(i._smartLabels,function(n){return n.shape==f}),e,l,h,c,a,v;if(i.enableMouseHover){if(i._clearShapeWidth(o._scale),i._prevHoverdLegend==null||i._contains(i._prevSelectedLegends,i._prevHoverdLegend)||i._prevHoverdLegend.css("background-color",_isSVG?i._prevHoveredShape.getAttribute("fill"):i._prevHoveredShape.fillcolor.value),_isSVG?(f.setAttribute("stroke-width",i.shapeSettings.highlightBorderWidth/o._scale),f.setAttribute("stroke",i.shapeSettings.highlightStroke)):(f.strokeweight=i.shapeSettings.highlightBorderWidth,f.strokecolor=i.shapeSettings.highlightStroke/o._scale),i.shapeSettings.highlightColor!=null&&(i.shapeSettings.highlightColor=="transparent"||i._contains(i._prevSelectedShapes,f)||(f.setAttribute("class","e-mapHighlightedShape mapShape"),_isSVG?(i.shapeSettings.highlightColor!="none"&&f.highlightcolor==null?f.setAttribute("fill",i.shapeSettings.highlightColor):f.setAttribute("fill",f.highlightcolor),f.setAttribute("stroke-width",i.shapeSettings.highlightBorderWidth/o._scale),f.setAttribute("stroke",i.shapeSettings.highlightStroke)):f.fillcolor=i.shapeSettings.highlightColor),s.length>0&&!i._contains(i._prevSelectedLegends,s[0].legend)&&(s[0].legend.setAttribute("class","e-mapHighlightedShape mapShape"),s[0].legend.css("background-color",i.shapeSettings.highlightColor),i._prevHoverdLegend=s[0].legend),i._prevHoveredShape=f),i.legendSettings!=null&&i.legendSettings.mode==r.datavisualization.Map.LegendMode.Interactive&&i.shapeSettings.colorMappings!=null&&i.shapeSettings.colorMappings.rangeColorMapping!=null&&!i.shapeSettings.autoFill&&(i.legendSettings.showLegend==u||i.legendSettings.showLegend))for(e=0;e<i._mapShapes.length;e++)if(l=i._mapShapes[e].shape,l==f&&(h=null,i.shapeSettings.colorMappings.rangeColorMapping!=u&&(h=i.shapeSettings.colorMappings.rangeColorMapping),c=i.legendSettings.width,i.legendSettings.width==u&&(c=150),a=c/h.length/10,i._mapShapes[e].legendrect!=null)){v=i._mapShapes[e].legendrect.marginLeft;t(i._interactiveArrow).css({"margin-left":v+Math.ceil(a)-i._interactiveArrow.width()/2,display:"block"});break}o._trigger("mouseover",{originalEvent:n.data.Param2})}},_updateShapeRect:function(n){for(var i,t=0;t<n._mapShapes.length;t++)i=n._mapShapes[t],i.left==null&&(i.left=n._mapShapes[t].shape.getBoundingClientRect().left,i.right=n._mapShapes[t].shape.getBoundingClientRect().right,i.top=n._mapShapes[t].shape.getBoundingClientRect().top,i.bottom=n._mapShapes[t].shape.getBoundingClientRect().bottom,n._mapShapes[t]=i)},_polyUpFunction:function(n){var i=n.data.Param2,f=n.data.Param3,e,r,u;if(n.which!=3||!this.model.enableRightClick){if(this.enableZoomOnSelection()&&!this._isDragging&&!this._isTileMap&&!this._isPinching){if(_isSVG)e=f.getBBox(),this._zoomOnSelection(e);else for(this._updateShapeRect(i),r=0;r<i._mapShapes.length;r++)if(f==i._mapShapes[r].shape){var o=i._mapShapes[r].left,s=i._mapShapes[r].top,h=i._mapShapes[r].right,c=i._mapShapes[r].bottom,l={x:o,y:s,width:h-o,height:c-s};this._zoomOnSelection(l);break}this.ispanning=!1}u=i._tooltipElement;u!=null&&t(u).delay(200).queue(function(n){t(this).css("display","none");n()})}},_markerPressed:function(n){this._trigger("markerSelected",{originalEvent:n.data})},_polyMouseDown:function(n){var e=n.data.Param2,u,y,p,w;if(n.type=="mousedown"?u={x:n.pageX,y:n.pageY}:n.type=="touchstart"?u={x:n.originalEvent.changedTouches[0].pageX,y:n.originalEvent.changedTouches[0].pageY}:n.type=="MSPointerDown"&&(u={x:n.originalEvent.pageX,y:n.originalEvent.pageY}),n.data.Param1.hasOwnProperty("data")&&e.showTooltip){var i=e._tooltipElement,v=e.tooltipTemplate,f=t(this._mapContainer).offset();f==null&&(f={left:0,width:0,height:0});var r=e._tooltipSize,o=this._height,s=this._width;if(i!=null&&v!=null){t(i).css({display:"block"});y=t("#"+v).render(n.data.Param1.data);t(i).html(y);p=i[0]!=null?i[0].clientHeight:i.clientHeight;w=i[0]!=null?i[0].clientWidth:i.clientWidth;r={height:p,width:w};var c=u.x-t(this._mapContainer).offset().left,l=u.y-t(this._mapContainer).offset().top,h=u.x,a=u.y;r.width+c>=s&&(h-r.width>f.left?h=f.left+s-(s-c)-r.width:h-=r.width+c-s);r.height>o?o+r.height>this._height+l&&(a-=f.top+10):r.height+l>=o&&(a-=r.height+l-o);t(i).css({left:h+10,top:a+10})}}},_polyClickFunction:function(n){var g=n.ctrlKey,i=n.data.Param2,s=this,f=n.data.Param3,a=[],p=[],o=t.grep(i._smartLabels,function(n){return n.shape==f}),l,w,h,c,b,e,v,y,k,d;if(s._isPolygonSelected=!0,n.which==3){s.model.enableRightClick&&(n.preventDefault(),a.push(n.data.Param1),r.util.isNullOrUndefined(a[0].data)||s._trigger("shapeSelected",{originalEvent:a,selectedItemValues:i.selectedItems,rightClick:!0}));return}if(r.util.isNullOrUndefined(n.data.Param1.data)||(p.push(n.data.Param1),l={originalEvent:p,rightClick:!1},s._trigger("shapeSelected",l)),w=r.util.isNullOrUndefined(l)?!1:l.cancel,i.enableSelection&&!w)if(g&&i.selectionMode==r.datavisualization.Map.SelectionMode.Multiple)o!=null&&o.length>0&&(t.inArray(o[0].legend,i._prevSelectedLegends)==-1?(o[0].legend.setAttribute("class","e-mapSelectedShape mapShape"),o[0].legend.css("background-color",i.shapeSettings.selectionColor),i._prevSelectedLegends.push(o[0].legend)):(h=i._prevSelectedLegends.indexOf(o[0].legend),o[0].legend[0].setAttribute("class","mapShape"),o[0].legend.css("background-color",o[0].legend[0].getAttribute("nodeValue")),i._prevSelectedLegends.splice(h,1))),t.inArray(f,i._prevSelectedShapes)==-1?(f.removeSelectionCSS||f.setAttribute("class","e-mapSelectedShape mapShape"),_isSVG?(f.setAttribute("fill",i.shapeSettings.selectionColor),f.setAttribute("stroke",i.shapeSettings.selectionStroke),f.setAttribute("stroke-width",i.shapeSettings.selectionStrokeWidth/s._scale)):(f.fillcolor=i.shapeSettings.selectionColor,f.strokecolor=i.shapeSettings.selectionStroke,f.strokeweight=i.shapeSettings.selectionStrokeWidth/s._scale),i._prevSelectedShapes.push(f),i.selectedItems.push(n.data.Param1)):(f.setAttribute("class","mapShape"),f.setAttribute("fill",f.getAttribute("nodeValue")),f.setAttribute("stroke",i.shapeSettings.stroke),f.setAttribute("stroke-width",i.shapeSettings.strokeThickness/this._scale),h=i._prevSelectedShapes.indexOf(f),i._prevSelectedShapes.splice(h,1),i.selectedItems.splice(h,1));else{for(e=0;e<i._prevSelectedLegends.length;e++)i._prevSelectedLegends[e][0].setAttribute("class","mapShape"),i._prevSelectedLegends[e].css("background-color",i._prevSelectedLegends[e][0].getAttribute("nodeValue"));for(o!=null&&o.length>0&&(o[0].legend.setAttribute("class","e-mapSelectedShape mapShape"),o[0].legend.css("background-color",i.shapeSettings.selectionColor),i._prevSelectedLegends.push(o[0].legend)),e=0;e<i._prevSelectedShapes.length;e++)i._prevSelectedShapes[e].setAttribute("class","mapShape"),_isSVG?(i._prevSelectedShapes[e].setAttribute("fill",i._prevSelectedShapes[e].getAttribute("nodeValue")),i._prevSelectedShapes[e].setAttribute("stroke",i.shapeSettings.stroke),i._prevSelectedShapes[e].setAttribute("stroke-width",i.shapeSettings.strokeThickness/this._scale)):(i.fillcolor=i._prevSelectedShapes[e].getAttribute("nodeValue"),i.strokecolor=i.shapeSettings.stroke,i.strokeweight=i.shapeSettings.strokeThickness/this._scale);if(this._isPinching||t.inArray(f,i._prevSelectedShapes)!=-1?(i._prevSelectedShapes=[],i.selectedItems=[]):(f.removeSelectionCSS||f.setAttribute("class","e-mapSelectedShape mapShape"),i._prevSelectedShapes=[],i.selectedItems=[],_isSVG?(f.setAttribute("fill",i.shapeSettings.selectionColor),f.setAttribute("stroke",i.shapeSettings.selectionStroke),f.setAttribute("stroke-width",i.shapeSettings.selectionStrokeWidth/s._scale)):(f.fillcolor=i.shapeSettings.selectionColor,f.strokecolor=i.shapeSettings.selectionStroke,f.strokeweight=i.shapeSettings.selectionStrokeWidth/s._scale),i._prevSelectedShapes.push(f),i.selectedItems.push(n.data.Param1)),c=i.legendSettings,c.mode=="interactive"&&i.shapeSettings.colorMappings!=null&&i.shapeSettings.colorMappings.rangeColorMapping!=null&&!i.shapeSettings.autoFill&&c.showLegend)for(e=0;e<i._mapShapes.length;e++)if(b=i._mapShapes[e].shape,b==f&&(v=null,i.shapeSettings.colorMappings.rangeColorMapping!=u&&(v=i.shapeSettings.colorMappings.rangeColorMapping),y=c.width,c.width==u&&(y=150),k=y/v.length/10,i._mapShapes[e].legendrect!=null)){d=i._mapShapes[e].legendrect.marginLeft;t(i._interactiveArrow).css({"margin-left":d+Math.ceil(k)-i._interactiveArrow.width()/2,display:"block"});break}}},_updateSelection:function(n,i){n.enableSelection&&(n.selectionMode!=r.datavisualization.Map.SelectionMode.Multiple&&(n._prevSelectedShapes.pop(),n.selectedItems.pop()),t.inArray(i,n._prevSelectedShapes)==-1&&n._prevSelectedShapes.push(i))},_zoomOnSelection:function(n){var u,t,i,r;_isSVG||(n.x=n.x-this._baseTranslatePoint.x/2-n.width/2,n.y=n.y-this._baseTranslatePoint.y/2-n.height/2);t=n.width;i=n.height;u=(this._width-100)/(this._height-100)>t/i?(this._height-100)/i:(this._width-100)/t;this._prevScale=this._scale;this._scale=u;this._prevPoint={x:this._translatePoint.x,y:this._translatePoint.y};this.zoomLevel(this._scale-this._baseScale+1);r=this.zoomLevel();r>this.minZoom()&&r<this.maxZoom()||(this.zoomLevel(r>(this.maxZoom()-this.minZoom())/2+this.minZoom()?this.maxZoom():this.minZoom()),this._scale=this.zoomLevel()+this._baseScale-1);var f=this._width/2-t*this._scale/2,e=f/this._scale,o=this._height/2-i*this._scale/2,s=o/this._scale;this._translatePoint.x=-n.x+e;this._translatePoint.y=-n.y+s;this.enableAnimation()&&!this._isTileMap?this._animate(1200):(this._applyTransform(this._scale,this._translatePoint),this._updateSliderValue())},_polyMoveFunction:function(n){var l=n.data.Param1,k,d,o;if(this.model!=null){var e=this.model.layers[this.baseMapIndex()],i=l._tooltipElement,y=l.tooltipTemplate,p=n.data.Param2,r=l._tooltipSize,u=t(this._mapContainer).offset(),w=document.getElementById(this._id),b=w.getBoundingClientRect().width/w.offsetWidth;u==null&&(u={left:0,top:0,width:0,height:0});o=e.legendSettings.dockOnMap&&e.legendSettings.dockPosition=="right"?this._width+e.legendSettings.width+20+e.legendSettings.leftLabel.length*10+e.legendSettings.rightLabel.length*10:this._width;var s=this._height,h=o,c=n.pageX-u.left,a=n.pageY-u.top,f=n.pageX,v=n.pageY;i!=null&&y!=null&&p.hasOwnProperty("data")&&n.data.Param1.showTooltip&&(t(i).css({display:"block"}),k=t("#"+y).render(p.data),t(i).html(k),d=i[0]!=null?i[0].clientHeight:i.clientHeight,o=i[0]!=null?i[0].clientWidth:i.clientWidth,r={height:d,width:o},r.width+c>=b*h&&!this.model.enableRTL&&(f-r.width>u.left?f=u.left+h-(h-c)-r.width:f-=r.width+c-h),r.height>s?s+r.height>this._height+a&&(v-=u.top+10):r.height+a>=s*b&&(v-=r.height+a-s),t(i).css({left:this.model.enableRTL?(c-r.width<0)?f+10:f-o:f+10,top:v}))}},_polyLeaveFunction:function(n){var u=n.data.Param1,e=n.data.map,o=n.data.Param2.shape,s=u._tooltipElement,f=u._prevSelectedShapes;if(f.length>0)for(o.setAttribute("class","mapShape"),i=0;i<f.length;i++)f[i].removeSelectionCSS||f[i].setAttribute("class","e-mapSelectedShape mapShape");else o.setAttribute("class","mapShape");s!=null&&t(s).css("display","none");u.legendSettings!=null&&u.legendSettings.mode==r.datavisualization.Map.LegendMode.Interactive&&u._interactiveArrow!=null&&t(u._interactiveArrow).css("display","none");u._clearShapeWidth(e._scale);e._trigger("mouseleave",{originalEvent:n.data.Param2})},_wireEvents:function(){function o(n){i.enableAnimation()&&t(i._rootgroup).stop(!0,!1);n.preventDefault(n);i._zooming(-40*n.detail,n)}var f,n,e,i,u;t(this._mapContainer).off();f=t.uaMatch(navigator.userAgent);n=f.browser.toLowerCase();this._on(t(this._mapContainer),r.eventType.mouseDown,this._mouseButtonDown);t(document).keydown({className:"home",map:this},this._keyboardKeysPressed);this._on(t(this._mapContainer),r.eventType.mouseMove,this._mouseMove);this._on(t(document),r.eventType.mouseUp,this._mouseUp);e=!!navigator.userAgent.match(/Trident\/7\./);e&&(n="msie");window.navigator.msPointerEnabled?(this._on(t(this._mapContainer),"MSPointerUp",this._mouseButtonUp),t(this._mapContainer).css("-ms-touch-action","none")):this._on(t(this._mapContainer),"mouseup",this._mouseButtonUp);i=this;this._browser=n;n!="mozilla"?this._on(t(this._mapContainer),"mousewheel",this._mouseWheel):(u=this._svgDocument,u.addEventListener&&u.addEventListener("DOMMouseScroll",o,!1));r.isTouchDevice()?this._on(t(this._mapContainer),"touchend",this._mapClick):(this._on(t(this._mapContainer),"click",this._mapClick),this._on(t(this._mapContainer),"dblclick",this._doubleClick));(this.model.enableResize||this.model.isResponsive)&&(r.isTouchDevice()?this._on(t(window),"orientationchange",this._mapResize):this._on(t(window),"resize",this._mapResize))},clip:function(n,t,i){return Math.min(Math.max(n,t),i)},pointToLatLong:function(n,t){var i=this,u=i._getFactor(),f=n/i._scale-i._translatePoint.x,e=t/i._scale-i._translatePoint.y,r=Math.min(i._height,i._width)*u,o=i.clip(f,0,r-1)/r-.5,s=.5-i.clip(e,0,r-1)/r;return latitude=90-360*Math.atan(Math.exp(-s*2*Math.PI))/Math.PI,longitude=360*o,{latitude:latitude,longitude:longitude}},_mapResize:function(n){n.preventDefault();n.stopPropagation();var i={width:this._width,height:this._height},r=this._translatePoint,t=this;this.resizeTO&&clearTimeout(this.resizeTO);this.resizeTO=setTimeout(function(){t.refresh();t._isTileMap||(t._translatePoint.x=r.x/i.width*t._width,t._translatePoint.y=r.y/i.height*t._height,t._applyTransform(t._scale,t._translatePoint),t._refrshLayers())},500)},_isDevice:function(){return/mobile|tablet|android|kindle/i.test(navigator.userAgent.toLowerCase())},_unWireEvents:function(){var u=t.uaMatch(navigator.userAgent),n=u.browser.toLowerCase(),i;this._on(t(document),r.eventType.mouseUp,this._mouseUp);i=!!navigator.userAgent.match(/Trident\/7\./);i&&(n="msie");n!="mozilla"&&this._off(t(this._mapContainer),"mousewheel",this._mouseWheel);window.navigator.msPointerEnabled?(this._off(t(this._mapContainer),"MSPointerDown",this._mouseButtonDown),this._off(t(this._mapContainer),"MSPointerMove",this._mouseMove),this._off(t(this._mapContainer),"MSPointerUp",this._mouseButtonUp),t(this._mapContainer).css("-ms-touch-action","none")):n=="webkit"||n=="chrome"||n=="mozilla"?(this._off(t(this._mapContainer),"mousedown",this._mouseButtonDown),this._off(t(this._mapContainer),"mousemove",this._mouseMove),this._off(t(this._mapContainer),"mouseup",this._mouseButtonUp)):(this._off(t(this._mapContainer),"mousedown",this._mouseButtonDown),this._off(t(this._mapContainer),"mousemove",this._mouseMove),this._off(t(this._mapContainer),"mouseup",this._mouseButtonUp));this._off(t(this._mapContainer),"dblclick",this._doubleClick);this._off(t(this._mapContainer),"click",this._mapClick)},navigateTo:function(n,t,i,r){var e,f,o,s;r==u&&(r=this.enableAnimation());i=parseFloat(i);i==u&&(i=this.zoomLevel());i>this.minZoom()&&i<this.maxZoom()?this.zoomLevel(i):this.zoomLevel(i>(this.maxZoom()-this.minZoom())/2+this.minZoom()?this.maxZoom():this.minZoom());e=this._getFactor();f=this._convertTileLatLongtoPointForShapes(n,t,this._mapBounds,e);this._prevPoint={x:this._translatePoint.x,y:this._translatePoint.y};this._prevScale=this._scale;this._scale=this._baseScale+(i-1)*this.zoomFactor();o=(this._containerWidth+this._baseTranslatePoint.x)/2/this._scale;s=(this._containerHeight+this._baseTranslatePoint.y)/2/this._scale;this._translatePoint.x=-f.x+o;this._translatePoint.y=-f.y+s;r&&!this._isTileMap?this._animate(1200):this._applyTransform(this._scale,this._translatePoint);this._updateSliderValue();this._refrshLayers()},selectShape:function(n,t,i){var e,f,u;if(n!=null)for(t==null&&(t=this.model.layers[this.baseMapIndex()]),u=0;u<t._mapShapes.length;u++)if(e=t._mapShapes[u].data,f=t._mapShapes[u].shape,e!=null&&n==this._reflection(e,t.shapeSettings.valuePath)){if(t._prevSelectedShapes.length!=0&&t.selectionMode!=r.datavisualization.Map.SelectionMode.Multiple)for(u=0;u<t._prevSelectedShapes.length;u++)_isSVG?(t._prevSelectedShapes[u].setAttribute("fill",t._prevSelectedShapes[u].getAttribute("nodeValue")),t._prevSelectedShapes[u].setAttribute("stroke",t.shapeSettings.stroke),t._prevSelectedShapes[u].setAttribute("stroke-width",t.shapeSettings.strokeThickness/this._scale)):(t._prevSelectedShapes[u].fillcolor=t._prevSelectedShapes[u].style.behavior,t._prevSelectedShapes[u].strokecolor=t.shapeSettings.stroke,t._prevSelectedShapes[u].strokeweight=t.shapeSettings.strokeThickness/this._scale);t.enableSelection&&(_isSVG?(t.shapeSettings.selectionColor!="none"&&f.setAttribute("fill",t.shapeSettings.selectionColor),f.setAttribute("stroke",t.shapeSettings.selectionStroke),f.setAttribute("stroke-width",t.shapeSettings.selectionStrokeWidth/this._scale)):(t.shapeSettings.selectionColor!="none"&&(f.fillcolor=t.shapeSettings.selectionColor),f.strokecolor=t.shapeSettings.selectionStroke,f.strokeweight=t.shapeSettings.selectionStrokeWidth/this._scale),this._updateSelection(t,f,n),t._contains(t.selectedItems,t._mapShapes[u])||t.selectedItems.push(t._mapShapes[u]),this._trigger("shapeSelected",{originalEvent:t.selectedItems,rightClick:!1}));i&&this.enableZoomOnSelection()&&this._zoomOnSelection(f.getBBox());u=t._mapShapes.length}},_getIntersectedElements:function(n,i){var r,u;if(n.width+=5,n.height+=5,_isSVG&&this._browser!="mozilla"&&this._browser!="webkit")return r=this._svgDocument.createSVGRect(),r.x=n.left,r.y=n.top,r.width=n.width,r.height=n.height,this._svgDocument.getIntersectionList(r,null);var o=[],s=t(this._mapContainer).offset(),h=s.left,c=s.top;for(u=0;u<i.length;u++){var f=i[u].shape,e=f.getBoundingClientRect(),l=t(f).offset().left-h,a=t(f).offset().top-c;if(this._isIntersect(n,{left:l,top:a,height:e.bottom-e.top,width:e.right-e.left}))return o.push(f),o}return o},_isIntersect:function(n,t){return n.left>=t.left+t.width||n.left+n.width<=t.left||n.top>=t.top+t.height||n.top+n.height<=t.top?!1:!0},pan:function(t){var i=this,r=0,u=0,f,e,o,s;if(this.zoomLevel()!=1){switch(t){case"right":r=this._width/7;u=0;break;case"top":r=0;u=-(this._height/7);break;case"left":r=-(this._width/7);u=0;break;case"bottom":r=0;u=this._height/7}i.enablePan()&&(this._isTileMap&&(f=this._tileTranslatePoint.x-r/i._scale,e=this._tileTranslatePoint.y-u/i._scale,this._tileTranslatePoint.x=f,this._tileTranslatePoint.y=e,this._generateTiles(this.zoomLevel())),o=i._translatePoint.x-r/i._scale,i._prevScale=i._scale,s=i._translatePoint.y-u/i._scale,i._prevPoint={x:this._translatePoint.x,y:this._translatePoint.y},this._translatePoint.x=o,this._translatePoint.y=s,i.enableAnimation()&&!this._isTileMap?i._animate(600):i._applyTransform(i._scale,i._translatePoint),i._refrshLayers())}},zoom:function(n,t){var i=this,r=i.zoomLevel(),f;n<=this.maxZoom()&&n>=this.minZoom()?(this._isTileMap?(this._tileZoom(i.zoomLevel(),n,{x:this._width/2,y:this._height/2}),r=i.zoomLevel(),i.zoomLevel(n),this._generateTiles(this.zoomLevel()),i._translatePoint.x=(i._tileTranslatePoint.x-.5*Math.pow(2,r))/Math.pow(2,r),i._translatePoint.y=(i._tileTranslatePoint.y-.5*Math.pow(2,r))/Math.pow(2,r),i._scale=Math.pow(2,r)):(f=n,i._prevPoint={x:i._translatePoint.x,y:i._translatePoint.y},i._prevScale=i._scale,i._translatePoint.x-=(i._width/i._scale-i._width/f)/2,i._translatePoint.y-=(i._height/i._scale-i._height/f)/2,i._scale=f,i.zoomLevel(n),(i.enableAnimation()&&t||t==u)&&i._animate(600)),i.enableAnimation()&&t||(i._applyTransform(i._scale,i._translatePoint),i._refrshLayers(),i._resizeShape()),i._updateSliderValue()):n<=this.minZoom()?(this.zoomLevel(this.minZoom()),this.zoom(this.zoomLevel())):n>=this.maxZoom()&&(this.zoomLevel(this.maxZoom()),this.zoom(this.zoomLevel()));r<n?i._trigger("zoomedIn",{originalEvent:null,zoomLevel:i.zoomLevel()}):r>n&&i._trigger("zoomedOut",{originalEvent:null,zoomLevel:i.zoomLevel()})},refresh:function(){var n,i;this._trigger("onLoad");this._unWireEvents();t("#"+this._id).find(".LegendDiv").parent().children().empty();t(this._svgDocument).empty();this._svgDocument!=null&&(this._svgDocument=null);t(this._mapContainer).empty();this._scale=1;this._margintop=0;this._marginleft=0;this._previosTranslatePoint=this._translatePoint;this._translatePoint={x:0,y:0};this._height=this._mapContainer.height();this._width=this._mapContainer.width();this._height==0&&(this._height=this._mapContainer[0].parentElement.clientHeight!=0?this._mapContainer[0].parentElement.clientHeight:t(document).height());this._width==0&&(this._width=this._mapContainer[0].parentElement.clientWidth!=0?this._mapContainer[0].parentElement.clientWidth:t(document).width());this.baseMapIndex()>=this.model.layers.length&&this.baseMapIndex(0);n=this.model.layers[this.baseMapIndex()];n.legendSettings!=null&&n.legendSettings.showLegend&&(n.shapeSettings.colorMappings!=null||n.shapeSettings.colorPath!=null||n.bubbleSettings.colorMappings!=null||n.bubbleSettings.colorPath!=null)&&n._sizeCalculation(this);this._generatePath();this._groupSize!=null&&(this._isMapCoordinates?(this._containerHeight=this._groupSize.maxY-this._groupSize.minY,this._containerWidth=this._groupSize.maxX-this._groupSize.minX,this._groupBorder={x:this._groupSize.minX,y:this._groupSize.minY}):(i=this._getFactor(),this._containerHeight=Math.abs((this._groupSize.maxY-this._groupSize.minY)*i),this._containerWidth=Math.abs((this._groupSize.maxX-this._groupSize.minX)*i)));this._resizingContainer();this._renderMapElements();n.legendSettings!=null&&n.legendSettings.showLegend&&(n.shapeSettings.colorMappings!=null||n.shapeSettings.colorPath!=null||n.bubbleSettings.colorMappings!=null||n.bubbleSettings.colorPath!=null)&&this._renderLegend();_isSVG&&t(this._svgDocument).css({height:this._height,width:this._width,"margin-top":this._margintop,"margin-left":this._marginleft});this.model.enableLayerChangeAnimation&&t(this._mapContainer).animate({opacity:1},500);this.model.centerPosition==null||this._isTileMap||this.navigateTo(this.model.centerPosition[0],this.model.centerPosition[1],this.zoomLevel(),!1);this._legendContainer!=null&&this._legendContainer.css({height:this._legendSize.height});this._trigger("refreshed");this._trigger("onRenderComplete")},_updateSliderValue:function(n){var t=this._sliderControl,i;n==u&&(n=this.enableAnimation());t!=null&&(i=t.data("BoldBIDashboardSlider"),i.option("value",this.zoomLevel()))},_createDivElement:function(n,t,i,u){var f=n,e=t;e.appendTo(f);f.appendTo(i);this._on(e,r.eventType.mouseDown,{className:u,map:this},this._navigationControlPressed)},_navigationControlPressed:function(n){n.stopPropagation();this._isNavigationPressed=!0;var t=n.data.map,i=t.enableAnimation();n.data.className=="zoomIn"?(t.zoom(t.zoomLevel()+t.zoomFactor(),!0),i||t._updateSliderValue(),t._refrshLayers()):n.data.className=="zoomOut"?(t.zoom(t.zoomLevel()-t.zoomFactor(),!0),i||t._updateSliderValue()):n.data.className=="panLeft"?t.pan("left"):n.data.className=="panRight"?t.pan("right"):n.data.className=="panTop"?t.pan("top"):n.data.className=="panBottom"?t.pan("bottom"):n.data.className=="home"&&(t.zoom(1,!0),i||t._updateSliderValue())},_keyboardKeysPressed:function(n){this._iskeyboardKeysPressed=!0;var t=n.data.map,i=t.enableAnimation();n.ctrlKey&&n.keyCode==38?t._zoomingIn(t._width/2,t._height/2,n,i):n.ctrlKey&&n.keyCode==40?t._zoomingOut(t._width/2,t._height/2,n,i):n.keyCode==37?t.pan("left"):n.keyCode==39?t.pan("right"):n.keyCode==38?t.pan("top"):n.keyCode==40&&t.pan("bottom")},refreshNavigationControl:function(n){function it(n){o!=null&&o._isRendered&&o.zoomLevel()!=n.value&&o.zoom(n.value,!1)}function rt(n){o!=null&&o._isRendered&&o.zoomLevel()!=n.value&&o.zoom(n.value,!1)}var c=this.model.layers[this.baseMapIndex()],g=this._mapContainer.find("#ejNavigation"),e,a,s,v,h,y,o,w,b,k,d,i,f;if(g.length>0&&this._mapContainer[0].removeChild(g[0]),this.model.navigationControl!=null&&this.enableNavigation()){n==u&&(n=this.model.navigationControl);var p=r.Orientation.Vertical,l,nt=120,tt=12;l={width:90,height:320};e=t("<div id='ejNavigation' class='e-map-navigation e-orientation-vert'/>");this.model.navigationControl.content==null&&(a=t("<div style='height:120px;width:10px;margin-top:-197px;margin-left: 34px;' />"));n.orientation=="horizontal"&&(p=r.Orientation.Horizontal,nt=12,tt=120,l={width:320,height:90},e=t("<div id='ejNavigation' class='e-map-navigation e-orientation-horz' />"),this.model.navigationControl.content==null&&(a=t("<div style='height:10px;width:120px;margin-top:-18px' />")));this.model.navigationControl.content==null&&(s=t("<div class='e-panContainer'/>"),v=p=="horizontal"?"Horz":"Vert",n.orientation=="horizontal"?(h=t("<div style='margin-left: 94px;' />"),y=t("<div style='margin-left: 137px;'/>")):(h=t("<div />"),y=t("<div style='margin-top: 34px;'/>")),s.appendTo(e),h.appendTo(e),a.appendTo(y),y.appendTo(e),this._sliderControl=a,i={x:0,y:0},n.dockPosition==null||n.dockPosition==r.datavisualization.Map.Position.None?(i.x=this._width*n.absolutePosition.x/100,i.y=this._height*n.absolutePosition.y/100):i=this._getPosition(n.dockPosition,l),e.css({"margin-left":i.x+"px","margin-top":i.y+"px"}));o=this;w=this._height*.0025;this.model.navigationControl.content==null?navigationStyle=this._browser!="chrome"&&this._browser!="msie"?t("<style> .e-map-navigation {width: 90px;height: 320px;position:absolute;z-index:2;zoom:"+w+";}<\/style>"):t("<style> .e-map-navigation {width: 90px;height: 320px;position:absolute;z-index:2;-moz-transform: scale("+w+");}<\/style>"):(b=t("#"+this.model.navigationControl.content).height()||t(this.navigationControlData[0]).height(),k=t("#"+this.model.navigationControl.content).width()||t(this.navigationControlData[0]).width(),navigationStyle=this._browser!="mozilla"&&this._browser!="chrome"?t("<style> .e-map-navigation {width: "+k+"px;height: "+b+"px;position:absolute;z-index:2;}<\/style>"):t("<style> .e-map-navigation {width: "+k+"px;height: "+b+"px;position:absolute;z-index:2;}<\/style>"));this._browser!="mozilla"&&this._browser!="chrome"?(navigationStyle.remove(),t("html > head").append(navigationStyle)):t("html > head").append(navigationStyle);this.model.navigationControl.content==null?(t(a).BoldBIDashboardSlider({orientation:p,sliderType:r.SliderType.MinRange,value:1,animationSpeed:1200,minValue:this.minZoom(),showTooltip:!0,enableAnimation:!1,maxValue:this.maxZoom(),incrementStep:this.zoomFactor(),slide:rt,change:it,height:nt,width:tt}),e.appendTo(this._mapContainer),n.orientation=="horizontal"?(this._createDivElement(t("<div title='ZoomIn' class='e-icon1 e-incrementButton  icon_margin1' />"),t("<div class='e-icon1 nav-inc-"+v+"  e-innerIncrement'/>"),h,"zoomIn"),this._createDivElement(t("<div title='ZoomOut'class='e-icon1 e-incrementButton icon_margin2'/>"),t("<div class='e-icon1 nav-dec-"+v+" e-innerDecrement'/>"),h,"zoomOut")):(this._createDivElement(t("<div title='ZoomIn' class='e-icon1 e-incrementButton  icon_margin1' />"),t("<div class='e-icon1 nav-inc-"+v+"  e-innerIncrement'/>"),h,"zoomIn"),this._createDivElement(t("<div title='ZoomOut' class='e-icon1 e-incrementButton icon_margin2'/>"),t("<div class='e-icon1 nav-dec-"+v+" e-innerDecrement'/>"),h,"zoomOut")),this._createDivElement(t("<div title='PanTop' class='e-icon1 e-radialTop'/>"),t("<div class='e-icon1 e-arrowUp'/>"),s,"panTop"),this._createDivElement(t("<div title='PanLeft' class='e-icon1 e-radialLeft'/>"),t("<div class='e-icon1 e-arrowLeft'/>"),s,"panLeft"),this._createDivElement(t("<div title='PanRight' class='e-icon1 e-radialRight'/>"),t("<div class='e-icon1 e-arrowRight'/>"),s,"panRight"),this._createDivElement(t("<div title='PanBottom' class='e-icon1 e-radialBottom'/>"),t("<div class='e-icon1 e-arrowDown'/>"),s,"panBottom"),d=t("<div title='Home' class='e-icon1 e-home-bg'><div class='e-icon1 e-map-home'><\/div>"),d.appendTo(s),d.mousedown({className:"home",map:this},this._navigationControlPressed)):(this.navigationControlData==null?(this.navigationControlData=t("#"+this.model.navigationControl.content),this.navigationControlData.css({display:"block"}),this.navigationControlData.appendTo(e)):this.navigationControlData.appendTo(e),e.appendTo(this._mapContainer),l={width:this.navigationControlData[0].getBoundingClientRect().right-this.navigationControlData[0].getBoundingClientRect().left,height:this.navigationControlData[0].getBoundingClientRect().bottom-this.navigationControlData[0].getBoundingClientRect().top},i={x:0,y:0},f=c.legendSettings,n.dockPosition==null||n.dockPosition==r.datavisualization.Map.Position.None?(i.x=this._width*n.absolutePosition.x/100,i.y=this._height*n.absolutePosition.y/100):i=this._getPosition(n.dockPosition,l),f.showLegend&&f.dockOnMap&&f.dockPosition==r.datavisualization.Map.DockPosition.Top&&f.mode==r.datavisualization.Map.LegendMode.Interactive?e.css({"margin-left":i.x+"px","margin-top":o._mapContainer.height()-l.height+"px"}):f.showLegend&&f.dockOnMap&&f.dockPosition==r.datavisualization.Map.DockPosition.Left&&f.mode==r.datavisualization.Map.LegendMode.Interactive?e.css({"margin-left":i.x+c.legendSettings.width+20+c.legendSettings.leftLabel.length*10+c.legendSettings.rightLabel.length*10+"px","margin-top":i.y+"px"}):f.showLegend&&f.dockOnMap&&f.dockPosition==r.datavisualization.Map.DockPosition.Top&&f.mode==r.datavisualization.Map.LegendMode.Default?e.css({"margin-left":i.x+"px","margin-top":i.y+c.legendSettings.height+"px"}):f.showLegend&&f.dockOnMap&&f.dockPosition==r.datavisualization.Map.DockPosition.Left&&f.mode==r.datavisualization.Map.LegendMode.Default?e.css({"margin-left":i.x+c.legendSettings.width+"px","margin-top":i.y+"px"}):e.css({"margin-left":i.x+"px","margin-top":i.y+"px"}))}},_getPosition:function(n,t){var i={x:0,y:0};switch(n){case r.datavisualization.Map.Position.TopCenter:i.x=this._width/2-t.width/2;break;case r.datavisualization.Map.Position.TopRight:i.x=this._width-t.width;break;case r.datavisualization.Map.Position.CenterLeft:i.y=this._height/2-t.height/2;break;case r.datavisualization.Map.Position.Center:i.x=this._width/2-t.width/2;i.y=this._height/2-t.height/2;break;case r.datavisualization.Map.Position.CenterRight:i.x=this._width-t.width;i.y=this._height/2-t.height/2;break;case r.datavisualization.Map.Position.BottomLeft:i.y=this._height-t.height;break;case r.datavisualization.Map.Position.BottomCenter:i.x=this._width/2-t.width/2;i.y=this._height-t.height;break;case r.datavisualization.Map.Position.BottomRight:i.x=this._width-t.width;i.y=this._height-t.height}return i},_renderMapElements:function(){this._templateDiv=t("<div class='TemplateDiv'/>");this._templateDiv.appendTo(this._mapContainer);this._templateDiv.css({"pointer-events":"none",overflow:"hidden",position:"absolute","z-index":"1",height:this._height,width:this._width});this._wireEvents();this.refreshLayers();this.refreshNavigationControl(this.model.navigationControl)},_renderLegend:function(){var n=this.model.layers[this.baseMapIndex()],f,i;this._scrollLegendDiv=t("<div class='ScrollLegendDiv'/>");this._scrollLegendDiv.appendTo(this._mapContainer);this._legendContainer=t("<div id='LegendcontainerDiv'/>");this._legendContainer.appendTo(this._scrollLegendDiv);this._legendDiv.css({height:this._legendDivHeight+"px",width:this._legendDivWidth+"px",position:"absolute"});this._isNavigationPressed=!0;this._legendDiv.appendTo(this._legendContainer);this._legendDiv[0].getBoundingClientRect();this._legendContainer.css({position:"relative"});this._scrollLegendDiv.BoldBIDashboardScroller({height:Math.round(this._legendSize.height),width:Math.round(this._legendSize.width)});n.legendSettings.labelOrientation==u&&n.legendSettings.labelOrientation==r.datavisualization.Map.LabelOrientation.Vertical;n.legendSettings.dockOnMap?(n.legendSettings.mode==r.datavisualization.Map.LegendMode.Interactive?(pos="none",height=n.legendSettings.height+50,width=n.legendSettings.width+20+n.legendSettings.leftLabel.length*10+n.legendSettings.rightLabel.length*10):(pos="auto",height=n.legendSettings.height,width=n.legendSettings.width),this._scrollLegendDiv.css({position:"absolute","z-index":"2",height:this._legendSize.height,width:this._legendSize.width}),(n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Top||n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Bottom)&&n.legendSettings.alignment==r.datavisualization.Map.Alignment.Center?this._scrollLegendDiv.css({"margin-left":this._width/2-this._legendSize.width/2}):(n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Top||n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Bottom)&&n.legendSettings.alignment==r.datavisualization.Map.Alignment.Far?this._scrollLegendDiv.css({"margin-left":this._width-this._legendSize.width}):(n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Left||n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Right)&&n.legendSettings.alignment==r.datavisualization.Map.Alignment.Center?this._scrollLegendDiv.css({"margin-top":this._height/2-this._legendSize.height/2}):(n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Left||n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Right)&&n.legendSettings.alignment==r.datavisualization.Map.Alignment.Far&&this._scrollLegendDiv.css({"margin-top":this._height-this._legendSize.height}),n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Bottom?this._scrollLegendDiv.css({"margin-top":this._height}):n.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Right&&this._scrollLegendDiv.css({"margin-left":this._width})):(n.legendSettings.labelOrientation==r.datavisualization.Map.LabelOrientation.Horizontal||n.legendSettings.labelOrientation==r.datavisualization.Map.LabelOrientation.Vertical)&&(f=n.legendSettings.position==u?"topleft":n.legendSettings.position,i=this._getPosition(f,this._legendSize),this._scrollLegendDiv.css({position:"absolute","z-index":"2","margin-left":i.x+"px","margin-top":i.y}));this.refreshNavigationControl(this.model.navigationControl)},_renderMapLayers:function(){var u,n,e,f,i;for(t(this._templateDiv).empty(),u=0,n=this.model.layers[this.baseMapIndex()],n.layerType==r.datavisualization.Map.LayerType.Geometry?(this._renderLayers(n,u,this),n.shapeData!=null&&(u=n._polygonData.length)):(n._initializeLocalValues(),e=t("<div class='map-contribution'>"),e[0].innerHTML=n.contribution,this._mapContainer.append(e)),f=0;f<this.model.layers[this.baseMapIndex()].subLayers.length;f++)i=this.model.layers[this.baseMapIndex()].subLayers[f],i._isBaseLayer=!1,i.layerType==r.datavisualization.Map.LayerType.Geometry&&i.shapeData!=null?(this._renderLayers(i,u,this),u+=i._polygonData.length):i._initializeLocalValues();this.refreshMarkers();_isSVG&&this.enableAnimation()&&!this._isTileMap?this._refreshWithAnimation():this._refrshLayers()},refreshLayers:function(){var n=this.model.layers[this.baseMapIndex()];this._processOData(n,this);this.shapeSelectionOnResize()},_processOData:function(n,t){if(n.dataSource!=null)if(n.dataSource instanceof r.DataManager){var i=n.dataSource.executeQuery(n.query);i.done(function(i){i.result!=null&&(n.dataSource=i.result,t._renderMapLayers())})}else t._renderMapLayers();else t._renderMapLayers()}});var e=function(n,t){this.X=n;this.Y=t;this.left=0;this.top=0;this.height=256;this.width=256;this.src=null},f=function(){this.enableSelection=!0;this.selectionMode="default";this.bingMapType="aerial";this.key="";this.selectedItems=[];this.enableMouseHover=!1;this.shapeData=null;this.markers=[];this.dataSource=null;this.urlTemplate="http://a.tile.openstreetmap.org/level/tileX/tileY.png";this.showTooltip=!1;this.tooltipTemplate=null;this.mapItemsTemplate=null;this.enableAnimation=!1;this.legendSettings={showLegend:!1,showLabels:!1,rowSpacing:10,columnSpacing:10,position:"topleft",positionX:0,positionY:0,height:0,width:0,iconHeight:20,iconWidth:20,type:"layers",mode:"default",title:"",leftLabel:"",rightLabel:"",icon:"rectangle",dockOnMap:!1,dockPosition:"top",labelOrientation:"vertical",alignment:"bottom",columnCount:0,toggleVisibility:!1};this.labelSettings={showLabels:!1,labelPath:"",enableSmartLabel:!1,smartLabelSize:"fixed",labelLength:2};this.markerTemplate=null;this.showMapItems=!1;this.layerType="geometry";this.geometryType="geographic";this._colorPaletteSettings={Palette1:{highlightColor:"#F7CD1C",highlightStroke:"white",SelectionColor:"#F96C0D",SelectionStroke:"white"},Palette2:{highlightColor:"#68A3EA",highlightStroke:"White",SelectionColor:"#116EF4",SelectionStroke:"White"},Palette3:{highlightColor:"#CCCCCC",highlightStroke:"white",SelectionColor:"#4D4D4D",SelectionStroke:"white"}};this.colorPalettes={Palette1:["#4A3825","#736F3D","#F2DABD","#BF9D7E","#7F6039","#7F715F","#70845D","#CC995C","#736F3D","#89541B"],Palette2:["#E51400","#730202","#EF6535","#C63477","#BF004D","#F0A30B","#CE1B1B","#97993D","#D6BF38","#835A2C"],Palette3:["#A4C400","#008B00","#1BA0E2","#0050EF","#AA00FF","#D90073","#E51400","#F96800","#E3C800","#A20026"]};this._prevPaletteIndex=0;this._newBounds=[];this.subLayers=[];this.shapeSettings={highlightColor:"gray",highlightBorderWidth:1,selectionColor:"gray",fill:"#E5E5E5",shapeFillColor:null,radius:5,strokeThickness:"0.2",stroke:"#C1C1C1",colorPalette:"palette1",highlightStroke:"#C1C1C1",selectionStroke:"#C1C1C1",selectionStrokeWidth:1,colorValuePath:null,valuePath:null,enableGradient:!1,colorMappings:null,autoFill:!1};this.bubbleSettings={showBubble:!0,bubbleOpacity:"0.9",minValue:10,maxValue:20,color:"gray",colorValuePath:null,valuePath:null,colorMappings:null,showTooltip:!1,tooltipTemplate:null}};f.prototype={dataTypes:{enableRightClick:"boolean",dataSource:"data",markers:"array",subLayers:"array",shapeSettings:{colorMappings:"array"},bubbleSettings:{colorMappings:"array"}},_initializeLocalValues:function(){this._svgns="http://www.w3.org/2000/svg";this._bounds=[];this._bubbleCollection=[];this._prevSelectedShapes=[];this._prevSelectedLegends=[];this._isBaseLayer=!0;this._prevHoverdLegend=null;this._prevHoveredShape=null;this._labelCollection=[];this._scrollBar=null;this._mapShapes=[];this._bubbles=[];this._labelBounds=[];this._bubbleCount=0;this._mapItems=[];this._mapMarkers=[];this.selectedItems;this._tooltipSize={height:0,width:0};this._smartLabels=[];this._labelData=[];this._interactiveArrow=null;this._legendRects=[];this._legendIconPosition=[]},_generateMarkerForLayers:function(n){var h,c,e,f,i,o,u,s;for(this._mapMarkers=[],h=n._rootgroup.getBoundingClientRect().top,c=n._rootgroup.getBoundingClientRect().left,e=0;e<this.markers.length;e++)f=this.markers[e],this.markerTemplate!=null?(i=t(".markerTemplateDiv"),i=t("<div class='mapMarker' style='display:block;position:absolute;pointer-events: stroke;'><\/div>"),n._templateDiv.append(i),t(i).css({height:this._height,width:this._width,"margin-top":this._margintop,"margin-left":this._marginleft}),o=t("#"+this.markerTemplate).render(f),n.model.markerSelected==""&&t(i).css({"pointer-events":"none"}),t(i).html(o),n._on(t(i),r.eventType.mouseDown,{marker:t(i),data:f},n._markerPressed),this._mapMarkers.push(i)):(u=t(' <div class="mapMarker" style="display:block;position:absolute;pointer-events: stroke;"><label>'+f.label+"<\/label><\/div>"),_isSVG?n._templateDiv.append(u):u.appendTo(n._templateDiv),n.model.markerSelected==""&&t(u).css({"pointer-events":"none"}),n._on(t(u),r.eventType.mouseDown,{marker:t(u),data:f},n._markerPressed),this._mapMarkers.push(u)),s=this,s.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Left&&(this._height=this._height,this._width=this._width-parseFloat(width),this._marginleft=parseFloat(width))},_contains:function(n,t){var i=n.length;if(i>0)while(i--)if(n[i]===t)return!0;return!1},_shapeContains:function(n,t){var i=n.length;if(i>0)while(i--)if(n[i].shapeIndex===t)return{isContains:!0,index:n.length-i};return{isContains:!1}},_labelSizeCalculation:function(n){var t=document.getElementsByClassName("e-map-labelContainer"),r=t[0].offsetHeight,i=t[0].offsetWidth;n._width=n._width-i;n._marginleft=i},_sizeCalculation:function(n){var i=this.shapeSettings.colorMappings||this.bubbleSettings.colorMappings,v=!1,y=!1,u;if(this.shapeSettings.colorMappings!=null||this.shapeSettings.colorPath!=null||this.bubbleSettings.colorMappings!=null||this.bubbleSettings.colorPath!=null){i!=null?(i.rangeColorMapping!=null&&(i=i.rangeColorMapping,v=!0),i.equalColorMapping!=null&&(i=i.equalColorMapping)):(this.shapeSettings.colorPath!=null||this.bubbleSettings.colorPath!=null)&&(i=this.dataSource,y=!0);var o=0,c=0,h=this.legendSettings.rowSpacing,p=this.legendSettings.columnSpacing,w=this.legendSettings.iconWidth+5,a=this.legendSettings.iconHeight+5,g=a+h,f=this.legendSettings.iconHeight+h,d=this._calcHeight(this.legendSettings.title),e=0,t=this.legendSettings,l=this.legendSettings.columnCount;if(t.height==0&&t.width==0&&l==0){for(u=0;u<i.length;u++){var b=i[u].legendLabel!=null?i[u].legendLabel:v?i[u].from:y?i[u][t.textPath]:i[u].value,k=this._calcWidth(b),s=w+k+p;t.dockOnMap&&(t.dockPosition==r.datavisualization.Map.DockPosition.Top||t.dockPosition==r.datavisualization.Map.DockPosition.Bottom)||!t.dockOnMap?n._width<o+s?(f=a+h+f,e=Math.max(e,o),o=s):o+=s+5:n._height<c+a+h?(e+=o,f=Math.max(f,c),o=s,c=0):(c+=a+h,o=Math.max(s,o))}t.dockOnMap&&(t.dockPosition==r.datavisualization.Map.DockPosition.Top||t.dockPosition==r.datavisualization.Map.DockPosition.Bottom)||!t.dockOnMap?(e=Math.max(e,o),f+=t.title!=null&&t.title!=""?d:5):(e+=o+p,f=Math.max(f,c))}else l==0&&(f=t.height.toString().indexOf("%")!=-1?n._height/100*parseInt(t.height.toString().replace("%","")):t.height,e=t.width.toString().indexOf("%")!=-1?n._width/100*parseInt(t.width.replace("%","")):t.width);if(t.height==0&&t.width==0&&l!=0)for(u=0;u<i.length;u++){var b=i[u].legendLabel!=null?i[u].legendLabel:v?i[u].from:y?i[u][t.textPath]:i[u].value,k=this._calcWidth(b),s=w+k+p;u%l!=0?(o+=s,u==l-1&&(e=Math.max(e,o))):(u!=0&&(f=w+h+f),e=Math.max(e,o),o=s)}}t.height!=0&&t.width!=0&&(f=t.height,e=t.width);n._legendSize={height:f,width:e};t.dockOnMap&&(t.mode==r.datavisualization.Map.LegendMode.Interactive&&(f=55),this.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Bottom?(n._height=n._height-parseFloat(f),this.legendSettings.tempWidth=o):this.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Top?(n._height=n._height-parseFloat(f),n._margintop=parseFloat(f)):this.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Left?(n._width=n._width-e,n._marginleft=e):this.legendSettings.dockPosition==r.datavisualization.Map.DockPosition.Right&&(n._height=n._height,n._width=n._width-e))},_clearShapeWidth:function(n){var i,t;for(n==null&&(n=1),i=0;i<this._mapShapes.length;i++)t=this._mapShapes[i],this._contains(this._prevSelectedShapes,t.shape)||(_isSVG?(this.shapeSettings.colorMappings!=null||this.shapeSettings.autoFill||this.shapeSettings.colorPath!=null||!r.util.isNullOrUndefined(this.shapeSettings.shapeFillColor)?t.shape.setAttribute("fill",t.shape.getAttribute("nodeValue")):t.shape.setAttribute("fill",this.shapeSettings.fill),t.shape.setAttribute("stroke-width",this.shapeSettings.strokeThickness/n),t.shape.setAttribute("stroke",this.shapeSettings.stroke)):(t.shape.fillcolor=t.shape.style.behavior,t.shape.strokeweight=this.shapeSettings.strokeThickness,t.shape.strokecolor=this.shapeSettings.stroke))},_shapeSelection:function(){for(var n,i,t=0;t<this._mapShapes.length;t++)n=this._mapShapes[t],i=this._shapeContains(this.selectedItems,n.shapeIndex),i.isContains&&(this._contains(this._prevSelectedShapes,n.shape)||this._prevSelectedShapes.push(n.shape),_isSVG?(n.shape.setAttribute("fill",this.shapeSettings.selectionColor),n.shape.setAttribute("stroke-width",this.shapeSettings.selectionStrokeWidth),n.shape.setAttribute("stroke",this.shapeSettings.selectionStroke)):(n.shape.fillcolor=this.shapeSettings.selectionColor,n.shape.strokeweight=this.shapeSettings.selectionStrokeWidth,n.shape.strokecolor=this.shapeSettings.selectionStroke))},_rgbToHex:function(n,t,i){return"#"+this._toHex(n)+this._toHex(t)+this._toHex(i)},_toHex:function(n){var t="0123456789ABCDEF";return(n=parseInt(n,10),isNaN(n))?"00":(n=Math.max(0,Math.min(n,255)),t.charAt((n-n%16)/16)+t.charAt(n%16))},_hexToR:function(n){return parseInt(this._cropHex(n).substring(0,2),16)},_hexToG:function(n){return parseInt(this._cropHex(n).substring(2,4),16)},_hexToB:function(n){return parseInt(this._cropHex(n).substring(4,6),16)},_cropHex:function(n){return n.charAt(0)=="#"?n.substring(1,7):n},_getRangeColorValues:function(n,t,i){var u=[],f,r;if(u.push(t),t>i)for(f=(t-i)/(n-1),r=n;r>2;r--)t=t-f,u.push(t);else for(f=(i-t)/(n-1),r=2;r<n;r++)t=t+f,u.push(t+f);return u.push(i),u},_generateGradientCollection:function(n){for(var f=[],r=n[0].charAt(0)=="#"?n[0]:this._colorNameToHex(n[0]),u=n[0].charAt(0)=="#"?n[n.length-1]:this._colorNameToHex(n[n.length-1]),e=this._hexToR(r),o=this._hexToG(r),s=this._hexToB(r),h=this._hexToR(u),c=this._hexToG(u),l=this._hexToB(u),i=10,a=this._getRangeColorValues(i,e,h),v=this._getRangeColorValues(i,o,c),y=this._getRangeColorValues(i,s,l),t=0;t<i;t++)f.push(this._rgbToHex(a[t],v[t],y[t]));return f},_calculateTextWidth:function(n){var i=t("<span>"+n+"<\/span>"),r;return t("body").append(i),r=i.width(),i.remove(),r},_trimFunction:function(n,i){for(var u=t("#spantag").text(n),r=n;u.width()>i;)r=r.slice(0,-2),u.text(r+"...");return r},_createLabel:function(n,i,u,f,e,o,s){var h;return h=this.legendSettings.mode=="interactive"?t("<div class="+f+" align = left><\/div>"):t("<div class=' "+f+" ' id='"+o._id+"LegendText_"+e+"'><\/div>"),h[0].innerHTML=n,h.css({left:i+"px",top:u+"px",position:"absolute",cursor:!r.util.isNullOrUndefined(s)&&s.legendSettings.toggleVisibility?"pointer":"default"}),h},_createInteractiveArrow:function(n,i){var r=t("<div class='e-icon1 e-interactiveArrow'><\/div>");return r[0].innerHTML="&#9650",r.css({"margin-left":n+"px","margin-top":i+"px",position:"absolute"}),r},_getEllipseLegend:function(n,i,r,u,f){var e=t("<div class='e-mapLegend'id='"+f._id+"Legend_"+u+"'/>");return e.css({height:r.legendSettings.iconHeight+"px",width:r.legendSettings.iconWidth+"px","border-radius":r.legendSettings.iconHeight/2+"px",left:n+"px",top:i+"px",position:"absolute",cursor:this.legendSettings.toggleVisibility?"pointer":"default"}),e},_getRectLegend:function(n,i,r,u,f){var e=t("<div id='"+f._id+"Legend_"+u+"' />");return e.css({height:this.legendSettings.iconHeight+"px",width:this.legendSettings.iconWidth+"px",left:n+"px",top:i+"px",position:"absolute",cursor:this.legendSettings.toggleVisibility?"pointer":"default"}),e},_layerLegendLocation:function(n,i,r,f){for(var s,e=0;e<n.length;e++){var o=t.extend(!0,null,this.legendSettings),l=n[e].colorMaplegendLabel=n[e].legendLabel!=null?!0:!1,h=n[e].legendLabel=n[e].legendLabel!=null?n[e].legendLabel:i?n[e].from:f?n[e][o.textPath]:n[e].value;commonEventArgs={legendSettings:o,legendLabel:n[e].legendLabel,fill:i?n[e].color:n[e][this.shapeSettings.colorPath],mapping:i?n[e]:u,dataSource:i?u:n[e]};r._trigger("legendItemRendering",{model:r.model,data:commonEventArgs});var c=this._calcWidth(h),a=commonEventArgs.legendSettings.iconWidth+o.columnSpacing+c,v=commonEventArgs.legendSettings.iconHeight;s=this._highestIconValueCalculation(commonEventArgs,e)}return s},_generateLegend:function(n){var s=!0,it=!1,p=!1,h=null,d,y,t,g,nt,l,tt;this.shapeSettings.colorMappings!=null?this.shapeSettings.colorMappings.rangeColorMapping!=u?h=this.shapeSettings.colorMappings.rangeColorMapping:this.shapeSettings.colorMappings.equalColorMapping!=u&&(h=this.shapeSettings.colorMappings.equalColorMapping,s=!1,it=!0):this.shapeSettings.colorPath!=null&&(p=!0,s=!1,h=this.dataSource);n._reversed&&(h.reverse(),n._reversed=!1);var e=0,i=0,f=this.legendSettings,a=0,w,b,c=f.rowSpacing,v=f.columnSpacing,ft=f.iconWidth+5,et=f.iconHeight+c,rt=this._calcHeight(f.title),ut=this._calcWidth(f.title),k=f.columnCount,o;for(f.title!=null&&f.title!=""&&(d=titleText=f.title,y=this._createLabel(d,e,i,"e-defaultLegend-title","title",n),y[0].title=titleText,y.appendTo(n._legendDiv),i+=rt+v),o=this._layerLegendLocation(h,s,n,p),legendPosition=this._removeDuplicateItems(o.legendPosition),t=0;t<legendPosition.length;t++)g=legendPosition[t].iconHeight/2-legendPosition[t].textHeight/2,o.ymidval=g,o.textWidth=this._calcWidth(legendPosition[t].legendLabel),l=o.highWidth+v+o.highTextWidth+ut,tt=o.highHeight,k!=0?t%k!=0?e=this._drawLegend(legendPosition[t].legendItems,e,i,n,s,t,o):(t!=0&&(nt=legendPosition[t-1].iconHeight,i=i+nt+v),e=this._drawLegend(legendPosition[t].legendItems,e,i,n,s,t,o)):f.dockPosition==r.datavisualization.Map.DockPosition.Top||f.dockPosition==r.datavisualization.Map.DockPosition.Bottom?n._legendSize.width<e+l?(e=0,this._drawLegend(legendPosition[t].legendItems,e,i,n,s,t,o),i+=f.iconHeight+c):(this._drawLegend(legendPosition[t].legendItems,e,i,n,s,t,o),e+=legendPosition[t].iconWidth+legendPosition[t].textWidth,i+=f.iconHeight+c):n._legendSize.height<i+f.iconHeight?(i=0,e+=a+v,this._drawLegend(legendPosition[t].legendItems,e,i,n,s,t,o),a=0,i+=f.iconHeight+c):(this._drawLegend(legendPosition[t].legendItems,e,i,n,s,t,o),a=Math.max(a,l),i+=f.iconHeight+c),w=n._legendDivHeight>i?n._legendDivHeight:i+tt,b=n._legendDivWidth>e+l?n._legendDivWidth:e+l,n._legendDivWidth=b,n._legendDivHeight=w},_drawLegend:function(n,t,i,r,u,f,e){var o,c=n.legendSettings.columnCount,s=e.highWidth/2,h=e.legendPosition[f].iconWidth/2;return r.model.enableRTL?(o=this._legendTextCalculation(e,f,t,i,r),this._drawLegendText(n,o.labelTextXPos,o.legendTextYPos,r,u,f),t+=e.highTextWidth+10,t+=s-h,this._drawLegendShape(n,t,i,r,u,f,e)):(t=n.legendSettings.columnCount!=0?f%c!=0&&f!=0?t+(e.highWidth+e.highTextWidth+10):s-h:s-h,this._drawLegendShape(n,t,i,r,u,f,e),o=this._legendTextCalculation(e,f,t,i,r),o.labelTextXPos=e.highWidth!=e.legendPosition[f].iconWidth?o.labelTextXPos:t+e.legendPosition[f].iconWidth+10,this._drawLegendText(n,o.labelTextXPos,o.legendTextYPos,r,u,f)),t},_drawLegendShape:function(n,i,f,e,o,s){var h,c;if(h=this.legendSettings.icon.toLowerCase()=="rectangle"?this._getRectLegend(i,f,n,s,e):this._getEllipseLegend(i,f,n,s,e),t(h).css("background",o?n.mapping._color?n.mapping._color:n.fill:n.dataSource._color!=u?n.dataSource._color:n.fill!=u?n.fill:n.dataSource.color),o&&!r.util.isNullOrUndefined(n.mapping.gradientColors)){var v=n.mapping.gradientColors.length,l="linear-gradient(to right,",a=n.mapping.gradientColors[0];for(c=1;c<v;c++)a+=","+n.mapping.gradientColors[c];l=l+a+")";n.mapping.color=l;t(h).css("background",n.mapping.color)}h.appendTo(e._legendDiv)},_drawLegendText:function(n,i,r,u,f,e){var o=t("<div class='e-defaultLegendLabel' id='"+u._id+"LegendText_"+e+"'/>");o.css({left:i+"px",top:r+"px",position:"absolute","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden",cursor:this.legendSettings.toggleVisibility?"pointer":"default"});o[0].title=n.legendLabel;o[0].innerHTML=n.legendLabel;o.appendTo(u._legendDiv)},_generateLegends:function(n){var k=this.shapeSettings.colorMappings,st,a,v,tt,ht,it,y,s,nt,e,p,rt,at,wt,vt,ut,o,et,h,kt,dt;if(this.shapeSettings.colorPath!=null||k.rangeColorMapping!=null||k.equalColorMapping!=null){var ri=this.legendSettings,ui=this.legendSettings.iconWidth+5,ni=this.legendSettings.iconHeight+5,fi=this.legendSettings.rowSpacing,ei=this.legendSettings.columnSpacing,oi=this.legendSettings.iconHeight+this.legendSettings.rowSpacing,si=ni+this.legendSettings.rowSpacing,ot=n.model.enableRTL?this.legendSettings.rightLabel:this.legendSettings.leftLabel,pt=n.model.enableRTL?this.legendSettings.leftLabel:this.legendSettings.rightLabel;if((this.legendSettings.showLegend==u||this.legendSettings.showLegend)&&!this.shapeSettings.autoFill){t(n._mapContainer).append(t('<div  id="labelTooltip" style="display:none;background-color:grey;padding-left:5px; padding-right:5px;position:absolute;z-index:1000;pointer-events:none;"/>'));var d=this,i=10,c=0,si=this.iconHeight+this.legendSettings.rowSpacing,g=this.legendSettings.height,l=this.legendSettings.width,f=t("<div/>");if(d.legendSettings.dockOnMap?f=t(n._legendDiv):d.legendSettings.dockOnMap||d.legendSettings.mode==r.datavisualization.Map.LegendMode.Interactive?_isSVG?f.appendTo(n._templateDiv):n._templateDiv.append(f):f=t(n._legendDiv),(this.legendSettings.type==u||this.legendSettings.type==r.datavisualization.Map.LegendType.Layers)&&(this.shapeSettings.colorMappings!=null||this.shapeSettings.colorPath!=null)&&(this.legendSettings.mode==u||this.legendSettings.mode==r.datavisualization.Map.LegendMode.Default||this.legendSettings.mode==r.datavisualization.Map.LegendMode.Interactive&&this.shapeSettings.colorMappings.equalColorMapping!=null))this._generateLegend(n);else if((this.legendSettings.type==u||this.legendSettings.type==r.datavisualization.Map.LegendType.Layers)&&this.legendSettings.mode==r.datavisualization.Map.LegendMode.Interactive&&this.shapeSettings.colorMappings!=null){if(h="",this.legendSettings.height==0&&(g=18),this.legendSettings.width==0&&(l=150),this.legendSettings.leftLabel==null&&(this.legendSettings.leftLabel=""),this.legendSettings.title!=null){if(st=i,a=document.createElement("Label"),a.innerHTML=this.legendSettings.title,document.body.appendChild(a),this.legendSettings.showLabels||(st=n.model.enableRTL?i+(l-a.offsetWidth/2):i+this.legendSettings.leftLabel.length*10),a.className="e-interactivelegend-title",v=titleText=this.legendSettings.title,tt=this._calcWidth(v),tt>l)for(ht=10,o=titleText.toString().length;o>=1;o--)if(v=v.toString().substring(0,o-1),a.innerHTML=v,tt=this._calcWidth(v),tt+ht<=l&&(titleText=v+="...",titleTrimWidth=this._calcWidth(titleText),titleTrimWidth+ht<=l))break;a.parentNode.removeChild(a);h=this._createLabel(v,st,c,"e-interactivelegend-title");h[0].title=titleText;h.css({width:l+"px"});_isSVG?h.appendTo(f):f.append(h);c+=25}for(this.legendSettings.showLabels&&(c+=25),ot==null||this.legendSettings.showLabels||(h=this._createLabel(ot,i,c-3,"e-interactivelegend-leftlabel"),_isSVG?h.appendTo(f):f.append(h),i=i+this._calcWidth(ot)+5),it=this._createInteractiveArrow(i,c+g),it.appendTo(f),this._interactiveArrow=it,y=null,!_isSVG&&this.shapeSettings.enableGradient&&(y=n._createGroup(!1,"legendGroup"),y.style.left="0px",y.style.top="0px",y.style.position="relative",f.append(y)),n.model.enableRTL?n._reversed?s=k.rangeColorMapping:(s=k.rangeColorMapping.reverse(),n._reversed=!0):n._reversed?(s=k.rangeColorMapping.reverse(),n._reversed=!1):s=k.rangeColorMapping,nt=0;nt<s.length;nt++)if(e=s[nt],!e.hideLegend){if(p=[],this.shapeSettings.enableGradient&&!r.util.isNullOrUndefined(e.gradientColors)&&(p=this._generateGradientCollection(e.gradientColors)),rt={},this.shapeSettings.enableGradient&&!r.util.isNullOrUndefined(e.gradientColors))if(_isSVG){var ct=t("<canvas/>"),lt=ct[0].getContext("2d"),w=lt.createLinearGradient(0,0,300,0),b=0;for(o=0;o<10;o++)b=b+1/10,o==0||e.gradientColors.length==1?(w.addColorStop(0,e.gradientColors[0]),w.addColorStop(b,p[o])):o==p.length-1?(w.addColorStop(b-1/10,p[o]),w.addColorStop(b,e.gradientColors[1])):(w.addColorStop(b-1/10,p[o]),w.addColorStop(b,p[o+1]));lt.fillStyle=w;lt.fillRect(0,0,300,300);ct.css({height:g+"px",width:l/s.length+"px","margin-left":i+"px","margin-top":c+"px",opacity:"0.9",filter:"alpha(opacity=90)",position:"absolute"});ct.appendTo(n._legendDiv)}else at="legend"+nt,wt="<v:rect id="+at+' display="block" style="position:absolute;top: '+(c-2)+"px;left:"+i+"px;width:"+l/s.length+"px;height:"+g+'px;"><v:fill opacity="0.9px" type="gradient" method="linear sigma" angle="270"/><v:stroke opacity="0px"/><\/v:rect>',y.innerHTML=y.innerHTML+wt,vt=document.getElementById(at),vt.fillcolor=e.gradientColors[0],vt.fill.color2=e.gradientColors[1];else ut=t("<div/>"),ut.css({height:g+"px",width:l/this.shapeSettings.colorMappings.rangeColorMapping.length+"px","background-color":e.color,"margin-left":i+"px","margin-top":c+"px",opacity:"0.9",filter:"alpha(opacity=90)",position:"absolute"}),_isSVG?ut.appendTo(f):f.append(ut);for(o=0;o<10;o++)rt={},rt.marginLeft=i,this._legendRects.push(rt),i=i+l/s.length/10;if(n.model.enableRTL&&nt==s.length-2&&it.css({"margin-left":i+"px"}),this.legendSettings.showLabels){var ft=i-l/s.length,yt=c-25,bt=this._createLabel(e.from,ft,yt,"e-legend-rangestartlabel");ft=i;et=this._createLabel(e.to,ft,yt);e.legendLabel!=u&&(et=this._createLabel(e.legendLabel,ft-e.legendLabel.length*5,yt,"e-legend-rangeendlabel",e));_isSVG?(e==s[0]&&bt.appendTo(f),et.appendTo(f)):(e==s[0]&&f.append(bt),f.append(et))}}pt==null||this.legendSettings.showLabels||(h=this._createLabel(pt,i+10,c-3,"e-interactivelegend-rightlabel"),_isSVG?h.appendTo(f):f.append(h),i=i+this.legendSettings.rightLabel.length*10);totalwidth=i+10;totalheight=c+g+10;n._legendSize={width:totalwidth,height:totalheight};d.legendSettings.dockOnMap&&(this.legendSettings.dockPosition=="left"?n._marginleft=totalwidth:this.legendSettings.dockPosition=="top"&&(n._margintop=totalheight))}if(d.legendSettings.dockOnMap||this.legendSettings.position!="none"){if(!d.legendSettings.dockOnMap&&this.legendSettings.mode==r.datavisualization.Map.LegendMode.Interactive){var ti=this.legendSettings.position==u?"topleft":this.legendSettings.position,ii={width:totalwidth,height:totalheight},gt=n._getPosition(ti,ii);f.css({"margin-left":gt.x+"px","margin-top":gt.y})}}else kt=n._width*this.legendSettings.positionX/100,dt=n._height*this.legendSettings.positionY/100,f.css({"margin-left":kt+"px","margin-top":dt+"px"})}}},_generateLabels:function(n){var f=t("<div class='e-map-labelContainer'><\/div>"),i;for(t(f).css({position:"absolute",overflow:"scroll"}),i=0;i<this._polygonData.length;i++){var e=this._polygonData[i].properties,o=n._reflection(e,this.labelSettings.labelPath),u=t("<div class='e-map-label'><\/div>");t(u).css({"margin-top":i*20,position:"absolute"});u[0].innerHTML=o;f.append(u);n._mapContainer.append(f);u.mouseenter({Param1:this,Param2:this._mapShapes[i],map:n},n._polyEnterFunction);n._off(t(u),r.eventType.mouseUp,n._polyClickFunction);this.model.enableRightClick&&n._off(t(u),"contextmenu",n._polyClickFunction);n._on(t(u),r.eventType.mouseUp,{Param1:this._mapShapes[i],Param2:this,Param3:this._mapShapes[i].shape},n._polyClickFunction);this.model.enableRightClick&&n._on(t(u),"contextmenu",{Param1:this._mapShapes[i],Param2:this,Param3:this._mapShapes[i].shape},n._polyClickFunction)}},_calcWidth:function(n){var i=t('<span  class="e-defaultLegendLabel">'+n+"<\/span>"),r;return t("body").append(i),r=i.width()+5,i.remove(),r},_calcHeight:function(n){var i=t('<div class ="e-defaultLegend-title" >'+n+"<\/div>"),r;return t("body").append(i),r=i.height(),i.remove(),r},_legendTextCalculation:function(n,t,i,r,u){var o=n.legendPosition[t].legendItems.legendSettings.columnCount,s=n.legendPosition[t].iconWidth,f=u.model.enableRTL?i:o==0&&this.legendSettings.type=="layers"?i+s+10:this.legendSettings.type=="bubbles"?n.highWidth+10:n.highWidth+10,e;return textHeight=this._calcHeight(n.legendPosition[t].legendLabel),textWidth=this._calcWidth(n.legendPosition[t].legendLabel),ymidvalue=n.legendPosition[t].iconHeight/2-textHeight/2,labelYAlterPos=r+ymidvalue,e=f+n.highTextWidth,labelXAlterPos=n.highTextWidth<=textWidth?f:e-textWidth,{labelTextXPos:labelXAlterPos,legendTextYPos:labelYAlterPos,MidYPos:ymidvalue,textWidth:textWidth,textHeight:textHeight}},_highestIconValueCalculation:function(n){var t,e=n.legendLabel,o={iconWidth:n.legendSettings.iconWidth,iconHeight:n.legendSettings.iconHeight,highWidth:r,highHeight:u,legendItems:n,textWidth:this._calcWidth(e),textHeight:this._calcHeight(e),highTextWidth:f,legendLabel:e,colorMaplegendLabel:n.colorMaplegendLabel},r,u,f,i;for(this._legendIconPosition.push(o),t=this._legendIconPosition,f=this._calcWidth(t[0].legendItems.legendLabel),r=t[0].iconWidth,u=t[0].iconHeight,i=0;i<t.length;i++)r<t[i].iconWidth&&(r=t[i].iconWidth),u<t[i].iconHeight&&(u=t[i].iconHeight),f<t[i].textWidth&&(f=t[i].textWidth);return{highWidth:r,highHeight:u,highTextWidth:f,legendPosition:t}},_bubbleLegend:function(n,i,r,u,f,e,o,s,h,c){var p,a,l,w,b,y,v,k;for(legendPosition=this._removeDuplicateItems(h.legendPosition),p=h.highWidth/2,l=0;l<legendPosition.length;l++)w=legendPosition[l].textHeight,b=legendPosition[l].iconWidth/2,i.hideLegend||(y=t("<div class='e-mapBubbleLegend' id='"+n._id+"Legend_"+l+"'/>"),n.model.enableRTL?(r=10,a=this._legendTextCalculation(h,l,r,u,n),v=this._createLabel(legendPosition[l].legendItems.legendLabel,a.labelTextXPos,a.legendTextYPos,"e-legendlabeltext",l,n,h.legendPosition[l].legendPosition),r+=h.highTextWidth,r+=p-b,this._drawBubbleLegendIcon(legendPosition[l].legendItems,r,u,y)):(r=p-b,this._drawBubbleLegendIcon(legendPosition[l].legendItems,r,u,y),a=this._legendTextCalculation(h,l,r,u,n),a.labelTextXPos=h.highWidth!=legendPosition[l].iconWidth?a.labelTextXPos:r+legendPosition[l].iconWidth+10,v=this._createLabel(legendPosition[l].legendItems.legendLabel,a.labelTextXPos,a.legendTextYPos,"e-legendlabeltext",l,n,h.legendPosition[l].legendPosition)),legendPosition[l].legendItems.legendLabel!=null?v[0].innerText=legendPosition[l].legendItems.legendLabel:legendPosition[l].legendItems.legendLabel=v[0].innerText=c?legendPosition[l].legendItems.colorMapping.from:legendPosition[l].legendItems.colorMapping.value,n._isSVG?(y.appendTo(n._legendDiv),v.appendTo(n._legendDiv)):(bubblelegenddiv.append(y),bubblelegenddiv.append(v)),e<v[0].innerText.length*10+s&&(e=v[0].innerText.length*10+s),k=y.height(),u+=w>k?w+5:k+5)},_removeDuplicateItems:function(n,t){for(var f,i,e,u=0,r=0;r<n.length;r++){for(f=n[r].legendLabel?n[r].colorMaplegendLabel?null:n[r].legendLabel:n[r][this.legendSettings.textPath],i=0;i<n.length;i++)e=n[i].legendLabel?n[i].legendLabel:n[i][this.legendSettings.textPath],f==e&&(u++,u>1&&(t&&t._duplicateItems.push(n[i]),n.splice(i,1)));u=0}return n},_generateBubbleLegends:function(n){var k,a,v,f,d,c,l,nt,tt;if(this.legendSettings.showLegend==u||this.legendSettings.showLegend){var w=10,e=10,ht=this.legendSettings.iconHeight,rt=this.legendSettings.iconWidth,o,b=this._calcHeight(this.legendSettings.title),ut=this._calcWidth(this.legendSettings.title);this.legendSettings.title!=null&&this.legendSettings.title!=""&&(k=titleText=this.legendSettings.title,a=this._createLabel(k,0,e,"e-defaultLegend-title","title",n),a[0].title=titleText,a.appendTo(n._legendDiv),e+=b+this.legendSettings.columnSpacing);v=t("<div/>");n._isSVG?v.appendTo(n._templateDiv):n._templateDiv.append(v);var s=0,y=0,h=!0,i=null,ft=!1;if(this.bubbleSettings.colorMappings!=null?this.bubbleSettings.colorMappings.rangeColorMapping!=u?i=this.bubbleSettings.colorMappings.rangeColorMapping:this.bubbleSettings.colorMappings.equalColorMapping!=u&&(i=this.bubbleSettings.colorMappings.equalColorMapping,h=!1):this.bubbleSettings.colorPath&&(i=this.dataSource,h=!1,ft=!0),this.legendSettings.type==r.datavisualization.Map.LegendType.Bubbles&&(this.bubbleSettings.colorMappings!=null||this.bubbleSettings.colorPath)&&(this.legendSettings.mode==u||this.legendSettings.mode==r.datavisualization.Map.LegendMode.Default||this.legendSettings.mode==r.datavisualization.Map.LegendMode.Interactive&&this.bubbleSettings.colorMappings.equalColorMapping!=null)){for(this.legendSettings.iconHeight==u&&(this.legendSettings.iconHeight=20),this.legendSettings.iconWidth==u&&(this.legendSettings.iconWidth=20),f=0;f<i.length;f++){if(d=t.extend(!0,null,this.legendSettings),!r.util.isNullOrUndefined(i[f].gradientColors)){var et=i[f].gradientColors.length,p="linear-gradient(to right,",g=i[f].gradientColors[0];for(c=1;c<et;c++)g+=","+i[f].gradientColors[c];p=p+g+")";i[f].color=p}l={fill:i[f]._bubblecolor?i[f]._bubblecolor:i[f].color?i[f].color:i[f][this.bubbleSettings.colorPath],colorMaplegendLabel:i[f].legendLabel!=null?!0:!1,legendLabel:i[f].legendLabel!=null?i[f].legendLabel:h?i[f].from:i[f].value!=null?i[f].value:i[f][this.legendSettings.textPath],dataSource:i[f],legendSettings:d};n._trigger("legendItemRendering",{model:n.model,data:l});o=this._highestIconValueCalculation(l,f)}this._bubbleLegend(n,l,w,e,i,s,y,rt,o,h);y=e;s=w+o.highWidth+o.highTextWidth+ut}if(n._legendDivHeight=this.legendSettings.height+b+this.legendSettings.columnSpacing,n._legendDivWidth=s,this.legendSettings.position=="none")nt=n._width*this.legendSettings.positionX/100,tt=n._height*this.legendSettings.positionY/100,n._legendDiv&&n._legendDiv.css({"margin-left":nt+"px","margin-top":tt+"px"});else{var ot=this.legendSettings.position==u?"topleft":this.legendSettings.position,st={width:s,height:y},it=n._getPosition(ot,st);n._legendDiv&&n._legendDiv.css({"margin-left":it.x+"px","margin-top":it.y+"px"})}}},_drawBubbleLegendIcon:function(n,t,i,u){n.legendSettings.icon==r.datavisualization.Map.LegendIcons.Circle?u.css({height:n.legendSettings.iconHeight+"px",width:n.legendSettings.iconWidth+"px","border-radius":n.legendSettings.iconHeight/2+"px",background:n.fill,left:t+"px",top:i+"px",position:"absolute",cursor:n.legendSettings.toggleVisibility?"pointer":"default"}):u.css({height:n.legendSettings.iconHeight+"px",width:n.legendSettings.iconWidth+"px",background:n.fill,left:t+"px",top:i+"px",position:"absolute",cursor:n.legendSettings.toggleVisibility?"pointer":"default"})},_animateBubble:function(n,i){var e=n.getAttribute("r"),f,u=t(n),r=this;u.delay(i).each(function(){}).animate({r:e},{duration:700,step:function(n){f=n;_isSVG&&(u.attr("style","display:block;"+r.bubbleSettings.showTooltip?"":"pointer-events:stroke;"),u[0].setAttribute("r",f))},complete:function(){r._bubbleCount++;r._bubbleCount==r._bubbles.length&&r._setMapElements()}})},_setMapElements:function(){for(var i,n=0;n<this._mapItems.length;n++)i=this._mapItems[n],t(i).css({display:"block"})},_setMapItemsPositionWithAnimation:function(n){var s,o,e,i,r,u;for(this._bubbleCollection=[],i=0;i<this._bubbles.length;i++){var h=this._bubbles[i],a=this._bubbles[i].getAttribute("r"),u=this._bounds[i],o=(u.x+n._translatePoint.x)*n._scale,e=(u.y+n._translatePoint.y)*n._scale,c=n.validateBubblePosition(u.points,{x:o,y:e},a),l=0,v=Math.floor(Math.random()*(20-l)+l),y=parseInt(v*50);_isSVG&&t(h).attr({cx:c.x,cy:c.y});this._animateBubble(h,y);this._bubbleCollection.push(h)}for(i=0;i<this._mapMarkers.length;i++)r=this._mapMarkers[i],this.markers.length>0&&(s=this.markers[i]),u=n._isTileMap?n._convertTileLatLongtoPoint(s.latitude,s.longitude):n._convertLatLongtoPointforMarker(s.latitude,s.longitude),o=_isSVG?u.x:(u.x+n._transformX)*n._scale,e=u.y,t(r).css({display:"block",left:o,top:e-100}),t(r).delay(500).each(function(){}).animate({top:e},500);for(i=0;i<this._mapItems.length;i++){r=this._mapItems[i];u=this._bounds[boundsCount]==this._bounds[boundsCount-1]?this._bounds[++boundsCount]:this._bounds[boundsCount];boundsCount++;var f=r[0].getBoundingClientRect(),o=(u.x+n._translatePoint.x)*n._scale-f.width/2,e=(u.y+n._translatePoint.y)*n._scale-f.height/4;this._bubbles.length>0?t(r).css({left:o,top:e,display:"none"}):t(r).css({left:o,top:e,display:"block"})}for(i=0;i<this._labelCollection.length;i++){r=this._labelCollection[i];u=this._labelBounds[i];t(r).css("display","block");var f=r[0].getBoundingClientRect(),p=_isSVG?f.width:f.right-f.left,w=_isSVG?f.height:f.bottom-f.top,o=(u.x+n._translatePoint.x)*n._scale-p/2,e=(u.y+n._translatePoint.y)*n._scale-w/2;(r[0].className="smartLabelStyle")&&(r[0].className="labelStyle",t(r[0]).css({"pointer-events":"none",position:"absolute"}));r[0].innerHTML=this._labelData[i];t(r).css({left:o,top:e})}this.labelSettings!=null&&this.labelSettings.showLabels&&this._validateSmartLabel(n)},_toggleLegendGradientColorMapping:function(n,t){var u,i;if(r.util.isNullOrUndefined(n[t].gradientColors))u=n[t].color;else{var o=n[t].gradientColors.length,f="linear-gradient(to right,",e=n[t].gradientColors[0];for(i=1;i<o;i++)e+=","+n[t].gradientColors[i];f=f+e+")";u=f}return u},_duplicateIndexValue:function(n,t,i,r){var u=r.legendSettings.textPath,f=i._reflection(n,u),e=i._reflection(t,u);return f==e?{duplicate:!0}:{duplicate:!1}},_toggle:function(n,i,u,f,e,o,s){var h=n._renderedShapes[f],a=i.target.id,v=h.shapeIndex,it=a.length,rt=a.indexOf("_"),y=parseFloat(a.substring(rt+1,it)),c,l,k,d,g,p,b,nt,w,tt;if(s)if(d=this._duplicateIndexValue(n._renderedShapes[y],u._duplicateItems[f],u,n),d.duplicate)h=u._duplicateItems[f],v=h.shapeIndex,f=y;else return;k=n.legendSettings.type=="bubbles"?n.bubbleSettings.colorPath:n.shapeSettings.colorPath;g=h;p=u._reflection(g,k);p!=null&&typeof p=="string"&&(b=p.toLowerCase());n.shapeSettings.colorMappings!=null&&n.legendSettings.type=="layers"?h.mapRangeShapeIndex!=null&&(mapShapeColorMappingIndex=h.mapRangeShapeIndex.index,c=mapShapeColorMappingIndex,l="#"+h.shape.id,nt=h.mapRangeShapeIndex.shapeColor,w=n.shapeSettings.colorMappings.rangeColorMapping||n.shapeSettings.colorMappings.equalColorMapping,legendFillColor=this._toggleLegendGradientColorMapping(w,mapShapeColorMappingIndex)):n.bubbleSettings.colorMappings!=null&&n.legendSettings.type=="bubbles"?h.mapRangeBubbleIndex!=null&&(mapBubbleColorMappingIndex=h.mapRangeBubbleIndex.index,c=mapBubbleColorMappingIndex,l="#"+h.shape.id+"_bubble_"+v,w=n.bubbleSettings.colorMappings.rangeColorMapping||n.bubbleSettings.colorMappings.equalColorMapping,legendFillColor=this._toggleLegendGradientColorMapping(w,mapBubbleColorMappingIndex)):n.legendSettings.type=="layers"?(c=f,l="#"+h.shape.id,legendFillColor=n.shapeSettings.colorPath!=null?b:n.shapeSettings.fill):n.legendSettings.type=="bubbles"&&(c=f,l="#"+h.shape.id+"_bubble_"+v,legendFillColor=n.bubbleSettings.colorPath!=null?b:n.bubbleSettings.fill);tt=a==u._id+"Legend_"+c||a==u._id+"LegendText_"+c;tt&&(u._trigger("legendItemClick",o),!o.cancel&&n.legendSettings.toggleVisibility&&(y==c&&h._showBubble?(n.legendSettings.type=="bubbles"?t(l).css({visibility:"hidden"}):t(l).css({fill:n.shapeSettings.fill}),t("#"+u._id+"Legend_"+c).css({background:"grey"}),t("#"+u._id+"LegendText_"+c).css({color:"grey"}),t("#"+u._id+"labelStyle_"+v).css({visibility:"hidden"}),h._showBubble=!1):y!=c||h._showBubble||(n.legendSettings.type=="bubbles"?t(l).css({visibility:"visible"}):n.shapeSettings.enableGradient&&r.util.isNullOrUndefined(n.shapeSettings.colorMappings.equalColorMapping)?t(l).css({fill:nt}):t(l).css({fill:legendFillColor}),t("#"+u._id+"Legend_"+c).css({background:legendFillColor}),t("#"+u._id+"LegendText_"+c).css({color:"black"}),t("#"+u._id+"labelStyle_"+v).css({visibility:"visible"}),h._showBubble=!0)))},_legendToggleVisibility:function(n,t,i){var f=n.legendSettings,e={data:f,model:i},o,r,u;if(n.dataSource!=null){for(o=n._renderedShapes.length,n._renderedShapes=n.shapeSettings.colorMappings!=null||n.bubbleSettings.colorMappings?n._renderedShapes:this._removeDuplicateItems(n._renderedShapes,i),r=0;r<n._renderedShapes.length;r++)n._toggle(n,t,i,r,f,e);if(i._duplicateItems.length>0)for(u=0;u<i._duplicateItems.length;u++)n._toggle(n,t,i,u,f,e,!0)}},_resizeShapes:function(n){var r=this.shapeSettings.strokeThickness/n._scale,i,t;if(this._mapShapes!=u)for(i=0;i<this._mapShapes.length;i++)t=this._mapShapes[i].shape,_isSVG?(t.localName=="circle"&&t.setAttribute("r",this.shapeSettings.radius/n._scale),this._contains(this._prevSelectedShapes,t)?t.setAttribute("stroke-width",this.shapeSettings.selectionStrokeWidth/n._scale):t.setAttribute("stroke-width",r)):t.nodeName=="oval"||(t.strokeweight=this._contains(this._prevSelectedShapes,t)?this.shapeSettings.selectionStrokeWidth/n._scale:r)},_setMapItemsPosition:function(n){var c,s,h,i,r,f;if(this._bubbleCollection=[],this._mapItems!=u)for(i=0;i<this._mapItems.length;i++){r=this._mapItems[i];f=this._bounds[i];t(r).css({display:"block"});var e=r[0].getBoundingClientRect(),a=_isSVG?e.width:e.right-e.left,v=_isSVG?e.height:e.bottom-e.top,s=(f.x+n._translatePoint.x)*n._scale-a/2,h=(f.y+n._translatePoint.y)*n._scale-v/4;t(r).css({left:s,top:h})}if(this._bubbles!=u)for(i=0;i<this._bubbles.length;i++){var o=this._bubbles[i],y=this._bubbles[i].getAttribute("r"),f=this._bounds[i];if(_isSVG){var s=(f.x+n._translatePoint.x)*n._scale,h=(f.y+n._translatePoint.y)*n._scale,l=n.validateBubblePosition(f.points,{x:s,y:h},y);t(o).attr({cx:l.x,cy:l.y})}else{o=document.getElementById(o.id);var s=(f.x+n._translatePoint.x)*n._scale,h=(f.y+n._translatePoint.y)*n._scale,l=n.validateBubblePosition(f.points,{x:s,y:h},y),p=l.y-(o.getBoundingClientRect().bottom-o.getBoundingClientRect().top)/2,w=l.x-(o.getBoundingClientRect().right-o.getBoundingClientRect().left)/2;t(o).css({left:w,top:p})}this._bubbleCollection.push(o)}if(this._mapMarkers!=u)for(i=0;i<this._mapMarkers.length;i++)r=this._mapMarkers[i],this.markers.length>0&&(c=this.markers[i]),f=n._isTileMap?n._convertTileLatLongtoPoint(c.latitude,c.longitude):n._convertLatLongtoPointforMarker(c.latitude,c.longitude),s=f.x,h=f.y,t(r).css({left:s,top:h});if(this._labelCollection!=u)for(i=0;i<this._labelCollection.length;i++){r=this._labelCollection[i];f=this._labelBounds[i];t(r).css("display","block");var e=r[0].getBoundingClientRect(),a=_isSVG?e.width:e.right-e.left,v=_isSVG?e.height:e.bottom-e.top,s=(f.x+n._translatePoint.x)*n._scale-a/2,h=(f.y+n._translatePoint.y)*n._scale-v/2;(r[0].className="smartLabelStyle")&&(r[0].className="labelStyle",t(r[0]).css("background-color","transparent"),t(r[0]).css({"pointer-events":"none",position:"absolute"}));r[0].innerHTML=this._labelData[i];t(r).css({left:s,top:h})}this.labelSettings!=null&&this.labelSettings.showLabels&&this._validateSmartLabel(n)},_validateSmartLabel:function(n){function fi(n){var i=[],t;for(i.push(0),t=10;t<=n;t+=20)i.push(-t),i.push(t);return i}function ei(n){for(var t=0;t<ht.length;t++)if(oi(n,ht[t]))return!1;return!0}function oi(n,t){return n.left-2>=t.left+t.width||n.left-2+n.width<=t.left-2||n.top-2>=t.top+t.height||n.top+n.height<=t.top-2?!1:!0}var ht,p,yt,pt,it,rt,lt,bt,at,ui,tt,v,et,c,e,st,f;if(this._smartLabels=[],ht=[],this._labelCollection.length>0)for(p=0;p<this._mapShapes.length;p++){var o=this._labelBounds[p],i={x:(o.x+n._translatePoint.x)*n._scale,y:(o.y+n._translatePoint.y)*n._scale},dt={x:(o.rightMin.x+n._translatePoint.x)*n._scale,y:(o.rightMin.y+n._translatePoint.y)*n._scale},gt={x:(o.rightMax.x+n._translatePoint.x)*n._scale,y:(o.rightMax.y+n._translatePoint.y)*n._scale},ni={x:(o.leftMin.x+n._translatePoint.x)*n._scale,y:(o.leftMin.y+n._translatePoint.y)*n._scale},ti={x:(o.leftMax.x+n._translatePoint.x)*n._scale,y:(o.leftMax.y+n._translatePoint.y)*n._scale},l=this._labelCollection[p];if(i.x>0&&i.x<n._width&&i.y>0&&i.y<n._height){var ct=this._mapShapes[p].shape,a=ct.getBoundingClientRect(),w=!1,nt=l[0].getBoundingClientRect(),s=nt.height,h=nt.width;_isSVG||(a={width:a.right*n._scale-a.left*n._scale,height:a.bottom*n._scale-a.top*n._scale},s=nt.bottom-nt.top,h=nt.right-nt.left);yt=!1;pt=!1;(h/2>dt.x-i.x||h/2>gt.x-i.x)&&(s/2>i.y-dt.y||s/2>gt.y-i.y)?yt=!0:(h/2>i.x-ni.x||h/2>i.x-ti.x)&&(s/2>i.y-ni.y||s/2>ti.y-i.y)&&(pt=!0);var b=0,k=0,wt=20,d=[],ii=[];if(s>a.height||h>a.width||yt||pt)if(this.labelSettings.enableSmartLabel)for(this.labelSettings.smartLabelSize==r.datavisualization.Map.LabelSize.Fixed?(s=25,h=15*this.labelSettings.labelLength):(h*=1.3,s=25);!w;){for(wt>400&&(w=!0),d=fi(wt),ii=d,it=0;it<d.length;it++)for(rt=0;rt<d.length;rt++)b=ii[rt],k=d[it],i.x+b+h>n._width&&i.x<n._width&&(b-=i.x+b+h-n._width),i.x+b<0&&(b=0),i.y+k<0&&(k=0),i.y+k+s>n._height&&i.y<n._height&&(k-=i.y+k+s-n._height),lt={left:i.x+b,top:i.y+k,height:s,width:h},ei(lt)&&(bt=n._getIntersectedElements(lt,this._mapShapes),bt!=null&&bt.length==0&&(w=!0,it=d.length,rt=d.length,l[0].className="smartLabelStyle",t(l).css({"pointer-events":"stroke",position:"absolute"}),this.labelSettings.smartLabelSize==r.datavisualization.Map.LabelSize.Fixed&&(l[0].innerHTML=l[0].innerHTML.substring(0,this.labelSettings.labelLength)),l.mouseenter({Param1:this,Param2:this._mapShapes[p],map:n},n._polyEnterFunction),l.mousemove({Param1:this,Param2:this._mapShapes[p]},n._polyMoveFunction),t(l).css({left:i.x+b,top:i.y+k,"background-color":_isSVG?ct.getAttribute("fill"):ct.fillcolor.value}),ht.push(lt),at={},at.shape=ct,at.legend=l,this._smartLabels.push(at)));wt+=10}else{var ri=!0,ut=0,ft=0,w=!0;for(c=0;c<o.points.length;c++)v={x:(o.points[c].x+n._translatePoint.x)*n._scale,y:(o.points[c].y+n._translatePoint.y)*n._scale},w?(ut=v.y,ft=v.y,w=!1):(ut=Math.min(ut,v.y),ft=Math.max(ft,v.y));for(ui=Math.floor((ft-ut)/s),tt=[],f=0;f<ui;f++)e=[],tt.push(e);for(c=0;c<o.points.length;c++)v={x:(o.points[c].x+n._translatePoint.x)*n._scale,y:(o.points[c].y+n._translatePoint.y)*n._scale},et=Math.floor((v.y-ut)/s),et>0&&(et-=1),e=tt[et],e==u&&(e=[]),e.push({x:v.x,y:v.y}),tt[et]=e;for(c=0;c<tt.length;c++){e=tt[c];w=!0;var y=0,g=0,ot=0,vt=[],kt=[];for(f=0;f<e.length;f++)w?(y=e[f].x,g=e[f].x,ot=e[f].y,w=!1):(y=Math.min(y,e[f].x),g=Math.max(g,e[f].x),e[f].x==g&&(ot=e[f].y)),e[f].x<i.x&&vt.push(e[f].x),e[f].x>i.x&&kt.push(e[f].x);for(a.left<n._mapContainer[0].getBoundingClientRect().left+1&&(y=n._mapContainer[0].getBoundingClientRect().left+1-a.left,vt.push(y)),st=!1,f=0;f<vt.length;f++)if(g-vt[f]<h+1){st=!0;break}if(!st)for(f=0;f<kt.length;f++)if(kt[f]-y<h+1){st=!0;break}if(g-y>h+1&&!st){l.css("left",a.left*n._scale+(y-a.left*n._scale)+(g-y)/2-h/2+"px");l.css("top",ot+"px");ft-ot<s&&l.css("top",ot-s+"px");ri=!1;break}}ri&&l.css("display","none")}}}},_fillIndividualColors:function(n,t,i,r,u,f){var e={fill:n[i.colorPath],stroke:i.stroke,strokeThickness:i.strokeThickness,shapeData:n,shapeProperties:f};r._trigger("shapeRendering",{model:r.model,data:e});(e.fill!=n[i.colorPath]||e.fill==null)&&(e.fill=e.fill==null?f[i.colorPath]?f[i.colorPath]:i.fill:e.fill,n._color=e.fill);r._isSVG?(t.setAttribute("fill",e.fill),t.setAttribute("stroke",e.stroke),t.setAttribute("stroke-width",e.strokeThickness)):(t.fillcolor=e.fill,t.strokecolor=e.stroke,t.strokeweight=e.strokeThickness);t.highlightcolor=t.highlightcolor},_fillColors:function(n,t,i,r,u,f,e){if(t!=null&&t.rangeColorMapping!=null)this._fillRangeColors(n,t.rangeColorMapping,i,r,e,u,f);else if(t!=null&&t.equalColorMapping!=null)this._fillEqualColors(n,t,i,f,e,u);else if(this.shapeSettings.colorPath!=null||this.bubbleSettings.colorPath!=null){var o=e?this.bubbleSettings:this.shapeSettings;this._fillIndividualColors(u,i,o,r,e,f)}},_fillEqualColors:function(n,i,r,u,f,e){var o=this;t.each(i.equalColorMapping,function(t,s){(s.value==n||o._checkColorMapProperty(o,u,i,s,n))&&(f?(rangeBubbles={index:t},e.mapRangeBubbleIndex=rangeBubbles):(rangeShapes={index:t},e.mapRangeShapeIndex=rangeShapes),_isSVG?r.setAttribute("fill",s.color):r.fillcolor=s.color,r.highlightcolor=s.highlightcolor)})},isArray:function(n){return Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"}),Array.isArray(n)},_checkAlternateDataPath:function(n,t,i){var f,r,u;if(t&&this.isArray(t))return this._compareArrayWithValue(t,i);if(typeof t=="string"||t instanceof String){if(r=n[t],r&&this.isArray(r))return this._compareArrayWithValue(r,i);if(r!=null){for(r=r.split(","),u=0;u<r.length;u++)if(f=n[r[u]],f&&this._checkString(f,i))return!0;return!1}}},_checkColorMapProperty:function(n,t,i,r,u){return this._checkString(t[n.shapePropertyPath],r.value)||r.alternateValues&&this._checkAlternateDataPath(r,"alternateValues",u)||r.alternatePropertyValues&&this._checkAlternatePropertyPath(t,r.alternatePropertyValues,r.value)},_checkString:function(n,t,i){return i?n===t:n!=null&&t!=null&&n.toString().toLowerCase()===t.toString().toLowerCase()},_checkAlternatePropertyPath:function(n,t,i){var u,r,f;if(this.isArray(t))return this._compareArrayWithValue(t,i);if(typeof t=="string"||t instanceof String)for(u=t.split(","),r=0;r<u.length;r++)if(f=n[u[r]],f&&this._checkString(f,i))return!0;return!1},_compareArrayWithValue:function(n,t){if(this.isArray(n))for(var i=0;i<n.length;i++)if(this._checkString(n[i],t))return!0},_checkAlternatePath:function(n,t,i){for(var f=n.alternateDataPath,e=n.shapeDataPath,u=n.dataSource,o=n.alternatePropertyPath,r=0;r<u.length;r++)if(this._checkAlternateDataPath(u[r],f,i)||this._checkAlternatePropertyPath(t,o,u[r][e]))return r;return!1},_colorNameToHex:function(n){var t=n,i={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return Object.prototype.toString.call(t)=="[object Array]"?t:typeof i[t.toLowerCase()]!="undefined"?i[t.toLowerCase()]:t},_updateLegendRange:function(n,i,f,e){for(var a,o,v,y,p,c,h,l,b,w=i.shapeSettings.colorMappings.rangeColorMapping,s=0;s<w.length;s++)if(a=null,o=w[s],i.shapeSettings.enableGradient&&!r.util.isNullOrUndefined(o.gradientColors)&&(a=this._generateGradientCollection(o.gradientColors)),n>=o.from&&n<=o.to)for(v=s,s!=0&&(v=s*10),y={index:s,color:o.color,shapeColor:null},e.mapRangeShapeIndex=y,p=o.from,c=o.from+(o.to-o.from)/10,h=v;h<v+10;h++){if(n>=p&&n<=c)return l={},b=this._getColorRatio(.7,1,n,o.from,o.to),i._legendRects[h]!=u&&(l=i._legendRects[h]),l.color=i.shapeSettings.enableGradient&&!r.util.isNullOrUndefined(o.gradientColors)?s!=0?a[h-s*10]:a[h]:o.color,t(f).css({opacity:b}),y.shapeColor=l.color,l;p=c;c=c+(o.to-o.from)/10}},_fillRangeColors:function(n,i,u,f,e,o,s){for(var h,a,l,p,w,y,b,c=0;c<i.length;c++)if(h=i[c],r.util.isNullOrUndefined(h.gradientColors)||(gradientCollection=this._generateGradientCollection(h.gradientColors)),n>=h.from&&n<=h.to){a=c;c!=0&&(a=c*10);var k=h.from,d=Math.ceil((h.to-h.from)/10),v=h.from+d;for(l=a;l<a+10;l++)n>=k&&n<=v&&(b=e&&!r.util.isNullOrUndefined(h.gradientColors)?this._getColorRatio(.7,1,n,h.from,h.to):this.bubbleSettings.bubbleOpacity,y={from:h.from,to:h.to,fill:h.color,value:n,bubbleOpacity:this.bubbleSettings.bubbleOpacity,shapeData:o,shapeProperty:s},e?(w={index:c,color:h.color,isBubble:e},o.mapRangeBubbleIndex=w,f._trigger("bubbleRendering",{model:f.model,data:y})):(p={index:c,color:h.color},o.mapRangeShapeIndex=p,f._trigger("shapeRendering",{model:f.model,data:y})),r.util.isNullOrUndefined(h.gradientColors)||(h.color=c!=0?gradientCollection[l-c*10]:gradientCollection[l]),_isSVG?u.setAttribute("fill",h.color):u.fillcolor=h.color,u.highlightcolor=h.highlightcolor,t(u).css({opacity:b})),k=v,v=v+d}return h.color},_getColorRatio:function(n,t,i,r,u){var f=100/(u-r)*(i-r);return(parseFloat(t)-parseFloat(n))/100*f+parseFloat(n)}};t.fn.pinchZoom=function(n,i){var f,u,e=this[0],r=[],o=function(n){var t=e.createSVGPoint(),r=n.targetTouches,u,f,i;return r.length&&(i=r[0],u=i.pageX,f=i.pageY),t.x=u,t.y=f,t};handleTouchStart=function(i){var y=n,e,s,c,l,h,a,v;if(u=y.getCTM().inverse(),f=o(i).matrixTransform(u),e=i.touches,e.length>=2)for(s=0;s<e.length;s++){for(c=e[s],l=!1,h=0;h<r.length;h++)if(a=r[h],c.identifier===a.identifier){l=!0;break}l||(v=t.extend({},c),r.push(v))}i.preventDefault()};getDistance=function(n,t){var i=t.pageX-n.pageX,r=t.pageY-n.pageY;return Math.sqrt(i*i+r*r)};setCTM=function(n,t){var r=null,u="matrix("+t.a+","+t.b+","+t.c+","+t.d+","+t.e+","+t.f+")";t.a>i._baseScale&&i.enableZoom()&&i.enablePan()&&(t.a>i._scale?r=!0:t.a<i._scale&&(r=!1),i._scale=t.a,i._translatePoint.x=t.e/t.a,i._translatePoint.y=t.f/t.a,i._applyTransform(i._scale,i._translatePoint),i.zoomLevel(i._scale-i._baseScale+1),r!=null&&r?(i._trigger("zoomedIn",{originalEvent:null,zoomLevel:i.zoomLevel()}),i._updateSliderValue(!1),i._resizeShape()):r!=null&&(i._trigger("zoomedOut",{originalEvent:null,zoomLevel:i.zoomLevel()}),i._updateSliderValue(!1),i._resizeShape()),i._isDragging=!0,i._refrshLayers())};handleTouchEnd=function(n){for(var e,t,u,o,f=n.changedTouches,i=0;i<f.length;i++)for(e=f[i],t=0;t<r.length;t++)u=r[t],u.identifier===e.identifier&&(o=r.indexOf(u),r.splice(o,1))};updateTouch=function(n,t){n.pageX=t.pageX;n.pageY=t.pageY};handleTouchMove=function(t){var s,h,v,i,a;if(t.preventDefault(),s=n,h=t.touches,h.length>=2){var c=h[0],l=h[1],y=r[0],p=r[1];v=getDistance(c,l)/getDistance(y,p);i=e.createSVGPoint();i.x=(c.pageX+l.pageX)/2;i.y=(c.pageY+l.pageY)/2;i=i.matrixTransform(s.getCTM().inverse());a=e.createSVGMatrix().translate(i.x,i.y).scale(v).translate(-i.x,-i.y);setCTM(s,s.getCTM().multiply(a));typeof u=="undefined"&&(u=s.getCTM().inverse());u=u.multiply(a.inverse());updateTouch(y,c);updateTouch(p,l)}else r.length||(i=o(t).matrixTransform(u),setCTM(s,u.inverse().translate(i.x-f.x,i.y-f.y)))};this[0].addEventListener("touchstart",handleTouchStart,!1);this[0].addEventListener("touchend",handleTouchEnd,!1);this[0].addEventListener("touchmove",handleTouchMove,!1)};t.uaMatch=function(n){n=n.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[];return{browser:t[1]||"",version:t[2]||"0"}};r.datavisualization.Map.LayerType={Geometry:"geometry",OSM:"osm",Bing:"bing"};r.datavisualization.Map.LegendIcons={Rectangle:"rectangle",Circle:"circle"};r.datavisualization.Map.LabelSize={Fixed:"fixed",Default:"default"};r.datavisualization.Map.LegendMode={Default:"default",Interactive:"interactive"};r.datavisualization.Map.BingMapType={Aerial:"aerial",AerialWithLabel:"aerialwithlabel",Road:"road"};r.datavisualization.Map.GeometryType={Normal:"normal",Geographic:"geographic"};r.datavisualization.Map.SelectionMode={Default:"default",Multiple:"multiple"};r.datavisualization.Map.ColorPalette={Palette1:"palette1",Palette2:"palette2",Palette3:"palette3",CustomPalette:"custompalette"};r.datavisualization.Map.LegendType={Layers:"layers",Bubbles:"bubbles"};r.datavisualization.Map.Position={None:"none",TopLeft:"topleft",TopCenter:"topcenter",TopRight:"topright",CenterLeft:"centerleft",Center:"center",CenterRight:"centerright",BottomLeft:"bottomleft",BottomCenter:"bottomcenter",BottomRight:"bottomright"};r.datavisualization.Map.DockPosition={Top:"top",Bottom:"bottom",Right:"right",Left:"left"};r.datavisualization.Map.Alignment={Near:"near",Center:"center",Far:"far"};r.datavisualization.Map.LabelOrientation={Horizontal:"horizontal",Vertical:"vertical"}})(bbdesigner$,SyncfusionBoldBIDashboard);
