var designerServiceUrl="",dashboardServerUrl="",designerToken="";function renderdataCachePage(){var e={serviceUrl:designerServiceUrl,serverUrl:dashboardServerUrl,appVersion:appVersion,serviceAuthorizationToken:designerToken,mode:BoldBIDashboard.Designer.mode.datacache,designerAppSettings:{cacheSettingServerInfo:dataCache},actionComplete:$.proxy(afterSaveDataCacheSettings,this)};new BoldBIDashboardDesigner($("#dataCacheDesigner"),e)}function afterSaveDataCacheSettings(e){$("#body").BoldBIDashboardWaitingPopup("hide"),e.data.status?successToast(window.Server.App.Localization.UpdateSettingsSuccess,7e3):e.data.status||""==e.data.message||warningToast(window.Server.App.Localization.DataCacheErrorMessage,e.data.message,7e3,window.Server.App.Localization.Error)}$(document).ready(function(){designerServiceUrl=$('meta[name="designer_service:url"]').attr("content"),dashboardServerUrl=$('meta[name="dashboard_server:url"]').attr("content"),designerToken=$('meta[name="designer_service:access_token"]').attr("content"),renderdataCachePage();var e=createLoader("body"),n=($("#body").BoldBIDashboardWaitingPopup({template:$("#"+e)}),"0"===$("input[name=databaseType]:checked").val());function t(){$("#connection-validation").find(".validation-errors").html(""),$("#connection-validation").addClass("display-none")}$("#connection-validation").addClass("display-none"),$("#database-type").on("change",function(){var e=$("#database-type").val().toLowerCase(),a="windows"===$("#check-windows").val();"mssql"===e?($("#database-selection-field").show(),$(".ssl-checkbox").show(),$("#service-instance-form").hide(),$("#db-content-holder").show(),$("#db-content-holder").removeClass("display-none"),$("#port-number-dropdown").removeClass("show").addClass("hide"),$("#maintenance-db-dropdown").removeClass("show").addClass("hide"),$("#authentication-dropdown").removeClass("hide").addClass("show"),$("#service-instance-name").val(""),$("#new-db-form").removeClass("form-fields-top-margin"),$("#existing-db-form").removeClass("form-fields-top-margin"),$("#oracle-alert-message").hide(),a?($("#txt-login").val("").attr("disabled",!0),$("#txt-password-db").val("").attr("disabled",!0)):($("#txt-login").attr("disabled",!1),$("#txt-password-db").attr("disabled",!1)),$("a.redirect-link").attr("href",mssqlConnectionParameterHelpLink)):"postgresql"===e?($("#database-selection-field").show(),$(".ssl-checkbox").show(),$("#service-instance-form").hide(),$("#db-content-holder").show(),$("#db-content-holder").removeClass("display-none"),$("#authentication-dropdown").removeClass("show").addClass("hide"),$("#port-number-dropdown").removeClass("hide").addClass("show"),$("#maintenance-db-dropdown").removeClass("hide").addClass("show"),$("#txt-login").attr("disabled",!1),$("#txt-password-db").attr("disabled",!1),$("#txt-maintenancedb").val(maintenanceDb),$("#txt-portnumber").val(postgrePortNumber),$("#service-instance-name").val(""),$("#existing-db-form").removeClass("form-fields-top-margin"),$("#new-db-form").removeClass("form-fields-top-margin"),$("a.redirect-link").attr("href",postgresqlConnectionParameterHelpLink),$("#oracle-alert-message").hide()):"mysql"===e?($("#database-selection-field").show(),$(".ssl-checkbox").show(),$("#service-instance-form").hide(),$("#db-content-holder").show(),$("#db-content-holder").removeClass("display-none"),$("#authentication-dropdown").removeClass("show").addClass("hide"),$("#port-number-dropdown").removeClass("hide").addClass("show"),$("#maintenance-db-dropdown").removeClass("show").addClass("hide"),$("#txt-login").attr("disabled",!1),$("#txt-password-db").attr("disabled",!1),$("#txt-portnumber").val(mysqlPortNumber),$("#service-instance-name").val(""),$("#existing-db-form").removeClass("form-fields-top-margin"),$("#new-db-form").removeClass("form-fields-top-margin"),$("a.redirect-link").attr("href",mysqlConnectionParameterHelpLink),$("#oracle-alert-message").hide()):"oracle"===e?($("#database-selection-field").hide(),$(".ssl-checkbox").hide(),$("#service-instance-form").show(),$("#db-content-holder").show(),$("#db-content-holder").removeClass("display-none"),$("#authentication-dropdown").removeClass("show").addClass("hide"),$("#port-number-dropdown").removeClass("hide").addClass("show"),$("#maintenance-db-dropdown").removeClass("show").addClass("hide"),$("#txt-login").attr("disabled",!1),$("#txt-password-db").attr("disabled",!1),$("#txt-portnumber").val(oraclePortNumber),$("#existing-db-form").addClass("form-fields-top-margin"),$("#new-db-form").addClass("form-fields-top-margin"),$("a.redirect-link").attr("href",oracleConnectionParameterHelpLink),n=!1,$("#oracle-alert-message").show()):($("#db-content-holder").addClass("display-none"),$("#port-number-dropdown").removeClass("show").addClass("hide"),$("#maintenance-db-dropdown").removeClass("show").addClass("hide"),$("#authentication-dropdown").removeClass("hide").addClass("show"),$("#database-name").html("<option value='' class='display-none'>"+window.Server.App.Localization.SelectDatabase+"</option>").selectpicker("refresh"),$("#txt-servername").val(""),$("#txt-dbname").val(""),$("#txt-login").val(""),$("#txt-password-db").val(""))}),$("#check-windows").on("click change",function(){var e="windows"==$("#check-windows").val();$("#database-type").val();e?($("#txt-login").val("").attr("disabled",!0),$("#txt-password-db").val("").attr("disabled",!0)):($("#txt-login").attr("disabled",!1),$("#txt-password-db").attr("disabled",!1)),$(".has-error").removeClass("has-error"),$(".validation-txt-errors").hide()}),$("input[type=radio][name=databaseType]").change(function(){var e;t(),("0"===$(this).val()?($("#existing-db-form").addClass("display-none"),$("#new-db-form").removeClass("display-none"),$("#txt-dbname").val(""),n=!0,$(".sql-server-new-db")):($("#existing-db-form").removeClass("display-none"),$("#new-db-form").addClass("display-none"),e=$("#database-name").attr("data-text-value"),$("#database-name").val(e),n=!1,$(".sql-server-existing-db"))).find(".startup-validation").hide()}),$.validator.addMethod("isValidDatabaseName",function(e,a){if(/^[a-zA-Z_0-9@~!#\$\^&()+=\-,\.\/\{\} ]+$/.test(e)&&!/^[\s]+|[\s]+$/g.test(e))return!0},window.Server.App.Localization.AvoidLeadingTrailingSpace),$.validator.addMethod("sqlUsernamevalidation",function(e,a){if(/^[a-zA-Z_0-9@`~!#\$\^%&*()+=\-\[\]\\\',\.\/\{\}\|:<>\? ]+$/.test(e)&&!/^[\s]/g.test(e))return!0},window.Server.App.Localization.AvoidLeadingSpace),$.validator.addMethod("isValidCredentials",function(e,a){return/^[a-zA-Z_0-9@`~!#\$\^%&*()+=\-\[\]\\\',\.\/\{\}\|:<>\? ]+$/.test(e)},window.Server.App.Localization.AvoidSpecialCharacters),$("#db-content-holder").validate({errorElement:"span",onkeyup:function(e,a){t(),9!=a.keyCode&&(isKeyUp=!0,$(e).valid(),isKeyUp=!1)},onfocusout:function(e){$(e).valid()},rules:{servername:{isRequired:!0},portnumber:{isRequired:!0},maintenancedatabase:{isRequired:!0},username:{required:!0,sqlUsernamevalidation:!0},password:{required:!0,isValidCredentials:!0},serviceinstance:{required:!0},dbname:{required:{depends:function(){return"0"===$("input[name='databaseType']:checked").val()||"1"===$("input[name='databaseType']:checked").val()}},isValidDatabaseName:{depends:function(){return"0"===$("input[name='databaseType']:checked").val()}}}},highlight:function(e){$(e).closest(".txt-holder").addClass("has-error"),$(e).closest(".text-holder").addClass("has-error"),$(e).parent().find(">.startup-validation").show()},unhighlight:function(e){$(e).closest(".txt-holder").removeClass("has-error"),$(e).closest(".text-holder").removeClass("has-error"),$(e).parent().find(">.startup-validation").hide()},errorPlacement:function(e,a){$(a).parent().find(">.startup-validation").html(e.html())},messages:{servername:{isRequired:window.Server.App.Localization.ServerNamevalidator},portnumber:{isRequired:window.Server.App.Localization.PortValidator},maintenancedatabase:{isRequired:window.Server.App.Localization.MaintenanceDatabaseValidator},username:{required:window.Server.App.Localization.UserNameValidator},password:{required:window.Server.App.Localization.PasswordValidator},dbname:{required:window.Server.App.Localization.DatabaseValidator},serviceinstance:{required:window.Server.App.Localization.ServiceNameValidator}}}),$(document).on("click",".databse-dropdown .dropdown-toggle",function(){var e;$(".databse-dropdown ul").html(""),$("#database-name").html("<option value='' class='display-none'>"+window.Server.App.Localization.SelectDatabase+"</option>").selectpicker("refresh"),("windows"===$("#check-windows").val()?!$("#txt-servername").valid():($("#txt-login").valid(),$("#txt-servername").valid(),$("#txt-portnumber").valid(),$("#txt-maintenancedb").valid(),$("#txt-password-db").valid(),""===$("#txt-login").val()||""===$("#txt-servername").val()||""===$("#txt-password-db").val()))||($("#waiting-icon").show(),window.serverName=$("#txt-servername").val(),window.portNumber=$("#txt-portnumber").val(),window.maintenanceDatabase=$("#txt-maintenancedb").val(),window.IsWindowsAuthentication="windows"==$("#check-windows").val(),window.login=$("#txt-login").val(),window.password=$("#txt-password-db").val(),e=$("#database-type").val(),window.databaseName=$("#txt-dbname").val(),window.sslEnabled=$("#secure-sql-connection").is(":checked"),doAjaxPost("POST",getAllDatabaseUrl,{data:JSON.stringify({ServerType:e,serverName:window.serverName,Port:window.portNumber,maintenanceDatabase:window.maintenanceDatabase,userName:window.login,password:window.password,IsWindowsAuthentication:window.IsWindowsAuthentication,sslEnabled:window.sslEnabled})},function(e){if(e.Data.key){$("#database-error").hide(),$("#connection-validation").addClass("display-none");var a=e.Data.value,t="";if(0<a.length){for(var n=0;n<a.length;n++)t+='<option value="'+a[n]+'">'+a[n]+"</option>";$("#connection-validation").find(".validation-errors").html(""),$("#database-name").append(t).selectpicker("refresh");for(var i=0;i<$("#db-content-holder .databse-dropdown .bootstrap-select li a .text").length;i++){var o=$("#db-content-holder .databse-dropdown .bootstrap-select li a .text").eq(i).text();$("#db-content-holder .databse-dropdown .bootstrap-select li a").eq(i).attr("title",o)}}else $("#database-name").selectpicker("refresh").html("<option value='' class='display-none'>"+window.Server.App.Localization.SelectDatabase+"</option>").selectpicker("refresh"),$(".databse-dropdown ul").html("<li class='no-results active' title='"+window.Server.App.Localization.NodatabaseTitle+"' style='display: list-item;'>"+window.Server.App.Localization.Nodatabase+"</li>")}else $("#database-name").html("<option value='' class='display-none'>"+window.Server.App.Localization.SelectDatabase+"</option>").selectpicker("refresh"),$("#connection-validation").find(".validation-errors").html(e.Data.value).css("display","block");$("#waiting-icon").hide()}))}),$("#database-type-dropdown, #auth-type-dropdown, #secure-sql-connection").on("click",function(){t()}),$("#update-datastore-settings").on("click",function(){var e,a,t;n?($(".has-error").removeClass("has-error"),$(".validation-txt-errors").hide(),$(".validation-errors").html(""),$("#connection-validation").addClass("display-none"),$("#update-datastore-settings").prop("disabled",!0),$("#db-content-holder").valid()&&($("#content-area").ejWaitingPopup("show"),window.serverName=$("#txt-servername").val(),window.portNumber=$("#txt-portnumber").val(),window.maintenanceDatabase=$("#txt-maintenancedb").val(),window.IsWindowsAuthentication="windows"==$("#check-windows").val(),window.login=$("#txt-login").val(),window.password=$("#txt-password-db").val(),t=$("#database-type").val(),window.databaseName=$("#txt-dbname").val(),window.imDbAdditionalParameters=$("#additional-db-parameter").val(),window.sslEnabled=$("#secure-sql-connection").is(":checked"),doAjaxPost("POST",connectDatabaseUrl,{data:JSON.stringify({ServerType:t,serverName:window.serverName,Port:window.portNumber,maintenanceDatabase:window.maintenanceDatabase,userName:window.login,password:window.password,IsWindowsAuthentication:window.IsWindowsAuthentication,databaseName:window.databaseName,imDbAdditionalParameters:window.imDbAdditionalParameters,sslEnabled:window.sslEnabled,isNewDatabase:!0})},function(e){e.Data.key?doAjaxPost("POST",generateIntermediateDatabaseUrl,{data:JSON.stringify({ServerType:t,serverName:window.serverName,Port:window.portNumber,maintenanceDatabase:window.maintenanceDatabase,userName:window.login,password:window.password,IsWindowsAuthentication:window.IsWindowsAuthentication,databaseName:window.databaseName,imDbAdditionalParameters:window.imDbAdditionalParameters,sslEnabled:window.sslEnabled,Prefix:""})},function(e){e.Data.key?($(".selected").removeClass("selected"),window.connectionString=e.Data.value,doAjaxPost("POST",updateIntermediateDBUrl,{data:JSON.stringify({ServerType:t,serverName:window.serverName,Port:window.portNumber,maintenanceDatabase:window.maintenanceDatabase,userName:window.login,password:window.password,IsWindowsAuthentication:window.IsWindowsAuthentication,databaseName:window.databaseName,imDbAdditionalParameters:window.imDbAdditionalParameters,sslEnabled:window.sslEnabled,Prefix:""})},function(e){null!=e.Data&&e.Data.key?successToast(window.Server.App.Localization.UpdateSettingsSuccess,7e3):warningToast(null!=e.permissionDenied&&e.permissionDenied?window.Server.App.Localization.PermissionWarningAlert+" "+window.Server.App.Localization.ReloadPage:window.Server.App.Localization.DataStoreErrorMessage,null!=e.permissionDenied&&e.permissionDenied?null:e.message,(new Date).getTime(),window.Server.App.Localization.DatabaseSettings),$("#content-area").ejWaitingPopup("hide")}),$("#txt-username").focus(),$("#database-name").attr("data-text-value",window.databaseName),delete window.serverName,delete window.portNumber,delete window.maintenanceDatabase,delete window.login,delete window.password,delete window.databaseName,delete window.imDbAdditionalParameters,delete window.serviceInstance,delete window.sslEnabled):($("#content-area").ejWaitingPopup("hide"),$("#connection-validation").removeClass("display-none"),$("#connection-validation").find(".validation-errors").html(e.Data.value).css("display","block"))}):($("#content-area").ejWaitingPopup("hide"),$("#connection-validation").removeClass("display-none"),$("#connection-validation").find(".validation-errors").html(e.Data.value).css("display","block"))})),$("#update-datastore-settings").prop("disabled",!1)):($(".has-error").removeClass("has-error"),$(".validation-txt-errors").hide(),$(".validation-errors").html(""),$("#connection-validation").addClass("display-none"),e=$("#db-content-holder").valid(),""==$("#database-name").val()?$("#database-error").html(window.Server.App.Localization.DatabaseType).show():e&&($("#content-area").ejWaitingPopup("show"),$("#update-datastore-settings").prop("disabled",!0),window.serverName=$("#txt-servername").val(),window.portNumber=$("#txt-portnumber").val(),window.maintenanceDatabase=$("#txt-maintenancedb").val(),window.IsWindowsAuthentication="windows"==$("#check-windows").val(),window.login=$("#txt-login").val(),window.password=$("#txt-password-db").val(),a="SQLite"==(a=$("#database-type").val())?"MSSQLCE":a,window.databaseName=(""==$("#database-name").val()?$("#txt-dbname"):$("#database-name")).val(),window.imDbAdditionalParameters=$("#additional-db-parameter").val(),window.sslEnabled=$("#secure-sql-connection").is(":checked"),window.serviceInstance=$("#service-instance-name").val(),doAjaxPost("POST",connectDatabaseUrl,{data:JSON.stringify({ServerType:a,serverName:window.serverName,Port:window.portNumber,maintenanceDatabase:window.maintenanceDatabase,userName:window.login,password:window.password,IsWindowsAuthentication:window.IsWindowsAuthentication,databaseName:window.databaseName,imDbAdditionalParameters:window.imDbAdditionalParameters,serviceInstance:window.serviceInstance,sslEnabled:window.sslEnabled,isNewDatabase:!1})},function(e){e.Data.key?(doAjaxPost("POST",updateIntermediateDBUrl,{data:JSON.stringify({ServerType:a,serverName:window.serverName,Port:window.portNumber,maintenanceDatabase:window.maintenanceDatabase,userName:window.login,password:window.password,IsWindowsAuthentication:window.IsWindowsAuthentication,databaseName:window.databaseName,imDbAdditionalParameters:window.imDbAdditionalParameters,serviceInstance:window.serviceInstance,sslEnabled:window.sslEnabled,Prefix:""})},function(e){null!=e.Data&&e.Data.key?(successToast(window.Server.App.Localization.UpdateSettingsSuccess,7e3),$("#database-name").attr("data-text-value",$("#database-name").val())):warningToast(null!=e.permissionDenied&&e.permissionDenied?window.Server.App.Localization.PermissionWarningAlert+" "+window.Server.App.Localization.ReloadPage:window.Server.App.Localization.DataStoreErrorMessage,null!=e.permissionDenied&&e.permissionDenied?null:e.message,null,window.Server.App.Localization.DatabaseSettings),$("#update-datastore-settings").prop("disabled",!1),$("#content-area").ejWaitingPopup("hide")}),delete window.serverName,delete window.portNumber,delete window.maintenanceDatabase,delete window.login,delete window.password,delete window.databaseName,delete window.imDbAdditionalParameters,delete window.sslEnabled,delete window.serviceInstance):($("#update-datastore-settings").prop("disabled",!1),$("#connection-validation").removeClass("display-none"),$("#connection-validation").find(".validation-errors").html(e.Data.value).css("display","block"),$("#content-area").ejWaitingPopup("hide"))})))}),setTimeout(function(){addTitleForDropdownList(".database-dropdown-margin")},1e3);e=window.location.search.toLowerCase();"?tab=data-store"===e?($('a[href="#data-store"]').tab("show"),$(".online-help-link").attr("href",dataStoreHelpLinkUrl),$("#datastore-settings-header").show(),$("#update-datastore-settings").show(),$("#update-datacache-settings").hide()):"?tab=data-cache"===e?($('a[href="#data-cache"]').tab("show"),$(".online-help-link").attr("href",datacacheHelpLinkUrl),$("#datastore-settings-header").show(),$("#update-datastore-settings").hide(),$("#update-datacache-settings").show()):($('a[href="#datastore-settings-tab"]').tab("show"),$("#datastore-settings-header").show(),$("#update-datastore-settings").show(),$("#update-datacache-settings").hide())}),$(document).on("click","a[data-toggle='tab']",function(e){"#data-store"==$(this).attr("href")?($(".online-help-link").attr("href",dataStoreHelpLinkUrl),$("#datastore-settings-header").show(),$("#update-datastore-settings").show(),$("#update-datacache-settings").hide()):"#data-cache"==$(this).attr("href")&&($('a[href="#data-cache"]').tab("show"),$(".online-help-link").attr("href",datacacheHelpLinkUrl),$("#datastore-settings-header").show(),$("#update-datastore-settings").hide(),$("#update-datacache-settings").show())}),$(document).on("click","#update-datacache-settings",function(){var e=$("#dataCacheDesigner, #dataCacheDesigner_datacache_validation_label").find(".bbi-datacache-error-txt");""!=e.html()&&null!=e.html()||$.ajax({type:"GET",url:datacachePagePermissionUrl,data:{scope:SettingsScopes.DataStoreSettings},success:function(e){var a;e.status?(a=$("#dataCacheDesigner").data("BoldBIDashboardDesigner"),$("#body").BoldBIDashboardWaitingPopup("show"),a.modules.dataCache.saveDataCacheSettings()):e.permissionDenied&&warningToast(window.Server.App.Localization.PermissionWarningAlert,null,(new Date).getTime(),window.Server.App.Localization.DatabaseSettings)}})});