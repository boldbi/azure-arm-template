!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.signalR=t():e.signalR=t()}(window,function(){return n=[function(e,t,n){n.r(t);n(1);var r=n(3);n.d(t,"VERSION",function(){return r.VERSION}),n.d(t,"AbortError",function(){return r.AbortError}),n.d(t,"HttpError",function(){return r.HttpError}),n.d(t,"TimeoutError",function(){return r.TimeoutError}),n.d(t,"HttpClient",function(){return r.HttpClient}),n.d(t,"HttpResponse",function(){return r.HttpResponse}),n.d(t,"DefaultHttpClient",function(){return r.DefaultHttpClient}),n.d(t,"HubConnection",function(){return r.HubConnection}),n.d(t,"HubConnectionState",function(){return r.HubConnectionState}),n.d(t,"HubConnectionBuilder",function(){return r.HubConnectionBuilder}),n.d(t,"MessageType",function(){return r.MessageType}),n.d(t,"LogLevel",function(){return r.LogLevel}),n.d(t,"HttpTransportType",function(){return r.HttpTransportType}),n.d(t,"TransferFormat",function(){return r.TransferFormat}),n.d(t,"NullLogger",function(){return r.NullLogger}),n.d(t,"JsonHubProtocol",function(){return r.JsonHubProtocol}),n.d(t,"Subject",function(){return r.Subject}),Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(e,t){return new Uint8Array(Array.prototype.slice.call(this,e,t))},writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0})},function(e,t,le){!function(ae){var ue;e.exports=function(){"use strict";function n(e){var t=typeof e;return e!==null&&(t==="object"||t==="function")}function u(e){return typeof e==="function"}var e=void 0;if(Array.isArray)e=Array.isArray;else e=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var r=e,o=0,i=void 0,s=void 0,c=function e(t,n){p[o]=t;p[o+1]=n;o+=2;if(o===2)if(s)s(f);else g()};function M(e){s=e}function O(e){c=e}var t=typeof window!=="undefined"?window:undefined,a=t||{},l=a.MutationObserver||a.WebKitMutationObserver,F=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]",N=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function W(){return function(){return process.nextTick(f)}}function U(){if(typeof i!=="undefined")return function(){i(f)};return h()}function q(){var e=0;var t=new l(f);var n=document.createTextNode("");t.observe(n,{characterData:true});return function(){n.data=e=++e%2}}function B(){var e=new MessageChannel;e.port1.onmessage=f;return function(){return e.port2.postMessage(0)}}function h(){var e=setTimeout;return function(){return e(f,1)}}var p=new Array(1e3);function f(){for(var e=0;e<o;e+=2){var t=p[e];var n=p[e+1];t(n);p[e]=undefined;p[e+1]=undefined}o=0}function J(){try{var e=ue;var t=le(!function e(){var t=new Error("Cannot find module 'vertx'");t.code="MODULE_NOT_FOUND";throw t}());i=t.runOnLoop||t.runOnContext;return U()}catch(e){return h()}}var g=void 0;if(F)g=W();else if(l)g=q();else if(N)g=B();else if(t===undefined&&"function"==="function")g=J();else g=h();function d(e,t){var n=this;var r=new this.constructor(b);if(r[y]===undefined)R(r);var o=n._state;if(o){var i=arguments[o-1];c(function(){return A(o,r,i,n._result)})}else I(n,r,e,t);return r}function v(e){var t=this;if(e&&typeof e==="object"&&e.constructor===t)return e;var n=new t(b);E(n,e);return n}var y=Math.random().toString(36).substring(16);function b(){}var m=void 0,w=1,S=2,L=new D;function V(){return new TypeError("You cannot resolve a promise with itself")}function X(){return new TypeError("A promises callback cannot return that same promise.")}function C(e){try{return e.then}catch(e){L.error=e;return L}}function Q(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function G(e,r,o){c(function(t){var n=false;var e=Q(o,r,function(e){if(n)return;n=true;if(r!==e)E(t,e);else P(t,e)},function(e){if(n)return;n=true;k(t,e)},"Settle: "+(t._label||" unknown promise"));if(!n&&e){n=true;k(t,e)}},e)}function z(t,e){if(e._state===w)P(t,e._result);else if(e._state===S)k(t,e._result);else I(e,undefined,function(e){return E(t,e)},function(e){return k(t,e)})}function T(e,t,n){if(t.constructor===e.constructor&&n===d&&t.constructor.resolve===v)z(e,t);else if(n===L){k(e,L.error);L.error=null}else if(n===undefined)P(e,t);else if(u(n))G(e,t,n);else P(e,t)}function E(e,t){if(e===t)k(e,V());else if(n(t))T(e,t,C(t));else P(e,t)}function K(e){if(e._onerror)e._onerror(e._result);H(e)}function P(e,t){if(e._state!==m)return;e._result=t;e._state=w;if(e._subscribers.length!==0)c(H,e)}function k(e,t){if(e._state!==m)return;e._state=S;e._result=t;c(K,e)}function I(e,t,n,r){var o=e._subscribers;var i=o.length;e._onerror=null;o[i]=t;o[i+w]=n;o[i+S]=r;if(i===0&&e._state)c(H,e)}function H(e){var t=e._subscribers;var n=e._state;if(t.length===0)return;var r=void 0,o=void 0,i=e._result;for(var s=0;s<t.length;s+=3){r=t[s];o=t[s+n];if(r)A(n,r,o,i);else o(i)}e._subscribers.length=0}function D(){this.error=null}var _=new D;function Y(e,t){try{return e(t)}catch(e){_.error=e;return _}}function A(e,t,n,r){var o=u(n),i=void 0,s=void 0,c=void 0,a=void 0;if(o){i=Y(n,r);if(i===_){a=true;s=i.error;i.error=null}else c=true;if(t===i){k(t,X());return}}else{i=r;c=true}if(t._state!==m);else if(o&&c)E(t,i);else if(a)k(t,s);else if(e===w)P(t,i);else if(e===S)k(t,i)}function Z(n,e){try{e(function e(t){E(n,t)},function e(t){k(n,t)})}catch(e){k(n,e)}}var j=0;function $(){return j++}function R(e){e[y]=j++;e._state=undefined;e._result=undefined;e._subscribers=[]}function ee(){return new Error("Array Methods must be provided an Array")}function ee(){return new Error("Array Methods must be provided an Array")}var te=function(){function e(e,t){this._instanceConstructor=e;this.promise=new e(b);if(!this.promise[y])R(this.promise);if(r(t)){this.length=t.length;this._remaining=t.length;this._result=new Array(this.length);if(this.length===0)P(this.promise,this._result);else{this.length=this.length||0;this._enumerate(t);if(this._remaining===0)P(this.promise,this._result)}}else k(this.promise,ee())}e.prototype._enumerate=function e(t){for(var n=0;this._state===m&&n<t.length;n++)this._eachEntry(t[n],n)};e.prototype._eachEntry=function e(t,n){var r=this._instanceConstructor;var o=r.resolve;if(o===v){var i=C(t);if(i===d&&t._state!==m)this._settledAt(t._state,n,t._result);else if(typeof i!=="function"){this._remaining--;this._result[n]=t}else if(r===x){var s=new r(b);T(s,t,i);this._willSettleAt(s,n)}else this._willSettleAt(new r(function(e){return e(t)}),n)}else this._willSettleAt(o(t),n)};e.prototype._settledAt=function e(t,n,r){var o=this.promise;if(o._state===m){this._remaining--;if(t===S)k(o,r);else this._result[n]=r}if(this._remaining===0)P(o,this._result)};e.prototype._willSettleAt=function e(t,n){var r=this;I(t,undefined,function(e){return r._settledAt(w,n,e)},function(e){return r._settledAt(S,n,e)})};return e}();function ne(e){return new te(this,e).promise}function re(o){var i=this;if(!r(o))return new i(function(e,t){return t(new TypeError("You must pass an array to race."))});else return new i(function(e,t){var n=o.length;for(var r=0;r<n;r++)i.resolve(o[r]).then(e,t)})}function oe(e){var t=this;var n=new t(b);k(n,e);return n}function ie(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function se(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var x=function(){function t(e){this[y]=$();this._result=this._state=undefined;this._subscribers=[];if(b!==e){typeof e!=="function"&&ie();this instanceof t?Z(this,e):se()}}t.prototype.catch=function e(t){return this.then(null,t)};t.prototype.finally=function e(t){var n=this;var r=n.constructor;return n.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})})};return t}();function ce(){var e=void 0;if(typeof ae!=="undefined")e=ae;else if(typeof self!=="undefined")e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if(n==="[object Promise]"&&!t.cast)return}e.Promise=x}return x.prototype.then=d,x.all=ne,x.race=re,x.resolve=v,x.reject=oe,x._setScheduler=M,x._setAsap=O,x._asap=c,x.polyfill=ce,(x.Promise=x).polyfill(),x}()}.call(this,le(2))},function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){n.r(t),n.d(t,"VERSION",function(){return g});var r=n(4),o=(n.d(t,"AbortError",function(){return r.AbortError}),n.d(t,"HttpError",function(){return r.HttpError}),n.d(t,"TimeoutError",function(){return r.TimeoutError}),n(5)),i=(n.d(t,"HttpClient",function(){return o.HttpClient}),n.d(t,"HttpResponse",function(){return o.HttpResponse}),n(6)),s=(n.d(t,"DefaultHttpClient",function(){return i.DefaultHttpClient}),n(10)),c=(n.d(t,"HubConnection",function(){return s.HubConnection}),n.d(t,"HubConnectionState",function(){return s.HubConnectionState}),n(17)),a=(n.d(t,"HubConnectionBuilder",function(){return c.HubConnectionBuilder}),n(15)),u=(n.d(t,"MessageType",function(){return a.MessageType}),n(9)),l=(n.d(t,"LogLevel",function(){return u.LogLevel}),n(20)),h=(n.d(t,"HttpTransportType",function(){return l.HttpTransportType}),n.d(t,"TransferFormat",function(){return l.TransferFormat}),n(14)),p=(n.d(t,"NullLogger",function(){return h.NullLogger}),n(25)),f=(n.d(t,"JsonHubProtocol",function(){return p.JsonHubProtocol}),n(16)),g=(n.d(t,"Subject",function(){return f.Subject}),"3.1.8")},function(e,t,n){n.r(t),n.d(t,"HttpError",function(){return i}),n.d(t,"TimeoutError",function(){return a}),n.d(t,"AbortError",function(){return h});r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])});var r,o,n=function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=(o=Error,n(s,o),s);function s(e,t){var n=this,r=this.constructor.prototype;return(n=o.call(this,e)||this).statusCode=t,n.__proto__=r,n}c=Error,n(u,c);var c,a=u;function u(e){var t=this,n=this.constructor.prototype;return(t=c.call(this,e=void 0===e?"A timeout occurred.":e)||this).__proto__=n,t}l=Error,n(p,l);var l,h=p;function p(e){var t=this,n=this.constructor.prototype;return(t=l.call(this,e=void 0===e?"An abort occurred.":e)||this).__proto__=n,t}},function(e,t,n){n.r(t),n.d(t,"HttpResponse",function(){return o}),n.d(t,"HttpClient",function(){return i});var r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o=function(e,t,n){this.statusCode=e,this.statusText=t,this.content=n},i=(s.prototype.get=function(e,t){return this.send(r({},t,{method:"GET",url:e}))},s.prototype.post=function(e,t){return this.send(r({},t,{method:"POST",url:e}))},s.prototype.delete=function(e,t){return this.send(r({},t,{method:"DELETE",url:e}))},s.prototype.getCookieString=function(e){return""},s);function s(){}},function(e,t,n){n.r(t),n.d(t,"DefaultHttpClient",function(){return a});var r,o,i=n(4),t=n(5),s=n(7),c=n(8),n=(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=(o=t.HttpClient,n(u,o),u.prototype.send=function(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new i.AbortError):e.method?e.url?this.httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},u.prototype.getCookieString=function(e){return this.httpClient.getCookieString(e)},u);function u(e){var t=o.call(this)||this;return"undefined"!=typeof XMLHttpRequest?t.httpClient=new c.XhrHttpClient(e):t.httpClient=new s.NodeHttpClient(e),t}},function(e,t,n){n.r(t),n.d(t,"NodeHttpClient",function(){return i});var r,o,t=n(5),n=(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=(o=t.HttpClient,n(s,o),s.prototype.send=function(){return Promise.reject(new Error("If using Node either provide an XmlHttpRequest polyfill or consume the cjs or esm script instead of the browser/signalr.js one."))},s);function s(e){return o.call(this)||this}},function(e,t,n){n.r(t),n.d(t,"XhrHttpClient",function(){return i});var r,o,s=n(4),c=n(5),a=n(9),t=(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=(o=c.HttpClient,t(u,o),u.prototype.send=function(o){var i=this;return o.abortSignal&&o.abortSignal.aborted?Promise.reject(new s.AbortError):o.method?o.url?new Promise(function(e,t){var n=new XMLHttpRequest,r=(n.open(o.method,o.url,!0),n.withCredentials=!0,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),o.headers);r&&Object.keys(r).forEach(function(e){n.setRequestHeader(e,r[e])}),o.responseType&&(n.responseType=o.responseType),o.abortSignal&&(o.abortSignal.onabort=function(){n.abort(),t(new s.AbortError)}),o.timeout&&(n.timeout=o.timeout),n.onload=function(){o.abortSignal&&(o.abortSignal.onabort=null),200<=n.status&&n.status<300?e(new c.HttpResponse(n.status,n.statusText,n.response||n.responseText)):t(new s.HttpError(n.statusText,n.status))},n.onerror=function(){i.logger.log(a.LogLevel.Warning,"Error from HTTP request. "+n.status+": "+n.statusText+"."),t(new s.HttpError(n.statusText,n.status))},n.ontimeout=function(){i.logger.log(a.LogLevel.Warning,"Timeout from HTTP request."),t(new s.TimeoutError)},n.send(o.content||"")}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},u);function u(e){var t=o.call(this)||this;return t.logger=e,t}},function(e,t,n){var r;n.r(t),n.d(t,"LogLevel",function(){return r}),(n=r=r||{})[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"},function(e,t,n){n.r(t),n.d(t,"HubConnectionState",function(){return a}),n.d(t,"HubConnection",function(){return o});var a,i=n(11),u=n(15),l=n(9),h=n(16),s=n(13),r=function(i,s,c,a){return new(c=c||Promise)(function(e,t){function n(e){try{o(a.next(e))}catch(e){t(e)}}function r(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(n,r)}o((a=a.apply(i,s||[])).next())})},p=function(r,o){var i,s,c,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(c=2&t[0]?s.return:t[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,t[1])).done)return c;switch(s=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(c=0<(c=a.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3]))a.label=t[1];else if(6===t[0]&&a.label<c[1])a.label=c[1],c=t;else{if(!(c&&a.label<c[2])){c[2]&&a.ops.pop(),a.trys.pop();continue}a.label=c[2],a.ops.push(t)}}t=o.call(r,a)}catch(e){t=[6,e],s=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},o=((t=a=a||{}).Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting",t.Reconnecting="Reconnecting",c.create=function(e,t,n,r){return new c(e,t,n,r)},Object.defineProperty(c.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(e){if(this.connectionState!==a.Disconnected&&this.connectionState!==a.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e},enumerable:!0,configurable:!0}),c.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},c.prototype.startWithStateTransitions=function(){return r(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:if(this.connectionState!==a.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=a.Connecting,this.logger.log(l.LogLevel.Debug,"Starting HubConnection."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return e.sent(),this.connectionState=a.Connected,this.connectionStarted=!0,this.logger.log(l.LogLevel.Debug,"HubConnection connected successfully."),[3,4];case 3:return t=e.sent(),this.connectionState=a.Disconnected,this.logger.log(l.LogLevel.Debug,"HubConnection failed to start successfully because of error '"+t+"'."),[2,Promise.reject(t)];case 4:return[2]}})})},c.prototype.startInternal=function(){return r(this,void 0,void 0,function(){var t,n,r,o=this;return p(this,function(e){switch(e.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,t=new Promise(function(e,t){o.handshakeResolver=e,o.handshakeRejecter=t}),[4,this.connection.start(this.protocol.transferFormat)];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),n={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(l.LogLevel.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(n))];case 3:return e.sent(),this.logger.log(l.LogLevel.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,t];case 4:if(e.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return r=e.sent(),this.logger.log(l.LogLevel.Debug,"Hub handshake failed with error '"+r+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(r)];case 6:throw e.sent(),r;case 7:return[2]}})})},c.prototype.stop=function(){return r(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return t=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,t];case 3:return e.sent(),[3,5];case 4:return e.sent(),[3,5];case 5:return[2]}})})},c.prototype.stopInternal=function(e){return this.connectionState===a.Disconnected?(this.logger.log(l.LogLevel.Debug,"Call to HubConnection.stop("+e+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===a.Disconnecting?(this.logger.log(l.LogLevel.Debug,"Call to HttpConnection.stop("+e+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=a.Disconnecting,this.logger.log(l.LogLevel.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(l.LogLevel.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=e||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(e)))},c.prototype.stream=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o,i=this.replaceStreamingParams(n),s=i[0],i=i[1],c=this.createStreamInvocation(e,n,i),a=new h.Subject;return a.cancelCallback=function(){var e=t.createCancelInvocation(c.invocationId);return delete t.callbacks[c.invocationId],o.then(function(){return t.sendWithProtocol(e)})},this.callbacks[c.invocationId]=function(e,t){t?a.error(t):e&&(e.type===u.MessageType.Completion?e.error?a.error(new Error(e.error)):a.complete():a.next(e.item))},o=this.sendWithProtocol(c).catch(function(e){a.error(e),delete t.callbacks[c.invocationId]}),this.launchStreams(s,o),a},c.prototype.sendMessage=function(e){return this.resetKeepAliveInterval(),this.connection.send(e)},c.prototype.sendWithProtocol=function(e){return this.sendMessage(this.protocol.writeMessage(e))},c.prototype.send=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.replaceStreamingParams(t),o=r[0],r=r[1],e=this.sendWithProtocol(this.createInvocation(e,t,!0,r));return this.launchStreams(o,e),e},c.prototype.invoke=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.replaceStreamingParams(n),i=o[0],o=o[1],s=this.createInvocation(e,n,!1,o);return new Promise(function(n,r){t.callbacks[s.invocationId]=function(e,t){t?r(t):e&&(e.type===u.MessageType.Completion?e.error?r(new Error(e.error)):n(e.result):r(new Error("Unexpected message type: "+e.type)))};var e=t.sendWithProtocol(s).catch(function(e){r(e),delete t.callbacks[s.invocationId]});t.launchStreams(i,e)})},c.prototype.on=function(e,t){e&&t&&(e=e.toLowerCase(),this.methods[e]||(this.methods[e]=[]),-1===this.methods[e].indexOf(t))&&this.methods[e].push(t)},c.prototype.off=function(e,t){var n;e&&(e=e.toLowerCase(),n=this.methods[e])&&(!t||-1!==(t=n.indexOf(t))&&(n.splice(t,1),0===n.length))&&delete this.methods[e]},c.prototype.onclose=function(e){e&&this.closedCallbacks.push(e)},c.prototype.onreconnecting=function(e){e&&this.reconnectingCallbacks.push(e)},c.prototype.onreconnected=function(e){e&&this.reconnectedCallbacks.push(e)},c.prototype.processIncomingData=function(e){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(e=this.processHandshakeResponse(e),this.receivedHandshakeResponse=!0),e)for(var t=0,n=this.protocol.parseMessages(e,this.logger);t<n.length;t++){var r=n[t];switch(r.type){case u.MessageType.Invocation:this.invokeClientMethod(r);break;case u.MessageType.StreamItem:case u.MessageType.Completion:var o=this.callbacks[r.invocationId];o&&(r.type===u.MessageType.Completion&&delete this.callbacks[r.invocationId],o(r));break;case u.MessageType.Ping:break;case u.MessageType.Close:this.logger.log(l.LogLevel.Information,"Close message received from server.");o=r.error?new Error("Server returned an error on close: "+r.error):void 0;!0===r.allowReconnect?this.connection.stop(o):this.stopPromise=this.stopInternal(o);break;default:this.logger.log(l.LogLevel.Warning,"Invalid message type: "+r.type+".")}}this.resetTimeoutPeriod()},c.prototype.processHandshakeResponse=function(e){var t,n,r;try{r=(t=this.handshakeProtocol.parseHandshakeResponse(e))[0],n=t[1]}catch(e){var o="Error parsing handshake response: "+e,i=(this.logger.log(l.LogLevel.Error,o),new Error(o));throw this.handshakeRejecter(i),i}if(n.error)throw o="Server returned handshake error: "+n.error,this.logger.log(l.LogLevel.Error,o),i=new Error(o),this.handshakeRejecter(i),i;return this.logger.log(l.LogLevel.Debug,"Server handshake complete."),this.handshakeResolver(),r},c.prototype.resetKeepAliveInterval=function(){var e=this;this.cleanupPingTimer(),this.pingServerHandle=setTimeout(function(){return r(e,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:if(this.connectionState!==a.Connected)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return e.sent(),[3,4];case 3:return e.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}})})},this.keepAliveIntervalInMilliseconds)},c.prototype.resetTimeoutPeriod=function(){var e=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return e.serverTimeout()},this.serverTimeoutInMilliseconds))},c.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},c.prototype.invokeClientMethod=function(t){var n=this,e=this.methods[t.target.toLowerCase()];if(e){try{e.forEach(function(e){return e.apply(n,t.arguments)})}catch(e){this.logger.log(l.LogLevel.Error,"A callback for the method "+t.target.toLowerCase()+" threw error '"+e+"'.")}t.invocationId&&(this.logger.log(l.LogLevel.Error,e="Server requested a response, which is not supported in this version of the client."),this.stopPromise=this.stopInternal(new Error(e)))}else this.logger.log(l.LogLevel.Warning,"No client method with the name '"+t.target+"' found.")},c.prototype.connectionClosed=function(e){this.logger.log(l.LogLevel.Debug,"HubConnection.connectionClosed("+e+") called while in state "+this.connectionState+"."),this.stopDuringStartError=this.stopDuringStartError||e||new Error("The underlying connection was closed before the hub handshake could complete."),this.handshakeResolver&&this.handshakeResolver(),this.cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this.cleanupTimeout(),this.cleanupPingTimer(),this.connectionState===a.Disconnecting?this.completeClose(e):this.connectionState===a.Connected&&this.reconnectPolicy?this.reconnect(e):this.connectionState===a.Connected&&this.completeClose(e)},c.prototype.completeClose=function(t){var n=this;if(this.connectionStarted){this.connectionState=a.Disconnected,this.connectionStarted=!1;try{this.closedCallbacks.forEach(function(e){return e.apply(n,[t])})}catch(e){this.logger.log(l.LogLevel.Error,"An onclose callback called with error '"+t+"' threw error '"+e+"'.")}}},c.prototype.reconnect=function(c){return r(this,void 0,void 0,function(){var t,n,r,o,i,s=this;return p(this,function(e){switch(e.label){case 0:if(t=Date.now(),r=void(n=0)!==c?c:new Error("Attempting to reconnect due to a unknown error."),null===(o=this.getNextRetryDelay(n++,0,r)))return this.logger.log(l.LogLevel.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(c),[2];if(this.connectionState=a.Reconnecting,c?this.logger.log(l.LogLevel.Information,"Connection reconnecting because of error '"+c+"'."):this.logger.log(l.LogLevel.Information,"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach(function(e){return e.apply(s,[c])})}catch(e){this.logger.log(l.LogLevel.Error,"An onreconnecting callback called with error '"+c+"' threw error '"+e+"'.")}if(this.connectionState!==a.Reconnecting)return this.logger.log(l.LogLevel.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}e.label=1;case 1:return null===o?[3,7]:(this.logger.log(l.LogLevel.Information,"Reconnect attempt number "+n+" will start in "+o+" ms."),[4,new Promise(function(e){s.reconnectDelayHandle=setTimeout(e,o)})]);case 2:if(e.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==a.Reconnecting)return this.logger.log(l.LogLevel.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(e.sent(),this.connectionState=a.Connected,this.logger.log(l.LogLevel.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach(function(e){return e.apply(s,[s.connection.connectionId])})}catch(e){this.logger.log(l.LogLevel.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+e+"'.")}return[2];case 5:return(i=e.sent(),this.logger.log(l.LogLevel.Information,"Reconnect attempt failed because of error '"+i+"'."),this.connectionState!==a.Reconnecting)?(this.logger.log(l.LogLevel.Debug,"Connection left the reconnecting state during reconnect attempt. Done reconnecting."),[2]):(r=i instanceof Error?i:new Error(i.toString()),o=this.getNextRetryDelay(n++,Date.now()-t,r),[3,6]);case 6:return[3,1];case 7:return this.logger.log(l.LogLevel.Information,"Reconnect retries have been exhausted after "+(Date.now()-t)+" ms and "+n+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}})})},c.prototype.getNextRetryDelay=function(t,n,e){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:n,previousRetryCount:t,retryReason:e})}catch(e){return this.logger.log(l.LogLevel.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+t+", "+n+") threw error '"+e+"'."),null}},c.prototype.cancelCallbacksWithError=function(t){var n=this.callbacks;this.callbacks={},Object.keys(n).forEach(function(e){(0,n[e])(null,t)})},c.prototype.cleanupPingTimer=function(){this.pingServerHandle&&clearTimeout(this.pingServerHandle)},c.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},c.prototype.createInvocation=function(e,t,n,r){return n?{arguments:t,streamIds:r,target:e,type:u.MessageType.Invocation}:(n=this.invocationId,this.invocationId++,{arguments:t,invocationId:n.toString(),streamIds:r,target:e,type:u.MessageType.Invocation})},c.prototype.launchStreams=function(e,r){var o=this;if(0!==e.length){r=r||Promise.resolve();for(var t in e)!function(n){e[n].subscribe({complete:function(){r=r.then(function(){return o.sendWithProtocol(o.createCompletionMessage(n))})},error:function(e){var t=e instanceof Error?e.message:e&&e.toString?e.toString():"Unknown error";r=r.then(function(){return o.sendWithProtocol(o.createCompletionMessage(n,t))})},next:function(e){r=r.then(function(){return o.sendWithProtocol(o.createStreamItemMessage(n,e))})}})}(t)}},c.prototype.replaceStreamingParams=function(e){for(var t=[],n=[],r=0;r<e.length;r++){var o,i=e[r];this.isObservable(i)&&(o=this.invocationId,this.invocationId++,t[o]=i,n.push(o.toString()),e.splice(r,1))}return[t,n]},c.prototype.isObservable=function(e){return e&&e.subscribe&&"function"==typeof e.subscribe},c.prototype.createStreamInvocation=function(e,t,n){var r=this.invocationId;return this.invocationId++,{arguments:t,invocationId:r.toString(),streamIds:n,target:e,type:u.MessageType.StreamInvocation}},c.prototype.createCancelInvocation=function(e){return{invocationId:e,type:u.MessageType.CancelInvocation}},c.prototype.createStreamItemMessage=function(e,t){return{invocationId:e,item:t,type:u.MessageType.StreamItem}},c.prototype.createCompletionMessage=function(e,t,n){return t?{error:t,invocationId:e,type:u.MessageType.Completion}:{invocationId:e,result:n,type:u.MessageType.Completion}},c);function c(e,t,n,r){var o=this;s.Arg.isRequired(e,"connection"),s.Arg.isRequired(t,"logger"),s.Arg.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.logger=t,this.protocol=n,this.connection=e,this.reconnectPolicy=r,this.handshakeProtocol=new i.HandshakeProtocol,this.connection.onreceive=function(e){return o.processIncomingData(e)},this.connection.onclose=function(e){return o.connectionClosed(e)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.reconnectingCallbacks=[],this.reconnectedCallbacks=[],this.invocationId=0,this.receivedHandshakeResponse=!1,this.connectionState=a.Disconnected,this.connectionStarted=!1,this.cachedPingMessage=this.protocol.writeMessage({type:u.MessageType.Ping})}},function(e,t,n){n.r(t),n.d(t,"HandshakeProtocol",function(){return r});var i=n(12),s=n(13),r=(o.prototype.writeHandshakeRequest=function(e){return i.TextMessageFormat.write(JSON.stringify(e))},o.prototype.parseHandshakeResponse=function(e){if(Object(s.isArrayBuffer)(e)||"undefined"!=typeof Buffer&&e instanceof Buffer){var t=new Uint8Array(e);if(-1===(o=t.indexOf(i.TextMessageFormat.RecordSeparatorCode)))throw new Error("Message is incomplete.");var n=o+1,r=String.fromCharCode.apply(null,t.slice(0,n)),t=t.byteLength>n?t.slice(n).buffer:null}else{if(-1===(o=e.indexOf(i.TextMessageFormat.RecordSeparator)))throw new Error("Message is incomplete.");n=o+1;r=e.substring(0,n),t=e.length>n?e.substring(n):null}var o=i.TextMessageFormat.parse(r),e=JSON.parse(o[0]);if(e.type)throw new Error("Expected a handshake response from the server.");return[t,e]},o);function o(){}},function(e,t,n){n.r(t),n.d(t,"TextMessageFormat",function(){return r});o.write=function(e){return""+e+o.RecordSeparator},o.parse=function(e){if(e[e.length-1]!==o.RecordSeparator)throw new Error("Message is incomplete.");e=e.split(o.RecordSeparator);return e.pop(),e},o.RecordSeparatorCode=30,o.RecordSeparator=String.fromCharCode(o.RecordSeparatorCode);var r=o;function o(){}},function(e,t,n){n.r(t),n.d(t,"Arg",function(){return o}),n.d(t,"Platform",function(){return s}),n.d(t,"getDataDetail",function(){return g}),n.d(t,"formatArrayBuffer",function(){return a}),n.d(t,"isArrayBuffer",function(){return d}),n.d(t,"sendMessage",function(){return u}),n.d(t,"createLogger",function(){return l}),n.d(t,"SubjectSubscription",function(){return v}),n.d(t,"ConsoleLogger",function(){return b});var h=n(9),r=n(14),p=function(i,s,c,a){return new(c=c||Promise)(function(e,t){function n(e){try{o(a.next(e))}catch(e){t(e)}}function r(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(n,r)}o((a=a.apply(i,s||[])).next())})},f=function(r,o){var i,s,c,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(c=2&t[0]?s.return:t[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,t[1])).done)return c;switch(s=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(c=0<(c=a.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3]))a.label=t[1];else if(6===t[0]&&a.label<c[1])a.label=c[1],c=t;else{if(!(c&&a.label<c[2])){c[2]&&a.ops.pop(),a.trys.pop();continue}a.label=c[2],a.ops.push(t)}}t=o.call(r,a)}catch(e){t=[6,e],s=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},o=(i.isRequired=function(e,t){if(null==e)throw new Error("The '"+t+"' argument is required.")},i.isIn=function(e,t,n){if(!(e in t))throw new Error("Unknown "+n+" value: "+e+".")},i);function i(){}Object.defineProperty(c,"isBrowser",{get:function(){return"object"==typeof window},enumerable:!0,configurable:!0}),Object.defineProperty(c,"isWebWorker",{get:function(){return"object"==typeof self&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(c,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0});var s=c;function c(){}function g(e,t){var n="";return d(e)?(n="Binary data of length "+e.byteLength,t&&(n+=". Content: '"+a(e)+"'")):"string"==typeof e&&(n="String data of length "+e.length,t)&&(n+=". Content: '"+e+"'"),n}function a(e){var e=new Uint8Array(e),t="";return e.forEach(function(e){t+="0x"+(e<16?"0":"")+e.toString(16)+" "}),t.substr(0,t.length-1)}function d(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function u(o,i,s,c,a,u,l){return p(this,void 0,void 0,function(){var t,n,r;return f(this,function(e){switch(e.label){case 0:return a?[4,a()]:[3,2];case 1:(n=e.sent())&&((t={}).Authorization="Bearer "+n,t=t),e.label=2;case 2:return o.log(h.LogLevel.Trace,"("+i+" transport) sending data. "+g(u,l)+"."),n=d(u)?"arraybuffer":"text",[4,s.post(c,{content:u,headers:t,responseType:n})];case 3:return r=e.sent(),o.log(h.LogLevel.Trace,"("+i+" transport) request complete. Response status: "+r.statusCode+"."),[2]}})})}function l(e){return void 0===e?new b(h.LogLevel.Information):null===e?r.NullLogger.instance:e.log?e:new b(e)}y.prototype.dispose=function(){var e=this.subject.observers.indexOf(this.observer);-1<e&&this.subject.observers.splice(e,1),0===this.subject.observers.length&&this.subject.cancelCallback&&this.subject.cancelCallback().catch(function(e){})};var v=y;function y(e,t){this.subject=e,this.observer=t}m.prototype.log=function(e,t){if(e>=this.minimumLogLevel)switch(e){case h.LogLevel.Critical:case h.LogLevel.Error:this.outputConsole.error("["+(new Date).toISOString()+"] "+h.LogLevel[e]+": "+t);break;case h.LogLevel.Warning:this.outputConsole.warn("["+(new Date).toISOString()+"] "+h.LogLevel[e]+": "+t);break;case h.LogLevel.Information:this.outputConsole.info("["+(new Date).toISOString()+"] "+h.LogLevel[e]+": "+t);break;default:this.outputConsole.log("["+(new Date).toISOString()+"] "+h.LogLevel[e]+": "+t)}};var b=m;function m(e){this.minimumLogLevel=e,this.outputConsole=console}},function(e,t,n){n.r(t),n.d(t,"NullLogger",function(){return r});o.prototype.log=function(e,t){},o.instance=new o;var r=o;function o(){}},function(e,t,n){var r;n.r(t),n.d(t,"MessageType",function(){return r}),(n=r=r||{})[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close"},function(e,t,n){n.r(t),n.d(t,"Subject",function(){return o});var r=n(13),o=(i.prototype.next=function(e){for(var t=0,n=this.observers;t<n.length;t++)n[t].next(e)},i.prototype.error=function(e){for(var t=0,n=this.observers;t<n.length;t++){var r=n[t];r.error&&r.error(e)}},i.prototype.complete=function(){for(var e=0,t=this.observers;e<t.length;e++){var n=t[e];n.complete&&n.complete()}},i.prototype.subscribe=function(e){return this.observers.push(e),new r.SubjectSubscription(this,e)},i);function i(){this.observers=[]}},function(e,t,n){n.r(t),n.d(t,"HubConnectionBuilder",function(){return h});var r=n(18),o=n(19),i=n(10),t=n(9),s=n(25),c=n(14),a=n(13),u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},l={trace:t.LogLevel.Trace,debug:t.LogLevel.Debug,info:t.LogLevel.Information,information:t.LogLevel.Information,warn:t.LogLevel.Warning,warning:t.LogLevel.Warning,error:t.LogLevel.Error,critical:t.LogLevel.Critical,none:t.LogLevel.None};p.prototype.configureLogging=function(e){var t;return a.Arg.isRequired(e,"logging"),void 0!==e.log?this.logger=e:"string"==typeof e?(t=function(e){var t=l[e.toLowerCase()];if(void 0!==t)return t;throw new Error("Unknown log level: "+e)}(e),this.logger=new a.ConsoleLogger(t)):this.logger=new a.ConsoleLogger(e),this},p.prototype.withUrl=function(e,t){return a.Arg.isRequired(e,"url"),this.url=e,this.httpConnectionOptions=u({},this.httpConnectionOptions,"object"==typeof t?t:{transport:t}),this},p.prototype.withHubProtocol=function(e){return a.Arg.isRequired(e,"protocol"),this.protocol=e,this},p.prototype.withAutomaticReconnect=function(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new r.DefaultReconnectPolicy(e):this.reconnectPolicy=e:this.reconnectPolicy=new r.DefaultReconnectPolicy,this},p.prototype.build=function(){var e=this.httpConnectionOptions||{};if(void 0===e.logger&&(e.logger=this.logger),this.url)return e=new o.HttpConnection(this.url,e),i.HubConnection.create(e,this.logger||c.NullLogger.instance,this.protocol||new s.JsonHubProtocol,this.reconnectPolicy);throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.")};var h=p;function p(){}},function(e,t,n){n.r(t),n.d(t,"DefaultReconnectPolicy",function(){return o});var r=[0,2e3,1e4,3e4,null],o=(i.prototype.nextRetryDelayInMilliseconds=function(e){return this.retryDelays[e.previousRetryCount]},i);function i(e){this.retryDelays=void 0!==e?e.concat([null]):r}},function(e,t,n){n.r(t),n.d(t,"HttpConnection",function(){return h}),n.d(t,"TransportSendQueue",function(){return f});var r=n(6),g=n(9),a=n(20),u=n(21),o=n(23),i=n(13),s=n(24),d=function(i,s,c,a){return new(c=c||Promise)(function(e,t){function n(e){try{o(a.next(e))}catch(e){t(e)}}function r(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(n,r)}o((a=a.apply(i,s||[])).next())})},v=function(r,o){var i,s,c,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(c=2&t[0]?s.return:t[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,t[1])).done)return c;switch(s=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(c=0<(c=a.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3]))a.label=t[1];else if(6===t[0]&&a.label<c[1])a.label=c[1],c=t;else{if(!(c&&a.label<c[2])){c[2]&&a.ops.pop(),a.trys.pop();continue}a.label=c[2],a.ops.push(t)}}t=o.call(r,a)}catch(e){t=[6,e],s=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},c=null,l=null,h=(i.Platform.isNode&&(t=require,c=t("ws"),l=t("eventsource")),p.prototype.start=function(n){return d(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return(n=n||a.TransferFormat.Binary,i.Arg.isIn(n,a.TransferFormat,"transferFormat"),this.logger.log(g.LogLevel.Debug,"Starting connection with transfer format '"+a.TransferFormat[n]+"'."),"Disconnected"!==this.connectionState)?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting ",this.startInternalPromise=this.startInternal(n),[4,this.startInternalPromise]);case 1:return(e.sent(),"Disconnecting"!==this.connectionState)?[3,3]:(t="Failed to start the HttpConnection before stop() was called.",this.logger.log(g.LogLevel.Error,t),[4,this.stopPromise]);case 2:return e.sent(),[2,Promise.reject(new Error(t))];case 3:if("Connected"!==this.connectionState)return t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!",this.logger.log(g.LogLevel.Error,t),[2,Promise.reject(new Error(t))];e.label=4;case 4:return this.connectionStarted=!0,[2]}})})},p.prototype.send=function(e){return"Connected"!==this.connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new f(this.transport)),this.sendQueue.send(e))},p.prototype.stop=function(n){return d(this,void 0,void 0,function(){var t=this;return v(this,function(e){switch(e.label){case 0:return"Disconnected"===this.connectionState?(this.logger.log(g.LogLevel.Debug,"Call to HttpConnection.stop("+n+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):"Disconnecting"===this.connectionState?(this.logger.log(g.LogLevel.Debug,"Call to HttpConnection.stop("+n+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise(function(e){t.stopPromiseResolver=e}),[4,this.stopInternal(n)]);case 1:return e.sent(),[4,this.stopPromise];case 2:return e.sent(),[2]}})})},p.prototype.stopInternal=function(n){return d(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:this.stopError=n,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:return e.sent(),[3,4];case 3:return e.sent(),[3,4];case 4:if(!this.transport)return[3,9];e.label=5;case 5:return e.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return e.sent(),[3,8];case 7:return t=e.sent(),this.logger.log(g.LogLevel.Error,"HttpConnection.transport.stop() threw error '"+t+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(g.LogLevel.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed."),this.stopConnection(),e.label=10;case 10:return[2]}})})},p.prototype.startInternal=function(c){return d(this,void 0,void 0,function(){var n,r,o,t,i,s;return v(this,function(e){switch(e.label){case 0:n=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,e.label=1;case 1:return(e.trys.push([1,12,,13]),this.options.skipNegotiation)?this.options.transport!==a.HttpTransportType.WebSockets?[3,3]:(this.transport=this.constructTransport(a.HttpTransportType.WebSockets),[4,this.startTransport(n,c)]):[3,5];case 2:return e.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:r=null,o=0,t=function(){var t;return v(this,function(e){switch(e.label){case 0:return[4,i.getNegotiationResponse(n)];case 1:if(r=e.sent(),"Disconnecting"===i.connectionState||"Disconnected"===i.connectionState)throw new Error("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return r.url&&(n=r.url),r.accessToken&&(t=r.accessToken,i.accessTokenFactory=function(){return t}),o++,[2]}})},i=this,e.label=6;case 6:return[5,t()];case 7:e.sent(),e.label=8;case 8:if(r.url&&o<100)return[3,6];e.label=9;case 9:if(100===o&&r.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(n,this.options.transport,r,c)];case 10:e.sent(),e.label=11;case 11:return this.transport instanceof u.LongPollingTransport&&(this.features.inherentKeepAlive=!0),"Connecting "===this.connectionState&&(this.logger.log(g.LogLevel.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return s=e.sent(),this.logger.log(g.LogLevel.Error,"Failed to start the connection: "+s),this.connectionState="Disconnected",this.transport=void 0,[2,Promise.reject(s)];case 13:return[2]}})})},p.prototype.getNegotiationResponse=function(i){return d(this,void 0,void 0,function(){var t,n,r,o;return v(this,function(e){switch(e.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(r=e.sent())&&((t={}).Authorization="Bearer "+r,t=t),e.label=2;case 2:n=this.resolveNegotiateUrl(i),this.logger.log(g.LogLevel.Debug,"Sending negotiation request: "+n+"."),e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.httpClient.post(n,{content:"",headers:t})];case 4:return 200!==(r=e.sent()).statusCode?[2,Promise.reject(new Error("Unexpected status code returned from negotiate "+r.statusCode))]:((!(o=JSON.parse(r.content)).negotiateVersion||o.negotiateVersion<1)&&(o.connectionToken=o.connectionId),[2,o]);case 5:return o=e.sent(),this.logger.log(g.LogLevel.Error,"Failed to complete negotiation with the server: "+o),[2,Promise.reject(o)];case 6:return[2]}})})},p.prototype.createConnectUrl=function(e,t){return t?e+(-1===e.indexOf("?")?"?":"&")+"id="+t:e},p.prototype.createTransport=function(l,h,p,f){return d(this,void 0,void 0,function(){var t,n,r,o,i,s,c,a,u;return v(this,function(e){switch(e.label){case 0:return(t=this.createConnectUrl(l,p.connectionToken),this.isITransport(h))?(this.logger.log(g.LogLevel.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=h,[4,this.startTransport(t,f)]):[3,2];case 1:return e.sent(),this.connectionId=p.connectionId,[2];case 2:n=[],i=p.availableTransports||[],r=p,o=0,i=i,e.label=3;case 3:return o<i.length?(s=i[o],(c=this.resolveTransportOrError(s,h,f))instanceof Error?(n.push(s.transport+" failed: "+c),[3,12]):[3,4]):[3,13];case 4:if(!this.isITransport(c))return[3,12];if(this.transport=c,r)return[3,9];e.label=5;case 5:return e.trys.push([5,7,,8]),[4,this.getNegotiationResponse(l)];case 6:return r=e.sent(),[3,8];case 7:return a=e.sent(),[2,Promise.reject(a)];case 8:t=this.createConnectUrl(l,r.connectionToken),e.label=9;case 9:return e.trys.push([9,11,,12]),[4,this.startTransport(t,f)];case 10:return e.sent(),this.connectionId=r.connectionId,[2];case 11:return a=e.sent(),this.logger.log(g.LogLevel.Error,"Failed to start the transport '"+s.transport+"': "+a),r=void 0,n.push(s.transport+" failed: "+a),"Connecting "!==this.connectionState?(u="Failed to select transport before stop() was called.",this.logger.log(g.LogLevel.Debug,u),[2,Promise.reject(new Error(u))]):[3,12];case 12:return o++,[3,3];case 13:return 0<n.length?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+n.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}})})},p.prototype.constructTransport=function(e){switch(e){case a.HttpTransportType.WebSockets:if(this.options.WebSocket)return new s.WebSocketTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket);throw new Error("'WebSocket' is not supported in your environment.");case a.HttpTransportType.ServerSentEvents:if(this.options.EventSource)return new o.ServerSentEventsTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource);throw new Error("'EventSource' is not supported in your environment.");case a.HttpTransportType.LongPolling:return new u.LongPollingTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1);default:throw new Error("Unknown transport: "+e+".")}},p.prototype.startTransport=function(e,t){var n=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(e){return n.stopConnection(e)},this.transport.connect(e,t)},p.prototype.resolveTransportOrError=function(e,t,n){var r,o=a.HttpTransportType[e.transport];if(null==o)return this.logger.log(g.LogLevel.Debug,"Skipping transport '"+e.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+e.transport+"' because it is not supported by this client.");if(r=o,(t=t)&&0==(r&t))return this.logger.log(g.LogLevel.Debug,"Skipping transport '"+a.HttpTransportType[o]+"' because it was disabled by the client."),new Error("'"+a.HttpTransportType[o]+"' is disabled by the client.");if(!(0<=e.transferFormats.map(function(e){return a.TransferFormat[e]}).indexOf(n)))return this.logger.log(g.LogLevel.Debug,"Skipping transport '"+a.HttpTransportType[o]+"' because it does not support the requested transfer format '"+a.TransferFormat[n]+"'."),new Error("'"+a.HttpTransportType[o]+"' does not support "+a.TransferFormat[n]+".");if(o===a.HttpTransportType.WebSockets&&!this.options.WebSocket||o===a.HttpTransportType.ServerSentEvents&&!this.options.EventSource)return this.logger.log(g.LogLevel.Debug,"Skipping transport '"+a.HttpTransportType[o]+"' because it is not supported in your environment.'"),new Error("'"+a.HttpTransportType[o]+"' is not supported in your environment.");this.logger.log(g.LogLevel.Debug,"Selecting transport '"+a.HttpTransportType[o]+"'.");try{return this.constructTransport(o)}catch(e){return e}},p.prototype.isITransport=function(e){return e&&"object"==typeof e&&"connect"in e},p.prototype.stopConnection=function(t){var n=this;if(this.logger.log(g.LogLevel.Debug,"HttpConnection.stopConnection("+t+") called while in state "+this.connectionState+"."),this.transport=void 0,t=this.stopError||t,this.stopError=void 0,"Disconnected"===this.connectionState)this.logger.log(g.LogLevel.Debug,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection is already in the disconnected state.");else if("Connecting "===this.connectionState)this.logger.log(g.LogLevel.Warning,"Call to HttpConnection.stopConnection("+t+") was ignored because the connection hasn't yet left the in the connecting state.");else if("Disconnecting"===this.connectionState&&this.stopPromiseResolver(),t?this.logger.log(g.LogLevel.Error,"Connection disconnected with error '"+t+"'."):this.logger.log(g.LogLevel.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop().catch(function(e){n.logger.log(g.LogLevel.Error,"TransportSendQueue.stop() threw error '"+e+"'.")}),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(e){this.logger.log(g.LogLevel.Error,"HttpConnection.onclose("+t+") threw error '"+e+"'.")}}},p.prototype.resolveUrl=function(e){if(0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("http://",0))return e;var t;if(i.Platform.isBrowser&&window.document)return(t=window.document.createElement("a")).href=e,this.logger.log(g.LogLevel.Information,"Normalizing '"+e+"' to '"+t.href+"'."),t.href;throw new Error("Cannot resolve '"+e+"'.")},p.prototype.resolveNegotiateUrl=function(e){var t=e.indexOf("?"),n=e.substring(0,-1===t?e.length:t);return"/"!==n[n.length-1]&&(n+="/"),n=-1===(n=(n+="negotiate")+(-1===t?"":e.substring(t))).indexOf("negotiateVersion")?n+(-1===t?"?":"&")+"negotiateVersion="+this.negotiateVersion:n},p);function p(e,t){void 0===t&&(t={}),this.features={},this.negotiateVersion=1,i.Arg.isRequired(e,"url"),this.logger=Object(i.createLogger)(t.logger),this.baseUrl=this.resolveUrl(e),(t=t||{}).logMessageContent=t.logMessageContent||!1,i.Platform.isNode||"undefined"==typeof WebSocket||t.WebSocket?i.Platform.isNode&&!t.WebSocket&&c&&(t.WebSocket=c):t.WebSocket=WebSocket,i.Platform.isNode||"undefined"==typeof EventSource||t.EventSource?i.Platform.isNode&&!t.EventSource&&void 0!==l&&(t.EventSource=l):t.EventSource=EventSource,this.httpClient=t.httpClient||new r.DefaultHttpClient(this.logger),this.connectionState="Disconnected",this.connectionStarted=!1,this.options=t,this.onreceive=null,this.onclose=null}y.prototype.send=function(e){return this.bufferData(e),this.transportResult||(this.transportResult=new b),this.transportResult.promise},y.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},y.prototype.bufferData=function(e){if(this.buffer.length&&typeof this.buffer[0]!=typeof e)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof e);this.buffer.push(e),this.sendBufferedData.resolve()},y.prototype.sendLoop=function(){return d(this,void 0,void 0,function(){var t,n,r;return v(this,function(e){switch(e.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(e.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new b,t=this.transportResult,this.transportResult=void 0,n="string"==typeof this.buffer[0]?this.buffer.join(""):y.concatBuffers(this.buffer),this.buffer.length=0,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.transport.send(n)];case 3:return e.sent(),t.resolve(),[3,5];case 4:return r=e.sent(),t.reject(r),[3,5];case 5:return[3,0];case 6:return[2]}})})},y.concatBuffers=function(e){for(var t=e.map(function(e){return e.byteLength}).reduce(function(e,t){return e+t}),n=new Uint8Array(t),r=0,o=0,i=e;o<i.length;o++){var s=i[o];n.set(new Uint8Array(s),r),r+=s.byteLength}return n};var f=y;function y(e){this.transport=e,this.buffer=[],this.executing=!0,this.sendBufferedData=new b,this.transportResult=new b,this.sendLoopPromise=this.sendLoop()}m.prototype.resolve=function(){this.resolver()},m.prototype.reject=function(e){this.rejecter(e)};var b=m;function m(){var n=this;this.promise=new Promise(function(e,t){e=[e,t];return n.resolver=e[0],n.rejecter=e[1],e})}},function(e,t,n){var r,o;n.r(t),n.d(t,"HttpTransportType",function(){return r}),n.d(t,"TransferFormat",function(){return o}),(n=r=r||{})[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling",(t=o=o||{})[t.Text=1]="Text",t[t.Binary=2]="Binary"},function(e,t,n){n.r(t),n.d(t,"LongPollingTransport",function(){return r});var o=n(22),i=n(4),s=n(9),c=n(20),a=n(13),u=function(i,s,c,a){return new(c=c||Promise)(function(e,t){function n(e){try{o(a.next(e))}catch(e){t(e)}}function r(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(n,r)}o((a=a.apply(i,s||[])).next())})},l=function(r,o){var i,s,c,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(c=2&t[0]?s.return:t[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,t[1])).done)return c;switch(s=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(c=0<(c=a.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3]))a.label=t[1];else if(6===t[0]&&a.label<c[1])a.label=c[1],c=t;else{if(!(c&&a.label<c[2])){c[2]&&a.ops.pop(),a.trys.pop();continue}a.label=c[2],a.ops.push(t)}}t=o.call(r,a)}catch(e){t=[6,e],s=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},r=(Object.defineProperty(h.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),h.prototype.connect=function(r,o){return u(this,void 0,void 0,function(){var t,n;return l(this,function(e){switch(e.label){case 0:if(a.Arg.isRequired(r,"url"),a.Arg.isRequired(o,"transferFormat"),a.Arg.isIn(o,c.TransferFormat,"transferFormat"),this.url=r,this.logger.log(s.LogLevel.Trace,"(LongPolling transport) Connecting."),o===c.TransferFormat.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return t={abortSignal:this.pollAbort.signal,headers:{},timeout:1e5},o===c.TransferFormat.Binary&&(t.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return n=e.sent(),this.updateHeaderToken(t,n),n=r+"&_="+Date.now(),this.logger.log(s.LogLevel.Trace,"(LongPolling transport) polling: "+n+"."),[4,this.httpClient.get(n,t)];case 2:return 200!==(n=e.sent()).statusCode?(this.logger.log(s.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+n.statusCode+"."),this.closeError=new i.HttpError(n.statusText||"",n.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,t),[2]}})})},h.prototype.getAccessToken=function(){return u(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,null]}})})},h.prototype.updateHeaderToken=function(e,t){e.headers||(e.headers={}),t?e.headers.Authorization="Bearer "+t:e.headers.Authorization&&delete e.headers.Authorization},h.prototype.poll=function(r,o){return u(this,void 0,void 0,function(){var t,n;return l(this,function(e){switch(e.label){case 0:e.trys.push([0,,8,9]),e.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:t=e.sent(),this.updateHeaderToken(o,t),e.label=3;case 3:return e.trys.push([3,5,,6]),t=r+"&_="+Date.now(),this.logger.log(s.LogLevel.Trace,"(LongPolling transport) polling: "+t+"."),[4,this.httpClient.get(t,o)];case 4:return 204===(n=e.sent()).statusCode?(this.logger.log(s.LogLevel.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==n.statusCode?(this.logger.log(s.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+n.statusCode+"."),this.closeError=new i.HttpError(n.statusText||"",n.statusCode),this.running=!1):n.content?(this.logger.log(s.LogLevel.Trace,"(LongPolling transport) data received. "+Object(a.getDataDetail)(n.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(n.content)):this.logger.log(s.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return n=e.sent(),this.running?n instanceof i.TimeoutError?this.logger.log(s.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=n,this.running=!1):this.logger.log(s.LogLevel.Trace,"(LongPolling transport) Poll errored after shutdown: "+n.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(s.LogLevel.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}})})},h.prototype.send=function(t){return u(this,void 0,void 0,function(){return l(this,function(e){return this.running?[2,Object(a.sendMessage)(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},h.prototype.stop=function(){return u(this,void 0,void 0,function(){var t,n;return l(this,function(e){switch(e.label){case 0:this.logger.log(s.LogLevel.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),e.label=1;case 1:return e.trys.push([1,,5,6]),[4,this.receiving];case 2:return e.sent(),this.logger.log(s.LogLevel.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),t={headers:{}},[4,this.getAccessToken()];case 3:return n=e.sent(),this.updateHeaderToken(t,n),[4,this.httpClient.delete(this.url,t)];case 4:return e.sent(),this.logger.log(s.LogLevel.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(s.LogLevel.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}})})},h.prototype.raiseOnClose=function(){var e;this.onclose&&(e="(LongPolling transport) Firing onclose event.",this.closeError&&(e+=" Error: "+this.closeError),this.logger.log(s.LogLevel.Trace,e),this.onclose(this.closeError))},h);function h(e,t,n,r){this.httpClient=e,this.accessTokenFactory=t,this.logger=n,this.pollAbort=new o.AbortController,this.logMessageContent=r,this.running=!1,this.onreceive=null,this.onclose=null}},function(e,t,n){n.r(t),n.d(t,"AbortController",function(){return r});o.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(o.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0});var r=o;function o(){this.isAborted=!1,this.onabort=null}},function(e,t,n){n.r(t),n.d(t,"ServerSentEventsTransport",function(){return i});var a=n(9),u=n(20),l=n(13),r=function(i,s,c,a){return new(c=c||Promise)(function(e,t){function n(e){try{o(a.next(e))}catch(e){t(e)}}function r(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(n,r)}o((a=a.apply(i,s||[])).next())})},o=function(r,o){var i,s,c,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(c=2&t[0]?s.return:t[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,t[1])).done)return c;switch(s=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(c=0<(c=a.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3]))a.label=t[1];else if(6===t[0]&&a.label<c[1])a.label=c[1],c=t;else{if(!(c&&a.label<c[2])){c[2]&&a.ops.pop(),a.trys.pop();continue}a.label=c[2],a.ops.push(t)}}t=o.call(r,a)}catch(e){t=[6,e],s=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},i=(s.prototype.connect=function(s,c){return r(this,void 0,void 0,function(){var t,i=this;return o(this,function(e){switch(e.label){case 0:return(l.Arg.isRequired(s,"url"),l.Arg.isRequired(c,"transferFormat"),l.Arg.isIn(c,u.TransferFormat,"transferFormat"),this.logger.log(a.LogLevel.Trace,"(SSE transport) Connecting."),this.url=s,this.accessTokenFactory)?[4,this.accessTokenFactory()]:[3,2];case 1:(t=e.sent())&&(s+=(s.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(t)),e.label=2;case 2:return[2,new Promise(function(e,t){var n,r,o=!1;if(c!==u.TransferFormat.Text)t(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));else{r=l.Platform.isBrowser||l.Platform.isWebWorker?new i.eventSourceConstructor(s,{withCredentials:!0}):(n=i.httpClient.getCookieString(s),new i.eventSourceConstructor(s,{withCredentials:!0,headers:{Cookie:n}}));try{r.onmessage=function(e){if(i.onreceive)try{i.logger.log(a.LogLevel.Trace,"(SSE transport) data received. "+Object(l.getDataDetail)(e.data,i.logMessageContent)+"."),i.onreceive(e.data)}catch(e){i.close(e)}},r.onerror=function(e){e=new Error(e.data||"Error occurred");o?i.close(e):t(e)},r.onopen=function(){i.logger.log(a.LogLevel.Information,"SSE connected to "+i.url),i.eventSource=r,o=!0,e()}}catch(e){t(e)}}})]}})})},s.prototype.send=function(t){return r(this,void 0,void 0,function(){return o(this,function(e){return this.eventSource?[2,Object(l.sendMessage)(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},s.prototype.stop=function(){return this.close(),Promise.resolve()},s.prototype.close=function(e){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose)&&this.onclose(e)},s);function s(e,t,n,r,o){this.httpClient=e,this.accessTokenFactory=t,this.logger=n,this.logMessageContent=r,this.eventSourceConstructor=o,this.onreceive=null,this.onclose=null}},function(e,t,n){n.r(t),n.d(t,"WebSocketTransport",function(){return i});var a=n(9),u=n(20),l=n(13),r=function(i,s,c,a){return new(c=c||Promise)(function(e,t){function n(e){try{o(a.next(e))}catch(e){t(e)}}function r(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(n,r)}o((a=a.apply(i,s||[])).next())})},o=function(r,o){var i,s,c,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(c=2&t[0]?s.return:t[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,t[1])).done)return c;switch(s=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(c=0<(c=a.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3]))a.label=t[1];else if(6===t[0]&&a.label<c[1])a.label=c[1],c=t;else{if(!(c&&a.label<c[2])){c[2]&&a.ops.pop(),a.trys.pop();continue}a.label=c[2],a.ops.push(t)}}t=o.call(r,a)}catch(e){t=[6,e],s=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},i=(s.prototype.connect=function(s,c){return r(this,void 0,void 0,function(){var t,i=this;return o(this,function(e){switch(e.label){case 0:return(l.Arg.isRequired(s,"url"),l.Arg.isRequired(c,"transferFormat"),l.Arg.isIn(c,u.TransferFormat,"transferFormat"),this.logger.log(a.LogLevel.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory)?[4,this.accessTokenFactory()]:[3,2];case 1:(t=e.sent())&&(s+=(s.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(t)),e.label=2;case 2:return[2,new Promise(function(t,n){s=s.replace(/^http/,"ws");var e=i.httpClient.getCookieString(s),r=!1,o=(o=l.Platform.isNode&&e?new i.webSocketConstructor(s,void 0,{headers:{Cookie:""+e}}):o)||new i.webSocketConstructor(s);c===u.TransferFormat.Binary&&(o.binaryType="arraybuffer"),o.onopen=function(e){i.logger.log(a.LogLevel.Information,"WebSocket connected to "+s+"."),i.webSocket=o,r=!0,t()},o.onerror=function(e){var t=null,t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:new Error("There was an error with the transport.");n(t)},o.onmessage=function(e){i.logger.log(a.LogLevel.Trace,"(WebSockets transport) data received. "+Object(l.getDataDetail)(e.data,i.logMessageContent)+"."),i.onreceive&&i.onreceive(e.data)},o.onclose=function(e){var t;r?i.close(e):(t=null,t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:new Error("There was an error with the transport."),n(t))}})]}})})},s.prototype.send=function(e){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(a.LogLevel.Trace,"(WebSockets transport) sending data. "+Object(l.getDataDetail)(e,this.logMessageContent)+"."),this.webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},s.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},s.prototype.close=function(e){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0),this.logger.log(a.LogLevel.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!e||!1!==e.wasClean&&1e3===e.code?this.onclose():this.onclose(new Error("WebSocket closed with status code: "+e.code+" ("+e.reason+").")))},s);function s(e,t,n,r,o){this.logger=n,this.accessTokenFactory=t,this.logMessageContent=r,this.webSocketConstructor=o,this.httpClient=e,this.onreceive=null,this.onclose=null}},function(e,t,n){n.r(t),n.d(t,"JsonHubProtocol",function(){return o});var c=n(15),a=n(9),r=n(20),u=n(14),l=n(12),o=(i.prototype.parseMessages=function(e,t){if("string"!=typeof e)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];null===t&&(t=u.NullLogger.instance);for(var n=[],r=0,o=l.TextMessageFormat.parse(e);r<o.length;r++){var i=o[r],s=JSON.parse(i);if("number"!=typeof s.type)throw new Error("Invalid payload.");switch(s.type){case c.MessageType.Invocation:this.isInvocationMessage(s);break;case c.MessageType.StreamItem:this.isStreamItemMessage(s);break;case c.MessageType.Completion:this.isCompletionMessage(s);break;case c.MessageType.Ping:case c.MessageType.Close:break;default:t.log(a.LogLevel.Information,"Unknown message type '"+s.type+"' ignored.");continue}n.push(s)}return n},i.prototype.writeMessage=function(e){return l.TextMessageFormat.write(JSON.stringify(e))},i.prototype.isInvocationMessage=function(e){this.assertNotEmptyString(e.target,"Invalid payload for Invocation message."),void 0!==e.invocationId&&this.assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")},i.prototype.isStreamItemMessage=function(e){if(this.assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),void 0===e.item)throw new Error("Invalid payload for StreamItem message.")},i.prototype.isCompletionMessage=function(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.assertNotEmptyString(e.error,"Invalid payload for Completion message."),this.assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")},i.prototype.assertNotEmptyString=function(e,t){if("string"!=typeof e||""===e)throw new Error(t)},i);function i(){this.name="json",this.version=1,this.transferFormat=r.TransferFormat.Text}}],r={},o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0);function o(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,o),t.l=!0,t)).exports}var n,r});