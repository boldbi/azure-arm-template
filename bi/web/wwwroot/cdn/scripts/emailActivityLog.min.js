var emailLogStartDateTime="",emailLogEndDateTime="",isEmailActivityDialog=!1,isCreateNewTemplateDialogAdded=!1;function setTimpickerValue(){emailLogEndDateTime="True"==emailActivityLogTimeFomat?(emailLogStartDateTime="00:00","23:59"):(emailLogStartDateTime="12:00 AM","11:59 PM")}function openEmailLogDetails(){var e=angular.element("[ng-controller=EmailLogInfoCtrl]").scope(),t=$("#emailActivityLogGrid").ejGrid("instance"),t=t.getCurrentViewData()[t.getIndexByRow($("tr.e-row[aria-selected *='true']"))],a=$("<div/>").html(t.MailBody).text();t.MailBody=a,e.openEmailLogInfoDialog(t)}function fnActionBegin(e){var t,a=[];if(0<e.model.filterSettings.filteredColumns.length){for(t=0;t<e.model.filterSettings.filteredColumns.length;t++){var i=e.model.filterSettings.filteredColumns[t];a.push({PropertyName:i.field,FilterType:i.operator,FilterKey:i.value})}this.model.query._params.push({key:"filterCollection",value:a})}}function DateRangeLocalization(){var e={customPicker:window.Server.App.Localization.CustomPicker,watermarkText:window.Server.App.Localization.SelectRange};"undefined"!=typeof BoldBIDashboard?BoldBIDashboard.DateRangePicker.Locale["en-US"]=e:ej.DateRangePicker.Locale["en-US"]=e}function onSetDefaultTemplateDailogOpen(){$(".mark-default-disable").attr("disabled",!0)}function createNewTemplate(){var e,t='<span class ="dialog-header-title">'+window.Server.App.Localization.MarkAsDefaultTemplate+"</span>";isCreateNewTemplateDialogAdded?(document.getElementById("mark-default-template-dialog").ej2_instances[0].header=t,document.getElementById("mark-default-template-dialog").ej2_instances[0].show()):((e=document.createElement("div")).setAttribute("id","mark-default-template-dialog"),document.getElementById("server-app-container").appendChild(e),isCreateNewTemplateDialogAdded=!0,(e=new ejs.popups.Dialog({header:t,content:document.getElementById("template-add-dialog-wrapper"),showCloseIcon:!0,width:"350px",height:"auto",isModal:!0,visible:!1,closeOnEscape:!0,animationSettings:{effect:"Zoom"},buttons:[{click:function(e){markAsDefault()},buttonModel:{isPrimary:!0,cssClass:"app-btn-primary mark-default-disable",content:window.Server.App.Localization.MarkAsDefaultTemplate,disabled:!0}}],open:onSetDefaultTemplateDailogOpen,close:"onMarkDefaultDialogClose"})).appendTo("#mark-default-template-dialog"),e.show(),isCreateNewTemplateDialogAdded=!0),document.getElementById("dialog-container").style.display="block",document.getElementById("mark-default-division").style.display="block",document.getElementById("template-add-dialog-wrapper").style.display="block"}function onMarkDefaultDialogClose(){document.getElementById("mark-default-template-dialog").ej2_instances[0].hide()}function markAsDefault(){var e=$("#mark-as-default-list option:selected").val(),t=$("#mark-as-default-list").attr("data-template-id");$.ajax({type:"POST",url:markAsDefaultUrl,data:{id:e,templateId:t},success:function(e){e.result&&(successToast(window.Server.App.Localization.MarkTemplateAsDefault,7e3),$("#customEmaiGrid").data("ejGrid").dataSource(e.template)),document.getElementById("mark-default-template-dialog").ej2_instances[0].hide(),$("#mark-as-default-list").html("").selectpicker("refresh")}})}$(document).ready(function(){$("[data-toggle='tooltip'], .selectpicker").tooltip(),DateRangeLocalization(),$("#datePicker").ejDateRangePicker({dateFormat:emailActivityLogDateFormat,locale:"en-US",buttonText:{apply:window.Server.App.Localization.Apply,cancel:window.Server.App.Localization.CancelButton,reset:window.Server.App.Localization.Reset},ranges:[{label:window.Server.App.Localization.Today,range:[new Date,new Date]},{label:window.Server.App.Localization.Yesterday,range:[new Date((new Date).setDate((new Date).getDate()-1)),new Date((new Date).setDate((new Date).getDate()-1))]},{label:window.Server.App.Localization.LastDays.format("7"),range:[new Date((new Date).setDate((new Date).getDate()-7)),new Date]},{label:window.Server.App.Localization.LastDays.format("15"),range:[new Date((new Date).setDate((new Date).getDate()-14)),new Date]},{label:window.Server.App.Localization.LastDays.format("30"),range:[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},{label:window.Server.App.Localization.LastDays.format("60"),range:[new Date((new Date).setMonth((new Date).getMonth()-2)),new Date]},{label:window.Server.App.Localization.ThisWeek,range:[new Date((new Date).setDate((new Date).getDate()-(new Date).getDay())),new Date((new Date).setDate((new Date).getDate()-(new Date).getDay()+6))]},{label:window.Server.App.Localization.ThisMonth,range:[new Date((new Date).getFullYear(),(new Date).getMonth(),1),new Date((new Date).getFullYear(),(new Date).getMonth()+1,0)]}]});var a=$("#emailActivityLogGrid").ejGrid("instance");$(".e-gridheader .e-filtericon").mousedown(function(e){var t=e.target;$("#emailActivityLogGrid_stringDlg").ejDialog({open:function(e){"Status"==$(t).parent().find(".e-headercelldiv").attr("ej-mappingname")&&($("#emailActivityLogGridstring_ddinput_hidden").val("Contains"),$("#"+a._id+"string_ddinput_popup_wrapper").find("li[value='Equal']").hide(),$("#"+a._id+"string_ddinput_popup_wrapper").find("li[value='NotEqual']").hide(),$("#"+a._id+"string_ddinput_popup_wrapper").find("li[value='StartsWith']").hide(),$("#"+a._id+"string_ddinput_popup_wrapper").find("li[value='EndsWith']").hide())}})}),$(document).on("click",".configure-email",function(){var e=$(this).attr("href");window.location.href=e})}),$(document).on("click","#email-log-filter-apply-button",function(){$.ajax({type:"GET",url:emailSettingsPagePermissionUrl,data:{scope:SettingsScopes.Email},success:function(e){var t,a,i,n;e.status?(setTimpickerValue(),[n,t]=$("#datePicker").val().split(" - "),n=""!=$.trim(n)?$.trim(n)+" "+emailLogStartDateTime:"",t=""!=$.trim(t)?$.trim(t)+" "+emailLogEndDateTime:"",a=$("#email-event").val().toString(),i=$("#emailActivityLogGrid").data("ejGrid"),n=ej.DataManager({url:filterEmailLogsUrl+"?startDate="+n+"&endDate="+t+"&eventType="+a,adaptor:new ej.UrlAdaptor}),i.dataSource(n),i.model.pageSettings.currentPage=1):e.permissionDenied&&warningToast(window.Server.App.Localization.AdminPageAccessWarningAlert,null,(new Date).getTime())}})}),$(document).on("click",".email-log-info",function(){openEmailLogDetails()}),serverApp.controller("EmailLogInfoCtrl",["$scope","$timeout","$element",function(i,n,e){i.openEmailLogInfoDialog=function(e){var t,a;isEmailActivityDialog?((t=document.getElementById("emailActivity_dialog").ej2_instances)[0].header="Details",t[0].show()):((t=document.createElement("div")).setAttribute("id","emailActivity_dialog"),document.getElementById("mail-settings-container").appendChild(t),(a=new ejs.popups.Dialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,width:480<window.innerWidth?"400px":window.innerWidth-10+"px",height:"548px",header:window.Server.App.Localization.Details,showHeader:!0,animationSettings:{effect:"Zoom"},isModal:!0,enableModal:!0,closeOnEscape:!0,showCloseIcon:!0,content:document.getElementById("emaillog-info-popup"),buttons:[{buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.CancelButton},click:function(){a.hide()}}]})).appendTo(t),isEmailActivityDialog=!0),i.EmailLogDetail=e,document.getElementById("emaillog-info-popup").style.display="block",n(function(){i.$apply()},100)}}]),$(document).on("click",".mark-as-default",function(){var e=$(this).attr("data-template-id");createNewTemplate(),$("#mark-as-default-list").attr("data-template-id",e),$.ajax({type:"GET",url:specificEventListURL,data:{templateId:e},success:function(e){if(null!=e.result){for(var t="",a=0;a<e.result.length;a++)t+='<option value="'+e.result[a].Id+'">'+e.result[a].EmailTemplateName+"</option>";$("#mark-as-default-list").html(""),$("#mark-as-default-list").html('<option value="" selected="selected" class="hide-option" disabled>Select a template to make it as the default template</option>'+t).selectpicker("refresh")}}})}),$(document).on("change","#mark-as-default-list",function(){""===$("#mark-as-default-list option:selected").val().trim()?$(".mark-default-disable").attr("disabled",!0):$(".mark-default-disable").attr("disabled",!1)});