var userLogStartDateTime="",userLogEndDateTime="",grid="",isUserActivityDialog=!1;function setTimpickerValue(){userLogEndDateTime="True"==userActivityLogTimeFormat?(userLogStartDateTime="00:00","23:59"):(userLogStartDateTime="12:00 AM","11:59 PM")}function setDropdownPlaceholders(){$("#event-type").selectpicker("val",""),$("#event-type").selectpicker("refresh"),$("#event-category").selectpicker("val",""),$("#event-category").selectpicker("refresh")}function resetDropdowns(){$("#event-type").val("").selectpicker("refresh"),$("#event-category").val("").selectpicker("refresh")}function openActivityLogDetails(){var e=angular.element("[ng-controller=activityLogInfoCtrl]").scope(),t=$("#userActivityLogGrid").ejGrid("instance"),t=t.getCurrentViewData()[t.getIndexByRow($("tr.e-row[aria-selected *='true']"))];e.openActivityLogInfoDialog(t)}function DateRangeLocalization(){var e={customPicker:window.Server.App.Localization.CustomPicker,watermarkText:window.Server.App.Localization.SelectRange};"undefined"!=typeof BoldBIDashboard?BoldBIDashboard.DateRangePicker.Locale["en-US"]=e:ej.DateRangePicker.Locale["en-US"]=e}$(document).ready(function(){$("[data-toggle='tooltip'], .selectpicker").tooltip(),DateRangeLocalization(),$("#datePicker").ejDateRangePicker({dateFormat:userActivityLogDateFormat,locale:"en-US",buttonText:{apply:window.Server.App.Localization.Apply,cancel:window.Server.App.Localization.CancelButton,reset:window.Server.App.Localization.Reset},ranges:[{label:window.Server.App.Localization.Today,range:[new Date,new Date]},{label:window.Server.App.Localization.Yesterday,range:[new Date((new Date).setDate((new Date).getDate()-1)),new Date((new Date).setDate((new Date).getDate()-1))]},{label:window.Server.App.Localization.LastDays.format("7"),range:[new Date((new Date).setDate((new Date).getDate()-7)),new Date]},{label:window.Server.App.Localization.LastDays.format("15"),range:[new Date((new Date).setDate((new Date).getDate()-14)),new Date]},{label:window.Server.App.Localization.LastDays.format("30"),range:[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},{label:window.Server.App.Localization.LastDays.format("60"),range:[new Date((new Date).setMonth((new Date).getMonth()-2)),new Date]},{label:window.Server.App.Localization.ThisWeek,range:[new Date((new Date).setDate((new Date).getDate()-(new Date).getDay())),new Date((new Date).setDate((new Date).getDate()-(new Date).getDay()+6))]},{label:window.Server.App.Localization.ThisMonth,range:[new Date((new Date).getFullYear(),(new Date).getMonth(),1),new Date((new Date).getFullYear(),(new Date).getMonth()+1,0)]}]}),grid=$("#userActivityLogGrid").ejGrid("instance")}),$(document).on("click","#activity-log-filter-apply-button",function(){setTimpickerValue();var e=$("#datePicker").val().split("-"),t=""!=$.trim(e[0])?$.trim(e[0])+" "+userLogStartDateTime:"",e=""!=$.trim(e[1])?$.trim(e[1])+" "+userLogEndDateTime:"",a=$("#event-type").val().toString(),n=$("#event-category").val().toString(),i=$("#userActivityLogGrid").data("ejGrid"),t=ej.DataManager({url:filterUserLogsUrl+"?startDate="+t+"&endDate="+e+"&eventType="+(null!==a?a:"")+"&eventCategory="+(null!==n?n:""),adaptor:new ej.UrlAdaptor});i.dataSource(t),i.model.pageSettings.currentPage=1}),$(document).on("click",".activity-log-info",function(){openActivityLogDetails()}),$(document).on("click","#refresh",function(){grid.refreshContent()}),serverApp.controller("activityLogInfoCtrl",["$scope","$timeout","$element",function(a,n,e){a.openActivityLogInfoDialog=function(e){var t;isUserActivityDialog?((t=document.getElementById("userActivity_dialog").ej2_instances)[0].header=window.Server.App.Localization.Details,t[0].show()):((t=document.createElement("div")).setAttribute("id","userActivity_dialog"),document.getElementById("activity-settings-container").appendChild(t),new ejs.popups.Dialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,width:380<window.innerWidth?"552px":window.innerWidth-10+"px",header:window.Server.App.Localization.Details,showHeader:!0,animationSettings:{effect:"Zoom"},isModal:!0,enableModal:!0,closeOnEscape:!0,showCloseIcon:!0,content:document.getElementById("activitylog-info-popup")}).appendTo(t),isUserActivityDialog=!0),a.ActivityLogDetail=e,document.getElementById("activitylog-info-popup").style.display="block",n(function(){a.$apply()},100),a.capitalizeFirstLetter=function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):"-"},a.showChangesLogs=function(){return!a.ActivityLogDetail?.UserLogDetails?.EventLog?.ChangeLogCollection?.some(function(e){return"Password"===e.ChangedItem})},a.getLogDetails=function(e,t){if(e===appTypeApi){if(t===appSourceBI)return window.Server.App.Localization.DashboardServerApi;if(t===appSourceUMS)return window.Server.App.Localization.IdentityProviderApi}else if(e===appTypeJobs&&t===appSourceBI)return window.Server.App.Localization.DashboardServerJobs;return"-"}}}]),$(document).on("click","#reset",function(){setDropdownPlaceholders(),$("#datePicker").val("");var e=$.trim(null),t=$.trim(null),a=$.trim(null),n=$.trim(null),i=$("#userActivityLogGrid").data("ejGrid"),e=ej.DataManager({url:filterUserLogsUrl+"?startDate="+e+"&endDate="+t+"&eventType="+(null!==a?a:"")+"&eventCategory="+(null!==n?n:""),adaptor:new ej.UrlAdaptor});i.dataSource(e),resetDropdowns()});