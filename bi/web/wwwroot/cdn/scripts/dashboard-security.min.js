var itemInfo="",isDomainSelected=!1,isDialogBinded=!1,isIpChipBinded=!1,isDomainChipBinded=!1,isChipChanged=!1,isIPv6=!1,domainChipData=[],ipChipData=[],domainCount=0,ipCount=0,isChrome=-1!=navigator.userAgent.indexOf("Chrome"),isEdge=-1!=navigator.userAgent.indexOf("Edge"),isIE=null!=browser&&"msie"===browser.name&&8<=parseFloat(browser.version);function openItemSettingsDialog(t){itemInfo=t;var e,i,t='<span class="dialog-header-with-subtitle"><span class ="dialog-header-title">'+window.Server.App.Localization.Security+'</span><span class="item-name">'+itemInfo.Name+"</span></span>";isDialogBinded?((i=document.getElementById("item-settings-dialog").ej2_instances)[0].header=t,i[0].show(),$("#item-settings-dialog .e-primary").attr("disabled","true")):((e=document.createElement("div")).setAttribute("id","item-settings-dialog"),document.getElementById("dashboard-page-container").appendChild(e),(i=new ejs.popups.Dialog({header:t,content:document.getElementById("itemsettings-dialog-content"),buttons:[{click:function(t){if(t.keyCode==keyCode.Enter)return t.preventDefault(),!1;saveItemSettings()},buttonModel:{isPrimary:!0,disabled:!0,cssClass:"app-btn-primary",content:window.Server.App.Localization.SaveButton}},{click:function(){i.hide(),$(".domain-name-validation").hide(),$(".ip-address-validation").hide(),cancelItemSettings(),ClearSettingsFields()},buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.CancelButton}}],animationSettings:{effect:"Zoom"},beforeOpen:beforeOpenSecurityDialog,width:"600px",showCloseIcon:!0,isModal:!0})).appendTo(e),isDialogBinded=!0),ejs.popups.createSpinner({target:document.getElementById("item-settings-dialog")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("item-settings-dialog")),getItemSettings(),isChipChanged=!1}function beforeOpenSecurityDialog(){$("#itemsettings-dialog-content").show()}function saveItemSettings(){var t,e,i=document.getElementById("domain-chip-content").ej2_instances,n=document.getElementById("ip-chip-content").ej2_instances,a=$("#select-option").val(),o=$("<a/>",{href:getDashboardShareLink(itemInfo.Id,itemInfo.CategoryName,itemInfo.Name),target:"_blank",html:" "+itemInfo.Name+"."});null!=i&&null!=(t=i[0].chips)||(t=[]),null!=n&&null!=(e=n[0].chips)||(e=[]),$.ajax({type:"POST",url:itemSettingsAccessUrl,data:{itemId:itemInfo.Id,securitySettings:JSON.stringify({IPAddresses:e,Domains:t,SecuritySettingScope:a}),securityType:SecurityType.DashboardSecurity},success:function(t){t.result?successToast(window.Server.App.Localization.AddDashboardSecurity.format(o[0].outerHTML),7e3):warningToast(window.Server.App.Localization.SecurityFailed),document.getElementById("item-settings-dialog").ej2_instances[0].hide()}})}function ClearSettingsFields(){$("#domain-input-text").val(""),null==document.getElementById("domain-chip-content").ej2_instances&&0==$("#domain-input-text").val().length&&applyDomainContainer(),$("#ip-input-text").val(""),null==document.getElementById("ip-chip-content").ej2_instances&&0==$("#ip-input-text").val().length&&applyIpContainer()}function getItemSettings(){domainChipData=[],ipChipData=[],getDomainInstance(),getIpInstance();var t=itemInfo.Id;$.ajax({type:"POST",url:getItemSettingsUrl,data:{itemId:t},success:function(t){if(t.Status){if($("#select-option").val(t.result.SecuritySettingScope).selectpicker("refresh"),null!=t.result.Domains){for(i=0;i<t.result.Domains.length;i++)domainChipData[i]=t.result.Domains[i],0!=domainChipData[i].length&&domainChipConversion(domainChipData);domainCount=t.result.Domains.length}if(null!=t.result.IPAddresses){for(i=0;i<t.result.IPAddresses.length;i++)ipChipData[i]=t.result.IPAddresses[i],0!=ipChipData[i].length&&ipChipConversion(ipChipData);ipCount=t.result.IPAddresses.length}}ejs.popups.hideSpinner(document.getElementById("item-settings-dialog"))}})}function objectConvertAsChip(t){0!=(t=t.endsWith(",")||t.endsWith(";")||t.endsWith("\n")?t.slice(0,-1).trim():t).length?isDomainSelected?validateDomainName(t)?isAlreadyExists(t)&&(domainChipData.push(t),domainChipConversion(domainChipData),$(".domain-name-validation").hide(),enableSaveButton()):($("#domain-input-text").val(t),addDomainValidation()):validateIpAddress(t)?(t.contains("/")||(t+=isIPv6?"/128":"/32"),isIpAlreadyExistsorNot(t)&&(ipChipData.push(t),ipChipConversion(ipChipData),$(".ip-address-validation").hide(),enableSaveButton())):($("#ip-input-text").val(t),addIpValidation()):ClearSettingsFields()}function isAlreadyExists(t){var e=document.getElementById("domain-chip-content").ej2_instances;if(null!=e&&0!=e[0].chips&&null!=e[0].chips)for(i=0;i<e[0].chips.length;i++)if(e[0].chips[i].toLowerCase()==t.toLowerCase())return $("#domain-input-text").val(""),!1;return!0}function domainChipConversion(t){var e;isDomainChipBinded?((e=document.getElementById("domain-chip-content").ej2_instances)[0].chips=[],e[0].chips=t,e[0].createChip(),e[0].refresh()):(new ejs.buttons.ChipList({chips:t,enableDelete:!0,delete:onDomainChipDelete},"#domain-chip-content"),isDomainChipBinded=!0),140<$("#domain-name-content").height()&&((e=document.getElementById("domain-name-content")).scrollTop=e.scrollHeight),$("#domain-chip-content .e-chip-delete").addClass("domain-name"),removeDomainContainer(),applyDomainTooltip()}function removeDomainContainer(){$("#domain-input-text").css("width","10%").removeAttr("placeholder").val(""),$("#domain-chip-content").css("display","inline")}function applyDomainContainer(){$("#domain-input-text").css("width","100%").attr("placeholder",window.Server.App.Localization.DomainContent),$("#domain-chip-content").hide()}function cancelItemSettings(){getDomainInstance(),getIpInstance(),ClearSettingsFields(),ipCount=domainCount=0,$("#select-option").val("1").selectpicker("refresh")}function ipChipConversion(t){var e;isIpChipBinded?((e=document.getElementById("ip-chip-content").ej2_instances)[0].chips=[],e[0].chips=t,e[0].createChip(),e[0].refresh()):(new ejs.buttons.ChipList({chips:t,enableDelete:!0,delete:onIpChipDelete},"#ip-chip-content"),isIpChipBinded=!0),140<$("#ip-address-content").height()&&((e=document.getElementById("ip-address-content")).scrollTop=e.scrollHeight),removeIpContainer(),applyIpTooltip()}function removeIpContainer(){$("#ip-input-text").css("width","10%").removeAttr("placeholder").val(""),$("#ip-chip-content").css("display","inline")}function applyIpContainer(){$("#ip-input-text").css("width","100%").attr("placeholder",window.Server.App.Localization.IpContent),$("#ip-chip-content").hide()}function isIpAlreadyExistsorNot(t){var e=document.getElementById("ip-chip-content").ej2_instances;if(null!=e&&0!=e[0].chips&&null!=e[0].chips)for(i=0;i<e[0].chips.length;i++)if(e[0].chips[i]==t)return $("#ip-input-text").val(""),!1;return!0}function getDomainInstance(){var t=document.getElementById("domain-chip-content").ej2_instances;null!=t&&(t[0].chips=[],applyDomainContainer()),$("#domain-chip-content").html("")}function getIpInstance(){var t=document.getElementById("ip-chip-content").ej2_instances;null!=t&&(t[0].chips=[],applyIpContainer()),$("#ip-chip-content").html("")}function validateDomainName(t){return!!/(?=^.{4,253}$)(^((?!-)[a-zA-Z0-9-]{0,62}[a-zA-Z0-9]\.)+[a-zA-Z]{2,63}$)/.test(t)||!!/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t)}function validateIpAddress(t){var e;return t.contains("/")&&(e=(t=t.split("/"))[1],t=t[0]),/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t)?(isIPv6=!1,!(void 0!==e&&32<e)):!(!/^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*(\/([0-9]|[1-9][0-9]|1[0-1][0-9]|12[0-8]))?$/.test(t)||(isIPv6=!0,void 0!==e&&128<e))}function addDomainValidation(){$(".domain-name-validation").show(),$("#item-settings-dialog .e-primary").attr("disabled","true")}function addIpValidation(){$(".ip-address-validation").show(),$("#item-settings-dialog .e-primary").attr("disabled","true")}function checkDomainValidation(){var t=$("#domain-chip-content .e-chip").toArray(),e=0;$("#domain-chip-content .e-chip").each(function(){e<t.length&&(validateDomainName($(t[e]).find(".e-chip-text").text())||($(this).addClass("chip-validation"),addDomainValidation()),e++)})}function checkIpValidation(){var t=$("#ip-chip-content .e-chip").toArray(),e=0;$("#ip-chip-content .e-chip").each(function(){e<t.length&&(validateIpAddress($(t[e]).find(".e-chip-text").text())||($(this).addClass("chip-validation"),addIpValidation()),e++)})}function enableSaveButton(){$("#domain-chip-content .e-chip").hasClass("chip-validation")||$("#ip-chip-content .e-chip").hasClass("chip-validation")||""!=$("#domain-input-text").val()||""!=$("#ip-input-text").val()||($("#item-settings-dialog .e-primary").removeAttr("disabled"),isChipChanged=!0)}function applyDomainTooltip(){for(var t=0;t<$("#domain-chip-content .e-chip").length;t++){$("#domain-chip-content .e-chip")[t].setAttribute("data-toggle","tooltip"),$("#domain-chip-content .e-chip")[t].setAttribute("data-placement","top");var e=$("#domain-chip-content .e-chip > .e-chip-text")[t].innerText;$("#domain-chip-content .e-chip")[t].setAttribute("data-original-title",e)}$('[data-toggle="tooltip"]').tooltip()}function applyIpTooltip(){for(var t=0;t<$("#ip-chip-content .e-chip").length;t++){$("#ip-chip-content .e-chip")[t].setAttribute("data-toggle","tooltip"),$("#ip-chip-content .e-chip")[t].setAttribute("data-placement","top");var e=$("#ip-chip-content .e-chip > .e-chip-text")[t].innerText;$("#ip-chip-content .e-chip")[t].setAttribute("data-original-title",e)}$('[data-toggle="tooltip"]').tooltip()}function removeDomainValidation(){$("#domain-chip-content .e-chip").hasClass("chip-validation")||""!=$("#domain-input-text").val()||$(".domain-name-validation").hide()}function removeIpValidation(){$("#ip-chip-content .e-chip").hasClass("chip-validation")||""!=$("#ip-input-text").val()||$(".ip-address-validation").hide()}function checkSaveEnabled(){($("#domain-chip-content > .e-chip").length!=domainCount||$("#ip-chip-content > .e-chip").length!=ipCount&&!isChipChanged||isChipChanged)&&enableSaveButton()}function onDomainChipDelete(){$("#domain-input-text").focus(),setTimeout(function(){removeDomainValidation(),checkSaveEnabled()},100),$(".tooltip").hide(),1==document.getElementById("domain-chip-content").ej2_instances[0].chips.length&&(applyDomainContainer(),$(".domain-name-validation").hide())}function onIpChipDelete(){$("#ip-input-text").focus(),setTimeout(function(){removeIpValidation(),checkSaveEnabled()},100),$(".tooltip").hide(),1==document.getElementById("ip-chip-content").ej2_instances[0].chips.length&&(applyIpContainer(),$(".ip-address-validation").hide())}$(document).on("keyup","#domain-input-text",function(t){1==$("#domain-input-text").length&&$("#domain-input-text").focus(),t.keyCode!=keyCode.Comma&&(t.keyCode!=keyCode.SemiColon||t.shiftKey)&&t.keyCode!=keyCode.Enter||(t=$("#domain-input-text").val(),isDomainSelected=!0,objectConvertAsChip(t))}),$(document).on("keyup","#domain-name-content",function(t){var e=document.getElementById("domain-chip-content").ej2_instances;null==e||null!=e[0].chips&&0!=e[0].chips?null==e&&0==$("#domain-input-text").val().length&&applyDomainContainer():(""==$("#domain-input-text").val()&&applyDomainContainer(),e[0].chips=[],setTimeout(function(){$("#domain-chip-content").html("")},100)),setTimeout(function(){removeDomainValidation(),checkSaveEnabled()},100)}),$(document).on("paste","#domain-input-text",function(t){var e=(isIE?window:t.originalEvent).clipboardData.getData("Text").trim().split(/[\s,;\r?\n]+/);if(1<e.length){for(var i=0;i<e.length;i++){var n=e[i];isAlreadyExists(n)&&""!=n&&(domainChipData.push(n),domainChipConversion(domainChipData))}setTimeout(function(){$("#domain-input-text").val(""),checkDomainValidation()},100)}}),$(document).on("paste","#ip-input-text",function(t){var e=(isIE?window:t.originalEvent).clipboardData.getData("Text").trim().split(/[\s,;\r?\n]+/);if(1<e.length){for(var i=0;i<e.length;i++){var n=e[i];!validateIpAddress(n)||n.contains("/")||(n+=isIPv6?"/128":"/32"),isIpAlreadyExistsorNot(n)&&""!=n&&(ipChipData.push(n),ipChipConversion(ipChipData))}setTimeout(function(){$("#ip-input-text").val(""),checkIpValidation()},100)}}),$(document).on("keyup","#ip-address-content",function(t){var e=document.getElementById("ip-chip-content").ej2_instances;null==e||null!=e[0].chips&&0!=e[0].chips?null==e&&0==$("#ip-input-text").val().length&&applyIpContainer():(""==$("#ip-input-text").val()&&applyIpContainer(),e[0].chips=[],setTimeout(function(){$("#ip-chip-content").html("")},100)),setTimeout(function(){removeIpValidation(),checkSaveEnabled()},100)}),$(document).on("keyup","#ip-input-text",function(t){t.keyCode!=keyCode.Comma&&(t.keyCode!=keyCode.SemiColon||t.shiftKey)&&t.keyCode!=keyCode.Enter||(t=$("#ip-input-text").val(),isDomainSelected=!1,objectConvertAsChip(t))}),$(document).on("focusin","#domain-input-text",function(){$("#domain-name-content").addClass("focused")}),$(document).on("focusout","#domain-input-text",function(){var t=$("#domain-input-text").val()+",";1<t.length&&(isDomainSelected=!0,objectConvertAsChip(t)),$("#domain-name-content").removeClass("focused")}),$(document).on("focusin","#ip-input-text",function(){$("#ip-address-content").addClass("focused")}),$(document).on("focusout","#ip-input-text",function(){var t=$("#ip-input-text").val()+",";1<t.length&&(isDomainSelected=!1,objectConvertAsChip(t)),$("#ip-address-content").removeClass("focused")}),$(document).on("click","#domain-name-content",function(t){$(t.target).hasClass("e-chip")||$(t.target).hasClass("e-chip-text")||$("#domain-input-text").focus()}),$(document).on("click","#ip-address-content",function(t){$(t.target).hasClass("e-chip")||$(t.target).hasClass("e-chip-text")||$("#ip-input-text").focus()}),$(document).on("keypress","#domain-input-text",function(t){var e=8*($("#domain-input-text").val().length+1);$("#domain-input-text").css("width",e+"px")}),$(document).on("keypress","#ip-input-text",function(t){var e=8*($("#ip-input-text").val().length+1);$("#ip-input-text").css("width",e+"px")}),$(document).on("change","#select-option",function(t){enableSaveButton()}),$(document).on("keydown","#domain-name-content",function(t){t.keyCode==keyCode.BackSpace&&0==$("#domain-input-text").val().length&&(isChrome&&isEdge||t.preventDefault(),null!=(t=document.getElementById("domain-chip-content").ej2_instances))&&0!=t[0].chips&&null!=t[0].chips&&(($("#domain-chip-content > .e-chip:last").hasClass("e-focused")?(t[0].chips.pop(),0<t[0].chips.length&&t[0].refresh(),applyDomainTooltip(),checkDomainValidation(),removeDomainValidation(),checkSaveEnabled(),$("#domain-input-text")):($("#domain-chip-content > .e-chip:last").addClass("e-focused"),$("#domain-chip-content > .e-chip:last"))).focus(),null!=t[0].chips&&0!=t[0].chips.length||getDomainInstance())}),$(document).on("keydown","#ip-address-content",function(t){t.keyCode==keyCode.BackSpace&&0==$("#ip-input-text").val().length&&(isChrome&&isEdge||t.preventDefault(),null!=(t=document.getElementById("ip-chip-content").ej2_instances))&&0!=t[0].chips&&null!=t[0].chips&&(($("#ip-chip-content > .e-chip:last").hasClass("e-focused")?(t[0].chips.pop(),0<t[0].chips.length&&t[0].refresh(),applyIpTooltip(),checkIpValidation(),removeIpValidation(),checkSaveEnabled(),$("#ip-input-text")):($("#ip-chip-content > .e-chip:last").addClass("e-focused"),$("#ip-chip-content > .e-chip:last"))).focus(),null!=t[0].chips&&0!=t[0].chips.length||getIpInstance())}),$(document).on("click",".e-icon-dlg-close",function(t){$(".domain-name-validation").hide(),$(".ip-address-validation").hide(),cancelItemSettings(),ClearSettingsFields()});