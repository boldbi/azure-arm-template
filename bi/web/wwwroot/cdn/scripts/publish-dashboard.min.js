var publishedDashboardInfo="",isPublishDialogBinded=!1,resetAngularEvent=!1,isAdvancedPage=!1,publishTextAreaOriginalHeight="";function publishSiteDetailDialog(e){var t,a,i='<span class ="publish-dialog-header">'+((publishedDashboardInfo=e).ItemType==ItemType.Dashboard?window.Server.App.Localization.PublishDialogHeader:window.Server.App.Localization.PublishDataSourceDialogHeader)+"</span>";isPublishDialogBinded?((a=document.getElementById("publish-site-dialog").ej2_instances)[0].header=i,a[0].btnObj[0].disabled=!0,a[0].show()):((t=document.createElement("div")).setAttribute("id","publish-site-dialog"),document.getElementById(e.ItemType==ItemType.Dashboard?"dashboard-page-container":"content-area").appendChild(t),(a=new ejs.popups.Dialog({header:i,content:document.getElementById("publish-site-content"),buttons:[{click:function(e){(e.currentTarget.ej2_instances[0].content==window.Server.App.Localization.Back?backToPublishDialog:advancedPublishDialog)()},buttonModel:{disabled:!0,cssClass:"app-btn-secondary",content:window.Server.App.Localization.Advanced}},{click:function(e){e.currentTarget.ej2_instances[0].content==window.Server.App.Localization.Submit&&submitTargetSiteDetails(),e.currentTarget.ej2_instances[0].content==window.Server.App.Localization.Next&&backToPublishDialog()},buttonModel:{isPrimary:!0,content:window.Server.App.Localization.Submit}},{click:function(){a.hide(),$("#publish-advanced-container").hide(),isAdvancedPage=!1},buttonModel:{content:window.Server.App.Localization.CloseButton}}],animationSettings:{effect:"Zoom"},open:validatePublishItem,beforeOpen:beforeOpenPublishDialog,beforeClose:beforeClosePublishDialog,width:"700px",showCloseIcon:!0,isModal:!0})).appendTo(t),isPublishDialogBinded=!0),document.querySelector(".bs-deselect-all").parentElement.addEventListener("click",function(e){e.target.classList.contains("bs-deselect-all")&&($("#multiselect-dropdown").val([]),$("#multiselect-dropdown").selectpicker("refresh"))}),ejs.popups.createSpinner({target:document.getElementById("publish-site-dialog")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("publish-site-dialog"))}function beforeOpenPublishDialog(){isAdvancedPage=!1,$("#publish-site-content").show(),$("#publish-category-name").prop("disabled",!1),$("#publish-advanced-container").hide();var e=document.getElementById("publish-site-dialog").ej2_instances,t=angular.element("[ng-controller=PublishCtrl]").scope();t.itemType=publishedDashboardInfo.ItemType,t.itemType==ItemType.Datasource&&$("#publish-category-name").blur(),isSelfHosted&&isMaster?($("#publish-base-container").hide(),$("#publish-select-site-container").show(),e[0].btnObj[1].content=window.Server.App.Localization.Next,e[0].btnObj[0].cssClass="display-none"):(e[0].btnObj[1].content=window.Server.App.Localization.Submit,e[0].btnObj[0].cssClass="",$("#publish-select-site-container").hide(),$("#publish-base-container").show(),t.publishType="External"),"$apply"!=t.$root.$$phase&&"$digest"!=t.$root.$$phase&&t.$apply()}function validatePublishItem(){0<$("#progress-alert-container > .warning-toast").length&&$("#progress-alert-container > .warning-toast").fadeOut();var e=publishedDashboardInfo.ItemType==ItemType.Dashboard?validatePublishItemUrl.dashboard:validatePublishItemUrl.datasource;$.ajax({type:"GET",url:e,data:{itemId:publishedDashboardInfo.Id},success:function(e){var t;e.Status?(t=angular.element("[ng-controller=PublishCtrl]").scope(),ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),isSelfHosted&&isMaster?$("#internal-site").click():(t.publishType="External",backToPublishDialog()),t.linkedDatasources=null!=e.Result?e.Result:[]):(document.getElementById("publish-site-dialog").ej2_instances[0].hide(),publishedDashboardInfo.ItemType==ItemType.Dashboard?warningToast(window.Server.App.Localization.InvalidPublishItem,window.Server.App.Localization.PublishItemValidation+(isNullOrWhitespace(e.StatusMessage)?"":e.StatusMessage),e.ETag,window.Server.App.Localization.PublishDashboard):warningToast(window.Server.App.Localization.PublishDataSourceValidation,isNullOrWhitespace(e.StatusMessage)?"":e.StatusMessage,e.ETag,window.Server.App.Localization.PublishDataSource))}})}function beforeClosePublishDialog(){var e=angular.element("[ng-controller=PublishCtrl]").scope();document.getElementById("publish-site-dialog").ej2_instances[0].btnObj[0].content=window.Server.App.Localization.Advanced,e.selectedSites=[],e.activeSites=[],e.selectedDatasources=[],e.TargetSiteDetail=[],e.userLists=[],e.updateDatasources=[],e.updateUser=[],e.updateSites=[],e.publishType="Internal",e.linkedDatasources=[],$("#multiselect-dropdown").empty(),$("#multiselect-dropdown").selectpicker("refresh"),$("#publish-category-name").val(""),$("#publish-dashboard-description").val(""),$("#publish-dashboard-edit").prop("checked",!1),$("#publish-datasource-edit").prop("checked",!1),$("#ignore-datasource-sync").prop("checked",!1),$("#advance-ignore-datasource-sync").prop("checked",!1),$("#use-source-name").prop("checked",!1),$("#use-source-category").prop("checked",!1),$("#use-same-category").prop("checked",!1),$("#make-public").prop("checked",!1),$("#advanced-make-public").prop("checked",!1),removeCategoryValidation(),removeDropdownValidation(),$("#publish-dashboard-description").outerHeight(publishTextAreaOriginalHeight)}function advancedPublishDialog(){isAdvancedPage=!0,ejs.popups.showSpinner(document.getElementById("publish-site-dialog"));var t=angular.element("[ng-controller=PublishCtrl]").scope(),e=document.getElementById("publish-site-dialog").ej2_instances;e[0].btnObj[0].content=window.Server.App.Localization.Back,e[0].btnObj[1].content=window.Server.App.Localization.Submit,$(".selected-sites li").hasClass("active")?t.selectedSites.some(e=>e.TenantId==t.activeMenu.TenantId)||(t.activeMenu=t.selectedSites[0]):(t.activeMenu=t.selectedSites[0],$(".selected-sites li:first").addClass("active")),updateUsersList()}function backToPublishDialog(){$('[data-bs-toggle="tooltip"]').tooltip(),isAdvancedPage=!1,ejs.popups.showSpinner(document.getElementById("publish-site-dialog"));var e=angular.element("[ng-controller=PublishCtrl]").scope(),t=document.getElementById("publish-site-dialog").ej2_instances;isSelfHosted&&(t[0].btnObj[0].cssClass="",t[0].btnObj[1].content=window.Server.App.Localization.Submit),"Internal"==e.publishType?($("#active-sites-dropdown").removeClass("external-dropdown"),$("#publish-base-container .publish-container").removeClass("external-publish-separator")):($("#active-sites-dropdown").addClass("external-dropdown"),$("#publish-base-container .publish-container").addClass("external-publish-separator")),t[0].btnObj[0].content=window.Server.App.Localization.Advanced,$("#publish-base-container").show(),$("#publish-advanced-container").hide(),$("#publish-select-site-container").hide(),updateDashboardName(),updateCategoryName(),0===$("#multiselect-dropdown > option").length?showActiveSites(e.publishType):(ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),updateTitleForDisabledItem(e.activeSites)),publishTextAreaOriginalHeight=isNullOrWhitespace(publishTextAreaOriginalHeight)?$("#publish-dashboard-description").outerHeight():publishTextAreaOriginalHeight}function updateTitleForDisabledItem(e){$.each(e,function(e,t){var a=null!=t.DNS?t.DNS:t.SiteURL;t.IsPublished?($("#active-sites-dropdown .dropdown-menu .inner .disabled").attr("data-bs-toggle","tooltip"),$("#active-sites-dropdown .dropdown-menu .inner li a").hasClass("no-sites")||(t=publishedDashboardInfo.ItemType==ItemType.Dashboard?window.Server.App.Localization.ItemPublishedTitle:window.Server.App.Localization.DataSourceItemPublishedTitle,$("#active-sites-dropdown .dropdown-menu .inner .disabled").eq(e).attr("data-original-title","<span class='tooltip-row'><span class='tooltip-label'>URL: </span><span class='tooltip-description'>"+a+"</span></span><br><span class='tooltip-row'><span class='tooltip-label'>Note: </span><span class='tooltip-description'>"+t+"</span></span>").attr("data-placement","right").attr("data-html","true"))):$("#active-sites-dropdown .dropdown-menu .inner li").eq(e).attr("data-bs-toggle","tooltip").attr("data-original-title","<span class='tooltip-row'><span class='tooltip-label'>URL: </span><span class='tooltip-description'>"+a+"</span></span>").attr("data-placement","right").attr("data-html","true")}),removeDropdownValidation(),document.querySelectorAll('#publish-site-dialog [data-bs-toggle="tooltip"]').forEach(e=>{new bootstrap.Tooltip(e,{delay:{show:500},container:document.querySelector("#publish-site-dialog")})})}function showActiveSites(e){"Internal"===e?(updateActiveSites(),$("#active-sites-dropdown").removeClass("external-dropdown")):(updateExternalSites(),$("#active-sites-dropdown").addClass("external-dropdown"))}function updateUsersList(){var n=angular.element("[ng-controller=PublishCtrl]").scope();n.userDetail=[],n.userLists=[],$.each(n.selectedSites,function(t,i){$.ajax({type:"GET",url:getUsersPermissionUrl,data:{publishType:n.publishType,tenantId:i.TenantId},success:function(e){var a=[];void 0!==e.Sites&&($.each(e.Sites,function(e,t){n.userDetail.push({Name:t.DisplayName,Id:t.IdPReferenceId,UserId:t.UserId,IsSelected:0==e}),angular.copy(n.userDetail,a)}),"Internal"===n.publishType?n.sampleDetail={SiteIdentifier:i.SiteIdentifier,UserList:a}:n.sampleDetail={SiteIdentifier:i.TenantId,UserList:a},n.userLists.push(n.sampleDetail),n.sampleDetail=[],n.userDetail=[],n.selectedSites.length-1==t&&publishedDashboardInfo.ItemType==ItemType.Dashboard?(n.selectedDatasources=[],$.ajax({type:"GET",url:getDatasourceUrl,data:{itemId:publishedDashboardInfo.Id},success:function(e){null!=e.Datasources&&$.each(e.Datasources,function(e,t){n.selectedDatasources.push({Id:t.DataSourceId,Name:t.DataSourceName,IsLocked:$("#publish-datasource-edit").is(":checked")})}),executeAfterDatasourceUpdated(n)}})):n.selectedSites.length-1==t&&publishedDashboardInfo.ItemType==ItemType.Datasource&&(n.selectedDatasources=[],0<n.linkedDatasources.length&&$.each(n.linkedDatasources,function(e,t){n.selectedDatasources.push({Id:t.Id,Name:t.Name,IsLocked:$("#publish-datasource-edit").is(":checked")})}),executeAfterDatasourceUpdated(n)))}})})}function executeAfterDatasourceUpdated(e){resetAngularEvent&&(e.TargetSiteDetail=[],updateDatasourceIsLocked(),prepareTargetSiteDetail()),pushCategory(),resetAngularEvent=!1,pushUserList(),pushDatasources(),$("#user-selected").addClass("selectpicker"),$("#user-selected").selectpicker("refresh"),$("#publish-base-container").hide(),$("#publish-select-site-container").hide(),$("#publish-advanced-container").show(),ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),document.querySelectorAll('#publish-site-dialog [data-bs-toggle="tooltip"]').forEach(e=>{new bootstrap.Tooltip(e,{delay:{show:500},container:document.querySelector("#publish-site-dialog")})})}function submitTargetSiteDetails(){var a;!canPublish()||$(".selected-sites #warning-info").is(":visible")||(ejs.popups.showSpinner(document.getElementById("publish-site-dialog")),a=angular.element("[ng-controller=PublishCtrl]").scope(),isAdvancedPage||publishedDashboardInfo.ItemType!=ItemType.Dashboard?(isAdvancedPage||publishedDashboardInfo.ItemType!=ItemType.Datasource||0<a.linkedDatasources.length&&$.each(a.linkedDatasources,function(e,t){a.selectedDatasources.push({Id:t.Id,Name:t.Name,IsLocked:$("#publish-datasource-edit").is(":checked")})}),publishDashboard()):(a.selectedDatasources=[],$.ajax({type:"GET",url:getDatasourceUrl,data:{itemId:publishedDashboardInfo.Id},success:function(e){0<a.linkedDatasources.length&&$.each(a.linkedDatasources,function(e,t){a.selectedDatasources.push({Id:t.Id,Name:t.Name,IsLocked:$("#publish-datasource-edit").is(":checked")})}),null!=e.Datasources&&$.each(e.Datasources,function(e,t){a.selectedDatasources.push({Id:t.DataSourceId,Name:t.DataSourceName,IsLocked:$("#publish-datasource-edit").is(":checked")})}),publishDashboard()}})))}function publishDashboard(){var e=angular.element("[ng-controller=PublishCtrl]").scope(),t=(updateCategoryName(),document.getElementById("publish-site-dialog").ej2_instances),e=(0==e.TargetSiteDetail.length&&(e.activeMenu=e.selectedSites[0],prepareTargetSiteDetail()),pushUserListAll(),pushDatasources(),pushCategory(),$("#publish-advanced-container .e-input-group.e-control-wrapper").addClass("disable-category-dropdown"),{targetSiteDetail:JSON.stringify(e.TargetSiteDetail),itemId:publishedDashboardInfo.Id}),a=publishedDashboardInfo.ItemType==ItemType.Dashboard?publishDashboardUrl.dashboard:publishDashboardUrl.datasource;$.ajax({type:"POST",url:a,data:e,success:function(e){e.Status?publishedDashboardInfo.ItemType==ItemType.Dashboard?successToast(window.Server.App.Localization.PublishDashboardSuccess,7e3,e.ETag):successToast(window.Server.App.Localization.PublishDataSourceSuccess,7e3,e.ETag):publishedDashboardInfo.ItemType==ItemType.Dashboard?warningToast(window.Server.App.Localization.PublishDashboardFailure,e.StatusMessage,e.ETag,window.Server.App.Localization.PublishDashboard):warningToast(window.Server.App.Localization.PublishDataSourceFailure,e.StatusMessage,e.ETag,window.Server.App.Localization.PublishDataSource),ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),t[0].hide()}})}function prepareTargetSiteDetail(){var n=angular.element("[ng-controller=PublishCtrl]").scope();$.each(n.selectedSites,function(e,t){var a=n.userLists.find(e=>e.SiteIdentifier==t.SiteIdentifier),i=[];angular.copy(n.selectedDatasources,i),n.sampleDetail={SiteIdentifier:t.SiteIdentifier,TenantId:t.TenantId,CanIgnoreDataSourceUpdate:$("#ignore-datasource-sync").is(":checked"),ExternalSiteId:"External"==n.publishType?t.ExternalSiteId:0,UserId:void 0===a||0==a.UserList.length?0:a.UserList[0].UserId,IdpReferenceIdString:void 0===a||0==a.UserList.length?null:a.UserList[0].Id,PublishItem:{CategoryName:$("#publish-category-name").val().trim(),Description:$("#publish-dashboard-description").val().trim(),Name:$("#publish-dashboard-name").val().trim(),IsLocked:$("#publish-dashboard-edit").is(":checked"),IsPublic:$("#make-public").is(":checked")},Datasources:i,PublishType:n.publishType,UseSourceItemName:$("#use-source-name").is(":checked")},n.TargetSiteDetail.push(n.sampleDetail),n.sampleDetail=[]}),n.$apply()}function extractSelectedSites(){var i=angular.element("[ng-controller=PublishCtrl]").scope();i.selectedSites=[],$.each($("#active-sites-dropdown option:selected"),function(e,t){var a="External"==i.publishType?i.activeSites.find(e=>e.TenantId==t.attributes.id.value&&e.ExternalSiteId==t.attributes.externalSiteId.value):i.activeSites.find(e=>e.TenantId==t.attributes.id.value);i.selectedSites.push({SiteIdentifier:a.SiteIdentifier,TenantId:a.TenantId,TenantName:a.TenantName,ExternalSiteId:a.ExternalSiteId})}),activateSubmit(),resetAngularEvent=!0,i.$apply()}function pushDatasources(){$("#datasource-list-dropdown").empty();var t=angular.element("[ng-controller=PublishCtrl]").scope(),e=t.TargetSiteDetail.find(e=>e.TenantId==t.activeMenu.TenantId);void 0!==e&&0!=e.Datasources.length&&$.each(e.Datasources,function(e,t){t.IsLocked?$("#datasource-list-dropdown").append('<option value="'+t.Id+'"selected>'+t.Name+"</option>"):$("#datasource-list-dropdown").append('<option value="'+t.Id+'">'+t.Name+"</option>")}),0==t.selectedDatasources.length&&$("#datasource-list-dropdown").append("<option disabled>"+(ItemType.Dashboard==publishedDashboardInfo.ItemType?window.Server.App.Localization.NoDataSources:window.Server.App.Localization.NoLinkedDataSources)+"</option>"),$("#datasource-list-dropdown").selectpicker("refresh"),$('[data-bs-toggle="tooltip"]').tooltip()}function pushCategory(){ItemType.Dashboard==publishedDashboardInfo.ItemType&&($.ajax({type:"POST",url:getCategories,data:"",success:function(e){var t=$(".advanced-page-container"),a=document.querySelector(".advanced-page-container #select-source-category");null!=a&&null!=a.ej2_instances&&a.ej2_instances[0].destroy(),new ejs.dropdowns.DropDownTree({fields:{dataSource:e,value:"Id",text:"Name",child:"SubCategory"},select:function(){publishCategoryListChange(t)},value:null!=publishedDashboardInfo.CategoryId?[publishedDashboardInfo.CategoryId]:[e[0].Id.toString()],allowFiltering:!0,destroyPopupOnHide:!1,showClearButton:!1}).appendTo(".advanced-page-container #select-source-category")}}),setTimeout(function(){$("#select-source-category").prop("disabled",!0),$("#publish-advanced-container .e-input-group.e-control-wrapper").addClass("disable-category-dropdown")},500))}function publishCategoryListChange(e){for(var t=document.querySelector(".e-dropdowntree").ej2_instances[0],a=$(".e-list-item[aria-selected='true']"),i=parseInt(a.attr("aria-level")),n=[],s=1;s<i;s++){var o=a.closest(".e-list-item[aria-level='"+s+"']").find(".e-list-text")[0].innerText;n.push(o)}n.push(t.currentText);t=n.join(" / ");e.find("input.e-dropdowntree").val(t),$(".advanced-page-container").find("#select-source-category").val(),angular.element("[ng-controller=PublishCtrl]").scope()}function pushUserList(){setTimeout(function(){var t=angular.element("[ng-controller=PublishCtrl]").scope(),e=($("#user-selected").empty(),t.selectedUsers=[],[]),e="Internal"===t.publishType?t.userLists.find(e=>e.SiteIdentifier==t.activeMenu.SiteIdentifier):t.userLists.find(e=>e.SiteIdentifier==t.activeMenu.TenantId),a=t.TargetSiteDetail.find(e=>e.TenantId==t.activeMenu.TenantId);void 0!==e&&0!=e.UserList.length&&($.each(e.UserList,function(e,t){t.IsSelected?($("#user-selected").append('<option value="'+t.UserId+'"selected>'+t.Name+"</option>"),a.UserId=t.UserId,a.IdpReferenceIdString=t.Id):$("#user-selected").append('<option value="'+t.UserId+'">'+t.Name+"</option>")}),$("#user-selected").selectpicker("refresh"))},500)}function pushUserListAll(){var a=angular.element("[ng-controller=PublishCtrl]").scope();$("#user-selected").empty();for(let t=0;t<a.TargetSiteDetail.length;t++){$("#user-selected").empty(),a.selectedUsers=[];var e=[],e="Internal"===a.publishType?a.userLists.find(e=>e.SiteIdentifier==a.TargetSiteDetail[t].SiteIdentifier):a.userLists.find(e=>e.SiteIdentifier==a.TargetSiteDetail[t].TenantId),i=a.TargetSiteDetail.find(e=>e.TenantId==a.TargetSiteDetail[t].TenantId);void 0!==e&&0!=e.UserList.length&&($.each(e.UserList,function(e,t){t.IsSelected?($("#user-selected").append('<option value="'+t.UserId+'"selected>'+t.Name+"</option>"),i.UserId=t.UserId,i.IdpReferenceIdString=t.Id):$("#user-selected").append('<option value="'+t.UserId+'">'+t.Name+"</option>")}),$("#user-selected").selectpicker("refresh"))}}function validateAllSite(){var e=$("#advanced-category-name").val();!IsValidName("publishcategoryname",e)||isEmptyOrWhitespace(e)||e.length>$("#advanced-category-name").attr("data-maxlength")?$(".publish-active-sites.active #warning-info").show():$(".publish-active-sites.active #warning-info").hide()}function validateCategoryName(e){var t=(isAdvancedPage?$("#advanced-category-name"):$("#publish-category-name")).val().trim();isAdvancedPage?IsValidName("publishcategoryname",t)||$("#use-same-category").is(":checked")?isEmptyOrWhitespace(t)&&!$("#use-same-category").is(":checked")?($("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.Localization.ItemNameValidator),$("#advanced-category-name").addClass("has-error")):t.length>$("#advanced-category-name").attr("data-maxlength")&&!$("#use-same-category").is(":checked")?($("#advanced-plugin-validation").html(""),$("#advanced-category-validation").html(window.Server.App.Localization.CharacterExceedMessage.format($("#advanced-category-name").attr("data-maxlength"))),$("#advanced-category-name").addClass("has-error")):4<t.split("/").length&&!$("#use-same-category").is(":checked")?($("#advanced-plugin-validation").html(""),$("#advanced-category-validation").html(window.Server.App.Localization.CategoryLimitExceedMessage)):($("#advanced-category-name").removeClass("has-error"),$("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(""),$(".publish-active-sites.active #warning-info").hide()):($("#advanced-plugin-validation").html(""),$("#advanced-category-validation").html(window.Server.App.Localization.AvoidSpecialCharacters),$("#advanced-category-name").addClass("has-error")):isEmptyOrWhitespace(t)?($("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.CategoryNameValidator),$("#publish-category-name").addClass("has-error"),$("#use-source-category").prop("checked",!1)):IsValidName("publishcategoryname",t)?255<t.length?($("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.CharacterExceedMessage.format(255)),$("#publish-category-name").addClass("has-error")):4<t.split("/").length?$("#publish-plugin-validation").html(window.Server.App.Localization.CategoryLimitExceedMessage):($("#publish-category-name").removeClass("has-error"),$("#publish-category-validation").html(""),$("#publish-plugin-validation").html("")):($("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.AvoidSpecialCharacters),$("#publish-category-name").addClass("has-error"))}function validateDescriptionValue(){var e=(isAdvancedPage?$("#advanced-dashboard-description"):$("#publish-dashboard-description")).val().trim();!isAdvancedPage&&e.length>$("#publish-dashboard-description").attr("data-maxlength")?($("#publish-description-validation").html(""),$("#publish-description-plugin-validation").html(window.Server.App.Localization.CharacterExceedMessage.format($("#publish-dashboard-description").attr("data-maxlength"))),$("#publish-dashboard-description").addClass("has-error")):isAdvancedPage?e.length>$("#advanced-dashboard-description").attr("data-maxlength")?($("#advance-publish-description-validation").html(""),$("#advance-publish-description-plugin-validation").html(window.Server.App.Localization.CharacterExceedMessage.format($("#advanced-dashboard-description").attr("data-maxlength"))),$("#advanced-dashboard-description").addClass("has-error")):($("#advanced-dashboard-description").removeClass("has-error"),$("#advance-publish-description-validation").html(""),$("#advance-publish-description-plugin-validation").html("")):($("#publish-dashboard-description").removeClass("has-error"),$("#publish-description-validation").html(""),$("#publish-description-plugin-validation").html(""))}function removeCategoryValidation(){$("#publish-category-validation, #advanced-category-validation, #publish-plugin-validation, #advanced-plugin-validation, #publish-description-validation, #publish-description-plugin-validation, #advanced-publish-description-validation, #advanced-publish-description-plugin-validation").html(""),$("#publish-category-name, #advanced-category-name, #advanced-dashboard-description, #publish-dashboard-description").removeClass("has-error"),$(".publish-active-sites.active #warning-info").hide()}function removeDropdownValidation(){$("#active-sites-dropdown .bootstrap-select .selectpicker").removeClass("has-error"),$("#add-external-sites .btn.btn-default").removeClass("has-error"),$("#active-sites-validation").html(""),activateSubmit()}function canPublish(){var e=(isAdvancedPage?$("#advanced-category-name"):$("#publish-category-name")).val().trim();if(!(0<$("#active-sites-dropdown li.selected").length))return $("#active-sites-validation").html(window.Server.App.Localization.SelectSites),$("#active-sites-dropdown .bootstrap-select .selectpicker").addClass("has-error"),$("#add-external-sites .btn.btn-default").addClass("has-error"),isAdvancedPage&&isEmptyOrWhitespace(e)&&ItemType.Dashboard==publishedDashboardInfo.ItemType&&!$("#use-same-category").is(":checked")?($("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.Localization.ItemNameValidator),$("#advanced-category-name").addClass("has-error")):isEmptyOrWhitespace(e)&&ItemType.Dashboard==publishedDashboardInfo.ItemType?($("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.CategoryNameValidator),$("#publish-category-name").addClass("has-error")):removeCategoryValidation(),!1;if(!$("#use-same-category").is(":checked")){if(isAdvancedPage&&isEmptyOrWhitespace(e)&&ItemType.Dashboard==publishedDashboardInfo.ItemType)return $("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.Localization.ItemNameValidator),$("#advanced-category-name").addClass("has-error"),!1;if(isEmptyOrWhitespace(e)&&ItemType.Dashboard==publishedDashboardInfo.ItemType)return $("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.CategoryNameValidator),$("#publish-category-name").addClass("has-error"),!1;if(!IsValidName("publishcategoryname",e))return $("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.AvoidSpecialCharacters),$("#publish-category-name").addClass("has-error"),!1;if(255<e.length)return $("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.CharacterExceedMessage.format(255)),$("#publish-category-name").addClass("has-error"),!1;if(isAdvancedPage&&255<e.length)return $("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.Localization.CharacterExceedMessage.format(255)),$("#advanced-category-name").addClass("has-error"),!1;if($("#publish-dashboard-description").val().trim().length>$("#publish-dashboard-description").attr("data-maxlength"))return $("#publish-description-validation").html(""),$("#publish-description-plugin-validation").html(window.Server.App.Localization.CharacterExceedMessage.format($("#publish-dashboard-description").attr("data-maxlength"))),$("#publish-dashboard-description").addClass("has-error"),!1;if(isAdvancedPage&&$("#advanced-dashboard-description").val().trim().length>$("#advanced-dashboard-description").attr("data-maxlength"))return $("#advance-publish-description-validation").html(""),$("#advance-publish-description-plugin-validation").html(window.Server.App.Localization.CharacterExceedMessage.format($("#advanced-dashboard-description").attr("data-maxlength"))),$("#advanced-dashboard-description").addClass("has-error"),!1;if(4<e.split("/").length)return $("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.CategoryLimitExceedMessage),$("#publish-category-name").addClass("has-error"),!1;if(isAdvancedPage&&4<e.split("/").length)return $("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.Localization.CategoryLimitExceedMessage),$("#advanced-category-name").addClass("has-error"),!1}return removeCategoryValidation(),removeDropdownValidation(),!0}function activateSubmit(){var e=document.getElementById("publish-site-dialog").ej2_instances,t=isAdvancedPage?!$(".selected-sites #warning-info").is(":visible"):!isEmptyOrWhitespace($("#publish-category-name").val().trim());0<$("#active-sites-dropdown li.selected").length&&(ItemType.Datasource==publishedDashboardInfo.ItemType||t)?e[0].btnObj[0].disabled=!1:e[0].btnObj[0].disabled=!0}function updateDatasourceIsLocked(){var e=angular.element("[ng-controller=PublishCtrl]").scope();$.each(e.selectedDatasources,function(e,t){t.IsLocked=$("#publish-datasource-edit").is(":checked")})}function updateActiveSites(){$.ajax({type:"GET",url:getActiveSitesUrl,data:{itemId:publishedDashboardInfo.Id},success:function(e){var a=angular.element("[ng-controller=PublishCtrl]").scope();$.each(e.Sites,function(e,t){a.activeSites.push({TenantId:t.TenantId,SiteIdentifier:t.TenantIdentifier,TenantName:t.TenantName}),t.IsPublished?$("#multiselect-dropdown").append("<option id="+t.TenantId+" value="+t.TenantIdentifier+" disabled > "+t.TenantName+"</option > "):$("#multiselect-dropdown").append("<option id= "+t.TenantId+" value = "+t.TenantIdentifier+" > "+t.TenantName+"</option > ")}),0==e.Sites.length&&$("#multiselect-dropdown").append('<option class = "no-sites" disabled>'+window.Server.App.Localization.NoActiveSites+"</option>"),$("#multiselect-dropdown").selectpicker("refresh"),ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),updateTitleForDisabledItem(e.Sites)}})}function updateCategoryName(){var a=angular.element("[ng-controller=PublishCtrl]").scope(),i="",i=(isAdvancedPage?$("#use-same-category").is(":checked")?$(".advanced-page-container").find("#select-source-category"):$("#advanced-category-name"):$("#publish-category-name")).val().trim();$.each(a.TargetSiteDetail,function(e,t){a.activeMenu.SiteIdentifier==t.SiteIdentifier&&(t.PublishItem.CategoryName=i)})}function updateDashboardName(){var a=angular.element("[ng-controller=PublishCtrl]").scope();updatedDashboardName=(isAdvancedPage?($("#advanced-source-name").is(":checked")?$("#advanced-dashboard-name").val(publishedDashboardInfo.Name):$("#advanced-dashboard-name").val(publishedDashboardInfo.Name+"_"+$.now()),$("#advanced-dashboard-name")):($("#use-source-name").is(":checked")?$("#publish-dashboard-name").val(publishedDashboardInfo.Name):$("#publish-dashboard-name").val(publishedDashboardInfo.Name+"_"+$.now()),$("#publish-dashboard-name"))).val().trim(),$.each(a.TargetSiteDetail,function(e,t){a.activeMenu.SiteIdentifier==t.SiteIdentifier&&(t.PublishItem.Name=updatedDashboardName)})}serverApp.controller("PublishCtrl",["$scope","$http",function(a,e){a.selectedSites=[],a.activeSites=[],a.userLists=[],a.selectedDatasources=[],a.TargetSiteDetail=[],a.sampleDetail=[],a.activeMenu=[],a.PublishedItems=[],a.updateDatasources=[],a.updateUser=[],a.updateSites=[],a.publishType="Internal",a.itemType=ItemType.Dashboard,isSelfHosted||(a.publishType="External"),a.selectPublishType=function(e){a.publishType=e},a.setActive=function(e,t){a.activeMenu=e,$(".selected-sites li").removeClass("active"),$(t.currentTarget).addClass("active"),setTimeout(function(){pushDatasources(),pushCategory(),pushUserList(),$("#user-selected").addClass("selectpicker"),$("#user-selected").selectpicker("refresh"),publishedDashboardInfo.ItemType==ItemType.Dashboard&&(validateCategoryName(!1),validateAllSite()),validateDescriptionValue()},100)}}]),$(document).on("change","#multiselect-dropdown",function(e){e.stopPropagation(),extractSelectedSites()}),$(document).on("change","#selected-datasources",function(t){t.stopPropagation();var a=angular.element("[ng-controller=PublishCtrl]").scope(),e=a.TargetSiteDetail.find(e=>e.TenantId==a.activeMenu.TenantId).Datasources.find(e=>e.Id==$("#selected-datasources option")[$(t.target.parentElement).index()].value);$(t.target.parentElement).hasClass("selected")?e.IsLocked=!0:e.IsLocked=!1}),$(document).on("change","#user-selected",function(t){var a=angular.element("[ng-controller=PublishCtrl]").scope(),e=[],i=(e="Internal"===a.publishType?a.userLists.find(e=>e.SiteIdentifier==a.activeMenu.SiteIdentifier):a.userLists.find(e=>e.SiteIdentifier==a.activeMenu.TenantId)).UserList.find(e=>1==e.IsSelected);void 0!==i&&(i.IsSelected=!1),e.UserList.find(e=>e.UserId==$(".users-list option")[$(t.target.parentElement).index()].value).IsSelected=!0}),$(document).on("change","input","textarea",function(){resetAngularEvent=!0}),$(document).on("keyup focusout","#active-sites-dropdown",function(e){0<$("#active-sites-dropdown li.selected").length?($("#active-sites-dropdown .bootstrap-select .selectpicker").removeClass("has-error"),$("#add-external-sites .btn.btn-default").removeClass("has-error"),$("#active-sites-validation").html("")):($("#active-sites-validation").html(window.Server.App.Localization.SelectSites),$("#active-sites-dropdown .bootstrap-select .selectpicker").addClass("has-error"),$("#add-external-sites .btn.btn-default").addClass("has-error")),activateSubmit()}),$(document).on("keyup focusout","#publish-category-name,#advanced-category-name",function(e){validateCategoryName(!1),validateAllSite(),activateSubmit()}),$(document).on("keyup focusout","#publish-dashboard-description,#advanced-dashboard-description",function(e){validateDescriptionValue(),activateSubmit()}),$(document).on("click","#use-source-name, #advanced-source-name",function(e){var a;e.target.attributes[1].value.contains("use-source-name")||e.target.attributes[1].value.contains("advanced-source-name")?updateDashboardName():(a=angular.element("[ng-controller=PublishCtrl]").scope(),$.each(a.TargetSiteDetail,function(e,t){a.activeMenu.SiteIdentifier==t.SiteIdentifier&&(t.UseSourceItemName?$("#advanced-dashboard-name").val(publishedDashboardInfo.Name):$("#advanced-dashboard-name").val(publishedDashboardInfo.Name+"_"+$.now()),t.PublishItem.Name=$("#advanced-dashboard-name").val().trim())}))}),$(document).on("click","#use-source-category",function(e){$("#use-source-category").is(":checked")?($("#publish-category-name").val(publishedDashboardInfo.ParentCategoryName),$("#publish-category-name").prop("disabled",!0),validateCategoryName(!0)):($("#publish-category-name").val(""),$("#publish-category-name").prop("disabled",!1)),activateSubmit()}),$(document).on("click","#advanced-ignore-datasource-sync",function(e){$("#advanced-ignore-datasource-sync").is(":checked")?$("#selected-datasources button").prop("disabled",!0):$("#selected-datasources button").prop("disabled",!1)}),$(document).on("click","#use-same-category",function(e){$("#use-same-category").is(":checked")?($("#advanced-category-name").val(publishedDashboardInfo.ParentCategoryName),$("#advanced-category-name").prop("disabled",!0),$("#select-source-category").prop("disabled",!1),$("#publish-advanced-container .e-input-group.e-control-wrapper").removeClass("disable-category-dropdown"),$("#advanced-category-name").removeClass("has-error"),$("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(""),$(".publish-active-sites.active #warning-info").hide(),document.getElementById("publish-site-dialog").ej2_instances[0].btnObj[0].disabled=!1):($("#advanced-category-name").prop("disabled",!1),$("#select-source-category").prop("disabled",!0),$("#publish-advanced-container .e-input-group.e-control-wrapper").addClass("disable-category-dropdown"))});var isExternalSitesDialogBinded=!1,selectedExternalSites=[],editAction=0,isDeleteSiteDialogBinded=!1;function isSiteNameExist(e){return!$("#external-site-name").hasClass("has-error")}function getExternalSitesDetailDialog(t,a=0,e){var i,n,s;$("#validation-message").html("").hide(),i=1==a?(editAction=a,'<span class ="external-sites-dialog-header">'+(null==t?window.Server.App.Localization.EditExternalSiteDialogHeader:null!=t&&0==t?window.Server.App.Localization.ExternalBISiteEditDialogHeader:window.Server.App.Localization.ExternalReportsSiteEditDialogHeader)+"</span>"):'<span class ="external-sites-dialog-header">'+(null==t?window.Server.App.Localization.ExternalSiteDialogHeader:null!=t&&0==t?window.Server.App.Localization.ExternalBISiteDialogHeader:window.Server.App.Localization.ExternalReportsSiteDialogHeader)+"</span>",isExternalSitesDialogBinded?(ejs.popups.hideSpinner(document.getElementById("external-site-dialog")),(s=document.getElementById("external-site-dialog").ej2_instances)[0].header=i,s[0].beforeOpen=0==a?beforeOpenExternalSitesDialog(0):beforeOpenExternalSitesDialog(1,e),s[0].buttons=[{click:function(e){$("#dialog-container").valid()?saveExternalSites(t,a):e.preventDefault()},buttonModel:{isPrimary:!0,content:window.Server.App.Localization.SaveButton}},{click:function(){s[0].hide()},buttonModel:{content:window.Server.App.Localization.CancelButton}}],s[0].show()):((n=document.createElement("div")).setAttribute("id","external-site-dialog"),document.getElementById("content-area").appendChild(n),(s=new ejs.popups.Dialog({header:i,content:document.getElementById("get-external-site-content"),buttons:[{click:function(e){$("#dialog-container").valid()?saveExternalSites(t,a):e.preventDefault()},buttonModel:{isPrimary:!0,content:window.Server.App.Localization.SaveButton}},{click:function(){s.hide()},buttonModel:{content:window.Server.App.Localization.CancelButton}}],animationSettings:{effect:"Zoom"},beforeOpen:0==a?beforeOpenExternalSitesDialog(0):beforeOpenExternalSitesDialog(1,e),beforeClose:beforeCloseExternalSitesDialog,width:"600px",showCloseIcon:!0,isModal:!0})).appendTo(n),isExternalSitesDialogBinded=!0,ejs.popups.createSpinner({target:document.getElementById("external-site-dialog")}),ejs.popups.setSpinner({type:"Material"}))}$(document).ready(function(){$.validator.addMethod("isRequired",function(e,t){return!isEmptyOrWhitespace(e)},window.Server.App.Localization.ItemNameValidator),$.validator.addMethod("isValidName",function(e,t){return IsValidName("name",e)},window.Server.App.Localization.AvoidSpecialCharacters),$.validator.addMethod("additionalSpecialCharValidation",function(e,t){if(/^[a-zA-Z_0-9`~!\$\^()=\-\.\{\} ]+$/.test(e)||""===e)return!0},window.Server.App.Localization.AvoidSpecialCharacters),$.validator.addMethod("isSiteNameValid",function(e,t){return isSiteNameExist(e)},window.Server.App.Localization.SiteNameExist),$.validator.addMethod("isValidUrl",function(e,t){return isValidUrl(e)},window.Server.App.Localization.IsValidUrl),$("#dialog-container").validate({errorElement:"span",onkeyup:function(e,t){9!=t.keyCode&&(isKeyUp=!0,$(e).valid(),isKeyUp=!1)},onfocusout:function(e){$(e).valid()},rules:{"external-site-name-input":{isRequired:!0,isValidName:!0,isSiteNameValid:!0,additionalSpecialCharValidation:!0},"external-client-id-input":{isRequired:!0},"external-client-secret-input":{isRequired:!0},"external-site-url-input":{isRequired:!0,isValidUrl:!0}},highlight:function(e){$(e).closest("div").addClass("has-error")},unhighlight:function(e){$(e).closest("div").removeClass("has-error"),$(e).closest("div").find("span").html("")},errorPlacement:function(e,t){$(t).closest("div").find("span").html(e.html()).show()},messages:{"external-site-name-input":{isRequired:window.Server.App.Localization.ItemNameValidator},"external-client-id-input":{isRequired:window.Server.App.Localization.ClientId},"external-client-secret-input":{isRequired:window.Server.App.Localization.ClientSecret},"external-site-url-input":{isRequired:window.Server.App.Localization.SiteURLValidator}}})});var oldSiteName="",oldSiteUrl="",Id="";function beforeOpenExternalSitesDialog(e,t){var a,i;$("#get-external-site-content").show(),$("#external-site-name, #external-client-id, #external-client-secret, #external-site-url").parent("div").removeClass("has-error"),$(".client-secret-validation-message, .clientid-validation-message, .site-url-validation-message, .name-validation-message").html(""),1==e&&(e=$(t).attr("data-name"),a=$(t).attr("data-clientid"),i=$(t).attr("data-site-url"),t=$(t).attr("data-id"),$("#external-site-name").val(e),$("#external-client-id").val(a),$("#external-site-url").val(i),oldSiteName=e,oldSiteUrl=i,Id=t)}$(document).on("keyup focusout","#external-site-name",function(e){$("#validation-message").html("").hide();var t=$("#external-site-name").val().toLowerCase().trim();"focusout"===e.type?0==editAction?isNullOrWhitespace(t)||siteNameCheck(t):1!=editAction||t==oldSiteName.toLowerCase().trim()||isNullOrWhitespace(t)||siteNameCheck(t):(isNullOrWhitespace(t)||($(".name-validation-message").html(""),$("#external-site-name").closest("div").removeClass("has-error")),$("[name='external-site-name-input']").valid())}),$(document).on("focusout","#external-site-url",function(e){$("#validation-message").html("").hide();var t=$("#external-site-url").val().toLowerCase().trim();isNullOrWhitespace(t)||isValidUrl(t)||$("#external-site-url").closest("div").removeClass("has-error")}),$(document).on("keyup","#external-site-url",function(e){$("#validation-message").html("").hide(),$(".site-url-validation-message").html(""),$("#external-site-url").closest("div").removeClass("has-error")}),$(document).on("focusout","#external-client-id",function(e){$("#validation-message").html("").hide()}),$(document).on("keyup","#external-client-id",function(e){$("#validation-message").html("").hide(),$(".clientid-validation-message").html(""),$("#external-client-id").closest("div").removeClass("has-error")});var isFreshLoad=!0;function pushUrl(e){isFreshLoad?(history.replaceState(e,null,window.location.pathname+"?tab="+e),isFreshLoad=!1):history.pushState(e,null,window.location.pathname+"?tab="+e)}function beforeCloseExternalSitesDialog(){$("#external-site-name, #external-client-id, #external-client-secret, #external-site-url").parent("div").removeClass("has-error"),$("#external-client-id, #external-client-secret, #external-site-url, #external-site-name").val(""),$(".client-secret-validation-message, .clientid-validation-message, .site-url-validation-message, .name-validation-message").html(""),editAction=0}function updateExternalSites(){$.ajax({type:"GET",data:{itemId:publishedDashboardInfo.Id},url:getExternalSitesUrl,success:function(e){var a;e.Status&&(a=angular.element("[ng-controller=PublishCtrl]").scope(),$.each(e.Result,function(e,t){a.activeSites.push({TenantId:t.ClientId.toLowerCase(),SiteIdentifier:"",TenantName:t.Name,ExternalSiteId:t.Id}),t.IsPublished?$("#multiselect-dropdown").append("<option id="+t.ClientId.toLowerCase()+" externalSiteId="+t.Id+" value="+t.ClientId.toLowerCase()+" disabled>"+t.Name+"</option>"):$("#multiselect-dropdown").append("<option id="+t.ClientId.toLowerCase()+" externalSiteId="+t.Id+" value="+t.ClientId.toLowerCase()+" >"+t.Name+"</option>")}),0==e.Result.length&&$("#multiselect-dropdown").append('<option class = "no-sites" disabled>'+window.Server.App.Localization.NoActiveSites+"</option>"),null!=selectedExternalSites&&0!=selectedExternalSites.length&&($("#multiselect-dropdown").selectpicker("val",selectedExternalSites),extractSelectedSites()),$("#multiselect-dropdown").selectpicker("refresh"),selectedExternalSites=[],ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),updateTitleForDisabledItem(e.Result),0<$("#external-site-dialog").length)&&document.getElementById("external-site-dialog").ej2_instances[0].hide()}})}function saveExternalSites(t,a){selectedExternalSites=$("#multiselect-dropdown").val();var e={Name:$("#external-site-name").val().trim(),ClientId:$("#external-client-id").val().trim(),ClientSecret:$("#external-client-secret").val().trim(),SiteURL:$("#external-site-url").val().trim()},i=((selectedExternalSites=null==selectedExternalSites?[]:selectedExternalSites).push(e.ClientId),ejs.popups.showSpinner(document.getElementById("external-site-dialog")),window.location.href);$.ajax({type:"POST",url:1==a?editExternalSiteUrl:addExternalSitesUrl,data:1==a?{externalSite:e,siteUrl:oldSiteUrl,siteName:oldSiteName,id:Id}:{externalSite:e},success:function(e){e.Status?e.Data?($(".name-validation-message").html(window.Server.App.Localization.SiteNameExist),$("#external-site-name").closest("div").addClass("has-error"),ejs.popups.hideSpinner(document.getElementById("external-site-dialog"))):e.Result?i.includes("profile/connected-sites")||i.includes("administration/widgets?tab=reports-widgets")?(0<$("#external-site-dialog").length&&document.getElementById("external-site-dialog").ej2_instances[0].hide(),(null!=t&&0==t?getExternalSites:getExternalReportsSites)(),1==a?successToast(window.Server.App.Localization.ExternalSiteEditSuccess,7e3,e.ETag):successToast(window.Server.App.Localization.ExternalSiteSuccess,7e3,e.ETag)):($("#multiselect-dropdown").empty(),$("#multiselect-dropdown").selectpicker("refresh"),angular.element("[ng-controller=PublishCtrl]").scope().activeSites=[],updateExternalSites()):($(".site-url-validation-message").html(window.Server.App.Localization.ExternalSiteUnavailable),$("#external-site-url").closest("div").addClass("has-error"),ejs.popups.hideSpinner(document.getElementById("external-site-dialog"))):null==e.IsValidClientId||e.IsValidClientId?(e.IsNonAdminAndNonOwner&&(ejs.popups.hideSpinner(document.getElementById("external-site-dialog")),document.getElementById("external-site-dialog").ej2_instances[0].hide(),warningToast(window.Server.App.Localization.NonAdminAndNonOwner,e.ETag)),null!=e.Data&&e.Data?((null!=t&&1==t||i.includes("profile/connected-sites")?$("#validation-message").html(e.Message):$("#validation-message").html(window.Server.App.Localization.ExternalSiteValidationMessage.format(e.Message,"<a href= "+connectedSitesUrl+' target="_blank">',"</a>"))).show(),ejs.popups.hideSpinner(document.getElementById("external-site-dialog"))):null!=e.Result&&!e.Result||null!=e.Data&&!e.Data||null!=e.Message&&null!=e.Message?($("#validation-message").html(e.Message).show(),ejs.popups.hideSpinner(document.getElementById("external-site-dialog"))):(ejs.popups.hideSpinner(document.getElementById("external-site-dialog")),1==a?warningToast(null!=e.permissionDenied&&e.permissionDenied?window.Server.App.Localization.PermissionWarningAlert:window.Server.App.Localization.ExternalSiteEditFailure,null!=e.permissionDenied&&e.permissionDenied?null:e.Message,null,window.Server.App.Localization.ExternalSiteDialogHeader):warningToast(null!=e.permissionDenied&&e.permissionDenied?window.Server.App.Localization.PermissionWarningAlert:window.Server.App.Localization.ExternalSiteFailure,null!=e.permissionDenied&&e.permissionDenied?null:e.Message,null,window.Server.App.Localization.ExternalSiteDialogHeader),document.getElementById("external-site-dialog").ej2_instances[0].hide())):($(".clientid-validation-message").html(e.Message),$("#external-client-id").closest("div").addClass("has-error"),ejs.popups.hideSpinner(document.getElementById("external-site-dialog")))}})}function siteNameCheck(e){$.ajax({type:"POST",url:isSiteNameExistsUrl,data:{siteName:e},success:function(e){e.Status?($(".name-validation-message").html(window.Server.App.Localization.SiteNameExist),$("#external-site-name").closest("div").addClass("has-error")):($(".name-validation-message").html(""),$("#external-site-name").closest("div").removeClass("has-error"))}})}function deleteConfirmation(n){setTimeout(function(){var e,t,a="",a=(a=$("#ConnectedSitesGrid").data("ejGrid")).getCurrentViewData()[a.getIndexByRow($("tr.e-row[aria-selected *='true']"))],i='<span class="dialog-header-with-icon"><span class ="dialog-header-title"><i class="su su-delete dialog-header-icon"></i>&nbsp;&nbsp;'+window.Server.App.Localization.DeleteConnectedSite+"</span></span>";isDeleteSiteDialogBinded?((t=document.getElementById("delete-site-dialog").ej2_instances)[0].header=i,t[0].content=window.Server.App.Localization.DeleteSiteConfirm.format('<span class ="highlight-name">'+a.Name+"</span>"),t[0].buttons=[{click:function(e){removeExternalSite(n)},buttonModel:{cssClass:"app-btn-danger",content:window.Server.App.Localization.YesButton}},{click:function(){t[0].hide()},buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.NoButton}}],t[0].show()):((e=document.createElement("div")).setAttribute("id","delete-site-dialog"),document.getElementById("server-app-container").appendChild(e),(t=new ejs.popups.Dialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,width:460<window.innerWidth?"450px":window.innerWidth-10,height:"auto",showHeader:!1,animationSettings:{effect:"Zoom"},isModal:!0,enableModal:!0,closeOnEscape:!0,header:i,showCloseIcon:!0,content:window.Server.App.Localization.DeleteSiteConfirm.format('<span class ="highlight-name">'+a.Name+"</span>"),buttons:[{click:function(e){removeExternalSite(n)},buttonModel:{cssClass:"app-btn-danger",content:window.Server.App.Localization.YesButton}},{click:function(){t.hide()},buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.NoButton}}]})).appendTo(e),isDeleteSiteDialogBinded=!0),ejs.popups.createSpinner({target:document.getElementById("delete-site-dialog")}),ejs.popups.setSpinner({type:"Material"})},100)}function deleteReportsSiteConfirmation(n){setTimeout(function(){var e,t,a=$("#ReportsConnectedSitesGrid").data("ejGrid"),a=a.getCurrentViewData()[a.getIndexByRow($("tr.e-row[aria-selected *='true']"))],i='<span class="dialog-header-with-icon"><span class ="dialog-header-title"><i class="su su-delete dialog-header-icon"></i>&nbsp;&nbsp;'+window.Server.App.Localization.DeleteConnectedSite+"</span></span>";isDeleteSiteDialogBinded?((t=document.getElementById("delete-reports-site-dialog").ej2_instances)[0].header=i,t[0].content=window.Server.App.Localization.DeleteSiteConfirm.format('<span class ="highlight-name">'+a.Name+"</span>"),t[0].buttons=[{click:function(e){removeExternalReportsSite(n)},buttonModel:{cssClass:"app-btn-danger",content:window.Server.App.Localization.YesButton}},{click:function(){t[0].hide()},buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.NoButton}}],t[0].show()):((e=document.createElement("div")).setAttribute("id","delete-reports-site-dialog"),document.getElementById("server-app-container").appendChild(e),(t=new ejs.popups.Dialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,width:460<window.innerWidth?"450px":window.innerWidth-10,height:"auto",showHeader:!1,animationSettings:{effect:"Zoom"},isModal:!0,enableModal:!0,closeOnEscape:!0,header:i,showCloseIcon:!0,content:window.Server.App.Localization.DeleteSiteConfirm.format('<span class ="highlight-name">'+a.Name+"</span>"),buttons:[{click:function(e){removeExternalReportsSite(n)},buttonModel:{cssClass:"app-btn-danger",content:window.Server.App.Localization.YesButton}},{click:function(){t.hide()},buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.NoButton}}]})).appendTo(e),isDeleteSiteDialogBinded=!0),ejs.popups.createSpinner({target:document.getElementById("delete-reports-site-dialog")}),ejs.popups.setSpinner({type:"Material"})},100)}function removeExternalSite(e){var e=$(e).attr("data-id"),t=(ejs.popups.showSpinner(document.getElementById("delete-site-dialog")),document.getElementById("delete-site-dialog").ej2_instances);$.ajax({type:"POST",url:removeExternalSiteUrl,data:{id:e},success:function(e){e.status?(getExternalSites(),successToast(window.Server.App.Localization.DeleteSiteSuccess,7e3)):e.IsNonAdminAndOwner?warningToast(window.Server.App.Localization.NonAdminAndNonOwner,null,null,window.Server.App.Localization.DeleteConnectedSite):warningToast(window.Server.App.Localization.DeleteSiteFailure,null,null,window.Server.App.Localization.DeleteConnectedSite),ejs.popups.hideSpinner(document.getElementById("delete-site-dialog")),t[0].hide()}})}function removeExternalReportsSite(e){e=$(e).attr("data-id");$.ajax({type:"POST",url:removeExternalReportsSiteUrl,data:{id:e},success:function(e){e.status?(getExternalReportsSites(),successToast(window.Server.App.Localization.DeleteSiteSuccess,7e3)):warningToast(null!=e.permissionDenied&&e.permissionDenied?window.Server.App.Localization.PermissionWarningAlert:window.Server.App.Localization.DeleteSiteFailure,null!=e.permissionDenied&&e.permissionDenied?null:e.message,null,window.Server.App.Localization.DeleteConnectedSite),$("#messageBox_wrapper").ejWaitingPopup("hide"),onCloseMessageBox()}})}function getExternalSites(){$("#ConnectedSitesGrid").ejWaitingPopup("show"),$.ajax({type:"GET",url:getExternalSitesUrl,success:function(e){e.Status&&$("#ConnectedSitesGrid").data("ejGrid").dataSource(e.Result),$("#ConnectedSitesGrid").ejWaitingPopup("hide")}})}function getExternalReportsSites(){$("#ReportsConnectedSitesGrid").ejWaitingPopup("show"),$.ajax({type:"GET",url:getExternalReportsSitesUrl,success:function(e){e.status&&$("#ReportsConnectedSitesGrid").data("ejGrid").dataSource(e.result),$("#ReportsConnectedSitesGrid").ejWaitingPopup("hide")}})}$(document).on("click",'a[data-bs-toggle="tab"]',function(e){pushUrl($(e.target).attr("href").replace("#",""))}),window.onpopstate=function(e){$('.nav-tabs a[href="#'+e.state+'"]').tab("show")},$(document).on("mousedown",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")}),$(document).on("mouseup",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")}),$(document).on("touchstart",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")}),$(document).on("touchend",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")}),$(document).on("mouseleave",".show-hide-password",function(){$(this).siblings("input").attr("type","password")}),window.innerWidth<1041&&$(document).on("click",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")});