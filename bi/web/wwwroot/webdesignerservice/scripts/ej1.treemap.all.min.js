/*!
*  filename: ej1.treemap.all.min.js
*  version : 7.7.9
*  Copyright Syncfusion Inc. 2001 - 2024. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n,t,i){var u;t.widget("BoldBIDashboardTreeMap","BoldBIDashboard.datavisualization.TreeMap",{validTags:["div"],defaults:{colorPath:null,legendItemRendering:null,itemRendering:null,leafItemSettings:{borderThickness:1,borderBrush:"white",showLabels:!1,labelPath:null,gap:0,itemTemplate:null,labelPosition:"topleft",labelVisibilityMode:"visible"},dataSource:null,groupColorMapping:[],enableDrillDown:!1,enableDrillDownArrow:!0,isVirtualRender:!1,drillDownLevel:0,drillDownDataValue:null,drilledStateLevel:0,drillDownHeaderColor:null,drillDownSelectionColor:"#000000",colorValuePath:null,fill:"gray",weightValuePath:null,treeMapItems:[],showLegend:!1,showSubItems:!0,borderBrush:"white",borderThickness:1,enableResize:!0,enableGradient:!1,isResponsive:!0,itemsLayoutMode:"squarified",levels:[],doubleClick:"",click:"",legendSettings:{template:"",iconHeight:15,iconWidth:15,height:0,width:0,textPath:null,mode:"default",leftLabel:"",rightLabel:"",dockPosition:"top",alignment:"near",toggleVisibility:!1,columnCount:0},rangeColorMapping:[],uniColorMapping:{color:null},desaturationColorMapping:{from:0,to:0,color:"",rangeMinimum:0,rangeMaximum:0},paletteColorMapping:{colors:[]},highlightOnSelection:!1,selectionMode:"default",highlightGroupOnSelection:!1,groupSelectionMode:"default",draggingOnSelection:!1,draggingGroupOnSelection:!1,showTooltip:!1,tooltipTemplate:null,highlightBorderThickness:5,highlightGroupBorderThickness:4,highlightBorderBrush:"gray",highlightGroupBorderBrush:"gray"},dataTypes:{dataSource:"data",treeMapItems:"array",levels:"array",rangeColorMapping:"array",paletteColorMapping:"object",groupColorMapping:"array"},observables:["dataSource","colorValuePath","weightValuePath","showLegend","enableResize","highlightOnSelection","selectionMode","groupSelectionMode","highlightGroupOnSelection","enableDrillDown","drillDownHeaderColor","drillDownSelectionColor","showTooltip","highlightBorderThickness","highlightBorderBrush","itemsLayoutMode","leafItemSettings.borderThickness","leafItemSettings.borderBrush","leafItemSettings.showLabels","leafItemSettings.labelPath","legendSettings.iconWidth","legendSettings.iconHeight","legendSettings.textPath","legendSettings.dockPosition","legendSettings.height","legendSettings.width","uniColorMapping.color","desaturationColorMapping.from","desaturationColorMapping.to","desaturationColorMapping.color","desaturationColorMapping.rangeMinimum","desaturationColorMapping.rangeMaximum"],_tags:[{tag:"levels",attr:["groupPath","groupGap","headerHeight","showHeader","groupPadding","groupBackground","groupBorderColor","groupBorderThickness"],singular:"level"},{tag:"rangeColorMapping",attr:["color","legendLabel","from","to"],singular:"rangeColor"},{tag:"groupColorMapping",attr:["groupID",{tag:"groupColorMapping.rangeColorMapping",attr:["color","legendLabel","from","to"],singular:"groupRangeColor"},"uniColorMapping.color","desaturationColorMapping.from","desaturationColorMapping.to","desaturationColorMapping.color","desaturationColorMapping.rangeMinimum","desaturationColorMapping.rangeMaximum"],singular:"groupColor"}],dataSource:t.util.valueFunction("dataSource"),colorValuePath:t.util.valueFunction("colorValuePath"),colorPath:t.util.valueFunction("colorPath"),weightValuePath:t.util.valueFunction("weightValuePath"),showLegend:t.util.valueFunction("showLegend"),enableResize:t.util.valueFunction("enableResize"),highlightOnSelection:t.util.valueFunction("highlightOnSelection"),selectionMode:t.util.valueFunction("selectionMode"),highlightGroupOnSelection:t.util.valueFunction("highlightGroupOnSelection"),groupSelectionMode:t.util.valueFunction("groupSelectionMode"),enableDrillDown:t.util.valueFunction("enableDrillDown"),enableDrillDownArrow:t.util.valueFunction("enableDrillDownArrow"),drillDownHeaderColor:t.util.valueFunction("drillDownHeaderColor"),drillDownSelectionColor:t.util.valueFunction("drillDownSelectionColor"),showTooltip:t.util.valueFunction("showTooltip"),highlightBorderThickness:t.util.valueFunction("highlightBorderThickness"),itemsLayoutMode:t.util.valueFunction("itemsLayoutMode"),highlightBorderBrush:t.util.valueFunction("highlightBorderBrush"),borderThickness:t.util.valueFunction("leafItemSettings.borderThickness"),borderBrush:t.util.valueFunction("leafItemSettings.borderBrush"),showLabels:t.util.valueFunction("leafItemSettings.showLabels"),labelPath:t.util.valueFunction("leafItemSettings.labelPath"),iconWidth:t.util.valueFunction("legendSettings.iconWidth"),iconHeight:t.util.valueFunction("legendSettings.iconHeight"),textPath:t.util.valueFunction("legendSettings.textPath"),dockPosition:t.util.valueFunction("legendSettings.dockPosition"),legendheight:t.util.valueFunction("legendSettings.height"),legendwidth:t.util.valueFunction("legendSettings.width"),itemTemplate:t.util.valueFunction("leafItemSettings.itemTemplate"),uniColor:t.util.valueFunction("uniColorMapping.color"),_color:t.util.valueFunction("desaturationColorMapping.color"),_from:t.util.valueFunction("desaturationColorMapping.from"),_to:t.util.valueFunction("desaturationColorMapping.to"),_rangeMinimum:t.util.valueFunction("desaturationColorMapping.rangeMinimum"),_rangeMaximum:t.util.valueFunction("desaturationColorMapping.rangeMaximum"),_initPrivateProperties:function(){this._svgDocument=null;this._templateDiv=null;this._legenddiv=null;this._drillHeaderDiv=null;this._drillHoverDiv=null;this._legendHeight=0;this._backgroundTile=null;this._prevData=[];this._prevLevels=[];this._prevLegend=[];this._tooltipSize={height:0,width:0};this._height=500;this._margintop=null;this._marginleft=null;this._startPoint={x:0,y:0};this._stopPoint={x:0,y:0};this.mouseClickable=!1;this.dragDiv=null;this._initDiv=null;this._width=500;this._svgns="http://www.w3.org/2000/svg";this._prevSelectedItems=[];this._prevSelectedHeaders=[];this._isLevelColors;this.selectedItems==null&&(this.selectedItems=[]);this.treeMapItemSelected=null;this.treeMapGroupSelected=null;this._browser=null;this._toolTipElement=null;this._rootTreeMapItems=[];this.treemapgroups=[];this._drillHeader=null;this._drilldownItem=null;this._drilldownItems=[];this._treeMapHeaders=[];this._drilldownHeaders=[];this.preRender=null;this.drillStarted=null;this.headerTemplateRendering=null;this.drillDownItemSelected=null;this._treeMapLabels=[];this._labelTemplateElements=[];this._itemGroups=[];this._prevSelectedGroupDatas=[];this._interactiveArrow=null;this._legendRects=[];this._toggle=[];this._rangeInVisibility==null&&(this._rangeInVisibility=[]);this._tog==null&&(this._tog=[]);this._rangevisible==null&&(this._rangevisible=[]);this._levelItemCollections==null&&(this._levelItemCollections=[]);this._levelChangedItemCollections=[];this._drillDownLevelData=null;this._allowDoubleClick=!1;this._allowItemSelectEvent=!1},_setModel:function(n){for(var t in n)switch(t){case"itemsLayoutMode":this.itemsLayoutMode(n[t]);this.refresh()}},_levels:function(){this.refresh()},_rangeColorMapping:function(){this._setColorMappings(this._rootTreeMapItems,this.model)},_groupColorMapping:function(){this._setColorMappings(this._rootTreeMapItems,this.model)},_groupColorMapping_rangeColorMapping:function(){this._setColorMappings(this._rootTreeMapItems,this.model)},_init:function(){this._initPrivateProperties();var t=n("<style>.drillGroupRect:hover{ background-color:"+this.drillDownSelectionColor()+";}<\/style>");n("html > head").append(t);this._levelInitialize();this.refresh()},_destroy:function(){this._unWireEvents();n(this.element).removeClass("e-treemap e-js").find().remove(".tooltipelement");n(this.element).empty()},_levelInitialize:function(){var t=this;this.model.levels!=null?n.each(this.model.levels,function(i,r){r=t._checkArrayObject(r,i);var f=new u;n.extend(f,r);n.extend(r,f)}):this.levels.treeMapLevel=new u;n(document).click({treeMap:this},this._docClickFunction)},_checkArrayObject:function(t,i){var r=this;return n.each(t,function(n,t){if(t instanceof Array)r._checkArrayObject(t,n);else if(t!=null&&typeof t=="object"){var f=new u;r._loadIndividualDefaultValues(t,f,typeof n=="number"?i:n)}}),t},_loadIndividualDefaultValues:function(t,i,r){var u=null,f=this;return n.each(i,function(n,t){if(r==n){u=t;return}}),u instanceof Array&&(u=u[0]),n.each(t,function(n,t){t instanceof Array?f._checkArrayObject(t,r):t!=null&&typeof t=="object"&&f._loadIndividualDefaultValues(t,t,typeof n=="number"?r:n)}),n.extend(u,t),n.extend(t,u),t},refresh:function(i,r){var f=this.model.drillDownLevel>0,e,u,o;this._unWireEvents();this._groupLevelItemCollection();i||(this._drilldownItems=[]);this.model.enableResize||this.model.isResponsive||f?this._drilldownItems.length!=0||f?this._legenddiv=null:this._initPrivateProperties():this._initPrivateProperties();n(this.element).empty();this._svgDocument!=null&&n(this._svgDocument).empty();this._height=this.element.height();this._width=this.element.width();this._height==0&&(this._height=this.element[0].parentElement.clientHeight!=0?this.element[0].parentElement.clientHeight:n(document).height());this._width==0&&(this._width=this.element[0].parentElement.clientWidth!=0?this.element[0].parentElement.clientWidth:n(document).width());this.showLegend()&&(this.enableDrillDown()&&this.model.colorPath!=null&&(e=this._getGroupitem(this.model.levels[0].groupPath,this.model.dataSource,this.model.levels[0].headerHeight,0),e.sort(function(n,t){return parseFloat(t.weight)-parseFloat(n.weight)})),this._sizeCalculation(e));var s=n.uaMatch(navigator.userAgent),h=s.browser.toLowerCase(),c=!!navigator.userAgent.match(/Trident\/7\./);if(this._browser=h,n(this.element).css({position:"relative"}),this._height!=0&&this._width!=0){if(this._setTreemapSize(f,r),this._backgroundTile=n('<div id="backgroundTile" style="overflow:hidden;z-index:0;"><\/div>'),this.showLegend()&&this.model.legendSettings!=null&&this._renderLegend(),this.dataSource()!=null)if(this._drilldownItems.length>0){if(this.enableDrillDown()&&this.model.levels.length>=1&&(this._drilldownItem!=null||this._drilldownItem==null)){for(u=0;u<this._drillHeaderDiv[0].children[0].children.length;u++)this._drillHeaderDiv[0].children[0].children[u].className=="e-drilldownlabel"&&(header=this._drillHeaderDiv[0].children[0].children[u].innerHTML);this._backgroundTile[0].innerHTML="";this._drillHeaderDiv[0].innerHTML="";this._templateDiv[0].innerHTML="";this._drillHoverDiv[0].innerHTML="";this._drillDownHeader(!0,this.model.levels[0],this.model.dataSource);this._groupdrillDownLevels(this._drilldownItems[this._drilldownItems.length-1],this._drilldownItems.length)}this._generateToolTip()}else f?(this._backgroundTile[0].innerHTML="",this._drillHeaderDiv[0].innerHTML="",this._templateDiv[0].innerHTML="",this._drillHoverDiv[0].innerHTML="",this.runTimeSubitems(this._prevData.pop(),null,this._prevLevels.pop(),this._prevLegend.pop(),!0),this.showLegend()&&this._generateLegend(r),this._generateToolTip()):this.model.dataSource instanceof t.DataManager?this._processOData(this):this._renderTreeMap(this.dataSource());(this.enableResize()||this.model.isResponsive)&&this._on(n(window),"resize",this._treeMapResize)}this._selectItemResize();this._wireEvents();o={model:this.model};this._trigger("loaded",o)},_setTreemapSize:function(t,i){this._templateDiv?this._templateDiv.css({height:this._height,width:this._width}):(this._templateDiv=n("<div class='_templateDiv'><\/div>"),this._templateDiv.css({"pointer-events":"none",overflow:"hidden",float:"left","z-index":"2",height:this._height,width:this._width,"margin-top":this._margintop,"margin-left":this._marginleft,position:"absolute",left:"0",top:"0"}));(this.enableDrillDown()&&this._drilldownItems.length==0||t)&&(this._drillHeaderDiv?this._drillHoverDiv.css({height:this._height-20,width:this._width}):(this._drillHeaderDiv=n("<div class='_drillHeaderDiv'><\/div>"),this._drillHeaderDiv.css({overflow:"hidden",float:"left","z-index":"3",position:"absolute",left:"0",top:"0"}),this._drillHoverDiv=n("<div class='_drillHoverDiv'><\/div>"),this._drillHoverDiv.css({overflow:"hidden",float:"left","z-index":"3",height:this._height-20,width:this._width,position:"absolute",left:"0",top:"30px"})));this.showLegend()&&(this.model.legendSettings!=null||i!=null)&&this._renderLegend()},_renderTreeMap:function(n){var l=this._getPreRenderEventData(n),s,h,o,f,c,r,u,a,v,e,y,p;if(this.enableDrillDown()){for(e=0;e<l.length;e++)for(o=this._getPreRenderEventData(l[e].Data,this._drilldownItems.length+1),f=0;f<o.length;f++)s=s===i?o[f]:s.colorWeight>o[f].colorWeight?o[f]:s,h=h===i?o[f]:h.colorWeight>o[f].colorWeight?h:o[f];t.isNullOrUndefined(this._currentToggle)&&this._trigger("preRender",{model:this,maximumValue:l[0],minimumValue:s,max:h,level:this._drilldownHeaders.length-1==-1?0:this._drilldownHeaders.length-1})}else c=this._getGroupitem(this.model.levels[0].groupPath,n,this.model.levels[0].headerHeight,0),this._getTopLevels(c,this.model.levels[0]),this._trigger("preRender",{model:this,maximumValue:c[0],minimumValue:c[c.length-1]});if(this.showLegend()&&this.model.legendSettings.mode=="interactive"&&this._generateLegend(),this.model.drilledStateLevel==0||this.model.drilledStateLevel==null||this._initialLevel)this._groupLevels(n),this._drillDownDataValue=n,this._renderWithDrilledLevel=!1,this._headerClick=!1;else if(r=this._getPreRenderEventData(this.model.dataSource,this.model.drilledStateLevel-1),this._drillCurrentItem=r,this.enableDrillDown())for(u=0;u<r.length;u++)if(this._originalHeaders=[],this.renderHeader=!0,r[u].header==this.model.drillDownDataValue){if(this.model.levels.length>0){if(this.model.levels[this.model.drilledStateLevel].groupingLevel=0,this._drilldownHeaders.push(this.model.header||this.model.levels[0].groupPath),this._originalHeaders.push(this.model.header||this.model.levels[0].groupPath),this.model.drilledStateLevel>1)for(a=this._getPreRenderEventData(this.model.dataSource,this.model.drilledStateLevel-2),this._drillPreviousItem=a,v=r[u].Data[0],e=2;e<=this.model.drilledStateLevel;e++)y=this.model.levels[e-2].groupPath,p=this._reflection(v,y),r[u]._previousHeader=p,this._drilldownHeaders.push(r[u]._previousHeader),this._originalHeaders.push(r[u]._previousHeader);this._drilldownHeaders.push(this.model.drillDownDataValue);this._originalHeaders.push(this.model.drillDownDataValue);this._drillDownHeader(!0,this.model.levels[this.model.drilledStateLevel-1],r[u])}else this._drilldownHeaders.push(""),this._drillDownHeader(!1);this._groupdrillDownLevels(r[u],this.model.drilledStateLevel);this._renderWithDrilledLevel=!0;this._initialLevel=!0}this.renderHeader=!1;this._generateToolTip();this._renderLabels();this.showLegend()&&this.model.legendSettings.mode!="interactive"&&this._generateLegend()},_groupLevelItemCollection:function(){var f,u,r,n,i,e;if(!t.util.isNullOrUndefined(this._levelItemCollections)&&this._levelItemCollections.length>0){if(f=this._levelItemCollections.length,this._levelItemCollections[f-1].length>0&&(this._levelItemCollections[f-1][0].groupPath==this.model.colorPath||t.util.isNullOrUndefined(this.model.colorPath)&&t.util.isNullOrUndefined(this.textPath())||(i=this._getGroupitem(this.textPath()||this.model.colorPath,this.dataSource(),this.model.levels[0].headerHeight),this._levelItemCollections[f-1]=i)),this._levelItemCollections=this._levelItemCollections,this._headerClick)for(u=0;u<this.dataSource().length;u++)this.dataSource()[u]._isVisible||(this.dataSource()[u]._isVisible=!0);if(t.util.isNullOrUndefined(this._currentLevel))for(r=0;r<this._levelItemCollections.length;r++)for(z=0;z<this._levelItemCollections[r].length;z++)this._levelItemCollections[r][z].isVisible||(this._levelItemCollections[r][z].isVisible=!0);if(!t.util.isNullOrUndefined(this._invisibility)&&this._invisibility.length>0)for(n=0;n<this.model.levels.length;n++)i=this._getGroupitem(this.model.levels[n].groupPath,this.dataSource(),this.model.levels[n].headerHeight),this._levelChangedItemCollections.push(i)}else{for(n=0;n<this.model.levels.length;n++)i=this._getGroupitem(this.model.levels[n].groupPath,this.dataSource(),this.model.levels[n].headerHeight),this._levelItemCollections.push(i);(this.textPath()!=null||this.model.colorPath!=null)&&(i=this._getGroupitem(this.textPath()||this.model.colorPath,this.dataSource(),this.model.levels[0].headerHeight),this._levelItemCollections.push(i),e=this._levelItemCollections)}return e},_identityGroupPathItem:function(n){for(var o,f,u,i,e=[],r=0;r<this._levelItemCollections.length;r++)o=this._levelItemCollections[r][0]?this._levelItemCollections[r][0].groupPath:this._levelItemCollections[r].groupPath,o==n&&(i=this._levelItemCollections[r]);if(this._headerClick&&!t.util.isNullOrUndefined(this._currentLevel)&&this._currentLevel!=0){for(f=0;f<this._drillDownLevelData.Data.length;f++){var s=this._drillDownLevelData.Data[f],h=this._reflection(s,n),c=this._reflection(s,this.colorPath());for(this._drillDownLevelData.color==this._drillDownLevelData.header&&(i[f].color=this._drillDownLevelData.color),u=0;u<i.length;u++)h==i[u].label&&(i[u].color=c,e.push(i[u]))}i=e}return i},_renderLegend:function(){this._legenddiv?this._legenddiv.css({height:this._legendSize.height,width:this._legendSize.width}):(this._legenddiv=n("<div class='LegendDiv' align='left'/>"),this._legenddiv.appendTo(this.element),this._legenddiv.css({"pointer-events":"auto",overflow:"hidden",position:"absolute","z-index":"2",height:this._legendSize.height,width:this._legendSize.width}))},_processOData:function(n){var t=this,i=n.model.dataSource.executeQuery(n.model.query);i.done(function(n){n.result!=null&&t._renderTreeMap(n.result)})},_treeMapResize:function(n){n.preventDefault();n.stopPropagation();var t=this;this.resizeTO&&clearTimeout(this.resizeTO);this.resizeTO=setTimeout(function(){t.refresh(!0)},500)},_unWireEvents:function(){var i=n.uaMatch(navigator.userAgent),r=i.browser.toLowerCase();this._off(n(this.element),t.isTouchDevice()?"touchend":"click",this._tmClick)},_wireEvents:function(){this._on(n(this.element),t.isTouchDevice()?"touchend":"click",this._tmClick)},_tmClick:function(n){var r,f,o=this,u,e,i;if(this._allowDoubleClick=!1,this.model.click!=""&&(r={model:this.model,data:{event:n}},this._trigger("click",r)),this.model.legendSettings.toggleVisibility&&this._legendToggleVisibility(n),this.model.doubleClick!=""){for(f=new Date,u=0;u<o._rootTreeMapItems.length;u++)if(e=o._rootTreeMapItems[u],i=e.Rectangle.getBoundingClientRect(),!t.util.isNullOrUndefined(event)&&i.left<event.clientX&&i.left+i.width>event.clientX&&i.top<event.clientY&&i.top+i.height>event.clientY)break;this._doubleTapTimer!=null&&f-this._doubleTapTimer<300&&(this._allowDoubleClick=!0,r||(r={model:this.model,data:{event:n},selectedItems:[e.Data],doubleClick:!0}),this._trigger("doubleClick",r));this._doubleTapTimer=f}},_legendToggleVisibility:function(t){var w=this.model.rangeColorMapping.length>0?this.model.rangeColorMapping.length:this._legendTreemapItems.length,e,u,f,r,h,i,it,rt,p;if(this._invisibility=[],this.currentItem=[],this._currentInvisibleItem=[],e=t.target.id,e.search("Legend")!=-1){this._isremoved=!1;var b=e.length,k=e.indexOf("_"),c=e.substring(k+1,b);if(this._legendTreemapItems)if(this.model.rangeColorMapping.length>0){for(i=0;i<w;i++){var l=e,d=l.indexOf("_")+1,g=l.length,a=l.substring(d,g),s=this.model.rangeColorMapping[a].from+"-"+this.model.rangeColorMapping[a].to,nt=s.indexOf("_"),o=s.substring(nt+1,s.length);this._currentToggle=o;var v=o.indexOf("-"),y=o.substring(v+1,s.length),ut=y.length,tt=o.substring(0,v);if(i==a&&(this.model.rangeColorMapping[i].isVisible=this.model.rangeColorMapping[i].isVisible?!1:!0),this.model.rangeColorMapping[i].isVisible)for(f=0;f<this._tog.length;f++)s==this._currentToggle&&this._tog[f]==this._currentToggle&&(this._isremoved=!0,this._tog.splice(f,1),this._rangevisible=this._rangeInVisibility[f],this._rangeInVisibility.splice(f,1));else{for(u=0;u<this._legendTreemapItems.length;u++)visible=!0,tt<=this._legendTreemapItems[u].colorWeight&&this._legendTreemapItems[u].colorWeight<=y&&(this._legendTreemapItems[u].isVisible=!1),this._legendTreemapItems[u].isVisible||(n.inArray(o,this._currentInvisibleItem)==-1&&this._currentInvisibleItem.push(o),n.inArray(this._legendTreemapItems[u].header,this._currentInvisibleItem)==-1&&this._currentInvisibleItem.push(this._legendTreemapItems[u].header));for(r=0;r<this._currentInvisibleItem.length;r++)n.inArray(this._currentInvisibleItem[r],this._invisibility)==-1&&this._invisibility.push(this._currentInvisibleItem[r])}}if(this._rangeInVisibility.length>0)for(r=0;r<this._rangeInVisibility.length;r++)if(Object.prototype.toString.call(this._rangeInVisibility[r])==="[object Array]"&&this._tog[r]==this._rangeInVisibility[r][0])for(h=0;h<this._rangeInVisibility[r].length;h++)n.inArray(this._rangeInVisibility[r][h],this._invisibility)==-1&&this._invisibility.push(this._rangeInVisibility[r][h])}else for(i=0;i<this._legendTreemapItems.length;i++)it=this._legendTreemapItems[c].legendLabel,visible=!0,rt=c,p=this._legendTreemapItems[c].label,i==c&&(this._legendTreemapItems[i].isVisible?(this._legendToggle=p,this._legendTreemapItems[i].isVisible=!1):this._legendTreemapItems[i].isVisible=!0),this._legendTreemapItems[i].isVisible||n.inArray(this._legendTreemapItems[i].label,this._invisibility)==-1&&this._invisibility.push(this._legendTreemapItems[i].label);this.enableDrillDown()?this.refresh(!0):this.refresh()}},_groupLevels:function(t){var u=null,c,h=this.model.fill,f,r,i,o,s,e;if(this.enableDrillDown()&&(this._originalHeaders=[],this.renderHeader=!0,this.model.levels.length>0?(this.model.levels[0].groupingLevel=0,this._drilldownHeaders.push(this.model.header||this.model.levels[0].groupPath),this._originalHeaders.push(this.model.levels[0].groupPath),this._drillDownHeader(!1,this.model.levels[0],t)):(this._drilldownHeaders.push(""),this._drillDownHeader(!1))),f=this._getTopGroupitem(this.labelPath(),t,0),u=f,this.model.levels.length==0)i=this.model.leafItemSettings,this._rootTreeMapItems=f,this._getTopLevels(f[0].innerItems,i),this._generateTreeMapItems(f[0].innerItems,h,this.colorValuePath()),this.showLabels()&&this._generateLabels(f[0].innerItems,i);else if(this.model.levels.length>0)for(r=0;r<=this.model.levels.length;r++)if(i=this.model.levels[r],i!=null&&(n.isNumeric(i.groupGap)||(i.groupGap=0),n.isNumeric(i.groupPadding)||(i.groupPadding=0),n.isNumeric(i.groupBorderThickness)||(i.groupBorderThickness=0)),r!=0){if(o=u,s=this.model.levels[r-1],u=[],i==null&&(i=this.model.leafItemSettings),this._generateSubItems(o,i,u,s,null,null,r-1),this._rootTreeMapItems=u,this.enableDrillDown()){if(r==1)return c=this.model.showSubItems?u:e,this._generateTreeMapItems(c,h,s.DisplayPath,o),!1}else r==this.model.levels.length&&this._generateTreeMapItems(u,h,s.DisplayPath,o);this.showLabels()&&r==this.model.levels.length&&this._generateLabels(u,i)}else e=this._getGroupitem(i.groupPath,f[0].Data,i.headerHeight,r),this._rootTreeMapItems=e,this._getTopLevels(e,i),u=e},_groupdrillDownLevels:function(i,r){var f,h,a,u,e,o,s,c,v,y,l;if(this._drillDownLevelData=i,n(this._legenddiv).empty(),f=null,h=this.model.fill,r==this.model.levels.length-1?this._drillHoverDiv.css("pointer-events","none"):this._drillHoverDiv.css("pointer-events","auto"),this.model.levels.length>0)for(a=!1,u=0;u<this.model.levels.length;u++){if(e=this.model.levels[u],e!=null&&(n.isNumeric(e.groupGap)||(e.groupGap=0),n.isNumeric(e.groupPadding)||(e.groupPadding=0),n.isNumeric(e.groupBorderThickness)||(e.groupBorderThickness=0)),u!=0){if(o=f,s=this.model.levels[u-1],f=[],e==null&&(e=this.model.leafItemSettings),u==r+1?this._generateSubItems(o,e,f,s,null,r+1!=u,i.GroupingLevel):this._generateSubItems(o,e,f,s,!0,r+1!=u,i.GroupingLevel),f.length>0&&(this._rootTreeMapItems=f),(u==r+1||u==this.model.levels.length-1)&&!a){if(this.showLegend()&&this.model.colorPath&&(this._height=this.element.height(),this._width=this.element.width(),this._sizeCalculation(u==r+1?o:f),this._legenddiv.css({width:this._legendSize.width+"px",height:this._legendSize.height+"px"}),this.model.legendSettings.dockPosition.toLowerCase()=="top"?(this._templateDiv.css({"margin-top":this._margintop}),this._drillHeaderDiv.css({top:this._legendSize.height}),this._drillHoverDiv.css({top:30+this._legendSize.height})):this.model.legendSettings.dockPosition.toLowerCase()=="left"&&(this._drillHeaderDiv.css({left:this._legendSize.width}),this._drillHoverDiv.css({left:this._legendSize.width}),this._templateDiv.css({"margin-left":this._marginleft}))),this._legendToggle)for(c=0;c<f.length;c++)v=f[c].Data[0],y=this._reflection(v,this.textPath()),y==this._legendToggle&&(f._isVisible=!1);this._generateTreeMapItems(f,h,s.DisplayPath,u==r+1?o:f);a=!0}this.model.showSubItems||(u==r+1?this._generateTreeMapItems(o,h,s.DisplayPath,u==r+1?o:f):u==this.model.levels.length-1&&this._generateTreeMapItems(f,h,s.DisplayPath,u==r+1?o:f));r==this.model.levels.length-1&&u==r&&e.showLabels&&this._generateLabels(f,e);this.renderHeader=u==i.GroupingLevel?!0:!1}else l=this._getGroupitem(e.groupPath,i.Data,e.headerHeight,u),this._rootTreeMapItems=l,this._getTopLevels(l,e),f=l;this.showLegend()&&r==u&&this._generateLegend(null,this._legendTreemapItems,r)}this._renderLabels();this.renderHeader=!1;t.util.isNullOrUndefined(this._drillDownArgs)},drillDown:function(t,r){var v,e,o,y,p,l,w,b,c,a,s,f,h,u,k;if(n(this.element).find("._templateDiv").parent().children().empty(),this.model.tooltipTemplate=this.element.parents(".e-dashboardviewer.e-js").attr("id")+"_"+this.element.attr("data-controlid")+"_toolTip"+r,this._drilldownHeaders=[],v=this.model.dataSource,r==0||this.model.drilledStateLevel==null)this._groupLevels(v),this._renderWithDrilledLevel=!1;else if(e=this._getPreRenderEventData(this.model.dataSource,r-1),this._drillCurrentItem=e,this.enableDrillDown())for(o=0;o<e.length;o++)if(this._originalHeaders=[],this.renderHeader=!0,e[o].header==t){if(this.model.levels.length>0){if(this.model.levels[r].groupingLevel=0,this._drilldownHeaders.push(this.model.header||this.model.levels[0].column||this.model.levels[0].groupPath),this._originalHeaders.push(this.model.header||this.model.levels[0].column||this.model.levels[0].groupPath),r>1)for(y=this._getPreRenderEventData(this.model.dataSource,r-2),this._drillPreviousItem=y,p=e[o].Data[0],l=2;l<=r;l++)w=this.model.levels[l-2].groupPath,b=this._reflection(p,w),e[o]._previousHeader=b,this._drilldownHeaders.push(e[o]._previousHeader),this._originalHeaders.push(e[o]._previousHeader);this._drilldownHeaders.push(t);this._originalHeaders.push(t);this._drillDownHeader(!0,this.model.levels[r-1],e[o]);this._drilldownItem=e[o];this._drilldownItems.push(e[o])}else this._drilldownHeaders.push(""),this._drillDownHeader(!1);if(this.model.enableRightClick){for(c=this._getPreRenderEventData(this._drilldownItem.Data),a=0;a<c.length;a++)for(f=this._drilldownItems.length+1>=this.model.levels.length?c:this._getPreRenderEventData(c[a].Data,this._drilldownItems.length+1),u=0;u<f.length;u++)s=s===i?f[u]:s.colorWeight>f[u].colorWeight?f[u]:s,h=h===i?f[u]:h.colorWeight>f[u].colorWeight?h:f[u];this._trigger("preRender",{model:this.model,maximumValue:c[0],minimumValue:s,max:h,level:this._drilldownHeaders.length-1==-1?0:this._drilldownHeaders.length-1})}else{for(f=this._drilldownItems.length+1>=this.model.levels.length?e:this._getPreRenderEventData(e[o].Data,this._drilldownItems.length+1),u=0;u<f.length;u++)s=s===i?f[u]:s.colorWeight>f[u].colorWeight?f[u]:s,h=h===i?f[u]:h.colorWeight>f[u].colorWeight?h:f[u];this._trigger("preRender",{model:this.model,maximumValue:e[0],minimumValue:s,max:h,level:this._drilldownHeaders.length-1==-1?0:this._drilldownHeaders.length-1})}k={event:event,drillDownLevel:this._drilldownItems.length,headerLabel:t};this._trigger("drillStarted",k);this._groupdrillDownLevels(e[o],r);this._renderWithDrilledLevel=!0;this._initialLevel=!0}},_getTopLevels:function(n,i){var f=i.groupGap!=null?i.groupGap:0,e=this.itemsLayoutMode(),r=0,u=0;this.enableDrillDown()&&(u=20);this.showLegend()&&this.model.legendSettings!=null&&(r=r);this._legendHeight=r;this.enableDrillDown()&&(this._drillHeaderDiv.css({top:this.showLegend()&&this.model.legendSettings.dockPosition.toLowerCase()=="top"?this._legendSize.height:r}),this._drillHoverDiv.css({top:u+(this.showLegend()&&this.model.legendSettings.dockPosition.toLowerCase()=="top"?this._legendSize.height:r)}));e==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceHorizontal?this._calculateSliceAndDiceItemSize(n,0,r,this._width,this._height,f,u,!0,r):e==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceVertical?this._calculateSliceAndDiceItemSize(n,0,r,this._width,this._height,f,u,!1,r):e==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceAuto?this._calculateSliceAndDiceItemSize(n,0,r,this._width,this._height,f,u,null,r):this._calculateSquarifiedItemSize(n,0,r,this._width,this._height,f,u,r)},_generateSubItems:function(n,r,u,f,e,o,s,h){var l=f.groupPadding,c,v,a,p,b,w;l==""&&(l=0);var nt=this.itemsLayoutMode(),tt=n.length,k=r.groupPath;k==null&&(k=this.labelPath());k==null&&(k=this.weightValuePath());var d=r.groupGap!=null?r.groupGap:r.gap!=null?r.gap:0,g=(f.showHeader||f.showHeader==null)&&!this.enableDrillDown()?f.headerHeight:this.renderHeader&&f.showHeader?f.headerHeight:0,y=0;for(c=0;c<tt;c++){if(v=this._getGroupitem(k,n[c].Data,r.headerHeight,s),h||(nt==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceHorizontal?this._calculateSliceAndDiceItemSize(v,n[c].LeftPosition+parseFloat(l),n[c].TopPosition+parseFloat(l),n[c].ItemWidth-(f.groupBorderThickness+2*parseFloat(l)),n[c].ItemHeight-(f.groupBorderThickness+2*parseFloat(l)),parseFloat(d),g,!0,0):nt==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceVertical?this._calculateSliceAndDiceItemSize(v,n[c].LeftPosition+parseFloat(l),n[c].TopPosition+parseFloat(l),n[c].ItemWidth-(f.groupBorderThickness+2*parseFloat(l)),n[c].ItemHeight-(f.groupBorderThickness+2*parseFloat(l)),parseFloat(d),g,!1,0):nt==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceAuto?this._calculateSliceAndDiceItemSize(v,n[c].LeftPosition+parseFloat(l),n[c].TopPosition+parseFloat(l),n[c].ItemWidth-(f.groupBorderThickness+2*parseFloat(l)),n[c].ItemHeight-(f.groupBorderThickness+2*parseFloat(l)),parseFloat(d),g,null,0):this._calculateSquarifiedItemSize(v,n[c].LeftPosition+parseFloat(l),n[c].TopPosition+parseFloat(l),n[c].ItemWidth-(f.groupBorderThickness+2*parseFloat(l)),n[c].ItemHeight-(f.groupBorderThickness+2*parseFloat(l)),parseFloat(d),g,0),a=this._rootTreeMapItems[c],a.headerHeight=f.headerHeight,a.showHeader=f.showHeader,a.headerWidth=n[c].ItemWidth,a.headerTemplate=f.headerTemplate,a.headerLeftPosition=n[c].LeftPosition,a.headerTopPosition=n[c].TopPosition,this.enableDrillDown()&&this._createBackGround(a,f,n[c],o),(f.showHeader||f.showHeader==null)&&(this.enableDrillDown()?(this.renderHeader||(this.previousItem=a),(s==0||s==i||s==null)&&(this.previousItem=null),this.renderHeader&&(this._trigger("headerTemplateRendering",{levelItems:this._rootTreeMapItems,childItems:a.Data,headerItem:a,groupPath:f.groupPath,groupingLevel:t.util.isNullOrUndefined(s)?0:s,prevItem:this.previousItem}),this._generateHeaders(a,f))):(this._createBackGround(a,f,n[c]),this._trigger("headerTemplateRendering",{levelItems:this._rootTreeMapItems,childItems:a.Data,headerItem:a,groupPath:f.groupPath,groupingLevel:s,prevItem:f}),this._generateHeaders(a,f)))),n[c].ChildtreeMapItems=v,n[c].GroupingLevel=this.model.levels.indexOf(f)+1,this.model.levels.indexOf(f)!=0||h){if(this.model.levels.indexOf(f)>0&&!h&&this.model.groupColorMapping!=null&&this.model.groupColorMapping.length>0)for(p=0;p<this.model.groupColorMapping.length;p++)b=this.model.groupColorMapping[p],b.groupID==n[c].ParentHeader&&this._setColorMappings(v,b)}else if(this.model.groupColorMapping!=null&&this.model.groupColorMapping.length>0)for(this._isLevelColors=!0,p=0;p<this.model.groupColorMapping.length;p++)b=this.model.groupColorMapping[p],b.groupID==a.header&&this._setColorMappings(v,b);for(w=0;w<v.length;w++)u[y]=v[w],v[w].backgroundColor==null&&(v[w].backgroundColor=n[c].backgroundColor),v[w].backgroundOpacity==null&&(v[w].backgroundOpacity=n[c].backgroundOpacity),(this.enableDrillDown()||u[y].ItemHeight<a.ItemHeight-a.headerHeight)&&!h&&(u[y].ParentHeader=a.header,u[y].ItemHeight-=l,u[y].ItemWidth-=l,u[y].LeftPosition+=f.groupBorderThickness,u[y].TopPosition+=f.groupBorderThickness),y++}e==i&&f.showLabels&&!h&&this._generateLabels(n,f)},_createBackGround:function(t,i,r,u){var f=n("<div id='"+this._id+"_"+t.header+"'/>"),o=t.showHeader||t.showHeader==null||this.enableDrillDown()?t.ItemHeight-2*i.groupBorderThickness:0,h=t.showHeader||t.showHeader==null||this.enableDrillDown()?t.TopPosition:0,e,s;if(f.css({height:o+"px",width:t.ItemWidth-2*i.groupBorderThickness+"px",left:t.LeftPosition+"px",top:h+"px","border-style":"solid","-webkit-user-select":"none","user-select":"none","-webkit-touch-callout":"none",outline:0,"border-width":i.groupBorderThickness+"px",position:"absolute"}),i.groupBorderColor!=null&&f.css("border-color",i.groupBorderColor),i.groupBackground!=null&&f.css("background-color",i.groupBackground),this.treemapgroups.push(f),f.appendTo(this._backgroundTile),o=parseFloat(f[0].style.top)-20-this._legendHeight+"px",this.enableDrillDown()&&!u){e=n("<div class='drillGroupRect'/>");e.css({height:f[0].style.height,width:f[0].style.width,left:f[0].style.left,top:o,position:"absolute",opacity:.2,display:"block"});this._drillHoverDiv.append(e);n(e).mousedown({treemap:this,level:i,param1:r},this._headerClickFunction);n(e).mouseleave({treemap:this,param1:t.header},this._mouseLeaveFunction);s={data:t.Data,label:t.header,header:t.header};n(e).mousemove({treemap:this,hoverItem:s},this._mouseRectHoverFunction);n(e).on("mouseenter",{Param1:s,Param2:this},this._rectMouseEnter);n(e).mouseleave({treeMap:this},this._rectMouseLeave)}n(f).mousedown({treemap:this,level:i,param1:r},this._headerClickFunction);n(f).mousemove({treemap:this,hoverItem:t.Data},this._mouseRectHoverFunction)},_mouseRectHoverFunction:function(t){var r=t.data.treemap,a=t.data.hoverItem,e,o,h,c,l,f;if(r.showTooltip()){var s=document.getElementById(r._id),u=s.getBoundingClientRect(),v=document.getElementsByClassName("e-drilldownHeader"),y=v[0].getBoundingClientRect(),i=r._toolTipElement;n(i).css({visibility:"visible"});e=r.model.tooltipTemplate;o=u.width/s.offsetWidth;i!=null&&e!=null&&(n(i).css({left:t.pageX+10,top:t.pageY+10,display:"block"}),h=n("#"+e).render(a),n(i).html(h),c=i[0]!=null?i[0].clientHeight:i.clientHeight,l=i[0]!=null?i[0].clientWidth:i.clientWidth,r._tooltipSize={height:c,width:l});f=r._tooltipSize;f.width+t.pageX>=u.x+u.width&&(t.pageX-=o*f.width,t.pageX<0&&(t.pageX=10));f.height+t.pageY+y.height+20>=u.y+u.height&&(t.pageY-=o*f.height,t.pageY<0&&(t.pageY=10));i!=null&&(r.enableDrillDown()?n(i).css({left:t.pageX,top:t.pageY,display:"block"}):n(i).css({left:t.pageX+10,top:t.pageY+10,display:"none"}))}},_mouseLeaveFunction:function(t){var i=t.data.treemap;i.showTooltip()&&i._toolTipElement!=null&&n(i._toolTipElement).css("display","none")},_headerClickFunction:function(r){var l=r.data.level,e=r.data.param1,ut=r.ctrlKey,u=r.data.treemap,a,nt,d,c,tt,v,g,k,y,p,w,h,b,s,f,it,rt,o;if(u._invisibility=null,u._drillDownLevelData=e,u._levelItemCollections=[],u._groupLevelItemCollection(),u._headerClick=!0,a={evt:r,level:l,header:e,treeMap:u,data:e,prevLevel:e.Data,selectedItems:[e.Data],rightClick:!1,doubleClick:u._doubleTapTimer!=null&&new Date-u._doubleTapTimer<300},u.highlightGroupOnSelection())if(u._browser!="msie"&&(nt=u._backgroundTile[0].children[u._backgroundTile[0].children.length-0],u._backgroundTile[0].insertBefore(this,nt)),u.groupSelectionMode()=="multiple"&&ut)n.inArray(this,u._prevSelectedHeaders)==-1?(n(this).css({"border-width":u.model.highlightGroupBorderThickness,"border-color":u.highlightBorderBrush()}),u._prevSelectedHeaders.push(this),u._prevSelectedGroupDatas.push(r.data.Param1)):(n(this).css({"border-width":l.groupBorderThickness,"border-color":l.groupBorderColor}),d=u._prevSelectedHeaders.indexOf(this),u._prevSelectedHeaders.splice(d,1),u._prevSelectedGroupDatas.splice(d,1));else{for(s=0;s<u._prevSelectedHeaders.length;s++)n(u._prevSelectedHeaders[s]).css({"border-width":l.groupBorderThickness,"border-color":l.groupBorderColor});n.inArray(this,u._prevSelectedHeaders)==-1?(n(this).css({"border-width":u.model.highlightGroupBorderThickness,"border-color":u.highlightBorderBrush()}),u._prevSelectedHeaders=[],u._prevSelectedHeaders.push(this)):u._prevSelectedHeaders=[];u._prevSelectedGroupDatas.push(r.data.Param1)}if(u.enableDrillDown()&&u.model.levels.length>1&&(u._drilldownItem!=null&&u._drilldownItem.header!=e.header||u._drilldownItem==null)&&!u.model.isVirtualRender){if(c={evt:r,level:u._drilldownItems.length+1,treeMap:u,header:u.getDrillDownHeader(u._drilldownHeaders),prevLevel:u._drilldownItems.length-1,selectedItems:e.Data,cancel:!1,rightClick:!1,doubleClick:u._doubleTapTimer!=null&&new Date-u._doubleTapTimer<300},r.which==3){u.model.enableRightClick&&(r.preventDefault(),c.rightClick=!0);return}if(o=u._getSelectedItem(r,u,u.highlightGroupOnSelection()?u.treemapgroups:u._rootTreeMapItems),c.isSelected=o&&n.inArray(o.Rectangle||o,u.highlightGroupOnSelection()?u._prevSelectedHeaders:u._prevSelectedItems)!=-1,c.selectedItems=[o.Data],r.private||u._trigger("drillDownItemAction",c),u._drillDownArgs=c,c.cancel)return u.rectClick(r),!1;for(tt="",v=0;v<u._drillHeaderDiv[0].children[0].children.length;v++)u._drillHeaderDiv[0].children[0].children[v].className=="e-drilldownlabel"&&(tt=u._drillHeaderDiv[0].children[0].children[v].innerHTML);if(u._backgroundTile[0].innerHTML="",u._labelTemplateElements=[],u._drillHeaderDiv[0].innerHTML="",u._templateDiv[0].innerHTML="",u._drillHoverDiv[0].innerHTML="",u._originalHeaders.push(e.header),u._drilldownHeaders.push(e.header),g=u.model.levels[u._drilldownHeaders.length-1],g.groupingLevel=e.GroupingLevel,u._drillDownHeader(!0,g,e.Data),u._drilldownItem=e,u._renderWithDrilledLevel)for(k=u._drillCurrentItem,f=0;f<k.length;f++)k[f].header==u.model.drillDownDataValue&&u._drilldownItems.length==0&&u._drilldownItems.push(k[f]);for(u._drilldownItems.push(e),y=null,f=0;f<u._drilldownHeaders.length;f++)y=y==null?u._drilldownHeaders[f]:y+"|~|"+u._drilldownHeaders[f];for(p=u._getPreRenderEventData(e.Data),s=0;s<p.length;s++)for(h=u._drilldownItems.length+1>=u.model.levels.length?p:u._getPreRenderEventData(p[s].Data,u._drilldownItems.length+1),f=0;f<h.length;f++)w=w===i?h[f]:w.colorWeight>h[f].colorWeight?h[f]:w,b=b===i?h[f]:b.colorWeight>h[f].colorWeight?b:h[f];return u._trigger("preRender",{model:u.model,maximumValue:p[0],minimumValue:w,max:b,level:u._drilldownHeaders.length-1==-1?0:u._drilldownHeaders.length-1}),it={event:r,drillDownLevel:u._drilldownItems.length,headerLabel:y},u._trigger("drillStarted",it),u.showLegend()&&(u._height=u.element.height(),u._width=u.element.width(),u._sizeCalculation()),u._setTreemapSize(),t.util.isNullOrUndefined(u._toolTipElement)||(rt=u._toolTipElement,n(rt).css({visibility:"hidden"})),u._groupdrillDownLevels(e,u._drilldownItems.length),!1}if(u.enableDrillDown()&&u.model.isVirtualRender){if(u._trigger("drillStarted",{treemap:u.model}),r.which==3){u.model.enableRightClick&&(r.preventDefault(),a.rightClick=!0);return}o=u._getSelectedItem(r,u,u.highlightGroupOnSelection()?u.treemapgroups:u._rootTreeMapItems);a.isSelected=o&&n.inArray(o.Rectangle||o,u.highlightGroupOnSelection()?u._prevSelectedHeaders:u._prevSelectedItems)!=-1;a.selectedItem=o;setTimeout(function(){u._trigger("drillDownItemSelected",a)},500);e.cancelDrilldown===!0&&(u.model.drillDownLevel--,u.runTimeSubitems(u._prevData.pop(),null,u._prevLevels.pop(),u._prevLegend.pop()))}},_getPreRenderEventData:function(n,r){var u,f,r=r>=this.model.levels.length-1?this.model.levels.length-1:r,s,h,e,o;for(f=r===i?this.model.levels[this._drilldownItems.length]:this.model.levels[r],s=r==0?t.isNullOrUndefined(this.textPath())?f.groupPath:this.textPath():f.groupPath,u=this._getGroupitem(s,n,f.headerHeight,r),h=this._getTotalWeight(u),e=u.length-1;e>=0;e--)o=u[e],o.AreaByWeight=o.weight/h;return u.sort(this._orderByAreaWight)},_getDynamicPreRenderEventData:function(n,t){for(var u,i=this._getGroupitem(t.groupPath,n,t.headerHeight,t),f=this._getTotalWeight(i),r=i.length-1;r>=0;r--)u=i[r],u.AreaByWeight=u.weight/f;return i.sort(this._orderByAreaWight)},runTimeSubitems:function(n,t,i,r,u){var f,e=this.model.fill;this._prevData.push(n);this._prevLevels.push(i);this._prevLegend.push(r);t&&this._drilldownHeaders.push(t);u||(f=this._getDynamicPreRenderEventData(n,i||this.model.levels[0]),this._trigger("preRender",{model:this.model,maximumValue:f[0],minimumValue:f[f.length-1],legend:r||this.model.legendSettings}));this.showLegend()&&r&&!u?this.refresh(!0,r):(this._generateRuntimeSubItems(n,e,this.colorValuePath(),i),this._drillHeaderDiv[0].innerHTML="",this._drillDownHeader(!0,i,n))},_generateRuntimeSubItems:function(n,t,i,r){this._labelTemplateElements=[];var f=this.model.fill,u=this._getTopGroupitem(this.labelPath(),n,0);r=r?r:this.model.levels[this.model.drillDownLevel]||this.model.leafItemSettings;this._rootTreeMapItems=u;this._getTopLevels(u[0].innerItems,r);this._generateTreeMapItems(u[0].innerItems,f,this.colorValuePath());r.showLabels&&(this._generateLabels(u[0].innerItems,r),this._renderLabels())},rightClick:function(t){for(var u,r,e,s,i=this,o=t.data.Param1,f=0;f<o.length;f++)if(u=o[f],r=u.Rectangle.getBoundingClientRect(),r.left<t.clientX&&r.left+r.width>t.clientX&&r.top<t.clientY&&r.top+r.height>t.clientY)break;e=i._getSelectedItem(t,i,i.highlightGroupOnSelection()?i.treemapgroups:i._rootTreeMapItems);s=u&&n.inArray(e.Rectangle||e,i.highlightGroupOnSelection()?i._prevSelectedHeaders:i._prevSelectedItems)!=-1;i._trigger("treeMapItemRightSelected",{selectedItems:[u.Data],isSelected:s,selectedItemLabel:u.ParentHeader,selectedItemLevel:i._drilldownHeaders.length-1,treeMap:i,evt:t,rightClick:!0,doubleClick:!1})},_getSelectedItem:function(n,t,i){for(var e=n.clientX,o=n.clientY,u,r,f=0;f<i.length;f++)if(u=i[f],r=(u[0]||u.Rectangle).getBoundingClientRect(),r.left<e&&r.left+r.width>e&&r.top<o&&r.top+r.height>o)return u},rectClick:function(t){var f,r,u,s,e;if(t.which!=3){var i=t.data.treemap,y=t.data.Param1,h=i.model.levels[0],c,o=!1,l=t.ctrlKey,a=t.clientX||this.getClientX(t),v=t.clientY||this.getClientY(t);if(i._allowItemSelectEvent=!1,i.highlightGroupOnSelection()){for(f=0;f<i.treemapgroups.length;f++)if(r=i.treemapgroups[f],u=r[0].getBoundingClientRect(),u.left<t.clientX&&u.left+u.width>t.clientX&&u.top<t.clientY&&u.top+u.height>t.clientY){n(r).css({"border-width":i.model.highlightGroupBorderThickness,"border-color":i.highlightBorderBrush(),"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","-webkit-user-select":"none","user-select":"none","-webkit-touch-callout":"none",outline:0});c=!0;break}if(c)if(i.groupSelectionMode()=="multiple"&&l)n.inArray(r,i._prevSelectedHeaders)==-1?(n(r).css({"border-width":i.model.highlightGroupBorderThickness,"border-color":i.highlightBorderBrush()}),i._prevSelectedHeaders.push(r),i._prevSelectedGroupDatas.push(t.data.Param1)):(o=!0,n(r).css({"border-width":h.groupBorderThickness,"border-color":h.groupBorderColor}),s=i._prevSelectedHeaders.indexOf(r),i._prevSelectedHeaders.splice(s,1),i._prevSelectedGroupDatas.splice(s,1));else{for(e=0;e<i._prevSelectedHeaders.length;e++)n(i._prevSelectedHeaders[e]).css({"border-width":h.groupBorderThickness,"border-color":h.groupBorderColor});n.inArray(r,i._prevSelectedHeaders)==-1?(n(r).css({"border-width":i.model.highlightGroupBorderThickness,"border-color":i.highlightBorderBrush()}),i._prevSelectedHeaders=[],i._prevSelectedHeaders.push(r)):(o=!0,i._prevSelectedHeaders=[]);i._prevSelectedGroupDatas.push(t.data.Param1)}i._trigger("treeMapGroupSelected",{selectedItem:r,isSelected:o,selectedGroups:i._prevSelectedHeaders,orginalEvent:t})}if(i.highlightOnSelection()){for(f=0;f<i._rootTreeMapItems.length;f++)if(r=i._rootTreeMapItems[f],u=r.Rectangle.getBoundingClientRect(),u.left<a&&u.left+u.width>a&&u.top<v&&u.top+u.height>v){n(r.Rectangle).css({"border-width":i.highlightBorderThickness(),"border-color":i.highlightBorderBrush(),"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","-webkit-user-select":"none","user-select":"none","-webkit-touch-callout":"none",outline:0});c=!0;break}if(c){if(i.selectionMode()=="multiple"&&l)n.inArray(r.Rectangle,i._prevSelectedItems)==-1?(n(r.Rectangle).css({"border-width":i.highlightBorderThickness(),"border-color":i.highlightBorderBrush(),"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","-webkit-user-select":"none","user-select":"none","-webkit-touch-callout":"none"}),i._prevSelectedItems.push(r.Rectangle),i.selectedItems.push(r.Data)):(o=!0,n(r.Rectangle).css({"border-width":i.borderThickness(),"border-color":i.borderBrush()}),s=i._prevSelectedItems.indexOf(r.Rectangle),i._prevSelectedItems.splice(s,1),i.selectedItems.splice(s,1));else{for(e=0;e<i._prevSelectedItems.length;e++)n(i._prevSelectedItems[e]).css({"border-width":i.borderThickness(),"border-color":i.borderBrush()});n.inArray(r.Rectangle,i._prevSelectedItems)==-1?(n(r.Rectangle).css({"border-width":i.highlightBorderThickness(),"border-color":i.highlightBorderBrush()}),i._prevSelectedItems=[],i.selectedItems=[],i._prevSelectedItems.push(r.Rectangle),i.selectedItems.push(r.Data)):(o=!0,i._prevSelectedItems=[],i.selectedItems=[])}setTimeout(function(){t.public||i._allowItemSelectEvent||(i._allowItemSelectEvent=!0,i._trigger("treeMapItemSelected",{selectedItem:r,isSelected:o,selectedItems:i.selectedItems,originalEvent:t,rightClick:!1,treeMap:i,doubleClick:i._allowDoubleClick}))},500)}}}},getClientX:function(t){return t.pageX-n(document).scrollLeft()},getClientY:function(t){return t.pageY-n(document).scrollTop()},dragDown:function(t){var i=t.data.treemap,e=i.model.levels[0],r=i.element,u,f,o;if(t.type=="mousedown"?(i._startPoint={x:t.pageX-r[0].offsetLeft,y:t.pageY-r[0].offsetTop},i._stopPoint={x:t.pageX-r[0].offsetLeft,y:t.pageY-r[0].offsetTop}):t.type=="touchstart"?(i._startPoint={x:t.originalEvent.changedTouches[0].pageX-r[0].offsetLeft,y:t.originalEvent.changedTouches[0].pageY-r[0].offsetTop},i._stopPoint={x:t.originalEvent.changedTouches[0].pageX-r[0].offsetLeft,y:t.originalEvent.changedTouches[0].pageY-r[0].offsetTop}):t.type=="MSPointerDown"&&(i._startPoint={x:t.originalEvent.pageX-r[0].offsetLeft,y:t.originalEvent.pageY-r[0].offsetTop},i._stopPoint={x:t.originalEvent.pageX-r[0].offsetLeft,y:t.originalEvent.pageY-r[0].offsetTop}),i.mouseClickable=!0,i.model.draggingGroupOnSelection&&i._prevSelectedGroupDatas.length>0){for(u=0;u<i._prevSelectedGroupDatas.length;u++)f=i._prevSelectedGroupDatas[u][0],o=f.getBoundingClientRect(),n.inArray(f,i._prevSelectedGroupDatas[u][0])==-1&&n(i._prevSelectedGroupDatas[u]).css({"border-width":e.groupBorderThickness,"border-color":i.model.highlightGroupBorderBrush});i._prevSelectedGroupDatas=[]}if(i.model.draggingOnSelection&&i._prevSelectedItems.length>0){for(u=0;u<i._prevSelectedItems.length;u++)f=i._prevSelectedItems[u].rectangle,o=f.getBoundingClientRect(),n.inArray(f,i._prevSelectedItems[u].rectangle)==-1&&n(i._prevSelectedItems[u].rectangle).css({"border-width":e.groupBorderThickness,"border-color":i.model.highlightGroupBorderBrush});i._prevSelectedItems=[]}},dragMove:function(t){var f,e,i=t.data.treemap,r=i.element,u;(i.model.draggingGroupOnSelection||i.model.draggingOnSelection)&&i.mouseClickable&&(t.type=="mousemove"?i._stopPoint={x:t.pageX-r[0].offsetLeft,y:t.pageY-r[0].offsetTop}:t.type=="touchmove"?i._stopPoint={x:t.originalEvent.changedTouches[0].pageX-r[0].offsetLeft,y:t.originalEvent.changedTouches[0].pageY-r[0].offsetTop}:t.type=="MSPointerMove"&&(i._stopPoint={x:t.originalEvent.pageX-r[0].offsetLeft,y:t.originalEvent.pageY-r[0].offsetTop}),n("#dragDiv").remove(),u=n('<div id = "dragDiv"><\/div>'),f=Math.abs(i._stopPoint.x-i._startPoint.x),e=Math.abs(i._stopPoint.y-i._startPoint.y),n(u).css({top:Math.min(i._startPoint.y,i._stopPoint.y),left:Math.min(i._startPoint.x,i._stopPoint.x),width:f,height:e,border:"1px solid green",position:"absolute","z-index":100}),n(u).appendTo("#svgDocument"))},dragUp:function(t){var i=t.data.treemap,o=Math.abs(i._stopPoint.x-i._startPoint.x),s=Math.abs(i._stopPoint.y-i._startPoint.y),e=i.element,r,f,u;if((i.model.draggingGroupOnSelection||i.model.draggingOnSelection)&&(n("#dragDiv").remove(),n("#dragDiv").css({display:"none"}),i.mouseClickable=!1),i.model.draggingGroupOnSelection){for(r=0;r<i.treemapgroups.length;r++)f=i.treemapgroups[r],u=f[0].getBoundingClientRect(),u.left-e[0].offsetLeft+u.width<Math.min(i._startPoint.x,i._stopPoint.x)||Math.min(i._startPoint.x,i._stopPoint.x)+o<u.left-e[0].offsetLeft||u.top-e[0].offsetTop+u.height<Math.min(i._startPoint.y,i._stopPoint.y)||Math.min(i._startPoint.y,i._stopPoint.y)+s<u.top-e[0].offsetTop||i._contains(i._prevSelectedGroupDatas,f)||i._prevSelectedGroupDatas.push(f);for(r=0;r<i._prevSelectedGroupDatas.length;r++)f=i._prevSelectedGroupDatas[r][0],u=f.getBoundingClientRect(),n(f).css({"border-width":i.model.highlightGroupBorderThickness,"border-color":i.model.highlightGroupBorderBrush,"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","-webkit-user-select":"none","user-select":"none","-webkit-touch-callout":"none"});i.selectedItems.push(i._prevSelectedGroupDatas)}if(i.model.draggingOnSelection){for(r=0;r<i._rootTreeMapItems.length;r++)f=i._rootTreeMapItems[r],u=f.rectangle.getBoundingClientRect(),u.left-e[0].offsetLeft+u.width<Math.min(i._startPoint.x,i._stopPoint.x)||Math.min(i._startPoint.x,i._stopPoint.x)+o<u.left-e[0].offsetLeft||u.top-e[0].offsetTop+u.height<Math.min(i._startPoint.y,i._stopPoint.y)||Math.min(i._startPoint.y,i._stopPoint.y)+s<u.top-e[0].offsetTop||i._contains(i._prevSelectedItems,f)||i._prevSelectedItems.push(f);for(r=0;r<i._prevSelectedItems.length;r++)f=i._prevSelectedItems[r].rectangle,u=f.getBoundingClientRect(),n(f).css({"border-width":i.model.highlightGroupBorderThickness,"border-color":i.model.highlightGroupBorderBrush,"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","-webkit-user-select":"none","user-select":"none","-webkit-touch-callout":"none"});i.selectedItems.push(i._prevSelectedItems)}},_generateLabels:function(r,u){for(var f,w,l,a,o,k,b,s,v,y,h=0;h<r.length;h++){if(f=r[h],u.labelTemplate==null){var p=8,c=5,e=n('<label style="font-size:10px;font-weight:normal;font-family:Roboto;">'+f.label+"<\/label>");this.enableDrillDown()||this.model.isVirtualRender?n(e).css({position:"absolute",color:"black",overflow:"hidden",left:f.LeftPosition+p+"px",top:f.TopPosition+c+"px","font-weight":"normal","pointer-events":"none"}):n(e).css({position:"absolute",color:"white",overflow:"hidden",left:f.LeftPosition+p+"px",top:f.TopPosition+c+"px","font-weight":"normal","pointer-events":"none"});this._treeMapLabels.push(e);this._templateDiv.append(e);w=0;l=0;u.groupPadding!=i&&(w=u.groupPadding);u.groupBorderThickness!=i&&(l=u.groupBorderThickness);a=this._calculateTextWidth(f.label);o=e[0].getBoundingClientRect().height;o==0?o=18:o>0&&o>f.ItemHeight&&(o=f.ItemHeight-c);n(e).css({width:a+"px",height:o+"px"});f.labelPosition=u.labelPosition;f.labelVisibilityMode=l;f.groupPadding=u.groupPadding;f.groupBorderThickness=u.groupBorderThickness;e[0].data=f;this._labelTemplateElements.push(e);u.labelVisibilityMode==t.datavisualization.TreeMap.VisibilityMode.HideOnExceededLength&&(a>f.ItemWidth&&(n(e).css({display:"none"}),f.Rectangle!=null&&(f.Rectangle.title=f.label)),k=u.labelVisibilityMode)}u.labelTemplate!=null&&(b=n("#"+u.labelTemplate),s=n("<div style='overflow:hidden;display:block;position:absolute;pointer-events: none;'><\/div>"),s[0].data=f,f.labelPosition=u.labelPosition,f.labelVisibilityMode=u.labelVisibilityMode,v=n.templates(b.html()),y="",y=f.Data instanceof Array?v.render(f.Data[0]):v.render(f.Data),n(s).html(y),this._templateDiv.append(s),this._labelTemplateElements.push(s))}},_calculateTextWidth:function(t){var i=n("<span>"+t+"<\/span>"),r;return n("body").append(i),r=i.width(),i.remove(),r},_generateToolTip:function(){var t,i,r;this.showTooltip()&&(t=document.documentMode==8?document.querySelectorAll("tooltipelement"):document.getElementsByClassName("tooltipelement"),t!=null&&t.length==0?(i=n("<div class='tooltipelement' style='display:none;position:absolute;z-index:1000;pointer-events:none;'><\/div>"),n(document.body).append(i),this._toolTipElement=i):this._toolTipElement=t[0],this.model.tooltipTemplate==null&&(r=this.labelPath()!=null?this.labelPath():this.weightValuePath(),r!=null&&(this.model.tooltipTemplate="defaultTooltip",this.element.append(n('<div id="defaultTooltip" style="display:none;"><div style="margin-left:10px;margin-top:-25px;"><div class="defaultToolTip"><p style="margin-top:-4px"><label  style="color:rgb(27, 20, 20);font-size:10px;font-weight:normal;font-family:Roboto">{{:#data["'+r+'"]}}<\/label><\/p><\/div><\/div><\/div>')))))},_generateLegend:function(r,u,f){var b,c,k,o,v,g,p,e,w,nt,a;if(this._legendToggle=null,f=t.util.isNullOrUndefined(f)?0:f,b=f!=0?this.model.levels[f].groupPath:this.textPath()||this.model.colorPath,this._currentLevel=f,k=this._identityGroupPathItem(b),this.model.rangeColorMapping!=null||this.model.colorPath!=null){if(c=k,o=this.model.rangeColorMapping!=null&&this.model.rangeColorMapping.length>0?this.model.rangeColorMapping:c,v=this.model.rangeColorMapping!=null&&this.model.rangeColorMapping.length>0?!0:!1,r=n.extend({},this.model.legendSettings,r,!0),r.mode!=t.datavisualization.TreeMap.LegendMode.Interactive){var s=0,h=0,y=0,it=this.iconWidth()+5,rt=this.iconHeight()+15,tt=this._calcHeight(r.title),l,d=this.model.legendSettings.columnCount;for(r.title!=null&&r.title!=""&&(g=titleText=r.title,p=this._createLabel(g,s,h,"e-defaultLegend-title"),p[0].title=titleText,p.appendTo(this._legenddiv),h+=tt),e=0;e<o.length;e++)v?this._invisibility?(o[e].isVisible=t.isNullOrUndefined(o[e].isVisible)?this._invisibility[0]==o[e].legendLabel?!1:!0:o[e].isVisible,o[e].isVisible||n.inArray(this._currentToggle,this._tog)==-1&&(this._isremoved||(this._tog.push(this._currentToggle),this._currentInvisibleItem.length>0?this._rangeInVisibility.push(this._currentInvisibleItem):this._rangeInVisibility.push(this._currentToggle)))):o[e].isVisible=!0:(this._legendTreemapItems=c,w=this._currentLevel?this.model.levels[this._currentLevel].groupPath:this.textPath()||this.model.colorPath,c[e].legendLabel=this.showLegend()?c[e].Data[0]?c[e].Data[0][w]:c[e].Data[w]:c[e].header,this._headerClick||(c[e].color=c[e].Data[0]?c[e].Data[0][this.colorPath()]:c[e].Data[this.colorPath()])),l={color:v?o[e].color:o[e]._color?o[e]._color:o[e].color,legendLabel:o[e].legendLabel!=null?o[e].legendLabel:v?o.from:o[e].value!=null?o[e].value:o[e][this.textPath()],dataSource:v?i:o[e].Data,mapping:v?o[e]:i,visible:o[e].isVisible?!0:!1,index:e},l.color=o[e].isVisible?t.util.isNullOrUndefined(l.color)?"black":l.color:"grey",this._trigger("legendItemRendering",{model:this.model,data:l}),nt=this._calcWidth(o[e].legendLabel),a=this.iconWidth()+nt+20,d!=0?e%d!=0?(this._drawLegend(l,s,h,r),s+=a+5):(e!=0&&(h+=this.iconHeight()+18),s=0,this._drawLegend(l,s,h,r),s+=a+5):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?this._legendSize.width<s+a?(h+=this.iconHeight()+18,s=0,this._drawLegend(l,s,h,r,f),s+=a):(this._drawLegend(l,s,h,r,f),s+=a):this._legendSize.height<h+this.iconHeight()?(h=0,s+=y+10,this._drawLegend(l,s,h,r),y=0,h+=this.iconHeight()+18):(this._drawLegend(l,s,h,r),y=Math.max(y,a),h+=this.iconHeight()+18)}else this._drawInteractiveLegend(r);(this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom)&&r.alignment==t.datavisualization.TreeMap.Alignment.Center?this._legenddiv.css({"margin-left":this._width/2-this._legendSize.width/2}):(this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom)&&r.alignment==t.datavisualization.TreeMap.Alignment.Far?this._legenddiv.css({"margin-left":this._width-this._legendSize.width}):(this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Left||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Right)&&r.alignment==t.datavisualization.TreeMap.Alignment.Center?this._legenddiv.css({"margin-top":this._height/2-this._legendSize.height/2}):(this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Left||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Right)&&r.alignment==t.datavisualization.TreeMap.Alignment.Far&&this._legenddiv.css({"margin-top":this._height-this._legendSize.height});this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?this._legenddiv.css({"margin-top":this._height+5}):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Right&&this._legenddiv.css({"margin-left":this._width+5})}},_drawLegend:function(i,r,u,f){var e,o,l,s;if(f=n.extend({},this.model.legendSettings,f,!0),e=f.template=="Ellipse"?this._getEllipseLegend(f,r,u,i):this._getRectLegend(f,r,u,i),r+=this.iconWidth()+5,n(e).css("background-color",i.visible?i.color:"grey"),!t.util.isNullOrUndefined(i.mapping)&&!t.util.isNullOrUndefined(i.mapping.gradientColors)){var a=i.mapping.gradientColors.length,h="linear-gradient(to right,",c=i.mapping.gradientColors[0];for(o=1;o<a;o++)c+=","+i.mapping.gradientColors[o];h=h+c+")";i.mapping.color=h;n(e).css("background",i.visible?i.mapping.color:"grey")}e.appendTo(this._legenddiv);l=i.legendLabel;s=n("<div class='e-treemap-legendLabel' id='"+this._id+"LegendText_"+i.index+"'/>");s.css({left:r+"px",top:u+"px",position:"absolute","font-size":"12px","font-weight":"normal",cursor:f.toggleVisibility?"pointer":"default",color:i.visible?"black":"grey"});s[0].innerHTML=l;s.appendTo(this._legenddiv)},_calcHeight:function(t){var i=n('<div class ="e-defaultLegend-title" >'+t+"<\/div>"),r;return n("body").append(i),r=i.height(),i.remove(),r},_calcWidth:function(t){var i=n('<span class ="e-treemap-legendLabel" >'+t+"<\/span>"),r;return n("body").append(i),r=i.width(),i.remove(),r},_getEllipseLegend:function(t,i,r,u){var e=u.legendLabel.replace(" ","_"),f=n("<div class='e-mapLegend' id='"+this._id+"LegendIcon_"+u.index+"'/>");return f.css({height:this.iconHeight()+"px",width:this.iconWidth()+"px","border-radius":this.iconHeight()/2+"px",left:i+"px",top:r+"px",position:"absolute",cursor:t.toggleVisibility?"pointer":"default"}),f},_getRectLegend:function(t,i,r,u){var e=u.legendLabel.replace(" ","_"),f=n("<div id='"+this._id+"LegendIcon_"+u.index+"'/>");return f.css({height:this.iconHeight()+"px",width:this.iconWidth()+"px",left:i+"px",top:r+"px",position:"absolute",cursor:t.toggleVisibility?"pointer":"default"}),f},_getPositionFromParent:function(n,t){var i=n.getBoundingClientRect(),r=t.getBoundingClientRect(),u=window.SVGSVGElement?i.width:i.right-i.left,f=window.SVGSVGElement?i.height:i.bottom-i.top;return{left:i.left-r.left,top:i.top-r.top,height:f,width:u}},_renderLabels:function(){for(var e=document.getElementById(this._id),o=e.getBoundingClientRect().width/e.offsetWidth,u=0;u<this._labelTemplateElements.length;u++){var r=this._labelTemplateElements[u],f=this._getPositionFromParent(r[0],this._templateDiv[0]),i=r[0].data,s=this._getDockPositionPoint({left:i.LeftPosition,top:i.TopPosition,width:i.ItemWidth,height:i.ItemHeight},f,i);n(r).css({left:s.x,top:s.y,"pointer-events":"none",overflow:"hidden"});i.labelVisibilityMode==t.datavisualization.TreeMap.VisibilityMode.HideOnExceededLength&&(f.height>o*i.ItemHeight||f.width>o*i.ItemWidth)&&n(r).css("display","none")}},_generateHeaders:function(i,r){var a=r.headerVisibilityMode,e=!1,s=2,h=2,u,c,o,f,arguments,l;a==t.datavisualization.TreeMap.VisibilityMode.HideOnExceededLength?(u=n("<span>"+i.header+"<\/span>"),n(document.body).append(u),c=u.outerWidth(),u.remove(),i.headerHeight<i.ItemHeight-2*s&&c<i.ItemWidth-2*h&&(e=!0)):i.headerHeight<i.ItemHeight&&(e=!0);e&&(i.headerTemplate==null?(o=n('<div style="display:block;position:absolute;pointer-events: stroke;overflow: hidden;"><label style="font-size:10px;font-weight:normal;font-family:Roboto;">'+i.header+"<\/label><\/div>"),n(o).css({left:i.headerLeftPosition+s,top:i.headerTopPosition+h,width:i.headerWidth-r.groupPadding,height:i.headerHeight,"margin-left":r.groupPadding}),this._templateDiv.append(o)):(f=n("<div style='display:block;position:absolute;pointer-events: none;overflow: hidden;'><\/div>"),this._templateDiv.append(f),n(f).css({left:i.headerLeftPosition,width:i.headerWidth,top:i.headerTopPosition,height:i.headerHeight,"-webkit-user-select":"none","user-select":"none","-webkit-touch-callout":"none"}),arguments={header:i.header,data:i.Data},l=n("#"+i.headerTemplate).render(arguments),n(f).html(l)))},getDrillDownHeader:function(n){var i="",t;if(n.length==1)return n[0];for(t=0;t<n.length;t++)i+=n[t],t!=n.length-1&&(i+=this.model._connectorText||".");return i},_drillDownHeader:function(t,i,r){var o,f,s,e,u;for(t&&(o={groupingLevel:i.groupingLevel,groupPath:i.groupPath,childItems:r,levelItems:i,headerItem:{drilldownHeaders:this._drilldownHeaders,originalHeaders:this._originalHeaders},connectorText:"."},this._trigger("headerTemplateRendering",o),this.model._connectorText=o.connectorText),f=[],s=[],e=0;e<this._drilldownHeaders.length;e++)f+="<label class='e-drilldownlabel e-drilldowntext'>"+this._drilldownHeaders[e]+"<\/label>",this._drilldownHeaders.length>1&&e<this._drilldownHeaders.length-1&&(f=f+this.model._connectorText);u=n("<div class='e-drilldownHeader' style='display:block;overflow: hidden;'><div class='e-drilldownlabel' style='position:absolute;font-size:12px;font-weight:normal;'>"+f+"<\/div><\/div>");t&&this.model.enableDrillDownArrow&&(u=n("<div class='e-drilldownHeader' style='display:block;overflow: hidden;'><svg class='e-drilldownarrow' style='width:15px;height:10px;margin-top:7px;fill:black'><polyline points='8,0 8,10 0,5 8,0'/><\/svg><label class='e-drilldownlabel'  style='left:17px;position:absolute;top:5px;font-size:12px;font-weight:normal;'>"+f+"<\/label><\/div>"));n(u).css({left:"0px",width:this._width+"px",top:0,height:"20px",cursor:"pointer"});this.drillDownHeaderColor()!=null&&n(u).css("background-color",this.drillDownHeaderColor());this._drillHeaderDiv.append(u);n(u).mousedown({treemap:this},this._drilldownfunction);n(u).find(".e-drilldownlabel").mousedown({treemap:this},this._drilldownLabel)},_drilldownLabel:function(n){var o=this.innerHTML,r=n.data.treemap,f,s,c,l,u;if(r._drillFunction=!0,r._legendTreemapItems=[],r._currentLevel=null,r._invisibility=[],r._currentToggle=null,!r.model.isVirtualRender)if(r._drilldownHeaders[0]==o)r._drilldownItems=[],r.model.drilledStateLevel!=i&&(s=r._drilldownItems.length,r.model.drilledStateLevel=s),r.refresh();else{for(c="",r._drillHeaderDiv[0].innerHTML="",r._backgroundTile[0].innerHTML="",l="",u=0;u<r._drilldownHeaders.length;u++)o==r._drilldownHeaders[u]&&(f=u+1,r._originalHeaders.splice(u+1),r._drilldownHeaders.splice(u+1));r._labelTemplateElements=[];var a=r.model.levels[r._drilldownHeaders.length-1],e=r._drilldownHeaders.length-r._drilldownItems.length,v=r._drilldownItems.length,h=r._drilldownItems.length==1?r._drilldownItems[0].Data:r._drilldownItems[e<0?v+e:e].Data;return r._drillDownLevelData=h,r._drillDownHeader(!0,a,h),f&&(r._drilldownItem=r._drilldownItems[f-2],r._drilldownItems.splice(f-1)),r._templateDiv[0].innerHTML="",r.model.tooltipTemplate&&r.model.tooltipTemplate.length>0&&(r.model.tooltipTemplate=r.model.tooltipTemplate.slice(0,r.model.tooltipTemplate.length-1)+r._drilldownItems.length),t.util.isNullOrUndefined(r._drilldownItem)||r._groupdrillDownLevels(r._drilldownItem,r._drilldownItems.length),!1}},_drilldownfunction:function(n){var t=n.data.treemap,d=n.data.level,y=t._drilldownItems[0],u,o,s,p,b,k,v,h,a,c,l,r,e,f;if(t._drillFunction=!0,treeMap_drillDownLevelData=y,t._legendTreemapItems=[],t._invisibility=[],t.selectedItems=[],t._currentInvisibleItem=[],t._tog=[],t._rangeInVisibility=[],t._rangevisible=[],t._currentLevel=null,t._currentToggle=null,t._drilldownItems.length>0&&t._initialLevel&&(t._originalHeaders=t._drilldownHeaders),t.model.isVirtualRender){if(t.model.drillDownLevel>1){var o=n.target.innerHTML,w=t._drilldownHeaders.indexOf(o),g=t._drilldownHeaders.length;t._backgroundTile[0].innerHTML="";t._drillHoverDiv[0].innerHTML="";t._templateDiv[0].innerHTML="";t._drilldownHeaders.indexOf(o)!==-1?(t._drilldownHeaders=t._drilldownHeaders.slice(0,w+1),u=t._drilldownHeaders.length,t.model.drillDownLevel=u-1):(t._drilldownHeaders=t._drilldownHeaders.slice(0,t._drilldownHeaders.length-1),u=t._drilldownHeaders.length,t.model.drillDownLevel=u-1);t._prevData=t._prevData.splice(0,u);t._prevLevels=t._prevLevels.splice(0,u);t._prevLegend=t._prevLegend.splice(0,u);u>1?t.runTimeSubitems(t._prevData[u-2],null,t._prevLevels[u-2],t._prevLegend[u-2]):(t._drilldownHeaders=[],t.model.drillDownLevel=0,t.refresh());return}t.model.drillDownLevel==1&&(t._drilldownHeaders=[],t.model.drillDownLevel=0,t.refresh())}else if(t._drilldownItems.length>0)if(o="",s=t.model.rangeColorMapping,t._drilldownItems.length==1){if(t._drilldownItems=[],o=t._drilldownHeaders[0],u={drillDownLevel:0,headerLabel:o},t.model.showLegend)for(r=0;r<s.length;r++)s[r]._legendLabel!=s[r].legendLabel&&(s[r].legendLabel=s[r]._legendLabel);t._trigger("headerLabelClicked",u);t.model.drilledStateLevel!=i&&(p=t._drilldownItems.length,t.model.drilledStateLevel=p);t.refresh()}else{for(r=0;r<t._drillHeaderDiv[0].children[0].children.length;r++)t._drillHeaderDiv[0].children[0].children[r].className=="e-drilldownlabel"&&(o=t._drillHeaderDiv[0].children[0].children[r].innerHTML);for(b=o.split(t.model._connectorText||"."),t._drillHeaderDiv[0].innerHTML="",t._backgroundTile[0].innerHTML="",k="",t._drilldownHeaders.length>1&&t._drilldownHeaders.pop(t._drilldownHeaders.length-1),t._labelTemplateElements=[],v=t.model.levels[t._drilldownHeaders.length-1],v.groupingLevel=n.data.treemap._drilldownItem.GroupingLevel?n.data.treemap._drilldownItem.GroupingLevel:t.model.drilledStateLevel,t._drillDownHeader(!0,v,t._drilldownItem.Data),t._drilldownItem=t._drilldownItems[t._drilldownItems.length-2],t._drilldownItems.pop(t._drilldownItems[t._drilldownItems.length-1]),t._templateDiv[0].innerHTML="",h=null,f=0;f<t._drilldownHeaders.length;f++)h=h==null?t._drilldownHeaders[f]:h+"|~|"+t._drilldownHeaders[f];for(a=t._getPreRenderEventData(y.Data),r=0;r<a.length;r++)for(e=t._getPreRenderEventData(a[r].Data,t._drilldownItems.length+1),f=0;f<e.length;f++)c=c===i?e[f]:c.colorWeight>e[f].colorWeight?e[f]:c,l=l===i?e[f]:l.colorWeight>e[f].colorWeight?l:e[f];t._trigger("preRender",{model:t.model,maximumValue:a[0],minimumValue:c,max:l,level:t._drilldownHeaders.length-1==-1?0:t._drilldownHeaders.length-1});u={drillDownLevel:t._drilldownItems.length,headerLabel:h};t._trigger("headerLabelClicked",u);t._groupdrillDownLevels(t._drilldownItem,t._drilldownItems.length)}},_sizeCalculation:function(r){var h,u,a;if(this.model.rangeColorMapping!=null||this.model.colorPath!=null){var f=this.model.rangeColorMapping!=null&&this.model.rangeColorMapping.length>0?this.model.rangeColorMapping:r?r:n.extend(!0,[],this.model.dataSource),y=this.model.rangeColorMapping!=null&&this.model.rangeColorMapping.length>0?!0:!1,s=0,c=0,v=this.iconWidth()+5,e=this.iconHeight()+5,p=this._calcWidth(this.model.legendSettings.title),w=this._calcHeight(this.model.legendSettings.title),o=0,l=this.model.legendSettings.columnCount;if(r=this.model.legendSettings,this.model.legendSettings.mode!=t.datavisualization.TreeMap.LegendMode.Interactive){if(this.legendheight()==0&&this.legendwidth()==0&&l==0){for(y||(this._legendItem=f,this._generateLegendLabels(this.model,this._legendItem)),u=0;u<f.length;u++)f[u].legendLabel==i&&(f[u].legendLabel=f[u].from+"-"+f[u].to),a=this._calcWidth(f[u].legendLabel),h=v+a+20+p,this.legendheight()==0&&this.legendwidth()==0?this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?this._width<s+h?(e=this.iconHeight()+15+e,o=Math.max(o,s),s=h):s+=h:this._height<c+this.iconHeight()+15?(o+=s,e=Math.max(e,c),s=h,c=0):(c+=this.iconHeight()+18,s=Math.max(h,s)):(xPos+=_legendlabelwidth+18,xPos+150>=this.legendwidth()&&(xPos=10,yPos+=40));this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?(o=Math.max(o,s),e+=this.model.legendSettings.title!=null&&this.model.legendSettings.title!=""?w:5):(o+=s+15,e=Math.max(e,c))}else if(l==0){for(u=0;u<f.length;u++)f[u].legendLabel==i&&(f[u].legendLabel=f[u].from+"-"+f[u].to);e=this.legendheight().toString().indexOf("%")!=-1?this._height/100*parseInt(this.legendheight().replace("%","")):this.legendheight();o=this.legendwidth().toString().indexOf("%")!=-1?this._width/100*parseInt(this.legendwidth().replace("%","")):this.legendwidth()}if(l!=0)for(u=0;u<f.length;u++)f[u].legendLabel==i&&(f[u]._legendLabel=f._legendLabel==i?f[u].from+"-"+f[u].to:f._legendLabel,f[u].legendLabel=f[u].from+"-"+f[u].to),a=this._calcWidth(f[u].legendLabel),h=v+a+10,u%l!=0?(s+=h,u==l-1&&(o=Math.max(o,s))):(u!=0&&(e=this.iconHeight()+15+e),o=Math.max(o,s),s=h)}else e=(r.height!=0?r.height:30)+18,r.title!=null&&r.title!=""&&(e+=25),o=(r.width!=0?r.width:100)+20+r.leftLabel.length*10+r.rightLabel.length*10;this._legendSize={height:e,width:o};this.model.legendSettings!=null&&(this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?(this._height=this._height-parseFloat(e),r.tempWidth=s):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top?(this._height=this._height-parseFloat(e),this._margintop=parseFloat(e)):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Left?(this._width=this._width-o,this._marginleft=o):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Right&&(this._height=this._height,this._width=this._width-o))}},_generateLegendLabels:function(n,t){for(var r=n.colorPath,i=0;i<t.length;i++)this.enableDrillDown()?t[i].legendLabel=t[i].header:(t[i].legendLabel=this.labelPath()?t[i][this.labelPath()]:t[i][n.weightValuePath],t[i].color=t[i][r])},_getDockPositionPoint:function(n,r,u){var o=u.labelPosition,e=2,f=2;return u.groupPadding!=i&&u.groupBorderThickness!=i&&(e=u.groupPadding+u.groupBorderThickness+e,f=u.groupPadding+u.groupBorderThickness+f),u.showHeader&&(f=f+u.headerHeight),o==t.datavisualization.TreeMap.Position.TopCenter?e=n.width/2-r.width/2:o==t.datavisualization.TreeMap.Position.TopRight?e=n.width-r.width-e:o==t.datavisualization.TreeMap.Position.CenterLeft?f=n.height/2-r.height/2:o==t.datavisualization.TreeMap.Position.Center||o==null?(e=n.width/2-r.width/2,f=n.height/2-r.height/2):o==t.datavisualization.TreeMap.Position.CenterRight?(e=n.width-r.width-e,f=n.height/2-r.height/2):o==t.datavisualization.TreeMap.Position.BottomLeft?f=n.height-r.height-f:o==t.datavisualization.TreeMap.Position.BottomCenter?(e=n.width/2-r.width/2,f=n.height-r.height-f):o==t.datavisualization.TreeMap.Position.BottomRight&&(e=n.width-r.width-e,f=n.height-r.height-f),{x:n.left+e,y:n.top+f}},_generateTreeMapItems:function(t,r,u,f){var a,e,s,o,h,v,c,l;if(this._rootTreeMapItems=t,this._getTreeMapItemTemplate(t),t!=null){for(this._isLevelColors||this._setColorMappings(t,this.model,i,f),a=0;a<t.length;a++){if(e=t[a],this.model.isVirtualRender&&this.model.levels.length>0&&this._createBackGround(e,this.model.levels[0],e),s=e.rectangle,this.enableDrillDown()&&this.model.showSubItems&&e.Data!=null&&e.Data.length>0&&(e.Data=e.Data[0]),e.Rectangle=s,o={borderThickness:this.model.leafItemSettings.borderThickness,borderBrush:this.model.leafItemSettings.borderBrush,fill:e.backgroundColor,dataSource:e.Data},this._trigger("itemRendering",{model:this.model,data:o}),o.fill!=e.backgroundColor&&(e._color=o.fill,this.enableDrillDown()))for(h=0;h<f.length;h++)if(f[h].ChildtreeMapItems)for(v=0;v<f[h].ChildtreeMapItems.length;v++)e.header==f[h].ChildtreeMapItems[v].header&&(f[h]._color=o.fill);c=this.textPath()?e.Data[0]?e.Data[0][this.textPath()]:e.Data[this.textPath()]:e.ParentHeader?e.ParentHeader:e.header;c=isNaN(c)?c.replace(" ","_"):c;l=e.header;l=isNaN(l)?l.replace(" ","_"):l;s.setAttribute("id",this._id+"_"+l+"_"+c);n(s).css({"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","-webkit-user-select":"none","user-select":"none","-webkit-touch-callout":"none","border-color":o.borderBrush,"border-width":o.borderThickness+"px"});o.fill?n(s).css("background-color",o.fill):n(s).css("background-color",r);e.backgroundOpacity!=null&&n(s).css("opacity",e.backgroundOpacity);this._wireEventForTreeMapItem(e,s)}this.model.rangeColorMapping.length==0&&this.uniColor()==null&&this._color()!=""?this._setDesaturationColor(t,this.model.desaturationColorMapping):this.model.PaletteColorMapping!=null&&this._setPaletteColor(t,this.model.PaletteColorMapping)}},_wireEventForTreeMapItem:function(t,i){var r=!i.onmouseenter&&navigator&&(navigator.userAgent.match(/iPad/i)!=null||navigator.userAgent.match(/iPhone/i)!=null),u=r?this._rectEnter:this._rectMouseEnter;n(i).on(r?"touchstart":"mouseenter",{Param1:t,Param2:this},u);if(n(i).mousemove({Param1:t,Param2:this},this._rectMouseMove),n(i).mouseleave({treeMap:this},this._rectMouseLeave),n(i).mouseup({treeMap:this},this._docClickFunction),r)n(i).on("touchend",{Param1:t,Param2:this},this._rectLeave)},_getTreeMapItemTemplate:function(i){for(var r,e,o,s,f="",u=0;u<i.length;u++)r=i[u],this.model.leafItemSettings.itemTemplate==null?f+='<div style="border-style:solid;position:absolute;left:'+r.LeftPosition+"px;top:"+r.TopPosition+"px;height:"+r.ItemHeight+"px;width:"+r.ItemWidth+"px;border-width:"+this.borderThickness()+"px;border-color:"+this.borderBrush()+'"><\/div>':(e=n("#"+this.model.leafItemSettings.itemTemplate),r.Data!=null&&r.Data.length==1&&(r.Data=r.Data[0]),o=n.templates(e.html()),s="<div style='overflow:hidden;position:absolute;left:"+r.LeftPosition+"px;top:"+r.TopPosition+"px;height:"+r.ItemHeight+"px;width:"+r.ItemWidth+"px'>"+o.render(r)+"<\/div>",f+=s);for(this._svgDocument!=null&&this.enableDrillDown()&&(this._svgDocument[0].innerHTML=""),this._svgDocument=n('<div style= "overflow:hidden;z-index:1;"id="svgDocument">'+f+"<\/div>"),this._backgroundTile.appendTo(this.element),this._svgDocument.appendTo(this.element),this._svgDocument.css({height:this._height+"px",width:this._width+"px","margin-top":this._margintop+"px","margin-left":this._marginleft,overflow:"hidden","z-index":1,position:"absolute",left:"0",top:"0"}),n(this._backgroundTile).css({height:this._height+"px",width:this._width+"px","margin-top":this._margintop+"px","margin-left":this._marginleft,overflow:"hidden","z-index":0,position:"absolute",left:"0",top:"0"}),this._templateDiv.appendTo(this.element),this._on(n(this._templateDiv),t.eventType.mouseMove,{Param2:this},this._rectMouseMove),this._off(n(this.element),t.eventType.mouseDown,this.rectClick),this.model.enableRightClick&&this._off(n(this.element),"contextmenu",this.rightClick),this._on(n(this.element),t.eventType.mouseDown,{treemap:this,Param1:i},this.rectClick),this.model.enableRightClick&&this._on(n(this.element),"contextmenu",{treemap:this,Param1:i},this.rightClick),this._on(n(this.element),t.eventType.mouseUp,{treeMap:this},this._docClickFunction),this._on(n(this.element),t.eventType.mouseDown,{treemap:this},this.dragDown),this._on(n(this.element),t.eventType.mouseMove,{treemap:this},this.dragMove),this._on(n(this.element),t.eventType.mouseUp,{treemap:this},this.dragUp),this.enableDrillDown()&&(this._drillHeaderDiv.appendTo(this.element),this._drillHoverDiv.appendTo(this.element)),u=0;u<i.length;u++)i[u].rectangle=this._svgDocument[0].childNodes[u]},selectItem:function(t){var r,i,u,f,e;if(this._rootTreeMapItems!=null)for(r=0;r<this._rootTreeMapItems.length;r++)i=this._rootTreeMapItems[r],u=i.rectangle,i.Data!=null&&i.Data.length>0&&(f=i.Data[0]),t==f&&this.highlightOnSelection()&&(n(u).css({"border-width":this.highlightBorderThickness(),"border-color":this.highlightBorderBrush()}),this._browser!="msie"&&(e=this._svgDocument[0].children[this._svgDocument[0].children.length-1],this._svgDocument[0].insertBefore(u,e)),this._prevSelectedItems.push(u),this.selectedItems.push(t))},_selectTreemapItem:function(t){var r,i,u,f;if(this._rootTreeMapItems!=null)for(r=0;r<this._rootTreeMapItems.length;r++)i=this._rootTreeMapItems[r],u=i.rectangle,i.Data!=null&&i.Data.length>0&&(i.Data=i.Data[0]),t!=i.Data||this._contains(this.selectedItems,t)||this.highlightOnSelection()&&(n(u).css({"border-width":this.highlightBorderThickness(),"border-color":this.highlightBorderBrush()}),this._browser!="msie"&&(f=this._svgDocument[0].children[this._svgDocument[0].children.length-1],this._svgDocument[0].insertBefore(u,f)),this._prevSelectedItems=[],this.selectedItems=[],this._prevSelectedItems.push(u),this.selectedItems.push(t))},_selectItemResize:function(){for(var n,i,t=0;t<this._rootTreeMapItems.length;t++)n=this._rootTreeMapItems[t],i=n.rectangle,this.model.showSubItems&&this.enableDrillDown()&&n.Data!=null&&n.Data.length>0&&(n.Data=n.Data[0]),this._contains(this.selectedItems,n.Data)&&(Object.prototype.toString.call(n.Data)==="[object Array]"?this.selectItem(n.Data[0]):this.selectItem(n.Data))},_updateDesaturationRange:function(n){var t=this.model.desaturationColorMapping,f,r,u,e;if(n>=t.rangeMinimum&&n<=t.rangeMaximum)for(f=t.rangeMinimum,r=t.rangeMinimum+(t.rangeMaximum-t.rangeMinimum)/10,u=0;u<10;u++){if(n>=f&&n<=r)return e={},this._legendRects[u]!=i&&(e=this._legendRects[u]),e;f=r;r=r+(t.rangeMaximum-t.rangeMinimum)/10}},_updateLegendRange:function(n,r){for(var s,u,h,l,o,e,c,a=this.model.rangeColorMapping,f=0;f<a.length;f++)if(s=null,u=a[f],this.model.enableGradient&&!t.util.isNullOrUndefined(u.gradientColors)&&(s=this._generateGradientCollection(u.gradientColors)),n>=u.from&&n<=u.to)for(h=f,f!=0&&(h=f*10),l=u.from,o=u.from+(u.to-u.from)/10,e=h;e<h+10;e++)n>=l&&n<=o&&(c={},this._legendRects[e]!=i&&(c=this._legendRects[e]),r.backgroundColor=this.model.enableGradient&&!t.util.isNullOrUndefined(u.gradientColors)?f!=0?s[e-f*10]:s[e]:u.color,c.color=r.backgroundColor,u.color=r.backgroundColor),l=o,o=o+(u.to-u.from)/10;return c},selectItemByPath:function(n,i,r){for(var o,a,v,h,u,s=n.split(r),y=i.split(r),n,i,c=!1,e=this._rootTreeMapItems,f=0;f<s.length;f++){var n=s[f],i=y[f],l=[];for(o=0;o<e.length;o++){for(u=e[o],t.isNullOrUndefined(u)||t.isNullOrUndefined(u.Data)||t.isNullOrUndefined(u.Data[0])||(u.Data=u.Data[0]),a=u.Data,h=0;h<s.length;h++)v=this._reflection(a,n);if(i==v){l.push(u);e=l;c=!0;break}else c||o!=e.length-1||(e=[])}}for(f=0;f<e.length;f++)u=e[f],this.selectItem(u.Data)},_getColorRatio:function(n,t,i,r,u){var f=100/(u-r)*(i-r);return(parseFloat(t)-parseFloat(n))/100*f+parseFloat(n)},_contains:function(n,t){var i=n.length;if(i>0)while(i--)if(Object.prototype.toString.call(t)==="[object Array]"){if(n[i][0]===t[0]||n[i]===t[0])return!0}else if(n[i]===t)return!0;return!1},_rectEnter:function(n){var i=this,t;this.mouseEnter=!0;t=n.data.Param2;n.preventDefault();t.highlightOnSelection()||t.highlightGroupOnSelection()?setTimeout(function(){i.mouseEnter&&(t._rectMouseEnter(n),i.mouseEnter=!1)},500):t._rectMouseEnter(n)},_rectLeave:function(){this.mouseEnter=!1},_rectMouseEnter:function(r){var u=r.data.Param2,h=u.model.legendSettings,c,p=r.data.Param1.Data,l=r.pageX||r.originalEvent.changedTouches[0].pageX,a=r.pageY||r.originalEvent.changedTouches[0].pageY,f,s,w,b,k,o,d,e,v,y,g,nt,tt;if(p!=null&&(f=r.data.Param2._toolTipElement,n(f).css({visibility:"visible"}),s=r.data.Param2.model.tooltipTemplate,n("#"+s).length>0?(r.data.Param2.model._templateId=n("#"+s),c=n("#"+s)):c=r.data.Param2.model._templateId,f!=null&&s!=null&&(w=c.render(p),n(f).html(w),n(f).css({left:l+10,top:a+10}),n(f).css({display:"block"}),b=f[0]!=null?f[0].clientHeight:f.clientHeight,k=f[0]!=null?f[0].clientWidth:f.clientWidth,r.data.Param2._tooltipSize={height:b,width:k})),h!=null&&h.mode==t.datavisualization.TreeMap.LegendMode.Interactive&&u.model.rangeColorMapping!=null&&(u.showLegend()==i||u.showLegend()))for(o=0;o<u._rootTreeMapItems.length;o++)if(d=u._rootTreeMapItems[o],e=d.Rectangle.getBoundingClientRect(),e.x<=l&&e.x+e.width>=l&&e.y<=a&&e.y+e.height>=a&&(v=null,v=u.model.rangeColorMapping.length>0?u.model.rangeColorMapping.length:1,y=h.width,h.width==i&&(y=150),g=y/v/10,u._rootTreeMapItems[o].legendrect!=null)){nt=u._rootTreeMapItems[o].legendrect.marginLeft;tt=nt+Math.ceil(g)-u._interactiveArrow.width()/2;n(u._interactiveArrow).css({"margin-left":tt,display:"block",visibility:"visible"});break}},_rectMouseMove:function(t){var r=t.data.Param2,u=r._toolTipElement,s=10,v=!0,y=document.getElementById(r._id),h=y.getBoundingClientRect().width/y.offsetWidth,c,o,l,p,w,b,f,e,a;if(t.data.Param1==i&&u!=null){for(e=0;e<r._rootTreeMapItems.length;e++)if(o=r._rootTreeMapItems[e],o.rectangle.offsetLeft<t.offsetX&&o.rectangle.offsetLeft+o.rectangle.offsetWidth>t.offsetX&&o.rectangle.offsetTop<t.offsetY&&o.rectangle.offsetTop+o.rectangle.offsetHeight>t.offsetY){c=o.Data;break}c!=null?(l=t.data.Param2.model.tooltipTemplate,u!=null&&l!=null&&(n(u).css({left:t.pageX+10,top:t.pageY+10,display:"block"}),p=n("#"+l).render(c),n(u).html(p),w=u[0]!=null?u[0].clientHeight:u.clientHeight,b=u[0]!=null?u[0].clientWidth:u.clientWidth,r._tooltipSize={height:w,width:b})):u!=null&&(v=!1,n(u).css("display","none"))}if(v){if(f=r._tooltipSize,f.width+t.pageX>=h*r._width&&(t.pageX-=h*f.width+10,t.pageX<0&&(t.pageX=10)),f.height+t.pageY>=h*r._height&&(t.pageY-=h*f.height+10,t.pageY<0&&(t.pageY=10)),r.enableDrillDown()&&r._browser!="msie")for(e=0;e<r._drillHoverDiv[0].children.length;e++)a=r._drillHoverDiv[0].children[e],a.className==t.data.Param1.ParentHeader&&n(a).css({display:"block"});t.pageX=t.clientX;t.pageY=t.clientY;r.element[0].getBoundingClientRect().x+r._width<Math.abs(t.clientX+f.width)&&(t.pageX=t.clientX-f.width);r.element[0].getBoundingClientRect().x>Math.abs(t.clientX-f.width)&&(t.pageX=t.clientX+s);r.element[0].getBoundingClientRect().x>Math.abs(t.clientX-f.width)&&r.element[0].getBoundingClientRect().x+r._width<Math.abs(t.clientX+f.width)&&(t.pageX=t.clientX-f.width/2,t.pageY=t.clientY+s);r.element[0].getBoundingClientRect().y+r._height-s*2<Math.abs(t.clientY+f.height)&&(t.pageY=t.pageY+s);r.element[0].getBoundingClientRect().y>Math.abs(t.clientY+f.height)&&(t.pageY=t.clientY);u!=null&&(n(u).css({left:t.pageX+10,top:t.pageY+10,display:"block",position:"fixed"}),n(r.element[0]).append(u))}},_rectMouseLeave:function(t){this.mouseEnter=!1;var i=t.data.treeMap._toolTipElement;i!=null&&(n(i).css("display","none"),n(t.data.treeMap._interactiveArrow).css({visibility:"hidden"}))},_docClickFunction:function(t){this.mouseEnter=!1;var i=t.data.treeMap._toolTipElement;i!=null&&n(this).css("display","block")},_setColorMappings:function(n,i,r,u){var e=this,h=this.model.legendSettings,o,s,f;if(this._legendTreemapItems=i.rangeColorMapping.length>0?n:this._legendTreemapItems,i.rangeColorMapping.length>0||i.uniColorMapping.color!=null||this.uniColor()!=null)for(f=0;f<n.length;f++)o=n[f].Data instanceof Array?e._reflection(n[f].Data[0],i.colorValuePath):e._reflection(n[f].Data,i.colorValuePath),(i.rangeColorMapping!=null&&i.rangeColorMapping.length>0||i.uniColorMapping!=null&&(i.uniColorMapping.color!=null||this.uniColor()!=null))&&(h.mode==t.datavisualization.TreeMap.LegendMode.Interactive||this.model.enableGradient?n[f].legendrect=this._updateLegendRange(o,n[f]):(s=n[f]._generateColorMappings(i,this),n[f].backgroundColor=s));else i.desaturationColorMapping!=null&&(i.desaturationColorMapping.color!=""||this._color()!="")?this._setDesaturationColor(n,i.desaturationColorMapping):i.paletteColorMapping!=null&&i.paletteColorMapping.colors.length>0?this._setPaletteColor(n,i.paletteColorMapping):this.model.colorPath!=null&&this._setFillColor(n,this.model.colorPath,u)},_setFillColor:function(n,t,i){for(var u,r=0;r<n.length;r++)n[r].color=n[r].backgroundColor=n[r].Data[0]?n[r].Data[0][t]:n[r].Data[t],n[r].legendLabel=n[r].header;if(this.enableDrillDown()&&this.showLegend()){for(u=0;u<i.length;u++)i[u].ChildtreeMapItems&&(i[u].ChildtreeMapItems.sort(function(n,t){return parseFloat(t.weight)-parseFloat(n.weight)}),i[u].color=i[u].ChildtreeMapItems.length>0?i[u].ChildtreeMapItems[0].Data[0][t]:null,i[u].legendLabel=i[u].header);this._legendItem=i}else this.enableDrillDown()||!this.showLegend()||this.model.isHierarchicalDatasource||(this._legendItem=n)},_setDesaturationColor:function(n,t){var u,i,c;n=n.sort(this._orderBycolorWeight);var l=typeof t.from=="number"?t.from:this._from(),a=typeof t.to=="number"?t.to:this._to(),f=typeof t.rangeMinimum=="number"?t.rangeMinimum:this._rangeMinimum(),e=typeof t.rangeMaximum=="number"?t.rangeMaximum:this._rangeMaximum(),o=[],s,h,r;for(u=0;u<n.length;u++)s=n[u],h=s.colorWeight,r=this._reflection(h,this.colorValuePath()),r!=null&&typeof r!="number"&&(r=Number(r.replace(/[^0-9\.]+/g,""))),o.push(r),this.model.showLegend&&(n[u].legendrect=this._updateDesaturationRange(r,s));for(this._rangeMinimum()==0&&(f=Math.min.apply(Math,o)),this._rangeMaximum()==0&&(e=Math.max.apply(Math,o)),i=0;i<n.length;i++)n[i].backgroundColor=typeof t.color=="string"?t.color:this._color(),n[i].colorWeight>=f&&n[i].colorWeight<=e&&(c=this._getColorRatio(this.model.desaturationColorMapping.from,this.model.desaturationColorMapping.to,n[i].colorWeight,f,e),n[i].backgroundOpacity=c)},_generateGradientCollection:function(n){for(var f=[],r=n[0].charAt(0)=="#"?n[0]:this._colorNameToHex(n[0]),u=n[0].charAt(0)=="#"?n[n.length-1]:this._colorNameToHex(n[n.length-1]),e=this._hexToR(r),o=this._hexToG(r),s=this._hexToB(r),h=this._hexToR(u),c=this._hexToG(u),l=this._hexToB(u),i=10,a=this._getRangeColorValues(i,e,h),v=this._getRangeColorValues(i,o,c),y=this._getRangeColorValues(i,s,l),t=0;t<i;t++)f.push(this._rgbToHex(a[t],v[t],y[t]));return f},_hexToR:function(n){return parseInt(this._cropHex(n).substring(0,2),16)},_hexToG:function(n){return parseInt(this._cropHex(n).substring(2,4),16)},_hexToB:function(n){return parseInt(this._cropHex(n).substring(4,6),16)},_cropHex:function(n){return n.charAt(0)=="#"?n.substring(1,7):n},_rgbToHex:function(n,t,i){return"#"+this._toHex(n)+this._toHex(t)+this._toHex(i)},_toHex:function(n){var t="0123456789ABCDEF";return(n=parseInt(n,10),isNaN(n))?"00":(n=Math.max(0,Math.min(n,255)),t.charAt((n-n%16)/16)+t.charAt(n%16))},_getRangeColorValues:function(n,t,i){var u=[],f,r;if(u.push(t),t>i)for(f=(t-i)/(n-1),r=n;r>2;r--)t=t-f,u.push(t);else for(f=(i-t)/(n-1),r=2;r<n;r++)t=t+f,u.push(t+f);return u.push(i),u},_colorNameToHex:function(n){var t=n,i={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return Object.prototype.toString.call(t)=="[object Array]"?t:typeof i[t.toLowerCase()]!="undefined"?i[t.toLowerCase()]:t},_drawInteractiveLegend:function(r){var ot,yt,st,ht,v,y,it,f,w,b,ct,pt,lt,p,nt,ut,tt,rt,g,kt,at,u,et,c;r=n.extend({},this.model.legendSettings,r,!0);var e=0,h=0,a=window.SVGSVGElement?!0:!1,o=this._legenddiv,l=r.height!=0?r.height:30,s=r.width!=0?r.width:100;if(r.mode==t.datavisualization.TreeMap.LegendMode.Interactive||this.model.rangeColorMapping!=null){if(c="",r.height==0&&(l=30),r.width==0&&(s=100),r.leftLabel==null&&(r.leftLabel=""),r.title!=null){if(ot=e,r.showLabels||(ot=e+r.leftLabel.length*10),yt=r.title.length*10,st=titleText=r.title,yt>s)for(u=1;u<titleText.toString().length;u++)st=titleText.toString().substring(0,u-1)+"...";c=this._createLabel(st,ot,h,"e-interactivelegend-title");c[0].title=titleText;c.css({width:s+"px"});a?c.appendTo(o):o.append(c);h+=25}if(r.showLabels&&(h+=25),r.leftLabel==null||r.showLabels||(c=this._createLabel(r.leftLabel,e,h-3,"e-interactivelegend-leftlabel"),a?c.appendTo(o):o.append(c),e=e+r.leftLabel.length*10),ht=this._createInteractiveArrow(e,h+l),ht.appendTo(o),this._interactiveArrow=ht,v=null,!a&&this.model.enableGradient&&(v=this._createGroup(!1,"legendGroup"),v.style.left="0px",v.style.top="0px",v.style.position="relative",o.append(v)),this.model.rangeColorMapping.length>0){for(y=this.model.rangeColorMapping,it=0;it<y.length;it++)if(f=y[it],!f.hideLegend){if(w=[],this.model.enableGradient&&!t.util.isNullOrUndefined(f.gradientColors)&&(w=this._generateGradientCollection(f.gradientColors)),b={},this.model.enableGradient&&!t.util.isNullOrUndefined(f.gradientColors))if(a){var p=n("<canvas/>"),nt=p[0].getContext("2d"),k=nt.createLinearGradient(0,0,300,0),d=0;for(u=0;u<10;u++)d=d+1/10,u==0||f.gradientColors==1?(k.addColorStop(0,f.gradientColors[0]),k.addColorStop(d,w[u])):u==w.length-1?(k.addColorStop(d-1/10,w[u]),k.addColorStop(d,f.gradientColors[1])):(k.addColorStop(d-1/10,w[u]),k.addColorStop(d,w[u+1]));nt.fillStyle=k;nt.fillRect(0,0,300,300);p.css({height:l+"px",width:s/y.length+"px","margin-left":e+"px","margin-top":h+"px",opacity:"0.9",filter:"alpha(opacity=90)",position:"absolute"});p.appendTo(o)}else ct="legend"+it,pt="<v:rect id="+ct+' display="block" style="position:absolute;top: '+(ypos-2)+"px;left:"+xpos+"px;width:"+s/y.length+"px;height:"+l+'px;"><v:fill opacity="0.9px" type="gradient" method="linear sigma" angle="270"/><v:stroke opacity="0px"/><\/v:rect>',v.innerHTML=v.innerHTML+pt,lt=document.getElementById(ct),lt.fillcolor=f.gradientColors[0],lt.fill.color2=f.gradientColors[1];else g=n("<div/>"),g.css({height:l+"px",width:s/this.model.rangeColorMapping.length+"px","background-color":f.color,"margin-left":e+"px","margin-top":h+"px",opacity:"0.9",filter:"alpha(opacity=90)",position:"absolute"}),a?g.appendTo(o):o.append(g);for(u=0;u<10;u++)b={},b.marginLeft=e,this._legendRects.push(b),e=e+s/y.length/10}}else if(this._color()!=""){var f=this.model.desaturationColorMapping,wt=f.color,gt=f.rangeMaximum-f.rangeMinimum,bt=f.to-f.from,b={};if(a){for(p=n("<canvas/>"),nt=p[0].getContext("2d"),n(p).attr({width:s,height:l}),ut=bt/10,tt=s/10,u=1;u<=10;u++)rt=f.from+ut*u,nt.fillStyle=this.hex2rgba_convert(wt,rt),nt.fillRect((u-1)*tt,0,tt,l);p.css({height:l+"px",width:s+"px","margin-left":e+"px","margin-top":h+"px",opacity:"0.9",filter:"alpha(opacity=90)",position:"absolute"});p.appendTo(o)}else for(ut=bt/10,tt=s/10,u=1;u<=10;u++)rt=f.from+ut*u,kt=e+(u-1)*tt,g=n("<div/>"),g.css({height:l+"px",width:tt+"px","background-color":wt,"margin-left":kt+"px","margin-top":h+"px",opacity:rt.toString(),filter:"alpha(opacity="+rt*100+")",position:"absolute"}),o.append(g);for(at=s/10,u=0;u<10;u++)b={},b.marginLeft=e-at/2,this._legendRects.push(b),e=e+at}if(r.showLabels){var ft=e-s,vt=h-25,dt=this._createLabel(f.from,ft,vt,"e-legend-rangestartlabel");ft=xpos;et=this._createLabel(f.to,ft,vt);f.legendLabel!=i&&(et=this._createLabel(f.legendLabel,ft-f.legendLabel.length*5,vt,"e-legend-rangeendlabel"));a?(f==y[0]&&dt.appendTo(o),et.appendTo(o)):(f==y[0]&&o.append(dt),o.append(et))}r.rightLabel==null||r.showLabels||(c=this._createLabel(r.rightLabel,e+10,h-3,"e-interactivelegend-rightlabel"),a?c.appendTo(o):o.append(c),e=e+r.rightLabel.length*10);totalwidth=e+10;totalheight=h+l+this._interactiveArrow.height();this._legendSize={width:totalwidth,height:totalheight};r.dockPosition=="left"?this._marginleft=totalwidth:r.dockPosition=="top"&&(this._margintop=totalheight)}},hex2rgba_convert:function(n,t){return n=n.replace("#",""),r=parseInt(n.substring(0,2),16),g=parseInt(n.substring(2,4),16),b=parseInt(n.substring(4,6),16),result="rgba("+r+","+g+","+b+","+t+")"},_createLabel:function(t,i,r,u){var f=n("<div class="+u+"><\/div>");return f[0].innerHTML=t,f.css({"font-size":"12px","font-weight":"normal","margin-left":i+"px","margin-top":r+"px",position:"absolute"}),f},_createInteractiveArrow:function(t,i){var r=n("<div class='e-icon1 e-interactiveArrow'><\/div>");return r[0].innerHTML="&#9650",r.css({"margin-left":t+"px","margin-top":i+"px",position:"absolute",visibility:"hidden"}),r},_setPaletteColor:function(n,t){n=n.sort(this._orderBycolorWeight);for(var i=0;i<n.length;i++)t.colors!=null&&t.colors.length>0&&(n[i].backgroundColor=t.colors[i%t.colors.length])},_orderBycolorWeight:function(n,t){return n.colorWeight==t.colorWeight?0:n.colorWeight<t.colorWeight?1:-1},_orderByAreaWight:function(n,t){return n.AreaByWeight==t.AreaByWeight?0:n.AreaByWeight<t.AreaByWeight?1:-1},_calculateSliceAndDiceItemSize:function(n,t,r,u,f,e,o,s,h){var a,g,l,p,nt,b,v,tt,d,c,k,y;e==""&&(e=0);a=e;g=this._getTotalWeight(n);s==i&&(s=u>f?!0:!1);l={Width:u,Height:f-h};p=o<l.Height?o:0;l.Height=l.Height-p;var rt={X:t,Y:r+p,Width:l.Width,Height:l.Height},it=l.Height*l.Width,w=n.length;if(s)for(nt=l.Height,b=0,c=0;c<w;c++)k=it/g*n[c].weight,v=k/nt,e=v>a?a:0,b<=l.Width&&(n[c].ItemWidth=c!=w-1?v-parseFloat(e):v,n[c].ItemHeight=nt,n[c].LeftPosition=b+t,n[c].TopPosition=r+o,b+=v);else for(tt=l.Width,d=0,c=0;c<w;c++)k=it/g*n[c].weight,y=k/tt,e=y>a?a:0,d<=l.Height&&(n[c].ItemWidth=tt,n[c].ItemHeight=c!=w-1?y-parseFloat(e):y,n[c].LeftPosition=t,n[c].TopPosition=d+r+p,d+=y)},_calculateSquarifiedItemSize:function(n,t,i,r,u,f,e,o){var a,tt,it,s,v,y,l,g,c;f==""&&(f=0);var rt=this._getTotalWeight(n),p={Width:r,Height:u-o},nt=e<p.Height?e:0;for(p.Height=p.Height-nt,a=n.length-1;a>=0;a--)l=n[a],l.AreaByWeight=p.Height*p.Width*l.weight/rt,l.headerTopPosition=i;var h={X:t,Y:i+nt,Width:p.Width,Height:p.Height},b=n.sort(this._orderByAreaWight),k=0,d=0,w=0;for(a=0;a<n.length;a=w)for(tt=b[a],weightObject=this._getGroupTotalWeight(tt,b,h,a),it=weightObject.totalWeight,w=weightObject.index,s={},v=h.Width>h.Height?!0:!1,y=a;y<w;y++)l=b[y],g=it,y==a&&(s.X=h.X,s.Y=h.Y,v?(s.Width=g/h.Height,s.Height=h.Height,h.X+=s.Width,h.Width=Math.max(0,h.Width-s.Width)):(s.Width=h.Width,s.Height=g/h.Width,h.Y+=s.Height,h.Height=Math.max(0,h.Height-s.Height)),k=s.X,d=s.Y),c={},b.indexOf(l)!=b.length-1?(c.X=0,c.Y=0,c.Width=v?s.Width-parseFloat(f):l.AreaByWeight/s.Height,c.Height=v?l.AreaByWeight/s.Width:s.Height-parseFloat(f),w-y!=1&&(v?c.Height-=parseFloat(f):c.Width-=parseFloat(f))):(c.Width=v?s.Width:l.AreaByWeight/s.Height,c.Height=v?l.AreaByWeight/s.Width:s.Height),l.ItemWidth=c.Width,l.ItemHeight=c.Height,l.LeftPosition=k,l.TopPosition=d,v?d+=w-y!=1?c.Height+parseFloat(f):c.Height:k+=w-y!=1?c.Width+parseFloat(f):c.Width},_getGroupTotalWeight:function(n,t,i,r){for(var f=0,o=0,s,e,h;r<t.length;r++){s=this._getShortersideLength(i.Width,i.Height);e=t[r];f+=e.AreaByWeight;var u=f/s,c=n.AreaByWeight/u,l=e.AreaByWeight/u;if(r==0&&(o=this._aspectRatio(u,s)),h=Math.max(this._aspectRatio(c,u),this._aspectRatio(l,u)),f==e.AreaByWeight||h<o)o=h;else{f-=e.AreaByWeight;u=f/s;o=Math.max(this._aspectRatio(c,u),this._aspectRatio(l,u));break}}return{totalWeight:f,index:r}},_aspectRatio:function(n,t){return n>t?n/t:t/n},_getShortersideLength:function(n,t){return n>t?t:n},_getTotalWeight:function(n){for(var i=0,t=0;t<n.length;t++)i+=parseFloat(n[t].weight);return i},_getGroupitem:function(i,r,u,e){var a=[],p,w,y,k,o,h,s,tt,v,it,l,rt;if(r!=null&&this.weightValuePath()!=null){for(y in r)o=r[y],(o!=null&&o.hasOwnProperty(i)?!0:this._containsProperty(o,i))&&(h=this._reflection(o,i),n.inArray(h,a)==-1&&(this._legendToggle?this._legendToggle!=h?a.push(h):n.inArray(h,this._toggle)==-1&&this._toggle.push(h):a.push(h)));if(this._invisibility)for(l=0;l<a.length;l++)for(p=0;p<this._invisibility.length;p++)this._invisibility[p]==a[l]&&(a[l]=null,n.inArray(this._invisibility[p],this._toggle)==-1&&this._toggle.push(this._invisibility[p]));for(w=[],y=0;y<a.length;y++){var c={},b=[],g=a[y],nt=0,d=0,ut=0;for(k=0;k<r.length;k++)if(o=r[k],h=this._reflection(o,i),h==g){if(s=this._reflection(o,this.weightValuePath()),tt=this._reflection(o,this.colorPath()),!t.util.isNullOrUndefined(this._invisibility)&&this._invisibility.length>0&&(o._isVisible||(s=0)),s==null)continue;if(typeof s!="number"&&(s=Number(s.replace(/[^0-9\.]+/g,""))),s<0&&(s=-1*s),v=this._reflection(o,this.colorValuePath()),v!=null&&typeof v!="number"&&(v=Number(v.replace(/[^0-9\.]+/g,""))),this._legendToggle){if(this._legendToggle!=h)for(it=this._legendTreemapItems.length,l=0;l<it;l++)this._legendTreemapItems[l].isVisible&&n.inArray(o,b)==-1&&b.push(o)}else b.push(o);ut++;s!=null&&(d+=parseFloat(s));v!=null&&(nt+=parseFloat(v))}c.header=g;c.data=b;c.weight=d;c.colorWeight=nt;c.headerHeight=u;c.isVisible=!0;c.groupPath=i;c.level=e;c.color=tt;d>0&&(rt=new f(c),w.push(rt))}return this._treemapItemCollection=w,w}return null},_getTopGroupitem:function(n,t){var h,u,l,c,s,r,e,b,a,k;n==null&&(n=this.labelPath());n==null&&(n=this.weightValuePath());var o={},v=0,y=0,p=[],w=[];for(h=0;h<t.length;h++){if(u=t[h],u._isVisible=!0,l=this._reflection(u,n),this._invisibility)for(c=0;c<this._invisibility.length;c++)this._invisibility[c]==l&&(u._isVisible=!1);(s={},r=this._reflection(u,this.weightValuePath()),r!=null&&r!=i)&&(typeof r!="number"&&(r=Number(r.replace(/[^0-9\.]+/g,""))),r<0&&(r=-1*r),e=this._reflection(u,this.colorValuePath()),e!=null&&typeof e!="number"&&(e=Number(e.replace(/[^0-9\.]+/g,""))),r!=null&&(v+=parseFloat(r)),e!=null&&(y+=parseFloat(e)),w.push(u),s.weight=r,s.data=u,s.header=l,s.colorWeight=e,b=new f(s),p.push(b))}return o.header="",o.data=w,o.weight=v,o.innerItem=p,o.colorWeight=y,o.isVisible=!0,a=[],k=new f(o),a.push(k),a},_containsProperty:function(n,t){for(var i in n)if(i==t)return!0;return!1},_reflection:function(t,i){var r=t,u,f,e;if(i!=null&&t!=null){for(u=i.split("."),u.push(i),f=0;f<u.length;f++)r!=null&&(e=r.hasOwnProperty(u[f])?!0:this._containsProperty(r,u[f]),e&&n.each(r,function(n,t){if(n==u[f])return r=t,!1}));return r}return null}});u=function(){this.groupBackground=null;this.groupBorderColor=null;this.groupBorderThickness=1;this.groupPadding=4;this.groupPath=null;this.groupGap=1;this.headerHeight=20;this.showHeader=!0;this.showLabels=!1;this.headerTemplate=null;this.labelTemplate=null;this.labelPosition="center";labelVisibilityMode="visible";headerVisibilityMode="visible";this.treeMapItems=[]};u.prototype={};var e=function(){this.groupID=null;this.rangeColorMapping=[];this.desaturationColorMapping={from:0,to:0,color:"",rangeMinimum:0,rangeMaximum:0};this.uniColorMapping={color:null};this.paletteColorMapping={colors:[]}},o=function(){this.from=-1;this.to=-1;this.legendlabel=null;this.color=null},f=function(n){this.weight=n.weight;this.colorWeight=n.colorWeight;this.Data=n.data;this.headerHeight=n.headerHeight;this.header=n.header;this.label=n.header;this.headerLeftPosition=0;this.headerTopPosition=0;this.innerItems=n.innerItem;this.headerWidth=0;this.headerTemplate=null;this.isVisible=n.isVisible;this.groupPath=n.groupPath;this.level=n.level;this.color=n.color};f.prototype={_generateColorMappings:function(n,t){return n.rangeColorMapping!=null&&n.rangeColorMapping.length>0?this._getRangeBrushColor(n.rangeColorMapping):t.uniColor()!=null&&n.uniColorMapping!=null?t.uniColor():n.uniColorMapping.color!=null&&n.uniColorMapping!=null?this._getUniColor(n.uniColorMapping):void 0},_getUniColor:function(n){return n.color},_getRangeBrushColor:function(n){for(var t,r,i=0;i<n.length;i++)t=n[i],this.colorWeight>=t.from&&this.colorWeight<=t.to&&(r=t.color);return r}};t.datavisualization.TreeMap.selectionMode={Default:"default",Multiple:"multiple"};t.datavisualization.TreeMap.groupSelectionMode={Default:"default",Multiple:"multiple"};t.datavisualization.TreeMap.ItemsLayoutMode={Squarified:"squarified",SliceAndDiceHorizontal:"sliceanddicehorizontal",SliceAndDiceVertical:"sliceanddicevertical",SliceAndDiceAuto:"sliceanddiceauto"};t.datavisualization.TreeMap.DockPosition={Top:"top",Bottom:"bottom",Right:"right",Left:"left"};t.datavisualization.TreeMap.LegendMode={Default:"default",Interactive:"interactive"};t.datavisualization.TreeMap.Position={TopLeft:"topleft",TopCenter:"topcenter",TopRight:"topright",CenterLeft:"centerleft",Center:"center",CenterRight:"centerright",BottomLeft:"bottomleft",BottomCenter:"bottomcenter",BottomRight:"bottomright"};t.datavisualization.TreeMap.Alignment={Near:"near",Center:"center",Far:"far"};t.datavisualization.TreeMap.VisibilityMode={Visible:"visible",HideOnExceededLength:"hideonexceededlength"}})(bbdesigner$,SyncfusionBoldBIDashboard);bbdesigner$.extend(!0,BoldBIDashboard.datavisualization.TreeMap.prototype,{getDrillDownHeader:function(n){var i="",r=1,t;if(n.length===r)return n[0]=this.model.header,n[0];for(t=0;t<n.length;t++)i+=n[t],t!==n.length-r&&(i+=".");return i}});
