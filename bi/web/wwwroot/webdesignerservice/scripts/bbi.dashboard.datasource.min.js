/*!
*  filename: bbi.dashboard.datasource.min.js
*  version : 6.17.13
*  Copyright Syncfusion Inc. 2001 - 2017. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
var InternalQueryExpression=function(){function n(n){this.id=null;this.oldVal="";this.oldExpName="";this.isAddButtonEnabled=!1;this.queryExp=[];this.expressionLength=0;this.tempExp=[];this.provider="";this.isVirtualScrollEnabled=!1;this.listContainer=null;this.expLiTag=null;this.bodyContainer=null;this.textBox=null;this.textArea=null;this.expressionContainer=null;this.addBtnTag=null;this.saveBtnTag=null;this.footerTag=null;this.expWaterMark="";this.successMessageLocale="";this.nameWaterMark="Expression Name";this.isAdd=!1;this.ejFunctionDropdown=null;this.ejColumnDropdown=null;this.ejFunctionList=null;this.ejColumnList=null;this.ejExpDialog=null;this.ejIndicator=null;this.locale=null;this.isFromQueryDesigner=!1;this.aggregationList=["SUM","COUNT","AVG","MAX","MIN","VAR","STDEV","SUMD","AVGD","COUNTD","INDEX","TOTAL","RUNNINGAVG","RUNNINGCOUNT","RUNNINGSUM","RUNNINGMAX","RUNNINGMIN","NULL"];this.rowExpression=["RUNNINGAVG","RUNNINGCOUNT","RUNNINGSUM","RUNNINGMAX","RUNNINGMIN"];this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.id=this.dashboardDesigner._id;this.widgetHelper=this.dashboardDesigner.modules.widgetHelper;this.provider="SQL";this.expWaterMark=this.locale.queryExpressionDialog.QueryExpression;this.successMessageLocale=this.locale.queryExpressionDialog.successMessageNotification;this.renderQueryExpression()}return n.prototype.renderQueryExpression=function(){var u=this,f=BoldBIDashboard.buildTag("div.bbi-userselect","",{},{id:this.id+"_exp_designer"}),t=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_exp_designer_div"}),n,e;f.append(t);var b=BoldBIDashboard.buildTag("table.bbi-querydesigner-exp-table","",{},{unselectable:"on"}),k=BoldBIDashboard.buildTag("tr","",{}),d=BoldBIDashboard.buildTag("td.bbi-querydesigner-exp-separator bbi-querydesigner-exp-td","",{"font-size":"13px"},{}),g=BoldBIDashboard.buildTag("td","",{"margin-left":"12px"},{});t.append(b);b.append(k);k.append(d).append(g);n=BoldBIDashboard.buildTag("div","",{width:"175px",height:"460px"});e=this.expressionContainer=BoldBIDashboard.buildTag("div","",{"margin-left":"10px"},{id:this.id+"_exp_designer_container_exp"});d.append(n);g.append(e);var o=BoldBIDashboard.buildTag("table.bbi-querydesigner-exp-table","",{width:"623px"},{unselectable:"on"}),nt=BoldBIDashboard.buildTag("tr","",{width:"590px"}),tt=BoldBIDashboard.buildTag("td","",{}),oi=BoldBIDashboard.buildTag("label.bbi-designer-title-label",this.locale.expressionDesigner.nameText,{},{id:this.id+"_exp_designer_exp_name"}),it=BoldBIDashboard.buildTag("tr","",{width:"590px"}),rt=BoldBIDashboard.buildTag("td","",{}),s=this.textBox=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-textbox","",{height:"20px",width:"240px","margin-top":"2px","margin-bottom":"5px"},{type:"text",id:this.id+"_exp_designer_textBox",spellcheck:"false"});tt.append(oi);nt.append(tt);rt.append(s);it.append(rt);var ut=BoldBIDashboard.buildTag("tr","",{height:"100px",width:"590px"}),ft=BoldBIDashboard.buildTag("tr","",{width:"590px"}),et=BoldBIDashboard.buildTag("td","",{}),si=BoldBIDashboard.buildTag("label.bbi-designer-title-label",this.locale.expressionDesigner.expressionText,{},{id:this.id+"_exp_designer_trgt_name"});et.append(si);ft.append(et);var ot=BoldBIDashboard.buildTag("td","",{"font-size":"13px"},{}),h=this.textArea=BoldBIDashboard.buildTag("textarea.e-textarea bbi-designer-textarea","",{height:"90px",width:"593px","margin-top":"6px",overflow:"auto"},{id:this.id+"_exp_designer_textarea",spellcheck:"false"}),st=BoldBIDashboard.buildTag("tr","",{height:"255px",width:"590px"}),ht=BoldBIDashboard.buildTag("td","",{}),ct=BoldBIDashboard.buildTag("table.bbi-querydesigner-exp-innertable","",{height:"250px",width:"590px","margin-top":"6px","margin-bottom":"2px"}),lt=BoldBIDashboard.buildTag("tr","",{height:"35px",width:"590px"}),at=BoldBIDashboard.buildTag("td","",{}),hi=BoldBIDashboard.buildTag("span.bbi-designer-title-label",this.locale.expressionDesigner.functionsText,{},{}),vt=BoldBIDashboard.buildTag("div","",{"margin-top":"6px",width:"210px"},{}),c=BoldBIDashboard.buildTag("input","",{"margin-top":"5px"},{id:this.id+"_exp_designer_options"}),ci=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_exp_designer_option_div"}),yt=BoldBIDashboard.buildTag("td","",{}),li=BoldBIDashboard.buildTag("div","",{height:"25px",margin:"25px 10px 0px -3px","border-left":"1px solid var(--querydesigner-primary-border-color)"},{});yt.append(li);var pt=BoldBIDashboard.buildTag("td","",{}),ai=BoldBIDashboard.buildTag("span.bbi-designer-title-label",this.locale.expressionDesigner.columnSettingsText,{"margin-left":"6px"},{}),wt=BoldBIDashboard.buildTag("div","",{"margin-top":"6px",width:"199px","margin-left":"6px"},{}),l=BoldBIDashboard.buildTag("input","",{height:"35px",width:"190px"},{id:this.id+"_exp_designer_data"}),vi=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_exp_designer_data_div"}),yi=BoldBIDashboard.buildTag("td","",{height:"35px"}),bt=BoldBIDashboard.buildTag("tr","",{width:"590px"}),i=BoldBIDashboard.buildTag("td","",{width:"210px"},{}),kt=BoldBIDashboard.buildTag("td","",{}),pi=BoldBIDashboard.buildTag("div","",{height:"200px",margin:"-10px 10px 0px -3px","border-left":"1px solid var(--querydesigner-primary-border-color)"},{});kt.append(pi);var r=BoldBIDashboard.buildTag("td","",{width:"205px"},{}),dt=BoldBIDashboard.buildTag("td","",{height:"190px"}),wi=this.functionNoDataContainer=BoldBIDashboard.buildTag("div.bbi-querydesigner-function-nodata bbi-designer-empty-msg","",{width:"188px",height:"135px"},{id:this.id+"_function_nodata_container"}).text(this.locale.queryExpressionDialog.NoResultFound),gt=BoldBIDashboard.buildTag("div.bbi-querydesigner-function-search","",{width:"188px"},{id:this.id+"_div_functions_search"}),ni=BoldBIDashboard.buildTag("div.e-option-list","",{width:"205px","margin-top":"1px"},{}),bi=this.columnNoDataContainer=BoldBIDashboard.buildTag("div.bbi-querydesigner-column-nodata bbi-designer-empty-msg","",{width:"188px",height:"135px"},{id:this.id+"_column_nodata_container"}).text(this.locale.queryExpressionDialog.NoResultFound),ti=BoldBIDashboard.buildTag("div.bbi-querydesigner-column-search","",{width:"188px"},{id:this.id+"_div_columnsettings_search"}),a=BoldBIDashboard.buildTag("ul","",{},{id:this.id+"_exp_designer_option_list"}),ii=BoldBIDashboard.buildTag("div.e-data-list","",{width:"199px","margin-left":"6px","margin-top":"1px"},{}),v=BoldBIDashboard.buildTag("ul","",{},{id:this.id+"_exp_designer_data_list"}),ri=BoldBIDashboard.buildTag("div.bbi-designer-cursor","",{height:"200px",width:"180px","margin-right":"10px"},{id:this.id+"_cat_desc"}),ki=BoldBIDashboard.buildTag("div","",{height:"5px"},{}),di=BoldBIDashboard.buildTag("div.bbi-designer-title-label","",{height:"auto"},{id:this.id+"_exp_designer_desc_heading"}),gi=BoldBIDashboard.buildTag("div","",{"text-align":"justify",height:"auto","font-size":"12px","margin-top":"8px"},{id:this.id+"_exp_designer_desc_content"}),nr=BoldBIDashboard.buildTag("div","",{height:"12px"},{}),tr=BoldBIDashboard.buildTag("div.bbi-designer-title-label","",{height:"auto"},{id:this.id+"_exp_designer_example_heading"}),ir=BoldBIDashboard.buildTag("div","",{float:"left","word-wrap":"break-word","margin-top":"8px",height:"auto","font-size":"12px",width:"190px"},{id:this.id+"_exp_designer_example_content"}),y=this.addBtnTag=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.expressionDesigner.addText,{float:"left"},{id:this.id+"_exp_designer_add_btn",type:"button"}),ui=BoldBIDashboard.buildTag("div.bbi-querydesigner-success-msg-wrap","",{display:"none"},{id:this.id+"_exp_success_message_wrap"}),rr=BoldBIDashboard.buildTag("span.bbi-querydesigner-success-message",this.successMessageLocale,{},{id:this.id+"_exp_success_message"}),ur=BoldBIDashboard.buildTag("span.bbi-querydesigner-success-message-icon","",{},{id:this.id+"_exp_success_message_icon"});this.saveBtnTag=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.expressionDesigner.saveBtnText,{float:"right"},{id:this.id+"_exp_designer_save_btn",type:"button"});var p=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.expressionDesigner.closeBtnText,{float:"right"},{id:this.id+"_exp_designer_close_btn",type:"button"}),w=this.bodyContainer=BoldBIDashboard.buildTag("div.e-lv e-js e-parentlv bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","",{width:"100%",height:n.height(),display:"block",position:"relative"},{id:this.id+"_exp_designer_bodyContainer"}),fi=BoldBIDashboard.buildTag("div","",{},{}),ei=this.listContainer=BoldBIDashboard.buildTag("div.bbi-list-container e-js e-widget bbi-designer-dataset","",{"border-top-width":"1px",padding:"3px"},{id:this.id+"_div_expList"}),fr=this.expLiTag=BoldBIDashboard.buildTag("ul.e-list-hdr e-clearall","",{width:"auto",height:"auto"},{id:this.id+"_query_exp_li_container"});ei.append(fr);fi.append(ei);w.append(fi);n.append(w);ot.append(h);ut.append(ot);o.append(nt).append(it).append(ft).append(ut);lt.append(yi).append(at).append(yt).append(pt);at.append(hi).append(vt);vt.append(c).append(ci);pt.append(ai).append(wt);wt.append(l).append(vi);ct.append(lt).append(bt);ht.append(ct);st.append(ht);o.append(st);i.append(gt);i.append(ni);i.append(wi);ni.append(a);r.append(ti);r.append(ii);r.append(bi);ii.append(v);dt.append(ri);ri.append(ki).append(di).append(gi).append(nr).append(tr).append(ir);bt.append(dt).append(i).append(kt).append(r);e.append(o);f.BoldBIDashboardDialog({width:"auto",height:"auto",minWidth:"310px",minHeight:"215px",title:this.locale.expressionDesigner.expressionTitleText,beforeClose:this.bbdesigner$.proxy(this.closeExpDialog,this),enableResize:!1,showOnInit:!1,showFooter:!0,containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner e-query-expression",enableModal:!0,close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.footerTag=this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_foot");ui.append(ur,rr);this.footerTag.append(y,p,this.saveBtnTag,ui);c.BoldBIDashboardDropDownList({targetID:this.id+"_exp_designer_option_div",dataSource:[],popupHeight:"150px",minPopupWidth:"190px",showRoundedCorner:!0,cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-designer-drpdown-selection bbi-dbrd-control",width:"190px",height:"28px",change:this.bbdesigner$.proxy(this.renderFunctionList,this)});l.BoldBIDashboardDropDownList({targetID:this.id+"_exp_designer_data_div",popupHeight:"150px",showRoundedCorner:!0,cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-designer-drpdown-selection bbi-dbrd-control",minPopupWidth:"190px",fields:{id:"id",text:"name"},dataSource:[],width:"190px",height:"28px",change:this.bbdesigner$.proxy(this.renderColumnList,this)});a.BoldBIDashboardListBox({dataSource:[],height:"155px",change:this.bbdesigner$.proxy(this.optionClick,this),showRoundedCorner:!0,cssClass:"bbi-designer-param-assign bbi-designer-list-selection bbi-dbrd-control",width:"190px"});v.BoldBIDashboardListBox({dataSource:[],height:"155px",showRoundedCorner:!0,itemRequest:this.bbdesigner$.proxy(function(n){u.ejColumnList.dummyUl.length===6&&n.model.allowVirtualScrolling&&(u.ejColumnList.dummyUl=u.ejColumnList.element.children())},this),cssClass:"bbi-designer-param-assign bbi-designer-list-selection bbi-dbrd-control",width:"190px"});y.off("click",this.bbdesigner$.proxy(this.addExpression,this));p.off("click",this.bbdesigner$.proxy(this.closeExpression,this));this.saveBtnTag.off("click",this.bbdesigner$.proxy(this.saveExpression,this));y.on("click",this.bbdesigner$.proxy(this.addExpression,this));p.on("click",this.bbdesigner$.proxy(this.closeExpression,this));this.saveBtnTag.on("click",this.bbdesigner$.proxy(this.saveExpression,this));w.BoldBIDashboardScroller({scrollerSize:this.dashboardDesigner.scrollerSize.scrollSize,height:n.height(),enableTouchScroll:!0,autoHide:!0,buttonSize:this.dashboardDesigner.scrollerSize.buttonSize});t.BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup "+this.id+"_designer_waiting_popup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()});this.ejFunctionDropdown=c.data("BoldBIDashboardDropDownList");this.ejColumnDropdown=l.data("BoldBIDashboardDropDownList");this.ejFunctionList=a.data("BoldBIDashboardListBox");this.ejColumnList=v.data("BoldBIDashboardListBox");this.ejExpDialog=f.data("BoldBIDashboardDialog");this.ejIndicator=t.data("BoldBIDashboardWaitingPopup");h.bind("change keyup paste",this.bbdesigner$.proxy(this.txtExpChanged,this));s.bind("change keyup paste",this.bbdesigner$.proxy(this.txtNameChanged,this));BoldBIDashboard.DashboardUtil.txtWaterMark(h,this.expWaterMark);BoldBIDashboard.DashboardUtil.txtWaterMark(s,this.nameWaterMark);this.unWiredEvents();this.wiredEvents();this.renderAutocomplete(gt,!0);this.renderAutocomplete(ti,!1)},n.prototype.closeDialog=function(){this.resetSearchBox()},n.prototype.renderAutocomplete=function(n,t){var r=BoldBIDashboard.buildTag("table.bbi-querydesigner-toolbar-table","",{width:"100%"}),u=this.bbdesigner$("<tr/>"),f=this.bbdesigner$("<td/>"),e=BoldBIDashboard.buildTag("span.e-atc e-widget","",{width:"100%",height:"28px"},{}),i=BoldBIDashboard.buildTag("span.e-in-wrap e-box e-padding bbi-designer-widget-autocomplete","",{},{}),h=this.expSearch=BoldBIDashboard.buildTag("input.bbi-autocomplete bbi-designer-widget-watermark bbi-designer-atc-boxshadow e-js e-input","",{},{type:"text",placeholder:this.locale.expressionDesigner.placeHolderText,id:t?this.id+"_function_search":this.id+"_column_search"}),o=this.expSearchIcon=BoldBIDashboard.buildTag("span.e-select bbi-designer-widget-autocomplete e-search-area","",{width:"24px",height:"30px"},{id:t?this.id+"_function_search-icon":this.id+"_column_search-icon"}),s;if(o.append(BoldBIDashboard.buildTag("span.bbi-headericon bbi-designer-search","",{display:"table-cell"})),i.append(o),i.append(h),e.append(i),s=BoldBIDashboard.buildTag("span.e-select bbi-designer-widget-select bbi-designer-widget-autocomplete","",{height:"30px"},{id:this.id+"_column_widgetClose"}),s.append("<span class='bbi-headericon e-reportdesigner-widget-left'/>"),f.append(e),u.append(f),r.append(u),n.append(r),this.functionSearchBox=this.expressionContainer.find("#"+this.id+"_function_search"),this.columnSearchBox=this.expressionContainer.find("#"+this.id+"_column_search"),this.functionSearchIcon=this.expressionContainer.find(".bbi-querydesigner-function-search .bbi-headericon"),this.functionListbox=this.expressionContainer.find("#"+this.id+"_exp_designer_option_list"),this.columnSearchIcon=this.expressionContainer.find(".bbi-querydesigner-column-search .bbi-headericon"),this.columnListbox=this.expressionContainer.find("#"+this.id+"_exp_designer_data_list"),this.functionListTd=this.expressionContainer.find(".e-option-list"),this.columnListTd=this.expressionContainer.find(".e-data-list"),t){this.expSearch.on("keyup",this.bbdesigner$.proxy(this.onSearchText,this,this.functionSearchIcon,this.functionListbox,!0));this.expSearch.on("blur",this.bbdesigner$.proxy(this.onSearchBlur,this,this.functionSearchIcon,this.functionListbox));this.expSearchIcon.on("click",this.bbdesigner$.proxy(this.onSearchCloseClick,this,this.functionSearchIcon,this.functionListbox,this.expSearch,!0));this.functionSearchBox.on("focus",this.bbdesigner$.proxy(this.onSearchTextBoxFocusIn,this,this.expressionContainer,!0));this.functionSearchBox.on("blur",this.bbdesigner$.proxy(this.onSearchTextBoxFocusOut,this,this.expressionContainer,!0))}else{this.expSearch.on("keyup",this.bbdesigner$.proxy(this.onSearchText,this,this.columnSearchIcon,this.columnListbox,!1));this.expSearch.on("blur",this.bbdesigner$.proxy(this.onSearchBlur,this,this.columnSearchIcon,this.columnListbox));this.expSearchIcon.on("click",this.bbdesigner$.proxy(this.onSearchCloseClick,this,this.columnSearchIcon,this.columnListbox,this.expSearch,!1));this.columnSearchBox.on("focus",this.bbdesigner$.proxy(this.onSearchTextBoxFocusIn,this,this.expressionContainer,!1));this.columnSearchBox.on("blur",this.bbdesigner$.proxy(this.onSearchTextBoxFocusOut,this,this.expressionContainer,!1))}},n.prototype.onSearchTextBoxFocusIn=function(n,t){var i;t?(i=n.find(".bbi-querydesigner-function-search"),i.addClass("e-focus")):(i=n.find(".bbi-querydesigner-column-search"),i.addClass("e-focus"))},n.prototype.onSearchTextBoxFocusOut=function(n,t){var i;t?(i=n.find(".bbi-querydesigner-function-search"),i.hasClass("e-focus")&&i.removeClass("e-focus")):(i=n.find(".bbi-querydesigner-column-search"),i.hasClass("e-focus")&&i.removeClass("e-focus"))},n.prototype.resetSearchBox=function(){this.resetFunction();this.resetColumn()},n.prototype.resetFunction=function(){this.functionSearchBox.val("");this.functionListbox.BoldBIDashboardListBox("showAllItems");this.functionListTd.css("display","block");this.functionNoDataContainer.css("display","none");this.functionSearchIcon.addClass("bbi-designer-search").removeClass("bbi-designer-close")},n.prototype.resetColumn=function(){this.columnSearchBox.val("");this.showAllItemsForListBox(this.columnListbox);this.columnListTd.css("display","block");this.columnNoDataContainer.css("display","none");this.columnSearchIcon.addClass("bbi-designer-search").removeClass("bbi-designer-close")},n.prototype.onSearchText=function(n,t,i,r){var u,f;r.keyCode!==13&&(u=this.bbdesigner$(r.target).val(),u.length>0?(n.addClass("bbi-designer-close").removeClass("bbi-designer-search"),t.data("BoldBIDashboardListBox").model.allowVirtualScrolling?(t.data("BoldBIDashboardListBox").option("query",(new BoldBIDashboard.Query).where("Name",BoldBIDashboard.FilterOperators.contains,u,!0)),this.refreshColumnList(),f=this.filterItems(t.data("BoldBIDashboardListBox").model.dataSource.dataSource.json,u),this.setDisplayForListElements(i,f.length===0)):(f=this.filterItems(t.data("BoldBIDashboardListBox").model.dataSource,u),t.BoldBIDashboardListBox("hideAllItems"),t.BoldBIDashboardListBox("showItemsByIndices",f),this.setDisplayForListElements(i,f.length===0))):(this.showAllItemsForListBox(t),this.setDisplayForListElements(i)))},n.prototype.showAllItemsForListBox=function(n){n.data("BoldBIDashboardListBox").model.allowVirtualScrolling?n.data("BoldBIDashboardListBox").option("query",new BoldBIDashboard.Query):n.BoldBIDashboardListBox("showAllItems")},n.prototype.setDisplayForListElements=function(n,t){n?(this.functionListTd.css("display",BoldBIDashboard.isNullOrUndefined(t)?"block":t?"none":"block"),this.functionNoDataContainer.css("display",BoldBIDashboard.isNullOrUndefined(t)?"none":t?"block":"none")):(this.columnListTd.css("display",BoldBIDashboard.isNullOrUndefined(t)?"block":t?"none":"block"),this.columnNoDataContainer.css("display",BoldBIDashboard.isNullOrUndefined(t)?"none":t?"block":"none"))},n.prototype.onSearchBlur=function(n,t,i){var r=this.bbdesigner$(i.target).val();r.length===0&&(n.addClass("bbi-designer-search").removeClass("bbi-designer-close"),this.bbdesigner$(i.target).val(""),this.showAllItemsForListBox(t))},n.prototype.onSearchCloseClick=function(n,t,i,r){i.val("");this.showAllItemsForListBox(t);n.addClass("bbi-designer-search").removeClass("bbi-designer-close");this.setDisplayForListElements(r);this.refreshSearchListScroller(t)},n.prototype.refreshSearchListScroller=function(n){var t=n.data("BoldBIDashboardListBox");BoldBIDashboard.isNullOrUndefined(t)||t.scrollerObj.refresh()},n.prototype.filterItems=function(n,t){var r=[],i;if(!BoldBIDashboard.isNullOrUndefined(n))for(i=0;i<n.length;i++)(t===""||n[i].Name.toLowerCase().search(t.toLowerCase())!==-1)&&r.push(i);return r},n.prototype.enableButton=function(n,t){BoldBIDashboard.DashboardUtil.buttonEnable(n,t)},n.prototype.txtNameChanged=function(){var t=this.textBox.val(),n=this.expressionContainer.data("e-exp");t!==this.oldExpName?n&&n.isEdit&&t!==n.name||(n&&!n.isEdit||BoldBIDashboard.isNullOrUndefined(n))&&t.length!==0?this.enableButton(this.saveBtnTag,!0):this.enableButton(this.saveBtnTag,!1):(n&&n.isEdit&&t===n.name||(n&&!n.isEdit||BoldBIDashboard.isNullOrUndefined(n))&&t.length===0)&&this.enableButton(this.saveBtnTag,!1);this.oldExpName=t},n.prototype.txtExpChanged=function(){var t=this.textArea.val(),n=this.expressionContainer.data("e-exp");t!==this.oldVal||BoldBIDashboard.isNullOrUndefined(n)||!n.isEdit?(n&&n.isEdit&&t!==n.expression||n&&!n.isEdit||BoldBIDashboard.isNullOrUndefined(n))&&t.length!==0?(this.enableButton(this.saveBtnTag,!0),this.enableButton(this.addBtnTag,!1)):n.isEdit&&t===n.expression?(this.enableButton(this.addBtnTag,this.isAddButtonEnabled),this.enableButton(this.saveBtnTag,!1)):(this.enableButton(this.saveBtnTag,!1),this.enableButton(this.addBtnTag,!1)):(n&&n.isEdit&&t===n.expression||(n&&!n.isEdit||BoldBIDashboard.isNullOrUndefined(n))&&t.length===0)&&this.enableButton(this.saveBtnTag,!1);this.oldVal=t},n.prototype.updateTextArea=function(){var n=this.textArea.val();n&&n.length>0?n!==this.expWaterMark&&this.textArea.hasClass("bbi-designer-txtmark")&&this.textArea.removeClass("bbi-designer-txtmark"):this.textArea.val(this.expWaterMark).addClass("bbi-designer-txtmark")},n.prototype.updateTextBox=function(){var n=this.textBox.val();n&&n.length>0?n!==this.nameWaterMark&&this.textBox.hasClass("bbi-designer-txtmark")&&this.textBox.removeClass("bbi-designer-txtmark"):this.textBox.val(this.nameWaterMark).addClass("bbi-designer-txtmark")},n.prototype.addExpression=function(){this.resetSearchBox();this.requestValidation(!0);var n=this.textBox.val();this.onListItemMouseUp({target:this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(n))[0]})},n.prototype.requestValidation=function(n,t){var r=this.expressionContainer.data("e-exp"),u=this.textArea.val().trim(),i;r&&r.isEdit?(i=this.textBox.val(),i===this.nameWaterMark&&this.textBox.hasClass("bbi-designer-txtmark")&&(i=""),u===this.expWaterMark&&this.textArea.hasClass("bbi-designer-txtmark")&&(u=""),this.hasExpChanges(r,u)?i&&i.length===0||u&&u.length===0||!this.isValidName(i)||!/^[a-zA-Z0-9- _]*$/.test(i)?n?this.newExpression():this.expListClick(t):this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.saveExpression,IconType.warning,AlertType.Confirm,!1,"",{method:"updateExpressionInfo",instance:this,dataInfo:{name:n?i:t,isSelectionChange:n?!1:!0}}):n?this.switchEditExp():this.expListClick(t)):r&&!r.isEdit||BoldBIDashboard.isNullOrUndefined(r)?u!=="Query Expression"?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.saveExpression,IconType.warning,AlertType.Confirm,!1,"",{height:140,width:500,method:"clearExpression",dataInfo:n?null:{isSelectionChange:!0,name:t},instance:this}):n?this.clearExpression(!1):this.expListClick(t):n?this.newExpression():this.expListClick(t)},n.prototype.clearExpression=function(n,t){if(BoldBIDashboard.isNullOrUndefined(t))if(n)this.isAdd=!0,this.saveExpression();else{var i=this.getAvailableName();this.textArea.val(this.expWaterMark).addClass("bbi-designer-txtmark");this.textBox.val(i);this.updateTextBox();this.enableButton(this.saveBtnTag,!1);this.enableButton(this.addBtnTag,!1)}else n?this.saveExpression(t):this.expListClick(t.name)},n.prototype.deleteEmtyExp=function(){var n=this,i=this.expLiTag.find("li"),t=null;i.each(function(i,r){for(var e=n.bbdesigner$(r).find(".e-list-text").text(),f=!0,u=0;u<n.queryExp.length;u++)if(e===n.queryExp[u].name){f=!1;break}if(f){t=n.bbdesigner$(r);return}});t&&t.remove()},n.prototype.getEmptyExp=function(){var n=this,i=this.expLiTag.find("li"),t=null,r=this.bbdesigner$;return i.each(function(i,u){for(var e=r(u).find(".e-list-text").text(),o=!0,f=0;f<n.queryExp.length;f++)if(e===n.queryExp[f].name){o=!1;break}if(o){t=e;return}}),t},n.prototype.switchEditExp=function(){var n=this,i=this.expLiTag.find("li"),t=!0,r=this.bbdesigner$;i.each(function(i,u){for(var e=r(u).find(".e-list-text").text(),o=!0,f=0;f<n.queryExp.length;f++)if(e===n.queryExp[f].name){o=!1;break}if(o){t=!1;n.expListClick(e);return}});t&&this.newExpression()},n.prototype.hasExpChanges=function(n,t){for(var i=0;i<this.queryExp.length;i++)if(this.queryExp[i].name===n.name&&t.indexOf("["+this.queryExp[i].name+"]")===-1&&(this.queryExp[i].name!==this.textBox.val()||this.queryExp[i].expression!==t))return!0;return!1},n.prototype.newExpression=function(){var n=this.getAvailableName();this.textArea.val(this.expWaterMark).addClass("bbi-designer-txtmark");this.textBox.val(n);this.updateTextBox();this.expressionContainer.data("e-exp",{isEdit:!1,name:""});this.appendExpList(n);this.enableButton(this.saveBtnTag,!1);this.enableButton(this.addBtnTag,!1);this.UpdateMiscellaneousList()},n.prototype.updateExpressionInfo=function(n,t){var i=this.textBox.val();if(n)t.isSelectionChange?this.expressionContainer.data("e-exp").isEdit?this.expressionValidation(ExpAction.Edit,t.isSelectionChange,t.name):this.expressionValidation(ExpAction.New,t.isSelectionChange,t.name):this.expressionValidation(ExpAction.Save);else if(t.isSelectionChange)this.expListClick(t.name);else{this.switchEditExp();i=this.textBox.val();this.onListItemMouseUp({target:this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(i))[0]})}},n.prototype.isValidName=function(n){for(var t=this.expressionContainer.data("e-exp"),i=0;i<this.queryExp.length;i++)if(this.queryExp[i].name===n&&(BoldBIDashboard.isNullOrUndefined(t)||t.isEdit&&t.name!==n))return!1;return!0},n.prototype.getAvailableName=function(){for(var n,u,i="Expression",r=[],t=0;t<this.queryExp.length;t++)r.push(this.queryExp[t].name);n=0;do n++,u=r.indexOf(i+n);while(u!==-1);return i+n},n.prototype.populateExpressions=function(){if(this.expLiTag.children().length>0&&this.expLiTag.empty(),!BoldBIDashboard.isNullOrUndefined(this.queryExp)&&this.queryExp.length>0){for(var n=0;n<this.queryExp.length;n++)this.appendExpList(this.queryExp[n].name);this.enableButton(this.addBtnTag,!0)}this.scrollerRefresh(this.bodyContainer)},n.prototype.updateExpList=function(n,t){var i=BoldBIDashboard.DashboardUtil.escapeSelector(n),r=BoldBIDashboard.DashboardUtil.escapeSelector(t);this.dashboardDesigner.element.find("#"+this.id+"_li_"+r).remove();this.dashboardDesigner.element.find("#"+this.id+"_li_"+i).unbind("click",this.bbdesigner$.proxy(this.expressionSelection,this,n));this.dashboardDesigner.element.find("#"+this.id+"_"+i).unbind("click",this.bbdesigner$.proxy(this.removeExpression,this,n));this.dashboardDesigner.element.find("#"+this.id+"_li_"+i+" .e-list-text").text(t);this.addTooltip(this.dashboardDesigner.element.find("#"+this.id+"_li_"+i+" .e-list-text"),t);this.dashboardDesigner.element.find("#"+this.id+"_li_"+i).attr("id",this.id+"_li_"+r);this.dashboardDesigner.element.find("#"+this.id+"_"+i).attr("id",this.id+"_"+r);this.dashboardDesigner.element.find("#"+this.id+"_li_"+r).bind("click",this.bbdesigner$.proxy(this.expressionSelection,this,t));this.dashboardDesigner.element.find("#"+this.id+"_"+r).bind("click",this.bbdesigner$.proxy(this.removeExpression,this,t))},n.prototype.appendExpList=function(n,t){var f=BoldBIDashboard.DashboardUtil.escapeSelector(n),i=BoldBIDashboard.buildTag("li.e-user-select e-list e-state-default e-list-check bbi-designer-exp-list","",{},{id:this.id+"_li_"+f,name:n}),r=BoldBIDashboard.buildTag("a.e-chevron-right_01 bbi-remove-shadow","",{}),e=BoldBIDashboard.buildTag("span.e-list-text e-rel bbi-designer-content bbi-dbrd-designer-hoverable",n,{},{name:n}),u;r.append(e);u=BoldBIDashboard.buildTag("div.e-chk-image e-icon e-cross-circle bbi-dbrd-designer-hoverable","",{},{id:this.id+"_"+f,"data-tooltip":"Delete"});r.append(u);i.append(r);u.bind("click",this.bbdesigner$.proxy(this.removeExpression,this,n));i.bind("click",this.bbdesigner$.proxy(this.expressionSelection,this,n));i.bind(BoldBIDashboard.DashboardUtil.MouseEvent.mouseUp,this.bbdesigner$.proxy(this.onListItemMouseUp,this));BoldBIDashboard.isNullOrUndefined(t)?this.expLiTag.append(i):t===0?(this.expLiTag.prepend(i),i.css({"border-bottom":"0.5px solid #c8c8c8"})):this.listContainer.find("ul>li:nth-child("+t+")").after(i);this.addTooltip(e,n);this.updateContainerBorder();this.bodyContainer.height()>this.listContainer.height()?this.bodyContainer.find(".e-content").removeClass("e-content"):this.scrollerRefresh(this.bodyContainer)},n.prototype.addTooltip=function(n,t){BoldBIDashboard.DashboardUtil.textWidth(t,"12px Heebo")>=n.width()&&n.attr("data-tooltip",t)},n.prototype.onListItemMouseUp=function(n){var t=this.bbdesigner$(n.target).closest("li"),i=this.dashboardDesigner.bbdesigner$;t.hasClass("bbi-expression-user-selection-active")||(t.parent().children().each(function(){var n=i(this);n.removeClass("bbi-expression-user-selection-active")}),t.addClass("bbi-expression-user-selection-active"),this.isAddButtonEnabled=this.addBtnTag.attr("disabled")===undefined)},n.prototype.expressionSelection=function(n){this.requestValidation(!1,n)},n.prototype.renderFunctionList=function(n){this.ejFunctionList.setModel({dataSource:n.value,fields:{id:"ID",text:"Name"},selectedIndex:0});var t=this.ejFunctionList.getSelectedItems();this.optionClick(t[0]);this.resetFunction()},n.prototype.renderColumnList=function(n){var t=n.value;this.isVirtualScrollEnabled&&(t=new BoldBIDashboard.DataManager({json:n.value}));this.ejColumnList.setModel({dataSource:t,fields:{text:"Name",tooltipText:"Name"},enableWordWrap:!1,selectedIndex:0});this.resetColumn();this.refreshColumnList()},n.prototype.scrollerRefresh=function(n){n.data("BoldBIDashboardScroller")&&n.data("BoldBIDashboardScroller").refresh()},n.prototype.functionDblClick=function(){var i=this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_option_list").data("BoldBIDashboardListBox"),r=i.model.selectedItems,n=i.model.dataSource[r],t=null;n&&(n.CategoryName==="Logical"?(t=n.Name,this.caretPosition(t)):(t=n.Name+"()",this.caretPosition(t,!0,t.length),this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_desc_content").text(n.Description),this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_example_content").text(n.Example)))},n.prototype.columnDblClick=function(){var i=this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_data_list").data("BoldBIDashboardListBox"),r=i.model.selectedItems,n=i.listitems[r],t=null;n&&(t=n.HasDynamicParams===!0?"@{{:"+n.Value+"}}":"["+n.Name+"]",this.caretPosition(t,!1,t.length))},n.prototype.caretPosition=function(n,t,i){var u,f,r;n&&n.length>0&&(n=n.search("RUNNING")!==-1?n.replace(")","SUM())"):n,BoldBIDashboard.isNullOrUndefined(i)||(i=n.search("RUNNING")!==-1?i+4:i),u=this.textArea.val(),u!==this.expWaterMark&&this.textArea.hasClass("bbi-designer-txtmark")?this.textArea.removeClass("bbi-designer-txtmark"):u===this.expWaterMark&&this.textArea.hasClass("bbi-designer-txtmark")&&(u="",this.textArea.val(u).removeClass("bbi-designer-txtmark")),this.textArea.focus(),f=this.textArea[0],r=f.selectionStart,!BoldBIDashboard.isNullOrUndefined(i)&&t?(this.textArea.val(u.substring(0,r)+n+u.substring(r)),r=f.selectionEnd=r+i-1):BoldBIDashboard.isNullOrUndefined(i)||t?(this.textArea.val(u.substring(0,r)+n+u.substring(r)),r=f.selectionEnd=r):(this.textArea.val(u.substring(0,r)+n+u.substring(r)),r=f.selectionEnd=r+i),this.textArea.trigger("change"))},n.prototype.optionClick=function(n){n.data&&(this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_desc_heading").text("Description"),this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_example_heading").text("Example"),this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_desc_content").text(n.data.Description),this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_example_content").text(n.data.Example))},n.prototype.removeNestedExpression=function(n){var i=[],r,t,u;for(this.listContainer.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(n)).remove(),t=this.queryExp.length-1;t>=0;t--)(this.queryExp[t].name===n||this.queryExp[t].expression.indexOf("["+n+"]")>-1)&&(i.push(this.queryExp[t]),this.queryExp.splice(t,1));if(i.length>0)for(r=[],t=i.length-1;t>=0;t--)if(r=this.removeNestedExpression(i[t].name),r.length>0)for(u=0;u<r.length;u++)i.push(r[u]);return i},n.prototype.removeExpression=function(n){this.hasExpression(n)?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.removeExpression,this.locale.dataSource.removeExpressionText,IconType.warning,AlertType.Confirm,!1,"",{dataInfo:{expressionName:n},instance:this,method:"conformDelete"}):this.conformRemoveExpression(n)},n.prototype.conformRemoveExpression=function(n){var u=[],f=[],i,t,r,e,o;if(this.listContainer.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(n)).remove(),this.updateContainerBorder(),BoldBIDashboard.isNullOrUndefined(this.queryDesigner)||(this.queryExp=this.queryDesigner.queryExp),!BoldBIDashboard.isNullOrUndefined(this.queryExp)&&this.queryExp.length>0){for(this.expressionLength=this.queryExp.length,t=this.queryExp.length-1;t>=0;t--)if(this.queryExp[t].name===n){u.push(this.queryExp[t].name);f.push(this.queryExp[t].expression);this.queryExp.splice(t,1);break}if(i=this.removeNestedExpression(n),!BoldBIDashboard.isNullOrUndefined(i)&&i.length>0)for(t=i.length-1;t>=0;t--)u.push(i[t].name),f.push(i[t].expression);this.serverValidationExp({selectedExpression:"",name:u,expression:f},ExpAction.Remove);r=this.queryExp.length;r>0?(this.expListClick(this.queryExp[r-1].name),this.deleteEmtyExp(),this.enableButton(this.addBtnTag,!0)):r===0&&this.expLiTag.children().length>0&&this.expLiTag.empty()}this.expLiTag.children().length===0&&(e=this.getAvailableName(),this.appendExpList(e),this.textBox.val(e),this.updateTextBox(),this.textArea.val(this.expWaterMark).addClass("bbi-designer-txtmark"),this.expressionContainer.data("e-exp",{isEdit:!1,name:""}),this.enableButton(this.addBtnTag,!1));this.scrollerRefresh(this.bodyContainer);this.UpdateMiscellaneousList();o=this.textBox.val();this.onListItemMouseUp({target:this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(o))[0]})},n.prototype.conformDelete=function(n,t){n&&this.conformRemoveExpression(t.expressionName)},n.prototype.hasExpression=function(n){for(var r,f,u,i=this.widgetHelper.getAllWidgets(),t=0;t<i.length;t++)if(!BoldBIDashboard.isNullOrUndefined(i[t].DataGroupInfo)&&i[t].DataGroupInfo.DataSourceID===this.dataset.Id)for(r=0;r<i[t].DataGroupInfo.FieldContainers.length;r++)for(f=i[t].DataGroupInfo.FieldContainers[r],u=0;u<f.FieldInfos.length;u++)if(n===f.FieldInfos[u].Name)return!0;return!1},n.prototype.expListClick=function(n){for(var i,r=!1,t=0;t<this.queryExp.length;t++)if(n===this.queryExp[t].name){this.textBox.val(this.queryExp[t].name);this.textArea.val(this.queryExp[t].expression);this.updateTextBox();this.updateTextArea();this.textArea.focus();i=this.textArea[0];i.selectionStart=i.selectionEnd=this.queryExp[t].expression.length;this.expressionContainer.data("e-exp",{isEdit:!0,name:this.queryExp[t].name,expression:this.queryExp[t].expression});r=!0;this.enableButton(this.saveBtnTag,!1);break}r||(this.textBox.val(n),this.updateTextBox(),this.textArea.val(this.expWaterMark).addClass("bbi-designer-txtmark"),this.enableButton(this.saveBtnTag,!1),this.enableButton(this.addBtnTag,!1),this.expressionContainer.data("e-exp",null));this.UpdateMiscellaneousList()},n.prototype.updateContainerBorder=function(){this.listContainer.css("border-top-width",this.listContainer.find("li").length===0?"0px":"1px")},n.prototype.wiredEvents=function(){this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_option_list").bind(BoldBIDashboard.isTouchDevice()?"doubletap":"dblclick",this.bbdesigner$.proxy(this.functionDblClick,this));this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_data_list").bind(BoldBIDashboard.isTouchDevice()?"doubletap":"dblclick",this.bbdesigner$.proxy(this.columnDblClick,this));this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_closebutton").on("click",this.bbdesigner$.proxy(this.closeDialog,this))},n.prototype.unWiredEvents=function(){this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_option_list").unbind(BoldBIDashboard.isTouchDevice()?"doubletap":"dblclick",this.bbdesigner$.proxy(this.functionDblClick,this));this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_data_list").unbind(BoldBIDashboard.isTouchDevice()?"doubletap":"dblclick",this.bbdesigner$.proxy(this.columnDblClick,this));this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_closebutton").unbind("click",this.bbdesigner$.proxy(this.closeDialog,this));BoldBIDashboard.isNullOrUndefined(this.functionSearchBox)||(this.functionSearchBox.off("keyup",this.bbdesigner$.proxy(this.onSearchText,this)),this.functionSearchBox.off("blur",this.bbdesigner$.proxy(this.onSearchBlur,this)));BoldBIDashboard.isNullOrUndefined(this.columnSearchBox)||(this.columnSearchBox.off("keyup",this.bbdesigner$.proxy(this.onSearchText,this)),this.columnSearchBox.off("blur",this.bbdesigner$.proxy(this.onSearchBlur,this)));BoldBIDashboard.isNullOrUndefined(this.expSearchIcon)||this.expSearchIcon.off("click",this.bbdesigner$.proxy(this.onSearchCloseClick,this))},n.prototype.openExpression=function(n,t,i,r){var f,y,o,h,s,b,k,v,l,c,e,u;this.callBackModel=i;this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.dataset=i.optionalArgs.dataset;this.ejExpDialog.open();this.resetDesigner(!0);this.queryExp=n;this.isFromQueryDesigner=r;this.tempExp=this.bbdesigner$.extend(!0,[],n);f=new BoldBIDashboard.Dashboard.ExpressionDialogModel;y=new BoldBIDashboard.Dashboard.ExpressionHelper;f.FunctionUI={Selected:BoldBIDashboard.Dashboard.FieldName.All,State:0};f.Datasource=y.getMultipleData();f=t.beforeExpressionDialogOpen(f,"function");var a=f.Datasource,p=[],w=[];if(a.length>1){for(o=[],e=0;e<a.length;e++)o=o.concat(a[e].Value);for(o.sort(function(n,t){return n.ID>t.Name?1:t.Name>n.ID?-1:0}),h=0;h<o.length;h++)w.indexOf(o[h].ID)===-1&&(w.push(o[h].ID),p.push(o[h]));f.Datasource.unshift({ID:0,Name:BoldBIDashboard.Dashboard.FieldName.All,Value:p})}if(this.ejFunctionDropdown.setModel({fields:{id:"ID",text:"Name",value:"Value"},dataSource:f.Datasource,enabled:f.FunctionUI.State===BoldBIDashboard.Dashboard.State.Enable}),this.ejFunctionDropdown.selectItemByText(f.FunctionUI.Selected),s=new BoldBIDashboard.Dashboard.ExpressionDialogModel,b=new BoldBIDashboard.Dashboard.ExpressionHelper,s.FunctionUI={Selected:BoldBIDashboard.Dashboard.FieldName.All,State:0},k=BoldBIDashboard.Dashboard.ConnectionHelper.isHierarchicalConnection(t),v=k?BoldBIDashboard.DashboardUtil.getFieldUsingTableType(this.callBackModel.optionalArgs.tableType||this.fillFieldItems(this.dataset)):this.getFields(),this.updateDashboardParameters(v),s.Datasource=b.getMultipleColumnData(v),s=t.beforeExpressionDialogOpen(s,"column"),l=s.Datasource,c=[],l.length>1){for(e=0;e<l.length;e++)l[e].Name!=="Parameters"&&(c=c.concat(l[e].Value));c.sort(function(n,t){return n.ID>t.ID?1:t.ID>n.ID?-1:0});this.isVirtualScrollEnabled=c.length>100;s.Datasource.unshift({ID:0,Name:BoldBIDashboard.Dashboard.FieldName.All,Value:c})}u=this;setTimeout(function(n){u.isVirtualScrollEnabled?u.ejColumnList.setModel({allowVirtualScrolling:!0,virtualScrollMode:"continuous",itemRequestCount:100}):u.ejColumnList.option("allowVirtualScrolling",!1);u.ejColumnDropdown.setModel({fields:{id:"ID",text:"Name",value:"Value"},dataSource:n.Datasource,enabled:!0});u.ejColumnDropdown.selectItemByText(n.FunctionUI.Selected);u.queryExp.length>0?(u.populateExpressions(),u.expListClick(u.queryExp[0].name)):u.newExpression();var t=u.textBox.val();u.onListItemMouseUp({target:u.dashboardDesigner.element.find("#"+u.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(t))[0]});u.refreshListScroller()},100,s)},n.prototype.fillFieldItems=function(n){var i=this,t=[];return n.Fields.forEach(function(n){n.IsExpression||n.IsParameterField||t.push(i.ConvertDatasetToTabletype(n))}),t},n.prototype.ConvertDatasetToTabletype=function(n){return{DataType:n.TypeName,DefaultDataType:n.TypeName,IsExpression:n.IsExpression,IsAggregatedExpression:n.IsAggregatedExpression,ID:n.Id,Name:n.Name,ChildFields:n.ChildFields}},n.prototype.getFields=function(){return BoldBIDashboard.isNullOrUndefined(this.callBackModel.optionalArgs.tableType)?this.fillFieldItems(this.dataset):this.bbdesigner$.extend(!0,[],this.callBackModel.optionalArgs.tableType)},n.prototype.updateDashboardParameters=function(n){var r=this,e=this.bbdesigner$.extend(!0,{},this.dataset),u;e.Query.DashboardParameters=this.dataset.Query.DashboardParameters;var f=[],t=!1,i=null;return f.push(e),this.dashboardDesigner.rdlParser.rdlJsonObj.DataSets.forEach(function(n){n.Id!==f[0].Id&&f.push(r.bbdesigner$.extend(!0,{},n))}),u=this,f.forEach(function(f){BoldBIDashboard.isNullOrUndefined(f)||BoldBIDashboard.isNullOrUndefined(f.Query)||BoldBIDashboard.isNullOrUndefined(f.Query.DashboardParameters)||(t=f.Id===r.callBackModel.optionalArgs.datasourceInfo.Id,f.Query.DashboardParameters=t&&!BoldBIDashboard.isNullOrUndefined(u.queryDesigner)&&!BoldBIDashboard.isNullOrUndefined(u.queryDesigner.queryParamCollection)&&(u.queryDesigner.queryParamCollection.length!==0||u.isFromQueryDesigner)?u.queryDesigner.queryParamCollection:f.Query.DashboardParameters,i=f.Name,f.Query.DashboardParameters.forEach(function(u){var f=u.ParameterName,e=BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(DynamicParameterDataType,u.DataType),o,c,s,h;e=u.DataType===DynamicParameterDataType.Number?"integer":e;switch(u.Mode){case ParameterMode.Literal:o=u.LiteralModeInfo;c=!BoldBIDashboard.isNullOrUndefined(o.StartValue)&&!BoldBIDashboard.isNullOrUndefined(o.EndValue)||!BoldBIDashboard.isNullOrUndefined(o.RangeStartDate)&&!BoldBIDashboard.isNullOrUndefined(o.RangeEndDate)||!BoldBIDashboard.isNullOrUndefined(o.RelativeDateItems);c?(s=f+".START",h=f+".END",n.push(r.getParamItems(t?s:s+" ("+i+")",t?s:i+"."+s,e)),n.push(r.getParamItems(t?h:h+" ("+i+")",t?h:i+"."+h,e))):n.push(r.getParamItems(t?f:f+" ("+i+")",t?f:i+"."+f,e));break;case ParameterMode.List:n.push(r.getParamItems(t?f:f+" ("+i+")",t?f:i+"."+f,e))}r.addItemIntoFieldListWithIgnoreQuotesSyntax(u,t,i,n)}))}),n.push(this.getParamItems(this.locale.userParameter.fullName,"CURRENTUSER.FULLNAME","String"),this.getParamItems(this.locale.userParameter.email,"CURRENTUSER.EMAIL","String"),this.getParamItems(this.locale.userParameter.tenantURL,"CURRENT.SITEURL","String"),this.getParamItems(this.locale.defaultParameter.browserCulture,"CURRENT.BROWSERCULTURE","String")),this.dashboardDesigner.model.environment!==BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(BoldBIDashboard.Environment,BoldBIDashboard.Environment.cloud)&&n.push(this.getParamItems(this.locale.userParameter.siteIdentifier,"CURRENT.SITEIDENTIFIER","String")),n},n.prototype.addItemIntoFieldListWithIgnoreQuotesSyntax=function(n,t,i,r){var o,h,s,u,f,e;BoldBIDashboard.isNullOrUndefined(n)||(o=n.ParameterName,(n.DataType===DynamicParameterDataType.Date||n.DataType===DynamicParameterDataType.String)&&(h=n.Mode===ParameterMode.Literal&&n.LiteralModeInfo.SelectionType===SelectionType.Range,s=BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(DynamicParameterDataType,n.DataType),h?(u=o+".START.IGNOREQUOTES",f=o+".END.IGNOREQUOTES",r.push(this.getParamItems(t?u:u+" ("+i+")",t?u:i+"."+u,s)),r.push(this.getParamItems(t?f:f+" ("+i+")",t?f:i+"."+f,s))):(e=o+".IGNOREQUOTES",r.push(this.getParamItems(t?e:e+" ("+i+")",t?e:i+"."+e,s)))))},n.prototype.getParamItems=function(n,t,i){return{Name:n,Value:t,DataType:i,IsExpression:!1,IsDynamicParam:!0}},n.prototype.refreshListScroller=function(){var t=this.ejFunctionList,n;t.scrollerObj.model.scrollTop=0;n=this.ejColumnList;n.scrollerObj.model.scrollTop=0;this.ejFunctionList.refresh(!0);this.refreshColumnList()},n.prototype.refreshColumnList=function(){this.ejColumnList.model.allowVirtualScrolling&&(this.ejColumnList._oldStartValue=null,this.ejColumnList.model.totalItemsCount=0,this.ejColumnList.dummyUl=this.bbdesigner$());this.ejColumnList.refresh(!0)},n.prototype.confirmAction=function(n){if(n){var i=this.textBox.val(),t=(new BoldBIDashboard.DashboardDesignerUtility.ExpressionParsor).parseErrors(this.textArea.val(),this.provider);t&&t.length>0?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.failedToParseExp,IconType.errors,AlertType.Alert,!0,t[0]):this.isAvaliableNames(i)?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.InvalidExpressionName,this.locale.dataSource.expNameExist,IconType.warning,AlertType.Alert,!1,""):this.serverValidationExp({selectedExpression:this.expressionContainer.data("e-exp").name===""?this.textBox.val():this.expressionContainer.data("e-exp").name,name:this.textBox.val(),expression:this.textArea.val()},ExpAction.Close)}else this.ejExpDialog.close(),this.excuteExpQuery(),this.hideExpIndicator()},n.prototype.closeConfirmation=function(){var i=this.expressionContainer.data("e-exp"),n,t;i&&i.isEdit?(n=this.textBox.val(),t=this.textArea.val().trim(),n===this.nameWaterMark&&this.textBox.hasClass("bbi-designer-txtmark")&&(n=""),t===this.expWaterMark&&this.textArea.hasClass("bbi-designer-txtmark")&&(t=""),!this.hasExpChanges(i,t)||n&&n.length===0||t&&t.length===0||!this.isValidName(n)||!/^[a-zA-Z0-9- _]*$/.test(n)?(this.ejExpDialog.close(),this.excuteExpQuery(),this.hideExpIndicator()):this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.saveExpression,IconType.warning,AlertType.Confirm,!1,"",{height:140,width:500,method:"confirmAction",instance:this,dataInfo:{name:n}})):this.textArea.val()!=="Query Expression"&&this.textArea.val()!==""?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.SaveExpression,this.locale.dataSource.saveExpression,IconType.warning,AlertType.Confirm,!1,"",{height:140,width:500,method:"confirmAction",instance:this,dataInfo:{name:this.textBox.val()}}):(this.ejExpDialog.close(),this.excuteExpQuery(),this.hideExpIndicator())},n.prototype.closeExpDialog=function(n){n.isInteraction&&(this.bbdesigner$("#"+this.id+"_exp_designer_div_WaitingPopup").is(":visible")?(this.hideExpIndicator(),n.cancel=!1,this.excuteExpQuery()):(n.cancel=!0,this.closeConfirmation()))},n.prototype.closeExpression=function(){this.resetSearchBox();this.closeConfirmation()},n.prototype.excuteExpQuery=function(){BoldBIDashboard.DashboardUtil.isEqualObj(this.queryExp,this.tempExp)||BoldBIDashboard.DashboardUtil.invokeMethod(this.callBackModel.callBackInstance,this.callBackModel.callBackMethod,[{isWindowClose:!0,queryExp:this.queryExp}]);this.tempExp=[]},n.prototype.resetDesigner=function(n){n&&this.expLiTag.children().length>0&&(this.expLiTag.empty(),this.scrollerRefresh(this.bodyContainer));this.textBox.val("");this.textArea.val("");this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_desc_heading").text("");this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_example_heading").text("");this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_desc_content").text("");this.dashboardDesigner.element.find("#"+this.id+"_exp_designer_example_content").text("")},n.prototype.saveExpression=function(n){this.resetSearchBox();this.expressionContainer.data("e-exp")&&this.expressionContainer.data("e-exp").isEdit?n&&n.isSelectionChange?this.expressionValidation(ExpAction.Edit,n.isSelectionChange,n.name):this.expressionValidation(ExpAction.Edit):n&&n.isSelectionChange?this.expressionValidation(ExpAction.New,n.isSelectionChange,n.name):this.expressionValidation(ExpAction.New)},n.prototype.expressionValidation=function(n,t,i){var o=this.expressionContainer.data("e-exp"),u=this.textBox.val(),r=this.textArea.val().trim(),f,e;if(this.textArea.val(r),f=!1,u===this.nameWaterMark&&this.textBox.hasClass("bbi-designer-txtmark")&&(u=""),r===this.expWaterMark&&this.textArea.hasClass("bbi-designer-txtmark")&&(r=""),BoldBIDashboard.isNullOrUndefined(u)||u.length!==0?BoldBIDashboard.isNullOrUndefined(r)||r.length!==0?this.isValidName(u)?/^[a-zA-Z0-9- _]*$/.test(u)===!1?(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.InvalidExpressionName,this.locale.dataSource.expHasSpecialChar,IconType.warning,AlertType.Alert,!1,""),f=!0):r.indexOf("["+u+"]")!==-1?(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.expNotInColumn,IconType.errors,AlertType.Alert,!1,""),f=!0):this.isBalanceBrackets(r)?this.isAvaliableNames(u)?(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.InvalidExpressionName,this.locale.dataSource.expNameExist,IconType.warning,AlertType.Alert,!1,""),f=!0):(r.replace(new RegExp("s"),"").toUpperCase().indexOf("TOTAL(")>-1||this.rowExpression.some(function(n){return r.replace(new RegExp("s"),"").toUpperCase().indexOf(n+"(")>-1}))&&!this.isValidRunningExpression(r)?f=!0:o&&o.isEdit?(e=(new BoldBIDashboard.DashboardDesignerUtility.ExpressionParsor).parseErrors(r,this.provider),e&&e.length>0?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.InvalidParameter+"(s)",e[0],IconType.errors,AlertType.Alert,!1,""):this.serverValidationExp({selectedExpression:o.name,name:u,expression:r,isSelectionChange:t,selectedExp:i},n)):(e=(new BoldBIDashboard.DashboardDesignerUtility.ExpressionParsor).parseErrors(r,this.provider),e&&e.length>0?(this.isAdd=!1,this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.InvalidParameter+"(s)",this.locale.errorMessage.expressionParameterError,IconType.errors,AlertType.Alert,!0,e[0])):this.serverValidationExp({selectedExpression:"",name:u,expression:r,isSelectionChange:t,selectedExp:i},n)):(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.invalidExpSyntax,IconType.errors,AlertType.Alert,!1,""),f=!0):(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.expNameExist,IconType.warning,AlertType.Alert,!1,""),f=!0):(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.emptyExp,IconType.warning,AlertType.Alert,!1,""),f=!0):(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.InvalidExpressionName,this.locale.dataSource.emptyExpName,IconType.warning,AlertType.Alert,!1,""),f=!0),t&&f)this.onListItemMouseUp({target:this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(o.name))[0]})},n.prototype.isAvaliableNames=function(n){for(var r=this.expressionContainer.data("e-exp"),i=this.ejColumnDropdown.model.dataSource[0].Value,t=0;t<i.length;t++)if(i[t].Name.toLowerCase()===n.toLowerCase()&&r.name.toLowerCase()!==n.toLowerCase())return!0;return!1},n.prototype.isValidRunningExpression=function(n){for(var f,r,e,h,c,v,o,l,y,u=this,i=!0,t=n,a=this.ejColumnDropdown.model.dataSource[0].Value,s=0;s<a.length;s++)f=a[s].Name,t.indexOf("["+f+"]")>-1&&/^[a-zA-Z0-9- _]*$/.test(f)===!0&&(t=t.replace("["+f+"]",""));if(r=null,t.replace(new RegExp("s"),"").toUpperCase().indexOf("TOTAL(")>-1&&(r=t.replace("TOTAL","").toUpperCase().split("[+-*/]+"),r.forEach(function(n){u.rowExpression.some(function(t){return n.indexOf(t)>-1})&&(i=!1,u.dashboardDesigner.modules.util.alertDialog(u.locale.alertDialogTitle.queryExpression,u.locale.dataSource.errorMessageForTotalExpressionContainsRowExpression,IconType.warning,AlertType.Alert,!1,""))})),i){for(this.rowExpression.forEach(function(n){t.replace(new RegExp("s"),"").toUpperCase().indexOf(n+"(")>-1&&(r=t.toUpperCase().replace(n,"").split("[+-*/]+"))}),e=0,h=r;e<h.length;e++)for(c=h[e],i=!1,v=!isNaN(parseInt(c.replace("(","").replace(")",""),10)),o=0,l=this.aggregationList.filter(function(n){return n!=="TOTAL"||n!=="RUNNINGSUM"||n!=="RUNNINGAVG"||n!=="RUNNINGCOUNT"||n!=="RUNNINGMAX"||n!=="RUNNINGMIN"});o<l.length;o++)if(y=l[o],c.toString().replace(new RegExp("s"),"").toUpperCase().indexOf(y)>-1||v){i=!0;break}i||this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.parameterMustBeAnAggregated,IconType.warning,AlertType.Alert,!1,"")}return i},n.prototype.isBalanceBrackets=function(n){for(var i=0,r=!1,t=0;t<n.length;t++){if(r||n[t]!=="("?r||n[t]!==")"||i--:i++,i<0)return!1;n[t]==="'"&&(t===0||n[t-1]!=="\\")&&(r=!r)}return i>0?!1:!0},n.prototype.UpdateMiscellaneousList=function(){for(var r,u,t=this.ejColumnDropdown.model.dataSource[0].Value,i=this.ejColumnDropdown.model.dataSource[this.ejColumnDropdown.model.dataSource.length-1].Value,e=i.length,f=!1,o=function(n){var r=t.indexOf(t.filter(function(t){return t.Name===i[n].Name})[0]);r>-1&&t.splice(r,1)},n=0;n<e;n++)o(n);for(n=0;n<e;n++)i.pop();for(n=0;n<this.queryExp.length;n++){for(r={ID:t.length+n,Name:this.queryExp[n].name,Value:this.queryExp[n].expression,DataType:null},f=!1,u=0;u<t.length;u++)if(t[u].Name===r.Name){f=!0;break}f||t.push(r);i.push(r)}this.ejColumnDropdown.model.dataSource[0].Value=t;this.ejColumnDropdown.model.dataSource[this.ejColumnDropdown.model.dataSource.length-1].Value=i;this.refreshColumnList()},n.prototype.encrptDataSourceInfo=function(n){var t=this.bbdesigner$.extend(!0,{},n);return t.ConnectionProperties&&(t.ConnectionProperties.ConnectString=BoldBIDashboard.DashboardUtil.encryptData(t.ConnectionProperties.ConnectString),t.ConnectionProperties.UserName&&(t.ConnectionProperties.UserName=BoldBIDashboard.DashboardUtil.encryptData(t.ConnectionProperties.UserName)),t.ConnectionProperties.PassWord&&(t.ConnectionProperties.PassWord=BoldBIDashboard.DashboardUtil.encryptData(t.ConnectionProperties.PassWord))),t},n.prototype.serverValidationExp=function(n,t){var i=this.dataset.Name,r=this.dataset.Id,u=this.callBackModel.optionalArgs.isEdit,f=this.encrptDataSourceInfo(this.callBackModel.optionalArgs.datasourceInfo);this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.executeQuery,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.DataDesignViewAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.executeQuery,datasource:f,commandType:CommandMode.Text,dataSetName:i,dataSetId:r,ExpAction:t,isExpression:!0,selectedExpression:n.selectedExpression,Expression:n.name,DisplayText:n.expression,isEdit:u,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.expActionResult,this,{expression:n,action:t}),indicator:[this.bbdesigner$.proxy(this.showExpIndicator,this),this.bbdesigner$.proxy(this.hideExpIndicator,this)]},!0)},n.prototype.expActionResult=function(n,t){var h,u,r,f,o,c,s,e,i;if(t.Error){if(this.enableButton(this.saveBtnTag,!0),this.enableButton(this.addBtnTag,!1),BoldBIDashboard.isNullOrUndefined(t.StatusMessage)?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.InvalidParameter+"(s)",this.locale.errorMessage.expressionParameterError,IconType.errors,AlertType.Alert,!1,""):this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.InvalidParameter+"(s)",this.locale.errorMessage.expressionParameterError,IconType.errors,AlertType.Alert,!0,t.StatusMessage),n.expression.isSelectionChange)this.onListItemMouseUp({target:this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(this.textBox.val()))[0]})}else if(this.ejExpDialog.isOpen()&&t&&t.type)if(h=JSON.parse(t.type),u=this.expressionContainer.data("e-exp"),h.length>0){if(r=n.expression.name,f=n.expression.expression,n.action===ExpAction.New){if(o=!0,this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(r)).length===0)c=this.getEmptyExp(),this.updateExpList(c,r);else{for(s=!0,i=0;i<this.queryExp.length;i++)if(this.queryExp[i].name===r){s=!1;break}s||(o=!1,this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryExpression,this.locale.dataSource.expNameExist,IconType.warning,AlertType.Alert,!1,""))}if(o){if(this.queryExp.push({name:r,expression:f}),this.expressionContainer.data("e-exp",{isEdit:!0,name:r,expression:f}),this.enableButton(this.saveBtnTag,!1),this.isAdd){this.switchEditExp();e=this.textBox.val();this.onListItemMouseUp({target:this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(e))[0]});this.isAdd=!1}if(n.expression.isSelectionChange){this.expListClick(n.expression.selectedExp);e=this.textBox.val();this.onListItemMouseUp({target:this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(e))[0]})}}}else if(n.action===ExpAction.Edit){for(i=0;i<this.queryExp.length;i++)this.queryExp[i].expression.indexOf("["+u.name+"]")!==-1&&(this.queryExp[i].expression=this.queryExp[i].expression.replace("["+u.name+"]","["+r+"]"));for(i=0;i<this.queryExp.length;i++)if(this.queryExp[i].name===u.name){if(this.queryExp[i].name=r,this.queryExp[i].expression=f,BoldBIDashboard.isNullOrUndefined(this.queryDesigner)||BoldBIDashboard.isNullOrUndefined(this.queryDesigner.Query)||(this.queryDesigner.Query.QueryDesignerState.Expressions[i].Name=r,this.queryDesigner.Query.QueryDesignerState.Expressions[i].QueryExp=f,this.queryDesigner.dataset.Query.QueryDesignerState.Expressions[i].Name=r,this.queryDesigner.dataset.Query.QueryDesignerState.Expressions[i].QueryExp=f,this.queryDesigner.queryExp[i].name=r,this.queryDesigner.queryExp[i].expression=f,this.queryDesigner.dataset.dataset.Query.QueryDesignerState.Expressions[i].Name=r,this.queryDesigner.dataset.dataset.Query.QueryDesignerState.Expressions[i].QueryExp=f,this.queryDesigner.dataset.queryExp[i].name=r,this.queryDesigner.dataset.queryExp[i].expression=f),this.queryExp[i].name!==u.name&&this.updateExpList(u.name,r),this.expressionContainer.data("e-exp",{isEdit:!0,name:this.queryExp[i].name,expression:this.queryExp[i].expression}),this.enableButton(this.saveBtnTag,!1),n.expression.isSelectionChange){this.expListClick(n.expression.selectedExp);e=this.textBox.val();this.onListItemMouseUp({target:this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(e))[0]})}break}}else if(n.action===ExpAction.Save){for(i=0;i<this.queryExp.length;i++)if(this.queryExp[i].name===u.name){this.queryExp[i].name=r;this.queryExp[i].expression=f;this.queryExp[i].name!==u.name&&this.updateExpList(u.name,r);this.enableButton(this.saveBtnTag,!1);this.switchEditExp();e=this.textBox.val();this.onListItemMouseUp({target:this.dashboardDesigner.element.find("#"+this.id+"_li_"+BoldBIDashboard.DashboardUtil.escapeSelector(e))[0]});break}}else if(n.action===ExpAction.Close){for(u.name===""&&this.queryExp.push({name:this.textBox.val(),expression:this.textArea.val()}),i=0;i<this.queryExp.length;i++)if(this.queryExp[i].name===u.name){this.queryExp[i].name=r;this.queryExp[i].expression=f;this.queryExp[i].name!==u.name&&this.updateExpList(u.name,r);break}this.ejExpDialog.close();this.hideExpIndicator();this.excuteExpQuery()}else n.action===ExpAction.Remove&&(this.queryExp.length===0?this.enableButton(this.addBtnTag,!1):this.enableButton(this.addBtnTag,!0));this.UpdateMiscellaneousList();(n.action===ExpAction.New||n.action===ExpAction.Save||n.action===ExpAction.Edit)&&this.updateSuccessMessage()}else this.enableButton(this.saveBtnTag,!0)},n.prototype.updateSuccessMessage=function(){var n=this;this.dashboardDesigner.element.find("#"+this.id+"_exp_success_message_wrap").css("display","block");setTimeout(function(){n.dashboardDesigner.element.find("#"+n.id+"_exp_success_message_wrap").css("display","none")},3e3)},n.prototype.showExpIndicator=function(){BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.children("#"+this.id+"_exp_designer_add_btn"),!1);BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.children("#"+this.id+"_exp_designer_save_btn"),!1);BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.children("#"+this.id+"_exp_designer_close_btn"),!1);this.ejIndicator.show()},n.prototype.hideExpIndicator=function(){BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.children("#"+this.id+"_exp_designer_add_btn"),!0);BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.children("#"+this.id+"_exp_designer_save_btn"),!1);BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.children("#"+this.id+"_exp_designer_close_btn"),!0);this.ejIndicator.hide()},n.prototype.destroy=function(){this.unWiredEvents();BoldBIDashboard.DashboardUtil.destroyEjObjects(this.dashboardDesigner.element.find("#"+this.id+"_exp_designer"));this.dashboardDesigner.element.find("#"+this.id+"_exp_designer").length>0&&this.dashboardDesigner.element.find("#"+this.id+"_exp_designer").remove()},n}(),ExpAction,InternalDataSample,InternalThresHold,InternalEditConnection,InternalEditorManager,InternalRangeExtractor,ExecCommand,InternalAppendDatasource,DataMode,InternalDateRangePopup,DateFormatOption,InternalExpressionParsor,InternalColumnMapping,SortType,filterOptions,CheckList,Mapping,InternalQueryFilter,QueryOperator,QueryDatatype,MeasureFilterCondition,DimensionFilterCondition,InternalQueryJoiner,InternalQueryParameter,InternalSharedDataSet,InternalToolbar,InternalCredentialDialog,ConfigurationPanel,InternalDropDownTreeview,InternalSortDialog,CustomSortType,InternalSqlEditor,SqlEditorUndoManager,InternalStoreParameter,ParameterDataInfo,OAuthProvider,InternalOAuthLoginHelper,InternalRangeFilterDialog,InternalRelativeDateFilter,InternalRelativeDates,InternalSharedDSMenu,InternalProgressIndicator,InternalReplaceValues,__extends,BoldBIDashboard;window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.QueryExpression",InternalQueryExpression,window),function(n){n[n.New=0]="New";n[n.Edit=1]="Edit";n[n.Save=2]="Save";n[n.Close=3]="Close";n[n.Remove=4]="Remove"}(ExpAction||(ExpAction={}));InternalDataSample=function(){function n(n){this.id=null;this.locale=null;this.dataSampleDialog=null;this.dataSampleContainer=null;this.footerTag=null;this.dataSampling=!1;this.dataLimitTextBox=null;this.dataLimitValue=null;this.dataSamplingCheckBox=null;this.dashboardDesigner=n;this.bbdesigner$=n.bbdesigner$;this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.locale=n.getLocalizationContent();this.id=this.queryDesigner.id;this.dataSourceLocale=this.locale.dataSource;this.renderDataSampling();this.wireEvents()}return n.prototype.openDataSampleWindow=function(){var n=this.dataSampleDialog.data("BoldBIDashboardDialog"),t=this.dashboardDesigner.element.find("#"+this.id+"_data_limit_ok");this.dataLimitTextBox=this.dataSampleContainer.find("#"+this.id+"_datalimit_textbox");!BoldBIDashboard.isNullOrUndefined(this.dataSampling)&&this.dataSampling?BoldBIDashboard.isNullOrUndefined(this.dataLimitValue)?(this.dataLimitTextBox.data("ejNumericTextbox").setModel({value:"100000"}),this.dataLimitValue="100000"):(this.dataLimitTextBox.data("ejNumericTextbox").setModel({value:this.dataLimitValue}),this.dataSamplingCheckBox.BoldBIDashboardCheckBox({checked:this.dataSampling}),this.dataLimitTextBox.data("ejNumericTextbox").enable(),t.removeAttr("disabled")):(this.dataSamplingCheckBox.BoldBIDashboardCheckBox({checked:this.dataSampling}),this.textBoxObj=this.dataLimitTextBox.data("ejNumericTextbox"),this.textBoxObj.disable());BoldBIDashboard.isNullOrUndefined(n)||n.open()},n.prototype.renderDataSampling=function(){var t=this.dataSampleDialog=BoldBIDashboard.buildTag("div.e-data-sample-dlg","",{},{id:this.id+"_data_sample_dialog"}),n=this.dataSampleContainer=BoldBIDashboard.buildTag("div.e-dbrd-data-sample-container","",{},{id:this.id+"_data_sample_container"}),i=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.dialogOptions.okButtonText,{float:"right"},{id:this.id+"_data_limit_ok",type:"button"}),r=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_data_limit_cancel",type:"button"});this.DataLimitContainer();n.append(this.dataSampleContainer);t.append(n);this.bbdesigner$(this.dashboardDesigner.element).append(this.dataSampleDialog);this.dataSampleDialog.BoldBIDashboardDialog({title:"Data Sampling",width:"auto",height:"auto",minWidth:335,minHeight:220,enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),containment:"#"+this.id,target:"#"+this.id,closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.footerTag=this.dashboardDesigner.element.find("#"+this.id+"_data_sample_dialog_foot");this.footerTag.append(r,i)},n.prototype.DataLimitContainer=function(){var r=this.locale.dataSource,u=BoldBIDashboard.buildTag("div.bbi-dbrd-data-limit-row-container","",{"padding-top":"0px","padding-bottom":"60px"},{id:this.id+"_data_limit_div"}),f=BoldBIDashboard.buildTag("tr","",{},{id:this.id+"div.bbi-dbrd-data-sampling-row-container"}),e=BoldBIDashboard.buildTag("div.bbi-dbrd-data-sampling-label-container","",{},{id:this.id+"_data_sampling_div"}),o=BoldBIDashboard.buildTag("span.bbi-dbrd-info-icon","",{display:"block","padding-left":"110px",cursor:"pointer",position:"absolute","margin-top":"37px"},{}),s,n,t,h;o.BoldBIDashboardTooltip({content:"<span>"+this.dataSourceLocale.dataSamplingMessage+"<\/span>",cssClass:"bbi-defaultIndex-template",isBalloon:!0,collision:BoldBIDashboard.Tooltip.Collision.FlipFit,trigger:BoldBIDashboard.Tooltip.Trigger.Hover,showRoundedCorner:!0,showShadow:!0});s=BoldBIDashboard.buildTag("label.bbi-dbrd-data-sampling-label",r.dataSampling,{"padding-left":"15px","font-weight":"bold","padding-top":"10px"},{id:this.id+"_data_sample_data_sampling_label"});this.dataSamplingCheckBox=BoldBIDashboard.buildTag("input","",{height:"15px",width:"20px"},{id:this.id+"_datasampling_checkbox",type:"checkbox"});n=BoldBIDashboard.buildTag("td","",{width:"60%",position:"absolute",padding:"30px 0px","margin-top":"5px","margin-left":"161px"},{});f.append(e).append(n);e.append(s,o);n.append(this.dataSamplingCheckBox);t=BoldBIDashboard.buildTag("div.bbi-dbrd-data-limit-value-label-container","",{},{id:this.id+"_data_limit_div"});h=BoldBIDashboard.buildTag("label.bbi-dbrd-data-limit-value-label",r.dataLimit,{"padding-left":"3px"},{id:this.id+"_data_sample_datalimit_label"});t.append(h);var c=BoldBIDashboard.buildTag("div.bbi-dbrd-data-limit-value-text-box-container","",{},{id:this.id+"_data_sample_datalimit_div"}),l=BoldBIDashboard.buildTag("td","",{"padding-top":"21px"},{}),i=BoldBIDashboard.buildTag("input.e-textbox","",{},{id:this.id+"_datalimit_textbox",type:"text",value:"100000"});l.append(i);i.ejNumericTextbox({showSpinButton:!1,decimalPlaces:0,minValue:1,width:"160px",height:"30px",showRoundedCorner:!0,cssClass:"e-dbrd-datalimit_textbox",change:this.bbdesigner$.proxy(this.validateDataLimit,this)});c.append(l);u.append(t).append(c);i.bind("focusout",this.bbdesigner$.proxy(this.validate,this));this.dataSampleContainer.append(f).append(u);this.dataSamplingCheckBox.BoldBIDashboardCheckBox({width:"100%",change:this.bbdesigner$.proxy(this.updateDataSamplingCheck,this)})},n.prototype.updateDataSamplingCheck=function(n){this.updateDataSampleItemState(n.isChecked);this.dataSampling=n.isChecked},n.prototype.updateDataSampleItemState=function(n){var t=this.dashboardDesigner.element.find("#"+this.id+"_data_limit_ok");n?(this.dataLimitTextBox.data("ejNumericTextbox").enable(),t.removeAttr("disabled")):(this.dataLimitTextBox.data("ejNumericTextbox").setModel({value:"100000"}),this.textBoxObj=this.dataLimitTextBox.data("ejNumericTextbox"),this.textBoxObj.disable())},n.prototype.validateDataLimit=function(n){var t=this.dashboardDesigner.element.find("#"+this.id+"_data_limit_ok");!BoldBIDashboard.isNullOrUndefined(n)&&n.isInteraction&&BoldBIDashboard.isNullOrUndefined(n.value)&&t.attr("disabled","disabled");BoldBIDashboard.isNullOrUndefined(n)||!n.isInteraction||BoldBIDashboard.isNullOrUndefined(n.value)||t.removeAttr("disabled")},n.prototype.validate=function(){var n=this.dataSampleContainer.find("#"+this.id+"_datalimit_textbox");BoldBIDashboard.isNullOrUndefined(n)&&n.data("ejNumericTextbox").setModel({value:"100000"})},n.prototype.closeDataSample=function(){var n=this.dataSampleDialog.data("BoldBIDashboardDialog");BoldBIDashboard.isNullOrUndefined(n)||n.close()},n.prototype.okButtonClickEvent=function(){this.validate(this);var t=this.dataSampleContainer.find("#"+this.id+"_datalimit_textbox"),n=this.dataSampleContainer.find("#"+this.id+"_datalimit_textbox").val();t.data("ejNumericTextbox").setModel({value:n});this.queryDesigner.updateDataSampleModelInfo(this.dataSampling,n);this.dataLimitValue=n;this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.editDataSetName,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.DataDesignViewAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.GetDataLimit,dataSetId:this.queryDesigner.dataset.Id,dataSetName:this.queryDesigner.dataset.Name,dataSampling:this.dataSampling,datalimit:this.dataLimitValue,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{});this.dataSampleDialog.data("BoldBIDashboardDialog").close();this.queryDesigner.executeUIQuery()},n.prototype.wireEvents=function(){this.dashboardDesigner.element.on("click","#"+this.id+"_data_limit_ok",this.bbdesigner$.proxy(this.okButtonClickEvent,this));this.dashboardDesigner.element.on("click","#"+this.id+"_data_limit_cancel",this.bbdesigner$.proxy(this.closeDataSample,this))},n.prototype.unWireEvents=function(){this.dashboardDesigner.element.off("click","#"+this.id+"_data_limit_ok",this.bbdesigner$.proxy(this.okButtonClickEvent,this));this.dashboardDesigner.element.off("click","#"+this.id+"_data_limit_cancel",this.bbdesigner$.proxy(this.closeDataSample,this))},n.prototype.destroy=function(){this.unWireEvents()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.DataSample",InternalDataSample,window);InternalThresHold=function(){function n(n){this.id=null;this.locale=null;this.thresHoldDialog=null;this.thresHoldContainer=null;this.footerTag=null;this.thresHold=!0;this.dataLimitTextBox=null;this.thresHoldDataLimitValue=null;this.thresHoldCheckBox=null;this.dashboardDesigner=n;this.bbdesigner$=n.bbdesigner$;this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.locale=n.getLocalizationContent();this.id=this.queryDesigner.id;this.dataSourceLocale=this.locale.dataSource;this.renderThresHold();this.wireEvents()}return n.prototype.openThresHoldWindow=function(){var n=this.thresHoldDialog.data("BoldBIDashboardDialog"),t=this.dashboardDesigner.element.find("#"+this.id+"_threshold_data_limit_ok");this.dataLimitTextBox=this.thresHoldContainer.find("#"+this.id+"_threshold_datalimit_textbox");!BoldBIDashboard.isNullOrUndefined(this.thresHold)&&this.thresHold?BoldBIDashboard.isNullOrUndefined(this.thresHoldDataLimitValue)?(!BoldBIDashboard.isNullOrUndefined(this.thresHold)&&this.thresHold&&this.thresHoldCheckBox.BoldBIDashboardCheckBox({checked:this.thresHold}),this.dataLimitTextBox.data("ejNumericTextbox").setModel({value:"5000"}),this.thresHoldDataLimitValue="5000"):(this.dataLimitTextBox.data("ejNumericTextbox").setModel({value:this.thresHoldDataLimitValue}),this.thresHoldCheckBox.BoldBIDashboardCheckBox({checked:this.thresHold}),this.dataLimitTextBox.data("ejNumericTextbox").enable(),t.removeAttr("disabled")):(this.thresHoldCheckBox.BoldBIDashboardCheckBox({checked:this.thresHold}),this.textBoxObj=this.dataLimitTextBox.data("ejNumericTextbox"),this.textBoxObj.disable());BoldBIDashboard.isNullOrUndefined(n)||n.open()},n.prototype.renderThresHold=function(){var t=this.thresHoldDialog=BoldBIDashboard.buildTag("div.e-data-sample-dlg","",{},{id:this.id+"_threshold_dialog"}),n=this.thresHoldContainer=BoldBIDashboard.buildTag("div.e-dbrd-data-sample-container","",{},{id:this.id+"_threshold_container"}),i=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.dialogOptions.okButtonText,{float:"right"},{id:this.id+"_threshold_data_limit_ok",type:"button"}),r=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_threshold_data_limit_cancel",type:"button"});this.DataLimitContainer();n.append(this.thresHoldContainer);t.append(n);this.bbdesigner$(this.dashboardDesigner.element).append(this.thresHoldDialog);this.thresHoldDialog.BoldBIDashboardDialog({title:"Threshold module",width:"auto",height:"auto",minWidth:335,minHeight:220,enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),containment:"#"+this.id,target:"#"+this.id,closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.footerTag=this.dashboardDesigner.element.find("#"+this.id+"_threshold_dialog_foot");this.footerTag.append(r,i)},n.prototype.DataLimitContainer=function(){var r=this.locale.dataSource,u=BoldBIDashboard.buildTag("div.bbi-dbrd-threshold-data-limit-row-container","",{"padding-top":"0px","padding-bottom":"60px"},{id:this.id+"threshold_data_limit_div"}),f=BoldBIDashboard.buildTag("tr","",{},{id:this.id+"div.bbi-dbrd-data-sampling-row-container"}),e=BoldBIDashboard.buildTag("div.bbi-dbrd-threshold-label-container","",{},{id:this.id+"_threshold_div"}),o=BoldBIDashboard.buildTag("span.bbi-dbrd-info-icon","",{display:"block","padding-left":"110px",cursor:"pointer",position:"absolute","margin-top":"37px"},{}),s,n,t,h;o.BoldBIDashboardTooltip({content:"<span>"+this.dataSourceLocale.thresHoldMessage+"<\/span>",cssClass:"bbi-defaultIndex-template",isBalloon:!0,collision:BoldBIDashboard.Tooltip.Collision.FlipFit,trigger:BoldBIDashboard.Tooltip.Trigger.Hover,showRoundedCorner:!0,showShadow:!0});s=BoldBIDashboard.buildTag("label.bbi-dbrd-threshold-label",r.thresHold,{"padding-left":"15px","font-weight":"bold","padding-top":"10px"},{id:this.id+"_threshold_label"});this.thresHoldCheckBox=BoldBIDashboard.buildTag("input","",{height:"15px",width:"20px"},{id:this.id+"_threshold_checkbox",type:"checkbox"});n=BoldBIDashboard.buildTag("td","",{width:"60%",position:"absolute",padding:"30px 0px","margin-top":"5px","margin-left":"161px"},{});f.append(e).append(n);e.append(s,o);n.append(this.thresHoldCheckBox);t=BoldBIDashboard.buildTag("div.bbi-dbrd-threshold-limit-value-label-container","",{},{id:this.id+"threshold_data_limit_div"});h=BoldBIDashboard.buildTag("label.bbi-dbrd-threshold-limit-value-label",r.thresHoldLimit,{"padding-left":"3px"},{id:this.id+"_threshold_datalimit_label"});t.append(h);var c=BoldBIDashboard.buildTag("div.bbi-dbrd-threshold-limit-value-text-box-container","",{},{id:this.id+"_threshold_datalimit_div"}),l=BoldBIDashboard.buildTag("td","",{"padding-top":"21px"},{}),i=BoldBIDashboard.buildTag("input.e-textbox","",{},{id:this.id+"_threshold_datalimit_textbox",type:"text",value:"5000"});l.append(i);i.ejNumericTextbox({showSpinButton:!1,decimalPlaces:0,minValue:1,width:"160px",height:"30px",showRoundedCorner:!0,cssClass:"e-dbrd-datalimit_textbox",change:this.bbdesigner$.proxy(this.validateDataLimit,this)});c.append(l);u.append(t).append(c);i.bind("focusout",this.bbdesigner$.proxy(this.validate,this));this.thresHoldContainer.append(f).append(u);this.thresHoldCheckBox.BoldBIDashboardCheckBox({width:"100%",change:this.bbdesigner$.proxy(this.updatethresHoldCheck,this)})},n.prototype.updatethresHoldCheck=function(n){this.updatethresHoldItemState(n.isChecked);this.thresHold=n.isChecked},n.prototype.updatethresHoldItemState=function(n){var t=this.dashboardDesigner.element.find("#"+this.id+"_threshold_data_limit_ok");n?(this.dataLimitTextBox.data("ejNumericTextbox").enable(),t.removeAttr("disabled")):(this.dataLimitTextBox.data("ejNumericTextbox").setModel({value:"5000"}),this.textBoxObj=this.dataLimitTextBox.data("ejNumericTextbox"),this.textBoxObj.disable())},n.prototype.validateDataLimit=function(n){var t=this.dashboardDesigner.element.find("#"+this.id+"_threshold_data_limit_ok");!BoldBIDashboard.isNullOrUndefined(n)&&n.isInteraction&&BoldBIDashboard.isNullOrUndefined(n.value)&&t.attr("disabled","disabled");BoldBIDashboard.isNullOrUndefined(n)||!n.isInteraction||BoldBIDashboard.isNullOrUndefined(n.value)||t.removeAttr("disabled")},n.prototype.validate=function(){var n=this.thresHoldContainer.find("#"+this.id+"_threshold_datalimit_textbox");BoldBIDashboard.isNullOrUndefined(n)&&n.data("ejNumericTextbox").setModel({value:"5000"})},n.prototype.closeDataSample=function(){var n=this.thresHoldDialog.data("BoldBIDashboardDialog");BoldBIDashboard.isNullOrUndefined(n)||n.close()},n.prototype.okButtonClickEvent=function(){this.validate(this);var t=this.thresHoldContainer.find("#"+this.id+"_threshold_datalimit_textbox"),n=this.thresHoldContainer.find("#"+this.id+"_threshold_datalimit_textbox").val();this.queryDesigner.updateThresholdModelInfo(this.thresHold,n);t.data("ejNumericTextbox").setModel({value:n});this.thresHoldDataLimitValue=n;this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.editDataSetName,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.DataDesignViewAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.GetThresHoldLimit,dataSetId:this.queryDesigner.dataset.Id,dataSetName:this.queryDesigner.dataset.Name,thresHold:this.thresHold,thresHoldDatalimit:this.thresHoldDataLimitValue,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{});this.thresHoldDialog.data("BoldBIDashboardDialog").close()},n.prototype.wireEvents=function(){this.dashboardDesigner.element.on("click","#"+this.id+"_threshold_data_limit_ok",this.bbdesigner$.proxy(this.okButtonClickEvent,this));this.dashboardDesigner.element.on("click","#"+this.id+"_threshold_data_limit_cancel",this.bbdesigner$.proxy(this.closeDataSample,this))},n.prototype.unWireEvents=function(){this.dashboardDesigner.element.off("click","#"+this.id+"_threshold_data_limit_ok",this.bbdesigner$.proxy(this.okButtonClickEvent,this));this.dashboardDesigner.element.off("click","#"+this.id+"_threshold_data_limit_cancel",this.bbdesigner$.proxy(this.closeDataSample,this))},n.prototype.destroy=function(){this.unWireEvents()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.ThresHold",InternalThresHold,window);InternalEditConnection=function(){function n(n){this.id=null;this.divEditor=null;this.reconnectBtnTag=null;this.updateBtnTag=null;this.updateIconTooltip=null;this.updateButtonTag=null;this.footerTag=null;this.dsNameTextBoxVal=null;this.dsDescriptionTextBoxVal=null;this.ejConTypeDrpdwn=null;this.closeBtnTag=null;this.ejIndicator=null;this.targetElement=null;this.editContainer=null;this.conTypeRow=null;this.divContainer=null;this.closeBtn=null;this.titleConfig=null;this.tableDialog=null;this.selectedOAuthConnection=null;this.schemaDetails=null;this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.locale=n.getLocalizationContent();this.id=this.queryDesigner.id;this.datasource=this.dashboardDesigner.modules.dataSource;this.dataSourceLocale=this.locale.dataSource;this.renderEditConnection()}return n.prototype.renderEditConnection=function(){var h=this.dashboardDesigner.modules.util.getHeightBasedOnResolution("web"),i,n,f,r,t,e,o,u,s;this.divEditor=BoldBIDashboard.buildTag("div.bbi-userselect","",{width:480,height:"auto"},{id:this.id+"_edit_connnection_dialog"});this.divContainer=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","",{},{id:this.id+"_scroller_edit_connnection_container"});i=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_edit_connnectiondialog"});this.editContainer=BoldBIDashboard.buildTag("div","",{},{});i.append(this.editContainer);n=BoldBIDashboard.buildTag("table.bbi-querydesigner-edit-connection-table","",{},{unselectable:"on",id:this.id+"_edit_connection_config","class":"bbi-designer-edit-connection"});this.titleConfig=BoldBIDashboard.buildTag("div","",{"text-align":"left"},{id:this.id+"_edit_datasource_Header","class":"bbi-dbrd-designer-webds-template-wrapper bbi-designer-title-config"});f=BoldBIDashboard.buildTag("div.bbi-designer-tile-content bbi-designer-datasource-description-maxchar",this.locale.saveDatasourceDialog.descriptionMaxLengthText,{display:"block"},{id:this.id+"_description_maxchar_exceed"});this.divEditor.append(this.divContainer);this.divContainer.append(i);this.editContainer.append(this.titleConfig);this.editContainer.append(n);this.datasource.renderTextBoxItem(this.locale.dataSource.datasourceNameLabelTxt,this.id+"_dbname",!1,n,429);this.datasource.renderTextArea(this.locale.dataSource.datasourceDescriptionLabelTxt,this.id+"_dbdescription",n);this.divEditor.find("#"+this.id+"_dbdescription").attr({maxlength:"1024",placeholder:this.locale.dataSource.datasourceDescriptionWaterMarkTxt});this.divEditor.find("#"+this.id+"_dbdescription").on("keyup",this.bbdesigner$.proxy(this.onDatasourceDescriptionTextBox,this));this.divEditor.find("#"+this.id+"_dbdescription_td").append(f).css("float","left");this.conTypeRow=BoldBIDashboard.buildTag("tr","",{},{id:this.id+"_connection_type"});r=BoldBIDashboard.buildTag("td","",{},{unselectable:"on"});this.conTypeRow.append(r);n.append(this.conTypeRow);t=BoldBIDashboard.buildTag("table","",{},{unselectable:"on"});r.append(t);e=this.datasource.getRowCaption("Connection type",this.id+"_connection_type");t.append(e);o=BoldBIDashboard.buildTag("tr","",{},{});u=BoldBIDashboard.buildTag("td","",{},{colspan:"2",id:this.id+"_connection_type_td"});t.append(o);t.append(u);this.ejConTypeDrpdwn=BoldBIDashboard.buildTag("input","",{},{id:this.id+"_connection_type",value:"",spellcheck:"false"});u.append(this.ejConTypeDrpdwn);this.ejConTypeDrpdwn.BoldBIDashboardDropDownList({width:"440px",fields:{value:"value",text:"text"},change:this.bbdesigner$.proxy(this.changedConnectionType,this),cssClass:"bbi-designer-ejwidgets bbi-designer-content-label bbi-dbrd-control",showRoundedCorner:!0});this.dashboardDesigner.element.append(this.divEditor);this.divEditor.BoldBIDashboardDialog({width:"auto",minWidth:"480px",title:this.locale.dataSource.alertboxHeaderEditConnectionText,beforeClose:this.bbdesigner$.proxy(this.closePopup,this),enableResize:!1,showOnInit:!1,showFooter:!0,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner",enableModal:!0,containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id,close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.ejIndicator=this.divEditor.BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()}).data("BoldBIDashboardWaitingPopup");this.reconnectBtnTag=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.editConnection.reconnect,{float:"right"},{id:this.id+"_btn_reconnect",type:"button"});this.updateBtnTag=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary bbi-dbrd-margin-left",this.locale.editConnection.update,{float:"left"},{id:this.id+"_btn_update",type:"button"});this.updateIconTooltip=BoldBIDashboard.buildTag("span.bbi-dbrd-info-icon bbi-dbrd-designer-hoverable","",{display:"visible","margin-top":"4px",position:"absolute"},{id:this.id+"_update_button_icon","data-tooltip":this.locale.editConnection.updateIconMsg});this.updateButtonTag=BoldBIDashboard.buildTag("div.updatebuttontag_parent","",{float:"left",display:"none"},{id:this.id+"_updatebtn_parent"});this.updateButtonTag.append(this.updateBtnTag);this.updateButtonTag.append(this.updateIconTooltip);this.closeBtnTag=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_btn_close",type:"button"});this.footerTag=this.dashboardDesigner.element.find("#"+this.id+"_edit_connnection_dialog_foot");this.footerTag.append(this.updateButtonTag,this.closeBtnTag,this.reconnectBtnTag);this.reconnectBtnTag.on("click",this.bbdesigner$.proxy(this.saveConnection,this,!0));this.closeBtnTag.on("click",this.bbdesigner$.proxy(this.closeDialog,this,!0));this.updateBtnTag.on("click",this.bbdesigner$.proxy(this.updateConnection,this,!0));this.divContainer.BoldBIDashboardScroller({height:h,scrollerSize:this.dashboardDesigner.scrollerSize.scrollSize,enableTouchScroll:!0,autoHide:!0,buttonSize:this.dashboardDesigner.scrollerSize.buttonSize});s=this.divEditor.find("#"+this.id+"_connection_type");s.css("display","none")},n.prototype.openEditConnectionWindow=function(n,t){var i,r,u,f;this.targetElement=this.renderConnectionDialog();this.filePickerDialog=null;i=BoldBIDashboard.Dashboard.ConnectionHelper.getConnectionInfoFromDSInfo(this.dashboardDesigner,n);this.connectionInst=BoldBIDashboard.Dashboard.ConnectionHelper.getConnectionInstance(this.dashboardDesigner,i,!0);BoldBIDashboard.isNullOrUndefined(this.connectionInst)?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.dashboardDesigner,"Unable to load the required connection module. Please contact Support",IconType.errors,AlertType.Alert,!1,""):(r=null,BoldBIDashboard.isNullOrUndefined(i.oAuthModel)||(r={isEdit:!1,provider:BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(OAuthProvider,i.oAuthModel.provider),service:i.oAuthModel.serviceId,serviceId:n.OAuthConnection.ServiceId}),i=this.connectionInst.updateConnectionIfRequired(n,i),this.connectionInst.edit(this.targetElement,i,n,r),this.footerTag.find("#"+this.id+"_file_alert_message").css("display",this.connectionInst.ShouldExtractData?"block":"none"),this.connectionInst.ShouldRenderInPanel&&(this.divEditor.data("BoldBIDashboardDialog").open(),u=this.dashboardDesigner.element.find("#"+this.id+"_dbname").attr("disabled","disabled"),this.dsNameTextBoxVal=u.val(t),this.dsDescriptionTextBoxVal=this.dashboardDesigner.element.find("#"+this.id+"_dbdescription").val(this.queryDesigner.dataset.Description),this.oldDsDescriptionText=this.descriptionText=this.queryDesigner.dataset.Description,this.updateDataSourceHeader(i,this.titleConfig),this.divContainer.data("BoldBIDashboardScroller").refresh(),this.closeBtn=this.divEditor.parents("#"+this.id+"_edit_connnection_dialog_wrapper").find("#"+this.id+"_edit_connnection_dialog_closebutton"),f=this.divEditor.find("#"+this.id+"_connection_type"),f.css("display","none")))},n.prototype.onDatasourceDescriptionTextBox=function(n){var t=this.bbdesigner$(n.currentTarget).attr("id");this.descriptionText=this.divEditor.find("#"+t).val().trim()},n.prototype.getIconforEditConnection=function(n){return n.connector.split("_")[0]!=="CustomWeb"||BoldBIDashboard.isNullOrUndefined(n.icon)||n.icon===""?"<span class='bbi-dbrd-designer-webds-template-header-icon "+n.cssClass+"'><\/span><label class='bbi-dbrd-designer-webds-template-header-label'>"+n.name+"<\/label>":"<span class='bbi-dbrd-designer-webds-template-header-icon "+n.cssClass+"' style= display:inline-block;margin-bottom:4px;border-radius:3px;background:url(data:image/png;base64,"+n.icon+")no-repeat;background-position:center;background-size:contain;height:40px;width:40px><\/span><label class='bbi-dbrd-designer-webds-template-header-label'>"+n.name+"<\/label>"},n.prototype.getHelpDocLink=function(n){var i=helpDocumentLink.filter(function(t){return t.name===n}),t;return i.length>0&&i[0]!==undefined?(t=this.dashboardDesigner.model.customBrandSettings.customDomain.trim(),this.dashboardDesigner.isHelpLinkHidden&&t!==""?(t=t.charAt(t.length-1)==="/"?t.substr(0,t.length-1):t,t+i[0].url):"https://redirect.boldbi.com/?id="+i[0].reDirectionId):""},n.prototype.getDataSourceHeaderTemplate=function(n){var t,i=this.getHelpDocLink(n.connector),r=this.getIconforEditConnection(n);return!BoldBIDashboard.isNullOrUndefined(i)&&!this.datasource.hideAPILink(n.itemType)?(t="<span class='bbi-dbrd-designer-webds-template-header-link' ><a class='bbi-dbrd-designer-webds-template-header-href' href='"+i+"' target='_blank'>"+n.name+" "+this.locale.dataSource.webDataSource.userGuideText+"<\/a><\/span>",r+t):r},n.prototype.updateDataSourceHeader=function(n,t){t.html(this.getDataSourceHeaderTemplate(n))},n.prototype.updateConnectionType=function(n){var i=[{value:"SQL",text:this.dataSourceLocale.dataSourceType.msSql},{value:"AzureSynapseAnalytics",text:this.dataSourceLocale.dataSourceType.azuresynapseanalytics},{value:"SSAS",text:this.dataSourceLocale.dataSourceType.ssas},{value:"MySQL",text:this.dataSourceLocale.dataSourceType.mySql},{value:"ODBC",text:this.dataSourceLocale.dataSourceType.odbc},{value:"MongoDB",text:this.dataSourceLocale.dataSourceType.mongodb},{value:"Presto",text:this.dataSourceLocale.dataSourceType.presto},{value:"AmazonAuroraMySQL",text:this.dataSourceLocale.dataSourceType.amazonAuroraMySQL},{value:"Google",text:this.dataSourceLocale.oauthConnectors.googleBigQuery},{value:"AmazonAuroraPostgreSQL",text:this.dataSourceLocale.dataSourceType.amazonAuroraPostgreSQL},{value:"GoogleCloudMySQL",text:this.dataSourceLocale.dataSourceType.googleCloudMySQL},{value:"GoogleCloudPostgreSQL",text:this.dataSourceLocale.dataSourceType.googleCloudPostgreSQL},{value:"MariaDB",text:this.dataSourceLocale.dataSourceType.mariadb},{value:"SingleStore",text:this.dataSourceLocale.dataSourceType.singlestore},{value:"CDATA",text:this.dataSourceLocale.dataSourceType.cdata},{value:"PostgreSQL",text:this.dataSourceLocale.dataSourceType.postgres},{value:"Redshift",text:this.dataSourceLocale.dataSourceType.redshift},{value:"AzureDevOps",text:this.dataSourceLocale.oauthConnectors.azuredevops},{value:"Snowflake",text:this.dataSourceLocale.dataSourceType.snowflake},],r=[{value:"File",text:this.dataSourceLocale.dataSourceType.file}],u=[{value:"WEB",text:this.dataSourceLocale.dataSourceType.webDataSource.toUpperCase()}],f=[{value:"Oracle",text:this.dataSourceLocale.dataSourceType.oracle}],e=[{value:"Google",text:this.dataSourceLocale.oauthConnectors.googleBigQuery}],t=this.ejConTypeDrpdwn.data("BoldBIDashboardDropDownList");this.ejConTypeDrpdwn.data("data-source",n);n.ConnectionProperties.DataProvider===this.dataSourceLocale.dataSourceType.googleBigQuery||n.ConnectionProperties.DataProvider===this.dataSourceLocale.dataSourceType.file||n.ConnectionProperties.DataProvider===this.dataSourceLocale.dataSourceType.webDataSource.toUpperCase()||n.ConnectionProperties.DataProvider.toLowerCase()===this.dataSourceLocale.oauthConnectors.azuredevops||n.ConnectionProperties.DataProvider===this.dataSourceLocale.dataSourceType.oracle?(t.option("enabled",!1),n.ProviderType!==""&&n.ConnectionProperties.DataProvider===this.dataSourceLocale.dataSourceType.webDataSource.toUpperCase()?this.conTypeRow.css("display","none"):this.conTypeRow.css("display","block"),t.selectedTextValue!==n.ConnectionProperties.DataProvider&&(n.ConnectionProperties.DataProvider===this.dataSourceLocale.dataSourceType.oracle?t.setModel({dataSource:f}):n.ConnectionProperties.DataProvider===this.dataSourceLocale.dataSourceType.googleBigQuery?(t.setModel({dataSource:e}),this.selectedOAuthConnection=n.OAuthConnection):(t.setModel({dataSource:n.ConnectionProperties.DataProvider===this.dataSourceLocale.dataSourceType.file?r:u}),this.selectedOAuthConnection=n.OAuthConnection),t.selectItemByValue(n.ConnectionProperties.DataProvider))):(t.setModel({dataSource:i}),t.selectItemByValue(n.ConnectionProperties.DataProvider),t.option("enabled",!0))},n.prototype.changedConnectionType=function(){var i,n,t;if(this.targetElement=this.renderConnectionDialog(),i=this.ejConTypeDrpdwn.data("data-source"),n=this.getConnectionObj(i),!BoldBIDashboard.isNullOrUndefined(n)&&(t=BoldBIDashboard.Dashboard.ConnectionHelper.getConnectionInstance(this.dashboardDesigner,n,!0),!BoldBIDashboard.isNullOrUndefined(t))){t.edit(this.targetElement,n,i);this.footerTag.find("#"+this.id+"_file_alert_message").css("display",t.ShouldExtractData?"block":"none");return}},n.prototype.saveConnection=function(){if(this.queryDesigner.codeViewQueryExecuter.css("display","none"),this.dsInfo=this.connectionInst.getDatasourceInfo(this.dsNameTextBoxVal.val(),this.dsDescriptionTextBoxVal.val(),null),this.queryDesigner.DatasourceInfo.Description=this.queryDesigner.dataset.Description=this.datasource.datasourceDescriptionText=this.descriptionText,this.dsInfo){this.dsInfo.Id=BoldBIDashboard.getGuid("Datasource_");var n=JSON.parse(JSON.stringify(this.dsInfo));n.DynamicConnectionStringInfo=null;this.connectionInst.ShouldExtractData?this.createHubConnectionCallForWebDS():this.connectionInst.LiveWithExtractMode&&!n.IsLiveWebMode?this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.testConnection,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.ConnectAndReconnectAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.testConnection,datasource:this.encryptPostBack(this.dsInfo),connectionInfo:n,dataSetId:this.queryDesigner.dataset.Id,isQueryDesignerMode:"true"})},{fnction:this.bbdesigner$.proxy(this.reconnectSqlExtractMode,this,!0),indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]}):!this.connectionInst.LiveWithExtractMode&&n.IsLiveWebMode?(this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.testConnection,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.ConnectAndReconnectAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.testConnection,datasource:this.encryptPostBack(this.dsInfo),connectionInfo:n,dataSetId:this.queryDesigner.dataset.Id,isQueryDesignerMode:"true"})},{indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]}),this.createHubConnectionCallForWebDS()):this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.ReconnectDatabase,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.ConnectAndReconnectAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.ReconnectDatabase,datasource:this.encryptPostBack(this.dsInfo),dataSetId:this.queryDesigner.dataset.Id,codeView:this.queryDesigner.isQueryEditorVisible(),queryEditorState:this.queryDesigner.isQueryEditorVisible(),connectionInfo:n,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.validateConnection,this),indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]})}},n.prototype.updateConnection=function(){if(this.queryDesigner.codeViewQueryExecuter.css("display","none"),this.dsInfo=this.connectionInst.getDatasourceInfo(this.dsNameTextBoxVal.val(),this.dsDescriptionTextBoxVal.val(),null),this.dsInfo){this.dsInfo.Id=BoldBIDashboard.getGuid("Datasource_");var n=JSON.parse(JSON.stringify(this.dsInfo));n.DynamicConnectionStringInfo=null;this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.updateParameters,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.ConnectAndReconnectAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.updateParameters,datasource:this.encryptPostBack(this.dsInfo),connectionInfo:n,dataSetId:this.queryDesigner.dataset.Id,isQueryDesignerMode:"true"})},{indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]})}},n.prototype.createHubConnectionCallForWebDS=function(){this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.validateconnection,{action:BoldBIDashboard.DashboardUtil.DesignerAction.testConnection,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.ConnectAndReconnectAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.testConnection,datasource:this.encryptPostBack(this.dsInfo),dataSetId:this.queryDesigner.dataset.Id,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.ajaxPolling,this),errfnction:this.bbdesigner$.proxy(this.hideIndicator,this),indicator:[this.bbdesigner$.proxy(this.showIndicator,this)]},!0,!0)},n.prototype.ajaxPolling=function(){this.dashboardDesigner.modules.ajaxPoll.ajaxPolling(this.queryDesigner.dataset.Id,{fnction:this.bbdesigner$.proxy(this.intermediateDbActionResponse,this,!0),indicator:[this.bbdesigner$.proxy(this.hideIndicator,this)]})},n.prototype.reconnectSqlExtractMode=function(n,t){if(t.result==="true"||t==="true"){BoldBIDashboard.isNullOrUndefined(t.jsonData)||(this.tableSelector=new BoldBIDashboard.DashboardDesignerUtility.TableSelector(this.dashboardDesigner,this.dsInfo,n,this),this.tableSelector.showDialog(JSON.parse(t.jsonData),this.connectionInst,t.table),this.tableSelector.editConnection=this,this.divEditor.data("BoldBIDashboardDialog").close());this.bbdesigner$(".bbi-query-editor .CodeMirror").each(function(n,t){t.CodeMirror.refresh()});this.queryDesigner.DatasourceInfo.Description=this.queryDesigner.dataset.Description=this.datasource.datasourceDescriptionText=this.descriptionText;var i=this.locale.toolBar;this.queryDesigner.descriptionDiv.text(this.datasource.datasourceDescriptionText===""?i.addDescription:i.editDescription)}},n.prototype.intermediateDbActionResponse=function(n,t){t&&(t.Data.IgnoreSchemaFetch?this.validateConnection("true"):(this.tableSelector=new BoldBIDashboard.DashboardDesignerUtility.TableSelector(this.dashboardDesigner,this.dsInfo,n,this),this.tableSelector.showDialog(JSON.parse(t.Data),this.connectionInst),this.tableSelector.editConnection=this,this.divEditor.data("BoldBIDashboardDialog").close()))},n.prototype.validateConnection=function(n){var t,i;n&&n.RetainSchema==="False"?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.SchemaMismatch,this.locale.alertWindowMesages.differentSchema,IconType.warning,AlertType.Confirm,!1,"",{height:140,width:500,method:"confirmAction",instance:this,dataInfo:{IsRetainSchema:!1,Tables:null}}):n&&n.RetainSchema==="True"?(t={IsRetainSchema:!0,Tables:n.SchemaAndTables},n.InvalidColumns==="True"?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.SchemaMismatch,this.locale.alertWindowMesages.columnNotExist,IconType.warning,AlertType.Confirm,!1,"",{height:140,width:500,method:"confirmAction",instance:this,dataInfo:t}):this.confirmAction(!0,t)):(t={IsRetainSchema:!1,Tables:null},this.confirmAction(!0,t));this.queryDesigner.DatasourceInfo.Description=this.queryDesigner.dataset.Description=this.datasource.datasourceDescriptionText=this.dsInfo.Description;i=this.locale.toolBar;this.queryDesigner.descriptionDiv.text(this.datasource.datasourceDescriptionText===""?i.addDescription:i.editDescription)},n.prototype.confirmAction=function(n,t){n?(this.connectionInst.LiveWithExtractMode||this.connectionInst.ShouldExtractData)&&!BoldBIDashboard.isNullOrUndefined(this.queryDesigner.DatasourceInfo.ConnectionProperties)&&BoldBIDashboard.DashboardUtil.IsStringNullorWhiteSpace(this.queryDesigner.DatasourceInfo.ConnectionProperties.ImportQuery)?this.queryDesigner.DatasourceInfo.ConnectionProperties.ImportType===this.locale.tableSelectorWindow.importTableText?this.tableSelector.getTableModeData(t):this.queryDesigner.DatasourceInfo.ConnectionProperties.ImportType===this.locale.tableSelectorWindow.importQueryText?this.tableSelector.getQueryModeData(t):this.tableSelector.getTableModeData(t):(this.connectionInst.LiveWithExtractMode||this.connectionInst.ShouldExtractData)&&!BoldBIDashboard.DashboardUtil.IsStringNullorWhiteSpace(this.queryDesigner.DatasourceInfo.ConnectionProperties.ImportQuery)?this.queryDesigner.DatasourceInfo.ConnectionProperties.ImportType===this.locale.tableSelectorWindow.importQueryText?this.tableSelector.getQueryModeData(t):this.queryDesigner.DatasourceInfo.ConnectionProperties.ImportType===this.locale.tableSelectorWindow.importTableText?this.tableSelector.getTableModeData(t):this.tableSelector.getQueryModeData(t):this.updateSchemaDetails(t):(t.Tables=null,t.IsRetainSchema=!0,this.updateSchemaDetails(t),BoldBIDashboard.isNullOrUndefined(this.tableSelector)||BoldBIDashboard.isNullOrUndefined(this.tableSelector.dialog)||(this.tableSelector.dialog.close(),this.tableSelector.dispose()),BoldBIDashboard.isNullOrUndefined(this.filePickerDialog)&&this.divEditor.data("BoldBIDashboardDialog").open())},n.prototype.updateSchemaDetails=function(n){var t,i;this.schemaDetails=n;t=this.queryDesigner.DatasourceInfo.ConnectionProperties;n.IsRetainSchema?(this.queryDesigner.editDataSource=!0,this.queryDesigner.saveQueryInfo(!0,!0)):(this.queryDesigner.updateNoDataInfo(),BoldBIDashboard.DashboardUtil.buttonEnable(this.queryDesigner.btnUpdateTag,!1),this.queryDesigner.previewSwitcherTag.css("display","none"),this.queryDesigner.btnUpdateTag.css("display","none"),this.connectionInst.updateDSInfo(this.queryDesigner.DatasourceInfo,this.dsInfo),i=BoldBIDashboard.Dashboard.ConnectionHelper.isHierarchicalConnection(this.connectionInst),this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.databaseSchema,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.ConnectAndReconnectAction,designerAction:!BoldBIDashboard.isNullOrUndefined(this.queryDesigner.DatasourceInfo.ConnectionProperties)&&i?BoldBIDashboard.DashboardUtil.DesignerAction.databaseSchema:BoldBIDashboard.DashboardUtil.DesignerAction.databaseSchemaLazyLoad,datasource:this.encrptDataSourceInfo(this.queryDesigner.DatasourceInfo),dataSetId:this.queryDesigner.DatasourceInfo.Id,oldDataSourceId:this.dsInfo.Id,ReconnectWithRetainSchema:!1,viewType:"Schema",connectionInfo:t,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.updateSchemaArea,this,!1,null),indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]}))},n.prototype.updateSchemaInformation=function(){var t=this.queryDesigner.DatasourceInfo.ConnectionProperties,n;this.connectionInst.updateDSInfo(this.queryDesigner.DatasourceInfo,this.dsInfo);n=BoldBIDashboard.Dashboard.ConnectionHelper.isHierarchicalConnection(this.connectionInst);this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.databaseSchema,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.ConnectAndReconnectAction,designerAction:!BoldBIDashboard.isNullOrUndefined(this.queryDesigner.DatasourceInfo.ConnectionProperties)&&n?BoldBIDashboard.DashboardUtil.DesignerAction.databaseSchema:BoldBIDashboard.DashboardUtil.DesignerAction.databaseSchemaLazyLoad,datasource:this.encrptDataSourceInfo(this.queryDesigner.DatasourceInfo),dataSetId:this.queryDesigner.DatasourceInfo.Id,ReconnectWithRetainSchema:!0,Schema:BoldBIDashboard.isNullOrUndefined(this.schemaDetails.Tables)?null:this.schemaDetails.Tables,oldDataSourceId:this.dsInfo.Id,codeView:this.queryDesigner.designState(),viewType:"Schema",connectionInfo:t,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.updateSchemaArea,this,!0,this.schemaDetails.Tables),indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]})},n.prototype.updateSchemaArea=function(n,t,i){var r,e,u,s,o,f;if(this.queryDesigner.isEditconnection=!0,this.queryDesigner.isEdit?(this.queryDesigner.isEdit=!1,this.queryDesigner.updateSchemaArea(i,!0),this.queryDesigner.isEdit=!0):this.queryDesigner.updateSchemaArea(i,!0),n){if(r=void 0,!BoldBIDashboard.isNullOrUndefined(t))for(r=JSON.parse(t),e=Object.keys(r),u=0;u<e.length;u++)for(s=r[e[u]],o=0;o<s.length;o++)f={schema:e[u],name:s[o]},BoldBIDashboard.isNullOrUndefined(f)||BoldBIDashboard.isNullOrUndefined(f.schema)||BoldBIDashboard.isNullOrUndefined(f.name)||this.queryDesigner.nodeTableSelector(f);this.queryDesigner.updateDataSource(r)}else this.updateParameterCollection(i);BoldBIDashboard.isNullOrUndefined(this.divEditor)||this.divEditor.data("BoldBIDashboardDialog").close();BoldBIDashboard.isNullOrUndefined(this.tableSelector)||BoldBIDashboard.isNullOrUndefined(this.tableSelector.dialog)||(this.tableSelector.hideIndicator(),this.tableSelector.dialog.close(),this.tableSelector.dispose());BoldBIDashboard.isNullOrUndefined(this.filePickerDialog)||(this.filePickerDialog.closeDialog(),this.filePickerDialog=null)},n.prototype.updateParameterCollection=function(n){var i=this.queryDesigner.dataset.Id,t=this.dashboardDesigner.modules.dataSet.datasets.filter(function(n){return n.Id===i})[0];BoldBIDashboard.isNullOrUndefined(t)?BoldBIDashboard.isNullOrUndefined(n)||BoldBIDashboard.isNullOrUndefined(n.parameterInfo)||(this.queryDesigner.queryParamCollection=JSON.parse(n.parameterInfo)):(this.queryDesigner.queryParamCollection=t.Query.DashboardParameters,this.removeDataSourceParameter(t.Query.DashboardParameters))},n.prototype.removeDataSourceParameter=function(n){var t,i;n.length>0&&(t=this.dashboardDesigner.modules.dynamicParameterPanel,t.queryDesigner=this.queryDesigner,i=n.filter(function(n){return n.Mode===ParameterMode.List&&!BoldBIDashboard.isNullOrUndefined(n.ListModeInfo.DataColumn)}),i.forEach(function(n){t.deleteParameterFromService(n.ParameterID)}))},n.prototype.encryptPostBack=function(n){var t=this.bbdesigner$.extend(!0,{},n);return t.ConnectionString=BoldBIDashboard.DashboardUtil.encryptData(t.ConnectionString),t.Username=BoldBIDashboard.DashboardUtil.encryptData(t.Username),t.Password=BoldBIDashboard.DashboardUtil.encryptData(t.Password),t},n.prototype.encrptDataSourceInfo=function(n){var t=this.bbdesigner$.extend(!0,{},n);return t.ConnectionProperties&&(t.ConnectionProperties.ConnectString=BoldBIDashboard.DashboardUtil.encryptData(t.ConnectionProperties.ConnectString),t.ConnectionProperties.UserName&&(t.ConnectionProperties.UserName=BoldBIDashboard.DashboardUtil.encryptData(t.ConnectionProperties.UserName)),t.ConnectionProperties.PassWord&&(t.ConnectionProperties.PassWord=BoldBIDashboard.DashboardUtil.encryptData(t.ConnectionProperties.PassWord))),t},n.prototype.renderConnectionDialog=function(){var n=null,t=this.dashboardDesigner.element.find("#"+this.id+"_connection_datasource");return t.hasClass("connectionClass")&&(t.remove(),t.removeClass("connectionClass")),t.hasClass("connectionClass")||(n=BoldBIDashboard.buildTag("div","",{width:"100%",height:"auto","margin-left":"8px"},{id:this.id+"_connection_datasource"}),n.addClass("connectionClass"),this.editContainer.append(n)),n},n.prototype.getConnectionObj=function(n){var t=null;return BoldBIDashboard.isNullOrUndefined(n)||(t=BoldBIDashboard.DashboardDesignerUtility.DataSourceTypes.getDataSourceTypeObject(n.ConnectionProperties.DataProvider),BoldBIDashboard.isNullOrUndefined(n.OAuthConnection)||n.OAuthConnection===""||(t=BoldBIDashboard.DashboardDesignerUtility.DataSourceTypes.getDataSourceTypeObject(n.OAuthConnection.service||n.OAuthConnection.Service))),t},n.prototype.closeDialog=function(){this.divEditor.data("BoldBIDashboardDialog").close();BoldBIDashboard.isNullOrUndefined(this.queryDesigner.dataset)||(this.queryDesigner.dataset.Description=this.oldDsDescriptionText);this.queryDesigner.resetConnectionOnEditConnectionCancel()},n.prototype.closePopup=function(n){if(!BoldBIDashboard.isNullOrUndefined(this.closeBtn)&&this.closeBtn.hasClass("e-close-disable")){n.cancel=!0;return}this.dashboardDesigner.element.find(".bbi-daterange-popup:visible").css("display","none");this.dashboardDesigner.element.find(".e-multiselect-popup-container").css("display","none")},n.prototype.showIndicator=function(){!BoldBIDashboard.isNullOrUndefined(this.divEditor)&&this.divEditor.data("BoldBIDashboardDialog").isOpen()?(this.footerTag.css("opacity",".5").attr("disabled","disabled"),BoldBIDashboard.DashboardUtil.buttonEnable(this.reconnectBtnTag,!1),BoldBIDashboard.DashboardUtil.buttonEnable(this.closeBtnTag,!1),BoldBIDashboard.isNullOrUndefined(this.closeBtn)||this.closeBtn.addClass("e-close-disable").css({cursor:"default",opacity:"0.3"}),this.ejIndicator.show()):BoldBIDashboard.isNullOrUndefined(this.tableDialog)||this.tableDialog.wrapper.data("BoldBIDashboardWaitingPopup").show()},n.prototype.hideIndicator=function(){!BoldBIDashboard.isNullOrUndefined(this.divEditor)&&this.divEditor.data("BoldBIDashboardDialog").isOpen()?(this.footerTag.css("opacity","1").removeAttr("disabled"),BoldBIDashboard.DashboardUtil.buttonEnable(this.reconnectBtnTag,!0),BoldBIDashboard.DashboardUtil.buttonEnable(this.closeBtnTag,!0),BoldBIDashboard.isNullOrUndefined(this.closeBtn)||this.closeBtn.removeClass("e-close-disable").css({cursor:"pointer",opacity:"1"}),this.ejIndicator.hide()):BoldBIDashboard.isNullOrUndefined(this.tableDialog)||this.bbdesigner$("#"+this.id+"_table_selector_dialog_wrapper").data("BoldBIDashboardWaitingPopup").hide()},n.prototype.setInfo=function(n,t,i,r,u){this.dsInfo=n;this.tableDialog=i;this.tableSelector=r;this.filePickerDialog=u},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.EditConnection",InternalEditConnection,window);InternalEditorManager=function(){function n(n,t){this.rangeExtractor=null;this.actionList=null;this.tempCollection=null;this.textRange=null;this.targetWindow=null;this.next=null;this.end=null;this.current=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.targetWindow=t;this.rangeExtractor=new BoldBIDashboard.DashboardDesignerUtility.RangeExtractor(n);this.updateData();this.actionList=["fontname","forecolor","backgroundcolor","fontsize","fontstyle","fontweight","textdecoration"]}return n.prototype.updateData=function(){var n=Array();n.push({Key:"fontname",Value:{tag:null,css:"font-family",result:"span",removeCSS:{"font-family":""},attr:"e-textrun-fontfamily",styleParent:"span"}});n.push({Key:"forecolor",Value:{tag:null,css:"color",result:"span",removeCSS:{color:""},attr:"e-textrun-fontcolor",styleParent:"span"}});n.push({Key:"backgroundcolor",Value:{tag:null,css:"background-color",result:"span",removeCSS:{"background-color":""},attr:"e-textrun-backgroundcolor",styleParent:"span"}});n.push({Key:"fontsize",Value:{tag:null,css:"font-size",result:"span",removeCSS:{"font-size":""},attr:"e-textrun-fontsize",styleParent:"span"}});n.push({Key:"fontstyle",Value:{tag:null,css:"font-style",result:"span",removeCSS:{"font-style":""},attr:"e-textrun-fontstyle",styleParent:"span"}});n.push({Key:"fontweight",Value:{tag:null,css:"font-weight",result:"span",removeCSS:{"font-weight":""},attr:"e-textrun-fontweight",styleParent:"span"}});n.push({Key:"textdecoration",Value:{tag:null,css:"text-decoration",result:"span",removeCSS:{"text-decoration":""},attr:"e-textrun-textdecoration",styleParent:"span"}});n.push({Key:"format",Value:{tag:null,data:"format",result:"span",removeAttr:{format:null},styleParent:"span"}});n.push({Key:"link",Value:{tag:null,data:"link",result:"span",removeAttr:{link:null},styleParent:"span"}});this.tempCollection=n},n.prototype.execCommand=function(n,t,i){this.textRange=i;switch(n){case ExecCommand.Fontname:this.cssFormatProcess("fontname",t);break;case ExecCommand.Forecolor:this.cssFormatProcess("forecolor",t);break;case ExecCommand.Backgroundcolor:this.cssFormatProcess("backgroundcolor",t);break;case ExecCommand.Fontsize:this.cssFormatProcess("fontsize",t);break;case ExecCommand.Fontstyle:this.cssFormatProcess("fontstyle",t);break;case ExecCommand.Fontweight:this.cssFormatProcess("fontweight",t);break;case ExecCommand.Textdecoration:this.cssFormatProcess("textdecoration",t);break;case ExecCommand.TextAlign:this.setTextAlign(t);break;case ExecCommand.Padding:this.setPadding(t);break;case ExecCommand.TextFormat:this.cssFormatProcess("format",t);break;case ExecCommand.TextLink:this.cssFormatProcess("link",t)}},n.prototype.cssFormatProcess=function(n,t){var u=this.rangeExtractor.getNodeCollection(this.textRange),s=null,h=null,f={Info:null,status:null},i=null,r,o,e,c;if(!this.validateSelectedNode(u)){for(r=0;r<u.length;r++){if(o=u[r],f=this.validateFormat(o,n),f.status)for(e=0;e<f.Info.length;e++)(c=f.Info[e].node,this.validateStyleData(c,this.getFormatData(n).Value.css,t))||(i=this.removeFormat(f,n,e));i=n.toLowerCase()==="format"||n.toLowerCase()==="link"?this.applyTextFormat(o,n,t):this.applyFormat(o,n,t);i&&(u.length===1?(s=i,h=i):r===0?s=i:h=r===u.length-1?i:null)}this.refreshRange(s,h);this.focus()}},n.prototype.setPadding=function(n){this.onApplyParagraphValue(n.side,n.value)},n.prototype.setTextAlign=function(n){this.onApplyParagraphValue("text-align",n)},n.prototype.onApplyParagraphValue=function(n,t){for(var u=this.getExactSelectedNode(this.textRange),r=this.getSelectedParent(u),i=0;i<r.length;i++)r[i].css(n,t);this.refreshRange(this.textRange.startContainer,this.textRange.endContainer);this.focus()},n.prototype.focus=function(){var n=this;setTimeout(function(){n.targetWindow.focus()},100)},n.prototype.removeFormat=function(n,t,i){var r=this.getFormatedTagOrder(n.Info,i),f=r[0].currentNode.slice(r[0].currentNode.length-1),o=document.createElement("span"),e,u;return r[0].currentNode=r[0].currentNode.slice(0,r[0].currentNode.length-1),e=this.splitNode(f[0]),e.rightSide.length>0&&this.bbdesigner$(this.bbdesigner$(r[0].node.cloneNode(!1)).append(e.rightSide)).insertAfter(r[0].node),u=null,r[0].tag?(this.rangeExtractor.cursorBasedCollection&&!r[0].textNode.data.trim().length?this.bbdesigner$(o).append(f).insertAfter(this.bbdesigner$(r[0].node)):this.bbdesigner$(f).insertAfter(r[0].node),u=r[0].textNode,this.rangeExtractor.cursorBasedCollection&&this.setCursorOnNode(u,r[0].textNode)):(u=this.bbdesigner$(r[0].node.cloneNode(!1)),u.css(this.getFormatData(t).Value.removeCSS),!this.rangeExtractor.validateTextNode(u[0])&&u[0].getAttribute("style")?this.bbdesigner$(u.append(f)).insertAfter(r[0].node):this.bbdesigner$(f).insertAfter(r[0].node),u=f),r[0].currentNode.length>0&&this.formateChildNodes(r[0].currentNode,t,r[0].node),e.leftSide.length<1&&this.bbdesigner$(r[0].node).remove(),u[0]?u[0]:u},n.prototype.formateChildNodes=function(n,t,i){for(var r={rightSide:[],leftSide:[]},f,u=n.length-1;u>=0;u--)r=this.splitNode(n[u]),r.rightSide.length>0&&this.bbdesigner$(this.bbdesigner$(i.cloneNode(!1)).append(r.rightSide)).insertAfter(n[u]),f=i,r.leftSide.length&&this.bbdesigner$(this.bbdesigner$(i.cloneNode(!1)).append(r.leftSide.reverse())).insertBefore(n[u])},n.prototype.refreshRange=function(n,t){var i=null,r=null,u;this.rangeExtractor&&(i=this.rangeExtractor.cursorData.node,r=this.rangeExtractor.cursorData.offSet);this.rangeExtractor.cursorBasedCollection&&i&&r>-1?(r=this.rangeExtractor.validateTextNode(i)?r>i.data.length?i.data.length:r:0,this.rangeExtractor.validateTextNode(i)&&!i.data.trim()&&(i.data=String.fromCharCode(65279)+i.data,r++),this.updateCursor(i,r)):n&&t&&(n.data&&!n.data.trim()&&n.data.indexOf(String.fromCharCode(65279))===-1&&(n.data=String.fromCharCode(65279)+n.data),t.data&&!t.data.trim()&&t.data.indexOf(String.fromCharCode(65279))===-1&&(t.data=String.fromCharCode(65279)),u=window.getSelection?window.getSelection():document.getSelection(),u.removeAllRanges(),this.textRange.setStart(n,0),this.textRange.setEnd(t,t.data?t.data.length:0),u.addRange(this.textRange))},n.prototype.updateCursor=function(n,t){var i=window.getSelection?window.getSelection():document.getSelection();this.textRange.setStart(n,t);this.textRange.setEnd(n,t);i.removeAllRanges();i.addRange(this.textRange)},n.prototype.generateRange=function(n){var t=n.commonAncestorContainer;this.next=n.startContainer===t&&!this.isTextNode(n.startContainer)?n.startContainer.childNodes[n.startOffset]:this.getStartEndElement(n.startContainer,t);this.end=n.endContainer===t&&!this.isTextNode(n.endContainer)?n.endContainer.childNodes[n.endOffset]:this.bbdesigner$(this.getStartEndElement(n.endContainer,t)).hasClass("bbi-label-element")?null:this.getStartEndElement(n.endContainer,t).nextSibling},n.prototype.setCursorOnNode=function(n,t){this.rangeExtractor.cursorData.node===n&&(this.rangeExtractor.cursorData.node=t)},n.prototype.traverse=function(n){function u(){return t.next!==(t.isTextNode(t.textRange.endContainer)?t.textRange.endContainer.parentNode.nextSibling:t.textRange.endContainer.nextElementSibling)&&t.textRange.endContainer.parentNode.nextSibling!==t.next?(t.current=t.next,t.next=t.current&&t.current.nextSibling!==t.targetWindow.find("span#endRange")[0]&&t.current.nextSibling!==(BoldBIDashboard.isNullOrUndefined(t.end)?t.textRange.endContainer.nextSibling:t.end)?t.current.nextSibling:null,t.current):null}for(var t=this,r,i;r=u();)if(t.hasSubNodes())t.getSubtree(t.textRange),t.traverse(n);else{if(i=r,!this.bbdesigner$(t.textRange.startContainer).hasClass("bbi-label-element")&&t.next===null&&i!==t.textRange.endContainer)while(BoldBIDashboard.isNullOrUndefined(t.next)&&!BoldBIDashboard.isNullOrUndefined(i))i=i.parentNode,BoldBIDashboard.isNullOrUndefined(i)||t.current.nextSibling===t.targetWindow.find("span#endRange")[0]||(t.next=i.nextSibling);n(r)}return r},n.prototype.getSelectedParent=function(n){for(var i,r=[],t=0;t<n.length;t++)i=n[t].closest("p"),BoldBIDashboard.isNullOrUndefined(i)||r.push(i);return r},n.prototype.applyFormat=function(n,t,i){var r=this.splitNode(n),o=n,f=this.getFormatData(t).Value,s=i?f.css+":"+i+";":f.css,u,e;return this.bbdesigner$(n.parentNode).hasClass("bbi-dbrd-label-parameter-text")&&(n=n.parentNode),r.leftSide.length>0&&!this.rangeExtractor.validateTextNode(r.leftSide[0])&&(this.tagCheck(r.leftSide[0],t)||this.compareCss(r.leftSide[0],s))?this.bbdesigner$(r.leftSide[0]).append(n):r.rightSide.length>0&&!this.rangeExtractor.validateTextNode(r.rightSide[0])&&(this.tagCheck(r.rightSide[0],t)||this.compareCss(r.rightSide[0],s))?this.bbdesigner$(r.rightSide[0]).prepend(n):r.leftSide.length<1&&r.rightSide.length<1&&this.bbdesigner$(n.parentNode).is(f.styleParent)?i?this.bbdesigner$(n.parentNode).css(f.css,i):this.bbdesigner$(n.parentNode).css(this.collectStyleData(f.css)):(u=document.createElement(f.result),this.rangeExtractor.cursorBasedCollection?(e=document.createElement("span"),this.rangeExtractor.validateTextNode(n)?(!this.bbdesigner$(u).is("span")&&this.rangeExtractor.noContent?this.bbdesigner$(e).append(u):e=u,u.appendChild(o=document.createTextNode(n.data)),this.rangeExtractor.cursorBasedCollection&&this.setCursorOnNode(n,o),this.bbdesigner$(n).replaceWith(e)):(u.innerHTML="&#65279;",this.bbdesigner$(e).append(u),n.firstChild&&this.bbdesigner$(n.firstChild).is("br")?this.bbdesigner$(e).insertBefore(n.firstChild):this.bbdesigner$(n).append(e),this.rangeExtractor.cursorBasedCollection&&this.setCursorOnNode(n,u.firstChild),o=u)):(u.appendChild(o=document.createTextNode(n.data)),this.bbdesigner$(n).replaceWith(u)),i&&this.bbdesigner$(u).css(f.css,i)),o},n.prototype.applyTextFormat=function(n,t,i){var r=this.splitNode(n),u,e=n,f=document.createElement("span");return r.leftSide.length&&r.leftSide[0].nodeType!==3&&(this.tagCheck(r.leftSide[0],t)||this.compareTypeValue(t,r.leftSide[0],i?this.getFormatData(t).Value.data+":"+i+";":this.getFormatData(t).Value.data))?this.bbdesigner$(r.leftSide[0]).append(n):r.rightSide.length&&!this.rangeExtractor.validateTextNode(r.rightSide[0])&&(this.tagCheck(r.rightSide[0],t)||this.compareTypeValue(t,r.rightSide[0],i?this.getFormatData(t).Value.data+":"+i+";":this.getFormatData(t).Value.data))?this.bbdesigner$(r.rightSide[0]).prepend(n):r.leftSide.length||r.rightSide.length||!this.bbdesigner$(n.parentNode).is(this.getFormatData(t).Value.styleParent)?(u=document.createElement(this.getFormatData(t).Value.result),this.rangeExtractor.cursorBasedCollection?this.rangeExtractor.validateTextNode(n)?(!this.bbdesigner$(u).is("span")&&this.rangeExtractor.noContent?this.bbdesigner$(f).append(u):f=u,u.appendChild(e=document.createTextNode(n.data)),this.rangeExtractor.cursorBasedCollection&&this.setCursorOnNode(n,e),this.bbdesigner$(n).replaceWith(f)):(u.innerHTML="&#65279;",this.bbdesigner$(f).append(u),n.firstChild&&this.bbdesigner$(n.firstChild).is("br")?this.bbdesigner$(f).insertBefore(n.firstChild):this.bbdesigner$(n).append(f),this.rangeExtractor.cursorBasedCollection&&this.setCursorOnNode(n,u.firstChild),e=u):(u.appendChild(e=document.createTextNode(n.data)),this.bbdesigner$(n).replaceWith(u)),i&&this.bbdesigner$(u).data(this.getFormatData(t).Value.data,i)):this.bbdesigner$(n.parentNode).data(this.getFormatData(t).Value.data,i),e},n.prototype.isTextNode=function(n){return n&&n.nodeValue!==null&&n.data!==null},n.prototype.isAncestor=function(n,t){try{return!this.isTextNode(t)&&(this.bbdesigner$.contains(t,this.isTextNode(n)?n.parentNode:n)||n.parentNode===t)}catch(i){return this.dashboardDesigner.designerPanel.logError({Source:"isAncestor",Error:i,Type:i.name}),!1}},n.prototype.isAncestorItself=function(n,t){return this.isAncestor(t,n)||n===t},n.prototype.tagCheck=function(n,t){var i=this.getFormatData(t).Value;return i.tag?this.bbdesigner$(n).is(i.tag):!1},n.prototype.styleCheck=function(n,t){var r=this.getFormatData(t).Value,i,u;return r.css&&!this.rangeExtractor.validateTextNode(n)&&!this.bbdesigner$(n).is("p")&&this.bbdesigner$(n).is("span")&&n.getAttribute("style")?(i=!0,u=r.css.split(";"),this.bbdesigner$(u).each(function(t,r){r&&n.getAttribute("style").replace(/\s/g,"").indexOf(r)===-1&&(i=!1)}),i):!1},n.prototype.validateCommentNode=function(n){return n.nodeType!==8},n.prototype.validateSelectedNode=function(n){return!n.length||n.length===1&&n[0].data&&!n[0].data.length},n.prototype.validateFormat=function(n,t){var i=[],r={Info:null,status:!1};return t=t.toLowerCase(),this.bbdesigner$.inArray(t,this.actionList)!==-1&&(i=this.validateFormatData(n,t),i&&i.length>0&&(r.Info=i),r.status=i.length>0),r},n.prototype.validateFormatData=function(n,t){var f=[],i=n.parentNode,e=n,r=!1,u=!1;if(i)do r=this.tagCheck(i,t),u=this.styleCheck(i,t),(r||u)&&f.push({textNode:n,node:i,css:u,tag:r});while(!this.bbdesigner$(i).hasClass("bbi-label-element")&&(e=i)&&(i=i.parentNode));return f},n.prototype.validateStyleData=function(n,t,i){var r=null,u=!1;return this.rangeExtractor.validateTextNode(n)||(r=n.getAttribute("style").split(";")),this.bbdesigner$(r).each(function(n,r){var f=r.split(":");return f[0].toLowerCase().trim()===t.toLowerCase().trim()&&f[1].toLowerCase().trim()===i.toLowerCase().trim()?(u=!0,!1):!1}),u},n.prototype.getFormatedTagOrder=function(n,t){return n[t].currentNode=this.getNodeOrder(n[t].textNode,n[t].node),t>0?n:n.slice(t,t+1)},n.prototype.getNodeOrder=function(n,t){var i=n,r=[];do r.push(i);while((i=i.parentNode)&&i!==t);return r},n.prototype.hasSubNodes=function(){return!this.isTextNode(this.current)&&(this.isAncestorItself(this.current,this.textRange.startContainer)||this.isAncestorItself(this.current,this.textRange.endContainer))},n.prototype.getFormatData=function(n){for(var t=0;t<this.tempCollection.length;t++)if(this.tempCollection[t].Key===n)return this.tempCollection[t];return null},n.prototype.compareCss=function(n,t){if(!this.rangeExtractor.validateTextNode(n)){var i=n.getAttribute("style"),r=!BoldBIDashboard.isNullOrUndefined(i)&&i.toLowerCase().trim().replace(this.rangeExtractor.expression,""),u=t.toLowerCase().trim().replace(this.rangeExtractor.expression,"");return i&&r===u}return!1},n.prototype.compareTypeValue=function(n,t,i){return n.toLowerCase()==="format"?this.bbdesigner$(t).data("format")===i:n.toLowerCase()==="link"?this.bbdesigner$(t).data("link")===i:!1},n.prototype.collectStyleData=function(n){var i=n.replace(this.rangeExtractor.expression,"").split(";"),r={},t;return this.bbdesigner$(i).each(function(n){var u=i[n];t=u.split(":");t.length>1&&(r[t[0].toLowerCase().trim()]=t[1].toLowerCase().trim())}),r},n.prototype.getStartEndElement=function(n,t){if(this.isAncestor(n,t))while(n&&n.parentNode!==t)n=n.parentNode;return n},n.prototype.getSubtree=function(){var n=this.textRange.cloneRange();return n.selectNodeContents(this.current),this.isAncestorItself(this.current,this.textRange.startContainer)&&n.setStart(this.textRange.startContainer,this.textRange.startOffset),this.isAncestorItself(this.current,this.textRange.endContainer)&&n.setEnd(this.textRange.endContainer,this.textRange.endOffset),this.generateRange(n)},n.prototype.splitNode=function(n){for(var t=n,i={rightSide:[],leftSide:[]};t=t.nextSibling;)this.validateCommentNode(t)&&i.rightSide.push(t);for(t=n;t=t.previousSibling;)this.validateCommentNode(t)&&i.leftSide.push(t);return i},n.prototype.getExactSelectedNode=function(n){function u(n){if(n.nodeType===3&&(this.bbdesigner$.trim(n.nodeValue)!==""||n.nodeValue==="﻿"||this.bbdesigner$.trim(n.nodeValue)===""&&n.nextSibling===f[0]))t.push(this.bbdesigner$(n));else if(n.nodeValue&&n.nodeName!=="#comment"&&n.nodeValue.trim()===""&&r.textRange.endContainer.parentNode.nextSibling!==r.next)this.bbdesigner$.inArray(n.previousElementSibling,i)<0&&i.push(n.previousElementSibling);else if((n.nodeName.toLowerCase()==="br"||!this.bbdesigner$(n).hasClass("bbi-label-element"))&&this.bbdesigner$.inArray(n.parentNode,t)<0&&n.nodeName.toLowerCase()!=="div"&&!BoldBIDashboard.isNullOrUndefined(t[t.length-1])&&t[t.length-1].parentNode!==n.parentNode&&n.previousSibling&&n.previousSibling.parentNode!==n.parentNode)t.push(this.bbdesigner$(n.parentNode));else if(BoldBIDashboard.isNullOrUndefined(n.firstChild))t.push(this.bbdesigner$(n));else for(n=n.firstChild;n;)u(n),n=n.nextSibling}var t=[],i=[],f=this.targetWindow.find("span#startRange"),r=this;return this.generateRange(n),this.traverse(u),t},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.EditorManager",InternalEditorManager,window);InternalRangeExtractor=function(){function n(n){this.expression=null;this.findStatus=null;this.iterationStatus=!1;this.cursorData=null;this.textNodeCollection=[];this.traverseData=null;this.noContent=!1;this.cursorBasedCollection=!1;this.bbdesigner$=n.bbdesigner$;this.expression=/\s/g;this.findStatus={leftSide:null,rightSide:null};this.cursorData={node:null,offSet:null};this.traverseData={leftSide:{childNode:"lastChild",sibling:"previousSibling"},rightSide:{childNode:"firstChild",sibling:"nextSibling"}};this.iterationStatus=!1}return n.prototype.getNodeCollection=function(n){return n&&(this.textNodeCollection=[],this.noContent=!1,this.iterationStatus=!1,this.cursorData={node:null,offSet:null},n.startContainer===n.endContainer&&n.startOffset===n.endOffset?(this.collectCursorBasedTextNode(n.startContainer,n.startOffset),this.cursorBasedCollection=!0):(this.collectSelectionBasedTextNode(n),this.cursorBasedCollection=!1)),this.textNodeCollection},n.prototype.insertCursor=function(n,t){var r=n.data.substring(0,t),u=n.data.substr(t),i,f,e;r.replace(String.fromCharCode(65279),"")&&(f=this.createParentNode(r,this.bbdesigner$(n).closest("span")),f.insertBefore(n.parentNode));u.replace(String.fromCharCode(65279),"")&&(e=this.createParentNode(u,this.bbdesigner$(n).closest("span")),e.insertAfter(n.parentNode));this.bbdesigner$(n).replaceWith(i=document.createTextNode(""));this.cursorData={node:i,offSet:0};this.textNodeCollection.push(i);this.noContent=!0},n.prototype.collectCursorBasedTextNode=function(n,t){for(var f,i,r,u,c=new RegExp(this.expression),s,h,e,o;f=c.exec(n.data);)n.data.substring(f.index,f.index+1).indexOf(" ")!==-1&&(f.index<t&&(r=f),!u&&t<=f.index&&(u=f));r&&u?t-(r.index+1)==0||t-(r.index+1)===n.data.substring(r.index+1,u.index).replace("\n","").length?this.insertCursor(n,t):(s=n.data.substring(0,r.index+1),h=n.data.substring(u.index),this.bbdesigner$(document.createTextNode(s)).insertBefore(n),this.bbdesigner$(document.createTextNode(h)).insertAfter(n),i=document.createTextNode(n.data.substring(r.index+1,u.index)),this.bbdesigner$(n).replaceWith(i),this.cursorData={node:i,offSet:t-(r.index+1)},this.textNodeCollection.push(i)):r?(e=void 0,this.collectNodeData(n,!1),e=this.textNodeCollection,this.textNodeCollection=[],e.length===0&&(t-(r.index+1)==0||t-(r.index+1)===n.data.substring(r.index+1).replace("\n","").length)?this.insertCursor(n,t):(s=n.data.substring(0,r.index+1),this.bbdesigner$(document.createTextNode(s)).insertBefore(n),i=document.createTextNode(n.data.substring(r.index+1)),this.bbdesigner$(n).replaceWith(i),this.cursorData={node:i,offSet:t-(r.index+1)},this.textNodeCollection.push(i),this.textNodeCollection.concat(e))):u?(o=void 0,this.collectNodeData(n,!0),o=this.textNodeCollection,this.textNodeCollection=[],o.length===0&&(t===0||t===n.data.substring(0,u.index).replace("\n","").length)?this.insertCursor(n,t):(h=n.data.substring(u.index),this.bbdesigner$(document.createTextNode(h)).insertAfter(n),this.bbdesigner$(n).replaceWith(i=document.createTextNode(n.data.substring(0,u.index))),this.cursorData={node:i,offSet:t},this.textNodeCollection=o.reverse(),this.textNodeCollection.push(i))):this.validateTextNode(n)?(this.collectNodeData(i=n,!1),e=this.textNodeCollection,this.textNodeCollection=[],this.collectNodeData(i,!0),o=this.textNodeCollection,this.textNodeCollection=[],i.data===String.fromCharCode(65279)||o.length===0&&t===0||e.length===0&&i.data?this.insertCursor(n,t):(this.textNodeCollection=o.reverse(),this.textNodeCollection.push(i),this.textNodeCollection=this.textNodeCollection.concat(e),this.cursorData={node:i,offSet:t})):(i=document.createTextNode(""),n.firstChild?this.bbdesigner$(i).insertBefore(n.firstChild):this.bbdesigner$(i).appendTo(n),this.textNodeCollection.push(i),this.cursorData={node:i,offSet:t},this.noContent=!0)},n.prototype.validateContent=function(n,t){for(var e=new RegExp(this.expression),i,r=[],u,f;i=e.exec(n.data);)r.push(i);r.length?(i=r[t==="leftSide"?r.length-1:0],f=t==="leftSide"?i.index+1:i.index,this.bbdesigner$(u=document.createTextNode(n.data.substring(f))).insertAfter(n),n.data=n.data.substring(0,f),t==="rightSide"&&this.bbdesigner$.trim(n.data)?this.textNodeCollection.push(n):t==="leftSide"&&this.bbdesigner$.trim(u.data)&&this.textNodeCollection.push(u),this.findStatus[t]=!0):this.textNodeCollection.push(n)},n.prototype.iterateNodes=function(n,t){if(!this.findStatus[t])if(this.validateTextNode(n)&&n.data)this.validateContent(n,t);else if((n=n[this.traverseData[t].childNode])&&!this.findStatus[t])do this.validateTextNode(n)&&n.data?this.validateContent(n,t):this.iterateNodes(n,t);while((n=n[this.traverseData[t].sibling])&&!this.findStatus[t])},n.prototype.collectNodeData=function(n,t){this.findStatus={leftSide:null,rightSide:null};var r={leftSide:[],rightSide:[]},u=this,i=t?"leftSide":"rightSide";do r=this.getSiblingNode(n),this.bbdesigner$(r[i]).each(function(n,t){u.iterateNodes(t,i)});while(!this.bbdesigner$(n.parentNode).hasClass("bbi-label-element")&&(n=n.parentNode)&&!this.findStatus[i])},n.prototype.collectSelectionBasedTextNode=function(n){var t,i,o,r,u,s,f=n.startContainer,e=n.endContainer,h;this.textNodeCollection=[];n.startContainer===n.endContainer?this.validateTextNode(n.endContainer)?(n.startOffset&&(t=n.startContainer.data.substr(0,n.startOffset)),n.startContainer.data.length!==n.endOffset&&(i=n.startContainer.data.substr(n.endOffset)),o=n.startContainer.data.substr(n.startOffset,n.endOffset-n.startOffset),t&&(r=this.createParentNode(t,this.bbdesigner$(n.startContainer).closest("span")),r.insertBefore(n.startContainer.parentNode)),i&&(u=this.createParentNode(i,this.bbdesigner$(n.endContainer).closest("span")),u.insertAfter(n.startContainer.parentNode)),o&&(s=document.createTextNode(o),this.bbdesigner$(n.startContainer).replaceWith(s)&&this.textNodeCollection.push(s))):n.startContainer.nodeName.toLowerCase()==="div"?this.updateNodeCollection(this.bbdesigner$(n.startContainer)[0],f,null):this.updateNodeCollection(n.startContainer,f,null):(h=n.commonAncestorContainer,this.validateTextNode(n.startContainer)&&n.startOffset&&(t=n.startContainer.data.substr(0,n.startOffset),i=n.startContainer.data.substr(n.startOffset),t&&(r=this.createParentNode(t,this.bbdesigner$(n.startContainer).closest("span")),r.insertBefore(n.startContainer.parentNode)),i&&(u=this.createParentNode(i,this.bbdesigner$(n.startContainer).closest("span")),this.bbdesigner$(f.parentNode).replaceWith(f=u))),this.validateTextNode(n.endContainer)&&n.endContainer.data&&n.endContainer.data.length!==n.endOffset?(i=n.endContainer.data.substr(n.endOffset),t=n.endContainer.data.substr(0,n.endOffset),i&&(u=this.createParentNode(i,this.bbdesigner$(n.endContainer).closest("span")),u.insertAfter(n.endContainer.parentNode)),t&&(r=this.createParentNode(t,this.bbdesigner$(n.endContainer).closest("span")),this.bbdesigner$(e.parentNode).replaceWith(e=r))):n.endOffset&&n.endContainer.lastChild&&(e=n.endContainer.lastChild),this.updateNodeCollection(h,f,e))},n.prototype.createParentNode=function(n,t){var i=this.bbdesigner$(document.createElement("span"));return i.text(n),t.length>0&&i.css("cssText",t[0].style.cssText),i},n.prototype.updateNodeCollection=function(n,t,i){if(this.updateIterationStatus(n,t,i),n=n.firstChild)do this.updateNodeCollection(n,t,i);while(n=n.nextSibling)},n.prototype.updateIterationStatus=function(n,t,i){n!==t||this.iterationStatus||(this.iterationStatus=!0);this.validateTextNode(n)&&this.iterationStatus&&this.textNodeCollection.push(n);n===i&&this.iterationStatus&&(this.iterationStatus=!1)},n.prototype.validateTextNode=function(n){return n.nodeType===3},n.prototype.getSiblingNode=function(n){for(var t=n,i={leftSide:[],rightSide:[]};t=t.nextSibling;)(!t.tagName||this.bbdesigner$(t).hasClass("bbi-label-element"))&&i.rightSide.push(t);for(t=n;t=t.previousSibling;)(!t.tagName||this.bbdesigner$(t).hasClass("bbi-label-element"))&&i.leftSide.push(t);return i},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.RangeExtractor",InternalRangeExtractor,window),function(n){n[n.Fontname=0]="Fontname";n[n.Fontsize=1]="Fontsize";n[n.Forecolor=2]="Forecolor";n[n.Backgroundcolor=3]="Backgroundcolor";n[n.Fontstyle=4]="Fontstyle";n[n.Fontweight=5]="Fontweight";n[n.Textdecoration=6]="Textdecoration";n[n.TextAlign=7]="TextAlign";n[n.Padding=8]="Padding";n[n.TextFormat=9]="TextFormat";n[n.TextLink=10]="TextLink"}(ExecCommand||(ExecCommand={}));InternalAppendDatasource=function(){function n(n){this.id=null;this.locale=null;this.appendDataDialog=null;this.appendDataSaveAsDialog=null;this.footerTag=null;this.appendSaveAsfooterTag=null;this.appendMode=null;this.model=null;this.validCount=0;this.inValidCount=0;this.overallCount=0;this.fileId=null;this.fileName=null;this.lastModifiedFile=null;this.ajaxPostForDSNameValidation=null;this.setTimeForDSNameValidation=null;this.isDSNameExist=!0;this.appendPopupNotification=null;this.ejQueryTool=null;this.tempdatasetName=null;this.isSchemaCheckforFile=!0;this.validFilesForAppend=[];this.inValidFilesForAppend=[];this.mappingValidFilesWithFileName={};this.dashboardDesigner=n;this.bbdesigner$=n.bbdesigner$;this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.locale=n.getLocalizationContent();this.id=this.queryDesigner.id;this.dataSourceLocale=this.locale.dataSource;this.wireEvents()}return n.prototype.openAppendDataSourceWindow=function(n,t){this.resetConfiguration();this.renderAppenDatasource();this.datasourceInfo=n;this.tables=this.getTableGroups();this.ejQueryTool=t;this.appendSelectedTableCollections.setModel({dataSource:this.tables});this.appendSelectedTableCollections.selectItemByIndex(0);this.tempdatasetName=this.dashboardDesigner.element.find("#"+this.id+"_dataset_txt").val();this.dashboardDesigner.element.find("#"+this.id+"_appenddatasourcename_textBox").val(this.tempdatasetName);this.dashboardDesigner.element.find("#"+this.id+"_appenddatasourcename_textBox").attr("disabled","disabled");var r=this.dashboardDesigner.element.find("#"+this.id+"_append_data_append").attr("disabled","disabled"),u=this.dashboardDesigner.element.find("#"+this.id+"_append_data_save_as").attr("disabled","disabled"),i=this.appendDataDialog.data("BoldBIDashboardDialog");BoldBIDashboard.isNullOrUndefined(i)||i.open()},n.prototype.resetConfiguration=function(){this.fileName="";this.lastModifiedFile="";this.inValidFilesForAppend=[];this.validCount=0;this.inValidCount=0;this.appendDataDialog=null;this.ejUploadBox=null;this.footerTag=null;this.appendPopupNotification=null;this.dataSetName="";this.validFilesForAppend=[];this.mappingValidFilesWithFileName={}},n.prototype.getTableGroups=function(){var n=[],t=document.querySelector("#"+this.id+"_div_bodySchema .bbi-dataset-treeview"),i;return t&&(i=t.querySelectorAll(".bbi-option-view-schema"),i.forEach(function(t){var i=t.getAttribute("data-displayname");i&&n.push(i)})),n},n.prototype.renderTextBoxAndDropdown=function(n){var t,i;this.dataSourceInstance.renderTextBoxItem(this.dataSourceLocale.appendTextBoxName,this.id+"_appenddatasourcename_textBox",!1,n,538);t=n.find("#"+this.id+"_appenddatasourcename_textBox_tr");t.css("display","block");t.css("padding-left","24px");t.css("padding-right","24px");t.css("padding-top","20px");t.css("padding-bottom","8px");this.dataSourceInstance.renderDropDownItem(this.dataSourceLocale.appendDsSelectedTables,this.id+"_appendDsTable",n,null,null,null,this.onChangeCollection,this);this.appendSelectedTableCollections=n.find("#"+this.id+"_appendDsTable").BoldBIDashboardDropDownList({fields:{id:"field",text:"field",value:"field"},delimiterChar:"$"}).data("BoldBIDashboardDropDownList");this.appendTableCollectionsTag=n.find("#"+this.id+"_appendDsTable_tr");this.appendTableCollectionsTag.css("display","block");this.appendTableCollectionsTag.css("padding-left","24px");this.appendTableCollectionsTag.css("padding-right","24px");this.appendTableCollectionsTag.css("padding-top","8px");this.appendTableCollectionsTag.css("padding-bottom","8px");i=n.find("#"+this.id+"_appendDsTable_wrapper");i.css("width","552px")},n.prototype.renderAppenDatasource=function(){var n=this,t=this.appendDataDialog=BoldBIDashboard.buildTag("div.e-append-ds-dlg","",{height:"520px",width:"600px"},{id:this.id+"_append_data_dialog"}),r,f,e,o,i,s;this.dataSourceInstance=this.dashboardDesigner.modules.dataSource;this.renderTextBoxAndDropdown(t);r=BoldBIDashboard.buildTag("div.e-over-allradio-wrapper","",{display:"block","padding-left":"26px","padding-right":"24px","padding-top":"8px","padding-bottom":"8px"},{id:this.id+"_overall_radio-container"});this.renderadioBtns(r);f="<div class= 'bbi-append-file-banner-container'><div class= 'bbi-append-file-banner-parent'><div class= 'bbi-append-file-banner-text'><\/div><span class = 'bbi-append-dashboard-close-icon bbi-file-banner-icon' title = '"+this.locale.dataSource.appendDsCloseBtn+"'><\/span><\/div><\/div><div class ='bbi-append-initial-listing-parent'><div class= 'bbi-append-file-container-parent'><div class ='bbi-append-initial-listing-upload-parent'><div class ='bbi-append-initial-listing-container' id="+this.id+"_append_file><\/div><\/div><\/div><div class ='bbi-append-initial-append-file-listing-parent'><div class='bbi-append-file-scroll'><div class='bbi-append-file-container'><\/div><\/div><\/div>";t.append(r);t.append(f);var u=BoldBIDashboard.buildTag("div.e-uploaded-file-list-parent","",{display:"none",position:"absolute","align-items":"center",top:"523px",width:"600px",height:"32px",background:"#EEF6FC",gap:"40px"},{id:this.id+"_uploaded-file-list-parent"});this.bbdesigner$(this.dashboardDesigner.element).append(t);e=209715200;this.ejUploadBox=t.find("#"+this.id+"_append_file").BoldBIDashboardUploadbox({width:"0px",height:"0px",uploadName:"file",allowDragAndDrop:!0,autoUpload:!0,multipleFilesSelection:!0,dropAreaText:this.getUploadFileTemplate(),showFileDetails:!1,fileSize:e,saveUrl:this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.fileupload,fileSelect:this.bbdesigner$.proxy(this.onFileSelect,this),inProgress:this.bbdesigner$.proxy(this.onUploadProgress,this),success:this.bbdesigner$.proxy(this.onUploadSuccess,this),error:this.bbdesigner$.proxy(this.onUploadError,this),beforeSend:this.bbdesigner$.proxy(function(t){BoldBIDashboard.isNullOrUndefined(n.xhrObj)||(n.xhrObj.onerror=null,n.xhrObj.abort(),n.xhrObj=null);n.xhrObj=t.currentRequest;n.dashboardDesigner.beforeSendRequestForUploadbox(n.dashboardDesigner,"UploadAction",t)},this)}).data("BoldBIDashboardUploadbox");o=this.dashboardDesigner.element.find("#"+this.id+"_append_file_dragWrapper");o.css("width","552px");i=this.dashboardDesigner.element.find(".bbi-append-initial-listing-upload-parent");i.css("padding-left","24px");i.css("padding-right","24px");i.css("height","56px");this.appendDataDialog.BoldBIDashboardDialog({height:"650px",width:"602px",title:"Append Data From File",enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner bbi-appenddatasource",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),containment:"#"+this.id,target:"#"+this.id,closeIconTooltip:this.locale.dialogOptions.closeButtonText});u.append("<div class='bbi-append-file-listing-details'><\/div>");u.append("<div class='bbi-append-file-listing-failure-details'><\/div>");t.append(u);s=this.dashboardDesigner.element.find(".e-uploaded-file-list-parent").css("display","none");this.renderappendFooterDialog();this.renderSaveAsDialog()},n.prototype.renderSaveAsDialog=function(){var n=this.appendDataSaveAsDialog=BoldBIDashboard.buildTag("div.e-append-datasaveAs-dlg","",{height:"72px"},{id:this.id+"_append_datasaveAs_dialog"}),u,t,i,r,f,e,o;this.dataSourceInstance.renderTextBoxItem(this.dataSourceLocale.appendTextBoxName,this.id+"_append_dbname",!1,n,292);u=this.id+"_append_dbname";t=BoldBIDashboard.buildTag("div .bbi-dashboarddesigner-dsname-validationicon","",{},{id:u+"_indicator_div"});this.dataSourceName=n.find("#"+this.id+"_append_dbname");i=n.find("#"+this.id+"_append_dbname_tr");BoldBIDashboard.isNullOrUndefined(this.dashboardDesigner.designerPanel)||(r=this.dashboardDesigner.designerPanel);n.find("#"+this.id+"_append_dbname_td").append(t);n.find("#"+this.id+"_append_dbname").css("position","relative");BoldBIDashboard.isNullOrUndefined(r)||r.appendSpinningWidget(t,null);t.find(".bbi-background-waiting-popup").css("background-color","");f=t.find(".bbi-dashboard-spinning");f.css({width:"35px",height:"35px"});i.css("display","block");i.css("padding","15px");e=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.dataSource.appendDsSaveBtn,{float:"right",right:"25px"},{id:this.id+"_append_data_save",type:"button"});o=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.dataSource.appendDsCloseBtn,{float:"right",left:"10px"},{id:this.id+"_append_data_saveAsDlgclose",type:"button"});this.bbdesigner$(this.dashboardDesigner.element).append(this.appendDataSaveAsDialog);this.appendDataSaveAsDialog.BoldBIDashboardDialog({title:"Append new data",width:"356px",height:"200px",enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner bbi-saveas-appendatsourcedialog",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),containment:"#"+this.id,target:"#"+this.id,closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.appendSaveAsfooterTag=this.dashboardDesigner.element.find("#"+this.id+"_append_datasaveAs_dialog_foot");this.appendSaveAsfooterTag.css("bottom","25px;");this.appendSaveAsfooterTag.append(o,e)},n.prototype.renderappendFooterDialog=function(){var n=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.dataSourceLocale.appendDsAppendBtn,{float:"right","margin-right":"20px"},{id:this.id+"_append_data_append",type:"button"}),t=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left bbi-dbrd-append-saveas-btn",this.locale.dataSource.appendDsSaveAsBtn,{float:"left"},{id:this.id+"_append_data_save_as",type:"button"}),i=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.dataSource.appendDsCloseBtn,{float:"right",right:"10px"},{id:this.id+"_append_data_cancel",type:"button"});this.footerTag=this.dashboardDesigner.element.find("#"+this.id+"_append_data_dialog_foot");this.footerTag.append(i,t,n)},n.prototype.renderadioBtns=function(n){var l=BoldBIDashboard.buildTag("span.e-append-textboxlable","Append Type",{"font-size":"12px","font-weight":"700"},{id:this.id+"_textbox_lable"}),c=BoldBIDashboard.buildTag("div.e-dropdown-wrapper_radiodiv","",{},{id:this.id+"_appends_mode_radiodiv"}),t=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),i=BoldBIDashboard.buildTag("tr","",{},{}),r=BoldBIDashboard.buildTag("td","",{width:"25%",padding:"8px 0px"},{}),u=BoldBIDashboard.buildTag("td","",{width:"20%",padding:"8px 0px"},{}),f=BoldBIDashboard.buildTag("div","",{"margin-left":"30px"},{id:this.id+"_btn_datasource_mode"}),e=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_btn_file_mode"}),o,s,h;r.append(f);u.append(e);i.append(u,r);t.append(i);c.append(t);o={callBackInstance:this,callBackMethod:"changeSelectionType",groupName:"append-datasource-type-modes",labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:"_datasource",label:'<span class="bbi-append-config-radio">'+this.locale.dataSource.appendDatasourceRadioBtnText+"<\/span>",value:"Datasource"}]};s={callBackInstance:this,callBackMethod:"changeSelectionType",groupName:"append-datasource-type-modes",labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:"_file",label:'<span class="bbi-append-config-radio" style="white-space:nowrap">'+this.locale.dataSource.appendFileRadioBtnText+"<\/span>",isChecked:!0,value:"File"}]};new BoldBIDashboard.Dashboard.RadioButton(s,e);new BoldBIDashboard.Dashboard.RadioButton(o,f);h=BoldBIDashboard.buildTag("span.e-append-textboxlable",this.dataSourceLocale.appendDsChooseFile,{"font-size":"12px","font-weight":"700"},{id:this.id+"_choose_file_lable"});n.append(h)},n.prototype.onChangeCollection=function(n){!BoldBIDashboard.isNullOrUndefined(n)},n.prototype.onUploadError=function(n){if(!BoldBIDashboard.isNullOrUndefined(n)&&!BoldBIDashboard.isNullOrUndefined(n.error)){var t=n.error;this.showFileUploadBanner(t,"#FF3B30")}},n.prototype.showFileUploadBanner=function(n,t){var r=this.dashboardDesigner.element.find(".bbi-upload-file-banner-parent"),i;r.css({backgroundColor:t,visibility:"visible"});i=this.dashboardDesigner.element.find(".bbi-upload-file-banner-text");i.html(n)},n.prototype.getFileExtension=function(n){var t=n.lastIndexOf(".");return t===-1?undefined:n.substring(t+1)},n.prototype.onUploadBrowseClick=function(){if(BoldBIDashboard.isNullOrUndefined(this.datasourceInfo.OriginalFileName))this.ejUploadBox.setModel({extensionsAllow:".xlsx,.json,.csv,.xml "});else{var n=this.getFileExtension(this.datasourceInfo.OriginalFileName);this.updateAllowedExtensions(n)}this.dashboardDesigner.element.find("#"+this.id+"_append_file .e-uploadinput").click()},n.prototype.updateAllowedExtensions=function(n){this.ejUploadBox.setModel({extensionsAllow:"."+n})},n.prototype.onFileSelect=function(n){n.files.length!==0&&n.files[0].size>n.model.fileSize&&(n.cancel=!0);this.dashboardDesigner.element.find(".bbi-append-initial-append-file-listing-parent").css("display","block");BoldBIDashboard.browserInfo().name!=="msie"&&this.ejUploadBox._uploadFileListDelete()},n.prototype.onUploadSuccess=function(n){if(!BoldBIDashboard.isNullOrUndefined(n)&&!BoldBIDashboard.isNullOrUndefined(n.responseText)){var i=this.dashboardDesigner.element.find(".bbi-append-file-info-parent[data-id='"+n.files.rawFile.lastModified+"']"),r=JSON.parse(n.responseText),t=i.find(".bbi-append-file-status-message");BoldBIDashboard.isNullOrUndefined(r)||BoldBIDashboard.isNullOrUndefined(r.Data)?(t.html(this.locale.downloadUpload.invalidFileText),t.css("color","#FF3B30"),i.removeAttr("data-is-append-in-progress")):(this.fileId=r.Data.fileId,this.fileName=n.files.name,this.mappingValidFilesWithFileName[this.fileName]=this.fileId,this.lastModifiedFile=n.files.rawFile.lastModified,t.html("Validating schema...."),t.css("font-family","Roboto"),i.removeAttr("data-id"),i.removeAttr("data-is-append-in-progress"),this.serverSchemaCheck(t))}},n.prototype.onUploadProgress=function(n){var i,r,u,t,f,e;BoldBIDashboard.isNullOrUndefined(n)||(i=this.dashboardDesigner.element.find(".bbi-append-file-listing-parent").is(":visible"),i!==!0&&this.dashboardDesigner.element.find(".bbi-append-file-listing-parent").css("display","block"),r=this.dashboardDesigner.element.find(".bbi-append-file-container"),u=this.dashboardDesigner.element.find(".bbi-append-file-info-parent").length>0?this.isUploadFileCheck(n.file):!1,u||(this.overallCount++,t=this.uploadFileListHTML(n.file),f=t.find(".bbi-append-file-status-message"),f.addClass("bbi-append-file-status-icon-waiting-spinner"),e=this.dashboardDesigner.element.find(".bbi-append-file-listing-parent"),t.appendTo(r)))},n.prototype.isUploadFileCheck=function(n){var t=this.dashboardDesigner.element.find(".bbi-append-file-info-parent[data-Id='"+n.rawFile.lastModified+"']");return t.length>0},n.prototype.uploadFileListHTML=function(n){var t="<div class='bbi-append-file-info-parent' data-id="+n.rawFile.lastModified+" data-is-append-in-progress=true><div class='bbi-append-file-name-parent'><div class='bbi-append-file-name' title = '"+n.name+"'>"+n.name+"<\/div><\/div><div class='bbi-append-file-size-parent'><div class='bbi-append-file-size'>"+(BoldBIDashboard.isNullOrUndefined(n.size)?"0.00":(n.size/1048576).toFixed(2))+this.locale.downloadUpload.mbText+"<\/div><\/div><div class='bbi-append-file-status-message-parent'><div class='bbi-append-file-status-message' id = '"+n.rawFile.lastModified+"'>"+this.locale.downloadUpload.uploadingText+"<\/div><\/div><div class='bbi-append-file-delete-icon-parent'><div class='bbi-append-file-delete-icon'><\/div><\/div><\/div>";return this.bbdesigner$(t)},n.prototype.getUploadFileTemplate=function(){return"<div class ='bbi-append-file-parent'><div class ='bbi-append-file-text-parent'><div class ='bbi-append-file-drag-drop-text'>"+this.locale.dataSource.appendDsdragAndDropText+"<div class ='bbi-append-file-browse-text'>"+this.locale.dataSource.appendDsBrowseText+"<\/div> <div class ='bbi-append-file-size-text'>"+this.locale.dataSource.appendDsEstimatedFileSize+"<\/div><\/div><\/div><\/div>"},n.prototype.closeAppendDialog=function(){var n=this.appendDataDialog.data("BoldBIDashboardDialog");BoldBIDashboard.isNullOrUndefined(n)||n.close()},n.prototype.closeSaveAsDialog=function(){var n=this.appendDataSaveAsDialog.data("BoldBIDashboardDialog");n.close()},n.prototype.appendFileTosaveAsServer=function(){if(this.dataSetName=this.dashboardDesigner.element.find("#"+this.id+"_append_dbname").val(),this.dataSetName.length==0&&(this.dataSourceInstance.showValidationMsg(this.id+"_append_dbname",!0,this.locale.dataSource.specifyDataSourceName),this.isDSNameExist=!0),!this.isDSNameExist){var n=this.appendDataSaveAsDialog.data("BoldBIDashboardDialog");BoldBIDashboard.isNullOrUndefined(n)||n.close();this.appendFiletoServer()}},n.prototype.appendFiletoServer=function(){this.PopUpRender();this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.appendDatasource,{action:BoldBIDashboard.DashboardUtil.DesignerAction.AppendDatasourceDetails,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.AppendDatasourceDetails,datasourceId:this.datasourceInfo.Id,datasourceInfo:this.datasourceInfo,appendDataFileId:this.validFilesForAppend,appendDataFileName:this.appendSelectedTableCollections.getSelectedValue(),copyDatasourceName:BoldBIDashboard.isNullOrUndefined(this.dataSetName)?"":this.dataSetName,schemaCheck:"false"})},{fnction:this.bbdesigner$.proxy(this.appendDatasourceStatus,this)},!0,!0)},n.prototype.serverSchemaCheck=function(n){this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.appendDatasource,{action:BoldBIDashboard.DashboardUtil.DesignerAction.AppendDatasourceDetails,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.AppendDatasourceDetails,datasourceId:this.datasourceInfo.Id,datasourceInfo:this.datasourceInfo,appendDataFileId:this.fileId,appendDataFileName:this.appendSelectedTableCollections.getSelectedValue(),copyDatasourceName:"",schemaCheck:"true",filename:this.fileName,lastmodified:this.lastModifiedFile})},{fnction:this.bbdesigner$.proxy(this.onUploadSuccessforSchemaCheck,this,n)},!0,!0)},n.prototype.onUploadSuccessforSchemaCheck=function(n,t){if(!BoldBIDashboard.isNullOrUndefined(t)){var o=this.dashboardDesigner.element.find(".e-uploaded-file-list-parent").css("display","flex"),u=this.dashboardDesigner.element.find(".bbi-append-file-listing-details").css("display","flex"),r=this.dashboardDesigner.element.find(".bbi-append-file-listing-failure-details"),i=JSON.parse(t.Data);if(n.removeClass("bbi-append-file-status-icon-waiting-spinner"),!BoldBIDashboard.isNullOrUndefined(t)&&t.Status)this.validCount++,this.inValidCount===0&&this.validCount===1&&r.css("display","none"),n.addClass("bbi-append-file-status-icon-success-image"),n.html("Ready to append"),n.css("color","var(--green-2, #27AE60)"),u.html(this.validCount+" "+this.locale.dataSource.appendDsReadyToAppend),BoldBIDashboard.isNullOrUndefined(i.FileName)||i.FileName===""||this.validFilesForAppend.push(i.FileName);else{this.inValidCount++;n.addClass("bbi-append-file-status-icon-failure-image");var s=n.find(".bbi-append-file-status-icon-failure-image"),f=new ejdashboard.popups.Tooltip({content:i.Message}),e="#"+n.attr("id");f.appendTo(e);f.position="TopCenter";r.css("display","flex");u.html(this.validCount+" "+this.locale.dataSource.appendDsReadyToAppend);r.html(this.inValidCount+" "+this.locale.dataSource.appendDsFilesNeedsAttention);n.html("Schema mismatched");n.css("color","#FF3B30");BoldBIDashboard.isNullOrUndefined(i.FileName)||i.FileName===""||this.inValidFilesForAppend.push(i.FileName)}this.isFileselected()}},n.prototype.OnDeleteButtonClickEvent=function(n){var t=this.bbdesigner$(n.currentTarget),i=t.closest(".bbi-append-file-info-parent"),r=i.find(".bbi-append-file-name").html(),u=this.mappingValidFilesWithFileName[r];this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.appendDatasourceDeleteFile,{action:BoldBIDashboard.DashboardUtil.DesignerAction.AppendDatasourceDetails,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.AppendDatasourceDetails,deleteFilename:u})},{fnction:this.bbdesigner$.proxy(this.onappendfileDeleteResponse,this,n)},!0)},n.prototype.changeSelectionType=function(n){!BoldBIDashboard.isNullOrUndefined(n)&&!BoldBIDashboard.isNullOrUndefined(n.args)},n.prototype.onSaveAsClick=function(){var t=this.appendDataSaveAsDialog.data("BoldBIDashboardDialog"),n=this.appendDataDialog.data("BoldBIDashboardDialog");BoldBIDashboard.isNullOrUndefined(n)||n.close();t.open()},n.prototype.validateDataSourceNameExist=function(){var n=this;this.setTimeForDSNameValidation=setTimeout(function(){n.ajaxPostForDSNameValidation=n.dashboardDesigner.modules.util.doAjaxPost("POST",n.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.validatedsname,{action:BoldBIDashboard.DashboardUtil.DesignerAction.GetDsnName,data:JSON.stringify(n.dataSetName)},{fnction:n.bbdesigner$.proxy(n.OnDataSourceNameExistSuccess,n),errfnction:n.bbdesigner$.proxy(n.OnDataSourceNameExistError,n),indicator:[n.bbdesigner$.proxy(n.dashboardDesigner.modules.util.showDataSourceLoadingIndicator,n,n.dashboardDesigner.element,n.id+"_append_dbname"),n.bbdesigner$.proxy(n.dashboardDesigner.modules.util.hideDataSourceLoadingIndicator,n,n.dashboardDesigner.element,n.id+"_append_dbname")]},!0,!0)},500)},n.prototype.OnDataSourceNameExistSuccess=function(n){n.Status&&(this.isDSNameExist=n.Data);this.dashboardDesigner.modules.util.onDataSourceNameExistSuccess(this.id+"_append_dbname",n.Status,this.isDSNameExist,n.Message)},n.prototype.OnDataSourceNameExistError=function(n){this.dashboardDesigner.modules.util.onDataSourceNameExistError(this.id+"_append_dbname",n)},n.prototype.appendDatasourceStatus=function(n){!BoldBIDashboard.isNullOrUndefined(n.ApiStatus)&&n.Status?this.successPopupStatus():this.errorPopupStatus()},n.prototype.PopUpRender=function(){var r=this.appendDataDialog.data("BoldBIDashboardDialog"),n,t,i;r.close();this.disableQuerToolIcons();n=this.dashboardDesigner.element.find(".bbi-append-popup-left-pane");n.removeClass("bbi-append-file-error-popup");n.removeClass("bbi-append-file-success-popup");n.addClass("bbi-append-file-waiting-popup");n.html(this.locale.dataSource.appendDsWaitingPopupText);t=this.dashboardDesigner.element.find(".bbi-append-popup-notification").css("display","flex");t.css("background","#E3EDFC");i=this.dashboardDesigner.element.find(".bbi-append-popup-right-pane");i.addClass("bbi-append-file-banner-close-icon")},n.prototype.errorPopupStatus=function(){var n=this.dashboardDesigner.element.find(".bbi-append-popup-left-pane"),t;n.removeClass("bbi-append-file-waiting-popup");n.addClass("bbi-append-file-error-popup");n.html(this.locale.dataSource.appendDsFailurePopupText);t=this.dashboardDesigner.element.find(".bbi-append-popup-notification");t.css("background","#FFE5E4")},n.prototype.successPopupStatus=function(){var n=this.dashboardDesigner.element.find(".bbi-append-popup-left-pane"),t;n.removeClass("bbi-append-file-waiting-popup");n.addClass("bbi-append-file-success-popup");n.html(this.locale.dataSource.appendDsSuccessPopupText);t=this.dashboardDesigner.element.find(".bbi-append-popup-notification");t.css("background","#DCFFE3")},n.prototype.enableQuerToolIcons=function(){this.ejQueryTool.enableItemByID(this.id+"_dataset_toolbar_li_AppendData");this.ejQueryTool.enableItemByID(this.id+"_dataset_toolbar_li_DashboardParameter");this.ejQueryTool.enableItemByID(this.id+"_dataset_toolbar_li_Expression");this.ejQueryTool.enableItemByID(this.id+"_dataset_toolbar_li_Join");this.ejQueryTool.enableItemByID(this.id+"_dataset_toolbar_li_ConfigureQueryFilters");this.ejQueryTool.enableItemByID(this.id+"_dataset_toolbar_li_ConfigureUserFilters");this.ejQueryTool.enableItemByID(this.id+"_dataset_toolbar_li_Run");this.ejQueryTool.enableItemByID(this.id+"_dataset_toolbar_li_DataSampling");this.dashboardDesigner.element.find("#"+this.id+"_chck_on").removeAttr("disabled");this.dashboardDesigner.element.find("#"+this.id+"_editConnectionButton").removeAttr("disabled");this.dashboardDesigner.element.find("#"+this.id+"_saveButton").removeAttr("disabled");this.dashboardDesigner.element.find("#"+this.id+"_cancelButton").removeAttr("disabled")},n.prototype.disableQuerToolIcons=function(){this.ejQueryTool.disableItemByID(this.id+"_dataset_toolbar_li_AppendData");this.ejQueryTool.disableItemByID(this.id+"_dataset_toolbar_li_DashboardParameter");this.ejQueryTool.disableItemByID(this.id+"_dataset_toolbar_li_Expression");this.ejQueryTool.disableItemByID(this.id+"_dataset_toolbar_li_Join");this.ejQueryTool.disableItemByID(this.id+"_dataset_toolbar_li_ConfigureQueryFilters");this.ejQueryTool.disableItemByID(this.id+"_dataset_toolbar_li_ConfigureUserFilters");this.ejQueryTool.disableItemByID(this.id+"_dataset_toolbar_li_Run");this.ejQueryTool.disableItemByID(this.id+"_dataset_toolbar_li_DataSampling");var n=this.dashboardDesigner.element.find("#"+this.id+"_chck_on").attr("disabled","disabled"),t=this.dashboardDesigner.element.find("#"+this.id+"_editConnectionButton").attr("disabled","disabled"),i=this.dashboardDesigner.element.find("#"+this.id+"_saveButton").attr("disabled","disabled"),r=this.dashboardDesigner.element.find("#"+this.id+"_cancelButton").attr("disabled","disabled")},n.prototype.CloseBanner=function(){this.dashboardDesigner.element.find(".bbi-append-popup-notification").css("display","none");this.enableQuerToolIcons()},n.prototype.onappendfileDeleteResponse=function(n){var u=this.bbdesigner$(n.currentTarget),f,e,h,c,o;this.fileName="";!BoldBIDashboard.isNullOrUndefined(u.parents(".bbi-append-file-info-parent").attr("data-uploadinfo"));var t=u.closest(".bbi-append-file-info-parent"),i=t.find(".bbi-append-file-status-message").html(),s=this.dashboardDesigner.element.find(".bbi-append-file-listing-details"),r=this.dashboardDesigner.element.find(".bbi-append-file-listing-failure-details");BoldBIDashboard.isNullOrUndefined(i&&i!=="")||(i==="Schema mismatched"?(this.inValidCount--,this.inValidCount===0&&this.validCount>=1&&r.css("display","none"),r.html(this.inValidCount+" "+this.locale.dataSource.appendDsFilesNeedsAttention)):(this.validCount--,f=t.find(".bbi-append-file-name").html(),e=this.mappingValidFilesWithFileName[f],this.validFilesForAppend=this.validFilesForAppend.filter(function(n){return n!==e}),this.inValidCount>=1&&this.validCount===0&&r.css("display","flex"),s.html(this.validCount+" "+this.locale.dataSource.appendDsReadyToAppend)));t.remove();this.isFileselected();this.dashboardDesigner.element.find(".bbi-append-file-info-parent").length===0&&(this.dashboardDesigner.element.find(".bbi-append-file-listing-parent").css("display","none"),h=this.dashboardDesigner.element.find(".e-uploaded-file-list-parent").css("display","none"),this.inValidCount=0,this.validCount=0,this.mappingValidFilesWithFileName={},c=this.dashboardDesigner.element.find("#"+this.id+"_append_data_append").attr("disabled","disabled"),o=this.dashboardDesigner.element.find("#"+this.id+"_append_data_save_as").attr("disabled","disabled"),o.css("border","1px solid #B3B3B3"))},n.prototype.isFileselected=function(){var t,n;BoldBIDashboard.isNullOrUndefined(this.inValidCount)||this.inValidCount!==0?(t=this.dashboardDesigner.element.find("#"+this.id+"_append_data_append").attr("disabled","disabled"),n=this.dashboardDesigner.element.find("#"+this.id+"_append_data_save_as").attr("disabled","disabled"),n.css("border","1px solid #B3B3B3")):(t=this.dashboardDesigner.element.find("#"+this.id+"_append_data_append").removeAttr("disabled"),n=this.dashboardDesigner.element.find("#"+this.id+"_append_data_save_as").css("border","1px solid var(--primary-btn-border-normal-color)"),n.css("color","#0565FF"),n.removeAttr("disabled"))},n.prototype.validateDsNameField=function(n){var t=this.bbdesigner$(n.currentTarget).attr("id"),u=this.dashboardDesigner.element.find("#"+t+"_error_icon_td"),i,r;(n.keyCode>=48&&n.keyCode<=57||n.keyCode>=65&&n.keyCode<=90||n.keyCode>=186&&n.keyCode<=191||n.keyCode>=219&&n.keyCode<=222||n.keyCode===8||n.keyCode===9||n.keyCode===13||n.keyCode===46||n.keyCode===16)&&this.dataSetName!==this.dashboardDesigner.element.find("#"+t).val()&&(BoldBIDashboard.DashboardUtil.showErrIndictor(u,!1),i=this.id+"_append_dbname",this.dataSetName=this.dashboardDesigner.element.find("#"+i).val().trim(),this.clearRequestTimeout(),this.dataSetName===this.tempdatasetName?(this.dataSourceInstance.showValidationMsg(this.id+"_append_dbname",!0,this.locale.saveDatasourceDialog.datasourceAlreadyExistsText),this.isDSNameExist=!0):(r=this.dashboardDesigner.modules.util.isDataSourceNameExist(this.id,this.dataSetName),r&&this.validateDataSourceNameExist()))},n.prototype.datasourceNameFieldTextChange=function(n){var t=this.bbdesigner$(n.currentTarget).attr("id");this.dataSetName!==this.dashboardDesigner.element.find("#"+t).val().trim()&&(this.dataSetName=this.dashboardDesigner.element.find("#"+t).val().trim(),this.dataSourceInstance.showValidationMsg(t,!1),this.validateDataSourceNameExist())},n.prototype.clearRequestTimeout=function(){this.setTimeForDSNameValidation!=null&&(clearTimeout(this.setTimeForDSNameValidation),this.setTimeForDSNameValidation=null);BoldBIDashboard.isNullOrUndefined(this.ajaxPostForDSNameValidation)||(this.ajaxPostForDSNameValidation.abort(),this.ajaxPostForDSNameValidation=null)},n.prototype.wireEvents=function(){this.dashboardDesigner.element.on("keyup","#"+this.id+"_append_dbname",this.bbdesigner$.proxy(this.validateDsNameField,this));this.dashboardDesigner.element.on("change","#"+this.id+"_append_dbname",this.bbdesigner$.proxy(this.datasourceNameFieldTextChange,this));this.dashboardDesigner.element.on("click","#"+this.id+"_append_data_save",this.bbdesigner$.proxy(this.appendFileTosaveAsServer,this));this.dashboardDesigner.element.on("click","#"+this.id+"_append_data_cancel",this.bbdesigner$.proxy(this.closeAppendDialog,this));this.dashboardDesigner.element.on("click",".bbi-append-file-browse-text",this.bbdesigner$.proxy(this.onUploadBrowseClick,this));this.dashboardDesigner.element.on("click","#"+this.id+"_append_data_append",this.bbdesigner$.proxy(this.appendFiletoServer,this));this.dashboardDesigner.element.on("click","#"+this.id+"_append_data_saveAsDlgclose",this.bbdesigner$.proxy(this.closeSaveAsDialog,this));this.dashboardDesigner.element.on("click",".bbi-append-file-delete-icon",this.bbdesigner$.proxy(this.OnDeleteButtonClickEvent,this));this.dashboardDesigner.element.on("click",".bbi-append-file-banner-close-icon",this.bbdesigner$.proxy(this.CloseBanner,this));this.dashboardDesigner.element.on("click","#"+this.id+"_append_data_save_as",this.bbdesigner$.proxy(this.onSaveAsClick,this))},n.prototype.unWireEvents=function(){this.dashboardDesigner.element.off("keyup","#"+this.id+"_append_dbname",this.bbdesigner$.proxy(this.validateDsNameField,this));this.dashboardDesigner.element.off("change","#"+this.id+"_append_dbname",this.bbdesigner$.proxy(this.datasourceNameFieldTextChange,this));this.dashboardDesigner.element.off("click","#"+this.id+"_append_data_save",this.bbdesigner$.proxy(this.appendFileTosaveAsServer,this));this.dashboardDesigner.element.off("click","#"+this.id+"_append_data_cancel",this.bbdesigner$.proxy(this.closeAppendDialog,this));this.dashboardDesigner.element.off("click",".bbi-append-file-browse-text",this.bbdesigner$.proxy(this.onUploadBrowseClick,this));this.dashboardDesigner.element.off("click","#"+this.id+"_append_data_append",this.bbdesigner$.proxy(this.appendFiletoServer,this));this.dashboardDesigner.element.off("click","#"+this.id+"_append_data_saveAsDlgclose",this.bbdesigner$.proxy(this.closeSaveAsDialog,this));this.dashboardDesigner.element.off("click",".bbi-append-file-delete-icon",this.bbdesigner$.proxy(this.OnDeleteButtonClickEvent,this));this.dashboardDesigner.element.off("click",".bbi-append-file-banner-close-icon",this.bbdesigner$.proxy(this.CloseBanner,this));this.dashboardDesigner.element.off("click","#"+this.id+"_append_data_save_as",this.bbdesigner$.proxy(this.onSaveAsClick,this))},n.prototype.destroy=function(){this.unWireEvents()},n}(),function(n){n[n.file="File"]="file";n[n.datasource="Datasource"]="datasource"}(DataMode||(DataMode={}));window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.AppendDatasource",InternalAppendDatasource,window);InternalDateRangePopup=function(){function n(n){this.parameterList=[];this.filterInfo=new DimensionFilterInfo;this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.id=this.dashboardDesigner._id;this.dateFormat=this.dashboardDesigner.model.localeSettings.dateFormat+" "+this.dashboardDesigner.model.localeSettings.timeFormat}return n.prototype.renderDateRangePopup=function(n){var r=n+"_dateRange_popup",p=this.dashboardDesigner.element.find("#"+r);if((BoldBIDashboard.isNullOrUndefined(this.dateRangePopUp)||this.dateRangePopUp.length===0)&&p.length===0){this.dateRangePopUp=BoldBIDashboard.buildTag("div.bbi-daterange-popup","",{},{id:n+"_dateRange_popup"});var u=BoldBIDashboard.buildTag("div.bbi-date-range-checkBbox","",{}),f=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),t=BoldBIDashboard.buildTag("tr","",{},{});this.renderRadioButton("Ranges",n,n+"_RangeBtn",!0,t,this.onRangeTypeChange,this);this.renderRadioButton("Start Date",n,n+"_startBtn",!1,t,this.onRangeTypeChange,this);this.renderRadioButton("End Date",n,n+"_endBtn",!1,t,this.onRangeTypeChange,this);var i=BoldBIDashboard.buildTag("div.bbi-date-range-field","",{},{id:n+"_dateRange_fieldDiv"}),e=BoldBIDashboard.buildTag("div","",{"margin-top":"6px"},{id:n+"_dateRange_start_tr"}),o=BoldBIDashboard.buildTag("div","",{"margin-top":"12px"},{id:n+"_dateRange_end_tr"}),s=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),h=BoldBIDashboard.buildTag("tr","",{},{}),c=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),l=BoldBIDashboard.buildTag("tr","",{},{}),a=BoldBIDashboard.buildTag("div.bbi-date-range-popup-footer","",{},{}),v=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary bbi-date-range-foot-btn",this.locale.dialogOptions.applyButtonText,{},{id:n+"_dateRange_okBtn",type:"button",disabled:"disabled"}),y=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left bbi-date-range-foot-btn",this.locale.dialogOptions.cancelButtonText,{},{id:n+"_dateRange_cancelBtn",type:"button"});this.dashboardDesigner.element.append(this.dateRangePopUp);f.append(t);u.append(f);this.dateRangePopUp.append(u);e.append(s);s.append(h);this.renderDateRangePicker(n+"_dateRange_Start",n,"Start",h,this.onPickerChange,this);o.append(c);c.append(l);this.renderDateRangePicker(n+"_dateRange_end",n,"End",l,this.onPickerChange,this);i.append(e);i.append(o);this.dateRangePopUp.append(i);a.append(y).append(v);this.dateRangePopUp.append(a);this.dateRangePopUp.css("z-index",this.bbdesigner$("#"+this.id+"_query_filter_dialog_wrapper").css("z-index")+1);v.on("click",this.bbdesigner$.proxy(this.updateDateRangeAttr,this,n));y.on("click",this.bbdesigner$.proxy(this.closeDateRangePopup,this,n));i.BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup "+this.id+"_designer_waiting_popup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()});this.resetAttributes(this.dateRangePopUp,n)}else this.dateRangePopUp=!BoldBIDashboard.isNullOrUndefined(this.dateRangePopUp)&&this.dateRangePopUp.length>0&&r===this.dateRangePopUp[0].id?this.dateRangePopUp:this.dashboardDesigner.element.find("#"+n+"_dateRange_popup");return this.dateRangePopUp},n.prototype.renderDateParameter=function(n,t,i){var r=this.parameterList.filter(function(n){return n.dataType===DynamicParameterDataType.Date}),e=BoldBIDashboard.buildTag("td","",{"padding-left":i==="End"?"20px":"10px",display:"none"},{id:t+"_query_date_"+i+"_parameter_dropdown"}),f=BoldBIDashboard.buildTag("input.e-textbox","",{height:"30px",width:"160px"},{type:"text",id:t+"_date_"+i+"_param"}),u;e.append(f);u=!BoldBIDashboard.isNullOrUndefined(r)&&r.length>0?r[0].value:null;f.BoldBIDashboardDropDownList({width:"130px",height:"26px",popupWidth:f.width(),field:{text:"text",value:"value",name:"name",id:"id"},dataSource:r,enabled:!0,value:u,selectedIndex:null,showRoundedCorner:!0,cssClass:"bbi-dbrd-control",change:this.bbdesigner$.proxy(this.parameterBtwChangeEvent,this,t,i,r)});n.append(e);this.dashboardDesigner.element.find("#"+t+"_date_"+i+"_param").data("ParameterInfos",{Name:u,Id:r.length>0?r[0].parameterID:u})},n.prototype.parameterBtwChangeEvent=function(n,t,i,r){var f=this.dashboardDesigner.element.find("#"+n+"_date_"+t+"_param"),u=r.model.dataSource.filter(function(n){return n.value===r.value}),e={Name:r.value,Id:u.length>0?u[0].parameterID:r.value};f.data("ParameterInfos",e)},n.prototype.resetAttributes=function(n,t){n.removeAttr("IsLoaded");n.removeAttr("Range");n.removeAttr("StartDate");n.removeAttr("EndDate");n.removeAttr("IsPopulate");this.getStartPicker(t).removeAttr("minDateTime");this.getEndPicker(t).removeAttr("minDateTime")},n.prototype.showLoadingIndicator=function(n){var t=this.getFieldDiv(n);t.BoldBIDashboardWaitingPopup("show");this.getRangeRadioBtn(n).prop("disabled",!0);this.getStartRadioBtn(n).prop("disabled",!0);this.getEndRadioBtn(n).prop("disabled",!0)},n.prototype.hideLoadingIndicator=function(n){var t=this.getFieldDiv(n);t.BoldBIDashboardWaitingPopup("hide");this.getRangeRadioBtn(n).prop("disabled",!1);this.getStartRadioBtn(n).prop("disabled",!1);this.getEndRadioBtn(n).prop("disabled",!1)},n.prototype.populateDateRangeDrpDwn=function(n,t,i,r,u,f,e){this.targetTag.find("#"+n+"_dateRange_multidDrpDwn").off("click",this.bbdesigner$.proxy(this.showPopupContainer,this,n,t,i,r,e,f));this.targetTag.find("#"+n+"_dateRange_multidDrpDwn").on("click",this.bbdesigner$.proxy(this.showPopupContainer,this,n,t,i,r,e,f));this.populateDateRangePopup(n,u)},n.prototype.resetDateRangeDrpDwn=function(n){BoldBIDashboard.isNullOrUndefined(this.dateRangePopUp)?null:this.dateRangePopUp.remove();this.dateRangePopUp=null;this.renderDateRangePopup(n)},n.prototype.renderDateRangeDrpDwn=function(n,t,i,r,u,f,e){this.filterInfo=u;this.targetTag=t;var o=BoldBIDashboard.buildTag("div.list bbi-popup-button","",{width:e?e:"144px"},{id:n+"_dateRange_multidDrpDwn","e-target":"bbi-daterange-popup"}),s=BoldBIDashboard.buildTag("div.bbi-date-range-drp-dwn-text","",{width:e?e-39+"px":"calc(100% - 35px)"},{id:n+"_dateRange_multiDrpDwn_txt",text:"Date Options"}),h=BoldBIDashboard.buildTag("div.bbi-date-range-drp-dwn-btn","",{},{}),c=BoldBIDashboard.buildTag("span.bbi-designer-ejwidgets-updown e-icon e-arrow-sans-down bbi-date-range-drpdwn-icon","",{});h.append(c);o.append(s).append(h);s.text("Date Options");t.append(o);o.attr("e-targetId",n+"_dateRange_popup");o.bind("click",this.bbdesigner$.proxy(this.showPopupContainer,this,n,t,i,r,e,f));BoldBIDashboard.isNullOrUndefined(this.filterInfo)||this.populateDateRangePopup(n,this.filterInfo)},n.prototype.updateIconIndication=function(n,t){var i=this.getDateRangeDrpDwn(t);n.css("display")==="block"?(i.find(".bbi-designer-ejwidgets-updown").removeClass("e-arrow-sans-down").addClass("e-arrow-sans-up"),i.addClass("e-focus"),this.enableApplyButton(t)):(i.find(".bbi-designer-ejwidgets-updown").removeClass("e-arrow-sans-up").addClass("e-arrow-sans-down"),i.removeClass("e-focus"))},n.prototype.renderRadioButton=function(n,t,i,r,u){var e=this.bbdesigner$("<td unselectable='on'/>"),f,o;u.append(e);f=BoldBIDashboard.buildTag("div","",{},{});o={callBackInstance:this,callBackMethod:"onRangeTypeChange",optionalArgs:t,groupName:"formatting",labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:i,label:n,isChecked:r,value:t}]};this.selectRadioButton=new BoldBIDashboard.Dashboard.RadioButton(o,f);e.append(f)},n.prototype.renderDateRangePicker=function(n,t,i,r,u,f){var e=BoldBIDashboard.buildTag("td","",{}),h=BoldBIDashboard.buildTag("Label.bbi-designer-add-label",i,{},{type:"label"}),o=BoldBIDashboard.buildTag("td","",{"padding-left":i==="Start"?"9px":"15px",display:"block"},{id:n}),s=BoldBIDashboard.buildTag("input.bbi-popup-button","",{},{type:"text",id:n+"_picker"});e.append(h);o.append(s);r.append(e);this.renderDateParameter(r,t,i);r.append(o);s.BoldBIDashboardDateTimePicker({width:"201px",height:"26px",change:this.bbdesigner$.proxy(u,f,t),cssClass:"bbi-designer-border bbi-popup-button e-dashboarddesigner-widget"})},n.prototype.showPopupContainer=function(n,t,i,r,u,f){var e=this.renderDateRangePopup(n),a=this.dashboardDesigner.element.find("#"+n+"_param"),v=a.data("selectedType"),h=v!=="Parameters",l;this.parameterList=h?this.parameterList:this.dashboardDesigner.modules.queryFilter.parameterList;var c=e.height(),o=t,y=e.css("display")==="block",s=o.offset();e.css({display:y?"none":"block","z-index":BoldBIDashboard.getMaxZindex()});var p=window.innerHeight-(s.top+o.height()),w=p>c,b=w?s.top+o.height()+2:s.top-c-4;e.offset({left:s.left+parseFloat(o.css("padding-left"))-(u?26:126),top:b});h?this.updateIconIndication(e,n):e.find("#"+n+"_dateRange_okBtn").removeAttr("disabled");e.css("display")==="block"&&h&&(BoldBIDashboard.isNullOrUndefined(e.attr("IsLoaded"))||e.attr("IsLoaded")==="false"?(l=[{Id:r.Id,Name:r.Name,SummaryType:"None",Sorting:"Ascending",FieldType:"Dimensions",MeasureFormatting:null,DateTimeFormat:"Date",FilterInfo:null}],this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.FilterAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,fieldInfo:l,dataSetId:i,type:"date",dateRangeType:f,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.setFieldInformation,this,n),indicator:[this.bbdesigner$.proxy(this.showLoadingIndicator,this,n),this.bbdesigner$.proxy(this.hideLoadingIndicator,this,n)]})):this.setDatePopupValues(n))},n.prototype.setFieldInformation=function(n,t){var e=this.renderDateRangePopup(n),o=this.dashboardDesigner.element.find("#"+n+"_dateRange_Start_picker"),s=this.dashboardDesigner.element.find("#"+n+"_dateRange_end_picker"),u=o.data("BoldBIDashboardDateTimePicker"),f=s.data("BoldBIDashboardDateTimePicker"),i,r;BoldBIDashboard.isNullOrUndefined(u.model)||(u.model.dateTimeFormat=this.dateFormat,f.model.dateTimeFormat=this.dateFormat);i=BoldBIDashboard.format(new Date(t.MinValue),this.dateFormat);r=BoldBIDashboard.format(new Date(t.MaxValue),this.dateFormat);e.attr("isLoaded","true");o.attr("minDateTime",i).attr("maxDateTime",r);s.attr("minDateTime",i).attr("maxDateTime",r);u.setModel({minDateTime:i,maxDateTime:r});f.setModel({minDateTime:i,maxDateTime:r});e.attr("IsPopulate")==="true"?this.setDatePopupValues(n):(u.setModel({value:i}),f.setModel({value:r}))},n.prototype.setDatePopupValues=function(n){var t=this.renderDateRangePopup(n),o=BoldBIDashboard.isNullOrUndefined(t.attr("Range"))?DateFormatOption.Range.toString():t.attr("Range"),s=BoldBIDashboard.isNullOrUndefined(t.attr("StartDate"))?"":t.attr("StartDate"),h=BoldBIDashboard.isNullOrUndefined(t.attr("EndDate"))?"":t.attr("EndDate"),i="block",r="block",c=this.getStartTr(n),l=this.getEndTr(n),u=this.getRangeRadioBtn(n),f=this.getStartRadioBtn(n),e=this.getEndRadioBtn(n);o===DateFormatOption.StartDate.toString()?(u.prop("checked",!1),f.prop("checked",!0),e.prop("checked",!1),r="none",i="block"):o===DateFormatOption.EndDate.toString()?(u.prop("checked",!1),f.prop("checked",!1),e.prop("checked",!0),r="block",i="none"):(u.prop("checked",!0),f.prop("checked",!1),e.prop("checked",!1));c.css("display",i);l.css("display",r);this.getStartPicker(n).data("BoldBIDashboardDateTimePicker").setModel({value:s.length===0?this.getStartPicker(n).attr("minDateTime"):s});this.getEndPicker(n).data("BoldBIDashboardDateTimePicker").setModel({value:h.length===0?this.getEndPicker(n).attr("maxDateTime"):h});this.enableApplyButton(n)},n.prototype.closeDateRangePopup=function(n){var t=this.renderDateRangePopup(n);t.css("display","none");this.updateIconIndication(t,n)},n.prototype.updateDateFormatCondition=function(n,t){var i=this.getRangeRadioBtn(n),r=this.getStartRadioBtn(n),u=this.getEndRadioBtn(n),f="block",e="block",o=this.getStartTr(n),s=this.getEndTr(n);t===DateFormatOption.StartDate.toString()?(i.prop("checked",!1),r.prop("checked",!0),u.prop("checked",!1),e="none",f="block"):t===DateFormatOption.EndDate.toString()?(i.prop("checked",!1),r.prop("checked",!1),u.prop("checked",!0),e="block",f="none"):(i.prop("checked",!0),r.prop("checked",!1),u.prop("checked",!1));o.css("display",f);s.css("display",e)},n.prototype.populateDateRangePopup=function(n,t){var i,r;BoldBIDashboard.isNullOrUndefined(this.dateRangePopUp)?null:this.dateRangePopUp.remove();this.dateRangePopUp=null;i=this.renderDateRangePopup(n);this.filterInfo=t;this.getDateRangeDrpDwnTxt(n).text("Date Options");this.updateIconIndication(i,n);i.attr("IsPopulate","true");BoldBIDashboard.isNullOrUndefined(t)?(this.resetAttributes(i,n),this.updateDateFormatCondition(n,DateFormatOption.Range.toString())):(i.attr({StartDate:t.StartDate,EndDate:t.EndDate,Range:t.DateFormatCondition}),r=t.DateFormatCondition,this.updateDateFormatCondition(n,r))},n.prototype.updateDateRangeAttr=function(n){var t=this.renderDateRangePopup(n),i=this.getStartRadioBtn(n).prop("checked"),r=this.getEndRadioBtn(n).prop("checked"),u=this.getStartPicker(n).data("BoldBIDashboardDateTimePicker").getValue(),f=this.getEndPicker(n).data("BoldBIDashboardDateTimePicker").getValue();t.css("display","none");this.updateIconIndication(t,n);this.hideErrorIndicator(n);t.attr("StartDate",u);t.attr("EndDate",f);r?t.attr("Range",DateFormatOption.EndDate.toString()):i?t.attr("Range",DateFormatOption.StartDate.toString()):t.attr("Range",DateFormatOption.Range.toString())},n.prototype.hideErrorIndicator=function(n){var t=this.dashboardDesigner.element.find("#"+n).find(".e-error-tip");t.length>0&&t.css("display","none")},n.prototype.getDateRangeValues=function(n){var t=this.renderDateRangePopup(n),u="Range",f=BoldBIDashboard.isNullOrUndefined(t.attr("Range"))?DateFormatOption.Range.toString():t.attr("Range"),i,r;return u=f===DateFormatOption.StartDate.toString()?DateFormatOption.StartDate.toString():f===DateFormatOption.EndDate.toString()?DateFormatOption.EndDate.toString():DateFormatOption.Range.toString(),i=BoldBIDashboard.isNullOrUndefined(t.attr("StartDate"))?"":t.attr("StartDate"),r=BoldBIDashboard.isNullOrUndefined(t.attr("EndDate"))?"":t.attr("EndDate"),{StartDate:i,EndDate:r,DateFormatCondition:u,IsFilterApplied:i===""&&r===""?!1:!0}},n.prototype.onRangeTypeChange=function(n){var t=n.args.value,s=this.getStartRadioBtn(t).prop("checked"),h=this.getEndRadioBtn(t).prop("checked"),e=this.getStartTr(t),o=this.getEndTr(t),c=this.dashboardDesigner.element.find("#"+t+"_param"),u=c.data("selectedType"),f=u==="Parameters",i=BoldBIDashboard.isNullOrUndefined(this.parameterList)?f?this.dashboardDesigner.modules.queryFilter.parameterList:this.parameterList:this.parameterList,r;i=i.filter(function(n){return n.dataType===DynamicParameterDataType.Date});r=!BoldBIDashboard.isNullOrUndefined(i)&&i.length>0?i[0].value:null;n.args.event.type==="change"&&(s?(o.css("display","none"),e.css("display","block"),f?this.dashboardDesigner.modules.queryFilter.setDataForDateDropdowns(t,r,null,u):null):h?(e.css("display","none"),o.css({display:"block","margin-top":"6px"}),f?this.dashboardDesigner.modules.queryFilter.setDataForDateDropdowns(t,null,r,u):null):(e.css("display","block"),o.css({display:"block","margin-top":"6px"}),f?this.dashboardDesigner.modules.queryFilter.setDataForDateDropdowns(t,r,r,u):null))},n.prototype.onPickerChange=function(n,t){t.isInteraction&&this.enableApplyButton(n)},n.prototype.enableApplyButton=function(n){var i=this.getStartPicker(n).data("BoldBIDashboardDateTimePicker").getValue(),r=this.getEndPicker(n).data("BoldBIDashboardDateTimePicker").getValue(),f=this.getStartPicker(n).attr("minDateTime"),t=this.getStartPicker(n).attr("maxDateTime"),e=this.getApplyBtn(n),o=this.getStartRadioBtn(n).prop("checked"),s=this.getEndRadioBtn(n).prop("checked"),u=!0;u=o?i!==f?!0:!1:s?r!==t?!0:!1:i!==t||r!==t?!0:!1;BoldBIDashboard.DashboardUtil.buttonEnable(e,u)},n.prototype.updateDateFormat=function(){this.dateFormat=this.dashboardDesigner.model.localeSettings.dateFormat+" "+this.dashboardDesigner.model.localeSettings.timeFormat},n.prototype.getRangeRadioBtn=function(n){return this.dashboardDesigner.element.find("#"+n+"_RangeBtn_rdo_input")},n.prototype.getStartRadioBtn=function(n){return this.dashboardDesigner.element.find("#"+n+"_startBtn_rdo_input")},n.prototype.getEndRadioBtn=function(n){return this.dashboardDesigner.element.find("#"+n+"_endBtn_rdo_input")},n.prototype.getDateRangeDrpDwn=function(n){return this.targetTag.find("#"+n+"_dateRange_multidDrpDwn")},n.prototype.getStartPicker=function(n){return this.dashboardDesigner.element.find("#"+n+"_dateRange_Start_picker")},n.prototype.getEndPicker=function(n){return this.dashboardDesigner.element.find("#"+n+"_dateRange_end_picker")},n.prototype.getStartTr=function(n){return this.dashboardDesigner.element.find("#"+n+"_dateRange_start_tr")},n.prototype.getEndTr=function(n){return this.dashboardDesigner.element.find("#"+n+"_dateRange_end_tr")},n.prototype.getDateRangeDrpDwnTxt=function(n){return this.targetTag.find("#"+n+"_dateRange_multiDrpDwn_txt")},n.prototype.getApplyBtn=function(n){return this.dashboardDesigner.element.find("#"+n+"_dateRange_okBtn")},n.prototype.getFieldDiv=function(n){return this.dashboardDesigner.element.find("#"+n+"_dateRange_fieldDiv")},n.prototype.updateParameterListInfo=function(n){this.parameterList=n},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.DateRangePopup",InternalDateRangePopup,window),function(n){n[n.Range="Range"]="Range";n[n.StartDate="StartDate"]="StartDate";n[n.EndDate="EndDate"]="EndDate"}(DateFormatOption||(DateFormatOption={}));InternalExpressionParsor=function(){function n(){this.revfnctions={};this.expErrors=[];this.expErrors=[]}return n.prototype.parseExpression=function(n){var i,t;for(this.expression=n,this.provider="SQL",this.expErrors=[],this.parseDateExp(),this.parseNumExp(),this.parseStrExp(),this.parseCondExp(),i=Object.keys(this.revfnctions),t=i.length-1;t>=0;t--)this.revfnctions[i[t]]&&(this.expression=this.expression.split(i[t]).join(this.revfnctions[i[t]]));return this.expression},n.prototype.parseErrors=function(n,t){return this.parseExpression(n,t),this.expErrors},n.prototype.parseNumExp=function(){BoldBIDashboard.DashboardUtil.contains(this.expression,"abs(",!0)&&(this.expression=this.parseNumberExp(this.expression,"abs("));BoldBIDashboard.DashboardUtil.contains(this.expression,"acos(",!0)&&(this.expression=this.parseNumberExp(this.expression,"acos("));BoldBIDashboard.DashboardUtil.contains(this.expression,"asin(",!0)&&(this.expression=this.parseNumberExp(this.expression,"asin("));BoldBIDashboard.DashboardUtil.contains(this.expression,"atan(",!0)&&(this.expression=this.parseNumberExp(this.expression,"atan("));BoldBIDashboard.DashboardUtil.contains(this.expression,"cos(",!0)&&(this.expression=this.parseNumberExp(this.expression,"cos("));BoldBIDashboard.DashboardUtil.contains(this.expression,"cot(",!0)&&(this.expression=this.parseNumberExp(this.expression,"cot("));BoldBIDashboard.DashboardUtil.contains(this.expression,"ceil(",!0)&&(this.expression=this.parseNumberExp(this.expression,"ceil("));BoldBIDashboard.DashboardUtil.contains(this.expression,"degrees(",!0)&&(this.expression=this.parseNumberExp(this.expression,"degrees("));BoldBIDashboard.DashboardUtil.contains(this.expression,"exp(",!0)&&(this.expression=this.parseNumberExp(this.expression,"exp("));BoldBIDashboard.DashboardUtil.contains(this.expression,"floor(",!0)&&(this.expression=this.parseNumberExp(this.expression,"floor("));BoldBIDashboard.DashboardUtil.contains(this.expression,"log(",!0)&&(this.expression=this.parseNumberExp(this.expression,"log("));BoldBIDashboard.DashboardUtil.contains(this.expression,"mod(",!0)&&(this.expression=this.parseNumberExp(this.expression,"mod("));BoldBIDashboard.DashboardUtil.contains(this.expression,"pi(",!0)&&(this.expression=this.parseNumberExp(this.expression,"pi("));BoldBIDashboard.DashboardUtil.contains(this.expression,"power(",!0)&&(this.expression=this.parseNumberExp(this.expression,"power("));BoldBIDashboard.DashboardUtil.contains(this.expression,"totalpercentage(",!0)&&(this.expression=this.parseNumberExp(this.expression,"totalpercentage("));BoldBIDashboard.DashboardUtil.contains(this.expression,"radians(",!0)&&(this.expression=this.parseNumberExp(this.expression,"radians("));BoldBIDashboard.DashboardUtil.contains(this.expression,"round(",!0)&&(this.expression=this.parseNumberExp(this.expression,"round("));BoldBIDashboard.DashboardUtil.contains(this.expression,"sign(",!0)&&(this.expression=this.parseNumberExp(this.expression,"sign("));BoldBIDashboard.DashboardUtil.contains(this.expression,"sin(",!0)&&(this.expression=this.parseNumberExp(this.expression,"sin("));BoldBIDashboard.DashboardUtil.contains(this.expression,"sqrt(",!0)&&(this.expression=this.parseNumberExp(this.expression,"sqrt("));BoldBIDashboard.DashboardUtil.contains(this.expression,"tan(",!0)&&(this.expression=this.parseNumberExp(this.expression,"tan("))},n.prototype.parseNumberExp=function(n,t){var f=this.getExpCode(),e=this.trimEnd(t,"("),r=0,i=n,h;this.revfnctions[f]=this.updateNumberFunc(e).toUpperCase();do if(r=i.toLowerCase().lastIndexOf(t),r!==-1){var u=r+t.length,o=this.getFunctionEndIndex(u,i),c=this.getParameters(i,u,o-u-1),l=i.substr(0,r)+f+"(",s="";this.provider==="SQL"&&(s=this.getSQLNumberExp(e,c));h=")"+i.substr(o);i=l+s+h}while(r!==-1);return i},n.prototype.updateNumberFunc=function(n){return n},n.prototype.getSQLNumberExp=function(n,t){var i="";switch(n){case"pi":BoldBIDashboard.isNullOrUndefined(t)?i=i:this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"abs":case"acos":case"asin":case"atan":case"cos":case"cot":case"degrees":case"exp":case"floor":case"log":case"totalpercentage":case"radians":case"sign":case"sin":case"sqrt":case"tan":t&&t.length===1?i+=t[0]:this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"power":t&&t.length===2?i+=t[0]+","+t[1]:this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"mod":t&&t.length===2?i+=t[0]+","+t[1]:this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"round":t&&t.length===1?(i+=t[0],this.provider==="SQL"&&(i+=",0")):t&&(t.length===1||t.length===2)?i+=t[0]+","+t[1]:this.expErrors.push("Invalid Arguments in"+n+"Expression")}return i},n.prototype.parseDateExp=function(){this.provider==="SQL"&&(BoldBIDashboard.DashboardUtil.contains(this.expression,"currentyear(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"currentyear(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"currentmonth(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"currentmonth(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"dateadd(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"dateadd(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"datesub(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"datesub(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"datename(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"datename(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"datepart(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"datepart(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"daydiff(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"daydiff(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"today(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"today(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"previousyear(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"previousyear(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"previousmonth(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"previousmonth(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"yesterday(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"yesterday(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"day(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"day(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"hour(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"hour(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"minute(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"minute(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"month(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"month(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"now(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"now(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"year(",!0)&&(this.expression=this.parseSQLDateExp(this.expression,"year(")))},n.prototype.parseSQLDateExp=function(n,t){var f=this.getExpCode(),i=this.trimEnd(t,"("),u=0,r=n;this.revfnctions[f]=this.updateDateFunc(i).toUpperCase();do if(u=r.toLowerCase().lastIndexOf(t),u!==-1){var e=u+t.length,o=this.getFunctionEndIndex(e,r),s=this.getParameters(r,e,o-e-1),h=i==="today"||i==="yesterday"||i==="currentyear"||i==="currentmonth"||i==="previousyear"||i==="previousmonth"?r.substr(0,u)+f:r.substr(0,u)+f+"(",c=this.getSQLDateExp(i,s),l=i==="today"||i==="yesterday"||i==="currentyear"||i==="currentmonth"||i==="previousyear"||i==="previousmonth"?r.substr(o):")"+r.substr(o);r=h+c+l}while(u!==-1);return r},n.prototype.updateDateFunc=function(n){var t;switch(n){case"dateadd":case"datesub":t="dateadd";break;case"daydiff":t="datediff";break;case"now":t="getdate";break;case"week":case"hour":case"minute":case"datepart":t="datepart";break;case"day":case"month":case"year":case"datename":case"yesterday":case"currentyear":case"currentmonth":case"previousmonth":case"previousyear":t=n;break;case"today":t="CAST(GETDATE() AS DATE)"}return t},n.prototype.getSQLDateExp=function(n,t){var i="";switch(n){case"dateadd":t&&t.length===3?i+=t[0]+","+t[1]+","+t[2]:this.expErrors.push("Invalid Arguments in"+n+"Expression");break;case"datesub":t&&t.length===1?i+="D, 0,"+t[0]:t&&t.length===2?i+="D, -"+t[0]+","+t[1]:this.expErrors.push("Invalid Arguments in"+n+"Expression");break;case"daydiff":t&&t.length===2?i+="D,"+t[0]+","+t[1]:this.expErrors.push("Invalid Arguments in"+n+"Expression");break;case"week":case"hour":case"minute":t&&t.length===1?i+=n.toUpperCase()+","+t[0]:this.expErrors.push("Invalid Arguments in"+n+"Expression");break;case"datename":case"datepart":t&&t.length===1&&(i+="D,"+t[0]);t&&t.length===2?i+=t[0]+","+t[1]:this.expErrors.push("Invalid Arguments in"+n+"Expression");break;case"day":case"month":case"year":t&&t.length===1?i+=t[0]:this.expErrors.push("Invalid Arguments in"+n+"Expression")}return i},n.prototype.parseCondExp=function(){this.provider==="SQL"&&(BoldBIDashboard.DashboardUtil.contains(this.expression,"coalesce(",!0)&&(this.expression=this.parseSQLCondExp(this.expression,"coalesce(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"ifnull(",!0)&&(this.expression=this.parseSQLCondExp(this.expression,"ifnull(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"if(",!0)&&(this.expression=this.parseSQLCondExp(this.expression,"if(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"isnull(",!0)&&(this.expression=this.parseSQLCondExp(this.expression,"isnull(")),BoldBIDashboard.DashboardUtil.contains(this.expression,"isnotnull(",!0)&&(this.expression=this.parseSQLCondExp(this.expression,"isnotnull(")))},n.prototype.parseSQLCondExp=function(n,t){var f=this.trimEnd(t,"("),r=0,i=n;if(f==="ifnull")i=this.parseSQLIFNullExp(n,t);else do if(r=i.toLowerCase().lastIndexOf(t),r!==-1){var e=this.getExpCode(),u=r+t.length,o=this.getFunctionEndIndex(u,i),s=this.getParameters(i,u,o-u-1),h=i.substr(0,r)+e,c=i.substr(o);this.revfnctions[e]=this.getSQLCondExp(f,s);i=h+c}while(r!==-1);return i},n.prototype.parseSQLIFNullExp=function(n,t){var f=this.getExpCode(),o=this.trimEnd(t,"("),r=0,i=n;this.revfnctions[f]="ISNULL";do if(r=i.toLowerCase().lastIndexOf(t),r!==-1){var u=r+t.length,e=this.getFunctionEndIndex(u,i),s=this.getParameters(i,u,e-u-1),h=i.substr(0,r)+f+"(",c=this.getSQLCondExp(o,s),l=")"+i.substr(e);i=h+c+l}while(r!==-1);return i},n.prototype.getSQLCondExp=function(n,t){var i="",u,r;switch(n){case"if":t&&t.length===3?i+=" CASE WHEN "+t[0]+" THEN "+t[1]+" ELSE "+t[2]+" END ":this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"ifnull":t&&t.length===2?i+=t[0]+","+t[1]:this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"isnull":t&&t.length===1?i+=" CASE WHEN "+t[0]+" IS NULL THEN 'true' ELSE 'false' END ":this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"isnotnull":t&&t.length===1?i+=" CASE WHEN "+t[0]+" IS NULL THEN 'false' ELSE 'true' END ":this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"coalesce":if(u=!0,t&&t.length>1)for(r=0;r<t.length;r++)r===t.length-1&&(u=!1),i+=u?t[r].trim()+",":t[r].trim();else this.expErrors.push("Invalid Arguments in "+n+" Expression")}return i},n.prototype.parseStrExp=function(){BoldBIDashboard.DashboardUtil.contains(this.expression,"char(",!0)&&!BoldBIDashboard.DashboardUtil.contains(this.expression,"to_char(",!0)&&(this.expression=this.parseStringExp(this.expression,"char("));BoldBIDashboard.DashboardUtil.contains(this.expression,"concat(",!0)&&(this.expression=this.parseStringExp(this.expression,"concat("));BoldBIDashboard.DashboardUtil.contains(this.expression,"contains(",!0)&&(this.expression=this.parseStringExp(this.expression,"contains("));BoldBIDashboard.DashboardUtil.contains(this.expression,"endswith(",!0)&&(this.expression=this.parseStringExp(this.expression,"endswith("));BoldBIDashboard.DashboardUtil.contains(this.expression,"left(",!0)&&(this.expression=this.parseStringExp(this.expression,"left("));BoldBIDashboard.DashboardUtil.contains(this.expression,"len(",!0)&&(this.expression=this.parseStringExp(this.expression,"len("));BoldBIDashboard.DashboardUtil.contains(this.expression,"lower(",!0)&&(this.expression=this.parseStringExp(this.expression,"lower("));BoldBIDashboard.DashboardUtil.contains(this.expression,"ltrim(",!0)&&(this.expression=this.parseStringExp(this.expression,"ltrim("));BoldBIDashboard.DashboardUtil.contains(this.expression,"max(",!0)&&(this.expression=this.parseStringExp(this.expression,"max("));BoldBIDashboard.DashboardUtil.contains(this.expression,"min(",!0)&&(this.expression=this.parseStringExp(this.expression,"min("));BoldBIDashboard.DashboardUtil.contains(this.expression,"replace(",!0)&&!BoldBIDashboard.DashboardUtil.contains(this.expression,"_replace(",!0)&&(this.expression=this.parseStringExp(this.expression,"replace("));BoldBIDashboard.DashboardUtil.contains(this.expression,"right(",!0)&&(this.expression=this.parseStringExp(this.expression,"right("));BoldBIDashboard.DashboardUtil.contains(this.expression,"rtrim(",!0)&&(this.expression=this.parseStringExp(this.expression,"rtrim("));BoldBIDashboard.DashboardUtil.contains(this.expression,"startswith(",!0)&&(this.expression=this.parseStringExp(this.expression,"startswith("));BoldBIDashboard.DashboardUtil.contains(this.expression,"substr(",!0)&&(this.expression=this.parseStringExp(this.expression,"substr("));BoldBIDashboard.DashboardUtil.contains(this.expression,"trim(",!0)&&(this.expression=this.parseStringExp(this.expression,"trim("))},n.prototype.parseStringExp=function(n,t){var c=this.getExpCode(),i=this.trimEnd(t,"("),u=0,r=n,e=!0,s,f,h;this.revfnctions[c]=this.updateStringFunc(i).toUpperCase();do if(u=r.toLowerCase().lastIndexOf(t),u!==-1){var o=u+t.length,l=this.getFunctionEndIndex(o,r),a=this.getParameters(r,o,l-o-1);(i==="max"||i==="min"||i==="startswith"||i==="endswith"||i==="contains")&&(e=!1);s=r.substr(0,u)+(e?c+"(":"");f="";this.provider==="SQL"&&(f=this.getSQLStringExp(i,a));h=(e?")":"")+r.substr(l);r=i==="max"||i==="min"?s+"("+f+")"+h:s+f+h}while(u!==-1);return r},n.prototype.updateStringFunc=function(n){var t;switch(n){case"contains":case"endswith":case"startswith":case"max":case"min":t="";break;case"substr":t="substring";break;default:t=n}return t},n.prototype.getSQLStringExp=function(n,t){var i="",u,r,f;switch(n){case"char":case"len":case"lower":case"ltrim":case"rtrim":case"trim":case"upper":case"max":case"min":t&&t.length===1?i+=t[0].trim():this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"left":case"right":t&&t.length===2?i+=t[0].trim()+","+t[1].trim():this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"replace":t&&t.length===3?i+=t[0].trim()+","+t[1].trim()+","+t[2].trim():this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"concat":if(u=!0,t&&t.length>1)for(r=0;r<t.length;r++)r===t.length-1&&(u=!1),i+=u?t[r].trim()+",":t[r].trim();else this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"contains":case"endswith":case"startswith":t&&t.length===2?(f=this.customizeSingleQuoteValues(n,t[1]),i+="CASE WHEN "+t[0]+" LIKE "+f+" THEN 'true' ELSE 'false' END"):this.expErrors.push("Invalid Arguments in "+n+" Expression");break;case"substr":t&&t.length===3?i+=t[0].trim()+","+t[1].trim()+","+t[2].trim():this.expErrors.push("Invalid Arguments in "+n+" Expression")}return i},n.prototype.customizeSingleQuoteValues=function(n,t){var i=t,r="",u=null,f;if(i=i.trim(),BoldBIDashboard.DashboardUtil.contains(i,"'",!0))for(f=0;f<i.length;f++)i[f]!=="'"&&(r+=i[f]);if(r.length>0)switch(n){case"contains":u="'%"+r+"%'";break;case"startswith":u="'"+r+"%'";break;case"endswith":u="'%"+r+"'"}else u=i;return u},n.prototype.getParameters=function(n,t,i){var u=n.substr(t,i);if(u.length===0)return null;for(var o=0,f=!1,r=0,e=0,s=[];r<u.length;r++)f||u[r]!==")"||o--,f||u[r]!=="("||o++,u[r]==="'"&&(r===0||u[r-1]!=="\\")&&(f=!f),f||o!==0||u[r]!==","||(s.push(u.substr(e,r-e)),e=r+1);return s.push(u.substr(e,r-e)),s},n.prototype.getFunctionEndIndex=function(n,t){for(var i=n,u=1,r=!1;u>0;){if(i>=t.length)throw"Invalid Expression";r||t[i]!==")"||u--;r||t[i]!=="("||u++;(t[i]==='"'||t[i]==="'")&&(i===0||t[i-1]!=="\\")&&(r=!r);i++}return i},n.prototype.getExpCode=function(){for(var n="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<5;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return"@"+n+"@"},n.prototype.trimEnd=function(n,t){var i=n.lastIndexOf(t);return i===-1?n:n.trim().slice(0,i)},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.ExpressionParsor",InternalExpressionParsor,window);InternalColumnMapping=function(){function n(n){this.columnMappingContainer=null;this.sourceTableDatasource=[];this.targetInstance=null;this.requestInfo=null;this.targetMethod="";this.locale=null;this.dsIds=null;this.columnMappingModel=null;this.tempMappingInfo=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.renderColumnMappingDialog()}return n.prototype.renderColumnMappingDialog=function(){this.columnMappingContainer=BoldBIDashboard.buildTag("div.e-column-mapping-dialog","",{},{id:this.dashboardDesigner._id+"_mappingcolumn_configuration"});this.renderMappingBodyContainer();this.columnMappingContainer.BoldBIDashboardDialog({width:"auto",height:"auto",minWidth:750,minHeight:550,title:this.locale.userFilterLocale.columnMappingText,enableResize:!1,showOnInit:!1,showFooter:!0,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner",enableModal:!0,close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id});this.columnMappingContainer.BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()});this.renderFooter()},n.prototype.renderMappingBodyContainer=function(){var n=BoldBIDashboard.buildTag("div.e-column-mapping-body-container","",{height:"100%",width:"100%"},{id:this.dashboardDesigner._id+"_mapping_column_body_container"});this.renderUpperBodyContainer(n);this.renderGridContainer(n)},n.prototype.renderUpperBodyContainer=function(n){var t=BoldBIDashboard.buildTag("table","",{width:"97%",margin:"0.5em 12px","padding-bottom":"5px"},{}),i=BoldBIDashboard.buildTag("tr","",{"padding-top":"10px"},{}),r=BoldBIDashboard.buildTag("td","",{},{});this.renderSourceTableContainer(r);n.append(t);t.append(i);i.append(r)},n.prototype.renderSourceTableContainer=function(n){var t=BoldBIDashboard.buildTag("div.e-source-table","",{height:"24px",width:"200px",padding:"4px 7px",float:"left"},{}),i=BoldBIDashboard.buildTag("span.bbi-designer-label",this.locale.mergedDataSource.sourceTable,{display:"inline-block",float:"left","line-height":"normal","font-weight":"500","margin-top":"8px",cursor:"default"}),r=BoldBIDashboard.buildTag("input","",{"font-size":"12px",float:"left"},{id:"source_table_datasource_column"});n.append(i,t);t.append(r);this.renderSourceTableDropDown()},n.prototype.renderGridContainer=function(n){var t=BoldBIDashboard.buildTag("div.e-dbrd-column-mapping-grid-container","",{margin:"10px",height:"440px",width:"730px"},{id:this.dashboardDesigner._id+"_mapping_grid_container"});t.BoldBIDashboardGrid({dataSource:this.getDefaultData(),allowPaging:!1,gridLines:BoldBIDashboard.Grid.GridLines.None,columns:[{field:"ItemId",headerText:"ItemID",width:200},{field:"ItemName",headerText:"ItemName",width:200}],allowSelection:!1,commonWidth:200,enableRowHover:!1});n.append(t);this.columnMappingContainer.append(n)},n.prototype.renderFooter=function(){var n=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.mergedDataSource.updateMappingDialogText,{float:"right"},{id:this.dashboardDesigner._id+"_column_mapping_apply_btn",type:"button"}),t=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.mergedDataSource.closeMappingDialogText,{float:"right"},{id:this.dashboardDesigner._id+"_column_mapping_cancel_btn",type:"button"}),i;n.on("click",this.bbdesigner$.proxy(this.applyColumnMapping,this));t.on("click",this.bbdesigner$.proxy(this.closeMappingDialog,this));i=this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_mappingcolumn_configuration_foot");i.append(t,n)},n.prototype.getDefaultData=function(){return[{ItemId:"i1",ItemName:"Item1",value:"1"},{ItemId:"i2",ItemName:"Item2",value:"2"},{ItemId:"i3",ItemName:"Item3",value:"3"},{ItemId:"i4",ItemName:"Item4",value:"4"},{ItemId:"i5",ItemName:"Item5",value:"5"},{ItemId:"i6",ItemName:"Item6",value:"6"}]},n.prototype.refreshScrollBarForGrid=function(){var n=this.getElementById(this.dashboardDesigner._id+"_mapping_grid_container");n.data("BoldBIDashboardGrid").option({allowScrolling:!0,scrollSettings:{width:n.width(),height:n.height()-n.find(".e-columnheader").height()-5,autoHide:!0,enableTouchScroll:!0}});n.find(".e-table").css("width",n.width());n.data("BoldBIDashboardGrid").getScrollObject().refresh()},n.prototype.renderDropDown=function(n,t){var i=this.getElementById(t);i.BoldBIDashboardDropDownList({showRoundedCorner:!0,cssClass:"bbi-designer-param-assign bbi-designer-border bbi-designer-ejwidgets bbi-dbrd-control",width:"175px",height:"30px",dataSource:n.dataSource,fields:{text:"Name",value:"Id"},watermarkText:n.type,change:n.changeEvent,selectedIndex:n.index})},n.prototype.getMappingModel=function(n,t,i,r){return{type:n,dataSource:t,changeEvent:i,index:r}},n.prototype.renderSourceTableDropDown=function(){var n="source_table_datasource_column",t=this.getMappingModel(this.locale.mergedDataSource.sourceTable,this.sourceTableDatasource,this.bbdesigner$.proxy(this.changeSourceTable,this),-1);this.renderDropDown(t,n);BoldBIDashboard.isNullOrUndefined(this.tempMappingInfo)||this.setDropDownValue(n,this.tempMappingInfo.SourceTable)},n.prototype.resetColumnMappingDialog=function(){this.sourceTableDatasource=[];this.targetInstance=null;this.targetMethod="";this.tempMappingInfo=null;this.dsIds=[]},n.prototype.openMappingActionWindow=function(n){n.length>1&&(this.resetColumnMappingDialog(),this.dsIds=n,this.fetchMappingInfo())},n.prototype.fetchMappingInfo=function(n){this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.publishMergeDatasource,{action:BoldBIDashboard.DashboardUtil.DesignerAction.PublishMergeDatasource,data:JSON.stringify({datasourceIdList:this.dsIds,fromcolumnmapping:!0,mappingschema:this.columnMappingModel,tableId:n})},{fnction:this.bbdesigner$.proxy(this.getMappingInfoSuccess,this),indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]},!0,!0)},n.prototype.populateSourceTableDatasource=function(){var n=this,t;this.sourceTableDatasource=[];t=Object.keys(this.tempMappingInfo.TableList);t.forEach(function(t){n.sourceTableDatasource.push({Name:n.tempMappingInfo.TableList[t].Name,Id:t})});this.renderSourceTableDropDown()},n.prototype.openMappingWindowFromQueryDesigner=function(n,t,i,r,u){u===void 0&&(u=null);this.resetColumnMappingDialog();this.dsIds.push(r);this.tempMappingInfo=i;this.targetInstance=n;this.targetMethod=t;this.requestInfo=u;this.populateSourceTableDatasource();this.mappingDialogAction(!0);this.refreshScrollBarForGrid();this.disableSourceTable()},n.prototype.disableSourceTable=function(){var n=this.getElementById("source_table_datasource_column");!BoldBIDashboard.isNullOrUndefined(n)&&n.length>0&&n.data("BoldBIDashboardDropDownList").disable()},n.prototype.getMappingInfoSuccess=function(n){n.Data!==null?(this.mappingDialogAction(!0),this.tempMappingInfo=JSON.parse(n.Data),this.populateSourceTableDatasource()):(this.mappingDialogAction(!1),this.dashboardDesigner.modules.util.alertDialog(this.locale.mergedDataSource.columnMapping,n.Message,IconType.errors,AlertType.Alert,!0,n,{height:200}))},n.prototype.getTemplate=function(n,t){return t===void 0&&(t=""),n?"<div><span>{{:Name}}<\/span><\/div>":'<input type="text" class="bbi-dropdown-element" id= "e_dbrd_grid_dropdown_'+t+'_{{:Id}}"><\/input>'},n.prototype.createColumn=function(n,t){var i=this.getGridContainer();i.model.columns.push({headerText:n,template:t,width:200})},n.prototype.updateGridColumns=function(){var n=this,t=this.tempMappingInfo.TableList[this.tempMappingInfo.SourceTable],i=Object.keys(this.tempMappingInfo.TableList);this.createColumn(t.Name,this.getTemplate(!0));i.forEach(function(t){t!==n.tempMappingInfo.SourceTable&&n.createColumn(n.tempMappingInfo.TableList[t].Name,n.getTemplate(!1,t))})},n.prototype.changeSourceTable=function(n){this.resetGridColumns();var t=this.getGridContainer();this.tempMappingInfo.SourceTable===n.selectedValue?(this.updateGridColumns(),this.destroyEjDropDownElements(),t.option("dataSource",this.tempMappingInfo.TableList[this.tempMappingInfo.SourceTable].FieldList),this.renderDropDownForTargetTable()):BoldBIDashboard.isNullOrUndefined(this.targetMethod)||BoldBIDashboard.isNullOrUndefined(this.targetInstance)?this.fetchMappingInfo(n.selectedValue):this.getColumnMappingInfo(n.selectedValue);this.refreshScrollBarForGrid()},n.prototype.destroyEjDropDownElements=function(){for(var t=this.columnMappingContainer.find(".bbi-dropdown-element.e-dropdownlist"),n=0;n<t.length;n++)this.dashboardDesigner.destroyEjBodyElements(this.bbdesigner$(t[n]))},n.prototype.getColumnMappingInfo=function(n){this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.editDataSet,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.DataSetAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.ColumnMappingAction,dataSetId:this.dsIds[0],isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode,tableId:n})},{fnction:this.bbdesigner$.proxy(this.getMappingInfoSuccess,this),indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]},!0,!0)},n.prototype.getGridContainer=function(){var n=this.getElementById(this.dashboardDesigner._id+"_mapping_grid_container");return n.data("BoldBIDashboardGrid")},n.prototype.resetGridColumns=function(){var n=this.getGridContainer();BoldBIDashboard.isNullOrUndefined(n)||(n.model.columns=[],n.model.dataSource=[])},n.prototype.populateDataSource=function(n,t){var i=this,r=[],u=Object.keys(this.tempMappingInfo.TableList);return u.forEach(function(u){if(u===n){var f=i.tempMappingInfo.TableList[n].FieldList;!BoldBIDashboard.isNullOrUndefined(f)&&f.length>0&&f.forEach(function(n){(n.DataType===null||n.DataType===t||i.IsMappingSupported(n,t))&&r.push(n)})}}),r},n.prototype.IsMappingSupported=function(n,t){var r=!1,u=!1,i=[];return(i.push(n.DataType.toLowerCase()),i.push(t.toLowerCase()),i.forEach(function(n){(n==="numeric"||n==="smallint"||n==="tinyint"||n==="integer"||n==="bigint"||n.startsWith("numeric("))&&(r=!0);(n==="real"||n==="float"||n.startsWith("float(")||n==="decimal"||n==="double"||n.startsWith("decimal(")||n==="dec"||n.startsWith("dec("))&&(u=!0)}),r&&u)?!0:!1},n.prototype.getSelectedIndex=function(n,t){if(!BoldBIDashboard.isNullOrUndefined(n)&&n.length>0)for(var i=0;i<n.length;i++)if(n[i].Id===t)return i},n.prototype.renderDropDownForTargetTable=function(){var n=this,t;this.tempMappingInfo.MappingInfo!=null&&(t=Object.keys(this.tempMappingInfo.MappingInfo),!BoldBIDashboard.isNullOrUndefined(t)&&t.length>0&&t.forEach(function(t){var i=n.tempMappingInfo.MappingInfo[t];!BoldBIDashboard.isNullOrUndefined(i)&&i.length>0&&i.forEach(function(i){var r=n.populateDataSource(t,i.DataType),u=n.getSelectedIndex(r,i.Id),f=n.getMappingModel("Select Column",r,null,u);n.renderDropDown(f,"e_dbrd_grid_dropdown_"+t+"_"+i.MappedColumnId)})}))},n.prototype.mappingDialogAction=function(n){n?this.columnMappingContainer.data("BoldBIDashboardDialog").open():this.columnMappingContainer.data("BoldBIDashboardDialog").close()},n.prototype.updateMappingInfo=function(){var n=this,t=Object.keys(this.tempMappingInfo.MappingInfo);t.length>0&&t.forEach(function(t){var i=n.tempMappingInfo.MappingInfo[t];i.forEach(function(i){var r="e_dbrd_grid_dropdown_"+t+"_"+i.MappedColumnId;i.Id=n.getDropDownValue(r);i.Name=n.getDropDownSelectedText(r)})})},n.prototype.applyColumnMapping=function(){this.updateMappingInfo();this.columnMappingModel=this.tempMappingInfo;BoldBIDashboard.isNullOrUndefined(this.targetMethod)||BoldBIDashboard.isNullOrUndefined(this.targetInstance)||BoldBIDashboard.DashboardUtil.invokeMethod(this.targetInstance,this.targetMethod,[this.columnMappingModel,this.tempMappingInfo.SourceTable,this.requestInfo]);this.mappingDialogAction(!1)},n.prototype.closeMappingDialog=function(){this.mappingDialogAction(!1)},n.prototype.getElementById=function(n){return this.columnMappingContainer.find("#"+n)},n.prototype.setDropDownValue=function(n,t){var i=this.getElementById(n);!BoldBIDashboard.isNullOrUndefined(i)&&i.length>0&&i.data("BoldBIDashboardDropDownList").selectItemByValue(t)},n.prototype.getDropDownValue=function(n){var t=this.getElementById(n);return!BoldBIDashboard.isNullOrUndefined(t)&&t.length>0?t.data("BoldBIDashboardDropDownList").getSelectedValue():null},n.prototype.getDropDownSelectedText=function(n){var t=this.getElementById(n);return!BoldBIDashboard.isNullOrUndefined(t)&&t.length>0?this.bbdesigner$(t.data("BoldBIDashboardDropDownList").getSelectedItem()).text():null},n.prototype.showIndicator=function(){this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_mappingcolumn_configuration_wrapper").is(":visible")?this.columnMappingContainer.data("BoldBIDashboardWaitingPopup").show():this.dashboardDesigner.element.find(".bbi-designer-dslist-panel-container").data("BoldBIDashboardWaitingPopup").show()},n.prototype.hideIndicator=function(){this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_mappingcolumn_configuration_wrapper").is(":visible")?this.columnMappingContainer.data("BoldBIDashboardWaitingPopup").hide():this.dashboardDesigner.element.find(".bbi-designer-dslist-panel-container").data("BoldBIDashboardWaitingPopup").hide()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.ColumnMapping",InternalColumnMapping,window);var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ColumnMappingInfo=function(){function n(){}return n}(),TableSchema=function(){function n(){}return n}(),FieldSchema=function(){function n(){}return n}(),MappingSchema=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(SelectedField),BoldBIDashboard;(function(n){var t;(function(t){var i=function(){function i(n,t,i,r){this.isOpen=!1;this.userBasedFilterInfo=new UserBasedFilterInfo;this.dsListPageNo=0;this.dsListSearchPageNo=0;this.isDSRefresh=!1;this.isRenderTriggered=!1;this.dsSearchKey="";this.locale=null;this.unMappedCheckBoxInst=null;this.disableDiv=null;this.designerInst=n;this.bbdesigner$=this.designerInst.bbdesigner$;this.locale=n.getLocalizationContent();this.queryDesignerInst=t;this.id=this.designerInst._id+"_uf_modes_adv";this.target=i;this.callbackMethod=r}return i.prototype.initLoader=function(){this.loader=this.target.find("#"+this.id).BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup bbi-designer-loader",template:this.designerInst.getWaitingPopupTemplate()}).data("BoldBIDashboardWaitingPopup")},i.prototype.render=function(){if(this.target.find("#"+this.id).length===0){var u=n.buildTag("div","",{height:"100%",width:"100%"},{id:this.id}),i=n.buildTag("div","",{width:"100%","box-sizing":"border-box",display:"flex",height:"100%"}),r=n.buildTag("div","",{width:"30%",height:"100%","border-right":"1px solid var(--querydesigner-primary-border-color)"}),t=n.buildTag("div.bbi-dbrd-designer-adv-right-panel bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","<div style='padding:0 10px;'><\/div>",{width:"70%",height:"100%"},{id:this.id+"_right_panel"});i.append(r,t);r.append(this.getDsListTemplate());t.find("div:first").append(this.getCustomQueryTemplate(),this.getConfigurationUITemplate());this.renderUnmappedCheckBox(t.find("#"+this.id+"_advanced_preview_btn_wrapper"));this.target.append(this.getSharedDsTemplate(),u.append(i));t.BoldBIDashboardScroller({autoHide:!0,buttonSize:this.designerInst.scrollerSize.buttonSize,scrollerSize:this.designerInst.scrollerSize.scrollSize,height:506,width:558,enableTouchScroll:!0})}},i.prototype.initDsConfigurationObjects=function(){var n=this.target.find("#"+this.id+"_identity_type"),t=this.target.find("#"+this.id+"_identity_column"),i=this.target.find("#"+this.id+"_column_config_list");this.identityType=n.BoldBIDashboardDropDownList({width:240,cssClass:"bbi-dbrd-control e-combobox-control",dataSource:[{id:this.id+"_identity_type_email",value:"email",text:this.locale.userFilterLocale.emailText,type:IdentityType.Email},{id:this.id+"_identity_type_name",value:"name",text:this.locale.userFilterLocale.fullNameText,type:IdentityType.Name},{id:this.id+"_identity_type_groupName",value:"groupname",text:this.locale.userFilterLocale.groupNameText,type:IdentityType.GroupName}],selectedIndex:0}).data("BoldBIDashboardDropDownList");this.identityColumn=t.BoldBIDashboardDropDownList({width:240,cssClass:"bbi-dbrd-control e-combobox-control",fields:{id:"Id",value:"Name",text:"Name"},selectedIndex:0,change:this.bbdesigner$.proxy(this.onIdentityColumnSelect,this)}).data("BoldBIDashboardDropDownList");this.columnListBox=i.BoldBIDashboardListBox({cssClass:"bbi-dbrd-control bbi-dbrd-uf-column-config-list",width:"100%",showCheckbox:!0,template:"<div class='bbi-dbrd-uf-column-config-tmplt-wrapper'><span data-tooltip='${Name}' class='bbi-drbd-uf-column-config-column-name bbi-dbrd-designer-hoverable'>${Name}<\/span><span class='bbi-dbrd-uf-column-config-alias-wrapper'><div id='"+this.id+"_uf_${Id}'><\/div><span class='bbi-designer-errorinfo bbi-dbrd-designer-hoverable' data-tooltip='"+this.locale.userFilterLocale.columnConfigErrorMsg+"'><\/span><\/span><\/div>",fields:{id:"Id",value:"Name",text:"Name"},checkChange:this.bbdesigner$.proxy(this.onColumnListItemClick,this)}).data("BoldBIDashboardListBox")},i.prototype.enableButton=function(t,i){n.DashboardUtil.buttonEnable(t,i)},i.prototype.onIdentityColumnSelect=function(t){for(var u,f,i=null,r=this.columnListBox._disabledItems.length-1;r>=0;r--)i=this.columnListBox.getItemByIndex(n.parseInt(this.columnListBox._disabledItems[r])),u=i.item.find("#"+this.id+"_uf_"+i.data.Id+"_wrapper_input").data("BoldBIDashboardDropDownList"),u&&u.enable(),this.columnListBox.enableItemByIndex(n.parseInt(this.columnListBox._disabledItems[r]));i=this.columnListBox.getItemByIndex(t.itemId);f=i.item.find("#"+this.id+"_uf_"+i.data.Id+"_wrapper_input").data("BoldBIDashboardDropDownList");f&&f.disable();this.columnListBox.uncheckItemByIndex(t.itemId);this.columnListBox.disableItemByIndex(t.itemId);this.updateModificationStatus()},i.prototype.onColumnListItemClick=function(t){var i,f,r,u;t.isInteraction&&(i=!1,this.isHierarchicalConnection()?(f=this.target.find("#"+this.id+"_uf_"+t.data.Id).data("DesignerPropertyWidget"),r=f.getSelection(),i=!n.isNullOrUndefined(r.value)&&r.value.trim()!==""):(u=this.target.find("#"+this.id+"_uf_"+t.data.Id+"_wrapper_input").data("BoldBIDashboardDropDownList"),i=!n.isNullOrUndefined(u)&&u.getSelectedValue()!==""),i||(this.columnListBox.uncheckItemByIndex(t.index),t.item.find(".bbi-designer-errorinfo").css("visibility","visible")));this.updateModificationStatus()},i.prototype.updateModificationStatus=function(){!n.isNullOrUndefined(this.columnListBox)&&!n.isNullOrUndefined(this.identityColumn)&&this.columnListBox.getCheckedItems().length>0&&this.identityColumn.getSelectedValue().length>0?(this.setVaidateBtnState(!0),this.setSaveBtnState(!0),this.enableUnMappedCheckBox(!0)):(this.setVaidateBtnState(!1),this.setSaveBtnState(!1),this.enableUnMappedCheckBox(!1))},i.prototype.initDsListObjects=function(){this.dsListEle=this.target.find("#"+this.id+"_map_ds_list");this.dsListEle.BoldBIDashboardScroller({autoHide:!0,buttonSize:this.designerInst.scrollerSize.buttonSize,scrollerSize:this.designerInst.scrollerSize.scrollSize,height:435,enableTouchScroll:!0,scroll:this.bbdesigner$.proxy(this.onDsListScroll,this)});this.dsListEle.find("div:first").css("width","100%");this.populateDsList()},i.prototype.initQueryModeObjects=function(){window.CodeMirror&&(this.queryModeObj=window.CodeMirror(this.target.find("#"+this.id+"_query_edit")[0],{mode:"text/x-sql",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!0,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{}}),this.queryModeObj.setSize("100%","100%"),this.queryModeObj.refresh())},i.prototype.getSearchTemplate=function(n){return"<div id='"+n+"_search_wrapper' class='bbi-dbrd-search-wrapper'><input type='text' placeholder='"+this.locale.userFilterLocale.waterMarkText+"' id='"+n+"_panel_search' class='bbi-dbrd-search-input bbi-autocomplete e-js e-input' style='width:85%'><span id='"+n+"_search_icon' class='bbi-headericon bbi-dbrd-designer-icon-search'><\/span><\/div>"},i.prototype.getDsListTemplate=function(){return"<div class='bbi-dbrd-uf-adv-ds-list-wrapper'><label class='e-dbrd-uf-label'>"+this.locale.userFilterLocale.mappingDataSource+"<\/label><div class='bbi-dbrd-uf-adv-ds-list-content'>"+this.getSearchTemplate(this.id+"_ds_search")+"<button type='button' class='bbi-dbrd-designer-refresh-ds bbi-dbrd-designer-hoverable bbi-dbrd-designer-hand-cursor bbi-dbrd-icon-background-theme'data-tooltip='"+this.locale.tableSelectorWindow.reloadButtonText+"' style='margin-left:5px;'><\/button><\/div><\/div><div class='bbi-dbrd-uf-dlg-splitter' style='width:94%;'><\/div><div class='bbi-dbrd-uf-adv-mode-ds-list .bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3' id='"+this.id+"_map_ds_list'><div><div class='bbi-dbrd-uf-map-ds-list-content'><\/div><\/div><\/div>"},i.prototype.renderSkelton=function(t){var f=n.buildTag("div","",{width:"225px",height:"160px",display:"block"},{id:t+"_wrapper"}),i=n.buildTag("div.bbi-empty-ds-title-block","",{},{id:t+"_title_blocks"}),r=n.buildTag("div.bbi-empty-ds-title bbi-empty-ds-list-loader","",{},{id:t+"_title_loading"}),u=n.buildTag("div.bbi-empty-ds-content bbi-empty-ds-list-loader","",{},{id:t+"_content_loading"}),e=i.append(r,u).clone();return f.append(e,i.append(r,u))},i.prototype.getCustomQueryTemplate=function(){return"<div class='bbi-dbrd-uf-adv-code-view-wrapper'><div class='bbi-dbrd-uf-adv-spacer bbi-dbrd-uf-label'>"+this.locale.userFilterLocale.queryModeText+"<\/div><div class='bbi-dbrd-uf-adv-code-content bbi-dbrd-uf-adv-spacer ' id='"+this.id+"_query_edit'><\/div><button type='button' class='bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-uf-adv-spacer bbi-dbrd-uf-adv-flex-right' id='"+this.id+"_run_query_btn'>"+this.locale.userFilterLocale.runText+"<\/button> <\/div>"},i.prototype.getConfigurationUITemplate=function(){return"<div class='bbi-dbrd-uf-adv-ds-config-wrapper'><div class='bbi-dbrd-uf-ds-config-identity-panel'><label class='bbi-dbrd-uf-label'>"+this.locale.userFilterLocale.identityText+"<\/label><div><div class='bbi-dbrd-uf-ds-config-identity-type-wrapper'><label>"+this.locale.userFilterLocale.typeText+"<\/label><span><input type='text' id='"+this.id+"_identity_type'/><\/span><\/div><div class='bbi-dbrd-uf-ds-config-identity-column-wrapper'><label>"+this.locale.userFilterLocale.columnText+"<\/label><span><input type='text' id='"+this.id+"_identity_column'/><\/span><\/div><\/div><\/div><label class='bbi-dbrd-uf-label' style='margin-bottom:5px;'>"+this.locale.userFilterLocale.columnMappingText+"<\/label><div class='bbi-dbrd-uf-column-config-list-wrapper'><div class='bbi-dbrd-uf-column-config-list-header'><span class='bbi-dbrd-label-left'>"+this.locale.userFilterLocale.mappingDataSource+"<\/span><span class='bbi-dbrd-label-right'>"+this.locale.userFilterLocale.currentDataSourceText+"<\/span><\/div><ul id='"+this.id+"_column_config_list'><\/ul><\/div><div id='"+this.id+"_advanced_preview_btn_wrapper'><button type='button' class='bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-uf-adv-spacer bbi-dbrd-uf-adv-flex-right' id='"+this.id+"_preview_data_btn' style='margin:5px 0;float:right;'>"+this.locale.userFilterLocale.previewText+"<\/button><\/div><\/div>"},i.prototype.renderUnmappedCheckBox=function(i){var u=n.buildTag("div.bbi-dbrd-uf-checkbox-element bbi-dbrd-designer-hoverable","",{},{id:this.id+"_unmpped_checkbox_div","data-tooltip":this.locale.userFilterLocale.showDataToUnmappedUserInfoText}),f=[],e,r;f.push({isChecked:!1,isDisabled:!1,name:"userUnmapped",id:this.id+"_unmpped_checkbox_div",label:this.locale.userFilterLocale.showDataToUnmappedUserText});e={callBackInstance:this,cssClass:"e-small",callBackMethod:"onUmappedCheckBox",dataSource:f,labelPosition:t.LabelPosition.After};this.unMappedCheckBoxInst=new n.Dashboard.CheckBox(e,u);r=n.buildTag("div","",{float:"left",margin:"5px 0"},{});this.disableDiv=n.buildTag("div.bbi-disable-functionalities","",{},{id:this.id+"_list_wrapper_panel_disable"});r.append(u);this.disableDiv.append(r);i.append(this.disableDiv);this.enableUnMappedCheckBox(!1)},i.prototype.enableUnMappedCheckBox=function(t){if(!n.isNullOrUndefined(this.disableDiv)){if(t){this.disableDiv.removeClass("bbi-enable");return}this.disableDiv.addClass("bbi-enable")}},i.prototype.updateUnmappedCheckBox=function(n){this.unMappedCheckBoxInst.checkItemByName("userUnmapped",n)},i.prototype.onUmappedCheckBox=function(t){var i=t.checkedItems.length>0;n.isNullOrUndefined(this.userBasedFilterInfo.AdvancedFilter)||(this.userBasedFilterInfo.AdvancedFilter.ShowRecordsToUnmappedUsers=i)},i.prototype.getCheckBoxState=function(){var n=ejdashboard.base.getComponent(this.target.find("#"+this.id+"_unmpped_checkbox_div_chk_input")[0],"checkbox");return n.checked},i.prototype.showDsListLoader=function(){this.hideDsListLoader();this.dsListEle.find("div:first .bbi-dbrd-uf-map-ds-list-content").append(this.renderSkelton(this.id+"_skelton"))},i.prototype.showLoader=function(){this.loader.show()},i.prototype.hideDsListLoader=function(){this.dsListEle.find("div:first .bbi-dbrd-uf-map-ds-list-content #"+this.id+"_skelton_wrapper").remove()},i.prototype.hideLoader=function(){this.loader.hide()},i.prototype.wireEvents=function(){this.target.on("click","#"+this.id+"_run_query_btn",this.bbdesigner$.proxy(this.onQueryRunBtnClick,this));this.target.on("click","#"+this.id+"_preview_data_btn",this.bbdesigner$.proxy(this.onValidateDataBtnClick,this));this.target.on("click",".bbi-dbrd-designer-refresh-ds",this.bbdesigner$.proxy(this.onDsRefreshBtnClick,this));this.queryModeObj.on("change",this.bbdesigner$.proxy(this.onQueryEdit,this));this.target.on("click",".bbi-dbrd-uf-column-config-tmplt-wrapper",this.bbdesigner$.proxy(this.onListItemOverlayClick,this));this.target.on("click",".bbi-dbrd-designer-shared-ds-item",this.bbdesigner$.proxy(this.onDsListItemSelect,this));this.target.on("keyup","#"+this.id+"_ds_search_panel_search",this.bbdesigner$.proxy(this.onDsListSearchKeyUp,this));this.target.on("click",".bbi-headericon.bbi-dbrd-designer-icon-close",this.bbdesigner$.proxy(this.onDsSearchCancelClick,this))},i.prototype.unWireEvents=function(){this.target.off("click","#"+this.id+"_run_query_btn",this.bbdesigner$.proxy(this.onQueryRunBtnClick,this));this.target.off("click","#"+this.id+"_preview_data_btn",this.bbdesigner$.proxy(this.onValidateDataBtnClick,this));this.target.off("click",".bbi-dbrd-designer-refresh-ds",this.bbdesigner$.proxy(this.onDsRefreshBtnClick,this));this.queryModeObj.off("change",this.bbdesigner$.proxy(this.onQueryEdit,this));this.target.off("click",".bbi-dbrd-uf-column-config-tmplt-wrapper",this.bbdesigner$.proxy(this.onListItemOverlayClick,this));this.target.off("click",".bbi-dbrd-designer-shared-ds-item",this.bbdesigner$.proxy(this.onDsListItemSelect,this));this.target.off("keyup","#"+this.id+"_ds_search_panel_search",this.bbdesigner$.proxy(this.onDsListSearchKeyUp,this));this.target.off("click",".bbi-headericon.bbi-dbrd-designer-icon-close",this.bbdesigner$.proxy(this.onDsSearchCancelClick,this))},i.prototype.onQueryEdit=function(){this.setRunBtnState(this.queryModeObj.getValue().trim()!=="")},i.prototype.getAdvancedFilterInfo=function(){var c=this.target.find("#"+this.id+"_preview_data_btn"),t,e,h,u,r,i,o,s,f;if(c.is("[disabled=disabled]"))return null;for(this.userBasedFilterInfo.Mode=UserBasedFilterMode.Advanced,t=new AdvancedUserBasedFilter,t.IdentityFieldName=this.identityColumn.getSelectedValue(),t.DataSourceId=this.dataSourceId,t.ShowRecordsToUnmappedUsers=n.isNullOrUndefined(this.userBasedFilterInfo.AdvancedFilter)?this.getCheckBoxState():this.userBasedFilterInfo.AdvancedFilter.ShowRecordsToUnmappedUsers,e=this.identityType.getSelectedValue(),n.isNullOrUndefined(e)||(h=this.identityType.getItemDataByValue(e),t.Type=h[0].type),this.selectedMode==="query"?(t.CustomQuery=this.queryModeObj.getValue(),t.Mode=AdvancedFilterMode.CustomQuery):t.Mode=AdvancedFilterMode.Table,u=this.columnListBox.getCheckedItems(),r=0;r<u.length;r++)i=new SelectedField,this.isHierarchicalConnection()?(o=this.target.find("#"+this.id+"_uf_"+u[r].data.Id).data("DesignerPropertyWidget"),n.isNullOrUndefined(o)||(s=o.getSelection(),i.MappedColumnName=s.name,i.MappedColumnId=s.value)):(f=this.target.find("#"+this.id+"_uf_"+u[r].data.Id+"_wrapper_input").data("BoldBIDashboardDropDownList"),n.isNullOrUndefined(f)||(i.MappedColumnName=f.model.text,i.MappedColumnId=f.model.value)),i.Name=u[r].value,t.SelectedFields.push(i);return this.userBasedFilterInfo.AdvancedFilter=t,this.userBasedFilterInfo},i.prototype.onValidateDataBtnClick=function(){n.isNullOrUndefined(this.selectedMode)||this.selectedMode!=="datasource"&&this.selectedMode!=="query"||this.getAdvancedFilterInfo();this.requestObj=this.designerInst.modules.util.doAjaxPost("POST",this.designerInst.model.serviceUrl+n.Dashboard.ServiceAPI.getPreviewData,{action:n.DashboardUtil.DesignerAction.GetPreviewData,data:JSON.stringify({dataSourceId:this.dataSourceId,UserBasedFilterInfo:this.userBasedFilterInfo})},{fnction:this.bbdesigner$.proxy(this.onValidationSuccess,this),indicator:[this.bbdesigner$.proxy(this.showLoader,this),this.bbdesigner$.proxy(this.hideLoader,this)]})},i.prototype.onValidationSuccess=function(t){n.DashboardUtil.invokeCallBack(this.callbackMethod,{trigger:"preview",data:t,identityColumn:this.userBasedFilterInfo.AdvancedFilter.IdentityFieldName})},i.prototype.onListItemOverlayClick=function(n){this.bbdesigner$(n.currentTarget).parents("li").click()},i.prototype.onDsRefreshBtnClick=function(){this.isDSRefresh=!0;this.dsListPageNo=0;this.dsListEle.find("div:first .bbi-dbrd-uf-map-ds-list-content").html("");this.populateDsList(!0)},i.prototype.onQueryRunBtnClick=function(){var t=this.queryModeObj.getValue();this.requestObj=this.designerInst.modules.util.doAjaxPost("POST",this.designerInst.model.serviceUrl+n.Dashboard.ServiceAPI.getColumnDetails,{action:n.DashboardUtil.DesignerAction.dataSourceCatalog,data:JSON.stringify({dataSetId:this.dataSourceId,CustomQuery:t})},{fnction:this.bbdesigner$.proxy(this.onIdentityColumnFetchFromCustomQuerySuccess,this),indicator:[this.bbdesigner$.proxy(this.showLoader,this),this.bbdesigner$.proxy(this.hideLoader,this)]},!0,!0)},i.prototype.hideQueryOptions=function(){this.target.find(".bbi-dbrd-uf-adv-code-view-wrapper").hide()},i.prototype.populateDsList=function(t){this.requestObj=this.designerInst.modules.util.doAjaxPost("POST",this.designerInst.model.serviceUrl+n.Dashboard.ServiceAPI.shareddatasources,{action:n.DashboardUtil.DesignerAction.dataSourceCatalog,data:JSON.stringify({Page:n.isNullOrUndefined(this.dsSearchKey)||this.dsSearchKey.trim()===""?this.dsListPageNo:this.dsListSearchPageNo,SearchKey:this.dsSearchKey})},{fnction:this.bbdesigner$.proxy(this.onDsListFetchSuccess,this,t),indicator:[this.bbdesigner$.proxy(this.showDsListLoader,this),this.bbdesigner$.proxy(this.hideDsListLoader,this)]},!0,!0)},i.prototype.onDsListScroll=function(t){if(!n.isNullOrUndefined(t.originalEvent)&&(this.dsListPageNo>0||this.dsListSearchPageNo>0)){var i=this.dsListEle.height(),r=this.dsListEle.find(".bbi-dbrd-uf-map-ds-list-content").outerHeight();r-i<=t.scrollTop&&(this.resetRequest(),this.populateDsList(),this.refreshDsListScroller())}},i.prototype.renderDsList=function(t,i){n.isNullOrUndefined(t)||(i?this.dsListEle.find("div:first .bbi-dbrd-uf-map-ds-list-content").html(this.target.find("#"+this.id+"_mapping_ds_template").render(this.removeCurrentDsFromDsList(t))):this.dsListEle.find("div:first .bbi-dbrd-uf-map-ds-list-content").append(this.target.find("#"+this.id+"_mapping_ds_template").render(this.removeCurrentDsFromDsList(t))),this.refreshDsListScroller())},i.prototype.onDsListFetchSuccess=function(t,i){i.Status?(n.isNullOrUndefined(this.dsListData)&&(this.dsListData=[]),n.isNullOrUndefined(this.dsSearchKey)||this.dsSearchKey.trim()===""?(this.dsListPageNo=i.Page,this.dsListData=t?i.Data:this.dsListData.concat(i.Data)):this.dsListSearchPageNo=i.Page,this.dsListData.length>0&&(this.renderDsList(i.Data,t),this.isOpen&&(n.isNullOrUndefined(this.queryDesignerInst)||n.isNullOrUndefined(this.queryDesignerInst.userBasedFilterInfo)||n.isNullOrUndefined(this.queryDesignerInst.userBasedFilterInfo.AdvancedFilter)||this.fetchRemainingIfRequired(this.queryDesignerInst.userBasedFilterInfo.AdvancedFilter.DataSourceId,i.Data))),this.selectDsFromList(this.dataSourceId)):this.showNoDataInDsList();this.updateModificationStatus()},i.prototype.fetchRemainingIfRequired=function(t,i){var r=i.find(function(n){return n.Id===t});n.isNullOrUndefined(r)?this.dsListPageNo===0?(this.designerInst.modules.util.alertDialog(this.locale.userFilterLocale.dialogTitle,this.locale.userFilterLocale.dataSourcesRemovedMsg,IconType.information,AlertType.Alert,!1,""),this.isOpen=!1):this.populateDsList():this.selectDsFromList(t,!0)},i.prototype.showNoDataInDsList=function(){this.dsListEle.find("div:first .bbi-dbrd-uf-map-ds-list-content").html("<center><p style='font-size:12px;'>"+this.locale.userFilterLocale.noResultsFound+"<\/p><\/center>")},i.prototype.removeCurrentDsFromDsList=function(t){var i=this;return n.isNullOrUndefined(this.queryDesignerInst.dataset)||this.selectedMode==="query"?t:t.filter(function(n){return n.Name!==i.queryDesignerInst.dataset.Name})},i.prototype.reset=function(){this.isRenderTriggered=!1;n.isNullOrUndefined(this.identityColumn)||this.identityColumn.setModel({dataSource:[]});n.isNullOrUndefined(this.identityType)||this.identityType.selectItemByIndex(0);n.isNullOrUndefined(this.columnListBox)||(this.columnListBox.setModel({dataSource:[]}),this.columnListBox.uncheckAll());n.isNullOrUndefined(this.queryModeObj)||(this.queryModeObj.setValue(""),this.queryModeObj.clearHistory());this.resetDSSearch();this.resetDSSelection();this.setVaidateBtnState(!1);this.setRunBtnState(!1);this.enableUnMappedCheckBox(!1);this.resetRequest()},i.prototype.isModifiled=function(){var t=this.designerInst.element.find("#"+this.id+"_preview_data_btn");return!n.isNullOrUndefined(t.attr("disabled"))&&t.attr("disabled").trim()===""||!n.isNullOrUndefined(this.dataSourceId)&&this.dataSourceId.trim()!==""},i.prototype.hideElement=function(n){n?(this.identityColumn.disable(),this.columnListBox.disable(),this.queryModeObj.options.readOnly="nocursor"):(this.identityColumn.enable(),this.columnListBox.enable(),this.queryModeObj.options.readOnly=!1)},i.prototype.conformationDSChanges=function(t,i){t?(this.setVaidateBtnState(!1),this.setSaveBtnState(!1),this.enableUnMappedCheckBox(!1),this.requestObj=this.designerInst.modules.util.doAjaxPost("POST",this.designerInst.model.serviceUrl+n.Dashboard.ServiceAPI.getColumnDetails,{action:n.DashboardUtil.DesignerAction.dataSourceCatalog,data:JSON.stringify({dataSetId:this.dataSourceId})},{fnction:this.bbdesigner$.proxy(this.onIdentityColumnFetchSuccess,this),indicator:[this.bbdesigner$.proxy(this.showLoader,this),this.bbdesigner$.proxy(this.hideLoader,this)],errfnction:this.bbdesigner$.proxy(this.onFetchError,this)},!0,!0)):(this.dataSourceId=i,this.selectDsFromList(this.dataSourceId))},i.prototype.onFetchError=function(n){this.hideElement(!0);this.designerInst.modules.util.alertDialog(this.locale.userFilterLocale.dialogTitle,n.responseJSON.Message,IconType.errors,AlertType.Alert,!0,n.responseText)},i.prototype.onIdentityColumnFetchFromCustomQuerySuccess=function(n){if(n.Status){var t=JSON.parse(n.Data);this.identityColumn.setModel({dataSource:[]});this.columnListBox.setModel({dataSource:[]});this.columnListBox.uncheckAll();this.setVaidateBtnState(!1);this.setSaveBtnState(!1);this.enableUnMappedCheckBox(!1);this.hideElement(!1);this.identityColumn.option("dataSource",t);this.columnListBox.option("dataSource",t);this.columnListBox.refresh(!0);this.initColumnListTemplate(t)}else this.designerInst.modules.util.alertDialog(this.locale.alertDialogTitle.InvalidQueryStatement,this.locale.errorMessage.dataFetchingError,IconType.errors,AlertType.Alert,!0,n.Message)},i.prototype.initColumnListTemplate=function(t){var e=this.isHierarchicalConnection(),o=null,r,i,u,s,f;if(e&&!n.isNullOrUndefined(this.queryDesignerInst.dataset.TreeViewData)&&(r=JSON.parse(this.queryDesignerInst.dataset.TreeViewData),!n.isNullOrUndefined(r)&&!n.isNullOrUndefined(r.Dimension)&&r.Dimension.length>0&&(o=r.Dimension)),!n.isNullOrUndefined(t)){for(i=0;i<t.length;i++)u=this.target.find("#"+this.id+"_uf_"+t[i].Id),e?(s={fields:{id:"ColumnId",parentId:"ParentId",hasChild:"HasChild",dataSource:o,text:"Name"},callBackInstance:this,callBackMethod:"columnListTemplateDdlSelect",popupHeight:"100%",width:"250px",height:"28px",optionalArgs:t[i].Id},new n.DashboardDesignerUtility.DropdownTreeview(this.designerInst,s,u)):(f=n.buildTag("input","",{"font-size":"12px"},{id:this.id+"_uf_"+t[i].Id+"_wrapper_input"}),u.append(f),f.BoldBIDashboardDropDownList({width:250,text:t[i].Name,dataSource:this.currentDsFields,fields:{id:"ID",text:"Name",value:"Name"},cssClass:"bbi-dbrd-control e-combobox-control",select:this.bbdesigner$.proxy(this.columnListTemplateDdlSelect,this,t[i].Id)}));this.columnListBox.scrollerObj.refresh()}},i.prototype.columnListTemplateDdlSelect=function(n){this.target.find("#"+n+" .bbi-designer-errorinfo").css("visibility","")},i.prototype.onIdentityColumnFetchSuccess=function(t){var u=this,r,i;if(t.Status){if(t.StatusCode==="2001"){this.designerInst.modules.util.alertDialog(this.locale.userFilterLocale.dialogTitle,this.locale.userFilterLocale.hierarhyDSErrorMsg,IconType.information,AlertType.Alert,!1,"");this.resetColumnTemplateUI();return}this.setSaveBtnState(!1);this.selectedMode!=="query"||this.isOpen?(r=JSON.parse(t.Data),this.identityColumn.option("dataSource",r),this.columnListBox.uncheckAll(),this.columnListBox.option("dataSource",r),this.columnListBox.refresh(!0),this.hideElement(!1),this.identityType.selectItemByIndex(0),i=this,this.showLoader(),setTimeout(function(){var o,e;if(i.initColumnListTemplate(r),o=i.isHierarchicalConnection(),i.isOpen&&!n.isNullOrUndefined(i.queryDesignerInst)&&!n.isNullOrUndefined(i.queryDesignerInst.userBasedFilterInfo)&&!n.isNullOrUndefined(i.queryDesignerInst.userBasedFilterInfo.AdvancedFilter)){var t=JSON.parse(JSON.stringify(i.queryDesignerInst.userBasedFilterInfo.AdvancedFilter)),s=[],f=[],h=function(e){var h=r.find(function(n){return n.Name===t.SelectedFields[e].Name}),c=null,l;n.isNullOrUndefined(h)?f.push(t.SelectedFields[e].Name+"("+u.locale.userFilterLocale.mappingDataSource+")"):(t.SelectedFields[e].MappedColumnName!==null&&t.SelectedFields[e].MappedColumnName!==""&&(o?(l=i.target.find("#"+i.id+"_uf_"+h.Id).data("DesignerPropertyWidget"),n.isNullOrUndefined(l)||l.selectItem(t.SelectedFields[e].MappedColumnId)||(h=null,f.push(t.SelectedFields[e].MappedColumnName))):(c=i.target.find("#"+i.id+"_uf_"+h.Id+"_wrapper_input").data("BoldBIDashboardDropDownList"),n.isNullOrUndefined(c)||(c.selectItemByValue(t.SelectedFields[e].MappedColumnId),c.getSelectedValue()===""&&(f.push(t.SelectedFields[e].MappedColumnName),h=null)))),n.isNullOrUndefined(h)||s.push(r.indexOf(h)))};for(e=0;e<t.SelectedFields.length;e++)h(e);f.length!==0&&u.designerInst.modules.util.alertDialog(u.locale.userFilterLocale.dialogTitle,u.locale.userFilterLocale.columnsRemovedMsg,IconType.warning,AlertType.Alert,!0,u.getUnavailColumnList(f));i.columnListBox.checkItemsByIndices(s);i.identityColumn.selectItemByValue(t.IdentityFieldName);i.identityType.selectItemByValue(n.DashboardDesignerUtility.Serialization.enumToString(IdentityType,t.Type).toLowerCase());i.queryModeObj.setValue(t.CustomQuery);i.isOpen=!1}i.hideLoader()},0)):this.resetColumnTemplateUI()}},i.prototype.resetColumnTemplateUI=function(){this.identityType.selectItemByIndex(0);this.identityColumn.option("dataSource",[]);this.columnListBox.option("dataSource",[]);this.hideElement(!0);this.queryModeObj.setValue("");this.queryModeObj.clearHistory();this.queryModeObj.options.readOnly=!1;this.queryModeObj.focus()},i.prototype.getUnavailColumnList=function(n){for(var i="<ul style='padding-top:0;margin-top:0;'>",t=0;t<n.length;t++)i+="<li>"+n[t]+"<\/li>";return i+"<\/ul>"},i.prototype.showQueryOptions=function(){this.target.find(".bbi-dbrd-uf-adv-code-view-wrapper").show()},i.prototype.setSaveBtnState=function(n){this.callbackMethod({trigger:"savebtnstate",state:n})},i.prototype.setVaidateBtnState=function(n){this.enableButton(this.target.find("#"+this.id+"_preview_data_btn"),n)},i.prototype.setRunBtnState=function(n){this.enableButton(this.target.find("#"+this.id+"_run_query_btn"),n)},i.prototype.show=function(n,t){this.currentDsFields=this.queryDesignerInst.tableType.filter(function(n){return n.DataType!=="Real"}||function(n){return n.DataType!=="Integer"});this.target.show();this.reset();this.renderIfRequired();this.selectedMode=t;this.hideElement(!0);switch(t){case"query":this.showQueryOptions();break;case"datasource":this.hideQueryOptions()}this.populateModel(n);this.refreshContentScroller()},i.prototype.renderIfRequired=function(){this.target.find("#"+this.id).length===0&&(this.isRenderTriggered=!0,this.render(),this.initLoader(),this.initQueryModeObjects(),this.initDsListObjects(),this.initDsConfigurationObjects(),this.unWireEvents(),this.wireEvents())},i.prototype.populateModel=function(t){this.renderDsList(this.dsListData,!0);!n.isNullOrUndefined(t)&&this.isOpen?(n.isNullOrUndefined(this.dsListData)||this.dsListData.lenght===0?this.isRenderTriggered||this.populateDsList():this.fetchRemainingIfRequired(t.DataSourceId,this.dsListData),this.updateUnmappedCheckBox(t.ShowRecordsToUnmappedUsers)):this.updateUnmappedCheckBox(!1)},i.prototype.hide=function(){this.target.hide()},i.prototype.resetRequest=function(){n.isNullOrUndefined(this.requestObj)||this.requestObj.readyState===4||(this.requestObj.abort(),this.requestObj=null)},i.prototype.onDsListItemSelect=function(t){var r,u,i;this.bbdesigner$(t.currentTarget).attr("data-id")!==this.dataSourceId&&(r=this.dataSourceId,this.dataSourceId=this.bbdesigner$(t.currentTarget).attr("data-id"),u=this.target.find("#"+this.id+"_preview_data_btn"),this.selectDsFromList(this.dataSourceId),this.isOpen||this.isDSRefresh||!n.isNullOrUndefined(u.attr("disabled"))?this.isDSRefresh||(this.setVaidateBtnState(!1),this.setSaveBtnState(!1),this.enableUnMappedCheckBox(!1),n.isNullOrUndefined(t)||(i="",!this.isOpen||n.isNullOrUndefined(this.queryDesignerInst)||n.isNullOrUndefined(this.queryDesignerInst.userBasedFilterInfo)||n.isNullOrUndefined(this.queryDesignerInst.userBasedFilterInfo.AdvancedFilter)||n.isNullOrUndefined(this.queryDesignerInst.userBasedFilterInfo.AdvancedFilter.CustomQuery)||(i=this.selectedMode==="query"?this.queryDesignerInst.userBasedFilterInfo.AdvancedFilter.CustomQuery:""),this.requestObj=this.designerInst.modules.util.doAjaxPost("POST",this.designerInst.model.serviceUrl+n.Dashboard.ServiceAPI.getColumnDetails,{action:n.DashboardUtil.DesignerAction.dataSourceCatalog,data:JSON.stringify({dataSetId:this.dataSourceId,CustomQuery:i})},{fnction:this.bbdesigner$.proxy(this.onIdentityColumnFetchSuccess,this),indicator:[this.bbdesigner$.proxy(this.showLoader,this),this.bbdesigner$.proxy(this.hideLoader,this)],errfnction:this.bbdesigner$.proxy(this.onFetchError,this)},!0,!0))):this.designerInst.modules.util.alertDialog(this.locale.userFilterLocale.dialogTitle,this.locale.userFilterLocale.resetSettingsMsg,IconType.question,AlertType.Confirm,!1,"",{dataInfo:r,instance:this,method:"conformationDSChanges"}),this.isDSRefresh=!1)},i.prototype.selectDsFromList=function(t,i){var f,r,u;n.isNullOrUndefined(t)||(f=this.dsListEle.find(".bbi-dbrd-designer-shared-ds-item[data-id="+t+"] .bbi-dbrd-designer-checkmark"),r=this.dsListEle.find(".bbi-dbrd-designer-shared-ds-item[data-id="+t+"]"),this.dsListEle.find(".bbi-dbrd-designer-shared-ds-item .bbi-dbrd-designer-checkmark").removeClass("bbi-dbrd-designer-checkmark-checked").addClass("bbi-dbrd-designer-checkmark-unchecked"),this.dsListEle.find(".bbi-dbrd-designer-shared-ds-item").removeClass("bbi-dbrd-designer-shared-ds-checked-item"),f.removeClass("bbi-dbrd-designer-checkmark-unchecked").addClass("bbi-dbrd-designer-checkmark-checked"),r.addClass("bbi-dbrd-designer-shared-ds-checked-item"),i&&r.length!==0&&(r.trigger("click"),u=this.dsListEle.data("BoldBIDashboardScroller"),n.isNullOrUndefined(u)||(u.option("scrollTop",0),u.option("scrollTop",r.offset().top-this.dsListEle.offset().top))))},i.prototype.refreshContentScroller=function(){var t=this.target.find("#"+this.id+"_right_panel").data("BoldBIDashboardScroller");n.isNullOrUndefined(t)||(t._eleWidth=t.model.width,t._eleHeight=t.model.height,t.refresh())},i.prototype.refreshDsListScroller=function(){var t=this.dsListEle.data("BoldBIDashboardScroller");n.isNullOrUndefined(t)||t.refresh()},i.prototype.onDsListSearchKeyUp=function(t){var i=this,r;(t.keyCode>=48&&t.keyCode<=57||t.keyCode>=65&&t.keyCode<=90||t.keyCode>=186&&t.keyCode<=191||t.keyCode>=219&&t.keyCode<=222||t.keyCode===8||t.keyCode===9||t.keyCode===13||t.keyCode===46||t.keyCode===32)&&!t.ctrlKey&&!t.altKey&&(r=this,n.isNullOrUndefined(this.searchTimer)||clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function(){r.searchTimer=null;i.dsSearchKey=r.bbdesigner$(t.currentTarget).val();i.dsSearchKey.trim().length===0?r.bbdesigner$(t.currentTarget).siblings(".bbi-headericon").addClass("bbi-dbrd-designer-icon-search").removeClass("bbi-dbrd-designer-icon-close"):r.bbdesigner$(t.currentTarget).siblings(".bbi-headericon").addClass("bbi-dbrd-designer-icon-close").removeClass("bbi-dbrd-designer-icon-search");i.dsListEle.find("div:first .bbi-dbrd-uf-map-ds-list-content").html("");i.dsListSearchPageNo=0;i.resetRequest();i.dsSearchKey.trim()!==""||n.isNullOrUndefined(i.dsListData)||i.dsListData.length===0?i.populateDsList(!0):i.renderDsList(i.dsListData,!0)},10))},i.prototype.onDsSearchCancelClick=function(){this.resetDSSearch();this.dsListSearchPageNo=0;this.resetRequest();this.populateDsList(!0)},i.prototype.resetDSSearch=function(){this.dsSearchKey="";this.dsListSearchPageNo=0;this.target.find("#"+this.id+"_ds_search_panel_search").val("");this.target.find(".bbi-headericon").removeClass("bbi-dbrd-designer-icon-close").addClass("bbi-dbrd-designer-icon-search")},i.prototype.resetDSSelection=function(){this.dataSourceId=null;n.isNullOrUndefined(this.dsListEle)||(this.dsListEle.find(".bbi-dbrd-designer-checkmark-checked").addClass("bbi-dbrd-designer-checkmark-unchecked").removeClass("bbi-dbrd-designer-checkmark-checked"),this.dsListEle.find(".bbi-dbrd-designer-shared-ds-checked-item").removeClass("bbi-dbrd-designer-shared-ds-checked-item"))},i.prototype.getSharedDsTemplate=function(){return"<script id='"+this.id+"_mapping_ds_template' type='text/x-jsrender'><div class='bbi-dbrd-designer-shared-ds-item' data-id='{{:Id}}' ><div class='bbi-dashboarddesigner-ds-selection-icon-column'><div class='bbi-dbrd-designer-checkmark bbi-dbrd-designer-checkmark-unchecked bbi-dbrd-designer-hoverable'><\/div><\/div><div class='bbi-dashboarddesigner-ds-content-column'><div class='bbi-dashboarddesigner-row  bbi-dbrd-ds-name'><span><label class='bbi-dbrd-designer-trim-label bbi-dbrd-designer-shared-ds-title bbi-dbrd-designer-hoverable' data-tooltip='{{:Name}} '>{{:Name}} <\/label><\/span><span class='bbi-dbrd-designer-checkmark bbi-dbrd-designer-checkmark-unchecked bbi-dbrd-designer-hoverable'><\/span><\/div><div class='bbi-dbrd-designer-shared-ds-content-label bbi-dashboarddesigner-row bbi-ds-modifiy-label'><div><span><label class='bbi-dbrd-ds-label'>Created by:&nbsp;<\/label><\/span><span><label class='bbi-dbrd-designer-hoverable bbi-dbrd-ds-content-label bbi-ds-createdby-content' data-tooltip='{{:CreatedUserName}}'>{{:CreatedUserName}}<\/label><\/div><div style='padding-top:5px;'><span><label class='bbi-dbrd-ds-label'>Modified by:&nbsp;<\/label><\/span><span><label class='bbi-dbrd-designer-hoverable bbi-dbrd-ds-content-label bbi-ds-modified-by-content' data-tooltip='{{:UpdatedUserName}}'>{{:UpdatedUserName}}<\/label><\/span><\/div><\/div><\/div><\/div><\/script>"},i.prototype.isHierarchicalConnection=function(){var t=n.Dashboard.ConnectionHelper.getConnectionInfoFromDSInfo(this.designerInst,this.queryDesignerInst.DatasourceInfo),i=n.Dashboard.ConnectionHelper.getConnectionInstance(this.designerInst,t,!0);return n.Dashboard.ConnectionHelper.isHierarchicalConnection(i)},i.prototype.resize=function(){this.refreshContentScroller();this.refreshDsListScroller()},i}();t.UFAdvancedMode=i})(t=n.Dashboard||(n.Dashboard={}))})(BoldBIDashboard||(BoldBIDashboard={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var r=function(){function r(t,i,r){this.dialogBox=null;this.wrapper=null;this.contentPanel=null;this.waterMarkText=BoldBIDashboardDesigner.getLocale().userFilterLocale.waterMarkText;this.checkboxName="userFilter";this.totalItems=0;this._activeUser=null;this.selectedFieldInfo=null;this._currentActiveFilter=null;this._filterList=[];this.fullUserDataSource=[];this.fullFieldDataSource=[];this.mappedUserCollection=[];this.isUserListRendered=!1;this.isFieldListRendered=!1;this.isUserDisabled=!1;this.isFieldDisabled=!1;this.modified=!1;this.unMappedCheckBoxInst=null;this.locale=null;this.includeFutureValues=null;this.dashboardDesigner=t;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=t.getLocalizationContent();this.queryDesigner=i;this.target=r;this.id=this.dashboardDesigner._id+"_uf_modes_basic";this.renderUserFilterDialog();this.initLoader();this.unWireEvents();this.wireEvents();this.useFilterFromInst=new n.Dashboard.UserFilterFromDialog(this.dashboardDesigner);this.open(this.queryDesigner.dataset)}return Object.defineProperty(r.prototype,"activeUser",{get:function(){return this._activeUser},set:function(t){n.isNullOrUndefined(t)?(this._activeUser=new UserInfo,this.updateSelectAllCheckBoxState(!1),n.isNullOrUndefined(this.fieldListInst)||(this.fieldListInst.uncheckAll(),this.fieldListInst.updateTheSelectedFieldValues([]))):(this._activeUser=this.getPreviousUserInfo(t),this._activeUser.IncludeFutureValues?(this.includeFutureValues.disableItemByName("active",!0),this.includeFutureValues.updateIncludeItemCheckbox("active",!0)):(this.includeFutureValues.disableItemByName("active",!0),this.includeFutureValues.updateIncludeItemCheckbox("active",!1)),this.updateSelectAllCheckBoxState(this._activeUser.IsCheckAll),n.isNullOrUndefined(this.fieldListInst)||(this._activeUser.IsCheckAll?this.fieldListInst.checkAll():(this.fieldListInst.uncheckAll(),this._activeUser.IncludeFutureValues&&(this._activeUser.SelectedValues=this.fullFieldDataSource.map(function(n){return n.fieldid})),this.fieldListInst.updateTheSelectedFieldValues(this._activeUser.SelectedValues),this.updateFieldListAndIcons(!0))))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentActiveFilter",{get:function(){return this._currentActiveFilter},set:function(t){n.isNullOrUndefined(t)||(this._currentActiveFilter=t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"filterList",{get:function(){return this._filterList},set:function(t){n.isNullOrUndefined(t)||(this._filterList=t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fieldInfoModel",{get:function(){return this._fieldInfoModel},set:function(t){n.isNullOrUndefined(t)?this._fieldInfoModel=null:(this._fieldInfoModel=this.updateFieldInfoModel(t),this.renderFields(),n.isNullOrUndefined(this.userGroupUiInst)||this.userGroupUiInst.enable(),n.isNullOrUndefined(this.fieldListInst)||this.fieldListInst.enable())},enumerable:!1,configurable:!0}),r.prototype.initLoader=function(){this.loader=this.target.find("#"+this.id).BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()}).data("BoldBIDashboardWaitingPopup")},r.prototype.render=function(){this.target.find("#"+this.id).length===0&&this.target.append(this.dialogBox)},r.prototype.show=function(){this.target.find("#"+this.id+"_uf_dialog_container").length!==0&&this.target.show()},r.prototype.updateUiOnModeSwitch=function(){this.target.find("#"+this.id+"_uf_dialog_container").length===0?(this.updateUiOnShow(),this.render(),this.target.show()):(this.resetRequests(),this.onResetToDefault())},r.prototype.updateUiOnShow=function(t){this.mappedUserCollection=[];this.updateFieldsList(this.queryDesigner.dataset);this.updateErrorMessage("block");this.renderInitial(t);n.isNullOrUndefined(t)&&this.renderList();this.resetIcons();this.updateUnmappedCheckBox();this.updateInlcudeFutureItemCheckBox()},r.prototype.hide=function(){n.isNullOrUndefined(this.fieldListInst)||this.fieldListInst.uncheckAll();this.resetValues();this.target.hide();n.isNullOrUndefined(this.userGroupUiInst)||this.userGroupUiInst.clearAllSelectedUser()},r.prototype.setFieldDataSource=function(t,i){this.updateUiOnUserList(!0);n.isNullOrUndefined(t)?(n.isNullOrUndefined(this.currentActiveFilter.ColumnId)&&this.fieldListInst.setDatasource([],i),t===null&&(this.fieldListInst.setDatasource([],i),this.fieldListInst.displayErrorMsg())):this.fieldListInst.setDatasource(t,i)},r.prototype.getPreviousUserInfo=function(t){var u=this,r=this.filterList.filter(function(n){return n.Name===u.currentActiveFilter.Name})[0],i;return n.isNullOrUndefined(r)?t:(i=r.UserInfo.filter(function(n){return n.UserId===t.UserId&&n.IsGroup===t.IsGroup})[0],!n.isNullOrUndefined(i))?i:t},r.prototype.getBasicFilterInfo=function(){var i=new UserBasedFilterInfo,r,n,t;for(i.Mode=UserBasedFilterMode.Basic,i.AdvancedFilter=null,i.BasicFilters=[],r=[],n=0;n<this.filterList.length;n++)(this.filterList[n].UserInfo.length>0||this.filterList[n].BasedOn!==BasicUserFilterBasedOn.None)&&(t=new BasicUserBasedFilter,t.BasedOn=this.filterList[n].BasedOn,t.ColumnId=this.filterList[n].ColumnId,t.Mode=this.filterList[n].Mode,t.Name=this.filterList[n].Name,t.UserInfo=this.filterList[n].UserInfo,t.ShowRecordsToUnmappedUsers=this.filterList[n].ShowRecordsToUnmappedUsers,r.push(t));return r.length===0?i=null:i.BasicFilters=r,i},r.prototype.updateFieldInfoModel=function(n){return{DatasourceID:this.dataset.Id,DatasourceName:this.dataset.Name,DisplayName:n.Name,Id:n.ID,UniqueColumnName:"fieldid",FilterInfo:null}},r.prototype.renderFields=function(){this.renderFieldListWrapper(this.fieldInfoModel);this.renderFieldList()},r.prototype.updateFilterOnFocus=function(n){this.filterList.filter(function(t){return t.Name===n}).length===0&&(this.currentActiveFilter.Name=n,this.wrapper.find(".e-active").attr("data-filterid",n),this.updateFilterTileValue())},r.prototype.open=function(){this.iconTemplateInst=new n.Dashboard.UserFilterIconTemplate(this.dashboardDesigner,this.listIconWrapper,this,"iconMenuTemplateEventHandler");this.renderUserList(this.userListWrapper);this.userGroupUiInst=this.userListWrapper.data("DesignerPropertyWidget")},r.prototype.renderInitial=function(n){this.initialiseFilterListCollection(n);this.renderDataColumnPanel(this.dataColumnPanel);this.updateFilterListInfo();this.updateUiInteraction(this.filterList[0]);this.enableDisable()},r.prototype.updateCurrentActiveUser=function(){this.activeUser.SelectedValues=[];this.activeUser.IncludeFutureValues=!1;this.includeFutureValues.updateIncludeItemCheckbox("active",!1);this.userGroupUiInst.clearUserSelection();for(var n=0;n<this.userGroupUiInst.userInfoList.length;n++)this.userGroupUiInst.userInfoList[n].IncludeFutureValues=!1,this.userGroupUiInst.userInfoList[n].SelectedValues=[]},r.prototype.updateCurrentSelectedFilterList=function(){this.currentActiveFilter.ColumnId=this.fieldInfoModel.Id;this.currentActiveFilter.UserInfo=[]},r.prototype.updateUiInteraction=function(t){var i,r;if(n.isNullOrUndefined(t.ColumnId))this.selectedFieldInfo=null;else for(i=0;i<this.dataset.Fields.length;i++)if(r=this.getCheckDataField(t.ColumnId,this.dataset.Fields[i],null),!n.isNullOrUndefined(r)){this.selectedFieldInfo=r.Name;break}this.userFilterUI.updateUIForFilterClick(t)},r.prototype.getCheckDataField=function(t,i,r){if(i.ID===t)return i;if(!n.isNullOrUndefined(i.ChildFields))for(var u=0;u<i.ChildFields.length;u++)r=this.getCheckDataField(t,i.ChildFields[u],r);return r},r.prototype.updateFieldsList=function(n){this.dataset=JSON.stringify(n);this.dataset=JSON.parse(this.dataset);this.dataset.Fields=this.queryDesigner.tableType.filter(function(n){return n.DataType!=="Real"}||function(n){return n.DataType!=="Integer"})},r.prototype.initialiseFilterListCollection=function(t){var i=n.isNullOrUndefined(this.queryDesigner.userBasedFilterInfo)?null:JSON.parse(JSON.stringify(this.queryDesigner.userBasedFilterInfo));n.isNullOrUndefined(t)&&!n.isNullOrUndefined(i)&&!n.isNullOrUndefined(i.BasicFilters)&&i.BasicFilters.length>0?(this.updateFilterInfo(i.BasicFilters),this.currentActiveFilter=this.filterList[0]):(this.initialiseFilterList(),this.activeUser=new UserInfo)},r.prototype.updateFilterInfo=function(n){for(var r,t=0;t<n.length;t++)r=new i,r.BasedOn=n[t].BasedOn,r.UserInfo=n[t].UserInfo,r.Name=n[t].Name,r.ColumnId=n[t].ColumnId,r.Mode=n[t].Mode,r.ShowRecordsToUnmappedUsers=n[t].ShowRecordsToUnmappedUsers,this.filterList.push(r)},r.prototype.getFirstUserInitialisation=function(){return this.userGroupUiInst.getFirstSelectedUser()},r.prototype.updateFilterListInfo=function(){if(this.filterList.length>0){for(var n=0;n<this.filterList.length;n++)this.currentActiveFilter=this.filterList[n],this.addTileItemTemplate(!1),this.updateColumnTileValue(this.filterList[n].ColumnId,n);this.wrapper.find(".bbi-dbrd-user-based-tile-wrapper").first().addClass("e-active");this.currentActiveFilter=this.filterList[0]}else this.addTileItemTemplate(!0)},r.prototype.renderList=function(){this.userGroupUiInst.fetchUserGroupList(this.currentActiveFilter.UserInfo);this.enableDisable()},r.prototype.renderFieldList=function(){n.isNullOrUndefined(this.fieldListInst)||n.isNullOrUndefined(this.fieldInfoModel)||(n.isNullOrUndefined(this.activeUser)?this.fieldListInst.getFieldValues(this.fieldInfoModel):this.fieldListInst.getFieldValues(this.fieldInfoModel,this.activeUser.SelectedValues))},r.prototype.resetRequests=function(){n.isNullOrUndefined(this.fieldListInst)||this.fieldListInst.resetRequest();n.isNullOrUndefined(this.userGroupUiInst)||this.userGroupUiInst.resetRequest()},r.prototype.reset=function(){this.resetValues();n.isNullOrUndefined(this.fieldListInst)||this.fieldListInst.emptyFieldValues()},r.prototype.resetValues=function(){this.filterList=[];this._activeUser=null;this._currentActiveFilter=null;this.fieldInfoModel=null;this.wrapper.find(".bbi-dbrd-user-based-tile-wrapper").remove();this.isFieldListRendered=!1;this.isUserListRendered=!1;this.modified=!1},r.prototype.initialiseFilterList=function(){var n=new i;n.Name=this.updateFilterName();this.filterList.push(n);this.currentActiveFilter=n},r.prototype.updateFilterName=function(){for(var r,t="Untitled Filter",u=function(i){var r=f.filterList.filter(function(n){return n.Name===t+i})[0];if(n.isNullOrUndefined(r))return t+=i,{value:t}},f=this,i=1;i<=this.filterList.length+1;i++)if(r=u(i),typeof r=="object")return r.value;return t+="1"},r.prototype.renderUserFilterDialog=function(){this.createUserFilterDialog()},r.prototype.resetToDefaultState=function(){this.resetRequests();this.checkBoxState();this.userSearchTextBox.val("");this.onUserListSearchBlur();this.fieldSearchTextBox.val("");this.onFieldListSearchBlur();this.sortFieldValue=SortType.Asc;this.sortUserValue=SortType.Asc;this.bbdesigner$(".bbi-dbrd-userbased-filter-menu-list").find("span").css("display","none");this.bbdesigner$(".bbi-dbrd-userbased-filter-menu-list").find(".bbi-dbrd-usergroup-mapping-tickmark").css("display","block")},r.prototype.createUserFilterDialog=function(){var t,u,i,r;this.dialogBox=n.buildTag("div","",{},{id:this.id+"_uf_dialog_container"});this.contentPanel=n.buildTag("div.bbi-dbrd-uf-content-wrapper","",{},{id:this.id+"_wrapper"});this.tileWrapperPanel=this.wrapper=n.buildTag("div.bbi-dbrd-uf-tile-panel","",{},{id:this.id+"_tile_wrapper_panel"});t=n.buildTag("div.bbi-dbrd-uf-user-filter-panel","",{},{id:this.id+"_user_filter_panel"});u=n.buildTag("div.e-dbrd",this.locale.userFilterLocale.addFilterErrorMsg,{display:"none","justify-content":"center","align-items":"center",height:"100%",width:"100%"},{id:this.id+"_user_filter_error"});this.dataColumnPanel=n.buildTag("div.bbi-dbrd-uf-data-column-panel","",{},{id:this.id+"_data_column_panel"});i=n.buildTag("div.bbi-dbrd-uf-list-panel","",{},{id:this.id+"_list_wrapper_panel"});this.disableDiv=n.buildTag("div.bbi-disable-functionalities","",{},{id:this.id+"_list_wrapper_panel_disable"});this.listIconWrapper=n.buildTag("div.bbi-dbrd-uf-list-icon-wrapper","",{},{id:this.id+"_list_icon_wrapper"});r=n.buildTag("div.bbi-dbrd-uf-list-wrapper","",{},{id:this.id+"_list_wrapper"});this.userListDisableWrapper=n.buildTag("div.bbi-dbrd-uf-user-list-disable-wrapper","",{},{id:this.id+"_user-list_disable_wrapper"});this.userListWrapper=n.buildTag("div.bbi-dbrd-uf-user-list-wrapper","",{},{id:this.id+"_user-list_wrapper"});this.fieldListDisableWrapper=n.buildTag("div.bbi-dbrd-uf-field-list-disable-wrapper","",{},{id:this.id+"_field-list_disable_wrapper"});this.fieldListWrapper=n.buildTag("div.bbi-dbrd-uf-field-list-wrapper","",{},{id:this.id+"_field_list_wrapper"});r.append(this.userListDisableWrapper,this.userListWrapper,this.fieldListDisableWrapper,this.fieldListWrapper);i.append(this.listIconWrapper,r);this.renderUnmappedCheckBox(i);t.append(u);t.append(this.dataColumnPanel,this.disableDiv,i);this.contentPanel.append(this.tileWrapperPanel,t);this.dialogBox.append(this.contentPanel);this.createUserFilterTileWrapper(this.tileWrapperPanel);this.renderIconWrapper(this.listIconWrapper)},r.prototype.renderUnmappedCheckBox=function(i){var u=n.buildTag("div.bbi-dbrd-uf-checkbox-element bbi-dbrd-designer-hoverable","",{width:"48%"},{id:this.id+"_unmpped_checkbox_div","data-tooltip":this.locale.userFilterLocale.showDataToUnmappedUserInfoText}),f=[],e,r;f.push({isChecked:!1,isDisabled:!1,name:"userUnmapped",label:this.locale.userFilterLocale.showDataToUnmappedUserText});e={callBackInstance:this,cssClass:"e-small",callBackMethod:"onUmappedCheckBox",dataSource:f,labelPosition:t.LabelPosition.After};this.unMappedCheckBoxInst=new n.Dashboard.CheckBox(e,u);r=n.buildTag("div.bbi-dbrd-uf-unmapped-checkbox-wrapper","",{"flex-direction":"row"},{});r.append(u);i.append(r);this.updateFutureItemCheckbox(r)},r.prototype.updateFutureItemCheckbox=function(i){var r=n.buildTag("div.bbi-dbrd-uf-checkbox-element bbi-dbrd-designer-hoverable","",{width:"48%","padding-left":"20px"},{id:this.id+"_active_checkbox_div"}),u=[],f;u.push({isChecked:!1,isDisabled:!1,name:"active",label:this.locale.userFilterLocale.includeFutureValueText});f={callBackInstance:this,cssClass:"e-small",callBackMethod:"onIncludeFutureItemCheckBox",dataSource:u,labelPosition:t.LabelPosition.After};this.includeFutureValues=new n.Dashboard.CheckBox(f,r);i.append(r)},r.prototype.onIncludeFutureItemCheckBox=function(n){var t=n.checkedItems.length>0?!0:!1;this._activeUser.IncludeFutureValues=t},r.prototype.onUmappedCheckBox=function(n){var t=n.checkedItems.length>0?!0:!1;this.currentActiveFilter.ShowRecordsToUnmappedUsers=t},r.prototype.closeFilterWindow=function(){n.isNullOrUndefined(this.userGroupUiInst)||this.userGroupUiInst.hideLoadingIndicator();this.resetRequests();n.isNullOrUndefined(this.fieldListInst)||this.fieldListInst.hideLoadingIndicator();this.reset()},r.prototype.renderDataColumnPanel=function(t){var r=!1,u=null,i,f;n.isNullOrUndefined(this.dataset)||n.isNullOrUndefined(this.dataset.TreeViewData)||(i=JSON.parse(this.dataset.TreeViewData),!n.isNullOrUndefined(i)&&!n.isNullOrUndefined(i.Dimension)&&i.Dimension.length>0&&(u=i.Dimension,r=!0));f={filterName:this.currentActiveFilter.Name,fields:r?u:this.dataset.Fields.filter(function(n){return n.DataType!=="Integer"&&n.DataType!=="Real"}),isHierarchical:r};t.empty();this.userFilterUI=new n.Dashboard.UserFilterTemplateUi(this.dashboardDesigner,f,t,this,"filterTemplateEventHandler")},r.prototype.createUserFilterTileWrapper=function(t){this.tileWrapperPanel.empty();this.totalItems=0;this.wrapper=n.buildTag("div.bbi-dbrd-uf-tile-panel-wrapper bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","",{"box-sizing":"border-box"},{id:this.id+"_wrapper"});var i=n.buildTag("div","",{},{id:this.id+"_container"}),r=n.buildTag("div .bbi-dbrd-uf-add-filter-wrapper","",{},{id:this.id+"_add_filter_wrapper"}),u=n.buildTag("span .e-chk-image e-icon bbi-masterslave-filter-add-plusIcon bbi-dbrd-uf-add-filter-icon","",{},{id:this.id+"_add_filter_icon"}),f=n.buildTag("span .bbi-dbrd-uf-add-filter-text",this.locale.userFilterLocale.addFilter,{},{id:this.id+"_add_filter_text"});r.append(u,f);this.wrapper.append(i);i.append(r);t.append(this.wrapper);this.wrapper.BoldBIDashboardScroller({scrollerSize:this.dashboardDesigner.scrollerSize.scrollSize,buttonSize:this.dashboardDesigner.scrollerSize.buttonSize,enableTouchScroll:!0,autoHide:!0,height:500});this.wrapper.data("BoldBIDashboardScroller").refresh()},r.prototype.addTileItemTemplate=function(n){this.filterList.length===0&&this.updateErrorMessage("block");this.wrapper.find(".e-active").removeClass("e-active");this.wrapper.find("#"+this.id+"_add_filter_wrapper").before(this.getTileItemTemplate(this.locale));n&&this.wrapper.find(".bbi-dbrd-user-based-tile-wrapper").last().addClass("e-active");this.setIndividualIdAndName(n);this.wrapper.data("BoldBIDashboardScroller").refresh()},r.prototype.onAddFilterClick=function(){this.resetRequests();this.updateSelectAllCheckBoxState(!1);this.addTileItemTemplate(!0);this.filterAndUiUpdation()},r.prototype.updateUsersAndGroupSelection=function(){if(!n.isNullOrUndefined(this.currentActiveFilter)&&!n.isNullOrUndefined(this.userGroupUiInst)){this.userGroupUiInst.clearAllSelectedUser();for(var t=0;t<this.currentActiveFilter.UserInfo.length;t++)this.userGroupUiInst.addAllSelectedUser(this.currentActiveFilter.UserInfo)}},r.prototype.onResetToDefault=function(){this.resetRequests();this.reset();n.isNullOrUndefined(this.userGroupUiInst)||(this.userGroupUiInst.userInfoList=[]);n.isNullOrUndefined(this.fieldListInst)||(this.fieldListInst.selectedValues=[]);this.updateUiOnShow(!0);this.modified=!1;this.updateUsersAndGroupSelection();this.activeUser=this.getFirstUserInitialisation()},r.prototype.isModified=function(){return this.modified},r.prototype.setIndividualIdAndName=function(n){var t=this.tileWrapperPanel.find(".bbi-dbrd-user-based-tile-wrapper");n&&this.initialiseFilterList();t.last().attr({id:this.id+"_tile_item_"+this.filterList.length,"data-filterid":this.currentActiveFilter.Name});t.last().find(".bbi-dbrd-user-based-tile-header-wrapper p").html(this.currentActiveFilter.Name)},r.prototype.getTileItemTemplate=function(n){return"<div class='bbi-dbrd-user-based-tile-wrapper'><div class='bbi-dbrd-user-based-tile-header-wrapper'><p class='bbi-dbrd-user-based-tile-header bbi-dbrd-designer-hoverable' data-tooltip=''><\/p><span class='e-chk-image e-icon e-cross-circle bbi-dbrd-user-based-tile-close-icon bbi-dbrd-designer-hoverable' data-tooltip='"+n.toolBar.Delete+"'><\/span><\/div><div class='bbi-dbrd-user-based-tile-description bbi-dbrd-designer-hoverable' data-tooltip=''><span class ='bbi-dbrd-uf-data-column-name' ><\/span><span class ='bbi-dbrd-uf-column-name'><\/span><\/div><\/div>"},r.prototype.wireEvents=function(){this.wrapper.on("click","#"+this.id+"_add_filter_wrapper",this.bbdesigner$.proxy(this.onAddFilterClick,this));this.wrapper.on("click",".bbi-dbrd-user-based-tile-wrapper",this.bbdesigner$.proxy(this.onTileSelectionChange,this));this.wrapper.on("click",".bbi-dbrd-user-based-tile-close-icon",this.bbdesigner$.proxy(this.onRemoveFilterBtnClick,this));this.userSearchTextBox.on("focusin",this.bbdesigner$.proxy(this.onUserSearchFocusIn,this));this.userSearchTextBox.on("focusout",this.bbdesigner$.proxy(this.onUserSearchFocusOut,this));this.fieldSearchTextBox.on("focusin",this.bbdesigner$.proxy(this.onFieldSearchFocusIn,this));this.fieldSearchTextBox.on("focusout",this.bbdesigner$.proxy(this.onFieldSearchFocusOut,this));this.userSearchTextBox.on("keyup",this.bbdesigner$.proxy(this.onUserListSearchText,this));this.userSearchTextBox.on("blur",this.bbdesigner$.proxy(this.onUserListSearchBlur,this));this.userSearchIcon.on("click",this.bbdesigner$.proxy(this.onUserListSearchCloseClick,this));this.fieldSearchTextBox.on("keyup",this.bbdesigner$.proxy(this.onFieldListSearchText,this));this.fieldSearchTextBox.on("blur",this.bbdesigner$.proxy(this.onFieldListSearchBlur,this));this.fieldSearchIcon.on("click",this.bbdesigner$.proxy(this.onFieldListSearchCloseClick,this));this.listIconWrapper.on("click","#"+this.id+"_list_icon_wrapper_sorting",this.bbdesigner$.proxy(this.sortLists,this));this.listIconWrapper.on("click","#"+this.id+"_list_icon_wrapper_refresh",this.bbdesigner$.proxy(this.reloadLists,this))},r.prototype.unWireEvents=function(){this.wrapper.off("click","#"+this.id+"_add_filter_wrapper",this.bbdesigner$.proxy(this.onAddFilterClick,this));this.wrapper.off("click",".bbi-dbrd-user-based-tile-wrapper",this.bbdesigner$.proxy(this.onTileSelectionChange,this));this.wrapper.off("click",".bbi-dbrd-user-based-tile-close-icon",this.bbdesigner$.proxy(this.onRemoveFilterBtnClick,this));this.userSearchTextBox.off("focusin",this.bbdesigner$.proxy(this.onUserSearchFocusIn,this));this.fieldSearchTextBox.off("focusin",this.bbdesigner$.proxy(this.onFieldSearchFocusIn,this));this.userSearchTextBox.off("focusout",this.bbdesigner$.proxy(this.onUserSearchFocusOut,this));this.fieldSearchTextBox.off("focusout",this.bbdesigner$.proxy(this.onFieldSearchFocusOut,this));this.userSearchTextBox.off("keyup",this.bbdesigner$.proxy(this.onUserListSearchText,this));this.userSearchIcon.off("click",this.bbdesigner$.proxy(this.onUserListSearchCloseClick,this));this.userSearchTextBox.off("blur",this.bbdesigner$.proxy(this.onUserListSearchBlur,this));this.fieldSearchTextBox.off("keyup",this.bbdesigner$.proxy(this.onFieldListSearchText,this));this.fieldSearchIcon.off("click",this.bbdesigner$.proxy(this.onFieldListSearchCloseClick,this));this.fieldSearchTextBox.off("blur",this.bbdesigner$.proxy(this.onFieldListSearchBlur,this));this.listIconWrapper.off("click","#"+this.id+"_list_icon_wrapper_sorting",this.bbdesigner$.proxy(this.sortLists,this));this.listIconWrapper.off("click","#"+this.id+"_list_icon_wrapper_refresh",this.bbdesigner$.proxy(this.reloadLists,this))},r.prototype.onRemoveFilterBtnClick=function(t){var i,r,u;n.isNullOrUndefined(t.currentTarget)||(r=this.bbdesigner$(t.currentTarget),i=this.getSelectedFilterValue(r));i.UserInfo.length>0||i.BasedOn!==BasicUserFilterBasedOn.None?this.dashboardDesigner.modules.util.alertDialog(this.locale.userFilterLocale.alertDialogTitle,this.locale.userFilterLocale.deleteAlertDialogMsg,IconType.question,AlertType.Confirm,!1,"",{instance:this,method:"removeFilter",dataInfo:{data:t}}):(u={data:t},this.removeFilter(!0,u))},r.prototype.sortLists=function(n){var t=this.bbdesigner$(n.target);switch(t.attr("data-name")){case"userGroupSorting":switch(this.sortUserValue){case"ascending":this.sortUserValue=SortType.Desc;break;case"descending":this.sortUserValue=SortType.Asc}this.userGroupUiInst.sort(this.sortUserValue,this.concatUserInfos());break;case"fieldSorting":switch(this.sortFieldValue){case"ascending":this.sortFieldValue=SortType.Desc;break;case"descending":this.sortFieldValue=SortType.Asc}this.fieldListInst.sort(this.sortFieldValue)}},r.prototype.reloadLists=function(t){var i=this.bbdesigner$(t.target);switch(i.attr("data-name")){case"refreshUserList":this.isUserListRendered=!1;this.userGroupUiInst.reload(this.currentActiveFilter.UserInfo);break;case"refreshData":if(n.isNullOrUndefined(this.currentActiveFilter.ColumnId))break;this.isFieldListRendered=!1;this.fieldSearchTextBox.val("");this.onFieldListSearchBlur();this.fieldListInst.reload()}},r.prototype.onTileSelectionChange=function(n){this.resetRequests();var t=this.bbdesigner$(n.target);t.hasClass("bbi-dbrd-user-based-tile-close-icon")||(this.updateFilterTileValue(),this.wrapper.find(".e-active").removeClass("e-active"),t.closest(".bbi-dbrd-user-based-tile-wrapper").addClass("e-active"),this.filterAndUiUpdation())},r.prototype.filterAndUiUpdation=function(){this.switchCurrentFilter();n.isNullOrUndefined(this.fieldListInst)||(this.fieldListInst.hideError(),this.setFieldDataSource(this.currentActiveFilter.DataSource,this.currentActiveFilter.AllowVirtualScrolling));this.findSelectedFilter();this.enableDisable();this.resetIcons();this.updateUsersAndGroupSelection();n.isNullOrUndefined(this.fieldListInst)||(this.updateUserListAndIcons(!0),this.fieldListInst.updateFieldValueLists(this.activeUser.SelectedValues));n.isNullOrUndefined(this.userGroupUiInst)||this.currentActiveFilter.DataSource===null||this.updateUiAndCollectionForAutoMapping();this.userGroupUiInst.updateUsers(this.currentActiveFilter.UserInfo);this.updateUnmappedCheckBox();this.updateInlcudeFutureItemCheckBox()},r.prototype.updateUnmappedCheckBox=function(){this.unMappedCheckBoxInst.checkItemByName("userUnmapped",this.currentActiveFilter.ShowRecordsToUnmappedUsers)},r.prototype.updateInlcudeFutureItemCheckBox=function(){this.includeFutureValues.checkItemByName("active",this._activeUser.IncludeFutureValues)},r.prototype.resetIcons=function(){this.userSearchTextBox.val("");this.fieldSearchTextBox.val("");this.onUserListSearchBlur();this.onFieldListSearchBlur();this.sortFieldValue=SortType.Asc;this.sortUserValue=SortType.Asc;this.iconTemplateInst.updateIcons(this.currentActiveFilter.BasedOn);n.isNullOrUndefined(this.userGroupUiInst)||this.currentActiveFilter.DataSource===null||(this.userGroupUiInst.showAll(),this.userGroupUiInst.showListBoxDiv())},r.prototype.getSelectedFilter=function(){this.userGroupUiInst.updateTheSelectedGroupValues(this.currentActiveFilter.UserInfo)},r.prototype.switchCurrentFilter=function(){var n=this.wrapper.find(".e-active").find(".bbi-dbrd-user-based-tile-header").text();this.currentActiveFilter=this.filterList.filter(function(t){return t.Name===n})[0];this.activeUser=this.getFirstUserInitialisation()},r.prototype.updateFilterTileValue=function(){var n=this.wrapper.find(".e-active");n.find(".bbi-dbrd-user-based-tile-header-wrapper p").html(this.currentActiveFilter.Name)},r.prototype.updateColumnTileValue=function(t,i){if(!n.isNullOrUndefined(t)){var u=void 0,r=void 0;n.isNullOrUndefined(i)?(r=this.wrapper.find(".e-active").find(".bbi-dbrd-user-based-tile-description"),u=t):(r=this.bbdesigner$(this.wrapper.find(".bbi-dbrd-user-based-tile-description")[i]),u=this.userFilterUI.getFieldName(t));r.find(".bbi-dbrd-uf-data-column-name").html(this.locale.userFilterLocale.dataColumnName);r.find(".bbi-dbrd-uf-column-name").html(" - "+u)}},r.prototype.findSelectedFilter=function(){this.updateFieldListView(this.currentActiveFilter);this.updateUiInteraction(this.currentActiveFilter)},r.prototype.updateFieldListView=function(t){n.isNullOrUndefined(this.fieldListInst)||(n.isNullOrUndefined(t.ColumnId)?this.fieldListInst.hideFieldList():this.fieldListInst.showFieldList())},r.prototype.getSelectedFilterValue=function(n){var t=n.closest(".bbi-dbrd-user-based-tile-wrapper").attr("data-filterid");return this.filterList.filter(function(n){return n.Name===t})[0]},r.prototype.removeFilter=function(n,t){if(n){var i=this.bbdesigner$(t.data.currentTarget),r=this.getSelectedFilterValue(i);this.deleteFromFilterCollection(r);this.updateSelectionAfterDeletion(r,i);this.filterList.length>0&&this.filterAndUiUpdation();this.filterList.length===0&&this.updateErrorMessage("none")}},r.prototype.updateSelectionAfterDeletion=function(n,t){n===this.currentActiveFilter?(this.wrapper.find(".e-active").removeClass("e-active"),t.closest(".bbi-dbrd-user-based-tile-wrapper").remove(),this.wrapper.find(".bbi-dbrd-user-based-tile-wrapper").last().addClass("e-active")):t.closest(".bbi-dbrd-user-based-tile-wrapper").remove();this.wrapper.data("BoldBIDashboardScroller").refresh()},r.prototype.updateErrorMessage=function(n){var i=n==="none"?"flex":"none",t;this.dataColumnPanel.css("display",n);t=this.dashboardDesigner.element.find("#"+this.id+"_user_filter_panel");t.find("#"+this.id+"_list_wrapper_panel").css("display",n);t.find("#"+this.id+"_user_filter_error").css("display",i)},r.prototype.deleteFromFilterCollection=function(n){var t=this.filterList.indexOf(n);this.filterList.splice(t,1)},r.prototype.renderFieldListWrapper=function(){this.fieldListWrapper.empty();this.fieldListInst=new n.Dashboard.UserFilterFieldValueList(this.dashboardDesigner,this.fieldInfoModel,this.fieldListWrapper,this,"userFieldValuesListEventHandler")},r.prototype.renderUserList=function(t){t.empty();this.userGroupUiInst=new n.Dashboard.UsersAndGroupsListView(this.dashboardDesigner,t,this,"userGroupListEventHandler")},r.prototype.checkBoxState=function(){var n=this.fieldCheckBoxDiv.find(".e-checkbox-wrapper[aria-checked=true]").length>0;n&&this.updateSelectAllCheckBoxState(n)},r.prototype.updateSelectAllCheckBoxState=function(n){this.checkboxInst.checkItemByName(this.checkboxName,n)},r.prototype.onCheckChange=function(){var n=this.fieldCheckBoxDiv.find(".e-checkbox-wrapper[aria-checked=true]").length>0;this.updateFilterFieldValues(!n);this.fieldListInst.checkAndUnCheckAllFieldValues(n);this.activeUser.SelectedValues.length>0?this.userGroupUiInst.addUserSelection():this.userGroupUiInst.clearCurrentUserSelection();n?this.includeFutureValues.disableItemByName("active",!1):(this.includeFutureValues.disableItemByName("active",!0),this.includeFutureValues.updateIncludeItemCheckbox("active",!1),this._activeUser.IncludeFutureValues=n)},r.prototype.onUserSearchFocusOut=function(){this.userSearchPanel.removeClass("bbi-uf-user-focus")},r.prototype.onFieldSearchFocusOut=function(){this.fieldSearchPanel.removeClass("bbi-uf-field-focus")},r.prototype.onUserSearchFocusIn=function(){this.userSearchPanel.addClass("bbi-uf-user-focus");this.userSearchTextBox.css("color","#333333")},r.prototype.onFieldSearchFocusIn=function(){this.fieldSearchPanel.addClass("bbi-uf-field-focus");this.fieldSearchTextBox.css("color","#333333")},r.prototype.onUserListSearchText=function(n){if(n.keyCode!==13){var t=this.userSearchTextBox.val();t.length>0?this.userSearchIcon.addClass("e-close_01").removeClass("e-search"):this.userSearchIcon.addClass("e-search").removeClass("e-close_01");this.userGroupUiInst.search(t)}},r.prototype.onFieldListSearchText=function(n){if(n.keyCode!==13){this.updateUserListAndIcons(!0);var t=this.fieldSearchTextBox.val();t.length>0?this.fieldSearchIcon.addClass("e-close_01").removeClass("e-search"):this.fieldSearchIcon.addClass("e-search").removeClass("e-close_01");this.fieldListInst.search(t);t.length>0?(this.includeFutureValues.disableItemByName("active",!0),this.includeFutureValues.updateIncludeItemCheckbox("active",!1)):this._activeUser.IncludeFutureValues&&this.includeFutureValues.updateIncludeItemCheckbox("active",!0)}},r.prototype.onUserListSearchBlur=function(){var n=this.userSearchTextBox.val();n.length===0&&this.userSearchIcon.addClass("e-search").removeClass("e-close_01")},r.prototype.onFieldListSearchBlur=function(){var n=this.fieldSearchTextBox.val();n.length===0&&this.fieldSearchIcon.addClass("e-search").removeClass("e-close_01")},r.prototype.onUserListSearchCloseClick=function(){this.userSearchPanel.removeClass("bbi-uf-user-focus");this.userSearchTextBox.css("color","#808080");this.userSearchIcon.addClass("e-search").removeClass("e-close_01");this.userGroupUiInst.search("");this.userSearchTextBox.val("")},r.prototype.onFieldListSearchCloseClick=function(){this.updateUserListAndIcons(!0);this.fieldSearchPanel.removeClass("bbi-uf-field-focus");this.fieldSearchTextBox.css("color","#808080");this.fieldSearchIcon.addClass("e-search").removeClass("e-close_01");this.fieldListInst.search("");this.fieldSearchTextBox.val("");this._activeUser.IncludeFutureValues&&this.includeFutureValues.updateIncludeItemCheckbox("active",!0);this.fieldListInst.tooltipForLengthFieldText()},r.prototype.renderIconWrapper=function(t){var f=n.buildTag("div.bbi-dbrd-uf-user-icon-wrapper","",{},{id:this.id+"_user_icon_wrapper","data-name":"usergroup"}),i,r,u,s;this.userIconDisableDiv=n.buildTag("div.bbi-dbrd-uf-user-icon-disable-wrapper","",{},{id:this.id+"_user_icon_disable_wrapper"});i=n.buildTag("div.bbi-dbrd-uf-field-icon-wrapper","",{},{id:this.id+"_field_icon_wrapper","data-name":"field"});this.fieldIconDisableDiv=n.buildTag("div.bbi-dbrd-uf-field-icon-disable-wrapper","",{},{id:this.id+"_field_icon_disable_wrapper"});var h=n.buildTag("div.bbi-dbrd-uf-user-icon-title-container","<p><\/p>",{},{id:this.id+"_user_icon_title_container"}),c=n.buildTag("div.bbi-dbrd-uf-field-icon-title-container","<p><\/p>",{},{id:this.id+"_field_icon_title_container"}),e=n.buildTag("div.bbi-dbrd-uf-user-icon-title-wrapper","",{},{id:this.id+"_user_icon_title_wrapper"}),o=n.buildTag("div.bbi-dbrd-uf-user-icon-search-wrapper","",{},{id:this.id+"_user_icon_search_wrapper"});this.userSearchPanel=n.buildTag("div.bbi-dbrd-uf-user-search-panel","",{},{id:this.id+"_user_search_panel"});this.fieldSearchPanel=n.buildTag("div.bbi-dbrd-uf-field-search-panel","",{},{id:this.id+"_field_search_panel"});r=n.buildTag("div.bbi-dbrd-uf-field-icon-title-wrapper","",{},{id:this.id+"_field_icon_title_wrapper"});u=n.buildTag("div.bbi-dbrd-uf-field-icon-search-wrapper","",{},{id:this.id+"_field_icon_search_wrapper"});this.userSearchTextBox=n.buildTag("input.bbi-dbrd-uf-user-search-text-box","",{},{id:this.id+"_user_search_text_box",type:"text",placeholder:this.waterMarkText});this.fieldSearchTextBox=n.buildTag("input.bbi-dbrd-uf-field-search-text-box","",{},{id:this.id+"_field_search_text_box",type:"text",placeholder:this.waterMarkText});this.userSearchIcon=n.buildTag("span.e-user-search-icon","",{},{id:this.id+"_user_search_icon","class":"e-icon e-search"});this.fieldSearchIcon=n.buildTag("span.e-field-search-icon","",{},{id:this.id+"_field_search_icon","class":"e-icon e-search"});this.fieldCheckBoxDiv=n.buildTag("div.bbi-dbrd-uf-checkbox-element","",{"margin-top":"3px"},{id:this.id+"_checkbox_div"});s=[{isChecked:!1,isDisabled:!1,name:this.checkboxName}];this.checkboxModel={callBackInstance:this,callBackMethod:"onCheckChange",dataSource:s,cssClass:"e-small"};this.checkboxInst=new n.Dashboard.CheckBox(this.checkboxModel,this.fieldCheckBoxDiv);this.userSearchPanel.append(this.userSearchTextBox,this.userSearchIcon);e.append(h);o.append(this.userSearchPanel);f.append(e,o);this.fieldSearchPanel.append(this.fieldSearchTextBox,this.fieldSearchIcon);u.append(this.fieldCheckBoxDiv,this.fieldSearchPanel);r.append(c);i.append(this.fieldIconDisableDiv,r,u);t.append(this.userIconDisableDiv,f,i);this.sortUserValue=SortType.Asc;this.sortFieldValue=SortType.Asc;t.find("#"+this.id+"_user_icon_title_container p").html(this.locale.userFilterLocale.userListTitle);t.find("#"+this.id+"_field_icon_title_container p").html(this.locale.userFilterLocale.fieldListTitle)},r.prototype.updateUserListAndIcons=function(n){n?(this.userListDisableWrapper.removeClass("bbi-enable"),this.userIconDisableDiv.removeClass("bbi-enable")):(this.userListDisableWrapper.addClass("bbi-enable"),this.disableUserIcons())},r.prototype.updateFieldListAndIcons=function(n){n?(this.fieldListDisableWrapper.removeClass("bbi-enable"),this.fieldIconDisableDiv.removeClass("bbi-enable")):(this.fieldListDisableWrapper.addClass("bbi-enable"),this.disableFieldIcons())},r.prototype.disableUserIcons=function(){this.userIconDisableDiv.addClass("bbi-enable")},r.prototype.disableFieldIcons=function(){this.fieldIconDisableDiv.addClass("bbi-enable")},r.prototype.userGroupListEventHandler=function(t){switch(t.type){case"selected":this.activeUser=t.data;this.updateUIForAutoMapping();break;case"renderComplete":n.isNullOrUndefined(t.data)||n.isNullOrUndefined(t.data.userId)||n.isNullOrUndefined(t.data.isGroup)||(this.isUserListRendered=!0,this.activeUser=t.data.userinfo,this.activeUser.IsGroup=t.data.isGroup,this.activeUser.UserId=t.data.userId,this.fullUserDataSource=t.data.dataSource,this.updateAutoMappingAfterRender(),this.updateIncludeFutureItemAfterRender());break;case"clearActiveFilterUserInfo":this.clearFilterUserInfo();break;case"useFilterFrom":this.callUseFilterFrom(t.datasource);break;case"RelativeDateFilter":this.callRelativeDateFilter(this.activeUser,this.dashboardDesigner.columnDetails);break;case"checkSelectedValues":this.checkSelectedValuesForActiveUser();break;case"updateUiFieldList":this.updateUiOnFieldList(t.data.data);break;case"onUserListError":this.updateFieldListAndIcons(!1)}},r.prototype.updateUiOnFieldList=function(n){n?(this.isFieldDisabled=!1,this.updateFieldListAndIcons(!0),this.userIconDisableDiv.removeClass("bbi-enable")):(this.isFieldDisabled=!0,this.disableFieldList());this.isUserDisabled&&this.updateUiOnUserList(!1)},r.prototype.disableFieldList=function(){this.disableDiv.hasClass("bbi-enable")||(this.updateFieldListAndIcons(!1),this.disableUserIcons())},r.prototype.disableUserList=function(){this.updateUserListAndIcons(!1);this.disableFieldIcons()},r.prototype.updateUiOnUserList=function(n){n?(this.isUserDisabled=!1,this.updateUserListAndIcons(!0),this.fieldIconDisableDiv.removeClass("bbi-enable")):(this.isUserDisabled=!0,this.disableUserList());this.isFieldDisabled&&this.isUserDisabled?(this.updateUserListAndIcons(!0),this.disableFieldIcons(),this.disableUserIcons()):this.isFieldDisabled&&this.updateUiOnFieldList(!1)},r.prototype.checkSelectedValuesForActiveUser=function(){this.activeUser.SelectedValues.length>0?this.userGroupUiInst.setIsfilteredProperty(!0):this.activeUser.SelectedValues.length===0&&this.activeUser.RelativeDateFilter!=null?this.userGroupUiInst.setIsfilteredProperty(!0):this.userGroupUiInst.setIsfilteredProperty(!1)},r.prototype.callUseFilterFrom=function(t){var h=this,c={callBackInstance:this,callBackMethod:"updateCheckedItemsFromDialog",optionalArgs:""},l=JSON.stringify(this.currentActiveFilter.UserInfo),f=this.currentActiveFilter.UserInfo.filter(function(n){return n.UserId===h.activeUser.UserId})[0],r=JSON.parse(l),o,e,u,i,s;for(n.isNullOrUndefined(f)||(o=this.currentActiveFilter.UserInfo.indexOf(f),r.splice(o,1)),e=[],u=0;u<r.length;u++)for(i=0;i<t.length;i++)(r[u].IsGroup===t[i].IsGroup&&r[u].UserId===t[i].Id.toString()||r[u].IsGroup===t[i].IsGroup&&r[u].UserId===t[i].Email)&&e.push(t[i]);s={userInfo:r,currentUserInfo:f,datasource:e};this.useFilterFromInst.open(c,s)},r.prototype.callRelativeDateFilter=function(n,t){var i=this.dashboardDesigner.modules.relativeDateFilter;i.openRelativeDateFilter(this,"relativeDateFilterAction",n.RelativeDateFilter,t,null,null,this.activeUser)},r.prototype.relativeDateFilterAction=function(t,i,r,u,f){n.isNullOrUndefined(t)||(f.RelativeDateFilter=t,this.relativeDateFilterInfo=t,f.SelectedValues.length===0&&(this.userGroupUiInst.updateSelectedFieldValuesForUser(this.activeUser),this.updateFilterFieldValues(!1)))},r.prototype.updateCheckedItemsFromDialog=function(n){this.activeUser.SelectedValues=n.selectedValues;this.fieldListInst.updateTheSelectedFieldValues(n.selectedValues);this.userGroupUiInst.addUserSelection();this.updateFilterFieldValues(!1)},r.prototype.enableDisable=function(){n.isNullOrUndefined(this.selectedFieldInfo)?this.disableAll():this.enableAll()},r.prototype.disableAll=function(){this.disableDiv.addClass("bbi-enable")},r.prototype.enableAll=function(){this.disableDiv.removeClass("bbi-enable");this.isFieldDisabled&&this.updateUiOnFieldList(!1);this.isUserDisabled&&this.updateUiOnUserList(!1)},r.prototype.updateFilterFieldValues=function(t){var u=this,i=this.filterList.filter(function(n){return n.Name===u.currentActiveFilter.Name})[0],r;n.isNullOrUndefined(i)||(r=i.UserInfo.indexOf(this.activeUser),t&&r!==-1?i.UserInfo.splice(r,1):r===-1?i.UserInfo.push(this.activeUser):i.UserInfo[r]=this.activeUser)},r.prototype.createAlertForAutoMapping=function(n,t){if(this.currentActiveFilter.UserInfo.length>0&&this.currentActiveFilter.UserInfo[0].SelectedValues.length>0)this.dashboardDesigner.modules.util.alertDialog(this.locale.userFilterLocale.alertDialogTitle,this.locale.userFilterLocale.autoMappingAlertDialogMsg.replace("{0}",t),IconType.question,AlertType.Confirm,!1,"",{instance:this,method:"enableAutomapping",dataInfo:{args:n}});else{var i={args:n};this.enableAutomapping(!0,i)}},r.prototype.enableAutomapping=function(t,i){if(t){var r=i.args===n.DashboardDesignerUtility.Serialization.enumToString(BasicUserFilterBasedOn,BasicUserFilterBasedOn.FullName).toLocaleLowerCase()?BasicUserFilterBasedOn.FullName:i.args===n.DashboardDesignerUtility.Serialization.enumToString(BasicUserFilterBasedOn,BasicUserFilterBasedOn.Email).toLocaleLowerCase()?BasicUserFilterBasedOn.Email:i.args===n.DashboardDesignerUtility.Serialization.enumToString(BasicUserFilterBasedOn,BasicUserFilterBasedOn.GroupName).toLocaleLowerCase()?BasicUserFilterBasedOn.GroupName:BasicUserFilterBasedOn.None;this.currentActiveFilter.BasedOn=r;this.updateCurrentActiveUser();this.updateCurrentSelectedFilterList();this.fieldListInst.uncheckAll();this.updateUiAndCollectionForAutoMapping();this.activeUser=this.getFirstUserInitialisation();this.iconTemplateInst.updateAutomapping(r)}},r.prototype.updateAutoMappingAfterRender=function(){this.isFieldListRendered&&this.isUserListRendered&&this.updateUiAndCollectionForAutoMapping()},r.prototype.updateUiAndCollectionForAutoMapping=function(){this.mappedUserCollection=[];this.fullFieldDataSource=this.currentActiveFilter.DataSource;this.currentActiveFilter.BasedOn!==BasicUserFilterBasedOn.None?(this.createUserCollectionForAutoMapping(),this.updateUIForAutoMapping()):this.unMappedCheckBoxInst.disableItemByName("userUnmapped",!1)},r.prototype.updateUIForAutoMapping=function(){var n=this;this.mappedUserCollection.length>0&&(this.queryDesigner.userBasedFilterInfo!==null&&this.queryDesigner.userBasedFilterInfo.BasicFilters.forEach(function(t){t.UserInfo.forEach(function(t){n.mappedUserCollection.push(t)})}),this.userGroupUiInst.addAllSelectedUser(this.mappedUserCollection),this.mappedUserCollection.filter(function(t){return t.UserId===n.activeUser.UserId&&t.IsGroup===n.activeUser.IsGroup}).length>0&&this.checkAndUpdateSelectedValuesForAutoMapping());this.currentActiveFilter.BasedOn!==BasicUserFilterBasedOn.None?(this.unMappedCheckBoxInst.disableItemByName("userUnmapped",!0),this.unMappedCheckBoxInst.checkItemByName("userUnmapped",!1),this.currentActiveFilter.ShowRecordsToUnmappedUsers=!1):this.unMappedCheckBoxInst.disableItemByName("userUnmapped",!1)},r.prototype.createUserCollectionForAutoMapping=function(){for(var i,u=this.currentActiveFilter.BasedOn===BasicUserFilterBasedOn.Email?"Email":"Name",f=this.currentActiveFilter.BasedOn===BasicUserFilterBasedOn.GroupName,r=0;r<this.fullUserDataSource.length;r++){var n=this.fullUserDataSource[r],e=function(i){var e=t.fullFieldDataSource[i],r;n[u]===e.fieldid&&f===n.IsGroup&&(r=new UserInfo,r.UserId=n.IsGroup?n.Id.toString():n.Email,r.IsGroup=n.IsGroup,r.SelectedValues.push(e.fieldid),t.mappedUserCollection.filter(function(n){return n.UserId===r.UserId&&n.IsGroup===r.IsGroup}).length>0?t.mappedUserCollection.filter(function(n){return n.UserId===r.UserId&&n.IsGroup===r.IsGroup})[0]=r:t.mappedUserCollection.push(r))},t=this;for(i=0;i<this.fullFieldDataSource.length;i++)e(i)}},r.prototype.concatUserInfos=function(){var n=[];return n=n.concat(this.currentActiveFilter.UserInfo),n.concat(this.mappedUserCollection)},r.prototype.checkAndUpdateSelectedValuesForAutoMapping=function(){var n=this,t=this.mappedUserCollection.filter(function(t){return t.UserId===n.activeUser.UserId&&t.IsGroup===n.activeUser.IsGroup})[0];this.activeUser.SelectedValues.length>t.SelectedValues.length?this.fieldListInst.updateTheSelectedFieldValues(this.activeUser.SelectedValues):this.fieldListInst.updateTheSelectedFieldValues(t.SelectedValues)},r.prototype.userFieldValuesListEventHandler=function(t){if(!n.isNullOrUndefined(t.type))switch(t.type){case"onItemSelection":if(this.activeUser.SelectedValues=t.data.selectedValues,this.fullFieldDataSource.length!==this.activeUser.SelectedValues.length&&(this._activeUser.IncludeFutureValues=!1),t.data.selectedValues.length===0&&this.activeUser.RelativeDateFilter===null){this.userGroupUiInst.clearCurrentUserSelection();this.updateFilterFieldValues(!0);break}this.userGroupUiInst.updateSelectedFieldValuesForUser(this.activeUser);this.updateFilterFieldValues(!1);break;case"renderComplete":this.currentActiveFilter.DataSource=t.data.dataSource;this.currentActiveFilter.AllowVirtualScrolling=t.data.allowVirtualScrolling;this.isFieldListRendered=!0;this.updateAutoMappingAfterRender();this.updateIncludeFutureItemAfterRender();break;case"Intermediate":this.checkboxInst.checkItemByName(this.checkboxName,!1);this.checkboxInst.intermediateStateByName(this.checkboxName,!0);this.includeFutureValues.disableItemByName("active",!0);this.includeFutureValues.updateIncludeItemCheckbox("active",!1);break;case"Unchecked":this.unCheckFieldValueCheckbox();this.includeFutureValues.disableItemByName("active",!0);break;case"Checked":this.checkboxInst.intermediateStateByName(this.checkboxName,!1);this.checkboxInst.checkItemByName(this.checkboxName,!0);this.includeFutureValues.disableItemByName("active",!1);break;case"updateUiOnUserList":this.updateUiOnUserList(t.data.data);break;case"onFieldListError":this.updateUserListAndIcons(!1)}},r.prototype.updateIncludeFutureItemAfterRender=function(){n.isNullOrUndefined(this.currentActiveFilter.DataSource)||(this.fullFieldDataSource=this.currentActiveFilter.DataSource);this._activeUser.IncludeFutureValues&&this.includeFutureValues.disableItemByName("active",!1);n.isNullOrUndefined(this.fieldListInst)||(n.isNullOrUndefined(this.fullFieldDataSource)?this.fieldListInst.checkvalues(this._activeUser.IncludeFutureValues,this._activeUser.SelectedValues):this.fieldListInst.checkvalues(this._activeUser.IncludeFutureValues,this.fullFieldDataSource.map(function(n){return n.fieldid})))},r.prototype.unCheckFieldValueCheckbox=function(){this.checkboxInst.intermediateStateByName(this.checkboxName,!1);this.checkboxInst.checkItemByName(this.checkboxName,!1)},r.prototype.clearFilterUserInfo=function(){var r=this,t,i;this.activeUser.SelectedValues=[];t=this.currentActiveFilter.UserInfo.filter(function(n){return n.UserId===r.activeUser.UserId})[0];n.isNullOrUndefined(t)||(i=this.currentActiveFilter.UserInfo.indexOf(t),this.currentActiveFilter.UserInfo.splice(i,1));this.userGroupUiInst.clearCurrentUserSelection();this.fieldListInst.uncheckAll()},r.prototype.filterTemplateEventHandler=function(t){if(this.dashboardDesigner.columnDetails=t.data,!n.isNullOrUndefined(t.type))switch(t.type){case"onItemSelection":this.isFieldListRendered=!1;this.currentActiveFilter.BasedOn=BasicUserFilterBasedOn.None;this.resetIcons();this.updateCurrentActiveUser();this.fieldInfoModel=t.data.fieldInfo;this.updateCurrentSelectedFilterList();this.unCheckFieldValueCheckbox();this.selectedFieldInfo=t.data.selectedInfo;this.enableAll();this.currentActiveFilter.DataSource=null;this.updateColumnTileValue(t.data.selectedInfo);this.mappedUserCollection=[];this.modified=!0;break;case"filterNameUpdate":this.updateFilterOnFocus(t.data.name);break;case"onUIupdation":n.isNullOrUndefined(this.currentActiveFilter.DataSource)?(this.fieldInfoModel=t.data.fieldInfo,n.isNullOrUndefined(this.fieldListInst)&&this.renderFieldListWrapper(this.fieldInfoModel)):(this.fieldInfoModel=t.data.fieldInfo,this.fieldListInst.hideError(),this.setFieldDataSource(this.currentActiveFilter.DataSource,this.currentActiveFilter.AllowVirtualScrolling),this.fieldListInst.updateTheSelectedFieldValues(this.activeUser.SelectedValues),this.fieldListInst.updateFieldValueLists(this.activeUser.SelectedValues));this.modified=!0}},r.prototype.iconMenuTemplateEventHandler=function(t){if(!n.isNullOrUndefined(t.type))switch(t.type){case"userMapping":this.userGroupUiInst.updateUserMapping(t.data,this.concatUserInfos());break;case"autoMapping":this.createAlertForAutoMapping(t.data,t.text);break;case"filtering":if(!n.isNullOrUndefined(this.fieldListInst)){this.updateUserListAndIcons(!0);switch(t.data){case"data_checked":this.fieldListInst.filter(filterOptions.All);this.fieldListInst.triggerSearchEvent();break;case"Checked":this.fieldListInst.filter(filterOptions.Checked);this.fieldListInst.triggerSearchEvent();break;case"Unchecked":this.fieldListInst.filter(filterOptions.UnChecked);this.fieldListInst.triggerSearchEvent()}}}},r}(),i;t.UFBasicMode=r;i=function(n){function t(){var t=n.call(this)||this;return t.AllowVirtualScrolling=!1,t}return __extends(t,n),t}(BasicUserBasedFilter)})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){var t;(function(t){var i=function(){function t(n){this.id=null;this.dialogBox=null;this.timer=null;this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.id=this.dashboardDesigner._id+"_users_in_group";this.renderDialogBox();this.unWireEvents();this.wireEvents()}return t.prototype.renderDialogBox=function(){var r,u;this.dialogBox=n.buildTag("div .bbi-dbrd-container","",{},{id:this.id+"_dialog_container"});var f=n.buildTag("button.bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-margin-left",this.locale.alertWindow.cancelBtnText,{float:"right",height:"28px"},{id:this.id+"_cancel_btn",type:"button"}),t=n.buildTag("div .bbi-dbrd-listbox-wrapper","",{},{id:this.id+"_list_box_wrapper"}),i=n.buildTag("ul .bbi-dbrd-listbox-element ","",{unselectable:"on"},{id:this.id+"_list_box_element"});t.append(i);r=n.buildTag("div .bbi-dbrd-listbox-error-msg","<center><p><\/p><\/center>",{},{id:this.id+"_content_error_msg"});t.append(r);this.dialog=this.dialogBox.BoldBIDashboardDialog({width:"auto",height:"auto",minWidth:300,minHeight:193,enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(this.cancelFilterWindow,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText}).data("BoldBIDashboardDialog");u=this.dashboardDesigner.element.find("#"+this.id+"_dialog_container_foot");u.append(f);this.dialogBox.append(t);this.listBoxElementInst=i.BoldBIDashboardListBox({template:'<span class ="bbi-dbrd-uf-users-list"><span class ="bbi-dbrd-user-icon e-dashboarddesigner-icon-false"><\/span><span class= "bbi-dbrd-uf-users-list-text">${Name}<\/span><\/span>',width:"100%",height:"100%",cssClass:"bbi-dbrd-designer-userfilter",showRoundedCorner:!1}).data("BoldBIDashboardListBox");this.loaderInstance=t.BoldBIDashboardWaitingPopup({showOnInit:!1,showImage:!0,cssClass:"e-designer-waitingpopup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()}).data("BoldBIDashboardWaitingPopup")},t.prototype.showLoadingIndicator=function(){this.loaderInstance.show()},t.prototype.hideLoadingIndicator=function(){this.loaderInstance.hide()},t.prototype.onAccountFetchSuccess=function(t){var i=this;n.isNullOrUndefined(this.timer)||clearTimeout(this.timer);this.timer=setTimeout(function(){t.Status?n.isNullOrUndefined(t.Data)||t.Data.length===0?i.showErroMsg(i.dashboardDesigner.getLocalizationContent().userFilterLocale.noUserError):(i.listBoxElementInst.setModel({dataSource:JSON.parse(t.Data)}),i.showUserList()):i.showErroMsg(t.Message)},0)},t.prototype.showUserList=function(){this.dialogBox.find("#"+this.id+"_content_error_msg").hide();this.dialogBox.find("#"+this.id+"_list_box_element").show()},t.prototype.showErroMsg=function(n){this.dialogBox.find("#"+this.id+"_list_box_element_container").hide();this.dialogBox.find("#"+this.id+"_content_error_msg").css("display","table");this.dialogBox.find("#"+this.id+"_content_error_msg p").html(n)},t.prototype.onAccountFetchError=function(t){t.status===401?this.showErroMsg(this.locale.errorMessage.authenticationFailed+this.locale.errorMessage.invalidSession):n.isNullOrUndefined(t.responseText)||t.responseText===""?this.showErroMsg(this.locale.errorMessage.errorOnLoadingAccountInfo):this.showErroMsg(t.responseText)},t.prototype.open=function(n,t){this.setDialogTitle(t);this.dialog.open();this.fetchAccountInfo(n)},t.prototype.setDialogTitle=function(n){this.dialog.option("title",this.locale.dataSource.dialogTitletext+" - "+n)},t.prototype.showEmptyListBox=function(){this.dialogBox.find("#"+this.id+"_list_box_element").empty();this.dialogBox.find("#"+this.id+"_content_error_msg").css("display","none")},t.prototype.fetchAccountInfo=function(t){this.showEmptyListBox();this.requestObj=this.dashboardDesigner.modules.util.doAjaxPost("GET",this.dashboardDesigner.model.serviceUrl+n.Dashboard.ServiceAPI.getUsersInGroup.replace("{groupid}",t),{action:n.DashboardUtil.DesignerAction.FetchAccountInfo},{fnction:this.bbdesigner$.proxy(this.onAccountFetchSuccess,this),indicator:[this.bbdesigner$.proxy(this.showLoadingIndicator,this),this.bbdesigner$.proxy(this.hideLoadingIndicator,this)],errfnction:this.bbdesigner$.proxy(this.onAccountFetchError,this)},!0,!0)},t.prototype.cancelFilterWindow=function(){this.loaderInstance.hide();this.dialog.close()},t.prototype.wireEvents=function(){this.dashboardDesigner.element.on("click","#"+this.id+"_cancel_btn",this.bbdesigner$.proxy(this.cancelFilterWindow,this))},t.prototype.unWireEvents=function(){this.dashboardDesigner.element.on("click","#"+this.id+"_cancel_btn",this.bbdesigner$.proxy(this.cancelFilterWindow,this))},t}();t.UsersInGroup=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){var t;(function(t){var i=function(){function t(t,i,r,u,f){this.fullDatasource=[];this.inputText="";this.isFilterInitiated=null;this.initialLoad=null;this.currentDatasource=[];this.selectedValues=[];this.callBackInstance=null;this.callBackMethod=null;this.isFiltered=!1;this.isInitialFilter=!1;this.locale=null;this.callBackInstance=u;this.locale=t.getLocalizationContent();this.callBackMethod=f;this.dashboardDesigner=t;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.virtualScrolling=new VirtualScrollSettings;this.id=(!n.isNullOrUndefined(r.attr("id"))&&r.attr("id")!==""?r.attr("id"):this.dashboardDesigner._id)+"_uf_field_action";r.data("DesignerPropertyWidget",this);this.createListBoxElement(r);this.unWireEvents();this.wireEvents();this.fieldInfo=i}return t.prototype.invokeCallBackHandler=function(t){n.isNullOrUndefined(this.callBackInstance)||n.isNullOrUndefined(this.callBackMethod)||n.DashboardUtil.invokeMethod(this.callBackInstance,this.callBackMethod,[t])},t.prototype.createListBoxElement=function(t){var r=this.wrapper=n.buildTag("div","",{height:"100%",width:"258px"},{id:this.id+"_wrapper"}),i=n.buildTag("div","",{},{id:this.id+"_content_container"}),u=n.buildTag("div.bbi-dbrd-designer-fieldvalue-list","",{},{id:this.id+"_fieldvalue_list"}),e=this.ulElement=n.buildTag("ul.bbi-dbrd-designer-ulelement","",{},{id:this.id+"_field_list_ulelement"}),o=n.buildTag("div.bbi-dbrd-designer-error","<center><p><\/p><\/center>",{},{id:this.id+"_error_message"}),f=n.buildTag("div.bbi-dbrd-designer-retry","",{},{id:this.id+"_retry_block"}),s=n.buildTag("button.bbi-dbrd-btn-primary bbi-dbrd-btn-small",this.locale.browseDialogMessages.retryText,{},{id:this.id+"_retry_btn",type:"button"}),h=this.loadingPopup=n.buildTag("div.bbi-dbrd-designer-loading-popup","",{},{id:this.id+"_wrapper_loading_popup"});u.append(e);f.append(s);i.append(u);r.append(o,f,h,i);t.append(r);this.ulElement.BoldBIDashboardListBox({showCheckbox:!0,width:"258px",height:"285px",checkChange:this.bbdesigner$.proxy(this.fieldValueSelection,this),cssClass:"bbi-dbrd-designer-fieldlist",actionBegin:this.bbdesigner$.proxy(this.renderData,this)});this.bufferIndicator=i.BoldBIDashboardWaitingPopup({showonInit:!1,cssClass:"e-designer-waitingpopup bbi-designer-loader e-field-list-waiting-popup",template:this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_designer_waiting_loader")}).data("BoldBIDashboardWaitingPopup")},t.prototype.updateFieldValueLists=function(n){this.selectedValues=n;this.isFilterInitiated=filterOptions.All;this.filter(this.isFilterInitiated);this.updateFieldCheckbox()},t.prototype.wireEvents=function(){this.wrapper.on("click","#"+this.id+"_retry_btn",this.bbdesigner$.proxy(this.reloadDataSource,this))},t.prototype.unWireEvents=function(){this.wrapper.off("click","#"+this.id+"_retry_btn",this.bbdesigner$.proxy(this.reloadDataSource,this))},t.prototype.showFieldList=function(){this.wrapper.css("display","block")},t.prototype.hideFieldList=function(){this.wrapper.css("display","none")},t.prototype.resetRequest=function(){n.isNullOrUndefined(this.requestObj)||this.requestObj.readyState===4||(this.requestObj.abort(),this.requestObj=null)},t.prototype.getFieldValues=function(t,i){this.hideError();this.selectedValues=n.isNullOrUndefined(i)?this.selectedValues:i;this.virtualScrolling.PageSize=1e3;var r=[t];this.requestObj=this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+n.Dashboard.ServiceAPI.processdata,{action:n.DashboardUtil.DesignerAction.getData,data:JSON.stringify({className:n.DashboardUtil.DesignerAction.FilterAction,designerAction:n.DashboardUtil.DesignerAction.getData,fieldInfo:r,dataSetId:t.DatasourceID,startIndex:this.virtualScrolling.StartIndex,pageSize:this.virtualScrolling.PageSize,isQueryDesignerMode:!0})},{fnction:this.bbdesigner$.proxy(this.onFieldDataFetch,this),indicator:[this.bbdesigner$.proxy(this.showLoadingIndicator,this),this.bbdesigner$.proxy(this.hideLoadingIndicator,this)],errfnction:this.bbdesigner$.proxy(this.requestFailed,this)},!0)},t.prototype.checkAndUnCheckAllFieldValues=function(t){var u=this,f=!1,i,r;!n.isNullOrUndefined(this.inputText)&&this.inputText.length>0&&!this.allowVirtualScrolling?(this.isFilterInitiated===null&&this.checkAndUncheckFieldValues(this.searchedText,t),this.isFilterInitiated===filterOptions.Checked&&this.checkAndUncheckFieldValues(this.filterSearched,t),this.isFilterInitiated===filterOptions.UnChecked&&this.checkAndUncheckFieldValues(this.uncheckedText,t)):this.isFilterInitiated!==null?(this.isFilterInitiated===filterOptions.Checked&&(i=this.getCheckedText(this.getCheckedItems()),this.checkAndUncheckFieldValues(i,t)),this.isFilterInitiated===filterOptions.UnChecked&&this.checkAndUncheckFieldValues(this.unCheckedDataOnMapping,t)):t?(this.ulElement.BoldBIDashboardListBox("checkAll"),this.ulElement.BoldBIDashboardListBox("getCheckedItems").filter(function(n){return u.selectedValues.push(n.text)}),this.inputText.length>0||(f=!0)):this.allowVirtualScrolling?this.checkAndUncheckFieldValues(this.getFieldItems(),t):(this.selectedValues=[],this.ulElement.BoldBIDashboardListBox("uncheckAll"));r={type:"onItemSelection",data:{selectedValues:this.selectedValues}};this.invokeCallBackHandler(r)},t.prototype.checkvalues=function(t,i){if(t){this.ulElement.BoldBIDashboardListBox("checkAll");n.isNullOrUndefined(i)||(this.selectedValues=i);var r={type:"onItemSelection",data:{selectedValues:this.selectedValues}};this.invokeCallBackHandler(r)}},t.prototype.checkAndUncheckFieldValues=function(n,t){var i,r,u;if(t)for(i=0;i<n.length;i++)r=this.ulElement.BoldBIDashboardListBox("getIndexByText",n[i]),this.ulElement.BoldBIDashboardListBox("checkItemByIndex",r),this.selectedValues.push(n[i]),this.selectedValues=this.getUniqueValues(this.selectedValues);else for(i=0;i<n.length;i++)r=this.ulElement.BoldBIDashboardListBox("getIndexByText",n[i]),this.ulElement.BoldBIDashboardListBox("uncheckItemByIndex",r),this.selectedValues=this.getUniqueValues(this.selectedValues),u=this.selectedValues.indexOf(n[i]),u!==-1&&this.selectedValues.splice(u,1)},t.prototype.setSelectedValues=function(){for(var t=this.ulElement.BoldBIDashboardListBox("getCheckedItems"),i=[],n=0;n<t.length;n++)t[n].value!==""&&i.push(t[n].value);return i},t.prototype.onFieldDataFetch=function(t){if(n.isNullOrUndefined(t)||t==="[]")this.displayError(this.locale.errorMessage.dataRetrievalError);else{this.ulElement.css("display","block");this.fullDatasource=JSON.parse(t.jsonData);this.hasRecords=t.hasMoreRecords;var i=this.fieldInfo.UniqueColumnName;this.virtualScrolling.PageSize=1e3;this.hideError();this.hasRecords?(this.initialLoad=!0,this.allowVirtualScrolling=!0,this.ulElement.BoldBIDashboardListBox({dataSource:this.updateDataManager(),fields:{id:i,text:i},allowVirtualScrolling:!0,virtualScrollMode:n.VirtualScrollMode.Continuous,itemRequestCount:this.virtualScrolling.PageSize,actionBegin:this.bbdesigner$.proxy(this.renderData,this),actionComplete:this.bbdesigner$.proxy(this.setCheckedValues,this)})):(this.hasRecords=!1,this.allowVirtualScrolling=!1,this.ulElement.BoldBIDashboardListBox({dataSource:this.fullDatasource,fields:{id:i,text:i},allowVirtualScrolling:this.hasRecords,actionBegin:this.bbdesigner$.proxy(this.renderData,this)}));this.initialLoad&&(this.initialLoad=!1);this.tooltipForLengthFieldText();this.updateUiOnFieldList();this.triggerRenderComplete()}},t.prototype.tooltipForLengthFieldText=function(){for(var n=0;n<this.ulElement.children().length;n++)this.bbdesigner$(this.ulElement.children()[n]).attr({"data-tooltip":this.ulElement.children()[n].id,"data-val-txt-len":"true","class":"bbi-dbrd-designer-hoverable"})},t.prototype.updateUiOnFieldList=function(){this.invokeCallBackHandler({type:"updateUiOnUserList",data:{data:!0}})},t.prototype.triggerRenderComplete=function(){var n={type:"renderComplete",data:{dataSource:this.fullDatasource,allowVirtualScrolling:this.allowVirtualScrolling}};this.invokeCallBackHandler(n);this.updateTheSelectedFieldValues(this.selectedValues)},t.prototype.updateDataManager=function(){var t=this,i=new n.Adaptor(null).extend({processQuery:this.bbdesigner$.proxy(this.processQuery,this),beforeSend:function(n,i){t.dashboardDesigner.beforeSendRequestForDataManager("OnDemandDataAction",i)},processResponse:this.bbdesigner$.proxy(this.processResponse,this)});return new n.DataManager({url:this.dashboardDesigner.model.serviceUrl+n.Dashboard.ServiceAPI.processdata,adaptor:new i,crossDomain:!0})},t.prototype.setCheckedValues=function(){this.updateCheckedValues()},t.prototype.updateCheckedValues=function(){n.isNullOrUndefined(this.selectedValues)||(this.ulElement.BoldBIDashboardListBox("uncheckAll"),this.checkByIndex(this.selectedValues));this.updateSelectedvalues(this.setSelectedValues());this.filter(this.isFilterInitiated);this.updateFieldCheckbox()},t.prototype.processQuery=function(t){var i,r;return this.initialLoad&&!this.isFiltered?(t.cancel=!0,!1):(this.loadingPopup.show(),i=this.ulElement.data("BoldBIDashboardListBox"),this.virtualScrolling.StartIndex=i._listSize+1,this.virtualScrolling.PageSize=1e3,this.fieldInfo.FilterInfo=new n.Dashboard.FilterInfoForUI,this.isFiltered&&this.inputText.length>0&&(this.fieldInfo.FilterInfo.DimensionFilterInfo=this.getFilterInfo(this.inputText),this.ulElement.removeAttr("style")),this.isSorted&&(this.fieldInfo.CustomSorting=new n.Dashboard.CustomSortForUI,this.fieldInfo.CustomSorting.CustomSortType="Alphabetic",this.fieldInfo.CustomSorting.CustomSortOrder=this.sortMethod),r=[this.fieldInfo],{url:t.dataSource.url,type:"POST",contentType:"application/json",data:JSON.stringify({className:n.DashboardUtil.DesignerAction.FilterAction,designerAction:n.DashboardUtil.DesignerAction.getData,fieldInfo:r,dataSetId:this.fieldInfo.DatasourceID,startIndex:this.virtualScrolling.StartIndex,filterType:this.isInitialFilter?"InitialFilter":"null",hasFilter:this.isFiltered,pageSize:this.virtualScrolling.PageSize})})},t.prototype.clearListItems=function(){var t=this.ulElement.data("BoldBIDashboardListBox");n.isNullOrUndefined(t)||(t._loadInitialRemoteData=!1,t._oldStartValue=undefined,t.totalItemsCount=t._listSize,!n.isNullOrUndefined(t._listitems)&&t._listSize>0?this.ulElement.empty():t.model.totalItemsCount=t._listSize+1)},t.prototype.getFilterInfo=function(n){var t=new DimensionFilterInfo;return t.AllowFilterInfo=new AllowFilteringInfo,n.length>0&&(t.IsAllowFilteringApplied=!0,t.AllowFilterInfo.Conditions=TextFilterOption.StartsWith.toString(),t.AllowFilterInfo.IsInclude=!0,t.AllowFilterInfo.FilterValues=[n]),t},t.prototype.processResponse=function(t){if(!n.isNullOrUndefined(t.data)&&t.data!=="[]"){this.loadingPopup.hide();var i=this.ulElement.data("BoldBIDashboardListBox");return this.fullDatasource=JSON.parse(t.data),i.model.totalItemsCount=t.hasMoreRecords?i._listSize+this.fullDatasource.length+1:i._listSize+this.fullDatasource.length,this.currentDatasource=this.currentDatasource.concat(this.fullDatasource),this.getUniqueDataSource(),this.fullDatasource}},t.prototype.renderData=function(n){if(this.initialLoad){n.cancel=!0;var t=this.ulElement.data("BoldBIDashboardListBox");t.model.dataSource=this.fullDatasource;this.currentDatasource=this.fullDatasource;t.model.totalItemsCount=this.hasRecords?this.fullDatasource.length+1:t._listSize+1}},t.prototype.fieldValueSelection=function(t){var i,r;t.isInteraction&&!n.isNullOrUndefined(t.event)&&(this.selectedValues.indexOf(t.value)===-1||this.selectedValues.length===0?(this.selectedValues.push(t.value),this.selectedValues=this.getUniqueValues(this.selectedValues)):this.selectedValues.indexOf(t.value)===-1||n.isNullOrUndefined(t.event)||t.event.isChecked!==!1&&t.isChecked!==!1||(i=this.selectedValues.indexOf(t.value),this.selectedValues.splice(i,1),this.selectedValues=this.getUniqueValues(this.selectedValues)),r={type:"onItemSelection",data:{selectedValues:this.selectedValues}},this.invokeCallBackHandler(r),this.updateFieldCheckbox())},t.prototype.getUniqueValues=function(n){for(var i=[],t=0;t<n.length;t++)i.indexOf(n[t])===-1&&i.push(n[t]);return i},t.prototype.getUniqueDataSource=function(){this.currentDatasource=this.currentDatasource.filter(function(n,t,i){return t===i.findIndex(function(t){return t.fieldId===n.fieldId})})},t.prototype.updateFieldCheckbox=function(){var i,t;this.selectedValues=this.getUniqueValues(this.selectedValues);this.allowVirtualScrolling||this.isFilterInitiated!==null?this.allowVirtualScrolling&&this.isFilterInitiated===null?this.inputText.length>0?(i=this.getFieldItems(),t=this.getCount(i,this.selectedValues),this.switchCheckboxState(t,i.length)):this.switchCheckboxState(this.selectedValues.length,this.currentDatasource.length):this.isFilterInitiated!==null&&this.checkboxStateForMapping():!n.isNullOrUndefined(this.inputText)&&this.inputText.length>0?(t=this.getCount(this.searchedText,this.selectedValues),this.switchCheckboxState(t,this.searchedText.length)):this.switchCheckboxState(this.selectedValues.length,this.fullDatasource.length)},t.prototype.checkboxStateForMapping=function(){var i,t,n;this.isFilterInitiated===null||this.inputText.length===0||this.allowVirtualScrolling?this.isFilterInitiated===filterOptions.Checked?(this.checkedDataOnMapping=this.getUniqueValues(this.checkedDataOnMapping),this.inputText.length>0?(t=this.getCount(this.getFieldItems(),this.checkedDataOnMapping),n=this.getCount(this.getFieldItems(),this.selectedValues),this.switchCheckboxState(n,t)):this.switchCheckboxState(this.selectedValues.length,this.checkedDataOnMapping.length)):(this.unCheckedDataOnMapping=this.getUniqueValues(this.unCheckedDataOnMapping),this.inputText.length>0?(t=this.getCount(this.getFieldItems(),this.unCheckedDataOnMapping),n=this.getCount(this.getFieldItems(),this.selectedValues),this.switchCheckboxState(n,t)):(n=this.getCount(this.unCheckedDataOnMapping,this.selectedValues),this.switchCheckboxState(n,this.unCheckedDataOnMapping.length))):this.isFilterInitiated===filterOptions.Checked?this.inputText.length>0?(n=this.getCount(this.filterSearched,this.selectedValues),this.switchCheckboxState(n,this.filterSearched.length)):(i=this.getCheckedText(this.checkedDataOnMapping),this.switchCheckboxState(this.selectedValues.length,i.length)):this.inputText.length>0?(n=this.getCount(this.uncheckedText,this.selectedValues),this.switchCheckboxState(n,this.uncheckedText.length)):(n=this.getCount(this.unCheckedDataOnMapping,this.selectedValues),this.switchCheckboxState(n,this.unCheckedDataOnMapping.length))},t.prototype.getCount=function(n,t){for(var i,u=0,r=0;r<n.length;r++)for(i=0;i<t.length;i++)n[r]===t[i]&&u++;return u},t.prototype.switchCheckboxState=function(n,t){n>0&&n!==t?this.setCheckboxDataType(CheckList.Intermeditae):n===0?this.setCheckboxDataType(CheckList.Uncheck):this.setCheckboxDataType(CheckList.Check)},t.prototype.setCheckboxDataType=function(n){var t={type:n};this.invokeCallBackHandler(t)},t.prototype.updateTheSelectedFieldValues=function(n){var t,i;for(this.selectedValues=n,this.ulElement.BoldBIDashboardListBox("uncheckAll"),t=0;t<n.length;t++)i=this.ulElement.BoldBIDashboardListBox("getIndexByText",n[t]),this.ulElement.BoldBIDashboardListBox("checkItemByIndex",i);this.filter(this.isFilterInitiated);this.updateFieldCheckbox()},t.prototype.requestFailed=function(n){n.statusText&&this.displayErrorMsg()},t.prototype.displayErrorMsg=function(){this.invokeCallBackHandler({type:"updateUiOnUserList",data:{data:!1}});this.displayError(this.locale.errorMessage.serverConnectionError)},t.prototype.displayError=function(n){this.wrapper.find("#"+this.id+"_error_message").css("display","block");this.wrapper.find("#"+this.id+"_error_message p").html(n);this.wrapper.find("#"+this.id+"_retry_block").show()},t.prototype.hideError=function(){this.wrapper.find("#"+this.id+"_error_message p").empty();this.wrapper.find("#"+this.id+"_error_message").css("display","none");this.wrapper.find("#"+this.id+"_retry_block").hide()},t.prototype.showLoadingIndicator=function(){this.bufferIndicator.show()},t.prototype.hideLoadingIndicator=function(){this.bufferIndicator.hide()},t.prototype.reloadDataSource=function(){this.hideError();this.getFieldValues(this.fieldInfo)},t.prototype.search=function(t){var r,i,o,u,f,e,s;if(this.allowVirtualScrolling)n.isNullOrUndefined(t)||(this.inputText=t,this.processFilterDataRequest());else if(r=this.searchInDatasource(t),n.isNullOrUndefined(r))u=this.getCheckedText(this.getCheckedItems()),this.isFilterInitiated!=null?this.filter(this.isFilterInitiated):(this.hideError(),this.setDatasource(this.fullDatasource),this.checkByIndex(u),this.updateFieldCheckbox(),this.tooltipForLengthFieldText());else if(n.isNullOrUndefined(r.length)||r.length===0)r===0?this.displayError(this.locale.errorMessage.serverConnectionError):(this.ulElement.BoldBIDashboardListBox("hideAllItems"),s=this.locale.userFilterLocale.noResultsFound,this.noData(s));else{for(i=void 0,this.searchedText=[],i=0;i<r.length;i++)this.searchedText[i]=this.ulElement.BoldBIDashboardListBox("getTextByIndex",r[i]);if(o=this.getCheckedItems(),u=this.getCheckedText(o),this.filterSearched=[],this.uncheckedText=[],f=void 0,this.isFilterInitiated!=null&&u.length!==0){for(i=0;i<this.searchedText.length;i++)for(f=0,e=0;e<u.length;e++)if(this.searchedText[i]===u[e]){this.filterSearched=this.filterSearched.concat(this.searchedText[i]);break}else if(f++,f===u.length){this.uncheckedText=this.uncheckedText.concat(this.searchedText[i]);break}this.isFilterInitiated===filterOptions.Checked?(this.wrapper.find("#"+this.id+"_error_message").css("display","none"),this.ulElement.BoldBIDashboardListBox("hideAllItems"),this.setCheckboxDataType(CheckList.Check),this.ulElement.BoldBIDashboardListBox("showItemsByValues",this.filterSearched),this.filterSearched.length===0?(this.setCheckboxDataType(CheckList.Uncheck),this.showErrorMessage()):this.setCheckboxDataType(CheckList.Check)):(this.wrapper.find("#"+this.id+"_error_message").css("display","none"),this.showFieldValues(r),this.ulElement.BoldBIDashboardListBox("hideAllItems"),this.ulElement.BoldBIDashboardListBox("showItemsByValues",this.uncheckedText),this.setCheckboxDataType(CheckList.Uncheck),r.length===this.filterSearched.length&&this.showErrorMessage())}else this.hideError(),this.showFieldValues(r)}},t.prototype.processFilterDataRequest=function(){var i,t;this.isFiltered=!0;this.currentDatasource=[];i=this.fieldInfo.UniqueColumnName;this.getUniqueValues(this.selectedValues);this.clearListItems();t=this.ulElement.data("BoldBIDashboardListBox");t._listSize=0;t._loadInitialRemoteData=!0;this.ulElement.BoldBIDashboardListBox({dataSource:this.updateDataManager(),fields:{id:i,text:i},allowVirtualScrolling:!0,virtualScrollMode:n.VirtualScrollMode.Continuous,itemRequestCount:this.virtualScrolling.PageSize,actionBegin:this.bbdesigner$.proxy(this.renderData,this),actionComplete:this.bbdesigner$.proxy(this.setCheckedValues,this)});t.scrollerObj.refresh()},t.prototype.showFieldValues=function(n){this.ulElement.BoldBIDashboardListBox("hideAllItems");this.ulElement.BoldBIDashboardListBox("showItemsByIndices",n);this.updateFieldCheckbox();this.tooltipForLengthFieldText()},t.prototype.searchInDatasource=function(t){var u=[],r=this.ulElement.data("BoldBIDashboardListBox").model.dataSource,e=this.fieldInfo.UniqueColumnName,i,f;if(this.inputText=t.toUpperCase(),n.isNullOrUndefined(r))return 0;if(this.inputText.length>0){for(i=0;i<r.length;i++)f=String(r[i][e]).toUpperCase(),this.inputText!==""&&f.startsWith(this.inputText)&&u.push(i);return u}return null},t.prototype.setDatasource=function(t,i){if(this.emptyFieldValues(),i){this.fullDatasource=t;this.allowVirtualScrolling=i;var r=this.fieldInfo.UniqueColumnName;this.initialLoad=!0;this.isFiltered=!1;this.sortMethod=SortType.Asc;this.sortMethod=this.sortMethod===SortType.Asc?"Ascending":"Descending";this.clearListItems();this.ulElement.removeAttr("style");this.ulElement.data("BoldBIDashboardListBox").destroy();this.ulElement.BoldBIDashboardListBox({dataSource:this.updateDataManager(),showCheckbox:!0,width:"258px",height:"285px",checkChange:this.bbdesigner$.proxy(this.fieldValueSelection,this),cssClass:"bbi-dbrd-designer-fieldlist",fields:{id:r,text:r},allowVirtualScrolling:!0,virtualScrollMode:n.VirtualScrollMode.Continuous,itemRequestCount:this.virtualScrolling.PageSize,actionBegin:this.bbdesigner$.proxy(this.renderAction,this),actionComplete:this.bbdesigner$.proxy(this.setCheckedValues,this)});this.initialLoad&&(this.initialLoad=!1)}else this.ulElement.data("BoldBIDashboardListBox").option({dataSource:t});this.updateFieldCheckbox()},t.prototype.renderAction=function(n){if(this.initialLoad){n.cancel=!0;var t=this.ulElement.data("BoldBIDashboardListBox");this.currentDatasource=this.fullDatasource;t.model.totalItemsCount=this.allowVirtualScrolling?this.fullDatasource.length+1:t._listSize+1;t.mergeData(this.fullDatasource)}},t.prototype.emptyFieldValues=function(){this.ulElement.data("BoldBIDashboardListBox").setModel({dataSource:[]})},t.prototype.sort=function(n){if(this.sortMethod=n,this.allowVirtualScrolling)this.sortForVirtualScrolling();else switch(n){case SortType.Asc:this.sortAction(n);break;case SortType.Desc:this.sortAction(n)}},t.prototype.sortForVirtualScrolling=function(){var i,t;this.isFiltered=!1;this.isSorted=!0;this.currentDatasource=[];i=this.fieldInfo.UniqueColumnName;this.clearListItems();t=this.ulElement.data("BoldBIDashboardListBox");t._listSize=0;t._loadInitialRemoteData=!0;this.sortMethod=this.sortMethod===SortType.Asc?"Ascending":"Descending";this.fieldInfo.CustomSorting=new n.Dashboard.CustomSortForUI;this.fieldInfo.CustomSorting.CustomSortType="Alphabetic";this.fieldInfo.CustomSorting.CustomSortOrder=this.sortMethod;this.ulElement.BoldBIDashboardListBox({dataSource:this.updateDataManager(),fields:{id:i,text:i},allowVirtualScrolling:!0,virtualScrollMode:n.VirtualScrollMode.Continuous,itemRequestCount:this.virtualScrolling.PageSize,actionBegin:this.bbdesigner$.proxy(this.renderData,this),actionComplete:this.bbdesigner$.proxy(this.setCheckedValues,this)});t.scrollerObj.refresh()},t.prototype.sortAction=function(t){var i=this.getCheckedText(this.ulElement.BoldBIDashboardListBox("getCheckedItems")),r=this.methodToSort(this.fullDatasource,t);this.setDatasource(r);this.checkByIndex(i);this.isFilterInitiated==null||n.isNullOrUndefined(this.inputText)||this.filter(this.isFilterInitiated);n.isNullOrUndefined(this.inputText)||this.search(this.inputText);this.tooltipForLengthFieldText()},t.prototype.reload=function(){this.fullDatasource=[];this.currentDatasource=[];this.inputText="";this.getFieldValues(this.fieldInfo)},t.prototype.methodToSort=function(t,i){var r,u;return n.isNullOrUndefined(t)||t.length===0||(i===SortType.Asc?t.sort(function(n,t){return typeof n.fieldid=="number"&&typeof t.fieldid=="number"?(r=n.fieldid,u=t.fieldid):(r=String(n.fieldid).toLowerCase(),u=String(t.fieldid).toLowerCase()),r<u?-1:r>u?1:0}):i===SortType.Desc&&t.sort(function(n,t){return typeof n.fieldid=="number"&&typeof t.fieldid=="number"?(r=n.fieldid,u=t.fieldid):(r=String(n.fieldid).toLowerCase(),u=String(t.fieldid).toLowerCase()),u<r?-1:u>r?1:0})),t},t.prototype.getCheckedText=function(t){var r=[],i;if(!n.isNullOrUndefined(t)&&t.length!==0){for(i=0;i<t.length;i++)t[i].text!==""&&(r[i]=t[i].text);return r}return null},t.prototype.checkByIndex=function(t){var r=[],u,i;if(!n.isNullOrUndefined(t)&&t.length!==0){for(i=0;i<t.length;i++)r[i]=this.ulElement.BoldBIDashboardListBox("getIndexByText",t[i]);for(this.ulElement.BoldBIDashboardListBox("uncheckAll"),u=[],i=0;i<r.length;i++)r[i]>=0&&u.push(r[i]);this.ulElement.BoldBIDashboardListBox("checkItemsByIndices",u)}},t.prototype.checkAll=function(){n.isNullOrUndefined(this.ulElement.data("BoldBIDashboardListBox"))||this.ulElement.BoldBIDashboardListBox("checkAll")},t.prototype.uncheckAll=function(){n.isNullOrUndefined(this.ulElement.data("BoldBIDashboardListBox"))||this.ulElement.BoldBIDashboardListBox("unCheckAll");this.setCheckboxDataType(CheckList.Uncheck)},t.prototype.getCheckedItems=function(){var t=this.ulElement.BoldBIDashboardListBox("getCheckedItems");return n.isNullOrUndefined(t)||t.length===0?[]:t},t.prototype.filter=function(n){this.hideError();this.checkedDataOnMapping=this.allowVirtualScrolling?this.selectedValues:this.getCheckedItems();switch(n){case filterOptions.All:this.ulElement.BoldBIDashboardListBox("showAllItems");this.isFilterInitiated=null;this.updateFieldCheckbox();break;case filterOptions.Checked:this.checkedOption(this.selectedValues);break;case filterOptions.UnChecked:this.unCheckedOption(this.selectedValues)}},t.prototype.updateSelectedvalues=function(n){for(var t=0;t<n.length;t++)this.selectedValues.push(n[t]);this.getUniqueValues(this.selectedValues)},t.prototype.checkedOption=function(t){this.setCheckboxDataType(CheckList.Check);this.ulElement.BoldBIDashboardListBox("hideAllItems");n.isNullOrUndefined(t)||t.length===0?(this.isFilterInitiated=filterOptions.Checked,this.setCheckboxDataType(CheckList.Uncheck),this.showErrorMessage()):(this.isFilterInitiated=filterOptions.Checked,this.ulElement.BoldBIDashboardListBox("showItemsByValues",t));this.allowVirtualScrolling&&this.ulElement.css("height","300px")},t.prototype.unCheckedOption=function(t){if(this.getUnCheckedItems(),this.setCheckboxDataType(CheckList.Uncheck),this.isFilterInitiated=filterOptions.UnChecked,!n.isNullOrUndefined(t)&&t.length>0){var i=this.ulElement.data("BoldBIDashboardListBox");t.length===i._listSize?(this.ulElement.BoldBIDashboardListBox("hideAllItems"),this.showErrorMessage()):(this.ulElement.BoldBIDashboardListBox("showAllItems"),this.ulElement.BoldBIDashboardListBox("hideCheckedItems"))}else this.ulElement.BoldBIDashboardListBox("showAllItems");this.allowVirtualScrolling&&this.ulElement.css("height","300px")},t.prototype.getUnCheckedItems=function(){var u,t,i,r,n;if(this.unCheckedDataOnMapping=[],t=[],i=this.fieldInfo.UniqueColumnName,this.getUniqueDataSource(),t=this.allowVirtualScrolling?this.currentDatasource:this.fullDatasource,this.selectedValues=this.getUniqueValues(this.selectedValues),this.selectedValues.length>0)for(n=0;n<t.length;n++)for(u=0,r=0;r<this.selectedValues.length;r++)this.selectedValues[r]!==t[n][i]&&(u++,u===this.selectedValues.length&&this.unCheckedDataOnMapping.push(t[n][i]));else for(n=0;n<t.length;n++)this.unCheckedDataOnMapping.push(t[n][i])},t.prototype.getFieldItems=function(){for(var i=this.fieldInfo.UniqueColumnName,t=[],n=0;n<this.currentDatasource.length;n++)t.push(this.currentDatasource[n][i]);return t},t.prototype.showErrorMessage=function(){var n=this.locale.userFilterLocale.noResultsFound;this.noData(n)},t.prototype.triggerSearchEvent=function(){n.isNullOrUndefined(this.inputText)||this.search(this.inputText)},t.prototype.noData=function(n){this.wrapper.find("#"+this.id+"_error_message").css("display","block");this.wrapper.find("#"+this.id+"_error_message p").html(n);this.invokeCallBackHandler({type:"onFieldListError",data:{data:!1}})},t.prototype.disable=function(){var t=this.ulElement.data("BoldBIDashboardListBox");n.isNullOrUndefined(t)||t.disable()},t.prototype.enable=function(){var t=this.ulElement.data("BoldBIDashboardListBox");n.isNullOrUndefined(t)||t.enable()},t}();t.UserFilterFieldValueList=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){n.Asc="ascending";n.Desc="descending"}(SortType||(SortType={})),function(n){n.All="All";n.Checked="Checked";n.UnChecked="UnChecked"}(filterOptions||(filterOptions={})),function(n){n.Check="Checked";n.Uncheck="Unchecked";n.Intermeditae="Intermediate"}(CheckList||(CheckList={})),function(n){var t;(function(t){var i=function(){function t(n,t,i,r){this.callBackInstance=null;this.callBackMethod=null;this.autoMapping=BasicUserFilterBasedOn.None;this.locale=null;this.callBackInstance=i;this.callBackMethod=r;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.id=t.attr("id");this.iconContainer=t;this.createIconTemplateElement(t);this.unWireEvents();this.wireEvents()}return t.prototype.createIconTemplateElement=function(t){var f,r;if(!n.isNullOrUndefined(t))for(f=t.children(),r=0;r<f.length;r++){var i=f.eq(r),u=!n.isNullOrUndefined(i.attr("data-name"))&&i.attr("data-name")==="field",h=u?"bbi-dbrd-uf-field-icon-list bbi-dbrd-uf-list-icon-container":"bbi-dbrd-uf-list-icon-container",e=n.buildTag("div."+h,"",{},{id:this.id+"_container"}),o=n.buildTag("div.bbi-dbrd-uf-list-icon-user-mapping bbi-dbrd-designer-hand-cursor bbi-dbrd-designer-hoverable","",{},{id:this.id+"_usermapping","data-name":"userGroupMapping","data-tooltip":this.locale.userFilterLocale.autoMapUsers}),c=n.buildTag("div.bbi-dbrd-uf-list-icon-user-mapping-shuffle","",{},{id:this.id+"_usermapping_shuffle","data-name":"userGroupMapping"}),l=n.buildTag("div.bbi-dbrd-uf-list-icon-user-mapping-dropdown","",{},{id:this.id+"_usermapping_dropdown","data-name":"userGroupMapping"}),s=n.buildTag("div.bbi-dbrd-uf-list-icon-sorting bbi-dbrd-uf-list-icon-container bbi-dbrd-icon-background-theme bbi-dbrd-designer-hand-cursor bbi-dbrd-designer-hoverable","",{},{id:this.id+"_sorting","data-name":u?"fieldSorting":"userGroupSorting","data-tooltip":this.locale.userFilterLocale.sort});o.append(c,l);this.appendIconElement(u,e,o);u?(i.find(".bbi-dbrd-uf-field-icon-title-wrapper").append(e),i.find(".bbi-dbrd-uf-field-icon-search-wrapper").append(s)):(i.find(".bbi-dbrd-uf-user-icon-title-wrapper").append(e),i.find(".bbi-dbrd-uf-user-icon-search-wrapper").append(s))}},t.prototype.updateIcons=function(n){this.updateCheckIconForMenu("_view_userlist_ConfigMenu","user_mapped");this.updateCheckIconForMenu("_view_data_ConfigMenu","data_checked");this.updateAutomapping(n)},t.prototype.updateAutomapping=function(n){this.autoMapping=n},t.prototype.updateAutoMappingMenu=function(n){if(n.length>0)switch(this.autoMapping){case BasicUserFilterBasedOn.None:this.switchCheckIcon("none");break;case BasicUserFilterBasedOn.Email:this.switchCheckIcon("email");break;case BasicUserFilterBasedOn.FullName:this.switchCheckIcon("fullname");break;case BasicUserFilterBasedOn.GroupName:this.switchCheckIcon("groupname")}},t.prototype.invokeCallBackHandler=function(t){n.isNullOrUndefined(this.callBackInstance)||n.isNullOrUndefined(this.callBackMethod)||n.DashboardUtil.invokeMethod(this.callBackInstance,this.callBackMethod,[t])},t.prototype.appendIconElement=function(t,i,r){var u=n.buildTag("div.bbi-dbrd-uf-list-icon-view bbi-dbrd-icon-background-theme bbi-dbrd-designer-hand-cursor bbi-dbrd-designer-hoverable","",{},{id:t?this.id+"_view_Data":this.id+"_view_userlist","data-name":t?"viewFieldData":"viewUserList","data-tooltip":this.locale.userFilterLocale.filter}),f=n.buildTag("div.bbi-dbrd-uf-list-icon-refresh bbi-dbrd-icon-background-theme bbi-dbrd-designer-hand-cursor bbi-dbrd-designer-hoverable","",{},{id:this.id+"_refresh","data-name":t?"refreshData":"refreshUserList","data-tooltip":this.locale.userFilterLocale.refresh});i.append(f,u);t||i.append(r)},t.prototype.templateIconTriggered=function(t){if(!n.isNullOrUndefined(t)){var i=this.bbdesigner$(t.target).attr("data-name");switch(i){case"userGroupMapping":case"viewUserList":case"viewFieldData":this.openMenuPopup(t,i)}}},t.prototype.openMenuPopup=function(n,t){var i;if(this.menuId=this.populateMenuItems(t),i=this.bbdesigner$("#"+this.menuId),i.is("visible"))i.hide();else{var u=i.data("BoldBIDashboardMenu"),r=t==="userGroupMapping"?this.id+"_usermapping":t==="viewUserList"?this.id+"_view_Data":this.id+"_view_userlist",f=this.bbdesigner$(n.target).offset().left<i.width()?this.bbdesigner$(n.target).offset().left:this.bbdesigner$(n.target).offset().left+this.iconContainer.find("#"+r).width()-i.width();u.show(f,this.bbdesigner$(n.target).offset().top+this.iconContainer.find("#"+r).outerHeight(!0),this.iconContainer.find("#"+r),n)}t==="userGroupMapping"&&this.updateAutoMappingMenu(i)},t.prototype.populateMenuItems=function(t){var e=this.getMenuItems(t),r,i,u,f;return this.menuId=t==="userGroupMapping"?this.id+"_usermapping_ConfigMenu":t==="viewUserList"?this.id+"_view_userlist_ConfigMenu":this.id+"_view_data_ConfigMenu",r=this.bbdesigner$("#"+this.menuId),r.length===0&&(i=n.buildTag("ul.bbi-designer-menu","",{},{id:this.menuId}),t==="userGroupMapping"&&(u=n.buildTag("p.bbi-dbrd-uf-usergroupmenu-title","User Mapping with",{},{}),i.append(u)),f=t==="userGroupMapping"?this.id+"_usermapping":t==="viewUserList"?this.id+"_view_Data":this.id+"_view_userlist",i.BoldBIDashboardMenu({menuType:n.MenuType.ContextMenu,openOnClick:!1,container:"#"+f,width:"160",fields:{dataSource:e,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},cssClass:"bbi-dbrd-userbased-filter-menu-list",click:this.bbdesigner$.proxy(this.triggeredMenuOptionForUserFilter,this)})),this.menuId},t.prototype.getMenuItems=function(n){var t=[];return n==="userGroupMapping"?t.push({id:"none",text:this.locale.userFilterLocale.noneText,parentId:null,sprite:"bbi-dbrd-userfilter-mapping-tickmark "},{id:"fullname",text:this.locale.userFilterLocale.fullNameText,parentId:null,sprite:"bbi-dbrd-usergroup-mapping-tickmark"},{id:"email",text:this.locale.userFilterLocale.emailText,parentId:null,sprite:"bbi-dbrd-userfilter-mapping-tickmark "},{id:"groupname",text:this.locale.userFilterLocale.groupNameText,parentId:null,sprite:"bbi-dbrd-usergroup-mapping-tickmark"}):n==="viewUserList"?t.push({id:"user_mapped",text:this.locale.userFilterLocale.all,parentId:null,sprite:"bbi-dbrd-usergroup-mapping-tickmark"},{id:"Mapped",text:this.locale.userFilterLocale.mapped,parentId:null,sprite:"bbi-dbrd-userfilter-mapping-tickmark "},{id:"Unmapped",text:this.locale.userFilterLocale.unMapped,parentId:null,sprite:"bbi-dbrd-userfilter-mapping-tickmark "}):n==="viewFieldData"&&t.push({id:"data_checked",text:this.locale.userFilterLocale.all,parentId:null,sprite:"bbi-dbrd-usergroup-mapping-tickmark"},{id:"Checked",text:this.locale.userFilterLocale.checked,parentId:null,sprite:"bbi-dbrd-userfilter-mapping-tickmark "},{id:"Unchecked",text:this.locale.userFilterLocale.unChecked,parentId:null,sprite:"bbi-dbrd-userfilter-mapping-tickmark "}),t},t.prototype.triggeredMenuOptionForUserFilter=function(n){var t=null;switch(n.ID){case"email":case"fullname":case"groupname":case"none":t={type:"autoMapping",text:n.text,data:n.ID};this.invokeCallBackHandler(t);break;case"data_checked":case"Checked":case"Unchecked":t={type:"filtering",data:n.ID};this.invokeCallBackHandler(t);break;case"user_mapped":case"Mapped":case"Unmapped":t={type:"userMapping",data:n.ID};this.invokeCallBackHandler(t)}this.switchCheckIcon(n.ID)},t.prototype.switchCheckIcon=function(n){this.bbdesigner$("#"+this.menuId).find("span").css("display","none");this.bbdesigner$("#"+this.menuId).find("#"+n).find("span").css("display","block")},t.prototype.updateCheckIconForMenu=function(n,t){this.bbdesigner$("#"+this.id+n).find("span").css("display","none");this.bbdesigner$("#"+this.id+n).find("#"+t).find("span").css("display","block")},t.prototype.wireEvents=function(){this.dashboardDesigner.element.on("click",".bbi-dbrd-uf-list-icon-container",this.bbdesigner$.proxy(this.templateIconTriggered,this))},t.prototype.unWireEvents=function(){this.dashboardDesigner.element.off("click",".bbi-dbrd-uf-list-icon-container",this.bbdesigner$.proxy(this.templateIconTriggered,this))},t}();t.UserFilterIconTemplate=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){var t;(function(t){var i=function(){function t(t,i,r,u,f){this.callBackInstance=null;this.callBackMethod=null;this.locale=null;this.callBackInstance=u;this.callBackMethod=f;this.dashboardDesigner=t;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=t.getLocalizationContent();this.id=(n.isNullOrUndefined(r.attr("id"))?this.dashboardDesigner._id:r.attr("id"))+"_user_filter_template";this.model=i;this.renderTemplateforUserFilter(r);this.unWireEvents();this.wireEvents()}return t.prototype.invokeCallBackHandler=function(t){n.isNullOrUndefined(this.callBackInstance)||n.isNullOrUndefined(this.callBackMethod)||n.DashboardUtil.invokeMethod(this.callBackInstance,this.callBackMethod,[t])},t.prototype.renderTemplateforUserFilter=function(t){var r=this.wrapper=n.buildTag("div","",{},{id:this.id+"_wrapper"}),u=n.buildTag("div.bbi-dbrd-uf-element-container","",{},{id:this.id+"_element_container"}),f=n.buildTag("div.bbi-dbrd-uf-filter-container","",{},{id:this.id+"_element_filter_container"}),s=n.buildTag("span.bbi-dbrd-uf-filter-name",this.locale.userFilterLocale.filterName,{},{id:this.id+"_filter_container_filter_name"}),h=this.filterInput=n.buildTag("input.bbi-dbrd-uf-filter-input e-textbox","",{},{id:this.id+"_filter_container_filter_input"}),e=n.buildTag("div.bbi-dbrd-uf-datacolumn-container","",{},{id:this.id+"_element_data_column_container"}),c=n.buildTag("span.bbi-dbrd-uf-datacolumn-name",this.locale.userFilterLocale.dataColumnName,{},{id:this.id+"_filter_container_datacolumn_name"}),i=n.buildTag("div.bbi-dbrd-uf-input-container","",{},{id:this.id+"_filter_input_container"}),o;this.dataColumnInput=n.buildTag("input.e-dbrd-uf-datacolumn-input","",{},{id:this.id+"_filter_container_datacolumn_input"});f.append(s,h);e.append(c,i);u.append(f,e);r.append(u);t.append(r);this.model.isHierarchical?(o={fields:{id:"ColumnId",parentId:"ParentId",hasChild:"HasChild",dataSource:this.model.fields,text:"Name"},callBackInstance:this,callBackMethod:"onFieldSelect",popupHeight:"200%",width:"100%",height:"24px",optionalArgs:this,cssClass:"bbi-dbrd-uf-template"},this.drpdwnObj=new n.DashboardDesignerUtility.DropdownTreeview(this.dashboardDesigner,o,i).dropDownObj):(i.append(this.dataColumnInput),this.drpdwnObj=this.dataColumnInput.BoldBIDashboardDropDownList({popupHeight:"200px",width:"100%",height:"100%",minPopupHeight:"150px",cssClass:"bbi-dbrd-uf-template bbi-dbrd-control e-combobox-control",change:this.bbdesigner$.proxy(this.onFieldSelect,this),dataSource:this.model.fields,fields:{text:"Name"},selectedIndex:-1}).data("BoldBIDashboardDropDownList"));this.filterInput.val(this.model.filterName)},t.prototype.updateUIForFilterClick=function(t){var i=null,r,f,u;n.isNullOrUndefined(t.ColumnId)||(i=n.isNullOrUndefined(this.model.fields[0].ID)?this.model.fields.find(function(n){return n.ColumnId===t.ColumnId}):this.model.fields.find(function(n){return n.ID===t.ColumnId}));this.updatePreviousValue(i);this.filterInput.val(t.Name);r=n.isNullOrUndefined(t.ColumnId)?-1:n.isNullOrUndefined(this.model.fields[0].ID)?this.model.fields.findIndex(function(n){return n.ColumnId===t.ColumnId}):this.model.fields.findIndex(function(n){return n.ID===t.ColumnId});f=this.drpdwnObj.model.selectedIndex;f!==r&&(this.model.isHierarchical&&!n.isNullOrUndefined(i)?(u=this.dashboardDesigner.element.find("#"+this.id+"_filter_input_container").data("DesignerPropertyWidget"),n.isNullOrUndefined(u)||u.selectItem(i.ColumnId)):this.drpdwnObj.selectItemByIndex(r),r===-1||n.isNullOrUndefined(i)||this.updateSelectionInfo("onUIupdation"))},t.prototype.getFieldName=function(t){return n.isNullOrUndefined(this.model.fields[0].ID)?this.model.fields.find(function(n){return n.ColumnId===t}).Name:this.model.fields.find(function(n){return n.ID===t}).Name},t.prototype.updatePreviousValue=function(t){this.previousSelectedValue=n.isNullOrUndefined(t)?null:{name:t.Name,id:this.model.isHierarchical?t.ColumnId:t.ID}},t.prototype.unWireEvents=function(){this.filterInput.off("focusout",this.bbdesigner$.proxy(this.onFocusOutName,this))},t.prototype.onOkBtnClick=function(n){n?(this.updateSelectionInfo(),this.previousSelectedValue={name:this.drpdwnObj.model.text,id:this.drpdwnObj.model.value}):this.updateDropDownSelection(this.previousSelectedValue)},t.prototype.updateDropDownSelection=function(t){if(this.model.isHierarchical){var i=this.dashboardDesigner.element.find("#"+this.id+"_filter_input_container").data("DesignerPropertyWidget");n.isNullOrUndefined(i)||i.selectItem(t.id)}else this.dataColumnInput.BoldBIDashboardDropDownList("selectItemByText",t.name)},t.prototype.updateSelectionInfo=function(t){var i,r,u,f;this.model.isHierarchical?(r=this.dashboardDesigner.element.find("#"+this.id+"_filter_input_container").data("DesignerPropertyWidget"),n.isNullOrUndefined(r)||(u=r.getSelection(),i={Name:u.name,ID:u.value})):i=this.drpdwnObj.model.dataSource[this.drpdwnObj.model.selectedIndex];f={type:n.isNullOrUndefined(t)?"onItemSelection":t,data:{fieldInfo:i,selectedInfo:i.Name}};this.invokeCallBackHandler(f)},t.prototype.wireEvents=function(){this.filterInput.on("focusout",this.bbdesigner$.proxy(this.onFocusOutName,this))},t.prototype.onFocusOutName=function(){var n={type:"filterNameUpdate",data:{name:this.filterInput.val()}};this.invokeCallBackHandler(n)},t.prototype.onFieldSelect=function(t){(this.model.isHierarchical||t.isInteraction)&&(n.isNullOrUndefined(this.previousSelectedValue)||n.isNullOrUndefined(this.previousSelectedValue.name)||n.isNullOrUndefined(this.previousSelectedValue.id)?(this.updateSelectionInfo(),this.previousSelectedValue={name:this.drpdwnObj.model.text,id:this.drpdwnObj.model.value}):this.createAlertDialog())},t.prototype.createAlertDialog=function(){this.dashboardDesigner.modules.util.alertDialog(this.locale.userFilterLocale.alertDialogTitle,this.locale.userFilterLocale.alertDialogAlertMsg,IconType.question,AlertType.Confirm,!1,"",{instance:this,method:"onOkBtnClick"})},t}();t.UserFilterTemplateUi=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){var t;(function(t){var i=function(){function t(t,i,r,u){this.wrapper=null;this.ulTag=null;this.isMappingFirst=!0;this.fullDataSource=[];this.getCheckedData=[];this.listFieldName="Name";this.listFieldEmailId="Email";this.checkedListData="text";this.searchUserList=[];this.searchGroupList=[];this.userDataSource=[];this.groupDataSource=[];this.isCheckedFirstTime=!0;this.isUnCheckedFirstTime=!0;this.dataSourceForMapping=[];this.currentUser=[];this.userInfoList=[];this.callBackInstance=null;this.callBackMethod=null;this.mappedDataSource=[];this.searchText="";this.isFilered=!1;this.sortedDatasource=[];this.searchedText=[];this.locale=null;this.callBackInstance=r;this.callBackMethod=u;this.dashboardDesigner=t;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=t.getLocalizationContent();this.usersInGroupInst=new n.Dashboard.UsersInGroup(this.dashboardDesigner);this.virtualScrolling=new VirtualScrollSettings;this.renderListBox(i);this.unWireEvents();this.wireEvents();this.initSortWorkerInstance();this.sortHelperEventListener();this.targetContainer.data("DesignerPropertyWidget",this)}return t.prototype.renderListBox=function(t){n.isNullOrUndefined(t)||(this.id=(n.isNullOrUndefined(t.attr("id"))?this.dashboardDesigner._id:t.attr("id"))+"_user_group_list",this.targetContainer=t,this.createListBox(this.targetContainer))},t.prototype.resetRequest=function(){n.isNullOrUndefined(this.requestObj)||this.requestObj.readyState===4||(this.requestObj.abort(),this.requestObj=null)},t.prototype.showAll=function(){n.isNullOrUndefined(this.userGroupListInstance)||(this.searchText="",this.isInputTextPresents=!1,this.sortOption=null,this.mapOption=null,this.setDataSource(this.fullDataSource))},t.prototype.getScriptPath=function(n){return window.URL.createObjectURL(new Blob([n.toString().match(/^\s*function\s*\(\s*\)\s*\{(([\s\S](?!\}$))*[\s\S])/)[1]],{type:"text/javascript"}))},t.prototype.createListBox=function(t){var i,r;this.wrapper=n.buildTag("div.bbi-dbrd-uf-user-group-list-wrapper","",{},{id:this.id+"_wrapper"});i=n.buildTag("div.bbi-dbrd-uf-container","",{},{id:this.id+"_container"});r=n.buildTag("div.bbi-dbrd-uf-listbox-wrapper","",{},{id:this.id+"_list_box_wrapper"});this.ulTag=n.buildTag("ul.bbi-dbrd-uf-listbox-element","",{},{id:this.id+"_list_box_element"});var u=n.buildTag("div.bbi-dbrd-uf-listbox-error-msg","<center><p><\/p><\/center>",{},{id:this.id+"_listbox_error_msg"}),f=n.buildTag("div.bbi-dbrd-uf-retry-icon-wrapper","",{},{id:this.id+"_retry_icon_wrapper"}),e=n.buildTag("button.bbi-dbrd-btn-primary bbi-dbrd-btn-small ",this.locale.browseDialogMessages.retryText,{height:"20px"},{id:this.id+"_retry_icon",type:"button"}),o=n.buildTag("div.bbi-dbrd-uf-nomatch-err-msg","<center><p><\/p><\/center >",{},{id:this.id+"_no_result_errmsg"});i.append(o,r);r.append(u,this.ulTag);u.append(f);f.append(e);this.wrapper.append(i);t.append(this.wrapper);this.userGroupListInstance=this.ulTag.BoldBIDashboardListBox({template:'<span class ="bbi-dbrd-uf-list" data-isgroup = ${IsGroup} data-group-id = ${Id} data-user-id = ${Email}><span id='+this.id+'_${Id}_clear_icon_${IsGroup} class="e-chck-icon"><\/span><span class="bbi-dbrd-uf-user-group-icon e-dashboarddesigner-icon-${IsGroup}"><\/span><span class="bbi-dbrd-uf-list-text bbi-uf-list-username bbi-dbrd-designer-hoverable" id='+this.id+'_${Id} isGroup = ${IsGroup} data-tooltip = "${Name}" >${Name}<\/span><span class="bbi-dbrd-uf-icon-wrapper"><span class="bbi-dbsize e-dbrd-file-icon bbi-dbrd-uf-float"  id ='+this.id+'_${Id}_menu><\/span><\/span><\/span><span class="bbi-dbrd-uf-list-text e-dashboarddesigner-email-${IsGroup} bbi-dbrd-designer-hoverable" id= '+this.id+'_${Id} data-isgroup= ${IsGroup} data-tooltip = "${Email}" >${Email}<\/span><span class="bbi-dbrd-uf-list-text e-dashboarddesigner-usercount-${IsGroup}" id= '+this.id+"_${Id} data-isgroup= ${IsGroup} >User Count: ${UserCount}<\/span>",showCheckbox:!1,width:"258px",height:"283px",select:this.bbdesigner$.proxy(this.updateUserOnSelect,this)}).data("BoldBIDashboardListBox");this.loaderInstance=this.wrapper.BoldBIDashboardWaitingPopup({showOnInit:!1,showImage:!0,cssClass:"e-designer-waitingpopup bbi-designer-loader",template:this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_designer_waiting_loader")}).data("BoldBIDashboardWaitingPopup")},t.prototype.search=function(t){var i,r;this.fullDataSource.length>0&&(this.searchText=t,this.isMappingFirst=!1,t.length>0?(this.isInputTextPresents=!0,i=this.filterItems(this.fullDataSource,t.toLowerCase()),i.length===0?this.showNoMatchError():n.isNullOrUndefined(this.sortOption)?(n.isNullOrUndefined(this.mapOption)||this.mapping(this.mapOption),this.showListBoxDiv(),r=this.ulTag.data("BoldBIDashboardListBox").model.dataSource,i=this.updateIndices(i,r),i.length===0?this.showNoMatchError():(this.ulTag.BoldBIDashboardListBox("hideAllItems"),this.ulTag.BoldBIDashboardListBox("showItemsByIndices",i),this.ulTag.BoldBIDashboardListBox("selectItemByIndex",i[0]),this.updateUserSelectionOnFilter())):this.sort(this.sortOption,this.userInfoList)):(this.isInputTextPresents=!1,n.isNullOrUndefined(this.sortOption)?n.isNullOrUndefined(this.mapOption)?(this.userGroupListInstance.showAllItems(),this.showListBoxDiv(),this.ulTag.BoldBIDashboardListBox("selectItemByIndex",0)):(this.dataSourceForMapping=this.fullDataSource,this.mapping(this.mapOption)):this.sort(this.sortOption,this.userInfoList),this.updateUserSelectionOnFilter()))},t.prototype.updateIndices=function(t,i){var f,r,u;if(n.isNullOrUndefined(this.mapOption))return t;for(f=[],r=0;r<t.length;r++)for(u=0;u<this.mappedDataSource.length;u++)i[t[r]].Name===this.mappedDataSource[u]&&f.push(t[r]);return f},t.prototype.updateUserOnSelect=function(t){t.isInteraction&&!n.isNullOrUndefined(t.event)&&this.updateSelectedValuesForUser((t.data.IsGroup?t.data.Id:t.data.Email).toString(),n.isNullOrUndefined(t.data.IsGroup)?!1:t.data.IsGroup)},t.prototype.invokeCallBackHandler=function(t){n.isNullOrUndefined(this.callBackInstance)||n.isNullOrUndefined(this.callBackMethod)||n.DashboardUtil.invokeMethod(this.callBackInstance,this.callBackMethod,[t])},t.prototype.updateUserSelectionOnFilter=function(){var n=this.ulTag.find(".e-select").find(".bbi-dbrd-uf-list"),t=n.attr("data-isgroup")==="true"?!0:!1,i=t?n.attr("data-group-id"):n.attr("data-user-id");this.updateSelectedValuesForUser(i,t)},t.prototype.updateSelectedFieldValuesForUser=function(n){this.addUserSelection();var t=this.userInfoList.indexOf(n);n.SelectedValues.length===1&&t===-1&&this.userInfoList.push(n)},t.prototype.addUserSelection=function(){this.ulTag.find(".e-select").find(".e-chck-icon").addClass("e-check-user").css("visibility","visible")},t.prototype.updateTheSelectedGroupValues=function(n){var t,i;if(n.length===0){this.ulTag.find(".e-select").removeClass("e-select");this.userInfoList=[];return}for(this.userInfoList=n,t=0;t<n.length;t++)i=this.ulTag.find(".bbi-dbrd-uf-list"),this.updateUserSelection(i,n[0])},t.prototype.updateUserSelection=function(n,t){if(n.length>=1)for(var i=0;i<n.length;i++)t.IsGroup?this.bbdesigner$(n[i]).attr("data-isgroup")===t.IsGroup.toString()&&this.bbdesigner$(n[i]).attr("data-group-id")===t.UserId.toString()&&this.bbdesigner$(n[i]).find(".e-chck-icon").addClass("e-check-user").css("visibility","visible"):this.bbdesigner$(n[i]).attr("data-isgroup")===t.IsGroup.toString()&&this.bbdesigner$(n[i]).attr("data-user-id")===t.UserId.toString()&&this.bbdesigner$(n[i]).find(".e-chck-icon").addClass("e-check-user").css("visibility","visible")},t.prototype.updateUsers=function(n){this.userInfoList=n},t.prototype.clearUserSelection=function(){this.clearAllSelectedUser()},t.prototype.clearCurrentUserSelection=function(){this.ulTag.find(".e-select").find(".e-check-user").removeClass("e-check-user").css("visibility","hidden")},t.prototype.clearAllSelectedUser=function(){for(var t=this.ulTag.find(".bbi-dbrd-uf-list").find(".e-check-user"),n=0;n<t.length;n++)this.bbdesigner$(t[n]).css("visibility","hidden"),this.bbdesigner$(t[n]).removeClass("e-check-user")},t.prototype.addAllSelectedUser=function(n){this.userInfoList=n;for(var t=0;t<n.length;t++)this.updateUserSelection(this.ulTag.find(".bbi-dbrd-uf-list"),n[t])},t.prototype.updateSelectedValuesForUser=function(n,t){var i=new UserInfo,r,u;i.IsGroup=t;i.UserId=n;r=this.userInfoList.filter(function(n){return n.UserId===i.UserId});r.length!==0&&(i.IncludeFutureValues=r[0].IncludeFutureValues);u={type:"selected",data:i};this.invokeCallBackHandler(u)},t.prototype.getFirstSelectedUser=function(){this.ulTag.BoldBIDashboardListBox("selectItemByIndex",0);var t=new UserInfo;return!n.isNullOrUndefined(this.fullDataSource)&&this.fullDataSource.length>0&&(t.IsGroup=this.fullDataSource[0].IsGroup,t.UserId=(this.fullDataSource[0].IsGroup?this.fullDataSource[0].Id:this.fullDataSource[0].Email).toString()),t},t.prototype.getUpdatedCheckBoxItems=function(){var t,n;if(this.isCheckedFirstTime)this.updatedCheckedItems=this.getCheckedData,this.isCheckedFirstTime=!1;else for(this.updatedCheckedItems=this.updatedCheckedItems.concat(this.getCheckedData),this.getUniqueCheckedArray(),t=0;t<this.updatedUnCheckedItems.length;t++)for(n=this.updatedCheckedItems.length-1;n>=0;n--)this.updatedUnCheckedItems[t][this.listFieldName]===this.updatedCheckedItems[n][this.checkedListData]&&this.updatedCheckedItems.splice(n,1)},t.prototype.getUniqueCheckedArray=function(){var n=this,t=[];t=this.updatedCheckedItems.filter(function(t,i,r){return r.map(function(t){return t[n.checkedListData]}).indexOf(t[n.checkedListData])===i});this.updatedCheckedItems=t},t.prototype.getUpdatedUnCheckBoxItems=function(n){var i,t;if(this.isUnCheckedFirstTime)this.updatedUnCheckedItems=[],this.getUnCheckedArray(n),this.isUnCheckedFirstTime=!1;else for(this.getUnCheckedArray(n),this.getUniqueUnCheckedArray(),i=0;i<this.getCheckedData.length;i++)for(t=this.updatedUnCheckedItems.length-1;t>=0;t--)this.getCheckedData[i][this.checkedListData]===this.updatedUnCheckedItems[t][this.listFieldName]&&this.updatedUnCheckedItems.splice(t,1)},t.prototype.getUnCheckedArray=function(n){for(var i,r=1,t=0;t<n.length;t++)for(r=0,i=0;i<this.getCheckedData.length;i++)this.getCheckedData[i][this.checkedListData]!==n[t][this.listFieldName]&&(r++,r===this.getCheckedData.length&&this.updatedUnCheckedItems.push(n[t]))},t.prototype.getUniqueUnCheckedArray=function(){var n=this,t=[];t=this.updatedUnCheckedItems.filter(function(t,i,r){return r.map(function(t){return t[n.listFieldName]}).indexOf(t[n.listFieldName])===i});this.updatedUnCheckedItems=t},t.prototype.showListBoxDiv=function(){this.wrapper.find("#"+this.id+"_no_result_errmsg").hide();this.wrapper.find("#"+this.id+"_list_box_wrapper").show()},t.prototype.showNoMatchError=function(){this.wrapper.find("#"+this.id+"_no_result_errmsg p").html(this.locale.userFilterLocale.noResultsFound);this.wrapper.find("#"+this.id+"_list_box_wrapper").hide();this.wrapper.find("#"+this.id+"_no_result_errmsg").show();this.invokeCallBackHandler({type:"onUserListError"})},t.prototype.filterItems=function(t,i){var o=[],u,f,r,s,e;for(this.searchedText=[],u=[],f=[],r=0;r<t.length;r++)s=t[r][this.listFieldName].toLowerCase(),e=t[r][this.listFieldEmailId],n.isNullOrUndefined(e)||e===""?(i===""||s.startsWith(i))&&(o.push(r),f.push(t[r]),this.searchedText.push(t[r][this.listFieldName])):(i===""||s.startsWith(i)||e.startsWith(i))&&(o.push(r),u.push(t[r]),this.searchedText.push(t[r][this.listFieldName]));return this.dataSourceForMapping=u.concat(f),this.searchGroupList=f,this.searchUserList=u,o},t.prototype.showLoadingIndicator=function(){this.loaderInstance.show()},t.prototype.hideLoadingIndicator=function(){this.loaderInstance.hide()},t.prototype.wireEvents=function(){this.wrapper.on("click","#"+this.id+"_retry_icon",this.bbdesigner$.proxy(this.retry,this));this.wrapper.on("click",".bbi-dbrd-uf-icon-wrapper",this.bbdesigner$.proxy(this.showMoreMenu,this))},t.prototype.unWireEvents=function(){this.wrapper.off("click","#"+this.id+"_retry_icon",this.bbdesigner$.proxy(this.retry,this));this.wrapper.off("click",".bbi-dbrd-uf-icon-wrapper",this.bbdesigner$.proxy(this.showMoreMenu,this))},t.prototype.retry=function(){this.wrapper.find("#"+this.id+"_listbox_error_msg p").empty();this.wrapper.find("#"+this.id+"_retry_icon_wrapper").hide();this.fetchUserGroupList(undefined,!0)},t.prototype.clearSelectedUserFilter=function(){this.invokeCallBackHandler({type:"clearActiveFilterUserInfo"})},t.prototype.checkSelectedValuesForUser=function(){this.invokeCallBackHandler({type:"checkSelectedValues"})},t.prototype.setIsfilteredProperty=function(n){this.isFilered=n},t.prototype.onUserGroupListFetchSuccess=function(t,i){if(i.Status)if(n.isNullOrUndefined(i.Data)||i.Data.length===0)this.showErroMsg(this.locale.userFilterLocale.noUsersAndGroupError);else{this.virtualScrolling.PageSize=100;var r=JSON.parse(i.Data);this.userDataSource=r.Users;this.userDataSource.length===0&&this.showErroMsg(this.locale.userFilterLocale.noUsersError);this.groupDataSource=r.Groups;this.fullDataSource=this.userDataSource.concat(this.groupDataSource);this.updateUiOnFieldList();this.setModel(this.fullDataSource);this.triggerRenderComplete();t&&(this.mapping(this.mapOption),this.updateSearch())}else this.showErroMsg(i.Message)},t.prototype.updateUiOnFieldList=function(){this.invokeCallBackHandler({type:"updateUiFieldList",data:{data:!0}})},t.prototype.showErroMsg=function(n){this.invokeCallBackHandler({type:"updateUiFieldList",data:{data:!1}});this.wrapper.find("#"+this.id+"_list_box_element_container").hide();this.wrapper.find("#"+this.id+"_listbox_error_msg").css("display","block");this.wrapper.find("#"+this.id+"_listbox_error_msg p").html(n);this.wrapper.find("#"+this.id+"_retry_icon_wrapper").show()},t.prototype.triggerRenderComplete=function(){var n=new UserInfo,t;n.IsGroup=this.fullDataSource[0].IsGroup;n.UserId=(this.fullDataSource[0].IsGroup?this.fullDataSource[0].Id:this.fullDataSource[0].Email).toString();t=this.userInfoList.filter(function(t){return t.UserId===n.UserId});t.length!==0&&(n.IncludeFutureValues=t[0].IncludeFutureValues);this.invokeRenderComplete(n);this.addAllSelectedUser(this.userInfoList)},t.prototype.invokeRenderComplete=function(n){var t={type:"renderComplete",data:{userinfo:n,isGroup:n.IsGroup,userId:n.UserId,dataSource:this.fullDataSource}};this.invokeCallBackHandler(t)},t.prototype.onUserGroupListFetchError=function(t){t.status===401?this.showErroMsg(this.locale.errorMessage.authenticationFailed+this.locale.errorMessage.invalidSession):n.isNullOrUndefined(t.responseText)||t.responseText===""?this.showErroMsg(this.locale.errorMessage.errorOnLoadingAccountInfo):this.showErroMsg(t.responseText)},t.prototype.updateUserMapping=function(n,t){switch(n){case"user_mapped":this.mapOption=Mapping.All;this.updatedCheckedItems=this.getRequiredItems(t,!0);break;case"Mapped":this.mapOption=Mapping.Map;this.updatedCheckedItems=this.getRequiredItems(t,!1);break;case"Unmapped":this.mapOption=Mapping.Unmap;this.updatedCheckedItems=this.getRequiredItems(t,!1)}this.mapping(this.mapOption);this.updateSearch()},t.prototype.updateSearch=function(){var t=this.ulTag.data("BoldBIDashboardListBox").model.dataSource,n;this.searchText.length>0&&(n=this.filterItems(t,this.searchText.toLocaleLowerCase()),n=this.updateIndices(n,t),n.length===0?this.showNoMatchError():(this.userGroupListInstance.hideAllItems(),this.ulTag.BoldBIDashboardListBox("showItemsByIndices",n)))},t.prototype.getRequiredItems=function(t,i){var f=[],e,r,u;if(i)f=this.filterNameList(this.fullDataSource);else for(e=function(i){var u="";u=r.fullDataSource.filter(function(n){return n.Id.toString()===t[i].UserId.toString()&&n.IsGroup===t[i].IsGroup}).length>0?r.fullDataSource.filter(function(n){return n.Id.toString()===t[i].UserId.toString()&&n.IsGroup===t[i].IsGroup})[0].Name:r.fullDataSource.filter(function(r){return!n.isNullOrUndefined(r.Email)&&r.Email.toString()===t[i].UserId.toString()&&r.IsGroup===t[i].IsGroup})[0].Name;f.push({text:u})},r=this,u=0;u<t.length;u++)e(u);return f},t.prototype.filterNameList=function(n){for(var i=[],t=0;t<n.length;t++)i.push({text:n[t].Name});return i},t.prototype.showUserAndGroupList=function(){this.wrapper.find("#"+this.id+"_listbox_error_msg").hide();this.wrapper.find("#"+this.id+"_list_box_wrapper").show()},t.prototype.showMoreMenu=function(t){var r,c;t.stopPropagation();r=this.bbdesigner$(t.target);r.closest(".bbi-dbrd-uf-icon-wrapper").css("background-color","#dbe9ff");r.css({color:"#0565ff",visibility:"visible"});r.closest("li").css("background-color","#f0f6ff");r.closest("li").find(".e-chk-act,.e-chk-inact").css("background-color","#f0f6ff");this.checkSelectedValuesForUser();var o=r.offset(),f=r.closest(".bbi-dbrd-uf-list"),e=r.closest("li").find(".bbi-uf-list-username").text();this.getCurrentUser(e);var i=n.buildTag("ul.bbi-designer-menu e-aggr-menu","",{width:"160px"},{id:this.id+"_more_menu"}),l=this.wrapper.find(".e-content"),s=n.buildTag("li.e-separator","<a>"+this.locale.userFilterLocale.viewUsermsg+"<\/a>",{},{id:this.id+"_view_users_li"}),u=n.buildTag("li","<a>"+this.locale.userFilterLocale.clear+"<\/a>",{},{id:this.id+"_clear_list_li"}),h=f.attr("data-isgroup")==="true"?!0:!1;h?(i.append("<li class='e-separator'><a>"+this.locale.userFilterLocale.useFilterFrom+"<\/a><\/li>"),i.append(s),this.isFilered&&i.append(u),this.groupId=f.attr("data-group-id"),this.groupName=e):(i.append("<li class='e-separator'><a>"+this.locale.userFilterLocale.useFilterFrom+"<\/a><\/li>"),this.isFilered&&i.append(u));this.dashboardDesigner.columnDetails!=null&&(c=this.dashboardDesigner.columnDetails,c.fieldInfo.DataType==="Date"&&(i.append("<li class='e-separator' id='relative'><a>"+this.locale.userFilterLocale.RelativeDateFilter+"<\/a><\/li>"),h?(i.append(s),this.isFilered&&i.append(u),this.groupId=f.attr("data-group-id"),this.groupName=e):this.isFilered&&i.append(u)));this.wrapper.append(i);i.BoldBIDashboardMenu({menuType:n.MenuType.ContextMenu,openOnClick:!1,ontextMenuTarget:"#"+l.attr("id"),click:this.bbdesigner$.proxy(this.onMoreMenuClick,this)}).data("BoldBIDashboardMenu").show(o.left+9,o.top-2,r,{})},t.prototype.getCurrentUser=function(n){for(var t=0;this.fullDataSource.length;t++)if(this.fullDataSource[t][this.listFieldName]===n){this.currentUser=this.fullDataSource[t];break}},t.prototype.onMoreMenuClick=function(n){var t;n.ID===this.id+"_view_users_li"?this.usersInGroupInst.open(this.groupId,this.groupName):n.ID===this.id+"_clear_list_li"?this.clearSelectedUserFilter():n.ID==="relative"?(t={type:"RelativeDateFilter",dataSource:this.fullDataSource},this.invokeCallBackHandler(t)):(t={type:"useFilterFrom",datasource:this.fullDataSource},this.invokeCallBackHandler(t))},t.prototype.updateCheckedItemsFromDialog=function(){var n=this.ulTag.BoldBIDashboardListBox("getIndexByText",this.currentUser[this.listFieldName]);this.ulTag.BoldBIDashboardListBox("checkItemByIndex",n)},t.prototype.fetchUserGroupList=function(t,i){this.userInfoList=n.isNullOrUndefined(t)?this.userInfoList:t;this.virtualScrolling.PageSize=100;this.requestObj=this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+n.Dashboard.ServiceAPI.getUsersAndGroups,{action:n.DashboardUtil.DesignerAction.GetUsersAndGroups},{fnction:this.bbdesigner$.proxy(this.onUserGroupListFetchSuccess,this,i),indicator:[this.bbdesigner$.proxy(this.showLoadingIndicator,this),this.bbdesigner$.proxy(this.hideLoadingIndicator,this)],errfnction:this.bbdesigner$.proxy(this.onUserGroupListFetchError,this)},!0,!0)},t.prototype.setModel=function(n){this.userGroupListInstance.setModel({dataSource:[]});this.userGroupListInstance.setModel({dataSource:n,selectedIndex:0});this.showUserAndGroupList()},t.prototype.initSortWorkerInstance=function(){this.sortHelper=new Worker(this.getScriptPath(function(){self.addEventListener("message",function(n){var f=n.data.option,t=n.data.data,e=n.data.optionalArgs,i=n.data.type,r,u;if(t.length>0&&(u=t[0],r=u.hasOwnProperty(i)),r)switch(f){case"ascending":t.sort(function(n,t){var r=n[i].toLowerCase(),u=t[i].toLowerCase();return r<u?-1:r>u?1:0});break;case"descending":t.sort(function(n,t){var r=n[i].toLowerCase(),u=t[i].toLowerCase();return u<r?-1:u>r?1:0})}self.postMessage({data:t,optionalArgs:e},null)},!1)}))},t.prototype.sortByAscending=function(){this.setUserAndGroupList();this.getCheckedData=this.ulTag.BoldBIDashboardListBox("getCheckedItems");var n=SortType.Asc.toString();this.sortHelper.postMessage({option:n,data:this.userList,type:"Name",optionalArgs:"user"});this.sortHelper.postMessage({option:n,data:this.groupList,type:"Name",optionalArgs:"group"})},t.prototype.sortByDescending=function(){this.setUserAndGroupList();this.getCheckedData=this.ulTag.BoldBIDashboardListBox("getCheckedItems");var n=SortType.Desc.toString();this.sortHelper.postMessage({option:n,data:this.userList,type:"Name",optionalArgs:"user"});this.sortHelper.postMessage({option:n,data:this.groupList,type:"Name",optionalArgs:"group"})},t.prototype.sortHelperEventListener=function(){var n=this,r=[],u=[],t,i;this.sortHelper.addEventListener("message",function(f){if("user"===f.data.optionalArgs?(r=f.data.data,t=!0):(u=f.data.data,i=!0),t&&i){var e=[];e=r.concat(u);n.sortedDatasource=e;n.setDataSource(e);n.addAllSelectedUser(n.userInfoList);t=!1;i=!1}},!1)},t.prototype.reset=function(){!n.isNullOrUndefined(this.fullDataSource)&&this.fullDataSource.length>0?(this.userGroupListInstance.model.dataSource=[],this.updatedCheckedItems=[],this.updatedUnCheckedItems=[],this.isInputTextPresents=!1,this.isMappingFirst=!0,this.mapOption=null,this.sortOption=null,this.dataSourceForMapping=[],this.userInfoList=[],this.setModel(this.fullDataSource)):this.wrapper.find("#"+this.id+"_listbox_error_msg").css("display","block")},t.prototype.setUserAndGroupList=function(){this.isInputTextPresents?(this.userList=this.searchUserList,this.groupList=this.searchGroupList):(this.userList=this.userDataSource,this.groupList=this.groupDataSource)},t.prototype.setDataSource=function(t){this.setModel(t);this.showListBoxDiv();this.updateUserSelectionOnFilter();n.isNullOrUndefined(this.mapOption)||this.mapping(this.mapOption)},t.prototype.sort=function(n,t){if(this.fullDataSource.length>0){this.userInfoList=t;this.isMappingFirst=!1;this.sortOption=n;switch(n){case SortType.Asc:this.sortByAscending();break;case SortType.Desc:this.sortByDescending()}}},t.prototype.reload=function(n){this.userInfoList=n;this.userGroupListInstance.model.dataSource=[];this.isInputTextPresents=!1;this.setModel(this.dataSourceForMapping);this.sortOption=null;this.fetchUserGroupList(n,!0)},t.prototype.mapping=function(n){if(this.fullDataSource.length>0){this.mapOption=n;switch(n){case Mapping.Map:this.showMappedItems();break;case Mapping.Unmap:this.showUnMappedItems();break;case Mapping.All:this.showMappedItems()}}},t.prototype.getAllNames=function(n){this.mappedDataSource=[];for(var t=0;t<n.length;t++)this.fullDataSource[n[t]]&&this.mappedDataSource.push(this.fullDataSource[n[t]].Name)},t.prototype.showMappedItems=function(){for(var n,u=this.fullDataSource,i=this.updatedCheckedItems,t=[],r=0;r<u.length;r++)for(n=0;n<i.length;n++)u[r][this.listFieldName]===i[n][this.checkedListData]&&t.push(i[n][this.checkedListData]);t.length>0?(this.userGroupListInstance.hideAllItems(),this.userGroupListInstance.showItemsByValues(t),this.mappedDataSource=t,this.showListBoxDiv(),this.selectionOnMapping()):this.showNoMatchError()},t.prototype.getSearchIndexForSelection=function(){for(var t,i=this.ulTag.data("BoldBIDashboardListBox").model.dataSource,r=[],n=0;n<i.length;n++)for(t=0;t<this.mappedDataSource.length;t++)i[n].Name===this.mappedDataSource[t]&&r.push(i[n]);return this.getIndexForSelection(r,this.searchedText)},t.prototype.getIndexForSelection=function(n,t){for(var r,u=[],i=0;i<n.length;i++)for(r=0;r<t.length;r++)n[i].Name===t[r]&&u.push(this.ulTag.BoldBIDashboardListBox("getIndexByText",n[i].Name));return u[0]},t.prototype.selectionOnMapping=function(){var t;this.searchText.length===0?n.isNullOrUndefined(this.sortOption)?(t=this.ulTag.BoldBIDashboardListBox("getIndexByText",this.mappedDataSource[0]),this.userGroupListInstance.selectItemByIndex(t)):(t=this.getIndexForSelection(this.sortedDatasource,this.mappedDataSource),this.userGroupListInstance.selectItemByIndex(t)):(t=this.getSearchIndexForSelection(),this.userGroupListInstance.selectItemByIndex(t));n.isNullOrUndefined(t)?this.showNoMatchError():this.updateUserSelectionOnFilter()},t.prototype.showUnMappedItems=function(){for(var u,i=this.fullDataSource,r=this.updatedCheckedItems,n=[],f=1,t=0;t<i.length;t++)if(f=0,r.length>0)for(u=0;u<r.length;u++)r[u][this.checkedListData]!==i[t][this.listFieldName]&&(f++,f===r.length&&n.push(i[t][this.listFieldName]));else n.push(i[t][this.listFieldName]);n.length>0?(this.userGroupListInstance.hideAllItems(),this.userGroupListInstance.showItemsByValues(n),this.mappedDataSource=n,this.showListBoxDiv(),this.selectionOnMapping()):this.showNoMatchError()},t.prototype.disable=function(){this.userGroupListInstance.disable()},t.prototype.enable=function(){this.userGroupListInstance.enable()},t}();t.UsersAndGroupsListView=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){n.Map="map";n.Unmap="unmap";n.All="all"}(Mapping||(Mapping={})),function(n){var t;(function(t){var i=function(){function t(t,i){this.updateDatasouce=[];this.isManualChange=!1;this.locale=null;this.dashboardDesigner=t;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=t.getLocalizationContent();this.id=(n.isNullOrUndefined(i.attr("id"))?this.dashboardDesigner._id:i.attr("id"))+"_uf_user_preview_dashbrd";this.renderPreviewContainer(i);this.fetchUserList();this.unwiredEvents();this.wiredEvents()}return t.prototype.renderPreviewContainer=function(t){var i,e;this.wrapper=n.buildTag("div","",{position:"relative"},{id:this.id+"_wrapper"});var r=n.buildTag("div.bbi-dbrd-preview-content-container","",{},{id:this.id+"_content_container"}),o=n.buildTag("div.bbi-dbrd-uf-preview-label",this.locale.userFilterLocale.previewAsText),u=n.buildTag("div.bbi-dbrd-input-container","",{},{id:this.id+"_input_container"}),f=n.buildTag("div.bbi-dbrd-dropdowndiv","",{},{});this.inputDropdown=n.buildTag("input.e-dbrd-input-dropdown","",{},{id:this.id+"_input_dropdown"});i=n.buildTag("div.bbi-dbrd-uf-preview-reload-container bbi-dbrd-designer-hoverable","",{},{"data-tooltip":this.locale.userFilterLocale.relaodPreviewUserGroupText,id:this.id+"_reload_icon"});e=n.buildTag("span.e-dbrd-banner-user-refresh bbi-dbrd-designer-hand-cursor bbi-dbrd-icon-background-theme");this.loader=n.buildTag("div.bbi-dbrd-file-info-progress","",{"line-height":"90%",display:"none"},{});e.appendTo(i);f.append(this.inputDropdown);u.append(f);r.append(o,u,i);this.wrapper.append(r,this.loader);t.append(this.wrapper);this.inputDropdown.BoldBIDashboardDropDownList({template:'<span class="bbi-dbrd-uf-user-group-icon e-dashboarddesigner-icon-${IsGroup}"><\/span><span class="bbi-dbrd-uf-list-text" id='+this.id+"_${Id} isGroup = ${IsGroup} >${Name}<\/span>",watermarkText:this.locale.userFilterLocale.selectUserGroupText,height:"28px",width:"165px",popupHeight:"250px",popupWidth:"165px",cssClass:"bbi-dbrd-control e-combobox-control bbi-dbrd-uf-previewui",change:this.bbdesigner$.proxy(this.onSelectChange,this)})},t.prototype.onSelectChange=function(t){if(n.isNullOrUndefined(t)||this.isManualChange)this.isManualChange=!1;else{var i=this.updateDatasouce[t.itemId];n.isNullOrUndefined(i)||(this.dashboardDesigner.impersonateAccount=new ImpersonateAccount,this.dashboardDesigner.impersonateAccount.Name=i.Name,n.isNullOrUndefined(i.Email)?n.isNullOrUndefined(this.dashboardDesigner.impersonateAccount.IsGroup)||(this.dashboardDesigner.impersonateAccount.IsGroup=!0):this.dashboardDesigner.impersonateAccount.Email=i.Email,this.dashboardDesigner.impersonateAccount.UserId=i.Id,this.dashboardDesigner.updateDashboard())}},t.prototype.wiredEvents=function(){this.wrapper.on("click","#"+this.id+"_reload_icon",this.bbdesigner$.proxy(this.fetchUserList,this))},t.prototype.unwiredEvents=function(){this.wrapper.off("click","#"+this.id+"_reload_icon",this.bbdesigner$.proxy(this.fetchUserList,this))},t.prototype.fetchUserList=function(){this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+n.Dashboard.ServiceAPI.getUsersAndGroups,{action:n.DashboardUtil.DesignerAction.GetUsersAndGroups},{fnction:this.bbdesigner$.proxy(this.onFetchUserListSuccess,this),indicator:[this.bbdesigner$.proxy(this.showLoader,this),this.bbdesigner$.proxy(this.hideLoader,this)]},!0,!0)},t.prototype.showLoader=function(){this.loader.show()},t.prototype.hideLoader=function(){this.loader.hide()},t.prototype.onFetchUserListSuccess=function(t){var u,i,r;n.isNullOrUndefined(t.Data)||(u=JSON.parse(t.Data),this.updateDatasouce=u.Users.concat(u.Groups),i=this.inputDropdown.data("BoldBIDashboardDropDownList"),n.isNullOrUndefined(i)||(r=i.getSelectedValue(),i.option("dataSource",this.updateDatasouce),n.isNullOrUndefined(r)||r===""||(this.isManualChange=!0,i.selectItemByValue(r))))},t.prototype.reset=function(){var n=this.wrapper.find("#"+this.id+"_input_dropdown").data("BoldBIDashboardDropDownList");n&&n.clearText()},t}();t.UserSelectionPreviewMode=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){var t;(function(t){var i=function(){function t(n){this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.id=this.dashboardDesigner._id+"_filter_from_dialog";this.createDialog();this.unWireEvents();this.wireEvents()}return t.prototype.createDialog=function(){var r;this.wrapper=n.buildTag("div","",{},{id:this.id+"_wrapper"});var t=n.buildTag("div","",{},{id:this.id+"_content_container"}),i=n.buildTag("div","",{},{id:this.id+"_user_list"}),u=this.ulElement=n.buildTag("ul.bbi-dbrd-designer-unorder-list","",{},{id:this.id+"_user_list_ulelement"}),f=this.useSelected=n.buildTag("button.bbi-dbrd-designer-selected-btn bbi-dbrd-btn-primary e-dbrd-btn bbi-dbrd-btn-small",this.dashboardDesigner.getLocalizationContent().userFilterLocale.useSelectedText,{},{id:this.id+"_use_selected_btn",type:"button"}),e=n.buildTag("button.bbi-dbrd-designer-cancel-btn bbi-dbrd-btn-secondary e-dbrd-btn bbi-dbrd-btn-small bbi-dbrd-margin-left",this.dashboardDesigner.getLocalizationContent().dialogOptions.cancelButtonText,{},{id:this.id+"_cancel_btn",type:"button"}),o=n.buildTag("div .bbi-dbrd-designer-user-error-msg","<center><p><\/p><\/center>",{},{id:this.id+"_content_error_msg"});i.append(u);t.append(i,o);this.wrapper.append(t);this.dialogObj=this.wrapper.BoldBIDashboardDialog({width:"auto",height:"auto",minWidth:301,minHeight:193,enableResize:!1,enableModal:!0,showOnInit:!1,showFooter:!0,target:"#"+this.dashboardDesigner._id,title:this.dashboardDesigner.getLocalizationContent().userFilterLocale.useFilterFrom,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(n.DashboardUtil.closeDialog,this),closeIconTooltip:this.dashboardDesigner.getLocalizationContent().dialogOptions.closeButtonText}).data("BoldBIDashboardDialog");this.listBoxElementInst=this.ulElement.BoldBIDashboardListBox({template:'<span class=\'e-dbrd-uf-ug-tmplt\'><span class="bbi-dbrd-uf-icon e-dashboarddesigner-icon-${IsGroup}"><\/span><span class="e-list-text"><span class="e-word" user-id = ${Id}>${Name}<\/span><\/span><\/span>',showCheckbox:!0,width:"300px",height:"191px",cssClass:"bbi-dbrd-designer-userfilter",checkChange:this.bbdesigner$.proxy(this.buttonState,this),showRoundedCorner:!1}).data("BoldBIDashboardListBox");r=this.dashboardDesigner.element.find("#"+this.id+"_wrapper_foot");r.append(e,f)},t.prototype.wireEvents=function(){this.dashboardDesigner.element.on("click","#"+this.id+"_cancel_btn",this.bbdesigner$.proxy(this.closeDialog,this));this.dashboardDesigner.element.on("click","#"+this.id+"_use_selected_btn",this.bbdesigner$.proxy(this.sendCheckedItems,this));this.dashboardDesigner.element.on("click",".e-dbrd-uf-ug-tmplt",this.bbdesigner$.proxy(this.onListBoxTemplateClick,this))},t.prototype.onListBoxTemplateClick=function(n){this.bbdesigner$(n.currentTarget).parents("li").trigger("click")},t.prototype.unWireEvents=function(){this.dashboardDesigner.element.off("click","#"+this.id+"_cancel_btn",this.bbdesigner$.proxy(this.closeDialog,this));this.dashboardDesigner.element.off("click","#"+this.id+"_use_selected_btn",this.bbdesigner$.proxy(this.sendCheckedItems,this));this.dashboardDesigner.element.off("click",".e-dbrd-uf-ug-tmplt",this.bbdesigner$.proxy(this.onListBoxTemplateClick,this))},t.prototype.open=function(t,i){if(this.dialogModel=t,this.useSelected.prop("disabled","true"),this.dialogObj.open(),this.data=i,n.isNullOrUndefined(i.datasource)||i.datasource.length===0)this.wrapper.find("#"+this.id+"_user_list").hide(),this.wrapper.find("#"+this.id+"_content_error_msg").show(),this.wrapper.find("#"+this.id+"_content_error_msg p").html(this.dashboardDesigner.getLocalizationContent().userFilterLocale.useFilterFromErrMsg);else{this.showListBoxDiv();this.listBoxElementInst.setModel({dataSource:i.datasource});var r=this.ulElement.data("BoldBIDashboardListBox");r.uncheckAll();r.scrollerObj.refresh();this.buttonState()}},t.prototype.showListBoxDiv=function(){this.wrapper.find("#"+this.id+"_content_error_msg").hide();this.wrapper.find("#"+this.id+"_user_list").show()},t.prototype.closeDialog=function(){this.dialogObj.close();this.ulElement.BoldBIDashboardListBox("removeAll")},t.prototype.sendCheckedItems=function(){var t,i,r;if(!n.isNullOrUndefined(this.dialogModel.callBackInstance)&&!n.isNullOrUndefined(this.dialogModel.callBackMethod)&&this.dialogModel.callBackMethod!==""){try{t=this.ulElement.BoldBIDashboardListBox("getCheckedItems");i=this.getSelectedValues(t);n.isNullOrUndefined(t)||t.length===0||(r={selectedValues:i,arguments:this.dialogModel.optionalArgs},n.DashboardUtil.invokeMethod(this.dialogModel.callBackInstance,this.dialogModel.callBackMethod,[r]))}catch(u){this.dashboardDesigner.designerPanel.logError({Error:u})}this.closeDialog()}},t.prototype.getSelectedValues=function(t){for(var h,f,o,u,e,r,s=[],i=0;i<t.length;i++)h=this.ulElement.BoldBIDashboardListBox("getIndexByText",t[i].value),s.push(h);for(f=this.getDatasourceForSelectedValues(s),o=[],o=n.isNullOrUndefined(this.data.currentUserInfo)?[]:this.data.currentUserInfo.SelectedValues,u=this.data.userInfo,e=o,i=0;i<f.length;i++)for(r=0;r<u.length;r++)(u[r].IsGroup===f[i].IsGroup&&u[r].UserId===f[i].Id.toString()||u[r].IsGroup===f[i].IsGroup&&u[r].UserId===f[i].Email)&&(e=e.concat(u[r].SelectedValues));return this.getUniqueValues(e)},t.prototype.getUniqueValues=function(n){for(var i=[],t=0;t<n.length;t++)i.indexOf(n[t])===-1&&i.push(n[t]);return i},t.prototype.buttonState=function(){var t=this.ulElement.BoldBIDashboardListBox("getCheckedItems");n.isNullOrUndefined(t)||t.length===0?this.useSelected.prop("disabled","true"):this.useSelected.removeProp("disabled")},t.prototype.getDatasourceForSelectedValues=function(n){for(var t,r=[],i=0;i<n.length;i++)for(t=0;t<this.data.datasource.length;t++)n[i]===t&&r.push(this.data.datasource[t]);return r},t}();t.UserFilterFromDialog=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){var t;(function(t){var i=function(){function i(n,t){this.ejPreviewGrid=null;this.userBasedFilterInfo=new UserBasedFilterInfo;this.isInteraction=!1;this.prevMode=null;this.loader=null;this.locale=null;this.designerInst=n;this.bbdesigner$=this.designerInst.bbdesigner$;this.locale=n.getLocalizationContent();this.queryDesignerInst=t;this.id=this.designerInst._id+"_uf_parent_dlg";this.render();this.wireEvents()}return Object.defineProperty(i.prototype,"advModeInst",{get:function(){return n.isNullOrUndefined(this.advModeInstance)&&(this.advModeInstance=new t.UFAdvancedMode(this.designerInst,this.queryDesignerInst,this.wrapper.find("#"+this.id+"_advanced_mode"),this.bbdesigner$.proxy(this.onAdvancedModeEventChange,this))),this.advModeInstance},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"basicModeInst",{get:function(){return n.isNullOrUndefined(this.basicModeInstance)&&(this.basicModeInstance=new t.UFBasicMode(this.designerInst,this.queryDesignerInst,this.wrapper.find("#"+this.id+"_simple_mode"))),this.basicModeInstance},enumerable:!1,configurable:!0}),i.prototype.render=function(){this.designerInst.element.find("#"+this.id+"_configure_panel").length!==0&&(n.DashboardUtil.destroyEjObjects(this.designerInst.element.find("#"+this.id+"_configure_panel")),this.designerInst.element.find("#"+this.id+"_configure_panel").remove(),this.unWireEvents());this.parentElement=n.buildTag("div.bbi-dbrd-uf-dlg-content-panel","",{},{id:this.id+"_configure_panel"});this.wrapper=n.buildTag("div","",{height:"99%"},{id:this.id});this.parentElement.append(this.wrapper);this.previewPanel=n.buildTag("div","",{display:"none"},{id:this.id+"_preview_panel"});this.parentElement.append(this.previewPanel);var t=n.buildTag("div.bbi-dbrd-uf-dlg-mode-btn-wrapper","",{},{id:this.id+"_header_btn_wrapper"}),i=n.buildTag("div.bbi-dbrd-uf-dlg-splitter","",{},{});this.content=n.buildTag("div","",{"box-sizing":"border-box",height:"93%"},{id:this.id+"_content_wrapper"});this.wrapper.append(t,i,this.content);this.dialogObj=this.parentElement.BoldBIDashboardDialog({title:this.locale.userFilterLocale.dialogTitle,maxWidth:800,minWidth:800,maxHeight:640,height:"auto",width:"auto",enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,containment:"#"+this.designerInst._id,target:"#"+this.designerInst._id,cssClass:"bbi-designer-dialog bbi-designer-format boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(this.close,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText}).data("BoldBIDashboardDialog");this.createFooter();this.createContainersForDiffModes();this.createHeaderBtnSection(t);this.loader=this.parentElement.BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup bbi-designer-loader",template:this.designerInst.getWaitingPopupTemplate()}).data("BoldBIDashboardWaitingPopup")},i.prototype.createContainersForDiffModes=function(){var n="<div id='"+this.id+"_simple_mode' style='width:100%;'><\/div><div id='"+this.id+"_advanced_mode'style='width:100%;height:100%;'><\/div>";this.content.html(n)},i.prototype.onAdvancedModeEventChange=function(n){switch(n.trigger){case"preview":this.renderPreviewData(n);break;case"savebtnstate":this.setSaveBtnState(n.state)}},i.prototype.renderPreviewData=function(t){var i;if(this.previewPanel.find("#"+this.id+"_preview_data_table").length===0){var o=n.buildTag("div.bbi-dbrd-uf-adv-preview-wrapper","",{},{id:this.id+"_preview_data_table"}),s=n.buildTag("div","",{border:"1px solid var(--querydesigner-primary-border-color)"},{id:this.id+"_div_previewGrid"}),c=n.buildTag("button.bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-uf-adv-preview-back-btn","<span><\/span><span>Back<\/span>",{},{id:this.id+"_back_btn",type:"button"}),l=n.buildTag("div.bbi-dbrd-uf-adv-preview-info-msg","*"+this.locale.userFilterLocale.previewMaxRecordsText);o.append(c,s,l);this.previewPanel.append(o);this.ejPreviewGrid=s.BoldBIDashboardGrid({allowScrolling:!0,allowResizing:!0,enableRowHover:!1,allowSelection:!1,columnLayout:n.Grid.ColumnLayout.Auto,scrollSettings:{allowVirtualScrolling:!1,virtualScrollMode:n.Grid.VirtualScrollMode.Normal},columns:[{field:"Preview",headerText:"Preview",width:80}]}).data("BoldBIDashboardGrid")}if(t.data&&t.data.table&&t.data.type){this.wrapper.css("display","none");this.previewPanel.css("display","block");var u=JSON.parse(t.data.table),r=JSON.parse(t.data.type),f=[],e=[],h=this.previewPanel.width(),a=150*r.length>h?150:(h-20)/r.length;for(i=0;i<r.length;i++)f.push({field:r[i].ID,headerText:r[i].Name+(t.identityColumn===r[i].Name?"("+this.locale.userFilterLocale.identityColumnText+")":""),textAlign:this.getAlignType(r[i].DataType),type:this.getType(r[i].DataType),width:a}),e.push(r[i].ID);for(i=e.length-1;i>=0;i--)(u.length>0&&Object.keys(u[0]).indexOf(e[i])===-1||u.length===0&&r[i].IsVisible===!1)&&f.splice(i,1);f.length>0&&(this.ejPreviewGrid.option("dataSource",[]),this.ejPreviewGrid.setModel({dataSource:u,columns:f}),this.ejPreviewGrid.element.find(".e-table").css("width","100%"),this.ejPreviewGrid.setModel({scrollSettings:{width:778}}),this.ejPreviewGrid.refreshContent());this.setSaveBtnState(!0)}!n.isNullOrUndefined(t.data.HasError)&&t.data.HasError&&this.designerInst.modules.util.alertDialog(this.locale.alertDialogTitle.dataSet,this.locale.errorMessage.failedToPreviewTable,IconType.errors,AlertType.Alert,!0,t.data.Message)},i.prototype.getAlignType=function(t){return t.toLowerCase()==="string"||t.toLowerCase()==="boolean"||t.toLowerCase()==="date"?n.TextAlign.Left:t.toLowerCase()==="integer"||t.toLowerCase()==="real"?n.TextAlign.Right:n.TextAlign.Left},i.prototype.getType=function(n){return n.toLowerCase()==="string"||n.toLowerCase()==="boolean"?"string":n.toLowerCase()==="integer"||n.toLowerCase()==="real"?"number":n.toLowerCase()==="date"?"date":"string"},i.prototype.createHeaderBtnSection=function(i){var r=n.buildTag("div","",{},{id:this.id+"_btn_grp"}),u;i.append(r);u={callBackInstance:this,callBackMethod:"onModeSelectionChangeHandler",groupName:"user-filter-modes",triggerOnCodeUpdate:!0,labelPosition:t.LabelPosition.After,dataSource:[{id:this.id+"_simple",label:this.locale.userFilterLocale.manualModeText,value:"manual"},{id:this.id+"_datasource",label:this.locale.userFilterLocale.datasourceModeText,value:"datasource"},{id:this.id+"_query",label:this.locale.userFilterLocale.userFilterQueryModeText,value:"query"}]};this.modeBtnObj=new t.RadioButton(u,r);this.modeBtnObj.updateItemByValue("manual",!0)},i.prototype.createFooter=function(){var t=n.buildTag("button.bbi-dbrd-btn-primary bbi-dbrd-btn-small bbi-dbrd-margin-left",this.locale.saveDatasourceDialog.saveButtonText,{float:"right"},{id:this.id+"_save_btn",type:"button"}),i=n.buildTag("button.bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-margin-left",this.locale.dialogOptions.closeButtonText,{float:"right"},{id:this.id+"_close_btn",type:"button"}),r=n.buildTag("button.bbi-dbrd-btn-secondary bbi-dbrd-btn-small",this.locale.userFilterLocale.resetSettingsBtnText,{},{id:this.id+"_reset_default_btn",type:"button"}),u=this.designerInst.element.find("#"+this.id+"_configure_panel_foot");u.append(r,i,t)},i.prototype.wireEvents=function(){this.designerInst.element.on("click","#"+this.id+"_close_btn",this.bbdesigner$.proxy(this.close,this));this.designerInst.element.on("click","#"+this.id+"_save_btn",this.bbdesigner$.proxy(this.save,this));this.designerInst.element.on("click","#"+this.id+"_back_btn",this.bbdesigner$.proxy(this.onPreviewPanelBackBtnClick,this));this.designerInst.element.on("click","#"+this.id+"_reset_default_btn",this.bbdesigner$.proxy(this.onResetDefaultBtnClick,this))},i.prototype.unWireEvents=function(){this.designerInst.element.off("click","#"+this.id+"_close_btn",this.bbdesigner$.proxy(this.close,this));this.designerInst.element.off("click","#"+this.id+"_save_btn",this.bbdesigner$.proxy(this.save,this));this.designerInst.element.off("click","#"+this.id+"_back_btn",this.bbdesigner$.proxy(this.onPreviewPanelBackBtnClick,this));this.designerInst.element.off("click","#"+this.id+"_reset_default_btn",this.bbdesigner$.proxy(this.onResetDefaultBtnClick,this))},i.prototype.enableButton=function(t,i){n.DashboardUtil.buttonEnable(t,i)},i.prototype.onModeSelectionChangeHandler=function(n){this.isInteraction&&(n.args.value!==this.prevMode&&(this.basicModeInst.isModified()||this.advModeInst.isModifiled())?this.designerInst.modules.util.alertDialog(this.locale.userFilterLocale.alertDialogTitle,this.locale.userFilterLocale.resetSettingsMsg,IconType.question,AlertType.Confirm,!1,"",{instance:this,method:"changeModeSelection",dataInfo:n}):this.changeModeSelection(!0,n))},i.prototype.changeModeSelection=function(t,i){if(t){this.selectedMode=i.args.value;switch(i.args.value){case"datasource":case"query":this.basicModeInst.resetToDefaultState();this.basicModeInst.hide();this.advModeInst.show(null,i.args.value);this.setSaveBtnState(!1);break;case"manual":this.advModeInst.reset();this.advModeInst.hide();this.setSaveBtnState(!0);this.basicModeInst.show();this.basicModeInst.updateUiOnModeSwitch()}}else n.isNullOrUndefined(this.selectedMode)||this.modeBtnObj.updateItemByValue(this.selectedMode,!0,!0)},i.prototype.showDialog=function(t){try{if(this.reset(),this.dialogObj.open(),this.isInteraction=!1,n.isNullOrUndefined(t)||n.isNullOrUndefined(t.Mode))this.selectedMode="manual",this.modeBtnObj.updateItemByValue(this.selectedMode,!0,!0),this.advModeInst.hide(),this.basicModeInst.render(),this.setSaveBtnState(!0),this.basicModeInst.show(),this.basicModeInst.updateUiOnShow();else{this.userBasedFilterInfo=t;switch(t.Mode){case UserBasedFilterMode.Advanced:this.advModeInst.isOpen=!0;t.AdvancedFilter.Mode===AdvancedFilterMode.Table?(this.modeBtnObj.updateItemByValue("datasource",!0,!0),this.selectedMode="datasource"):(this.modeBtnObj.updateItemByValue("query",!0,!0),this.selectedMode="query");this.basicModeInst.hide();this.advModeInst.show(n.isNullOrUndefined(this.userBasedFilterInfo)?null:this.userBasedFilterInfo.AdvancedFilter,this.selectedMode);this.setSaveBtnState(!1);break;case UserBasedFilterMode.Basic:this.selectedMode="manual";this.modeBtnObj.updateItemByValue(this.selectedMode,!0,!0);this.advModeInst.hide();this.basicModeInst.render();this.basicModeInst.show();this.basicModeInst.updateUiOnShow();this.setSaveBtnState(!0)}}}catch(i){this.designerInst.designerPanel.logError({Error:i.message,Source:i});this.isInteraction=!0}this.isInteraction=!0},i.prototype.close=function(){this.reset();this.basicModeInst.resetToDefaultState();this.advModeInst.reset();this.basicModeInst.closeFilterWindow();this.dialogObj.close()},i.prototype.reset=function(){this.previewPanel.hide();n.isNullOrUndefined(this.ejPreviewGrid)||this.ejPreviewGrid.dataSource([]);this.wrapper.show();this.setSaveBtnState(!1)},i.prototype.onPreviewPanelBackBtnClick=function(){this.wrapper.css("display","block");this.previewPanel.css("display","none");this.advModeInst.resize()},i.prototype.setSaveBtnState=function(n){this.enableButton(this.designerInst.element.find("#"+this.id+"_save_btn"),n)},i.prototype.setResetBtnState=function(n){this.enableButton(this.designerInst.element.find("#"+this.id+"_reset_default_btn"),n)},i.prototype.onResetDefaultBtnClick=function(t){typeof t=="boolean"?t&&(this.setSaveBtnState(!0),n.isNullOrUndefined(this.selectedMode)||this.selectedMode!=="datasource"&&this.selectedMode!=="query"?this.basicModeInst.onResetToDefault():(this.advModeInst.reset(),this.advModeInst.hideElement(!0))):this.designerInst.modules.util.alertDialog(this.locale.alertDialogTitle.dashboardDesigner,this.locale.userFilterLocale.resetSettingsMsg,IconType.question,AlertType.Confirm,!1,"",{instance:this,method:"onResetDefaultBtnClick"})},i.prototype.save=function(){this.userBasedFilterInfo=n.isNullOrUndefined(this.selectedMode)||this.selectedMode!=="datasource"&&this.selectedMode!=="query"?this.basicModeInst.getBasicFilterInfo():this.advModeInst.getAdvancedFilterInfo();this.designerInst.modules.util.doAjaxPost("POST",this.designerInst.model.serviceUrl+n.Dashboard.ServiceAPI.saveUserFilter,{action:n.DashboardUtil.DesignerAction.SaveUserFilter,data:JSON.stringify({dataSourceId:this.queryDesignerInst.dataset.Id,UserBasedFilterInfo:this.userBasedFilterInfo})},{fnction:this.bbdesigner$.proxy(this.onFiltersSave,this),indicator:[this.bbdesigner$.proxy(this.showSaveLoader,this),this.bbdesigner$.proxy(this.hideSaveLoader,this)]})},i.prototype.onFiltersSave=function(n){n.Status&&(this.queryDesignerInst.userBasedFilterInfo=this.queryDesignerInst.dataset.UserBasedFilterInfo=this.userBasedFilterInfo,this.basicModeInst.closeFilterWindow(),this.dialogObj.close())},i.prototype.showSaveLoader=function(){this.setSaveBtnState(!1);this.setResetBtnState(!1);this.loader.show()},i.prototype.hideSaveLoader=function(){this.setSaveBtnState(!0);this.setResetBtnState(!0);this.loader.hide()},i}();t.UserBasedFilterDialog=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={}));InternalQueryFilter=function(){function n(n){this.selectionType=null;this.parameterName=null;this.endParameterName=null;this.myDictionary={};this.isValueUpdated=!1;this.queryFilters=[];this.dataFields=[];this.parameters=[];this.parameterList=[];this.paramNameList=[];this.rootNode=null;this.parentDiv=null;this.containerDiv=null;this.dateTimeFormats=[];this.dateTimeformatforTopN=[];this.dimensionFormats=[];this.measureFormats=[];this.modeTypes=[];this.operatorTypes=[];this.dashboardDesigner=null;this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.dateRangePopup=this.dashboardDesigner.modules.dateRangePopup;this.multiSelectionComboBox=new BoldBIDashboard.DashboardDesignerUtility.MultiSelectionComboBox(this.dashboardDesigner);this.setItemDataSource();this.id=this.queryDesigner.id;this.renderQueryFilterDialog()}return n.prototype.renderQueryFilterDialog=function(){var n=BoldBIDashboard.buildTag("div.bbi-dashboard-designer-configuration bbi-userselect bbi-designer-query-dialog","",{height:"auto","border-left":"none"},{title:this.locale.initialFilter.dialogTitle,id:this.id+"_query_filter_dialog"}),u=BoldBIDashboard.buildTag("div","",{},{}),f=BoldBIDashboard.buildTag("table","",{width:"97%","border-bottom":"1px solid var(--querydesigner-primary-border-color)",margin:"0.5em 12px","padding-bottom":"5px"},{}),i=BoldBIDashboard.buildTag("tr","",{"padding-top":"10px"},{}),e=BoldBIDashboard.buildTag("td","",{width:"500px"},{}),l=BoldBIDashboard.buildTag("Label.bbi-designer-add-label",this.locale.initialFilter.tableFilters,{},{type:"label"}),o=BoldBIDashboard.buildTag("td","",{},{}),t=BoldBIDashboard.buildTag("div","",{cursor:"pointer",float:"right"},{}),a=BoldBIDashboard.buildTag("span.e-chk-image e-icon e-plus bbi-designer-add-icon e-query-filter-add-icon","",{cursor:"pointer","margin-top":"1px"},{id:this.id+"_query_filter_add"}),v=BoldBIDashboard.buildTag("span.e-btntxt bbi-designer-add-btn",this.locale.initialFilter.addBtnText,{},{}),r=this.parentDiv=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","",{width:"907px",padding:"5px 10px",height:"310px",position:"relative","padding-left":"12px"},{id:this.id+"_query_parentContainer"}),y=this.containerDiv=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_query_container_div"}),s=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_query_btn_cancel",type:"button"}),h=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.dialogOptions.okButtonText,{float:"right"},{id:this.id+"_query_btn_ok",type:"button"}),c;n.append(u);u.append(f);f.append(i);i.append(e);e.append(l);i.append(o);o.append(t);t.append(a);t.append(v);n.append(r);r.append(y);this.dashboardDesigner.element.append(n);n.BoldBIDashboardDialog({minWidth:908,minHeight:395,width:"auto",height:"auto",enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,cssClass:"bbi-designer-dialog boldbi-dashboarddesigner",containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id,beforeClose:this.bbdesigner$.proxy(this.closePopup,this),close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.rootNode=this.dashboardDesigner.element.find("#"+this.id+"_query_filter_dialog_wrapper");c=this.rootNode.find("#"+this.id+"_query_filter_dialog_foot");c.append(s).append(h);h.on("click",this.bbdesigner$.proxy(this.saveQueryFilter,this,!0));s.on("click",this.bbdesigner$.proxy(this.closeDialog,this,!0));t.on("click",this.bbdesigner$.proxy(this.addQueryFilter,this));r.BoldBIDashboardScroller({height:"310px",scrollerSize:this.dashboardDesigner.scrollerSize.scrollSize,enableTouchScroll:!0,autoHide:!0,buttonSize:this.dashboardDesigner.scrollerSize.buttonSize})},n.prototype.UpdateParameterInInitialFilter=function(n,t){if(!BoldBIDashboard.isNullOrUndefined(n)){var i=null;BoldBIDashboard.isNullOrUndefined(n.DimensionFilterSchemaInfo)||BoldBIDashboard.isNullOrUndefined(n.DimensionFilterSchemaInfo.ColumnId)||(i=n.DimensionFilterSchemaInfo.DimensionFilterCondition);BoldBIDashboard.isNullOrUndefined(n.MeasureFilterSchemaInfo)||BoldBIDashboard.isNullOrUndefined(n.MeasureFilterSchemaInfo.ColumnId)||(i=n.MeasureFilterSchemaInfo.MeasureFilterCondition);BoldBIDashboard.isNullOrUndefined(n.DateFilterSchemaInfo)||BoldBIDashboard.isNullOrUndefined(n.DateFilterSchemaInfo.ColumnId)||(i=n.DateFilterSchemaInfo.DateAndTimeFormatCondition);BoldBIDashboard.isNullOrUndefined(n.ParameterInfo)||this.SetParameterDropDownValues(n.ParameterInfo.IsParamApplied,n.ParameterInfo.ParameterName,n.ParameterInfo.EndParameterName,t,i,n.ParameterInfo.RangeValueOfFirstParam,n.ParameterInfo.RangeValueOfSecondtParam)}},n.prototype.SetParameterDropDownValues=function(n,t,i,r,u,f,e){t=this.getParameterNameFromID(t,f);i=this.getParameterNameFromID(i,e);this.myDictionary[r+"_isParamApplied"]=n;this.myDictionary[r+"_parameterName"]=t;this.myDictionary[r+"_endParameterName"]=i;this.myDictionary[r+"_operator"]=u;this.myDictionary[r+"_selectionType"]=n?"Parameters":"Custom"},n.prototype.getParameterNameFromID=function(n,t){var r,i;if(t===void 0&&(t=""),!BoldBIDashboard.isNullOrUndefined(n)){if(r=/^[{(]?[0-9A-Fa-f]{8}[-]?(?:[0-9A-Fa-f]{4}[-]?){3}[0-9A-Fa-f]{12}[)}]?$/,!r.test(n))return n;if(this.parameterList.length>0)return(i=this.parameterList.filter(function(t){return t.parameterID===n}),i.length==2)?/.START/.test(t)?i[0].value:i[1].value:i.length>0?i[0].value:n}return n},n.prototype.getParameterIDFromName=function(n){if(this.parameterList.length>0){var t=this.parameterList.filter(function(t){return t.value===n});return t.length>0?t[0].parameterID:n}return n},n.prototype.renderQueryFilterRow=function(n){var u,i,t=BoldBIDashboard.getGuid(this.id+"_row_"),it=n&&n.Name?!0:!1,rt=this.getCurrentIndex(),s,nt,h,c,l;this.UpdateParameterInInitialFilter(n,t);var f=this.containerDiv.find(".bbi-designer-query-row").length,e=BoldBIDashboard.buildTag("div.bbi-designer-query-row","",{padding:f>0?"0px 10px":"6px 10px 14px 10px"},{id:t,rowId:t}),o=BoldBIDashboard.buildTag("table.bbi-designer-table-dialog","",{width:"100%",top:f>0?"-13px":"",position:f>0?"relative":"",padding:"5px 0px",border:"0.5px solid var(--querydesigner-primary-border-color)"},{id:t+"_query_container_table"}),a=BoldBIDashboard.buildTag("tr","",{},{}),r=BoldBIDashboard.buildTag("tr","",{},{}),v=BoldBIDashboard.buildTag("td","",{"padding-left":"0px"},{id:t+"_query_container_cell"}),y=BoldBIDashboard.buildTag("td","",{width:"20px","padding-left":"12px"},{}),p=BoldBIDashboard.buildTag("input.e-textbox","",{},{type:"text",id:t+"_query_filter_field"}),w=BoldBIDashboard.buildTag("td","",{"padding-top":"3px",width:"20px","padding-right":"7px"},{id:t+"_query_error_td"});this.dashboardDesigner.modules.util.renderErrIndictor(w,this.id);var b=BoldBIDashboard.buildTag("td","",{"padding-right":"10px","padding-top":"0px"},{}),k=BoldBIDashboard.buildTag("span.bbi-drbd-close-icon bbi-dbrd-designer-hoverable","",{cursor:"pointer","font-size":"10px"},{id:t+"_query_delete_icon","data-tooltip":"Delete"}),d=BoldBIDashboard.buildTag("tr","",{display:"none"},{id:t+"_tr_top"}),g=BoldBIDashboard.buildTag("td","",{height:"4px"},{id:t+"_td_top",colspan:"4"}),ut=BoldBIDashboard.buildTag("div","",{margin:"4px 0px",height:"auto",width:"100%"},{id:t+"_queryFilter_topDiv"});if(this.containerDiv.append(e),f>0&&(s=BoldBIDashboard.buildTag("td","",{},{id:t+"_query_empty_cell"}),nt=BoldBIDashboard.buildTag("div","",{height:"10px"},{}),s.append(nt),a.append(s),o.append(a),h=BoldBIDashboard.buildTag("div","",{position:"relative","padding-left":"14px","z-index":1},{id:t+"_query_operator_type_div"}),c=BoldBIDashboard.buildTag("input","",{},{type:"text",id:t+"_query_operator_type"}),h.append(c),e.append(h),c.BoldBIDashboardDropDownList({width:"130px",height:"26px",dataSource:this.operatorTypes,fields:{text:"text",value:"value"},enabled:!0,selectedIndex:0,showRoundedCorner:!0,cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-dbrd-control bbi-background"})),e.append(o),o.append(r),r.append(y),y.append(p),r.append(v),r.append(w),r.append(b),b.append(k),o.append(d),d.append(g),g.append(ut),p.BoldBIDashboardDropDownList({width:"130px",height:"26px",minPopupWidth:"130px",maxPopupWidth:"600px",dataSource:this.dataFields,fields:{text:"text",value:"value"},enabled:!0,enableFilterSearch:!0,change:this.bbdesigner$.proxy(this.onDropDownChange,this,t,this.dataFields),selectedIndex:rt,showRoundedCorner:!0,cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-dbrd-control"}),k.bind("click",this.bbdesigner$.proxy(this.deleteQueryFilter,this,e)),it&&(l=this.getFieldText(n.Id,n.TableName,n.Schema),this.getDrpDwn1(t).data("BoldBIDashboardDropDownList").selectItemByText(l)),this.dataFields.length>0){var ft=this.getDrpDwn1(t).data("BoldBIDashboardDropDownList").getSelectedItem(),l=this.bbdesigner$(ft).text(),tt=this.getSelectedValue(l);u=tt.typeName;i=tt.typeCast}return u=BoldBIDashboard.isNullOrUndefined(i)||i.length===0||this.isDefaultCast(i)?u:i,this.renderInputField(u,t,v),this.scrollerRefresh(this.parentDiv),t},n.prototype.renderCheckboxItem=function(n,t,i){var r=BoldBIDashboard.buildTag("td","",{align:"left",width:n.toLowerCase()==="false"?"67px":"98px","padding-left":"13px",height:"27px"}),u,f;i.append(r);u=BoldBIDashboard.buildTag("input","",{},{type:"checkbox",id:t});r.append(u);f=BoldBIDashboard.buildTag("label.bbi-designer-fontfamily",n,{"margin-left":"15px","font-size":"13px"},{id:t,"for":t});r.append(f);u.BoldBIDashboardCheckBox({cssClass:"bbi-designer-param-assign"})},n.prototype.renderBoolFields=function(n,t){var u=BoldBIDashboard.buildTag("table","",{width:"100%","background-color":"#F9F9F9","padding-bottom":"3px","padding-top":"3px"},{}),i=BoldBIDashboard.buildTag("tr","",{},{}),r;this.renderCheckboxItem("Null",n+"_query_bool_chkbx1",i);this.renderCheckboxItem("True",n+"_query_bool_chkbx2",i);this.renderCheckboxItem("False",n+"_query_bool_chkbx3",i);r=BoldBIDashboard.buildTag("td","",{width:"113px","padding-left":"26px"});this.renderCodeSwitcher(n,r,QueryDatatype.Bool.toString());this.renderTopFields(n,QueryDatatype.Bool.toString());this.rootNode.find("#"+n+"_query_bool_topLable").css({"margin-top":"7px"});this.rootNode.find("#"+n+"_query_bool_chkSwitcher").css({"margin-top":"2px"});t.append(u);u.append(i);i.append(r)},n.prototype.renderInputField=function(n,t,i){BoldBIDashboard.isNullOrUndefined(n)||(this.isNumber(n)?this.renderFields(t,i,n,QueryDatatype.Int.toString()):this.isString(n)?this.renderFields(t,i,n,QueryDatatype.Char.toString()):this.isBoolean(n)?this.renderBoolFields(t,i):this.isDate(n)&&this.renderFields(t,i,n,QueryDatatype.Date.toString()))},n.prototype.renderDateFields=function(n,t,i,r){var v=this.getDrpDwn1(n).data("BoldBIDashboardDropDownList").getSelectedItem(),o=this.bbdesigner$(v).text(),e,a,u;this.selectionType=BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_selectionType"])?"Custom":this.myDictionary[n+"_selectionType"];this.parameterName=BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_parameterName"])?"":this.myDictionary[n+"_parameterName"];this.endParameterName=BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_endParameterName"])?"":this.myDictionary[n+"_endParameterName"];var s=BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_operator"])?this.getOperatorDrpDwn(n,r).data("BoldBIDashboardDropDownList").getSelectedValue():this.myDictionary[n+"_operator"],h=this.getDrpDwn1(n).data("BoldBIDashboardDropDownList").getSelectedValue(),f=BoldBIDashboard.buildTag("td","",{"padding-left":"10px"},{id:n+"_query_date_pickcol"}),c=BoldBIDashboard.buildTag("td","",{width:"122px","padding-left":"26px"},{id:n+"_query_"+r+"_switcher"}),l=BoldBIDashboard.buildTag("td","",{"padding-left":"10px",width:"10px",display:s.toLowerCase()==="date"?"table-cell":"none"},{id:n+"_query_"+r+"_txtcol_param"});this.renderCodeSwitcher(n,c,r);this.renderTopFields(n,r);t.append(l);this.renderDropDownForParameter(n,r,l,t);t.append(f);e=BoldBIDashboard.buildTag("div","",{width:"144px",height:"100%"},{id:n+"_query_date_picker_div"});f.append(e);this.multiSelectionComboBox.renderMultiSelectionComboBox(e,n,this.queryDesigner.dataset.Id);a=this.multiSelectionComboBox.getMultiSelectionComboBox(n);a.attr({"data-fieldValue":h,"data-fieldText":o,"data-dateFormat":this.getOperatorDrpDwn(n,r).data("BoldBIDashboardDropDownList").getSelectedValue()});this.dateRangePopup.renderDateRangeDrpDwn(n,f,this.queryDesigner.dataset.Id,{Id:h,Name:o},null,"QueryFilter");t.append(c);this.getTxtColTag1(n,r).css("display","none");u=BoldBIDashboard.isNullOrUndefined(this.getOperatorDrpDwn(n,"date").data("BoldBIDashboardDropDownList"))?"":this.getOperatorDrpDwn(n,"date").data("BoldBIDashboardDropDownList").getSelectedValue();s==="Date"?this.populateDateRangeParameterValues(n,r,u):this.dateTimeFormats.some(function(n){return n.value===u})&&this.populateDateFormatParameterValues(n,r,u)},n.prototype.renderStringFields=function(n,t,i,r){var p=this.getDrpDwn1(n).data("BoldBIDashboardDropDownList").getSelectedItem(),w=this.bbdesigner$(p).text(),b=this.getDrpDwn1(n).data("BoldBIDashboardDropDownList").getSelectedValue(),o=this.getOperatorDrpDwn(n,r).data("BoldBIDashboardDropDownList").model.value.toLowerCase(),e=BoldBIDashboard.buildTag("td","",{"padding-left":"10px"},{id:n+"_query_"+r+"_txtcol1"}),u=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-textbox-border","",{"padding-left":"9px",height:"22px",width:"134px",display:o==="inclusion"?"none":"block"},{type:"text",id:n+"_query_"+r+"_txtVal1"}),l=BoldBIDashboard.buildTag("td","",{"padding-left":"10px",width:"10px"},{id:n+"_query_"+r+"_txtcol_param"}),a=BoldBIDashboard.buildTag("td","",{"padding-left":"10px",display:"none"},{id:n+"_query_"+r+"_txtcol2"}),f=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-textbox-border","",{height:"22px",display:"none"},{type:"text",id:n+"_query_"+r+"_txtVal2"}),v=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-textbox-border","",{height:"22px",width:"134px",display:"none"},{type:"text",readonly:"readonly",id:n+"_query_null_txt",value:"null"}),y=BoldBIDashboard.buildTag("td","",{width:"122px","padding-left":"26px"},{id:n+"_query_"+r+"_switcher"}),s,h,c;r!==QueryDatatype.Date.toString()&&(this.selectionType=BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_selectionType"])?"Custom":this.myDictionary[n+"_selectionType"],this.parameterName=BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_parameterName"])?"":this.myDictionary[n+"_parameterName"],this.endParameterName=BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_endParameterName"])?"":this.myDictionary[n+"_endParameterName"],t.append(l),this.renderDropDownForParameter(n,r,l,t));t.append(e);e.append(u);(r===QueryDatatype.Char.toString()||r===QueryDatatype.Date.toString())&&(s=BoldBIDashboard.buildTag("div","",{width:"144px",height:"100%"},{}),e.append(s),this.multiSelectionComboBox.renderMultiSelectionComboBox(s,n,this.queryDesigner.dataset.Id),h=this.multiSelectionComboBox.getMultiSelectionComboBox(n),c=null,r===QueryDatatype.Date.toString()&&(c=this.getOperatorDrpDwn(n,r).data("BoldBIDashboardDropDownList").getSelectedValue()),h.attr({"data-fieldValue":b,"data-fieldText":w,"data-dateFormat":c}),h.css("display",o==="inclusion"?"block":"none"));f.val(r!==QueryDatatype.Char.toString()?"0":"");u.val(r!==QueryDatatype.Char.toString()?"0":"");t.append(a);a.append(f);r===QueryDatatype.Char.toString()&&(t.append(y),this.renderCodeSwitcher(n,y,r),this.renderTopFields(n,r));r===QueryDatatype.Int.toString()&&(e.append(v),this.renderNullField(n,t));(i==="System.Double"||i.toLowerCase()==="number"||i==="System.Single"||i==="System.Decimal")&&(f.val(r!==QueryDatatype.Char.toString()?"0.00":""),u.val(r!==QueryDatatype.Char.toString()?"0.00":""));r===QueryDatatype.Int.toString()&&(u.bind("keypress",this.bbdesigner$.proxy(this.validateTxtBox,this,u,i)),u.bind("focusin",this.bbdesigner$.proxy(this.textFocus,this,u,"focusin",i)),u.bind("focusout",this.bbdesigner$.proxy(this.textFocus,this,u,"focusout",i)),f.bind("keypress",this.bbdesigner$.proxy(this.validateTxtBox,this,f,i)),f.bind("focusin",this.bbdesigner$.proxy(this.textFocus,this,f,"focusin",i)),f.bind("focusout",this.bbdesigner$.proxy(this.textFocus,this,f,"focusout",i)),u.css({"text-align":"right","padding-right":"10px","padding-left":"0px"}),f.css({"text-align":"right","padding-right":"10px","padding-left":"0px"}),v.css({"text-align":"right","padding-right":"10px","padding-left":"0px"}));this.populateParameterValues(n,r,o)},n.prototype.populateDateRangeParameterValues=function(n,t,i){if(t.toLowerCase()==="date")if(this.isValueUpdated||BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_isParamApplied"])||!this.myDictionary[n+"_isParamApplied"])this.setDefaultValues(n,t,i);else{var r=this.dashboardDesigner.element.find("#"+n+"_query_"+t+"_txtcol_param"),u=this.getStartParamDropDownSelectionValue(n),f=this.getEndParamDropDownSelectionValue(n),e=this.dashboardDesigner.element.find("#"+n+"_dateRange_Start"),o=this.dashboardDesigner.element.find("#"+n+"_dateRange_end");r.css("display","table-cell");u.css("display","table-cell");f.css("display","table-cell");e.css("display","none");o.css("display","none");this.setDataForDateDropdowns(n,this.parameterName,this.endParameterName,this.selectionType)}this.isValueUpdated=!1},n.prototype.populateDateFormatParameterValues=function(n,t,i){var u=this.getParamDropDownSelectionValue(n),r;t.toLowerCase()==="date"&&(this.isValueUpdated||BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_isParamApplied"])||!this.myDictionary[n+"_isParamApplied"]?this.setDefaultValues(n,t,i):(r=this.getParameterDropDown(n,t),this.getDateColumnTag(n).css("display","none"),r.css("display","table-cell"),u.data("ParameterInfos",BoldBIDashboard.isNullOrUndefined(this.parameterName)?null:{Name:this.parameterName,Id:this.getParameterIDFromName(this.parameterName)}),this.setDataForParamDropDown(n,this.parameterName,this.selectionType,t)));this.isValueUpdated=!1},n.prototype.setDataForParamDropDown=function(n,t,i,r){var u=this.getParamDropDownSelectionValue(n),f=this.getParameterDropDown(n,r),e=this.getParameterValue(n);u.data("ParameterInfos",BoldBIDashboard.isNullOrUndefined(t)?null:{Name:t,Id:this.getParameterIDFromName(t)});this.parameterName=this.checkValidParameterOrNot(t,this.parameterList,n);BoldBIDashboard.isNullOrUndefined(f.data("BoldBIDashboardDropDownList"))?null:e.data("BoldBIDashboardDropDownList").setModel({value:t});BoldBIDashboard.isNullOrUndefined(u.data("BoldBIDashboardDropDownList"))?null:u.data("BoldBIDashboardDropDownList").setModel({value:i})},n.prototype.setDataForDateDropdowns=function(n,t,i,r){var o=this.dateRangePopup.renderDateRangePopup(n);this.dateRangePopup.updateParameterListInfo(this.parameterList);var s=BoldBIDashboard.isNullOrUndefined(o)?this.dashboardDesigner.element:o,u=this.getParamDropDownSelectionValue(n),f=s.find("#"+n+"_date_Start_param"),e=s.find("#"+n+"_date_End_param");u.data("selectedType",r);f.data("ParameterInfos",BoldBIDashboard.isNullOrUndefined(t)?null:{Name:t,Id:this.getParameterIDFromName(t)});e.data("ParameterInfos",BoldBIDashboard.isNullOrUndefined(i)?null:{Name:i,Id:this.getParameterIDFromName(i)});this.parameterName=this.checkValidParameterOrNot(t,this.parameterList,n);this.endParameterName=this.checkValidParameterOrNot(i,this.parameterList,n);BoldBIDashboard.isNullOrUndefined(f.data("BoldBIDashboardDropDownList"))?null:f.data("BoldBIDashboardDropDownList").setModel({value:t});BoldBIDashboard.isNullOrUndefined(e.data("BoldBIDashboardDropDownList"))?null:e.data("BoldBIDashboardDropDownList").setModel({value:i});BoldBIDashboard.isNullOrUndefined(u.data("BoldBIDashboardDropDownList"))?null:u.data("BoldBIDashboardDropDownList").setModel({value:r})},n.prototype.populateParameterValues=function(n,t,i){var e=this.getParameterDropDown(n,t),o=this.getParameterBtwDropDown(n,t),r=BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_operator"])?i:this.myDictionary[n+"_operator"],u,f;this.isValueUpdated||BoldBIDashboard.isNullOrUndefined(this.myDictionary[n+"_isParamApplied"])||!this.myDictionary[n+"_isParamApplied"]?this.setDefaultValues(n,t,r):(u=this.getParamDropDownSelectionValue(n),f=this.getParamBtwDropDownSelectionValue(n),u.data("ParameterInfos",{Name:this.parameterName,Id:this.getParameterIDFromName(this.parameterName)}),u.data("selectedType",this.selectionType),this.getTxtColTag1(n,t).css("display","none"),e.css("display","table-cell"),t.toLowerCase()===QueryDatatype.Int.toString()&&(r.toLowerCase()===QueryOperator.Between.toString()||r.toLowerCase()===QueryOperator.NotBetween.toString())&&(o.css("display","table-cell"),this.getTxtColTag2(n,t).css("display","none"),f.data("ParameterInfos",{Name:this.endParameterName,Id:this.getParameterIDFromName(this.endParameterName)})));this.isValueUpdated=!1},n.prototype.setDefaultValues=function(n,t,i){var e=this.getParameterDropDown(n,t),o=this.getParameterBtwDropDown(n,t),r=this.getParamDropDownSelectionValue(n),s=this.getParamBtwDropDownSelectionValue(n),h=this.getParameterValue(n),u,f;r.data("ParameterInfos",null);r.data("selectedType","Custom");e.css("display","none");o.next("td").css("display","table-cell");this.getTxtColTag1(n,t).css("display","table-cell");this.isString(t)||t.toLowerCase()===QueryDatatype.Int.toString()?(r.data("BoldBIDashboardDropDownList").setModel({value:"Custom"}),s.data("BoldBIDashboardDropDownList").setModel({value:null}),h.data("BoldBIDashboardDropDownList").setModel({value:null}),t.toLowerCase()===QueryDatatype.Int.toString()&&(i.toLowerCase()===QueryOperator.Between.toString()||i.toLowerCase()===QueryOperator.NotBetween.toString())&&(this.getTxtColTag2(n,t).css("display","table-cell"),this.getTxtColTag2(n,t).find("input").css("display","block"))):this.isDate(t)&&(u=this.dashboardDesigner.element.find("#"+n+"_query_"+t+"_txtcol_param"),f=this.dateTimeFormats.some(function(n){return n.value===i})&&i.toLowerCase()!=QueryDatatype.Date.toString(),u.css("display",f||i.toLowerCase()==QueryDatatype.Date.toString()?"table-cell":"none"),f?this.setDataForParamDropDown(n,this.parameterName,"Custom",t):i.toLowerCase()==QueryDatatype.Date.toString()?this.setDataForDateDropdowns(n,null,null,"Custom"):(u.css("display","none"),this.setDataForDateDropdowns(n,null,null,"Custom")))},n.prototype.renderDropDownForParameter=function(n,t,i,r){var s=BoldBIDashboard.buildTag("input.e-textbox",this.selectionType,{},{type:"text",id:n+"_param"}),e,u,o,f;i.append(s);s.BoldBIDashboardDropDownList({width:"130px",height:"26px",popupWidth:"150px",dataSource:[{text:"Custom",value:"Custom"},{text:"Parameters",value:"Parameters"}],fields:{text:"text",value:"value"},value:this.selectionType,enabled:!0,change:this.bbdesigner$.proxy(this.onParameterDropDownChange,this,n,t,this.parameterList),selectedIndex:0,showRoundedCorner:!0,cssClass:"bbi-dbrd-control"});this.isBoolean(t)||(e=BoldBIDashboard.buildTag("td","",{"padding-left":"10px",display:"none"},{id:n+"_query_"+t+"_parameter_dropdown"}),u=BoldBIDashboard.buildTag("input.e-textbox",this.parameterName,{height:"30px",width:"160px"},{type:"text",id:n+"_param_elements"}),e.append(u),this.parameterName=this.checkValidParameterOrNot(this.parameterName,this.parameterList,n),u.BoldBIDashboardDropDownList({width:"130px",height:"26px",popupWidth:u.width(),field:{text:"text",value:"value",name:"name",id:"id"},dataSource:this.parameterList,enabled:!0,value:this.parameterName,selectedIndex:null,showRoundedCorner:!0,cssClass:"bbi-dbrd-control",change:this.bbdesigner$.proxy(this.parameterChangeEvent,this,n)}),o=BoldBIDashboard.buildTag("td","",{"padding-left":"10px",display:"none"},{id:n+"_query_"+t+"_parameter_dropdown_btw"}),f=BoldBIDashboard.buildTag("input.e-textbox",this.endParameterName,{height:"30px",width:"160px"},{type:"text",id:n+"_param_btw"}),o.append(f),this.endParameterName=this.checkValidParameterOrNot(this.endParameterName,this.parameterList,n),f.BoldBIDashboardDropDownList({width:"130px",height:"26px",popupWidth:f.width(),field:{text:"text",value:"value",name:"name",id:"id"},dataSource:this.parameterList,enabled:!0,value:this.endParameterName,selectedIndex:null,showRoundedCorner:!0,cssClass:"bbi-dbrd-control",change:this.bbdesigner$.proxy(this.parameterBtwChangeEvent,this,n)}),r.append(e),r.append(o))},n.prototype.checkValidParameterOrNot=function(n,t,i){var r,u,f;return!BoldBIDashboard.isNullOrUndefined(n)&&n!==""&&!this.isValueUpdated&&((r=!1,u=this.rootNode.find("#"+i+"_query_filter_field_container"),BoldBIDashboard.isNullOrUndefined(t))||(f=t.some(function(t){return t.value===n}),!f))?(r=!0,this.updateHighlighter(u,r),BoldBIDashboard.DashboardUtil.showErrIndictor(this.rootNode.find("#"+i+"_query_error_td"),r,"Select values to apply filter."),null):n},n.prototype.onParameterDropDownChange=function(n,t,i,r){var k,s;if(!BoldBIDashboard.isNullOrUndefined(r)&&!BoldBIDashboard.isNullOrUndefined(r.value)&&r.isInteraction){var u=this.getOperatorDrpDwn(n,t).data("BoldBIDashboardDropDownList").model.value,e=this.getParameterDropDown(n,t),l=this.getParameterBtwDropDown(n,t),a=this.getParamDropDownSelectionValue(n);this.dateRangePopup.updateParameterListInfo(i);var v=this.dateRangePopup.renderDateRangePopup(n),o=BoldBIDashboard.isNullOrUndefined(v)?this.dashboardDesigner.element:v,y=o.find("#"+n+"_query_date_Start_parameter_dropdown"),p=o.find("#"+n+"_query_date_End_parameter_dropdown"),w=o.find("#"+n+"_dateRange_Start"),b=o.find("#"+n+"_dateRange_end");if(a.data("selectedType",r.value),a.val(r.value),r.value==="Parameters"){if(this.isString(t)||t.toLowerCase()===QueryDatatype.Int.toString())this.getTxtColTag1(n,t).css("display","none"),t.toLowerCase()===QueryDatatype.Int.toString()&&(u.toLowerCase()===QueryOperator.Between.toString()||u.toLowerCase()===QueryOperator.NotBetween.toString())&&(l.css("display","table-cell"),this.getTxtColTag2(n,t).css("display","none"),k=this.getParamBtwDropDownSelectionValue(n),k.data("BoldBIDashboardDropDownList").setModel({value:i.length>0?i[0].value:null})),s=this.getParameterValue(n),s.data("BoldBIDashboardDropDownList").setModel({value:i.length>0?i[0].value:null}),e.css("display","table-cell");else if(this.isDate(t))if(u.toLowerCase()===QueryDatatype.Date.toString()){var d=i.filter(function(n){return n.dataType===DynamicParameterDataType.Date}),g=this.dateRangePopup.renderDateRangePopup(n),nt=BoldBIDashboard.isNullOrUndefined(g)?this.dashboardDesigner.element:g,f=d.length>0?d[0].value:null,h=nt.find("#"+n+"_date_Start_param"),c=nt.find("#"+n+"_date_End_param");BoldBIDashboard.isNullOrUndefined(h.data("BoldBIDashboardDropDownList"))?null:h.data("BoldBIDashboardDropDownList").setModel({value:f});BoldBIDashboard.isNullOrUndefined(c.data("BoldBIDashboardDropDownList"))?null:c.data("BoldBIDashboardDropDownList").setModel({value:f});h.data("ParameterInfos",BoldBIDashboard.isNullOrUndefined(f)?null:{Name:f,Id:this.getParameterIDFromName(f)});c.data("ParameterInfos",BoldBIDashboard.isNullOrUndefined(f)?null:{Name:f,Id:this.getParameterIDFromName(f)});y.css("display","table-cell");p.css("display","table-cell");w.css("display","none");b.css("display","none")}else this.dateTimeFormats.some(function(n){return n.value===u})&&(this.getDateColumnTag(n).css("display","none"),s=this.getParameterValue(n),s.data("BoldBIDashboardDropDownList").setModel({value:i.length>0?i[0].value:null}),e.css("display","table-cell"))}else r.value==="Custom"&&(this.isString(t)||t.toLowerCase()===QueryDatatype.Int.toString()?(this.getTxtColTag1(n,t).css("display","table-cell"),t.toLowerCase()===QueryDatatype.Int.toString()&&(u.toLowerCase()===QueryOperator.Between.toString()||u.toLowerCase()===QueryOperator.NotBetween.toString())&&(l.css("display","none"),this.getTxtColTag2(n,t).css("display","table-cell"),this.getTxtColTag2(n,t).find("input").css("display","block")),e.css("display","none")):this.isDate(t)&&(u.toLowerCase()===QueryDatatype.Date.toString()?(y.css("display","none"),p.css("display","none"),w.css("display","table-cell"),b.css("display","table-cell")):this.dateTimeFormats.some(function(n){return n.value===u})&&(e.css("display","none"),this.getDateColumnTag(n).css("display","table-cell"),this.getDateColumnTag(n).find("input").css("display","block"))))}},n.prototype.parameterChangeEvent=function(n,t){var u=this,f=this.getParamDropDownSelectionValue(n),i,r;this.parameterName=t.value;i=t.model.dataSource.filter(function(n){return n.value===u.parameterName});r={Name:this.parameterName,Id:i.length>0?i[0].parameterID:this.parameterName};f.data("ParameterInfos",r)},n.prototype.parameterBtwChangeEvent=function(n,t){var u=this,f=this.getParamBtwDropDownSelectionValue(n),i,r;this.endParameterName=t.value;i=t.model.dataSource.filter(function(n){return n.value===u.endParameterName});r={Name:this.endParameterName,Id:i.length>0?i[0].parameterID:this.endParameterName};f.data("ParameterInfos",r)},n.prototype.dateFormats=function(n){var t;switch(n){case"Date Time":t=DateTimeFormat.Default;break;case"Date Hour":t=DateTimeFormat.DateHour;break;case"Month Year":t=DateTimeFormat.MonthYear;break;case"Week Year":t=DateTimeFormat.WeekYear;break;case"Quarter Year":t=DateTimeFormat.QuarterYear;break;case"Day Month Year":t=DateTimeFormat.DayMonthYear;break;case"Month Day Year":t=DateTimeFormat.MonthDayYear;break;case"Day of Week":t=DateTimeFormat.DayOfWeek;break;case"Week of Year":t=DateTimeFormat.WeekOfYear;break;case"Hours":t=DateTimeFormat.Hour;break;case"Minutes":t=DateTimeFormat.Minute;break;case"Seconds":t=DateTimeFormat.Second;break;default:t=n}return t},n.prototype.generateListDataSource=function(n){for(var i=[],t=0;t<n.length;t++)i.push({id:"item"+t,text:n[t]});return i},n.prototype.renderFields=function(n,t,i,r){var f=BoldBIDashboard.buildTag("table","",{width:"100%","background-color":"#F9F9F9","padding-bottom":"2px","padding-top":"2px"},{}),u=BoldBIDashboard.buildTag("tr","",{},{}),e=BoldBIDashboard.buildTag("td","",{width:"10px","padding-left":"10px"},{}),o=BoldBIDashboard.buildTag("input","",{},{type:"text",id:n+"_query_"+r+"_operator"});t.append(f);f.append(u);u.append(e);e.append(o);o.BoldBIDashboardDropDownList({dataSource:this.isDate(i)?this.dateTimeFormats:this.getOperatorsList(r),fields:{text:"text",value:"value"},enabled:!0,change:this.bbdesigner$.proxy(this.onOperatorChange,this,n,r),width:"130px",height:"26px",popupWidth:"auto",selectedIndex:0,showRoundedCorner:!0,cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-dbrd-control"});(this.isNumber(i)||this.isString(i))&&this.renderStringFields(n,u,i,r);this.isDate(i)&&this.renderDateFields(n,u,i,r);this.isValueUpdated=!1},n.prototype.onOperatorChange=function(n,t,i){var u,f,c,l;if(i.isInteraction){u=this.getOperatorDrpDwn(n,t).data("BoldBIDashboardDropDownList").getSelectedValue();this.setDefaultValues(n,t,u);var e=this.getTxtValTag1(n,t),a=this.getTxtValTag2(n,t),h=this.getTxtColTag1(n,t),o=this.getTxtColTag2(n,t),v=this.rootNode.find("#"+n+"_query_int_null"),s=this.getNullTxtBxTag(n),y=this.getNullChkBx(n).data("BoldBIDashboardCheckBox"),r=this.multiSelectionComboBox.getMultiSelectionComboBox(n);r.removeAttr("data-fieldValue");r.removeAttr("data-fieldText");r.removeAttr("data-dateFormat");this.rootNode.find("#"+n+" .e-error-tip").css("display","none");t.toLowerCase()===QueryDatatype.Int.toString()?u.toLowerCase()===QueryOperator.Between.toString()||u.toLowerCase()===QueryOperator.NotBetween.toString()?(o.css({display:"table-cell"}),h.css({"padding-left":"10px"}),e.css({display:"block",width:"67px"}),a.css({display:"block",width:"71px"}),v.css({"padding-left":"15px"}),s.css("display","none")):(r.css("display","none"),o.css("display","none"),h.css({"padding-left":"10px"}),y.isChecked()?(e.css("display","none"),s.css("display","block")):(s.css("display","none"),e.css({display:"block",width:"134px"}))):t.toLowerCase()===QueryDatatype.Char.toString()?u.toLowerCase()==="inclusion"?(e.css("display","none"),o.css("display","none"),r.css("display","block"),f=this.getDrpDwn1(n).data("BoldBIDashboardDropDownList"),r.attr({"data-fieldValue":f.getSelectedValue(),"data-fieldText":f.model.text,"data-dateFormat":null}),r.find("div:first").text().toLowerCase()!=="all"&&r.find("div:first").html("All")):(e.css("display","block"),o.css("display","none"),r.css("display","none")):t.toLowerCase()===QueryDatatype.Date.toString()&&(u.toLowerCase()==="date"?(r.css("display","none"),this.getDateRangeDrpDwn(n).css("display","block"),this.dateRangePopup.resetDateRangeDrpDwn(n)):(this.getDateRangeDrpDwn(n).css("display","none"),r.css("display","block"),f=this.getDrpDwn1(n).data("BoldBIDashboardDropDownList"),r.attr({"data-fieldValue":f.getSelectedValue(),"data-fieldText":this.bbdesigner$(f).text(),"data-dateFormat":u}),c={IsCheckAll:!0,IsInclude:!0,FilterValues:null},l=this.multiSelectionComboBox.getMultiSelectionComboBox(n),l.parent().data("MultiSelectionComboBox").populateMultiSelectionItem(n,c)))}},n.prototype.addQueryFilter=function(){this.renderQueryFilterRow()},n.prototype.deleteFilter=function(n){this.containerDiv.context.children[n].remove()},n.prototype.deleteQueryFilter=function(n){var r=n.parent(),f;if(n.remove(),r.children().length>0){var t=r.children().first(),i=t.attr("id"),u=t.find("#"+i+"_query_operator_type_div");u.length>0&&(f=t.find("#"+i+"_query_container_table"),t.css("padding","6px 4px 14px 4px"),f.css({top:"",position:""}),t.find("#"+i+"_query_empty_cell").parent().remove(),u.remove())}this.dashboardDesigner.element.find("#"+n.attr("rowId")+"_popup_container").remove();this.dashboardDesigner.element.find("#"+n.attr("rowId")+"_dateRange_popup").remove();this.scrollerRefresh(this.parentDiv)},n.prototype.onDropDownChange=function(n,t,i){if(i.isInteraction){this.dashboardDesigner.element.find(".e-error-tip").css("display","none");this.resetQueryFields(n);var f=this.rootNode.find("#"+n+"_query_container_cell"),e=this.getDrpDwn1(n).data("BoldBIDashboardDropDownList").getSelectedItem(),o=this.bbdesigner$(e).text(),r=this.getSelectedValue(o),u=r.typeName;u=BoldBIDashboard.isNullOrUndefined(r.typeCast)||r.typeCast.length===0||this.isDefaultCast(r.typeCast)?u:r.typeCast;this.isValueUpdated=!0;this.renderInputField(u,n,f)}},n.prototype.onNullCheck=function(n,t){var u=this.getTxtValTag1(n,QueryDatatype.Int.toString()),f=this.getTxtValTag2(n,QueryDatatype.Int.toString()),e=this.getTxtColTag2(n,QueryDatatype.Int.toString()),r=this.getOperatorDrpDwn(n,QueryDatatype.Int.toString()).data("BoldBIDashboardDropDownList"),i=r.getSelectedValue(),o=this.getNullTxtBxTag(n),s=this.oprtrListForNullOption();t.isInteraction&&(t.isChecked?(u.css("display","none"),f.css("display","none"),e.css("display","none"),o.css("display","block")):(o.css("display","none"),f.css("display","none"),e.css("display","none"),u.css({display:"block",width:"134px"})),r.setModel({dataSource:t.isChecked?s:this.getOperatorsList(QueryDatatype.Int.toString()),selectedIndex:0,fields:{text:"text",value:"value"}}),i=i===NumberFilterOption.Equals||i===NumberFilterOption.NotEquals?i:NumberFilterOption.Equals,r.selectItemByValue(i))},n.prototype.oprtrListForNullOption=function(){return[{text:"Equals",value:"Equals"},{text:"Does Not Equals",value:"DoesNotEquals"}]},n.prototype.textFocus=function(n,t,i){t.toLowerCase()==="focusin"?(n.val()==="0"||n.val()==="0.00")&&n.val(""):t.toLowerCase()==="focusout"&&(i==="System.Int32"||i==="System.Int16"||i==="System.Int64"||i==="System.Byte"?n.val(n.val().length===0?"0":n.val()):(i==="System.Double"||i.toLowerCase()==="number"||i==="System.Single"||i==="System.Decimal")&&n.val(n.val().length===0?"0.00":n.val()))},n.prototype.conditionCheck=function(n){var t=this.getChkBx1(n).data("BoldBIDashboardCheckBox"),i=this.getChkBx2(n).data("BoldBIDashboardCheckBox"),r=this.getChkBx3(n).data("BoldBIDashboardCheckBox"),u=this.rootNode.find("#"+n+QueryDatatype.Bool.toString()+"_chck_on").is(":checked");return t.isChecked()&&i.isChecked()&&r.isChecked()&&!u?!0:!t.isChecked()&&!i.isChecked()&&!r.isChecked()?!0:!1},n.prototype.validateTxtBox=function(n,t,i){var r=i.keyCode,u;if(t==="System.Int32"||t==="System.Int16"||t==="System.Int64"||t==="System.Byte")return r===8||!(r>31)||!(r<48||r>57)||r===45?(u=n.val(),r===45&&u!=="")?!1:!0:!1;if(t==="System.Double"||t==="System.Single"||t==="System.Decimal"||t.toLowerCase()==="number"){if(r===46)return n.val().indexOf(".")===-1?!0:!1;if(!(r===8)&&r>31&&(r<48||r>57)&&!(r===45))return!1}},n.prototype.validateBoolValues=function(n,t,i){var r="";return n?(t.addClass("bbi-designer-error").addClass("bbi-designer-error-radius"),r+="The filter on "+i+" does not have proper values to filter on. "):t.removeClass("bbi-designer-error").removeClass("bbi-designer-error-radius"),r},n.prototype.updateHighlighter=function(n,t){t?n.find(".e-in-wrap e-box e-padding").addClass("bbi-designer-error").addClass("bbi-designer-error-radius"):n.find(".e-in-wrap e-box e-padding").removeClass("bbi-designer-error").removeClass("bbi-designer-error-radius")},n.prototype.resetQueryFields=function(n){this.rootNode.find("#"+n+"_query_container_cell").empty();this.dashboardDesigner.element.find("#"+n+"_dateRange_popup").remove();this.rootNode.find("#"+n+"_queryFilter_topDiv").empty();this.rootNode.find("#"+n+"_tr_top").css("display","none")},n.prototype.openQueryFilterDialog=function(){this.dashboardDesigner.element.find("#"+this.id+"_query_filter_dialog").data("BoldBIDashboardDialog").open();this.resetQueryFilterDialog();this.dataFields=this.getAvailableDataFields();this.queryFilters=this.queryDesigner.queryFilter;this.populateQueryFilter(this.queryFilters)},n.prototype.closeDialog=function(){this.multiSelectionComboBox.hideMultiSelectionWaitingPopup(!0);this.dashboardDesigner.element.find("#"+this.id+"_query_filter_dialog").data("BoldBIDashboardDialog").close()},n.prototype.closePopup=function(){this.dashboardDesigner.element.find(".bbi-daterange-popup:visible").css("display","none");this.dashboardDesigner.element.find(".e-multiselect-popup-container").css("display","none")},n.prototype.resetQueryFilterDialog=function(){this.dataFields=[];this.parameters=[];this.containerDiv.empty();this.scrollerRefresh(this.parentDiv)},n.prototype.populateQueryFilter=function(n){var t,i,r,u,f,e;for(this.multiSelectionComboBox.filters=n,this.parameterList=this.dashboardDesigner.modules.storeParameter.getParameterDataSource(),t=0;t<n.length;t++)i=this.renderQueryFilterRow(n[t]),this.multiSelectionComboBox.filters[t].rowId=i,r=n[t].DataType,u=n[t].IsTypeCast,r=u?n[t].TypeCastValue:r,t>0&&(f=n[t].OperatorType,this.getOperatorTypeDropDown(i).data("BoldBIDashboardDropDownList").selectItemByValue(f)),this.isNumber(r)?this.populateIntField(i,n[t]):this.isBoolean(r)?this.populateBoolFilter(i,n[t]):this.isString(r)?this.populateStringField(i,n[t]):this.isDate(r)&&(e=this.getOperatorDrpDwn(i,"date").data("BoldBIDashboardDropDownList").getSelectedValue(),this.populateDateFields(i,n[t]),this.populateDateRangeParameterValues(i,"date",e))},n.prototype.getFieldText=function(n){if(this.dataFields&&this.dataFields.length>0)for(var t=0;t<this.dataFields.length;t++)if(this.dataFields[t].value===n)return this.dataFields[t].text},n.prototype.populateIntField=function(n,t){var i=t.MeasureFilterSchemaInfo,u=i.FilterValues,r=!BoldBIDashboard.isNullOrUndefined(t.ParameterInfo)&&t.ParameterInfo.IsParamApplied,o=this.getTxtValTag1(n,QueryDatatype.Int.toString()),f=this.getTxtValTag2(n,QueryDatatype.Int.toString()),s=this.getTxtColTag1(n,QueryDatatype.Int.toString()),h=this.getTxtColTag2(n,QueryDatatype.Int.toString()),c=this.rootNode.find("#"+n+"_query_int_null"),l=this.getNullTxtBxTag(n),e=this.getOperatorDrpDwn(n,QueryDatatype.Int.toString()).data("BoldBIDashboardDropDownList"),a=this.getFieldText(i.ColumnId,t.TableName,t.Schema);this.getDrpDwn1(n).data("BoldBIDashboardDropDownList").selectItemByText(a);r||this.getTxtValTag1(n,QueryDatatype.Int.toString()).val(u[0]);(i.MeasureFilterCondition.toLowerCase()===QueryOperator.Between.toString()||i.MeasureFilterCondition.toLowerCase()===QueryOperator.NotBetween.toString())&&(h.css({display:"none"}),s.css({"padding-left":"10px"}),o.css({display:r?"none":"block",width:"67px"}),f.css({display:r?"none":"block",width:"71px"}),c.css({"padding-left":"15px"}),l.css("display","none"),r||(this.getTxtColTag2(n,QueryDatatype.Int.toString()).css("display","table-cell"),f.val(u[1])));this.getNullChkBx(n).data("BoldBIDashboardCheckBox").setModel({checked:i.IsIncludeNull});this.getTxtValTag1(n,QueryDatatype.Int.toString()).css("display",i.IsIncludeNull?"none":"block");this.rootNode.find("#"+n+"_query_null_txt").css("display",i.IsIncludeNull?"block":"none");e.setModel({dataSource:i.IsIncludeNull?[{text:"Equals",value:"Equals"},{text:"Does Not Equals",value:"DoesNotEquals"}]:this.getOperatorsList(QueryDatatype.Int.toString()),selectedIndex:0,fields:{text:"text",value:"value"}});e.selectItemByValue(i.MeasureFilterCondition)},n.prototype.populateStringField=function(n,t){var r=this.getTxtValTag1(n,QueryDatatype.Char.toString()),f=this.getTxtColTag2(n,QueryDatatype.Char.toString()),u=this.multiSelectionComboBox.getMultiSelectionComboBox(n),i=t.DimensionFilterSchemaInfo,e=this.getFieldText(t.Id,t.TableName,t.Schema),o={FilterValues:i.FilterValues,IsInclude:i.IsInclude,IsCheckAll:i.IsCheckAll,CheckAllState:i.CheckAllState,IsParamApplied:i.IsParamApplied,ParameterName:i.ParameterName};u.parent().data("MultiSelectionComboBox").populateMultiSelectionItem(n,o);this.getDrpDwn1(n).data("BoldBIDashboardDropDownList").selectItemByText(e);this.getOperatorDrpDwn(n,QueryDatatype.Char.toString()).data("BoldBIDashboardDropDownList").selectItemByValue(i.DimensionFilterCondition);i.DimensionFilterCondition.toLowerCase()===DimensionFilterCondition.Inclusion.toString().toLowerCase()?(r.css("display","none"),f.css("display","none"),u.css("display","block")):(u.css("display","none"),r.css("display","block"),i.FilterValues&&i.FilterValues[0]&&r.val(i.FilterValues[0]));this.rootNode.find("#"+n+QueryDatatype.Char.toString()+"_chck_on").prop("checked",i.IsTopNApplied);i.IsTopNApplied&&(this.rootNode.find("#"+n+"_tr_top").css("display","table-row"),this.populateTopFields(n,i.TopNFilterConditionInfo,t,QueryDatatype.Char.toString()))},n.prototype.populateTopFields=function(n,t,i,r){var u=t,o,s;if(u){o=u.TopNCondition===0||u.TopNCondition==="Top"?"Top":"Bottom";this.getTopModeItem(n,r).data("BoldBIDashboardDropDownList").selectItemByText(o);this.getTopCountItem(n,r).data("ejNumericTextbox").setModel({value:u.NumberOfItems});s=this.getFieldText(u.ColumnId,i.TableName,i.Schema);this.getTopColumnItem(n,r).data("BoldBIDashboardDropDownList").selectItemByText(s);var f=this.getTopSummaryItem(n,r),e=this.getTopFormatItem(n,r),h=u.SummaryType;u.IsFormatAppliedForDateField?(this.getCheckBoxCell(n,r).css({display:"block","padding-top":"3px"}),this.getTopDateTimeItem(n,r).data("BoldBIDashboardCheckBox").setModel({checked:u.IsFormatAppliedForDateField}),e.css("display","block"),f.css("display","none"),e.data("BoldBIDashboardDropDownList").selectItemByValue(u.DateAndTimeFormat)):(e.css("display","none"),f.css("display","block"),f.data("BoldBIDashboardDropDownList").selectItemByValue(h))}},n.prototype.populateDateFields=function(n,t){var i=t.DateFilterSchemaInfo,f=this.getOperatorDrpDwn(n,QueryDatatype.Date.toString()).data("BoldBIDashboardDropDownList"),e=this.getFieldText(t.Id,t.TableName,t.Schema),u,r;this.getDrpDwn1(n).data("BoldBIDashboardDropDownList").selectItemByText(e);this.rootNode.find("#"+n+QueryDatatype.Date.toString()+"_chck_on").prop("checked",i.IsTopNApplied);i.IsTopNApplied&&(this.rootNode.find("#"+n+"_tr_top").css("display","table-row"),this.populateTopFields(n,i.TopNFilterConditionInfo,t,QueryDatatype.Date.toString()));i.DateAndTimeFormatCondition.toLowerCase()===QueryDatatype.Date.toString()?(this.multiSelectionComboBox.getMultiSelectionComboBox(n).css("display","none"),this.getDateRangeDrpDwn(n).css("display","block"),this.dateRangePopup.populateDateRangePopup(n,i.DateFormatInfo)):(u={FilterValues:i.FilterValues,IsInclude:i.IsInclude,IsCheckAll:i.IsCheckAll,CheckAllState:i.CheckAllState},r=this.multiSelectionComboBox.getMultiSelectionComboBox(n),r.parent().data("MultiSelectionComboBox").populateMultiSelectionItem(n,u),r.attr({"data-dateFormat":i.DateAndTimeFormatCondition}));f.selectItemByValue(i.DateAndTimeFormatCondition)},n.prototype.populateBoolFilter=function(n,t){var i=t.BooleanFilterSchemaInfo,r=this.getFieldText(t.Id,t.TableName,t.Schema);this.getDrpDwn1(n).data("BoldBIDashboardDropDownList").selectItemByText(r);this.rootNode.find("#"+n+QueryDatatype.Bool.toString()+"_chck_on").prop("checked",i.IsTopNApplied);this.getChkBx1(n).data("BoldBIDashboardCheckBox").setModel({checked:i.IsNullEnabled});this.getChkBx2(n).data("BoldBIDashboardCheckBox").setModel({checked:i.IsTrueEnabled});this.getChkBx3(n).data("BoldBIDashboardCheckBox").setModel({checked:i.IsFalseEnabled});i.IsTopNApplied&&(this.rootNode.find("#"+n+"_tr_top").css("display","table-row"),this.populateTopFields(n,i.TopNFilterConditionInfo,t,QueryDatatype.Bool.toString()))},n.prototype.getQueryFilter=function(){var t=this,u=[],n={},r,i="",o=this.dateTimeFormats,f=!1,s=this.rootNode.find("#"+this.id+"_query_container_div .bbi-designer-query-row"),h=this,e=this.bbdesigner$;return s.each(function(s,c){var l=new InitialFilterInfo,v=e(c).attr("id"),a=!1,b=t.rootNode.find("#"+v+"_query_filter_field_container"),g=t.getDrpDwn1(v).data("BoldBIDashboardDropDownList").getSelectedItem(),w=t.getDrpDwn1(v).data("BoldBIDashboardDropDownList").getSelectedValue(),nt=e(g).text(),y=t.getSelectedValue(nt),k=BoldBIDashboard.isNullOrUndefined(y.typeCast)||y.typeCast.length===0||t.isDefaultCast(y.typeCast),p,d;r=k?y.typeName:y.typeCast;p=y.columnName;l.Name=p;l.Id=w;t.isNumber(r)?(n=t.getIntVal(v),l.ParameterInfo=t.getInitialDashboardParamInfo(n),l.Type=BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(InitialFilterType,InitialFilterType.Measure),l.MeasureFilterSchemaInfo={ColumnName:p,ColumnId:w,MeasureFilterCondition:n.MeasureFilterCondition,FilterValues:n.FilterValues,IsIncludeNull:n.IsIncludeNull},a=l.ParameterInfo.IsParamApplied?t.checkParamHasError("int",n.MeasureFilterCondition,l.ParameterInfo.ParameterName,l.ParameterInfo.EndParameterName):!1,t.updateHighlighter(b,a),a&&(i+="Select values to apply filter.")):t.isBoolean(r)?(n=t.getBoolVal(v),l.Type=BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(InitialFilterType,InitialFilterType.Boolean),l.BooleanFilterSchemaInfo={ColumnName:p,ColumnId:w,IsTrueEnabled:n.IsTrueEnabled,IsNullEnabled:n.IsNullEnabled,IsFalseEnabled:n.IsFalseEnabled,IsTopNApplied:n.IsTopNApplied,TopNFilterConditionInfo:n.TopNFilterConditionInfo},a=t.conditionCheck(v),i+=t.validateBoolValues(a,b,y.value)):t.isString(r)?(n=t.getStringVal(v),l.ParameterInfo=t.getInitialDashboardParamInfo(n),l.Type=BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(InitialFilterType,InitialFilterType.Dimension),l.DimensionFilterSchemaInfo={ColumnName:p,ColumnId:w,DimensionFilterCondition:n.DimensionFilterCondition,FilterValues:n.FilterValues,IsInclude:n.IsInclude,IsCheckAll:n.IsCheckAll,IsTopNApplied:n.IsTopNApplied,CheckAllState:n.CheckAllState,TopNFilterConditionInfo:n.TopNFilterConditionInfo},a=!n.IsTopNApplied&&n.IsCheckAll&&n.DimensionFilterCondition.toLowerCase()===DimensionFilterCondition.Inclusion.toString().toLowerCase(),a=l.ParameterInfo.IsParamApplied?t.checkParamHasError("string",null,l.ParameterInfo.ParameterName,null):a,t.updateHighlighter(b,a),a&&(i+=t.locale.errorMessage.formattedValueInvalid)):t.isDate(r)&&(n=t.getDateVal(v),l.ParameterInfo=t.getInitialDashboardParamInfo(n),l.Type=BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(InitialFilterType,InitialFilterType.Date),l.DateFilterSchemaInfo={ColumnName:p,ColumnId:w,DateAndTimeFormatCondition:n.DateAndTimeFormatCondition,FilterValues:n.FilterValues,IsInclude:n.IsInclude,IsCheckAll:n.IsCheckAll,IsTopNApplied:n.IsTopNApplied,CheckAllState:n.CheckAllState,TopNFilterConditionInfo:n.TopNFilterConditionInfo,DateFormatInfo:!BoldBIDashboard.isNullOrUndefined(n.DateFormatInfo)&&!n.DateFormatInfo.IsFilterApplied?null:n.DateFormatInfo},l.DateFilterSchemaInfo.DateFormatInfo=l.ParameterInfo.IsParamApplied?n.DateFormatInfo:l.DateFilterSchemaInfo.DateFormatInfo,a=!n.IsTopNApplied&&(n.IsCheckAll&&n.DateAndTimeFormatCondition.toLowerCase()!=="date"||BoldBIDashboard.isNullOrUndefined(l.DateFilterSchemaInfo.DateFormatInfo)&&n.DateAndTimeFormatCondition.toLowerCase()==="date"),a=l.ParameterInfo.IsParamApplied&&o.some(function(t){return t.value===n.DateAndTimeFormatCondition})?t.checkParamHasError(n.DateAndTimeFormatCondition,n.DateFormatInfo.DateFormatCondition,l.ParameterInfo.ParameterName,l.ParameterInfo.EndParameterName):a,t.updateHighlighter(b,a),a&&(i+="Select values to apply filter."));d=t.getOperatorTypeDropDown(v);l.OperatorType=BoldBIDashboard.isNullOrUndefined(d)||d.length<1?OperatorType.And:h.getOperatorTypeDropDown(v).data("BoldBIDashboardDropDownList").getSelectedValue();l.Schema=y.schema;l.rowId=v;l.DataType=y.typeName;l.TableName=y.table;l.TableId=y.tableId;l.IsTypeCast=k?!1:!0;l.TypeCastValue=k?"":y.typeCast;u.push(l);BoldBIDashboard.DashboardUtil.showErrIndictor(t.rootNode.find("#"+v+"_query_error_td"),a,i);a?(i="",f=!0):BoldBIDashboard.DashboardUtil.showErrIndictor(t.rootNode.find("#"+v+"_query_error_td"),!1,i)}),{queryFilters:u,hasErrors:f}},n.prototype.checkParamHasError=function(n,t,i,r){var u=!BoldBIDashboard.isNullOrUndefined(t)&&(t==="Between"||t==="NotBetween");if(n==="int")return u?BoldBIDashboard.isNullOrUndefined(i)||i===""||BoldBIDashboard.isNullOrUndefined(r)||r==="":BoldBIDashboard.isNullOrUndefined(i)||i==="";if(n==="string")return BoldBIDashboard.isNullOrUndefined(i)||i==="";if(n.toLowerCase()==="date"){if(t==="Range")return BoldBIDashboard.isNullOrUndefined(i)||i===""||BoldBIDashboard.isNullOrUndefined(r)||r==="";if(t==="StartDate")return BoldBIDashboard.isNullOrUndefined(i)||i==="";if(t==="EndDate")return BoldBIDashboard.isNullOrUndefined(r)||r===""}else if(this.dateTimeFormats.some(function(t){return t.value===n}))return BoldBIDashboard.isNullOrUndefined(i)||i==="";return!1},n.prototype.getInitialDashboardParamInfo=function(n){return{IsParamApplied:n.SelectionType==="Parameters",ParameterName:n.ParameterName,EndParameterName:n.EndParameterName,RangeValueOfFirstParam:n.RangeValueOfFirstParam,RangeValueOfSecondtParam:n.RangeValueOfSecondtParam}},n.prototype.getRangeParamNames=function(n){return/.START/.test(n)?".START":/.END/.test(n)?".END":null},n.prototype.getIntVal=function(n){var t,i,f=[],o=this.getParamDropDownSelectionValue(n),s=this.getParamBtwDropDownSelectionValue(n),r=o.data("ParameterInfos"),u=s.data("ParameterInfos"),h=o.data("selectedType"),c=this.getNullChkBx(n).data("BoldBIDashboardCheckBox").isChecked(),e=this.getOperatorDrpDwn(n,QueryDatatype.Int.toString()).data("BoldBIDashboardDropDownList").getSelectedValue();return t=this.getTxtValTag1(n,QueryDatatype.Int.toString()).val(),t=t==="0.00"?0:t,(e.toLowerCase()===QueryOperator.Between.toString()||e.toLowerCase()===QueryOperator.NotBetween.toString())&&(i=this.getTxtValTag2(n,QueryDatatype.Int.toString()).val()),i=i==="0.00"?0:i,f.push(t),f.push(i),{MeasureFilterCondition:e,FilterValues:f,IsIncludeNull:c,SelectionType:h,ParameterName:BoldBIDashboard.isNullOrUndefined(r)?null:r.Id,EndParameterName:BoldBIDashboard.isNullOrUndefined(u)?null:u.Id,RangeValueOfFirstParam:BoldBIDashboard.isNullOrUndefined(r)?null:this.getRangeParamNames(r.Name),RangeValueOfSecondtParam:BoldBIDashboard.isNullOrUndefined(u)?null:this.getRangeParamNames(u.Name)}},n.prototype.getDateVal=function(n){var h="",c="",l=null,r=null,u=null,a="",v="",f="",y=!1,t,e="",p=this.getTopSwitcherTag(n,QueryDatatype.Date.toString()).is(":checked"),o=[],s=!1,w=!1,b=!0,i,k,d;return e=this.getParamDropDownSelectionValue(n).data("selectedType"),i=this.getOperatorDrpDwn(n,QueryDatatype.Date.toString()).data("BoldBIDashboardDropDownList").getSelectedValue(),this.dateTimeFormats.some(function(n){return n.value===i})&&i.toLowerCase()!==QueryDatatype.Date.toString()?(l=this.getParamDropDownSelectionValue(n),r=l.data("ParameterInfos"),f=DateFormatOption.Range.toString()):(a=this.dashboardDesigner.element.find("#"+n+"_date_Start_param").data("ParameterInfos"),v=this.dashboardDesigner.element.find("#"+n+"_date_End_param").data("ParameterInfos"),f=DateFormatOption.Range.toString()),i.toLowerCase()===QueryDatatype.Date.toString()?(t=this.dateRangePopup.getDateRangeValues(n),h=t.StartDate,c=t.EndDate,y=t.IsFilterApplied,f=t.DateFormatCondition,r=t.DateFormatCondition===DateFormatOption.Range.toString()||t.DateFormatCondition===DateFormatOption.StartDate.toString()?a:null,u=t.DateFormatCondition===DateFormatOption.Range.toString()||t.DateFormatCondition===DateFormatOption.EndDate.toString()?v:null):this.dateTimeFormats.some(function(n){return n.value===i})&&i.toLowerCase()!==QueryDatatype.Date.toString()&&(o=[],s=!0),e=="Custom"&&(k=this.multiSelectionComboBox.getMultiSelectionComboBox(n),t=k.parent().data("MultiSelectionComboBox").getPopupContainerInformation(n),BoldBIDashboard.isNullOrUndefined(t)||(o=t.FilterValues,s=t.IsInclude,w=t.IsCheckAll,b=t.CheckAllState)),d=p?this.getTopNVal(n,QueryDatatype.Date.toString()):{},{DateAndTimeFormatCondition:i,IsInclude:s,FilterValues:o,IsCheckAll:w,CheckAllState:b,IsTopNApplied:p,TopNFilterConditionInfo:d,SelectionType:e,ParameterName:BoldBIDashboard.isNullOrUndefined(r)?null:r.Id,EndParameterName:BoldBIDashboard.isNullOrUndefined(u)?null:u.Id,StartParamFormat:"",EndParamFormat:"",RangeValueOfFirstParam:BoldBIDashboard.isNullOrUndefined(r)?null:this.getRangeParamNames(r.Name),RangeValueOfSecondtParam:BoldBIDashboard.isNullOrUndefined(u)?null:this.getRangeParamNames(u.Name),DateFormatInfo:{DateFormatCondition:f,StartDate:h,EndDate:c,IsFilterApplied:y}}},n.prototype.getStringVal=function(n){var f=this.getOperatorDrpDwn(n,QueryDatatype.Char.toString()).data("BoldBIDashboardDropDownList").getSelectedValue(),e,u=[],o=!1,s=!1,t,h=!0,c=this.getTopSwitcherTag(n,QueryDatatype.Char.toString()).is(":checked"),l=this.getParamDropDownSelectionValue(n),y=this.getParamBtwDropDownSelectionValue(n),i=l.data("ParameterInfos"),r=y.data("ParameterInfos"),p=l.data("selectedType"),a,v;return f.toLowerCase()===DimensionFilterCondition.Inclusion.toString().toLowerCase()?(a=this.multiSelectionComboBox.getMultiSelectionComboBox(n),t=a.parent().data("MultiSelectionComboBox").getPopupContainerInformation(n),BoldBIDashboard.isNullOrUndefined(t)||(u=t.FilterValues,o=t.IsInclude,s=t.IsCheckAll,h=t.CheckAllState)):(e=this.getTxtValTag1(n,QueryDatatype.Char.toString()).val(),u.push(e)),v=c?this.getTopNVal(n,QueryDatatype.Char.toString()):{},{DimensionFilterCondition:f,FilterValues:u,TopNFilterConditionInfo:v,IsInclude:o,IsCheckAll:s,IsTopNApplied:c,CheckAllState:h,SelectionType:p,ParameterName:BoldBIDashboard.isNullOrUndefined(i)?null:i.Id,EndParameterName:BoldBIDashboard.isNullOrUndefined(r)?null:r.Id,RangeValueOfFirstParam:BoldBIDashboard.isNullOrUndefined(i)?null:this.getRangeParamNames(i.Name),RangeValueOfSecondtParam:BoldBIDashboard.isNullOrUndefined(r)?null:this.getRangeParamNames(r.Name)}},n.prototype.getBoolVal=function(n){var i=this.getChkBx1(n).data("BoldBIDashboardCheckBox"),r=this.getChkBx2(n).data("BoldBIDashboardCheckBox"),u=this.getChkBx3(n).data("BoldBIDashboardCheckBox"),t=this.getTopSwitcherTag(n,QueryDatatype.Bool.toString()).is(":checked"),f=t?this.getTopNVal(n,QueryDatatype.Bool.toString()):{};return{IsNullEnabled:i.isChecked(),IsTrueEnabled:r.isChecked(),TopNFilterConditionInfo:f,IsFalseEnabled:u.isChecked(),IsTopNApplied:t}},n.prototype.getTopNVal=function(n,t){var i=this.getTopColumnItem(n,t).data("BoldBIDashboardDropDownList").getSelectedItem(),r=this.getTopModeItem(n,t).data("BoldBIDashboardDropDownList").getSelectedValue(),u=this.getTopCountItem(n,t).val(),f=this.bbdesigner$(i).text(),e=this.getTopColumnItem(n,t).data("BoldBIDashboardDropDownList").getSelectedValue(),o=this.getTopSummaryItem(n,t).data("BoldBIDashboardDropDownList").getSelectedValue(),s=this.getTopDateTimeItem(n,t).data("BoldBIDashboardCheckBox").isChecked(),h=this.getTopFormatItem(n,t).data("BoldBIDashboardDropDownList").getSelectedValue();return{TopNCondition:r==="Top"?FilterRange.Top:FilterRange.Bottom,NumberOfItems:u,ColumnName:f,ColumnId:e,SummaryType:o,IsFormatAppliedForDateField:s,DateAndTimeFormat:h}},n.prototype.saveQueryFilter=function(){var n=this.getQueryFilter();this.paramNameList=[];n.hasErrors||this.multiSelectionComboBox.isMultiSelectionPopupLoading()||(BoldBIDashboard.DashboardUtil.isEqualObj(this.queryFilters,n.queryFilters)||(this.queryDesigner.queryFilter=n.queryFilters,this.queryDesigner.isInitialFilterApplied=!0,this.queryDesigner.executeUIQuery(),this.queryDesigner.isInitialFilterApplied=!1),this.closeDialog())},n.prototype.renderCodeSwitcher=function(n,t,i){var r=BoldBIDashboard.buildTag("div","",{display:"block",width:"89px"},{id:n+"_query_"+i+"_switcherDiv"}),e=BoldBIDashboard.buildTag("span.bbi-designer-label","TOP N",{display:"inline-block",float:"left","line-height":"normal","margin-right":"7px","margin-top":"2px",cursor:"default"}),u=BoldBIDashboard.buildTag("label.bbi-designer-switch","",{display:"inline-block",float:"left"},{id:n+"_query_"+i+"_chkSwitcher"}),f=this.bbdesigner$("<input type='checkbox' id="+n+i+"_chck_on checked>");u.append(f);u.append("<div style='cursor:pointer;' class='bbi-designer-slider round'/>");f.prop("checked",!1);r.append(e);r.append(u);t.append(r);f.bind("change",this.bbdesigner$.proxy(this.onSwitcherChange,this,n,i))},n.prototype.onSwitcherChange=function(n,t){var i=this.rootNode.find("#"+n+t+"_chck_on").is(":checked"),r=i?"table-row":"none";this.rootNode.find("#"+n+"_tr_top").css("display",r);this.rootNode.find("#"+n+" .e-error-tip").css("display","none");this.scrollerRefresh(this.parentDiv)},n.prototype.renderTopFields=function(n,t){var w=this.rootNode.find("#"+n+"_queryFilter_topDiv"),s=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),h=BoldBIDashboard.buildTag("tr","",{},{}),r,u,i,f,p,e,o;w.append(s);s.append(h);var c=BoldBIDashboard.buildTag("td","",{padding:"0px 5px 0px 10px",width:"130px"},{}),l=BoldBIDashboard.buildTag("td","",{padding:"0px 5px",width:"90px"},{}),a=BoldBIDashboard.buildTag("td","",{padding:"0px 5px",width:"130px"},{}),v=BoldBIDashboard.buildTag("td","",{"padding-left":"5px",display:"none"},{id:n+"_query_"+t+"_checkBox_cell"}),y=BoldBIDashboard.buildTag("td","",{padding:"0px 5px"},{id:n+"_query_"+t+"_format_cell"});h.append(c).append(l).append(a).append(v).append(y);r=BoldBIDashboard.buildTag("input.e-field e-ejinputtext","",{width:"130px"},{type:"text",id:n+"_query_"+t+"_top_mode"});c.append(r);u=BoldBIDashboard.buildTag("input","",{width:"90px"},{type:"text",id:n+"_query_"+t+"_top_count"});l.append(u);i=BoldBIDashboard.buildTag("input.e-field e-ejinputtext","",{width:"130px"},{type:"text",id:n+"_query_"+t+"_top_column"});a.append(i);f=BoldBIDashboard.buildTag("input","",{},{type:"checkbox",id:n+"_query_"+t+"_top_datetime"});p=BoldBIDashboard.buildTag("label","Format",{"margin-left":"10px"},{"for":n+"_query_"+t+"_top_datetime"});v.append(f).append(p);e=BoldBIDashboard.buildTag("input.e-field e-ejinputtext","",{width:"130px"},{type:"text",id:n+"_query_"+t+"_top_summary"});o=BoldBIDashboard.buildTag("input.e-field e-ejinputtext","",{width:"130px"},{type:"text",id:n+"_query_"+t+"_top_format"});y.append(e).append(o);r.BoldBIDashboardDropDownList({width:"130px",dataSource:this.modeTypes,fields:{text:"text",value:"value"},selectedIndex:0,enabled:!0,showRoundedCorner:!0,watermarkText:"Choose Field",cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-dbrd-control"});u.ejNumericTextbox({showSpinButton:!1,decimalPlaces:0,value:5,minValue:1,maxValue:1e10,showRoundedCorner:!0,cssClass:"bbi-designer-ejwidgets bbi-designer-ejwidgets-updown bbi-designer-content-label",width:"90px"});i.BoldBIDashboardDropDownList({width:"130px",dataSource:this.dataFields,fields:{text:"text",value:"value"},enabled:!0,showRoundedCorner:!0,watermarkText:"Choose Field",cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-dbrd-control",change:this.bbdesigner$.proxy(this.updateTopColumnState,this,n,t)});f.BoldBIDashboardCheckBox({width:"100%",change:this.bbdesigner$.proxy(this.updateFormatValidation,this,n,t)});e.BoldBIDashboardDropDownList({width:"130px",dataSource:this.dimensionFormats,fields:{text:"text",value:"value"},selectedIndex:0,enabled:!0,showRoundedCorner:!0,watermarkText:"Choose Field",cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-dbrd-control"});o.BoldBIDashboardDropDownList({width:"130px",dataSource:this.dateTimeformatforTopN,fields:{text:"text",value:"value"},selectedIndex:0,enabled:!0,showRoundedCorner:!0,watermarkText:"Choose Field",cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-dbrd-control"});i.data("BoldBIDashboardDropDownList").setModel({selectedIndex:0});this.rootNode.find("#"+n+"_query_"+t+"_top_format_wrapper").css("display","none")},n.prototype.renderNullField=function(n,t){var i=BoldBIDashboard.buildTag("td","",{width:"91px","padding-bottom":"5px"},{id:n+"_query_int_null"}),r=BoldBIDashboard.buildTag("input","",{},{type:"checkbox",id:n+"_queryint_nullChkbx"}),u=BoldBIDashboard.buildTag("Label","Include Null",{"padding-left":"8px","font-size":"12px","font-weight":"600","vertical-align":"middle"},{type:"checkbox",id:n+"_queryint_nullChkbx"});t.append(i);i.append(r);i.append(u);r.BoldBIDashboardCheckBox({checked:!1,cssClass:"bbi-designer-param-assign",change:this.bbdesigner$.proxy(this.onNullCheck,this,n)})},n.prototype.getTopModeItem=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_top_mode")},n.prototype.getTopCountItem=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_top_count")},n.prototype.getTopColumnItem=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_top_column")},n.prototype.getTopDateTimeItem=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_top_datetime")},n.prototype.getTopSummaryItem=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_top_summary")},n.prototype.getTopFormatItem=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_top_format")},n.prototype.getCheckBoxCell=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_checkBox_cell")},n.prototype.getFormatCell=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_format_cell")},n.prototype.updateFormatValidation=function(n,t,i){var r=this.rootNode.find("#"+n+"_query_"+t+"_top_summary_wrapper"),u=this.rootNode.find("#"+n+"_query_"+t+"_top_format_wrapper");i.isChecked?(u.css("display","block"),r.css("display","none")):(u.css("display","none"),r.css("display","block"))},n.prototype.updateTopColumnState=function(n,t,i){var f=this.getTopSummaryItem(n,t),o=this.rootNode.find("#"+n+"_query_"+t+"_top_format_wrapper"),r=this.getSelectedItem(i.value),e=r.typeName,u;e=BoldBIDashboard.isNullOrUndefined(r.typeCast)||r.typeCast.length===0||this.isDefaultCast(r.typeCast)?e:r.typeCast;this.isDate(e)?(this.getCheckBoxCell(n,t).css({display:"block","padding-top":"3px"}),u=this.getTopDateTimeItem(n,t).data("BoldBIDashboardCheckBox").model.checked,this.rootNode.find("#"+n+"_query_"+t+"_top_summary_wrapper").css("display",u?"none":"block"),o.css("display",u?"block":"none"),u||(f.data("BoldBIDashboardDropDownList").setModel({dataSource:u?this.dateTimeformatforTopN:this.dimensionFormats}),f.data("BoldBIDashboardDropDownList").setModel({selectedIndex:0}))):(this.getCheckBoxCell(n,t).css("display","none"),f.data("BoldBIDashboardDropDownList").setModel({dataSource:this.isNumber(e)?this.measureFormats:this.dimensionFormats}),f.data("BoldBIDashboardDropDownList").setModel({selectedIndex:0}),this.rootNode.find("#"+n+"_query_"+t+"_top_summary_wrapper").css("display","block"),o.css("display","none"))},n.prototype.getTableData=function(n,t){for(var r,i=0;i<n.length;i++)if(r=this.bbdesigner$(n[i]).data("e-table"),r.name===t)return this.bbdesigner$(n[i]);return this.bbdesigner$(n[0])},n.prototype.getAvailableDataFields=function(){for(var f=this.queryDesigner.element.find("#"+this.id+"_div_dragSurface .bbi-data-table"),i=[],n=0;n<this.queryDesigner.tableType.length;n++)if(this.queryDesigner.tableType[n].DataType!=="UnSupport"){var r=this.getTableData(f,this.queryDesigner.tableType[n].TableName),u=this.bbdesigner$(r).data("e-table"),t=this.queryDesigner.tableType[n].DataType,e=BoldBIDashboard.DashboardUtil.escapeSelector(this.queryDesigner.tableType[n].Name),o=this.bbdesigner$(r).find("#"+this.id+"_li_"+e).attr("e-column-type");t!=="geography"&&t!=="hierarchyid"&&t!=="xml"&&i.push({text:this.queryDesigner.tableType[n].Name,value:this.queryDesigner.tableType[n].ID,columnName:this.queryDesigner.tableType[n].Name,typeName:this.getTypeName(t),table:u.name,schema:u.schema,typeCast:o,tableId:this.queryDesigner.tableType[n].TableId})}return i},n.prototype.getTypeName=function(n){var t=n.toLowerCase();return t==="int"||t==="integer"?"System.Int32":t==="nchar"||t==="ntext"||t==="nvarchar"||t==="text"||t==="varchar"||t==="char"||t==="string"?"System.String":t==="decimal"||t==="money"||t==="smallmoney"||t==="numeric"?"System.Decimal":t==="float"?"System.Double":t==="smallint"?"System.Int16":t==="bigint"?"System.Int64":t==="real"?"System.Single":t==="tinyint"?"System.Byte":t==="uniqueidentifier"?"System.Guid":t==="datetime"||t==="datetime2"||t==="smalldatetime"||t==="date"?"System.DateTime":t==="datetimeoffset"?"System.DateTimeOffset":t==="bit"||t==="boolean"?"System.Boolean":t!=="timestamp"&&t==="time"?"System.TimeSpan":void 0},n.prototype.getCurrentIndex=function(){var t=this.rootNode.find("#"+this.id+"_query_container_div .bbi-designer-query-row"),i,n;return t.length>0?(i=this.rootNode.find("#"+this.id+"_query_container_div .bbi-designer-query-row")[t.length-1].id,n=this.getDrpDwn1(i).data("BoldBIDashboardDropDownList").option("selectedIndex"),n>=this.dataFields.length-1?0:n+1):0},n.prototype.getSelectedItem=function(n){for(var t=0;t<this.dataFields.length;t++)if(n===this.dataFields[t].value)return this.dataFields[t]},n.prototype.getSelectedValue=function(n){for(var t=0;t<this.dataFields.length;t++)if(n===this.dataFields[t].text)return this.dataFields[t]},n.prototype.setItemDataSource=function(){this.dateTimeFormats=[{value:"Year",text:"Year"},{value:"Quarter",text:"Quarter"},{value:"Month",text:"Month"},{value:"MonthYear",text:"Month Year"},{value:"WeekYear",text:"Week Year"},{value:"QuarterYear",text:"Quarter Year"},{value:"DayMonthYear",text:"Day Month Year"},{value:"MonthDayYear",text:"Month Day Year"},{value:"DateHour",text:"Date Hour"},{value:"DayOfWeek",text:"Day of Week"},{value:"WeekOfYear",text:"Week of Year"},{value:"Day",text:"Day"},{value:"Hour",text:"Hours"},{value:"Minute",text:"Minutes"},{value:"Second",text:"Seconds"},{value:"Time",text:"Time"},{value:"Date",text:"Date"},];this.dateTimeformatforTopN=this.getDateTimeFormatsForTopN();this.dimensionFormats=[{value:"COUNT",text:"Count"},{value:"COUNTD",text:"Distinct Count"}];this.measureFormats=[{value:"SUM",text:"Sum"},{value:"COUNT",text:"Count"},{value:"COUNTD",text:"Distinct Count"},{value:"MAX",text:"Max"},{value:"MIN",text:"Min"},{value:"AVG",text:"Avg"},{value:"NONE",text:"None"}];this.modeTypes=[{value:"Top",text:"Top"},{value:"Bottom",text:"Bottom"}];this.operatorTypes=[{value:"And",text:"AND"},{value:"Or",text:"OR"}]},n.prototype.getDateTimeFormatsForTopN=function(){var n=[];return n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.Date],text:DateTimeFormatForFilter.Date}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.DateTime],text:DateTimeFormatForFilter.DateTime}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.Year],text:DateTimeFormatForFilter.Year}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.Quarter],text:DateTimeFormatForFilter.Quarter}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.Month],text:DateTimeFormatForFilter.Month}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.QuarterYear],text:DateTimeFormatForFilter.QuarterYear}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.MonthYear],text:DateTimeFormatForFilter.MonthYear}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.WeekYear],text:DateTimeFormatForFilter.WeekYear}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.DayOfWeek],text:DateTimeFormatForFilter.DayOfWeek}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.WeekOfYear],text:DateTimeFormatForFilter.WeekOfYear}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.Day],text:DateTimeFormatForFilter.Day}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.Hour],text:DateTimeFormatForFilter.Hour}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.Minute],text:DateTimeFormatForFilter.Minute}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.Second],text:DateTimeFormatForFilter.Second}),n.push({value:DateTimeFormatForFilter[DateTimeFormatForFilter.Time],text:DateTimeFormatForFilter.Time}),n},n.prototype.getOperatorsList=function(n){return n.toLowerCase()===QueryDatatype.Int.toString()||n.toLowerCase()===QueryDatatype.Date.toString()?[{text:"Equals",value:"Equals"},{text:"Does Not Equals",value:"DoesNotEquals"},{text:"Greater Than",value:"GreaterThan"},{text:"Greater Than Or Equal To",value:"GreaterThanOrEqualTo"},{text:"Less Than",value:"LessThan"},{text:"Less Than Or Equal To",value:"LessThanOrEqualTo"},{text:"Between",value:"Between"},{text:"Not Between",value:"NotBetween"}]:n.toLowerCase()===QueryDatatype.Char.toString()?[{text:"Inclusion",value:"Inclusion"},{text:"Starts With",value:"StartsWith"},{text:"Ends With",value:"EndsWith"},{text:"Contains",value:"Contains"},{text:"Not Contains",value:"NotContains"}]:void 0},n.prototype.isNumber=function(n){return n==="System.Int32"||n==="System.Int16"||n==="System.Int64"||n==="System.Double"||n==="System.Single"||n==="System.Decimal"||n==="System.Byte"||n==="Number"||n.toLowerCase()==="integer"||n.toLowerCase()==="real"?!0:!1},n.prototype.isString=function(n){return n==="System.Guid"||n==="System.String"||n==="Text"||n.toLowerCase()==="string"?!0:!1},n.prototype.isDate=function(n){return n==="System.DateTimeOffset"||n==="System.DateTime"||n==="DateTime"||n.toLowerCase()==="date"?!0:!1},n.prototype.isBoolean=function(n){return n==="System.Boolean"||n==="bit"||n.toLowerCase()==="boolean"?!0:!1},n.prototype.isDefaultCast=function(n){return n.toLowerCase()==="default(boolean)"||n.toLowerCase()==="default(integer)"||n.toLowerCase()==="default(string)"||n.toLowerCase()==="default(datetime)"?!0:!1},n.prototype.getChkBx1=function(n){return this.rootNode.find("#"+n+"_query_bool_chkbx1")},n.prototype.getChkBx2=function(n){return this.rootNode.find("#"+n+"_query_bool_chkbx2")},n.prototype.getChkBx3=function(n){return this.rootNode.find("#"+n+"_query_bool_chkbx3")},n.prototype.getNullChkBx=function(n){return this.rootNode.find("#"+n+"_queryint_nullChkbx")},n.prototype.getDrpDwn1=function(n){return this.rootNode.find("#"+n+"_query_filter_field")},n.prototype.getOperatorTypeDropDown=function(n){return this.rootNode.find("#"+n+"_query_operator_type")},n.prototype.getOperatorDrpDwn=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_operator")},n.prototype.getTxtColTag1=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_txtcol1")},n.prototype.getTxtValTag1=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_txtVal1")},n.prototype.getDateColumnTag=function(n){return this.rootNode.find("#"+n+"_query_date_pickcol")},n.prototype.getTxtColTag2=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_txtcol2")},n.prototype.getTxtValTag2=function(n,t){return this.rootNode.find("#"+n+"_query_"+t+"_txtVal2")},n.prototype.getTopSwitcherTag=function(n,t){return this.rootNode.find("#"+n+t+"_chck_on")},n.prototype.getNullTxtBxTag=function(n){return this.rootNode.find("#"+n+"_query_null_txt")},n.prototype.getDateRangeDrpDwn=function(n){return this.dashboardDesigner.element.find("#"+n+"_dateRange_multidDrpDwn")},n.prototype.getParamBtwDropDownSelectionValue=function(n){return this.dashboardDesigner.element.find("#"+n+"_param_btw")},n.prototype.getParameterValue=function(n){return this.dashboardDesigner.element.find("#"+n+"_param_elements")},n.prototype.getParamDropDownSelectionValue=function(n){return this.dashboardDesigner.element.find("#"+n+"_param")},n.prototype.getParameterDropDown=function(n,t){return this.dashboardDesigner.element.find("#"+n+"_query_"+t+"_parameter_dropdown")},n.prototype.getParameterBtwDropDown=function(n,t){return this.dashboardDesigner.element.find("#"+n+"_query_"+t+"_parameter_dropdown_btw")},n.prototype.getStartParamDropDownSelectionValue=function(n){return this.dashboardDesigner.element.find("#"+n+"_query_date_Start_parameter_dropdown")},n.prototype.getEndParamDropDownSelectionValue=function(n){return this.dashboardDesigner.element.find("#"+n+"_query_date_End_parameter_dropdown")},n.prototype.getMultiSelectionComboBox=function(n){return this.rootNode.find("#"+n+"_multi_select_dropDown")},n.prototype.getMeasureType=function(n){switch(n.toLowerCase()){case"doesnotequals":return MeasureFilterCondition.DoesNotEquals;case"greaterthan":return MeasureFilterCondition.GreaterThan;case"greaterthanorequalto":return MeasureFilterCondition.GreaterThanOrEqualTo;case"lessthan":return MeasureFilterCondition.LessThan;case"lessthanorequalto":return MeasureFilterCondition.LessThanOrEqualTo;case"between":return MeasureFilterCondition.Between;case"notbetween":return MeasureFilterCondition.NotBetween;default:return MeasureFilterCondition.Equals}},n.prototype.DateFormatOption=function(n){switch(n.toLowerCase()){case"startdate":return DateFormatOption.StartDate;case"enddate":return DateFormatOption.EndDate;default:return DateFormatOption.Range}},n.prototype.getValidParameter=function(n,t){for(var u=n,r=n,i=0,f=0;f<t.length;f++)t[f]==="@"+r&&(i=i+1,r=u+i,this.isExistParameter(r,t)&&(i++,r=u+i,this.getValidParameter(u+i,t)));return r},n.prototype.isExistParameter=function(n,t){for(var i=0;i<t.length;i++)if(t[i]==="@"+n)return!0;return!1},n.prototype.scrollerRefresh=function(n){n.data("BoldBIDashboardScroller")&&n.data("BoldBIDashboardScroller").refresh()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.QueryFilter",InternalQueryFilter,window),function(n){n[n.Between="between"]="Between";n[n.NotBetween="notbetween"]="NotBetween"}(QueryOperator||(QueryOperator={})),function(n){n[n.Int="int"]="Int";n[n.Date="date"]="Date";n[n.Bool="bool"]="Bool";n[n.Char="string"]="Char"}(QueryDatatype||(QueryDatatype={})),function(n){n[n.Equals="Equals"]="Equals";n[n.DoesNotEquals="DoesNotEquals"]="DoesNotEquals";n[n.GreaterThan="GreaterThan"]="GreaterThan";n[n.GreaterThanOrEqualTo="GreaterThanOrEqualTo"]="GreaterThanOrEqualTo";n[n.LessThan="LessThan"]="LessThan";n[n.LessThanOrEqualTo="LessThanOrEqualTo"]="LessThanOrEqualTo";n[n.Between="Between"]="Between";n[n.NotBetween="NotBetween"]="NotBetween"}(MeasureFilterCondition||(MeasureFilterCondition={})),function(n){n[n.Inclusion="Inclusion"]="Inclusion";n[n.StartsWith="StartsWith"]="StartsWith";n[n.EndsWith="EndsWith"]="EndsWith";n[n.Contains="Contains"]="Contains";n[n.NotContains="NotContains"]="NotContains"}(DimensionFilterCondition||(DimensionFilterCondition={}));InternalQueryJoiner=function(){function n(n){this.dashboardDesigner=null;this.id=null;this.availableTables=null;this.container=null;this.fieldtd=null;this.contentDiv=null;this.joinEditor=null;this.footerTag=null;this.prevValue=null;this.successDiv=null;this.failureDiv=null;this.ejScrollerDiv=null;this.ejJoinerDialog=null;this.ejJoinerWaitingPopup=null;this.locale=null;this.expressionTable=null;this.temproryId=null;this.operator=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.id=this.queryDesigner.id;this.renderJoinEditor()}return n.prototype.renderJoinEditor=function(){var n=this.joinEditor=BoldBIDashboard.buildTag("div.bbi-userselect","",{display:"none"},{title:this.locale.alertDialogTitle.queryJoiner,id:this.id+"_Join_Dialog"}),t=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_query_joiner_indicator_div"}),u=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_query_joiner_content_div"}),r=this.successDiv=BoldBIDashboard.buildTag("div","",{width:"auto",height:"371px",display:"block"},{id:this.id+"_query_joiner_success_div"}),l=this.failureDiv=BoldBIDashboard.buildTag("div","",{width:"682px",height:"371px",display:"none"},{id:this.id+"_query_joiner_failure_div"}),f=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_query_joiner_table_id"}),e=BoldBIDashboard.buildTag("table","",{width:"97%","border-bottom":"1px solid #c8c8c8",margin:"0.5em 12px","padding-bottom":"5px"},{unselectable:"on"}),o=BoldBIDashboard.buildTag("tr","",{"padding-top":"10px"},{}),s=BoldBIDashboard.buildTag("td","",{width:"92%"},{}),a=BoldBIDashboard.buildTag("Label.bbi-designer-add-label",this.locale.queryJoiner.tableRelations,{},{type:"label"}),i=this.container=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","",{margin:"4px 0px",padding:"5px 0px",height:"320px",width:"692px","padding-left":"12px"},{id:this.id+"_query_joiner_container_div"}),v=this.contentDiv=BoldBIDashboard.buildTag("div.e-items","",{},{id:this.id+"_query_joiner_content_div"}),h=BoldBIDashboard.buildTag("button.e-btn-close bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.queryJoiner.close,{float:"right"},{id:this.id+"_btn_cancel",type:"button"}),c=BoldBIDashboard.buildTag("button.e-btn-save bbi-dbrd-btn-primary bbi-dbrd-btn-small",this.locale.queryJoiner.merge,{float:"right"},{id:this.id+"_btn_save",type:"button"});r.append(f);f.append(e);e.append(o);o.append(s);s.append(a);r.append(i);i.append(v);u.append(r,l);t.append(u);n.append(t);this.dashboardDesigner.element.append(n);n.BoldBIDashboardDialog({minWidth:710,width:"auto",height:"auto",target:"#"+this.id,showFooter:!0,enableResize:!1,showOnInit:!1,enableModal:!0,containment:"#"+this.dashboardDesigner._id,cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(this.closeJoinDialog,this),beforeClose:this.bbdesigner$.proxy(this.onDialogClose,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.footerTag=this.dashboardDesigner.element.find("#"+this.id+"_Join_Dialog_foot");this.footerTag.append(h,c);c.on("click",this.bbdesigner$.proxy(this.saveJoinQuery,this,!0));h.on("click",this.bbdesigner$.proxy(this.cancelJoinDialog,this,!0));i.BoldBIDashboardScroller({height:"320px",scrollerSize:this.dashboardDesigner.scrollerSize.scrollSize,enableTouchScroll:!0,autoHide:!0,buttonSize:this.dashboardDesigner.scrollerSize.buttonSize});t.BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup "+this.id+"_designer_waiting_popup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()});this.ejJoinerDialog=n.data("BoldBIDashboardDialog");this.ejScrollerDiv=i.data("BoldBIDashboardScroller");this.ejJoinerWaitingPopup=t.data("BoldBIDashboardWaitingPopup")},n.prototype.addNewQueryJoiner=function(n,t){var i=BoldBIDashboard.getGuid(this.id+"_row_"),d=t&&t.join&&t.rightTable?!0:!1,r=BoldBIDashboard.isNullOrUndefined(n)?!1:n,h=this.contentDiv.find(".bbi-designer-joiner-row").length+1,l=BoldBIDashboard.buildTag("div.bbi-designer-joiner-row e-drag-row","",{padding:"4px"},{unselectable:"on",id:i,rowId:i,joinIndex:h}),c=BoldBIDashboard.buildTag("table.bbi-designer-table-dialog","",{width:"100%","border-radius":"4px",border:"1px solid #eee"},{unselectable:"on",id:i+"_joiner_container_table"}),a=BoldBIDashboard.buildTag("tr","",{height:"36px"},{id:i+"_joiner_rowTag"}),v=BoldBIDashboard.buildTag("td","",{width:"170px","padding-left":"8px",display:r?"none":"table-cell"},{}),u=BoldBIDashboard.buildTag("input"+(r?"":".e-joiner-tab-dropdown"),"",{padding:"1px"},{type:"text",id:i+"_joiner_left_tab",value:i,joinIndex:h}),y=BoldBIDashboard.buildTag("td","",{width:"170px","padding-left":r?"8px":"10px"},{}),f=this.operator=BoldBIDashboard.buildTag("input .e-joiner-type-tab-dropdown","",{padding:"1px"},{type:"text",id:i+"_joiner_type"}),p=BoldBIDashboard.buildTag("td","",{width:"170px","padding-left":"10px"},{}),e=BoldBIDashboard.buildTag("input.e-joiner-tab-dropdown","",{height:"23px",width:"120px",padding:"1px"},{type:"text",id:i+"_joiner_right_tab",joinIndex:h}),g=BoldBIDashboard.buildTag("td","",{width:r?"265px":"95px"},{}),w=BoldBIDashboard.buildTag("tr","",{display:"table-row"},{id:i+"_tr_field"}),b=this.fieldtd=BoldBIDashboard.buildTag("td","",{height:"4px"},{id:i+"_td_edit_field",colspan:"7"}),o=BoldBIDashboard.buildTag("div","",{"margin-top":"4px",height:"auto",width:"100%"},{id:i+"_query_joiner_field_div"}),s,k;if(this.contentDiv.append(l),l.append(c),c.append(a),a.append(v,y,p,g),v.append(u),y.append(f),p.append(e),c.append(w),w.append(b),b.append(o),u.BoldBIDashboardDropDownList({showRoundedCorner:!0,enableFilterSearch:!0,width:"100%",watermarkText:"Left Table",cssClass:"bbi-joiner-drpdwn bbi-designer-ejwidgets bbi-dbrd-control",fields:{id:"id",text:"text",value:"id"},dataSource:this.tables,change:this.bbdesigner$.proxy(this.changeEqualTable,this,{rowId:i,identity:"left"}),beforePopupShown:this.bbdesigner$.proxy(this.updatePreviousValue,this,{rowId:i,identity:"left"})}),e.BoldBIDashboardDropDownList({showRoundedCorner:!0,enableFilterSearch:!0,width:"100%",watermarkText:"Right Table",cssClass:"bbi-joiner-drpdwn bbi-designer-ejwidgets bbi-dbrd-control",fields:{id:"id",text:"text",value:"id"},dataSource:this.tables,change:this.bbdesigner$.proxy(this.changeEqualTable,this,{rowId:i,identity:"right"}),beforePopupShown:this.bbdesigner$.proxy(this.updatePreviousValue,this,{rowId:i,identity:"right"})}),f.BoldBIDashboardDropDownList({showRoundedCorner:!0,width:"100%",watermarkText:"Join Type",cssClass:"bbi-joiner-drpdwn bbi-designer-ejwidgets bbi-dbrd-control",fields:{id:"field",text:"field",value:"field"},dataSource:this.getJoinData(),change:this.bbdesigner$.proxy(this.conditionUI,this,{rowId:i,identity:"type"}),beforePopupShown:this.bbdesigner$.proxy(this.updatePreviousValue,this,{rowId:i,identity:"type"})}),this.renderConditionArea(i,o),d){if(r||u.data("BoldBIDashboardDropDownList").selectItemByIndex(this.getSelectedIndex(i+"_joiner_left_tab",t.leftTable)),e.data("BoldBIDashboardDropDownList").selectItemByIndex(this.getSelectedIndex(i+"_joiner_right_tab",t.rightTable)),f.data("BoldBIDashboardDropDownList").selectItemByValue(t.join),t&&t.fields&&t.fields.length>0)for(s=0;s<t.fields.length;s++)k={leftTable:t.leftTable,rightTable:t.rightTable,field:t.fields[s]},this.renderTabFields(i,o,k,!1)}else BoldBIDashboard.isNullOrUndefined(t)||BoldBIDashboard.isNullOrUndefined(t.rightTable)||(r||u.data("BoldBIDashboardDropDownList").selectItemByIndex(0),e.data("BoldBIDashboardDropDownList").selectItemByIndex(this.getSelectedIndex(i+"_joiner_right_tab",t.rightTable)),f.data("BoldBIDashboardDropDownList").selectItemByValue("Inner")),this.renderTabFields(i,o,null,!1);return this.ejScrollerDiv&&this.ejScrollerDiv.refresh(!0),i},n.prototype.getSelectedIndex=function(n,t){for(var r=this.contentDiv.find("#"+n).data("BoldBIDashboardDropDownList").getListData(),i=0;i<r.length;i++)if(r[i].fieldId===t)return i;return 0},n.prototype.disableDeleteBtn=function(n){this.contentDiv.find("#"+n+"_field_delete").css("visibility","hidden")},n.prototype.enableDeleteBtn=function(n){this.contentDiv.find("#"+n+"_field_delete").css("visibility","visible")},n.prototype.deleteJoinFields=function(n){var t=this.contentDiv.find("#"+n.parentId+" .bbi-designer-joiner-field");t.length===1?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryJoiner,this.locale.dataSource.joinerErr,IconType.warning,AlertType.Alert,!1,""):(this.contentDiv.find("#"+n.id+"_field").remove(),this.contentDiv.find("#"+n.id+"_joiner_logical_div").remove(),this.ejScrollerDiv.refresh(!0))},n.prototype.renderTabFields=function(n,t,i,r){var u=BoldBIDashboard.getGuid(n+"_"),f=!0,it;this.contentDiv.find("#"+n+" .e-default-field").length>0&&(f=!1);var l=BoldBIDashboard.buildTag("div.bbi-designer-joiner-field"+(f?" e-default-field":""),"",{padding:"4px 2px 4px 15px"},{unselectable:"on",id:u+"_field","e-rowId":u}),v=BoldBIDashboard.buildTag("table","",{width:"100%","background-color":"white"},{unselectable:"on",id:u+"_field_table"}),e=BoldBIDashboard.buildTag("tr","",{},{id:u+"_field_rowTag"}),y=BoldBIDashboard.buildTag("td","",{width:"100px"},{}),o=BoldBIDashboard.buildTag("input.e-left","",{padding:"1px"},{type:"text",id:u+"_field_left"}),p=BoldBIDashboard.buildTag("td","",{width:"80px","padding-left":"10px"},{}),s=BoldBIDashboard.buildTag("input.e-operator","",{padding:"1px"},{type:"text",id:u+"_field_type"}),w=BoldBIDashboard.buildTag("td","",{width:"100px","padding-left":"10px"},{}),h=BoldBIDashboard.buildTag("input.e-right","",{height:"23px",width:"100%",padding:"1px"},{type:"text",id:u+"_field_right"}),b=BoldBIDashboard.buildTag("td","",{width:"70px"},{}),k=BoldBIDashboard.buildTag("div","",{visibility:"visible",width:"100%"},{id:u+"_field_checkbox_div"}),c=BoldBIDashboard.buildTag("input.e-joiner-checkbox","",{padding:"1px"},{type:"checkbox",id:u+"_field_checkbox"}),rt=BoldBIDashboard.buildTag("label.bbi-designer-fontfamily",this.locale.queryJoiner.valueLabelText,{"font-size":"12px","padding-left":"6px","text-overflow":"ellipsis"},{"for":u+"_field_checkbox",type:"label"}),d=BoldBIDashboard.buildTag("td","",{width:"100px"},{}),g=BoldBIDashboard.buildTag("div","",{visibility:"hidden"},{id:u+"_field_valueAutocomplete_div"}),a=BoldBIDashboard.buildTag("input","",{width:"100%"},{id:u+"_field_valueAutocomplete",spellcheck:"false"}),nt=BoldBIDashboard.buildTag("td","",{"padding-top":"3px",width:"10px"},{}),tt=BoldBIDashboard.buildTag("span.bbi-dbrd-designer-hand-cursor e-icon"+(f?" e-disable":" e-close_01"),"",{cursor:"default",float:"right",visibility:"hidden",color:"#4D4D4D"},{id:u+"_field_delete"});l.insertBefore(this.contentDiv.find("#"+n+" .e-designer-joiner-condition"));f||(this.renderLogicalCondition(u,l,i),tt.bind("click",this.bbdesigner$.proxy(this.deleteJoinFields,this,{id:u,parentId:n})));l.append(v);v.append(e);e.append(y,p,w,b,d,nt);y.append(o);p.append(s);w.append(h);nt.append(tt);b.append(k);k.append(c,rt);d.append(g);g.append(a);e.bind(BoldBIDashboard.DashboardUtil.MouseEvent.mouseOver,this.bbdesigner$.proxy(this.enableDeleteBtn,this,u));e.bind(BoldBIDashboard.DashboardUtil.MouseEvent.mouseLeave,this.bbdesigner$.proxy(this.disableDeleteBtn,this,u));h.BoldBIDashboardDropDownList({showRoundedCorner:!0,enableFilterSearch:!0,width:"100%",watermarkText:"Right Field",cssClass:"bbi-joiner-drpdwn bbi-designer-ejwidgets bbi-dbrd-control",fields:{id:"fieldId",text:"field",value:"fieldId",category:"pid"},dataSource:[]});o.BoldBIDashboardDropDownList({showRoundedCorner:!0,enableFilterSearch:!0,width:"100%",watermarkText:"Left Field",cssClass:"bbi-joiner-drpdwn bbi-designer-ejwidgets bbi-dbrd-control",fields:{id:"fieldId",text:"field",value:"fieldId",category:"pid"},dataSource:[],change:this.bbdesigner$.proxy(this.changeFieldLeftValue,this,u)});s.BoldBIDashboardDropDownList({showRoundedCorner:!0,width:"100%",watermarkText:"Operator",cssClass:"bbi-joiner-drpdwn bbi-designer-ejwidgets bbi-dbrd-control",fields:{id:"field",text:"field",value:"field"},dataSource:this.getOperator()});c.BoldBIDashboardCheckBox({checked:!1,width:"35px",cssClass:"bbi-designer-joiner-value",change:this.bbdesigner$.proxy(this.changeCheckBoxValue,this,u)});a.BoldBIDashboardAutocomplete({showRoundedCorner:!0,showPopupButton:!0,showLoadingIcon:!0,showEmptyResultText:!1,enableAutoFill:!0,width:"100%",watermarkText:"",cssClass:"bbi-designer-ejwidgets bbi-designer-content-label bbi-dbrd-control",height:"28px",focusIn:this.bbdesigner$.proxy(this.updateColumnValues,this,u,null)});this.updateLeftFieldValues(u,n,r);i&&i.field?(o.data("BoldBIDashboardDropDownList").selectItemByIndex(this.getSelectedIndex(u+"_field_left",i.field.leftField)),h.data("BoldBIDashboardDropDownList").selectItemByIndex(this.getSelectedIndex(u+"_field_right",i.field.rightField)),s.data("BoldBIDashboardDropDownList").selectItemByValue(i.field.operator),c.data("BoldBIDashboardCheckBox").option("checked",i.field.isValueChecked),i.field.isValueChecked&&(this.showValueDropDown(u,!0),this.updateColumnValues(u,BoldBIDashboard.isNullOrUndefined(i.field.value)?null:i.field.value))):(o.data("BoldBIDashboardDropDownList").selectItemByIndex(0),s.data("BoldBIDashboardDropDownList").selectItemByIndex(0),it=this.selectRightFieldIndex(u,n),h.data("BoldBIDashboardDropDownList").selectItemByIndex(it),c.data("BoldBIDashboardCheckBox").option("checked",!1),a.data("BoldBIDashboardAutocomplete").option("dataSource",[]))},n.prototype.conditionUI=function(n,t){var i=this,r;t.isInteraction||t.value!=="Cross Join"?this.fieldtd.css("display",""):this.fieldtd.css("display","none");t.isInteraction&&(r=this.joinEditor.find(".e-joiner-type-tab-dropdown"),r.each(function(t,r){if(i.bbdesigner$(r).attr("id")!==i.dashboardDesigner.element.find("#"+n.rowId+"_joiner_"+n.identity+"_tab").attr("id")){var u=i.bbdesigner$(r).data("BoldBIDashboardDropDownList").getSelectedValue();BoldBIDashboard.isNullOrUndefined(u)||u!=="Cross Join"?i.fieldtd.css("display",""):i.fieldtd.css("display","none")}}));this.queryDesigner._datasourceInfo.ConnectionProperties.DataProvider==="MySQL"&&t.value==="Full Outer Join"?(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryJoiner,this.locale.alertWindowMesages.joinMessageMySQL,IconType.warning,AlertType.Alert,!1,""),this.operator.data("BoldBIDashboardDropDownList").selectItemByValue("Inner")):this.queryDesigner._datasourceInfo.ConnectionProperties.DataProvider==="Google"&&t.value==="Full Outer Join"?(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryJoiner,this.locale.alertWindowMesages.joinMessageGoogle,IconType.warning,AlertType.Alert,!1,""),this.operator.data("BoldBIDashboardDropDownList").selectItemByValue("Inner")):this.queryDesigner._datasourceInfo.ConnectionProperties.DataProvider==="Rockset"&&t.value==="Full Outer Join"&&(this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryJoiner,this.locale.alertWindowMesages.joinMessageRockset,IconType.warning,AlertType.Alert,!1,""),this.operator.data("BoldBIDashboardDropDownList").selectItemByValue("Inner"))},n.prototype.updateColumnValues=function(n,t){var i=this.contentDiv.find("#"+n+"_field_right").data("BoldBIDashboardDropDownList"),r=this.contentDiv.find("#"+n+"_field_valueAutocomplete").data("BoldBIDashboardAutocomplete"),u=this.contentDiv.find("#"+n+"_field_valueAutocomplete_div").attr("isPostBack"),f=this.contentDiv.find("#"+n+"_field_valueAutocomplete_div").attr("rightFieldValue"),s=BoldBIDashboard.isNullOrUndefined(u)?!1:u.toLowerCase()==="true"?!0:!1,h=BoldBIDashboard.isNullOrUndefined(f)?!1:i.getSelectedValue()===f,c=BoldBIDashboard.isNullOrUndefined(r.model.dataSource)||r.model.dataSource.length===0,e,o;(s||h)&&!c||(e=i.getItemDataByValue(i.getSelectedValue())[0].field,o=[{Id:i.getSelectedValue(),Name:e,SummaryType:"None",FieldType:"Dimensions"}],this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.getColumnData,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.FilterAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.getColumnData,fieldInfo:o,dataSetId:this.queryDesigner.dataset.Id,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.setColumnValues,this,n,t),indicator:[this.bbdesigner$.proxy(this.showLoadingIndicator,this,n),this.bbdesigner$.proxy(this.hideLoadingIndicator,this,n)]}),this.contentDiv.find("#"+n+"_field_valueAutocomplete_div").attr("isPostBack","true").attr("rightFieldValue",i.getSelectedValue()))},n.prototype.setColumnValues=function(n,t,i){var r=JSON.parse(i.data),f=Object.keys(r[0])[0],u;!BoldBIDashboard.isNullOrUndefined(r)&&r.length>0&&(u=this.contentDiv.find("#"+n+"_field_valueAutocomplete").data("BoldBIDashboardAutocomplete"),u.setModel({fields:{text:f,value:f},dataSource:r}),BoldBIDashboard.isNullOrUndefined(t)?u.open():u.option({value:t}));this.contentDiv.find("#"+n+"_field_valueAutocomplete_div").attr("isPostBack","false")},n.prototype.selectRightFieldIndex=function(n,t){for(var f=this.contentDiv.find("#"+t+"_joiner_right_tab").data("BoldBIDashboardDropDownList"),e=this.contentDiv.find("#"+n+"_field_right").data("BoldBIDashboardDropDownList"),s=f.getItemDataByValue(f.getSelectedValue())[0].field,o=e.getItemDataByValue(e.getSelectedValue())[0].field,r=this.contentDiv.find("#"+n+"_field_right").data("BoldBIDashboardDropDownList").model.dataSource,u=[],i=0;i<r.length;i++)if(r[i].pid===s&&(u.push(i),o===r[i].field||o===r[i].field.replace(" ("+r[i].pid+")","")))return i;return u.length>0?u[0]:0},n.prototype.renderLogicalCondition=function(n,t,i){var u=BoldBIDashboard.buildTag("div.e-designer-joiner-logical","",{height:"31px","margin-top":"4px",padding:"4px 5px"},{id:n+"_joiner_logical_div"}),f=BoldBIDashboard.buildTag("div","",{"margin-bottom":"-15px","padding-left":"13px"},{}),r=BoldBIDashboard.buildTag("input.e-logical","",{padding:"1px"},{type:"text",id:n+"_joiner_logical"}),e=BoldBIDashboard.buildTag("div","",{"border-top":"1px solid #cecece"},{id:n+"_logical_separator"});f.append(r);u.append(f,e);u.insertBefore(t);r.BoldBIDashboardDropDownList({showRoundedCorner:!0,width:"135px",height:"28px",cssClass:"bbi-joiner-drpdwn bbi-designer-ejwidgets bbi-dbrd-control",fields:{id:"field",text:"field",value:"field"},dataSource:this.getLogicalData()});i&&i.field?r.data("BoldBIDashboardDropDownList").selectItemByValue(i.field.condition):r.data("BoldBIDashboardDropDownList").selectItemByIndex(0)},n.prototype.renderConditionArea=function(n,t){var i=BoldBIDashboard.buildTag("div.e-designer-joiner-condition","",{height:"31px","margin-top":"4px",padding:"4px 5px"},{id:n+"_joiner_condition_div"}),r=BoldBIDashboard.buildTag("div","",{"margin-bottom":"-15px","padding-left":"13px"},{}),u=BoldBIDashboard.buildTag("button.bbi-designer-addfield-btn bbi-dbrd-btn-secondary bbi-dbrd-btn-small",this.locale.queryJoiner.addField,{},{id:n+"_condition_add_field",type:"button"}),f=BoldBIDashboard.buildTag("div","",{"border-top":"1px solid #cecece"},{id:n+"_condition_separator"});r.append(u);i.append(r,f);t.append(i);u.on("click",this.bbdesigner$.proxy(this.addNewField,this,{id:n,target:t}))},n.prototype.setAvailableTable=function(n){var t=JSON.parse(n);this.availableTables=t},n.prototype.editNewField=function(n,t,i,r){this.callback=r;this.availableTables=i;var u=this.dashboardDesigner.element.find("#"+this.id+"_Join_Dialog");u.data("e-table",t);this.showQueryJoiner(n,!1,r);this.addNewQueryJoiner(n.length>0,{rightTable:t.id})},n.prototype.changeCheckBoxValue=function(n,t){t.isInteraction&&this.showValueDropDown(n,t.isChecked)},n.prototype.showValueDropDown=function(n,t){t?(this.contentDiv.find("#"+n+"_field_valueAutocomplete_div").css("visibility","visible"),this.contentDiv.find("#"+n+"_field_right").data("BoldBIDashboardDropDownList").disable()):(this.contentDiv.find("#"+n+"_field_valueAutocomplete_div").css("visibility","hidden"),this.contentDiv.find("#"+n+"_field_right").data("BoldBIDashboardDropDownList").enable());var i=this.contentDiv.find("#"+n+"_field_valueAutocomplete").data("BoldBIDashboardAutocomplete");i.option("dataSource",[]);i.clearText()},n.prototype.addNewField=function(n){this.renderTabFields(n.id,n.target,null,!0);this.ejScrollerDiv&&this.ejScrollerDiv.refresh(!0)},n.prototype.getRelationInput=function(n){var i=this,u=this.contentDiv.find("#"+n+"_joiner_left_tab").data("BoldBIDashboardDropDownList"),f=this.contentDiv.find("#"+n+"_joiner_right_tab").data("BoldBIDashboardDropDownList"),s=this.contentDiv.find("#"+n+"_joiner_type").data("BoldBIDashboardDropDownList"),t={},h,r,e,o;return f.getSelectedValue()&&(t.rightTable=f.getSelectedValue(),t.rightSchema=f.getItemDataByValue(f.getSelectedValue())[0].schema),s.getSelectedValue()&&(t.join=s.getSelectedValue()),h=this.contentDiv.find("#"+n+" .bbi-designer-joiner-field"),r=[],h.each(function(n,t){var u=i.bbdesigner$(t).attr("e-rowId"),e=i.dashboardDesigner.element.find("#"+u+"_field_left").data("BoldBIDashboardDropDownList"),o=i.dashboardDesigner.element.find("#"+u+"_field_right").data("BoldBIDashboardDropDownList"),s=i.dashboardDesigner.element.find("#"+u+"_field_type").data("BoldBIDashboardDropDownList"),h=i.dashboardDesigner.element.find("#"+u+"_field_checkbox").data("BoldBIDashboardCheckBox"),c=i.dashboardDesigner.element.find("#"+u+"_field_valueAutocomplete").data("BoldBIDashboardAutocomplete"),f="AND";i.dashboardDesigner.element.find("#"+u+"_joiner_logical").length>0&&(f=i.dashboardDesigner.element.find("#"+u+"_joiner_logical").data("BoldBIDashboardDropDownList").getSelectedValue());r.push({leftField:e.getSelectedValue(),operator:s.getSelectedValue(),rightField:o.getSelectedValue(),isValueChecked:h.isChecked(),value:c.getValue(),condition:f})}),this.contentDiv.find("#"+n+"_joiner_left_tab").hasClass("e-joiner-tab-dropdown")&&u.getSelectedValue()?(t.leftTable=u.getSelectedValue(),t.leftSchema=u.getItemDataByValue(u.getSelectedValue())[0].schema):(e=this.availableTables.filter(function(n){return n.ID===r[0].leftField}),t.leftTable=e[0].TableId,o=this.tables.filter(function(n){return n.id===e[0].TableId}),t.leftSchema=o.length===0?null:o[0].schema),r.length>0&&(t.fields=r),t},n.prototype.updatePreviousValue=function(n,t){BoldBIDashboard.isNullOrUndefined(t)||BoldBIDashboard.isNullOrUndefined(t.value)||(this.prevValue=t.value)},n.prototype.changeEqualTable=function(n,t){var i=this,u;if(t.isInteraction){var f=this.joinEditor.find(".e-joiner-tab-dropdown"),e=t.selectedValue,o=BoldBIDashboard.isNullOrUndefined(this.prevValue)?"":this.prevValue,r=[];f.each(function(t,u){if(i.bbdesigner$(u).attr("id")!==i.dashboardDesigner.element.find("#"+n.rowId+"_joiner_"+n.identity+"_tab").attr("id")){r.push(parseInt(i.dashboardDesigner.element.find("#"+n.rowId+"_joiner_"+n.identity+"_tab").attr("joinIndex"),10));var f=i.bbdesigner$(u).data("BoldBIDashboardDropDownList").getSelectedValue();BoldBIDashboard.isNullOrUndefined(f)||f!==e||(i.bbdesigner$(u).data("BoldBIDashboardDropDownList").selectItemByValue(o),r.push(parseInt(i.bbdesigner$(u).attr("joinIndex"),10)))}});u=r.sort(this.sortValues);this.changeFieldDropdownValues(u)}},n.prototype.sortValues=function(n,t){return n-t},n.prototype.changeFieldDropdownValues=function(n){var o=this,s=this.contentDiv.find(".bbi-designer-joiner-row"),h=this.joinEditor.find(".e-joiner-tab-dropdown"),r=n[0]-1,u=n[n.length-1]-1,f=null,e,t,i;if(!(r===0&&u===0))for(e=function(n){var i=[],u,l,r;for(f=t.contentDiv.find("#"+t.contentDiv.find(s[n]).attr("rowId")+" .e-left"),u=0;u<n+2;u++){var e=t.joinEditor.find(h[u]).data("BoldBIDashboardDropDownList"),c=e.model.selectedIndex,a=BoldBIDashboard.isNullOrUndefined(c)?"":e.model.dataSource[c].fieldId;i=i.concat(t.getTableColumns(a));i.length===0&&(l=BoldBIDashboard.isNullOrUndefined(u)?"":e.model.dataSource[u].fieldId,i=i.concat(t.getTableColumns(l)))}for(r=0;r<t.expressionTable.length;r++)i.push({pid:"Expression",tableId:t.expressionTable[r].TableId,field:t.expressionTable[r].Name,fieldId:t.expressionTable[r].ID,columnDetails:t.expressionTable[r]});f.each(function(n,t){var r=o.bbdesigner$(t).data("BoldBIDashboardDropDownList");r.setModel({dataSource:i});r.selectItemByIndex(0)})},t=this,i=r;i<u;i++)e(i)},n.prototype.updateLeftFieldValues=function(n,t,i){for(var s=this.contentDiv.find(".bbi-designer-joiner-row"),a=this.joinEditor.find(".e-joiner-tab-dropdown"),e=this.contentDiv.find("#"+n+"_field_left").data("BoldBIDashboardDropDownList"),r=[],l,u,h=i?s.index(this.bbdesigner$("#"+t))+1:s.length,f=0;f<h- -1;f++){var o=this.joinEditor.find(a[f]).data("BoldBIDashboardDropDownList"),c=o.model.selectedIndex,v=BoldBIDashboard.isNullOrUndefined(c)?"":o.model.dataSource[c].fieldId;r=r.concat(this.getTableColumns(v));r.length===0&&(l=BoldBIDashboard.isNullOrUndefined(f)?"":o.model.dataSource[f].fieldId,r=r.concat(this.getTableColumns(l)))}for(u=0;u<this.expressionTable.length;u++)r.push({pid:"Expression",tableId:this.expressionTable[u].TableId,field:this.expressionTable[u].Name,fieldId:this.expressionTable[u].ID,columnDetails:this.expressionTable[u]});e.setModel({dataSource:r});e.selectItemByText(e.model.dataSource[0].fieldId)},n.prototype.changeFieldLeftValue=function(n,t){var e,r;if(!BoldBIDashboard.isNullOrUndefined(t)){var f=this.contentDiv.find("#"+n+"_field_right"),u=t.model.dataSource,o=[],i=u.filter(function(n){return n.fieldId===t.selectedValue})[0].columnDetails,s=!0;if(f.data("BoldBIDashboardDropDownList").model.dataSource.length>0&&(e=f.data("BoldBIDashboardDropDownList").model.dataSource[0].columnDetails.DefaultDataType,s=t.isInteraction?i.DefaultDataType!==e&&!(i.DefaultDataType==="Integer"&&e==="Real"||i.DefaultDataType==="Real"&&e==="Integer"):!0),s){for(r=0;r<u.length;r++)(i.DefaultDataType===u[r].columnDetails.DefaultDataType||i.DefaultDataType==="Integer"&&u[r].columnDetails.DefaultDataType==="Real"||i.DefaultDataType==="Real"&&u[r].columnDetails.DefaultDataType==="Integer")&&o.push(u[r]);f.data("BoldBIDashboardDropDownList").setModel({dataSource:o});o.length>0&&f.data("BoldBIDashboardDropDownList").selectItemByIndex(0);this.contentDiv.find("#"+n+"_field_checkbox_div").css("visibility",i.DefaultDataType==="Date"?"hidden":"visible");this.contentDiv.find("#"+n+"_field_checkbox").data("BoldBIDashboardCheckBox").option("checked",!1)}this.showValueDropDown(n,this.contentDiv.find("#"+n+"_field_checkbox").data("BoldBIDashboardCheckBox").isChecked())}},n.prototype.getTableColumns=function(n){var r=this,i=[],t=this.availableTables;return this.dashboardDesigner.element.find("#"+this.id+"_div_dragSurface .bbi-data-table").each(function(u,f){var o=r.bbdesigner$(f).data("e-table"),e;if(n===o.id)for(e=0;e<t.length;e++)n===t[e].TableId&&i.push({pid:t[e].TableName,tableId:t[e].TableId,field:t[e].Name,fieldId:t[e].ID,columnDetails:t[e]})}),i.sort(this.compare),i},n.prototype.compare=function(n,t){return n.field<t.field?-1:n.field>t.field?1:0},n.prototype.getTableGroups=function(){var t=this,n=[];return this.expressionTable=[],this.dashboardDesigner.element.find("#"+this.id+"_div_dragSurface .bbi-data-table").each(function(i,r){var u=t.bbdesigner$(r).data("e-table");n.push({fieldId:u.id,field:u.name,schema:u.schema,id:u.id,text:u.displayName})}),this.expressionTable=this.availableTables.filter(function(n){return n.IsExpression===!0&&n.IsAggregatedExpression===!1}),this.expressionTable.length>0&&(this.temproryId===null&&(this.temproryId=Math.random().toString(16).substring(2,32)+Math.random().toString(16).substring(2,32)),n.push({text:"Expression",fieldId:this.temproryId,field:this.expressionTable[0].name,id:this.temproryId})),n},n.prototype.showQueryJoiner=function(n,t,i){this.resetJoinInstance();this.callback=i;t&&(this.joinEditor.data("BoldBIDashboardDialog").open(),this.ejJoinerWaitingPopup.show());this.footerTag.find("#"+this.id+"_btn_save").html(t?this.locale.queryJoiner.update:this.locale.queryJoiner.merge);this.tables=this.getTableGroups();this.populateJoiner(n);t&&this.updateQueryJoinerScrollBar()},n.prototype.openQueryJoiner=function(n){this.joinEditor.data("BoldBIDashboardDialog").open();this.ejJoinerWaitingPopup.show();this.queryDesigner.executeUIQuery(n);this.showJoiners(!1);this.showCancelBtn(!1);this.selectedTable=null},n.prototype.resetJoinInstance=function(){this.queryJoiner=[];this.tables=[];this.contentDiv.empty()},n.prototype.populateJoiner=function(n){if(this.queryJoiner=JSON.parse(JSON.stringify(n)),this.queryJoiner&&this.queryJoiner.length>0)for(var t=0;t<this.queryJoiner.length;t++)this.addNewQueryJoiner(t>0,this.queryJoiner[t])},n.prototype.updateQueryJoiner=function(n,t,i){var r=JSON.parse(n.jsonData),u,f;r&&(r.indexOf("Sf_Exception")!==-1||r==="Not Found")?(this.ejJoinerWaitingPopup.hide(),u=this.dashboardDesigner.element.find("#"+this.id+"_Join_Dialog"),u.data("e-table",t),this.callback=i,this.showJoiners(!1),this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.queryJoiner,this.locale.errorMessage.dataFetchingError,IconType.errors,AlertType.Alert,!0,r,{method:"cancelJoinDialog",instance:this,dataInfo:null})):(this.showJoiners(!0),f=r,this.editNewField(this.queryDesigner.queryJoiner,t,f,i),this.updateQueryJoinerScrollBar())},n.prototype.updateQueryJoinerScrollBar=function(){var n=this.ejScrollerDiv;n.isVScroll()&&(n.refresh(!0),n.scrollY(n._scrollYdata.scrollable));this.ejJoinerWaitingPopup.hide()},n.prototype.showJoiners=function(n){n?(this.successDiv.css("display","block"),this.failureDiv.css("display","none"),BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.find("#"+this.id+"_btn_save"),!0)):(this.successDiv.css("display","none"),this.failureDiv.css("display","block"),BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.find("#"+this.id+"_btn_save"),!1))},n.prototype.showCancelBtn=function(n){n?(this.dashboardDesigner.element.find("#"+this.id+"_Join_Dialog_closebutton").removeClass("e-close-disable").css({cursor:"pointer",opacity:"1"}),BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.find("#"+this.id+"_btn_cancel"),!0)):(this.dashboardDesigner.element.find("#"+this.id+"_Join_Dialog_closebutton").addClass("e-close-disable").css({cursor:"default",opacity:"0.3"}),BoldBIDashboard.DashboardUtil.buttonEnable(this.footerTag.find("#"+this.id+"_btn_cancel"),!1))},n.prototype.closeJoinDialog=function(n){this.footerTag.find("#"+this.id+"_btn_save").html(this.locale.queryJoiner.merge);this.footerTag.find("#"+this.id+"_btn_save").addClass("bbi-dbrd-designer-hoverable").attr("data-tooltip",this.locale.queryJoiner.merge);n.model.position={X:0,Y:0};(n.isInteraction||!BoldBIDashboard.isNullOrUndefined(this.selectedTable))&&this.cancelJoinDialog(n)},n.prototype.onDialogClose=function(n){!BoldBIDashboard.isNullOrUndefined(n.event)&&this.bbdesigner$(n.event.target).hasClass("e-close-disable")?n.cancel=!0:this.ejJoinerWaitingPopup.hide()},n.prototype.selectedTableInfo=function(n,t,i){this.ejJoinerWaitingPopup.hide();this.failureDiv.text(t);this.failureDiv.css("text-align","center");this.failureDiv.css("vertical-align","middle");this.failureDiv.css("line-height",this.failureDiv.height()+"px");this.failureDiv.css("font-size","12px");this.showJoiners(!1);this.showCancelBtn(!0);this.selectedTable=n;this.callback=i},n.prototype.cancelJoinDialog=function(){var i=this.dashboardDesigner.element.find("#"+this.id+"_Join_Dialog"),n=i.data("e-table"),t;i.data("BoldBIDashboardDialog").close();n&&n.name?(t={isCancel:!0,data:n},this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.cancelJoin,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.DataDesignViewAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.cancelJoin,tableId:n.id,dataSetName:this.queryDesigner.dataset.Name,dataSetId:this.queryDesigner.dataset.Id,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.closeJoin,this,t)})):BoldBIDashboard.isNullOrUndefined(this.selectedTable)||(t={isCancel:!0,data:this.selectedTable},this.closeJoin(t,null))},n.prototype.closeJoin=function(n){BoldBIDashboard.isNullOrUndefined(this.selectedTable)||(this.failureDiv.text(""),this.successDiv.css("display","block"),this.failureDiv.css("display","none"));var t=this.dashboardDesigner.element.find("#"+this.id+"_Join_Dialog");BoldBIDashboard.DashboardUtil.invokeCallBack(this.callback,n);t.removeData("e-table")},n.prototype.saveJoinQuery=function(){var t=this.getTableJoiners(),n=this.dashboardDesigner.element.find("#"+this.id+"_Join_Dialog");BoldBIDashboard.DashboardUtil.invokeCallBack(this.callback,{joiners:t});n.data("BoldBIDashboardDialog").close();n.removeData("e-table")},n.prototype.getTableJoiners=function(){var n=this,t=[],i=this.contentDiv.find(".bbi-designer-joiner-row");return i.each(function(i,r){var u=n.bbdesigner$(r).attr("rowId"),f=n.getRelationInput(u);t.push(f)}),t},n.prototype.showLoadingIndicator=function(n){this.contentDiv.find("#"+n+"_field_valueAutocomplete_dropdown>span").removeClass("e-search");this.contentDiv.find("#"+n+"_field_valueAutocomplete_dropdown>span").addClass("e-load").addClass("e-input");this.contentDiv.find("#"+n+"_field_valueAutocomplete_dropdown>span").css("background-position","center")},n.prototype.hideLoadingIndicator=function(n){this.contentDiv.find("#"+n+"_field_valueAutocomplete_dropdown>span").removeClass("e-input").removeClass("e-load");this.contentDiv.find("#"+n+"_field_valueAutocomplete_dropdown>span").addClass("e-search")},n.prototype.getJoinData=function(){return[{field:"Inner"},{field:"Left Outer Join"},{field:"Right Outer Join"},{field:"Full Outer Join"},{field:"Cross Join"}]},n.prototype.getOperator=function(){return[{field:"="},{field:">="},{field:"<="},{field:"!="}]},n.prototype.getLogicalData=function(){return[{field:"AND"},{field:"AND(Group)"},{field:"OR(Group)"},{field:"OR"},{field:"AND NOT"},{field:"OR NOT"}]},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.QueryJoiner",InternalQueryJoiner,window);InternalQueryParameter=function(){function n(n){this.id=null;this.parameters=[];this.queryParameters=[];this.locale=null;this.designerInstance=n;this.bbdesigner$=this.designerInstance.bbdesigner$;this.locale=n.getLocalizationContent();this.id=this.designerInstance._id;this.queryDesigner=this.designerInstance.modules.queryDesigner;this.renderQueryParameter()}return n.prototype.renderQueryParameter=function(){var t=BoldBIDashboard.buildTag("div.bbi-dashboard-designer-configuration bbi-userselect","",{display:"block"},{title:"Parameters",id:this.id+"_query_param_dialog"}),i=BoldBIDashboard.buildTag("div","",{height:"280px",width:"100%"}),n=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-scroller bbi-dbrd-control bbi-designer-border-dialog bbi-dbrd-designer-scroll-style-3","",{height:"275px",width:"475px",margin:"5px 0px"},{id:this.id+"_queryparam_parent_div"}),r=BoldBIDashboard.buildTag("div","",{},{}),o=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_queryparam_container_div"}),u=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left","Cancel",{float:"right"},{id:this.id+"_queryparam_btn_cancel",type:"button"}),f=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-primary bbi-dbrd-btn-small","OK",{float:"right"},{id:this.id+"_queryparam_btn_save",type:"button"}),e;r.append(o);n.append(r);i.append(n);t.append(i);t.BoldBIDashboardDialog({minWidth:500,height:"auto",width:"auto",enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,containment:"#"+this.queryDesigner._id,target:"#"+this.queryDesigner._id,cssClass:"bbi-designer-dialog boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});e=this.designerInstance.element.find("#"+this.id+"_query_param_dialog_foot");e.append(u).append(f);f.on("click",this.bbdesigner$.proxy(this.saveQueryParameter,this,!0));u.on("click",this.bbdesigner$.proxy(this.closeQueryDialog,this,!0));n.BoldBIDashboardScroller({height:"275px",scrollerSize:this.designerInstance.scrollerSize.scrollSize,enableTouchScroll:!0,autoHide:!0,buttonSize:this.designerInstance.scrollerSize.buttonSize})},n.prototype.renderQueryParameters=function(n){var i=this.designerInstance.element.find("#"+this.id+"_queryparam_container_div"),t,e;i.empty();var r=BoldBIDashboard.buildTag("div.e-reportdesigner-query-parameter","",{padding:"4px 8px","padding-bottom":"0px",display:"block"},{}),u=BoldBIDashboard.buildTag("table","",{},{id:this.id+"_query_table"}),f=BoldBIDashboard.buildTag("tr"),o=BoldBIDashboard.buildTag("td","<b>Parameter<\/b>",{height:"30px",width:"163px"}),s=BoldBIDashboard.buildTag("td","<b style='padding-left: 10px'>Null<\/b>",{height:"30px",width:"86px","padding-left":"26px"}),h=BoldBIDashboard.buildTag("td","<b style='padding-left: 12px' id='"+this.id+"_queryparam_value_title'>Value<\/b>",{height:"30px",width:"176px","padding-left":"13px"});for(this.parameters=n,f.append(o).append(s).append(h),u.append(f),r.append(u),i.append(r),t=0;t<n.length;t++)e=n[t],this.renderParameter(e,i);this.queryParameters&&this.queryParameters.length>0&&this.populateQueryParameter(this.queryParameters)},n.prototype.renderParameter=function(n,t){var i=n.substring(1),u=BoldBIDashboard.buildTag("div.e-reportdesigner-query-parameter","",{padding:"4px 8px",display:"block"},{id:this.id+"_query_"+i}),f=BoldBIDashboard.buildTag("table","",{width:"100%"},{id:this.id+"_query_table_"+i}),r=BoldBIDashboard.buildTag("tr","",{}),e=BoldBIDashboard.buildTag("td","",{width:"150px"}),l=BoldBIDashboard.buildTag("span",n,{width:"150px","text-overflow":"ellipsis",overflow:"hidden",display:"block","white-space":"nowrap"},{}),o=BoldBIDashboard.buildTag("td","",{width:"57px","padding-left":"40px"}),s=BoldBIDashboard.buildTag("input","",{},{type:"checkbox",id:this.id+"_query_chk_"+i}),h=BoldBIDashboard.buildTag("td","",{width:"20px","padding-left":"26px"}),c;r.append(e);e.append(l);r.append(o);o.append(s);r.append(h);f.append(r);u.append(f);t.append(u);c=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-border","",{height:"25px",width:"140px",float:"right"},{type:"text",id:this.id+"_query_proc_"+i});h.append(c);s.BoldBIDashboardCheckBox({change:this.bbdesigner$.proxy(this.checkParamNullable,this,{id:this.id+"_query_proc_"+i}),showRoundedCorner:!0,cssClass:"bbi-designer-border"})},n.prototype.getQueryParams=function(){var t=[],n;if(this.parameters&&this.parameters.length>0){for(n=0;n<this.parameters.length;n++){var i=this.parameters[n],r=i.substring(1),u=this.designerInstance.element.find("#"+this.id+"_query_chk_"+r).data("BoldBIDashboardCheckBox");u.isChecked()?t.push({Name:i,IsNull:!0,Value:""}):t.push({Name:i,IsNull:!1,Value:this.designerInstance.element.find("#"+this.id+"_query_proc_"+r).val()})}return t}return null},n.prototype.getQueryParameters=function(n){for(var i=[],r=BoldBIDashboard.DashboardUtil.parseQuery(n),t=0;t<r.length;t++)this.isExistQueryParameter(r[t].substring(1),i)||i.push({Name:r[t],Value:null,isQueryMode:!0});return i},n.prototype.saveQueryParameter=function(){this.queryDesigner.queryInputVals=this.getQueryParams();var n=this.queryDesigner.getQueryText();this.queryDesigner.executeTempQuery(n);this.designerInstance.element.find("#"+this.id+"_query_param_dialog").data("BoldBIDashboardDialog").close()},n.prototype.populateQueryParameter=function(n){var t,i;if(n&&n.length>0)for(t=0;t<n.length;t++)i=n[t].Name.substring(1),n[t].IsNull?this.designerInstance.element.find("#"+this.id+"_query_chk_"+i).data("BoldBIDashboardCheckBox").setModel({checked:!0}):this.designerInstance.element.find("#"+this.id+"_query_proc_"+i).val(n[t].Value)},n.prototype.checkParamNullable=function(n,t){t.isChecked?this.designerInstance.element.find("#"+n.id).attr("disabled","disabled"):this.designerInstance.element.find("#"+n.id).removeAttr("disabled")},n.prototype.isExistQueryParameter=function(n,t){for(var i=0;i<t.length;i++)if(t[i]===n)return!0;return!1},n.prototype.showQueryDialog=function(n,t){var i=BoldBIDashboard.DashboardUtil.parseQuery(n),r;this.queryParameters=t;i&&i.length>0?(this.renderQueryParameters(i),this.designerInstance.element.find("#"+this.id+"_query_param_dialog").data("BoldBIDashboardDialog").open(),this.designerInstance.element.find("#"+this.id+"_queryparam_parent_div").height()>this.designerInstance.element.find("#"+this.id+"_queryparam_container_div").height()?this.designerInstance.element.find("#"+this.id+"_queryparam_value_title").css("padding-left","16px"):this.designerInstance.element.find("#"+this.id+"_queryparam_value_title").css("padding-left","12px"),r=this.designerInstance.element.find("#"+this.id+"_queryparam_parent_div"),r.data("BoldBIDashboardScroller")&&r.data("BoldBIDashboardScroller").refresh()):this.queryDesigner.executeTempQuery(n)},n.prototype.closeQueryDialog=function(){this.designerInstance.element.find("#"+this.id+"_query_param_dialog").data("BoldBIDashboardDialog").close()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.QueryParameter",InternalQueryParameter,window);InternalSharedDataSet=function(){function n(n){this.dashboardDesigner=null;this.id=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.dataset=this.dashboardDesigner.modules.dataSet;this.rdlParser=this.dashboardDesigner.rdlParser;this.id=this.dashboardDesigner._id;this.datasetReference=null;this.dataSetItem=null}return n.prototype.renderConfiguration=function(n){var a,r,u,f,w,o,s,h,c,l;if(n.find("#"+this.id+"_shared_dataset").length>0)this.resetConfiguration(),this.setDataSetName();else{a={id:"Id",text:"Name",value:"Id"};this.configTable=BoldBIDashboard.buildTag("table.bbi-designer-dsconfig-table","",{width:"100%","margin-left":"3px"},{unselectable:"on",id:this.id+"_shared_dataset"});n.append(this.configTable);var v=this.bbdesigner$("<tr><\/tr>"),y=this.bbdesigner$("<td><\/td>"),t=this.bbdesigner$("<table><\/table>"),it=BoldBIDashboard.buildTag("label.editLabel bbi-designer-title-label","Name",{}),p=this.bbdesigner$("<td style='width: 215px' id="+this.id+"_shared_txt_lbl_td><\/td>"),i=this.bbdesigner$("<tr style='float: left'><\/tr>");p.append(it);i.append(p);r=BoldBIDashboard.buildTag("td","",{},{id:this.id+"_shared_txt_error_icon_td"});this.dashboardDesigner.modules.util.renderErrIndictor(r,this.id);i.append(r);t.append(i);y.append(t);v.append(y);this.configTable.append(v);u=this.bbdesigner$("<tr style='float: left'><\/tr>");f=this.bbdesigner$("<td id="+this.id+"_shared_txt_td><\/td>");u.append(f);t.append(u);w=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-content-label","",{height:"24px",width:"426px"},{edittype:"stringedit",id:this.id+"_shared_txt",type:"text",value:this.dataset.getAvailableName()});f.append(w);var b=this.bbdesigner$("<tr><\/tr>"),k=this.bbdesigner$("<td><\/td>"),e=this.bbdesigner$("<table><\/table>");b.append(k);k.append(e);this.configTable.append(b);o=this.bbdesigner$("<tr style='float: left;font-weight: 500'><td  style='width: 215px' id="+this.id+"_shared_dropdown_lbl_td><label class='editLabel bbi-designer-title-label bbi-designer-fontfamily' style='padding-top:6px;font-size: 13px;'>Shared DataSet<\/label><\/td><\/tr>");e.append(o);s=BoldBIDashboard.buildTag("td","",{},{id:this.id+"_shared_data_drdwn_error_icon_td"});this.dashboardDesigner.modules.util.renderErrIndictor(s,this.id);o.append(s);h=this.bbdesigner$("<tr style='float: left'><\/tr>");c=this.bbdesigner$("<td id="+this.id+"_shared_data_drdwn_td><\/td>");e.append(h);h.append(c);l=BoldBIDashboard.buildTag("input","",{},{id:this.id+"_shared_data_drdwn",value:""});c.append(l);l.BoldBIDashboardDropDownList({width:"440px",dataSource:[],fields:a,cssClass:"bbi-designer-dataset-selection bbi-designer-content-label bbi-designer-ejwidgets bbi-dbrd-control"});var d=this.bbdesigner$("<tr><\/tr>"),g=this.bbdesigner$("<td><\/td>"),nt=this.bbdesigner$("<table><\/table>"),tt=this.bbdesigner$("<tr style='float: left'/>"),rt=this.bbdesigner$("<td unselectable='on' align='right'/>");tt.append(rt);nt.append(tt);g.append(nt);d.append(g);this.configTable.append(d)}this.datasetReference=null;this.showConfiguration(!0);this.loadDataSetCatalog()},n.prototype.editConfiguration=function(n){this.dataSetItem=n;var t=this.dashboardDesigner.element.find("#"+this.id+"_sharedDSContainer");t.children().length===0&&this.renderConfiguration(t);this.datasetReference=null;this.hideValidationMsg();this.setDataSetName(n);n&&(this.datasetReference=n.SharedDataSet.SharedDataSetReference,this.dashboardDesigner.element.find("#"+this.id+"_shared_data_drdwn").data("BoldBIDashboardDropDownList").setModel({dataSource:[]}),this.loadDataSetCatalog());this.showConfiguration(!0);this.dashboardDesigner.element.find("#"+this.id+"_sharedDSBodyContainer").data("BoldBIDashboardScroller")&&this.dashboardDesigner.element.find("#"+this.id+"_sharedDSBodyContainer").data("BoldBIDashboardScroller").refresh()},n.prototype.resetConfiguration=function(){this.datasetReference=null;this.configTable.find("#"+this.id+"_shared_data_drdwn").data("BoldBIDashboardDropDownList").setModel({dataSource:[]});this.dashboardDesigner.element.find("#"+this.id+"_sharedds_alog").css("display",this.dashboardDesigner.isReportServerLogin()?"none":"block");this.hideValidationMsg()},n.prototype.hideValidationMsg=function(){this.renderValidation(this.id+"_shared_txt",!1);this.renderValidation(this.id+"_shared_data_drdwn",!1)},n.prototype.setDataSetName=function(n){var t=this.configTable.find("#"+this.id+"_shared_txt"),i="";n&&(i=n.Name,t.val(n.Name));t.val(this.dataset.isEdit?i:this.dataset.getAvailableName())},n.prototype.showConfiguration=function(n){this.configTable.css("display",n?"block":"none")},n.prototype.getDataSetName=function(){var n=this.configTable.find("#"+this.id+"_shared_data_drdwn").data("BoldBIDashboardDropDownList"),t;return n.model.selectedIndex!==-1?(t=n.getListData(),t&&t.length>0)?t[n.model.selectedIndex].Id:n.getSelectedValue():""},n.prototype.getDataSetInfo=function(){var n=this.getDataSetName(),t;this.renderValidation(this.id+"_shared_data_drdwn",!n,"Select a shared DataSource");t=this.validateDataSetName();n&&t&&(this.datasetReference=n,this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.sharedDataSet,data:JSON.stringify({designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.sharedDataSet,reportInfo:{dataSetRefer:n}})},{fnction:this.bbdesigner$.proxy(this.saveDataSets,this),indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]}))},n.prototype.loadDataSetCatalog=function(){this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.dataSetCatalog,data:JSON.stringify({designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.dataSetCatalog,reportInfo:{}})},{fnction:this.bbdesigner$.proxy(this.populateDataSets,this),indicator:[this.bbdesigner$.proxy(this.showLoadingIndicator,this),this.bbdesigner$.proxy(this.hideLoadingIndicator,this)]})},n.prototype.populateDataSets=function(n){if(n&&typeof n!="string"&&n.indexOf("Sf_Exception")===-1){var t=this.configTable.find("#"+this.id+"_shared_data_drdwn").data("BoldBIDashboardDropDownList");t.setModel({dataSource:n});this.datasetReference&&this.dataset.isEdit&&(BoldBIDashboard.DashboardUtil.isGuid(this.datasetReference)?t.selectItemByValue(this.datasetReference):t.selectItemByText(this.datasetReference))}},n.prototype.saveDataSets=function(n){var t,r,i,u;if(n){if(t=BoldBIDashboardQueryDesigner.createDataSet(),r=this.createSharedData(),t.Name=this.configTable.find("#"+this.id+"_shared_txt").val(),t.Query=null,n.Fields.length>0)for(t.Fields=[],i=0;i<n.Fields.length;i++)u=n.Fields[i],u.__type="Syncfusion.RDL.DOM.Field",t.Fields.push(u);r.SharedDataSetReference=this.datasetReference;t.SharedDataSet=r;this.dataset.isEdit?this.dataset.updateDataSet(this.dataSetItem,t):this.dataset.addDataSet(t);this.dataset.isEdit=!1;this.dataset.switchPanel(PanelList.DataList)}},n.prototype.validateDataSetName=function(){var n=this.configTable.find("#"+this.id+"_shared_txt").val();if(n){if(this.isAvailable(n))return this.renderValidation(this.id+"_shared_txt",!0,"The specified name already exists in DataSet list"),!1;if(!/^[a-zA-Z0-9-_]*$/.test(n))return this.renderValidation(this.id+"_shared_txt",!0,"Name should not contain spaces and special characters"),!1}else return this.renderValidation(this.id+"_shared_txt",!0,"Specify the DataSet name"),!1;return this.renderValidation(this.id+"_shared_txt",!1),!0},n.prototype.isAvailable=function(n){var r=this,u=this.dashboardDesigner.element.find("#"+this.id+"_div_datasetUl>li>div>.bbi-designer-treeText"),t=!1,i=this;return u.each(function(u,f){if(r.bbdesigner$(f).text()===n&&!(i.dataSetItem&&n===i.dataSetItem.Name)){t=!0;return}}),t},n.prototype.renderValidation=function(n,t,i){var r=this.dashboardDesigner.element.find("#"+n+"_error_icon_td"),u=this.dashboardDesigner.element.find("#"+n+"_td").find(".bbi-designer-content-label");t?(BoldBIDashboard.DashboardUtil.showErrIndictor(r,!0,i),u.addClass("bbi-designer-error")):(BoldBIDashboard.DashboardUtil.showErrIndictor(r,!1),u.removeClass("bbi-designer-error"));this.dashboardDesigner.element.find("#"+this.id+"_sharedDSBodyContainer").data("BoldBIDashboardScroller")&&this.dashboardDesigner.element.find("#"+this.id+"_sharedDSBodyContainer").data("BoldBIDashboardScroller").refresh()},n.prototype.isLoaded=function(){return!BoldBIDashboard.isNullOrUndefined(this.configTable)},n.prototype.updateControlSize=function(){this.dashboardDesigner.element.find("#"+this.id+"_sharedDSBodyContainer").height()>this.dashboardDesigner.element.find("#"+this.id+"_sharedDSContainer").height()?(this.configTable.find("#"+this.id+"_shared_txt").css("width","218px"),this.dashboardDesigner.element.find("#"+this.id+"_shared_dropdown_lbl_td").css("width","215px"),this.dashboardDesigner.element.find("#"+this.id+"_shared_txt_lbl_td").css("width","215px"),this.dashboardDesigner.element.find("#"+this.id+"_shared_data_drdwn").data("BoldBIDashboardDropDownList").setModel({width:"231px"})):(this.configTable.find("#"+this.id+"_shared_txt").css("width","208px"),this.dashboardDesigner.element.find("#"+this.id+"_shared_dropdown_lbl_td").css("width","205px"),this.dashboardDesigner.element.find("#"+this.id+"_shared_txt_lbl_td").css("width","205px"),this.dashboardDesigner.element.find("#"+this.id+"_shared_data_drdwn").data("BoldBIDashboardDropDownList").setModel({width:"221px"}))},n.prototype.createSharedData=function(){return{__type:"Syncfusion.RDL.DOM.SharedDataSet",SharedDataSetReference:"",QueryParameters:[]}},n.prototype.showLoadingIndicator=function(){this.bbdesigner$("#"+this.id+"_shared_data_drdwn_dropdown").addClass("e-load");this.bbdesigner$("#"+this.id+"_shared_data_drdwn_dropdown>span").removeClass("e-arrow-sans-down")},n.prototype.hideLoadingIndicator=function(){this.bbdesigner$("#"+this.id+"_shared_data_drdwn_dropdown").removeClass("e-load");this.bbdesigner$("#"+this.id+"_shared_data_drdwn_dropdown>span").addClass("e-arrow-sans-down")},n.prototype.showIndicator=function(){this.dashboardDesigner.element.find("#"+this.id+"_sharedDSBodyContainer").data("BoldBIDashboardWaitingPopup").show()},n.prototype.hideIndicator=function(){this.dashboardDesigner.element.find("#"+this.id+"_sharedDSBodyContainer").data("BoldBIDashboardWaitingPopup").hide()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.SharedDataSet",InternalSharedDataSet,window);InternalToolbar=function(){function n(n,t){this.zoomSelectedIndex=-1;this.createReportText="New Dashboard";this.createButtonText="Create";this.openReportText="Open Dashboard";this.items=["25%","50%","75%","100%","150%","200%","250%","300%","350%","400%"];this.fileWaterMark="Report Name";this.filterSerializer=null;this.relativeDateTimer=null;this.locale=null;this.dataSampleEnable=null;this.dataSampleCheck=null;this.isDataSampleEnabled=!0;this.isThresHoldEnabled=!1;this.targetTag=t;this.designer=n;this.bbdesigner$=this.designer.bbdesigner$;this.locale=n.getLocalizationContent();this.id=this.designer._id;this.measureFormat=new MeasureFormatting;(this.designer.isDesignMode()||this.designer.isDesignPreviewMode()||this.designer.isViewMode())&&(this.filterSerializer=this.designer.modules.masterSlaveFilter,this.propertyPanel=this.designer.modules.propertyPanel,this.widgetHelper=this.designer.modules.widgetHelper);(this.designer.isDesignMode()||this.designer.isDesignPreviewMode()||this.designer.model.mode===BoldBIDashboard.Designer.mode.datasource)&&(this.queryDesigner=this.designer.modules.queryDesigner)}return n.prototype.renderToolBar=function(n,t,i){var e=this.designer.model.toolbarSettings,r,f,u;if(e.templateId)u=this.designer.element.find("#"+e.templateId),n.append(u),u.BoldBIDashboardToolbar({isResponsive:!0,enableSeparator:!0,height:u.height(),click:this.designer.model.toolbarClick}),u.css("display","block");else{this.toolBar=BoldBIDashboard.buildTag("div.bbi-designer-toolbarcontainer","",{width:i+"px",height:t+"px"},{id:this.id+"_toolBar"});n.append(this.toolBar);r=BoldBIDashboard.buildTag("ul.bbi-designer-toolbarul","",{"padding-left":"5px"},{});this.appendSplitBtn(r,this.locale.toolBar.publish,"bbi-designer-toolbar-save bbi-li-item bbi-dbrd-hand-cursor","2.5px 0px 0px 1px",this.id+"_saveConfigMenu");f=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-hoverable","",{},{"data-tooltip":"Property",id:this.id+"_saveMenu"});this.populateMenuItems(f,[{id:"save",text:this.locale.saveMenuItemsText.publish},{id:"saveAs",text:this.locale.saveMenuItemsText.publishAs}],"save");this.toolBar.append(f);r=BoldBIDashboard.buildTag("ul.bbi-designer-toolbarul bbi-dbrd-title-ul","",{});this.appendToolbarTitle(r);this.toolBar.append(r,BoldBIDashboard.DashboardUtil.getSeperator());this.createDesignerToolbarIcons();r=BoldBIDashboard.buildTag("ul.bbi-designer-toolbarul","",{});this.appendToolbarTogglebutton(r);this.toolBar.append(r);this.appendPreview(this.toolBar);this.toolBar.BoldBIDashboardToolbar({isResponsive:!0,height:t+"px",width:i+"px",cssClass:"bbi-designer-toolbar bbi-dbrd-responsive-toolbar",enableSeparator:!1,click:this.bbdesigner$.proxy(this.toolbarClick,this)});this.titleTextBox.on("focusout",this.bbdesigner$.proxy(this.saveToolBarTitle,this))}this.renderFUpload();this.renderNewFile();this.designer.toolbarTag=this.toolBar;this.ejDesignerTool=this.toolBar.data("BoldBIDashboardToolbar");this.designer.model.mode===BoldBIDashboard.Designer.mode.datasource&&this.toolBar.css("display","none");this.unWireEvents();this.wireEvents()},n.prototype.createDesignerToolbarIcons=function(){var n=[];n.push({"class":"bbi-designer-toolbar-cut",label:this.locale.toolBar.cut,elementId:this.id+"_designer_tool_cut",iconFontSize:"",enableSeperator:!1,iconTooltip:this.locale.toolBar.cut,iconType:"default"});n.push({"class":"bbi-designer-toolbar-copy",label:this.locale.toolBar.copy,elementId:this.id+"_designer_tool_copy",iconFontSize:"",enableSeperator:!1,iconTooltip:this.locale.toolBar.copy,iconType:"default"});n.push({"class":"bbi-designer-toolbar-paste",label:this.locale.toolBar.paste,elementId:this.id+"_designer_tool_paste",iconFontSize:"",enableSeperator:!1,iconTooltip:this.locale.toolBar.paste,iconType:"default"});n.push({"class":"bbi-designer-toolbar-delete",label:this.locale.toolBar.Delete,elementId:this.id+"_designer_tool_delete",iconFontSize:"",enableSeperator:!0,iconTooltip:this.locale.toolBar.Delete,iconType:"default"});n.push({"class":"bbi-designer-toolbar-undo",label:this.locale.toolBar.undo,elementId:this.id+"_designer_tool_undo",iconFontSize:"",enableSeperator:!1,iconTooltip:this.locale.toolBar.undo,iconType:"default"});n.push({"class":"bbi-designer-toolbar-redo",label:this.locale.toolBar.redo,elementId:this.id+"_designer_tool_redo",iconFontSize:"",enableSeperator:!0,iconTooltip:this.locale.toolBar.redo,iconType:"default"});n.push({"class":"bbi-designer-configuration-parameters",label:this.locale.toolBar.filter,elementId:this.id+"_designer_tool_filter",iconFontSize:"",enableSeperator:!1,iconTooltip:this.locale.toolBar.filter,iconType:"default"});n.push({"class":"bbi-designer-toolbar-datacache-icon bbi-designer-toolbar-datacache",label:this.locale.dataSource.dataCacheHeaderText,elementId:this.id+"_designer_tool_datacache",iconFontSize:"",enableSeperator:!1,iconTooltip:this.locale.dataSource.dataCacheHeaderText,iconType:"default"});n.push({"class":"bbi-toolbar-refreshsettings-icon e-dbrd-banner-refresh",label:this.locale.toolBar.refreshSettings,elementId:this.id+"_designer_tool_refreshsettings",iconFontSize:"",enableSeperator:!1,iconTooltip:this.locale.toolBar.refreshSettings,iconType:"default"});this.designer._trigger("beforeDesignerToolbarIconsRendered",{toolbarIcons:n});this.designer.modules.util.renderToolbarIcons(n,this.toolBar)},n.prototype.renderFUpload=function(){var n=this,t=BoldBIDashboard.buildTag("div","",{height:"0px"},{id:this.id+"_rdl_upload"});this.designer.element.append(t);t.BoldBIDashboardUploadbox({width:"0px",height:"0px",uploadName:"file",extensionsAllow:".rdl",autoUpload:!0,showFileDetails:!1,dialogAction:{content:this.designer.element},saveUrl:this.designer.model.serviceUrl+"/UploadReportAction",fileSelect:this.bbdesigner$.proxy(this.onfileSelect,this),error:this.bbdesigner$.proxy(this.onuploadError,this),complete:this.bbdesigner$.proxy(this.onuploadComplete,this),beforeSend:function(t){n.designer.showDesignIndicator(null);n.designer.beforeSendRequestForUploadbox(n.designer,"UploadAction",t)}});t.hide()},n.prototype.populateMenuItems=function(n,t,i){for(var f,u,s=t.length,o=BoldBIDashboard.buildTag("ul.bbi-designer-menu","",{},{id:this.id+"_"+i+"ConfigMenu"}),e=[],r=0;r<s;r++)if(f=t[r],e.push({id:f.id,text:f.text,parentId:null}),t[r].Items)for(u=0;u<t[r].Items.length;u++)e.push({id:t[r].Items[u].id,text:t[r].Items[u].text,parentId:f.id});n.append(o);o.BoldBIDashboardMenu({menuType:BoldBIDashboard.MenuType.ContextMenu,openOnClick:!1,ontextMenuTarget:"#"+this.toolBar.attr("id"),subMenuDirection:"right",fields:{dataSource:e,id:"id",parentId:"parentId",text:"text"},click:this.bbdesigner$.proxy(this.onFileActionChange,this)})},n.prototype.onSettingsLeave=function(){var t=this.bbdesigner$("#"+this.id+"_openConfigMenu").data("BoldBIDashboardMenu"),n;t&&t.hide();n=this.bbdesigner$("#"+this.id+"_saveConfigMenu").data("BoldBIDashboardMenu");n&&n.hide()},n.prototype.onFileActionChange=function(n){var t;n.ID==="fromDevice"?(t=this.designer.triggerEvents("openReportClick",{target:n,select:"Device"}),t||this.browseDiskReport()):n.ID==="fromServer"?(t=this.designer.triggerEvents("openReportClick",{target:n,select:"Server"}),t||this.openServerClick()):n.ID==="save"?(t=this.designer.triggerEvents("saveReportClick",{target:n,select:"Save"}),t||this.designer.saveAsReport()):n.ID==="toDevice"?(t=this.designer.triggerEvents("saveReportClick",{target:n,select:"SaveAsDevice"}),t||this.designer.downloadReport()):(n.ID==="toServer"||n.ID==="saveAs")&&(t=this.designer.triggerEvents("saveReportClick",{target:n,select:"SaveAsServer"}),t||this.saveServerClick())},n.prototype.appendToolbarTitle=function(n){this.titleTextBox=BoldBIDashboard.buildTag("input.e-textbox .e-reportdesigner-title-textbox","",{height:"26px",width:"200px"},{type:"text",id:this.id+"_toolbar_title"});n.append(this.titleTextBox)},n.prototype.appendToolbarTogglebutton=function(n){this.dataSampleEnable=n.find(".e-designe-switcher-wrap");this.dataSampleCheck=n.find(".e-switcher-check")},n.prototype.switcherChanged=function(){this.isDataSampleEnabled=this.dataSampleCheck.is(":checked");this.queryDesigner=this.designer.modules.queryDesigner;this.designer.modules.util.doAjaxPost("POST",this.designer.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.notifypropertychange,{action:BoldBIDashboard.DashboardUtil.DesignerAction.DataSampleCheck,data:JSON.stringify({designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.DataSampleCheck,isDataSampleEnable:this.isDataSampleEnabled})},{});this.designer.modules.dataSet.pouplateDataSets()},n.prototype.updateDataSample=function(n){n?this.dataSampleCheck.prop("checked",!0):this.dataSampleCheck.prop("checked",!1)},n.prototype.ShowDataSample=function(n){n?this.dataSampleCheck.removeAttr("disabled"):this.dataSampleCheck.attr("disabled","true")},n.prototype.saveToolBarTitle=function(){var n=this.designer.designerPanel.getDesignProperty();this.propertyPanel.targetDesignArea="Dashboard";this.propertyPanel.onValueChange({name:"Name",value:n.Header},"General","Dashboard",!1,!0)},n.prototype.getDashboardTitleText=function(){return this.titleTextBox.val()},n.prototype.updateDashboardTitleText=function(n){BoldBIDashboard.isNullOrUndefined(n)||this.titleTextBox.val(n)},n.prototype.onPublishBtnClick=function(n){n.type==="click"?BoldBIDashboard.isNullOrUndefined(n.currentTarget)||n.currentTarget.id!==this.id+"_publishButton_menu"?this.designer.saveAsReport(n):this.saveServerClick(n):n.type==="itemSelected"&&this.saveServerClick(n)},n.prototype.triggerActionBeginForPublish=function(n){var t=!BoldBIDashboard.isNullOrUndefined(this.designer.model.serverSettings)&&!BoldBIDashboard.isNullOrUndefined(this.designer.model.serverSettings.enableMarkAsPublic)?this.designer.model.serverSettings.enableMarkAsPublic:!1,i=!BoldBIDashboard.isNullOrUndefined(this.designer.model.serverSettings)&&!BoldBIDashboard.isNullOrUndefined(this.designer.model.serverSettings.isPublic)?this.designer.model.serverSettings.isPublic:!1;return this.designer._trigger("actionBegin",{eventType:"publishAsAction",source:{element:n,data:{dashboardId:this.designer.model.itemId,dashboardName:this.designer.reportFileName,dashboardDescription:this.designer.dashboardDescription,enablePublicCheckbox:t,isPublicDashboard:i}}})},n.prototype.appendSplitBtn=function(n,t,i,r,u){var e=BoldBIDashboard.buildTag("li.bbi-designer-toolbarli bbi-designer-splitbtn bbi-dbrd-designer-hoverable bbi-dbrd-icon-background-theme","",{width:"37px"},{id:this.id+"_toolbar_li_"+t,"data-tooltip":t}),f=BoldBIDashboard.buildTag("span.e-split e-drop e-widget","",{width:"37px",display:"inline-table",margin:r},{id:this.id+"_toolbar_"+t}),o=BoldBIDashboard.buildTag("span.e-in-wrap e-box e-padding"),s=BoldBIDashboard.buildTag("button.e-splitbutton e-js e-btn e-split-btn e-ntouch e-left-btn bbi-dbrd-hand-cursor e-droparrowright bbi-designer-click bbi-designer-ejwidgets-splitbtn bbi-dbrd-icon-background-theme","",{height:"25px",width:"35px","padding-right":"12px"},{id:this.id+"_splitbtn_"+t,"e-target":u,type:"button"}),c=BoldBIDashboard.buildTag("div"),l=BoldBIDashboard.buildTag("span.bbi-toolbarfonticonbasic "+i),h=BoldBIDashboard.buildTag("div.e-split-btn-div","",{position:"absolute",height:"100%"}),a=BoldBIDashboard.buildTag("span.e-icon e-arrow-sans-down","",{"padding-top":"4px"});h.append(a);c.append(l);s.append(h);o.append(s);f.append(o);e.append(f);n.append(e);u&&u.length>0&&f.attr("e-target",u)},n.prototype.appendPreview=function(n){var t=this,r=[],i=null,u=null,o=BoldBIDashboard.buildTag("ul.bbi-designer-toolbarul bbi-toolbar-right-ul","",{}),s=BoldBIDashboard.buildTag("ul.bbi-designer-toolbarul bbi-toolbar-savestatuslabel-ul","",{}),f,e;this.saveStatusWarning=BoldBIDashboard.buildTag("span.bbi-ddr-draft-status","",{},{id:this.id+"_auto_save_status_icon"});this.saveStatusLabel=BoldBIDashboard.buildTag("label.bbi-designer-toolbar-content-label","",{},{id:this.id+"_auto_save_status_label"});f=BoldBIDashboard.buildTag("div.bbi-designer-content-container","",{float:"right","margin-right":"10px"},{});r.push({"class":"bbi-designer-toolbar-secondary-btn bbi-preview-btn ",label:this.locale.menuBar.previewText,elementId:this.id+"_previewButton"});r.push({"class":"bbi-dbrd-btn-primary bbi-designer-toolbar-publish-btn",label:this.locale.saveMenuItemsText.publish,elementId:this.id+"_publishButton"});r.push({"class":"bbi-dbrd-btn-primary bbi-designer-toolbar-publishas-btn",label:this.locale.saveMenuItemsText.publishAs,elementId:this.id+"_publishButton_menu"});this.designer.model.mode===BoldBIDashboard.Designer.mode.design&&this.designer._trigger("beforeDesignerToolbarButtonsRendered",{toolbarButtons:r});r.length!==0&&(i=BoldBIDashboard.buildTag("div.bbi-prerview-btn-wrapper","",{},{id:this.id+"_div_preview_btn"}),i.append(BoldBIDashboard.DashboardUtil.getSeperator()),e=r.filter(function(n){return n.elementId===t.id+"_publishButton_menu"||n.elementId===t.id+"_publishButton"}).length===2,r.forEach(function(n){var o=BoldBIDashboard.buildTag("div.bbi-btn-wrapper","",{},{}),f=BoldBIDashboard.buildTag("button."+(BoldBIDashboard.isNullOrUndefined(n.class)?"":n.class),n.label,{},{id:t.designer.generateUniqueButtonId(n),type:"button"}),s;n.elementId===t.id+"_publishButton"?e?(u=BoldBIDashboard.buildTag("div.bbi-publish-btn-wrapper","",{},{id:t.id+"_div_publish_btn"}),f.removeClass("bbi-dbrd-btn-primary"),s=r.filter(function(n){return n.elementId===t.id+"_publishButton_menu"})[0].label,t.appendPublishButton(u,f,s),i.append(u)):t.appendToolBarButtons(o,f,i):n.elementId===t.id+"_publishButton_menu"?e||t.appendToolBarButtons(o,f,i):n.elementId===t.id+"_previewButton"?(o.append(f),i.append(o)):(f.hasClass("bbi-dbrd-btn-primary")||f.hasClass("bbi-designer-toolbar-secondary-btn")||f.addClass("bbi-designer-toolbar-secondary-btn"),f.bind("click",t.bbdesigner$.proxy(t.toolbarClick,t)),o.append(f),i.append(o))}));f.append(this.saveStatusWarning,this.saveStatusLabel);r.length!==0&&o.append(i);BoldBIDashboard.isNullOrUndefined(i)||i.find(".bbi-toolbar-seperator").css({display:"none"});s.append(f);n.append(s,o);this.designer.model.mode!==BoldBIDashboard.Designer.mode.connection&&this.saveStatusLabel.BoldBIDashboardTooltip({content:"",isBalloon:!1,beforeOpen:this.bbdesigner$.proxy(function(n){var i=t.saveStatusLabel.attr("data-datetime"),r,u;BoldBIDashboard.isNullOrUndefined(i)&&i===""?n.cancel=!0:(r=new Date(i),n.model.content=t.saveStatusWarning.hasClass("bbi-ddr-draft-status-progress")?t.locale.toolBar.saving:t.saveStatusWarning.hasClass("bbi-ddr-draft-status-error")?t.locale.toolBar.draftError+":"+(BoldBIDashboard.isNullOrUndefined(i)||i===""?"Never":BoldBIDashboard.globalize.format(r,t.designer.model.localeSettings.dateFormat,t.designer.model.localeSettings.culture)+" "+BoldBIDashboard.globalize.format(r,t.designer.model.localeSettings.timeFormat,t.designer.model.localeSettings.culture)):t.locale.toolBar.lastSave+BoldBIDashboard.globalize.format(r,t.designer.model.localeSettings.dateFormat,t.designer.model.localeSettings.culture)+" "+BoldBIDashboard.globalize.format(r,t.designer.model.localeSettings.timeFormat,t.designer.model.localeSettings.culture),u=t.saveStatusLabel.data("BoldBIDashboardTooltip"),u.tooltipContent.html(n.model.content))},this)})},n.prototype.appendToolBarButtons=function(n,t,i){n.append(t);i.append(n);t.bind("click",this.bbdesigner$.proxy(this.toolbarClick,this))},n.prototype.appendPublishButton=function(n,t,i){var r=BoldBIDashboard.buildTag("ul.bbi-publish-menu-ul","",{},{id:this.id+"_publishButton_menu"}),u=BoldBIDashboard.buildTag("li","",{id:this.id+"_publishButton_menu_li"}),f=BoldBIDashboard.buildTag("a",i,{}).attr({href:"javascript:void(0)"}),e=BoldBIDashboard.buildTag("span.e-dbrd-toolbar-seperator","",{},{id:this.id+""});u.append(f);r.append(u);n.append(t,e,r);t.BoldBIDashboardSplitButton({targetID:this.id+"_publishButton_menu",width:"100%",height:"30px",click:this.bbdesigner$.proxy(this.toolbarClick,this),itemSelected:this.bbdesigner$.proxy(this.toolbarClick,this)})},n.prototype.setZoomSelectedIndex=function(n){this.zoomSelectedIndex=n},n.prototype.getZoomValue=function(n){var t=0;return n?this.zoomSelectedIndex===0?t=parseInt(this.items[this.zoomSelectedIndex].split("%")[0],10):(t=parseInt(this.items[this.zoomSelectedIndex-1].split("%")[0],10),this.zoomSelectedIndex=this.zoomSelectedIndex-1):this.zoomSelectedIndex===this.items.length-1?t=parseInt(this.items[this.zoomSelectedIndex].split("%")[0],10):(t=parseInt(this.items[this.zoomSelectedIndex+1].split("%")[0],10),this.zoomSelectedIndex=this.zoomSelectedIndex+1),t},n.prototype.toolbarClick=function(n){var t,r,e,u,f,o,i,s;this.onSettingsLeave(n);if(t=this.bbdesigner$(n.target),r=this.bbdesigner$(t).closest(".bbi-designer-toolbarli"),this.bbdesigner$(t).hasClass("bbi-designer-toolbarli")?t=this.bbdesigner$(t).find("span.bbi-li-item"):r.length>0&&(e=this.bbdesigner$(r),t=e.find("span.bbi-li-item")),t.hasClass("bbi-designer-toolbar-open-folder"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Open"}),i||(u=this.bbdesigner$("#"+this.id+"_openConfigMenu"),u.is(":visible")?u.hide():this.showOpenMenu(n));else if(t.hasClass("bbi-designer-toolbar-new"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"New"}),i||this.newReportClick();else if(t.hasClass("bbi-designer-toolbar-save"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Save"}),i||(f=this.bbdesigner$("#"+this.id+"_saveConfigMenu"),f.is(":visible")?f.hide():this.showSaveMenu(n));else if(t.hasClass("bbi-designer-toolbar-undo"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Undo"}),i||window.setTimeout(function(){BoldBIDashboardDesigner.editManager.isUndo()&&BoldBIDashboardDesigner.editManager.undo()},300);else if(t.hasClass("bbi-designer-toolbar-redo"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Redo"}),i||window.setTimeout(function(){BoldBIDashboardDesigner.editManager.isRedo()&&BoldBIDashboardDesigner.editManager.redo()},300);else if(t.hasClass("bbi-designer-toolbar-cut"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Cut"}),i||this.designer.designerPanel.cutItem();else if(t.hasClass("bbi-designer-toolbar-copy"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Copy"}),i||this.designer.designerPanel.copyItem();else if(t.hasClass("bbi-designer-toolbar-paste"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Paste"}),i||this.designer.designerPanel.pasteItem();else if(t.hasClass("bbi-designer-toolbar-delete"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Delete"}),i||this.designer.designerPanel.removeItem();else if(t.hasClass("bbi-toolbar-refreshsettings-icon e-dbrd-banner-refresh"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Refresh"}),i||this.openRefreshSettings();else if(t.hasClass("bbi-designer-toolbar-datacache-icon bbi-designer-toolbar-datacache"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"DataCache"}),i||this.openDataCacheDialog();else if(t.hasClass("bbi-designer-configuration-parameters"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Filter Action"}),i||this.openFilterActionWindow();else if(t.hasClass("bbi-preview-btn"))i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Preview"}),i||this.designer.PreviewDashboard();else if(t.hasClass("bbi-designer-toolbar-publish-btn")){if(i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Publish"}),!i)this.onPublishBtnClick(n)}else if(t.hasClass("bbi-designer-toolbar-publishas-btn")){if(i=this.designer.triggerEvents("toolbarClick",{target:t,click:"Publish As"}),!i)this.onPublishBtnClick(n)}else if(t.length!==0||BoldBIDashboard.isNullOrUndefined(n.type)||BoldBIDashboard.isNullOrUndefined(n.model))s=BoldBIDashboard.DashboardUtil.IsStringNullorWhiteSpace(t.html())?this.bbdesigner$(t).closest(".bbi-designer-toolbarli").attr("data-tooltip"):t.html(),this.designer.triggerEvents("toolbarClick",{target:n,click:s});else{o=n.type;i=!1;switch(o){case"click":i=this.designer.triggerEvents("toolbarClick",{target:this.toolBar.find("#"+this.id+"_publishButton"),click:"Publish"});break;case"itemSelected":i=this.designer.triggerEvents("toolbarClick",{target:this.bbdesigner$.find(n.model.target),click:"Publish As"})}if(!i)this.onPublishBtnClick(n)}},n.prototype.openDataCacheDialog=function(){var n=this.designer.modules.dataCache;n.renderCacheDialog();n.openDataCacheDialog(this.designer.cacheSettings!=null&&this.designer.cacheSettings.isCacheEnable===!0?this.designer.cacheSettings:n)},n.prototype.openFilterActionWindow=function(){var n;this.filterSerializer.filterObject.filterConfigurationModel!=null?(this.filterSerializer.filterObject.filterConfigurationModel.MastersCollection=this.removeDuplicateWidgetCollection(),this.filterSerializer.RefreshMasterSlaveTitle(),n=this.bbdesigner$.parseJSON(JSON.stringify(this.filterSerializer.filterObject.filterConfigurationModel))):n=this.bbdesigner$.parseJSON(JSON.stringify(this.filterSerializer.GetWidgetCollectionsFromContainer()));this.designer.modules.filterConfiguration.openFilterConfiguration(this,"filterUpdate",n)},n.prototype.removeDuplicateWidgetCollection=function(){var n=[];return this.filterSerializer.filterObject.filterConfigurationModel.MastersCollection.forEach(function(t){n.filter(function(n){return n.MasterInfo.UniqueId===t.MasterInfo.UniqueId}).length===0&&n.push(t)}),n},n.prototype.openRefreshSettings=function(){var n=this.designer.modules.refreshDialog;n.openRefreshDialog(this.designer.refreshSetting,this.bbdesigner$.proxy(n.updateRefreshSetting,n))},n.prototype.updateFilterCondition=function(n,t){var c=this.designer.designerPanel.selectedReportItems[0],u,e,s,i,o,r,f,h;if(!BoldBIDashboard.isNullOrUndefined(c))if(u=this.widgetHelper.getCurrentWidgetInstance(),e=this.designer.modules.propertyPanel,n)t||this.filterSerializer.RemoveSelectedWidgetFromFilterObject(),BoldBIDashboard.isNullOrUndefined(u)||BoldBIDashboard.isNullOrUndefined(u.getJson())||(u.getJson().FilterSettings.ActAsMasterWidget=t,e.isVisible()&&(s={name:"ActAsMasterWidget",value:t},e.setBoolean(null,null,"Filter",s,u.Type)));else if(this.filterSerializer.filterObject.filterConfigurationModel!=null)for(i=this.filterSerializer.filterObject.filterConfigurationModel.MastersCollection,o=[],r=0;r<i.length;r++)if(i[r].ProfileManager.length>0){for(f=0;f<i[r].ProfileManager.length;f++)i[r].ProfileManager[f].ProfileInfo.Option||(h=BoldBIDashboard.Dashboard.WidgetHelper.getWidgetInstance(this.designer.element.find("#"+this.designer._id+"_"+i[r].MasterInfo.ID)),o=this.filterSerializer.getFilterCondition(h),i[r].ProfileManager[f].ProfileInfo.FilterCondition=o);this.filterSerializer.masterSlaveFilterSerializer(i)}},n.prototype.removeFilterCondition=function(n){var t,i,r,u;if(!BoldBIDashboard.isNullOrUndefined(n)&&!BoldBIDashboard.isNullOrUndefined(this.filterSerializer.filterObject)&&!BoldBIDashboard.isNullOrUndefined(this.filterSerializer.filterObject.filterConfigurationModel)&&!BoldBIDashboard.isNullOrUndefined(this.filterSerializer.filterObject.filterConfigurationModel.MastersCollection)){for(t=this.filterSerializer.filterObject.filterConfigurationModel.MastersCollection,i=0;i<t.length;i++)for(r=0;r<t[i].ProfileManager.length;r++)for(u=0;u<t[i].ProfileManager[r].ProfileInfo.FilterCondition.length;u++)t[i].ProfileManager[r].ProfileInfo.FilterCondition[u].DataSource.ID===n&&t[i].ProfileManager[r].ProfileInfo.FilterCondition.splice(u,1);this.filterSerializer.masterSlaveFilterSerializer(t)}},n.prototype.filterUpdate=function(n){this.setWidgetAsMaster(n);this.filterSerializer.filterObject.filterConfigurationModel=n;this.filterSerializer.masterSlaveFilterSerializer(this.filterSerializer.filterObject.filterConfigurationModel.MastersCollection);setTimeout(function(n){n.filterSerializer.updatePoPSettings()},200,this)},n.prototype.setWidgetAsMaster=function(n){for(var t,u,s,e,i,o=this.designer.modules.propertyPanel,f=this.filterSerializer.getMastetFilterWidgets(),r=0;r<f.length;r++){for(t=f[r],t.getJson().FilterSettings.ActAsMasterWidget=!1,u=0;u<n.MastersCollection.length;u++)if(n.MastersCollection[u].MasterInfo.ID===f[r].Name){i={name:"ActAsMasterWidget",value:!0};s=t.getJson().FilterSettings.ActAsMasterWidget;t.getJson().FilterSettings.ActAsMasterWidget=!0;t.updatePropertyChange(i.name,s,!0,i);break}e=t.getJson().FilterSettings.ActAsMasterWidget;t.ControlContainer.find(".bbi-dbrd-control-header").length!==0&&(this.filterSerializer.showOrHideClearFilterIcon(t.ControlContainer.find(".bbi-dbrd-control-header"),e),o.isVisible()&&!BoldBIDashboard.isNullOrUndefined(this.widgetHelper.getCurrentWidgetInstance())&&this.widgetHelper.getCurrentWidgetInstance().Name===t.Name&&(i={name:"ActAsMasterWidget",value:e},o.setBoolean(null,null,"Filter",i,t.Type)))}},n.prototype.getAvailableReportItems=function(){for(var r,u=this.designer.modules.Mode.designCanvas,t=u.find(".bbi-dbrditem"),i=[],n=0;n<t.length;n++)r=BoldBIDashboard.Dashboard.WidgetHelper.getWidgetInstance(this.bbdesigner$(t[n])),i.push(r.getJson());return i},n.prototype.renderNewFile=function(){var l;this.newFileDiv=BoldBIDashboard.buildTag("div.bbi-userselect","",{padding:"2px"},{id:this.id+"_createFileContainer",title:this.createReportText});var t=BoldBIDashboard.buildTag("div","",{width:"100%",height:"80px"}),n=BoldBIDashboard.buildTag("table","",{id:this.id+"_createFileInternalContainer"}),i=BoldBIDashboard.buildTag("tr","",{}),r=BoldBIDashboard.buildTag("td","",{"padding-bottom":"5px"}),a=BoldBIDashboard.buildTag("Label.bbi-designer-fontfamily","File Name",{"font-size":"12px","font-color":"#303541","font-weight":"600"},{type:"label"}),u=BoldBIDashboard.buildTag("tr","",{}),f=BoldBIDashboard.buildTag("td","",{}),e=BoldBIDashboard.buildTag("input.bbi-designer-inputPath e-textbox","",{"padding-left":"8px","border-radius":"2px"},{id:this.id+"_CreateInput"});BoldBIDashboard.DashboardUtil.txtWaterMark(e,this.fileWaterMark);var o=BoldBIDashboard.buildTag("tr","",{}),s=BoldBIDashboard.buildTag("td","",{}),v=BoldBIDashboard.buildTag("span.bbi-designer-errorLog bbi-designer-fontfamily","",{"font-size":"12px"}),h=BoldBIDashboard.buildTag("button.bbi-designer-cancelbtn bbi-dbrd-hand-cursor",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_cancelBtn",type:"button"}),c=BoldBIDashboard.buildTag("button.bbi-designer-okbtn bbi-dbrd-hand-cursor",this.locale.menuBar.createButtonText,{float:"right"},{id:this.id+"_CreateButton",type:"button"});this.newFileDiv.append(t);t.append(n);n.append(i);i.append(r);r.append(a);n.append(u);u.append(f);f.append(e);n.append(o);o.append(s);s.append(v);this.designer.element.append(this.newFileDiv);this.newFileDiv.BoldBIDashboardDialog({enableModal:!0,enableResize:!1,showRoundedCorner:!0,minWidth:290,minHeight:100,height:"auto",width:"auto",showOnInit:!1,showFooter:!0,containment:"#"+this.designer._id,target:"#"+this.designer._id,cssClass:"bbi-designer-dialog boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});l=this.designer.element.find("#"+this.id+"_createFileContainer_foot");l.append(h,c);c.on("click",this.bbdesigner$.proxy(this.onCreate,this));h.on("click",this.bbdesigner$.proxy(this.closeNewDialog,this,!0))},n.prototype.onCreate=function(){var n=this.designer.element.find("#"+this.id+"_CreateInput").val(),t=this.newFileDiv.find(".bbi-designer-errorLog"),i;n&&n.length>0&&n.toLowerCase()!==this.fileWaterMark.toLowerCase()?(this.callBackfn?BoldBIDashboard.DashboardUtil.invokeCallBack(this.callBackfn,{name:n}):(i=n.indexOf(".rdl")===-1?n+".rdl":n,this.designer.newRDLReport(i),t.text("")),this.newFileDiv.BoldBIDashboardDialog("close")):t.text("* Specify the report file name")},n.prototype.onfileSelect=function(n){this.designer.reportFileName=n.files[0].name},n.prototype.onuploadError=function(){this.designer.hideDesignIndicator();this.designer.modules.util.alertDialog(this.locale.alertDialogTitle.upload,this.locale.errorMessage.failedToUploadFile,IconType.errors,AlertType.Alert,!1,"")},n.prototype.closeNewDialog=function(){this.newFileDiv.find(".bbi-designer-inputPath").removeClass("bbi-designer-txtmark");this.newFileDiv.data("BoldBIDashboardDialog").close()},n.prototype.onuploadComplete=function(n){this.designer.hideDesignIndicator();this.designer.modules.util.doAjaxPost("POST",this.designer.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.openReport,data:JSON.stringify({designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.openReport,fileName:n.files.name})},{method:"openRdlJSON",instance:this.designer,indicator:["showDesignIndicator","hideDesignIndicator"]})},n.prototype.showPaste=function(n){BoldBIDashboard.isNullOrUndefined(this.toolBar.data("BoldBIDashboardToolbar"))&&this.toolBar.BoldBIDashboardToolbar();this.toolBar.BoldBIDashboardToolbar(n?"enableItem":"disableItem",this.designer.element.find("#"+this.id+"_designer_toolbar_li_Paste"))},n.prototype.showCopy=function(n){BoldBIDashboard.isNullOrUndefined(this.toolBar.data("BoldBIDashboardToolbar"))&&this.toolBar.BoldBIDashboardToolbar();this.toolBar.BoldBIDashboardToolbar(n?"enableItem":"disableItem",this.designer.element.find("#"+this.id+"_designer_toolbar_li_Copy"))},n.prototype.showDelete=function(n){BoldBIDashboard.isNullOrUndefined(this.toolBar.data("BoldBIDashboardToolbar"))&&this.toolBar.BoldBIDashboardToolbar();this.toolBar.BoldBIDashboardToolbar(n?"enableItem":"disableItem",this.designer.element.find("#"+this.id+"_designer_toolbar_li_Delete"))},n.prototype.showCut=function(n){BoldBIDashboard.isNullOrUndefined(this.toolBar.data("BoldBIDashboardToolbar"))&&this.toolBar.BoldBIDashboardToolbar();this.toolBar.BoldBIDashboardToolbar(n?"enableItem":"disableItem",this.designer.element.find("#"+this.id+"_designer_toolbar_li_Cut"))},n.prototype.showUndo=function(n){BoldBIDashboard.isNullOrUndefined(this.toolBar.data("BoldBIDashboardToolbar"))&&this.toolBar.BoldBIDashboardToolbar();this.toolBar.BoldBIDashboardToolbar(n?"enableItem":"disableItem",this.designer.element.find("#"+this.id+"_designer_toolbar_li_Undo"))},n.prototype.showRedo=function(n){BoldBIDashboard.isNullOrUndefined(this.toolBar.data("BoldBIDashboardToolbar"))&&this.toolBar.BoldBIDashboardToolbar();this.toolBar.BoldBIDashboardToolbar(n?"enableItem":"disableItem",this.designer.element.find("#"+this.id+"_designer_toolbar_li_Redo"))},n.prototype.browseDiskReport=function(){this.designer.element.find("#"+this.id+"_rdl_upload .e-uploadinput").click()},n.prototype.openNewDialog=function(n){this.callBackfn=n;this.newFileDiv.find(".bbi-designer-errorLog").text("");this.newFileDiv.find(".bbi-designer-inputPath").val(this.fileWaterMark).addClass("bbi-designer-txtmark");this.newFileDiv.data("BoldBIDashboardDialog").open()},n.prototype.newReportClick=function(){this.callBackfn=null;this.newFileDiv.find(".bbi-designer-errorLog").text("");this.newFileDiv.find(".bbi-designer-inputPath").val(this.fileWaterMark);this.newFileDiv.data("BoldBIDashboardDialog").open()},n.prototype.openServerClick=function(){var n=this.designer.modules.fileBrowse;n.openBrowseDialog(this,"openServerReport",BrowseType.Open)},n.prototype.openServerReport=function(n,t){this.designer.openReport(t+"/"+n.Name,null)},n.prototype.saveServerClick=function(n){var i=this.triggerActionBeginForPublish(n),t;i||(t=this.designer.modules.fileBrowse,t.openBrowseDialog(this,"saveServerReport",BrowseType.Publish,null,this.designer.reportFileName,this.designer.dashboardDescription))},n.prototype.saveServerReport=function(n,t,i,r,u,f){this.designer.serverCategory={name:t,description:i,category:n.Name,categoryId:n.Id,eventType:f,id:u,isPublic:!BoldBIDashboard.isNullOrUndefined(this.designer.model.serverSettings)&&!BoldBIDashboard.isNullOrUndefined(this.designer.model.serverSettings.isPublic)?this.designer.model.serverSettings.isPublic:!1};this.designer.createServerReport(this.designer.serverCategory)},n.prototype.showOpenMenu=function(n){var t=this.designer.element.find("#"+this.id+"_toolbar_li_Open"),i=t.closest("ul"),r=this.bbdesigner$("#"+this.id+"_openConfigMenu").data("BoldBIDashboardMenu");r.show(t.offset().left,i.offset().top+i.height(),this.toolBar,n)},n.prototype.showSaveMenu=function(n){var t=this.designer.element.find("#"+this.id+"_toolbar_li_Publish"),i=t.closest("ul"),r=this.bbdesigner$("#"+this.id+"_saveConfigMenu").data("BoldBIDashboardMenu");r.show(t.offset().left,i.offset().top+i.height(),this.toolBar,n)},n.prototype.updateToolbar=function(){var n=this.designer.model.toolbarSettings;this.showToolBar(n.showToolbar);this.showNewBtn(n.items&BoldBIDashboard.Designer.ToolbarItems.New);this.showOpenBtn(n.items&BoldBIDashboard.Designer.ToolbarItems.Open);this.showSaveBtn(n.items&BoldBIDashboard.Designer.ToolbarItems.Save);this.showCutBtn(n.items&BoldBIDashboard.Designer.ToolbarItems.Cut);this.showCopyBtn(n.items&BoldBIDashboard.Designer.ToolbarItems.Copy);this.showPasteBtn(n.items&BoldBIDashboard.Designer.ToolbarItems.Paste);this.showDeletBtn(n.items&BoldBIDashboard.Designer.ToolbarItems.Delete);this.showUndoBtn(n.items&BoldBIDashboard.Designer.ToolbarItems.Undo);this.showRedoBtn(n.items&BoldBIDashboard.Designer.ToolbarItems.Redo);this.showDesign(n.items&BoldBIDashboard.Designer.ToolbarItems.EditDesign)},n.prototype.showToolBar=function(n){this.toolBar.css("display",n?"block":"none")},n.prototype.showNewBtn=function(n){this.designer.element.find("#"+this.id+"_toolbar_li_New").css("display",n?"block":"none")},n.prototype.showOpenBtn=function(n){this.designer.element.find("#"+this.id+"_toolbar_li_Open").css("display",n?"block":"none")},n.prototype.showSaveBtn=function(n){this.designer.element.find("#"+this.id+"_toolbar_li_Save").css("display",n?"block":"none")},n.prototype.showCutBtn=function(n){this.designer.element.find("#"+this.id+"_designer_toolbar_li_Cut").css("display",n?"block":"none")},n.prototype.showCopyBtn=function(n){this.designer.element.find("#"+this.id+"_designer_toolbar_li_Copy").css("display",n?"block":"none")},n.prototype.showPasteBtn=function(n){this.designer.element.find("#"+this.id+"_designer_toolbar_li_Paste").css("display",n?"block":"none")},n.prototype.showDeletBtn=function(n){this.designer.element.find("#"+this.id+"_designer_toolbar_li_Delete").css("display",n?"block":"none")},n.prototype.showUndoBtn=function(n){this.designer.element.find("#"+this.id+"_designer_toolbar_li_Undo").css("display",n?"block":"none")},n.prototype.showRedoBtn=function(n){this.designer.element.find("#"+this.id+"_designer_toolbar_li_Redo").css("display",n?"block":"none")},n.prototype.showDesign=function(n){this.designer.element.find("#"+this.id+"_viewer_editdiv").css("display",n?"block":"none")},n.prototype.updateRptTextActions=function(){var n=this.designer.designerPanel,t=n.selectedReportItems&&n.selectedReportItems.length>0;this.showPaste(n.canPaste());this.showCopy(t);this.showCut(t);this.showDelete(t)},n.prototype.updateAutoSavedTime=function(n){this.saveStatusLabel&&n?(this.saveStatusWarning.removeClass("bbi-ddr-draft-status-progress").addClass("bbi-ddr-draft-status-success"),this.saveStatusLabel.attr({"data-datetime":(new Date).toISOString()}),this.updateRelativeTime(new Date),this.relativeDateTimer===null&&(this.relativeDateTimer=this.initializeRelativeTimer())):(this.saveStatusWarning.removeClass("bbi-ddr-draft-status-progress").addClass("bbi-ddr-draft-status-error"),this.saveStatusLabel.text(this.locale.saveDraftText.draftFailedMessageText),this.saveStatusWarning.show())},n.prototype.initializeRelativeTimer=function(){var n=this;return setTimeout(this.bbdesigner$.proxy(function(){n.updateRelativeTime();clearTimeout(n.relativeDateTimer);n.relativeDateTimer=n.initializeRelativeTimer()},this),6e4)},n.prototype.updateRelativeTime=function(n){var i=n||new Date,t=this.saveStatusLabel.attr("data-datetime");BoldBIDashboard.isNullOrUndefined(t)||t===""||this.saveStatusWarning.hasClass("bbi-ddr-draft-status-error bbi-ddr-draft-status-progress")||(this.saveStatusLabel.text(this.locale.saveDraftText.saveDraft+this.getRelativeTime(i,new Date(t))),this.updateToolbarForOndemandAction())},n.prototype.updateToolbarForOndemandAction=function(){var n=0,i=this.toolBar.find(".bbi-designer-toolbarul"),r=this.toolBar.find(".e-toolbar-seperator"),t;this.bbdesigner$.each(i,function(t,i){n+=i.offsetWidth});this.bbdesigner$.each(r,function(t,i){n+=i.offsetWidth});t=69;this.toolBar.width()<=n+t&&this.toolBar.find("#"+this.id+"_toolBar_target").css("display")!=="block"&&this.updateSize();this.updateSaveStatusLabel()},n.prototype.updateSaveStatusLabel=function(){var n=this.toolBar.find(".bbi-designer-toolbarul.bbi-toolbar-right-ul"),i=this.toolBar.find(".bbi-designer-toolbarul.bbi-toolbar-savestatuslabel-ul"),t=0;t=this.toolBar.find("#"+this.id+"_toolBar_target").css("display")==="block"?this.toolBar.width()-this.toolBar.find("#"+this.id+"_toolBar_target").position().left:this.toolBar.width()-(n.length>0?n.position().left:0);i.css({right:t+"px"})},n.prototype.getRelativeTime=function(n,t){var i=Math.floor((n.getTime()-t.getTime())/6e4),r=Math.floor(i/60),u=Math.floor(r/24);return i<1?this.locale.saveDraftText.draftUpdatedJustNowText:i<2?this.locale.saveDraftText.draftUpdatedAMinsAgoText:i<60?i+" "+this.locale.saveDraftText.draftUpdatedMinutesAgoText:i<120?this.locale.saveDraftText.draftUpdatedAnHourAgoText:r<24?r+" "+this.locale.saveDraftText.draftUpdatedHoursAgoText:u<2?this.locale.saveDraftText.draftUpdatedYesterdayText:u+" "+this.locale.saveDraftText.draftUpdatedDaysAgoText},n.prototype.updateCulture=function(n){var i=this.id,t;t=BoldBIDashboard.Designer.Locale[n]?BoldBIDashboard.Designer.Locale[n].menuBar:BoldBIDashboard.Designer.Locale["en-US"].menuBar;this.createReportText=t.createReport;this.createButtonText=t.createButtonText;this.openReportText=t.openReport;this.designer.element.find("#"+i+"_createFileContainer").html(this.createReportText);this.designer.element.find("#"+i+"_CreateButton").html(this.createButtonText);this.designer.element.find("#"+i+"_openFileContainer").html(this.openReportText)},n.prototype.updateSize=function(){this.ejDesignerTool.option("width",this.designer.element.find("#"+this.id+"_designerContainer").width());this.ejDesignerTool._activeItem=undefined;this.ejDesignerTool._reSizeHandler()},n.prototype.updateResponsiveMenuIcon=function(){var n=this.bbdesigner$("#"+this.id+"_toolBar_hiddenlist").find(".bbi-designer-toolbarul .bbi-designer-toolbarli").length>0,t=this.bbdesigner$("#"+this.id+"_toolBar_hiddenlist").find(".bbi-designer-toolbarul .bbi-prerview-btn-wrapper").length>0;n||t?this.toolBar.find(".e-icon.e-toolbar-res-arrow").css({display:"block"}):this.toolBar.find(".e-icon.e-toolbar-res-arrow").css({display:"none"})},n.prototype.wireEvents=function(){this.bbdesigner$("body").on("click","#"+this.id+"_previewButton",this.bbdesigner$.proxy(this.toolbarClick,this))},n.prototype.unWireEvents=function(){this.bbdesigner$("body").off("click","#"+this.id+"_previewButton",this.bbdesigner$.proxy(this.toolbarClick,this))},n.prototype.destroy=function(){this.unWireEvents()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.Toolbar",InternalToolbar,window);__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(n){var f=function(){function n(){this.FunctionUI=new t;this.Datasource=[]}return n}(),t,r,i,u,e,o,s;n.ExpressionDialogModel=f;t=function(){function n(){}return n}();n.ExpUIModel=t;r=function(){function n(){}return n}();n.ExpDatasource=r;i=function(){function n(){}return n}();n.ExpressionDataStruct=i;u=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(i);n.ExpColumnDataStruct=u,function(n){n[n.Enable=0]="Enable";n[n.Disable=1]="Disable";n[n.Hidden=2]="Hidden"}(e=n.State||(n.State={})),function(n){n.All="All";n.Numbers="Numbers";n.Aggregation="Aggregation";n.Conditional="Conditional";n.Logical="Logical";n.Date="Date";n.String="String";n.Row="Row"}(o=n.FunctionName||(n.FunctionName={})),function(n){n.All="All";n.Number="Number";n.Text="Text";n.Date="Date";n.Boolean="Boolean";n.Parameter="Parameters";n.Miscellaneous="Miscellaneous"}(s=n.FieldName||(n.FieldName={}))})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={}));InternalCredentialDialog=function(){function n(n){this.id=null;this.userWaterMark="Username";this.passwdWaterMark="Password";this.userNameTag=null;this.passwordTag=null;this.locale=null;this.id=n._id;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.renderCredentialDialog()}return n.prototype.renderCredentialDialog=function(){var d;this.divDialog=BoldBIDashboard.buildTag("div.bbi-dashboard-designer-configuration bbi-userselect","",{height:"auto"},{title:"Credential Dialog",id:this.id+"_credential_dialog"});var t=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_table_id"}),n=BoldBIDashboard.buildTag("table.bbi-designer-credential-table","",{width:"100%"},{unselectable:"on"}),i=this.bbdesigner$("<tr><\/tr>"),r=this.bbdesigner$("<td><\/td>"),g=BoldBIDashboard.buildTag("Label.bbi-designer-fontfamily","Username",{"font-size":"13px","padding-bottom":"2px"},{type:"label"}),u=this.bbdesigner$("<tr><\/tr>"),f=this.bbdesigner$("<td><\/td>"),e=this.userNameTag=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-textbox-border bbi-designer-border","",{height:"23px",width:"238px"},{type:"text",id:this.id+"_txt_box"});BoldBIDashboard.DashboardUtil.txtWaterMark(e,this.userWaterMark);var o=this.bbdesigner$("<tr><\/tr>"),s=this.bbdesigner$("<td><\/td>"),nt=BoldBIDashboard.buildTag("Label.bbi-designer-fontfamily","",{"margin-bottom":"2px",color:" red","font-size":"12px"},{type:"label",id:this.id+"_label_user_validation"}),h=this.bbdesigner$("<tr><\/tr>"),c=this.bbdesigner$("<td><\/td>"),tt=BoldBIDashboard.buildTag("Label.bbi-designer-fontfamily","Password",{"font-size":"13px","padding-bottom":"2px"},{type:"label"}),l=this.bbdesigner$("<tr><\/tr>"),a=this.bbdesigner$("<td><\/td>"),v=this.passwordTag=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-textbox-border bbi-designer-border","",{height:"23px",width:"238px"},{type:"text",id:this.id+"_pass_word"});BoldBIDashboard.DashboardUtil.txtWaterMark(v,this.passwdWaterMark,!0);var y=this.bbdesigner$("<tr><\/tr>"),p=this.bbdesigner$("<td><\/td>"),it=BoldBIDashboard.buildTag("Label.bbi-designer-fontfamily","",{"margin-bottom":"2px",color:" red","font-size":"12px"},{type:"label",id:this.id+"_label_pass_validation"}),w=this.bbdesigner$("<tr><\/tr>"),b=this.bbdesigner$("<td><\/td>"),rt=BoldBIDashboard.buildTag("Label.bbi-designer-fontfamily","",{"margin-bottom":"3px",color:" red","font-size":"13px"},{type:"label",id:this.id+"_label_alert"}),k=BoldBIDashboard.buildTag("button.bbi-designer-connect bbi-dbrd-designer-hand-cursor","",{"margin-left":"80px"},{id:this.id+"_btn_login",type:"button"});this.dashboardDesigner.element.append(this.divDialog);this.divDialog.append(t);t.append(n);i.append(r);n.append(i);r.append(g);u.append(f);n.append(u);f.append(e);n.append(o);o.append(s);s.append(nt);n.append(h);h.append(c);c.append(tt);n.append(l);l.append(a);a.append(v);n.append(y);y.append(p);p.append(it);w.append(b);n.append(w);b.append(rt);this.divDialog.BoldBIDashboardDialog({enableModal:!0,minWidth:250,width:280,enableResize:!1,showOnInit:!1,cssClass:"bbi-designer-dialog boldbi-dashboarddesigner",minHeight:75,height:"auto",showFooter:!0,containment:"#"+this.id,target:"#"+this.id,beforeClose:this.bbdesigner$.proxy(this.closeDialog,this),close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});d=this.dashboardDesigner.element.find("#"+this.id+"_credential_dialog_foot");d.append(k);k.BoldBIDashboardButton({showRoundedCorner:!1,width:"95px",size:"small",height:"30px",type:"submit",text:"Connect",click:this.bbdesigner$.proxy(this.connectLoginWindow,this,!0)});this.divDialog.BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup "+this.id+"_designer_waiting_popup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()})},n.prototype.connectLoginWindow=function(){var n=this.userNameTag.val(),t=this.passwordTag.val(),i,r;(this.userFieldValidation(this.id,n.length===0||n.toLowerCase()===this.userWaterMark,"Please enter Username"),this.passFieldValidation(this.id,t.length===0||t.toLowerCase()===this.passwdWaterMark,"Please enter Password"),n.length!==0&&t.length!==0&&n.toLowerCase()!==this.userWaterMark&&t.toLowerCase()!==this.passwdWaterMark)&&(i=this.datasourceInfo.Name,this.datasourceInfo.Username=n,this.datasourceInfo.Password=t,r={Name:i,Provider:this.datasourceInfo.ConnectionProperties.DataProvider,IsIntegrated:!1,Username:BoldBIDashboard.DashboardUtil.encryptData(n),Password:BoldBIDashboard.DashboardUtil.encryptData(t),ConnectionString:BoldBIDashboard.DashboardUtil.encryptData(this.datasourceInfo.ConnectionProperties.ConnectString)},this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.modules.util.ejInstance.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.testConnection,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.ConnectAndReconnectAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.testConnection,datasource:r})},{fnction:this.bbdesigner$.proxy(this.validateConnection,this),indicator:[this.bbdesigner$.proxy(this.showIndicator,this),this.bbdesigner$.proxy(this.hideIndicator,this)]}))},n.prototype.updateConnectionProperties=function(){var n={};return n.__type="Syncfusion.Dashboard.Web.Serialization.Model.DataSources.DataSource",n.Name=this.datasourceInfo.Name,n.Transaction=!1,n.DataSourceReference=null,n.ConnectionProperties={},n.ConnectionProperties.__type="Syncfusion.Dashboard.Web.Serialization.Model.Connection.ConnectionProperties",n.ConnectionProperties.ConnectString=this.datasourceInfo.ConnectionProperties.ConnectString,n.ConnectionProperties.EmbedCredentials=!1,n.ConnectionProperties.DataProvider=this.datasourceInfo.ConnectionProperties.DataProvider,n.ConnectionProperties.IntegratedSecurity=!1,n.ConnectionProperties.UserName=this.datasourceInfo.Username,n.ConnectionProperties.PassWord=this.datasourceInfo.Password,n.ConnectionProperties.Prompt=this.datasourceInfo.ConnectionProperties.Prompt,n},n.prototype.userFieldValidation=function(n,t,i){t?(this.divDialog.find("#"+this.id+"_label_alert").css("display","none"),this.divDialog.find("#"+n+"_label_user_validation").css("display","block"),this.divDialog.find("#"+n+"_label_user_validation").text("* "+i)):this.divDialog.find("#"+n+"_label_user_validation").css("display","none")},n.prototype.passFieldValidation=function(n,t,i){t?(this.divDialog.find("#"+this.id+"_label_alert").css("display","none"),this.divDialog.find("#"+n+"_label_pass_validation").css("display","block"),this.divDialog.find("#"+n+"_label_pass_validation").text("* "+i)):this.divDialog.find("#"+n+"_label_pass_validation").css("display","none")},n.prototype.validateConnection=function(n){n==="true"?(this.datasourceInfo=this.updateConnectionProperties(),this.divDialog.find("#"+this.id+"_label_alert").css("display","none"),this.targetInstance&&this.targetMethod&&BoldBIDashboard.DashboardUtil.invokeMethod(this.targetInstance,this.targetMethod,[this.datasourceInfo]),this.divDialog.data("BoldBIDashboardDialog").close()):(this.divDialog.find("#"+this.id+"_label_alert").css("display","block"),this.divDialog.find("#"+this.id+"_label_alert").text(n))},n.prototype.resetCredentialDialog=function(){this.userNameTag.val(this.userWaterMark).addClass("bbi-designer-txtmark");this.passwordTag.val(this.passwdWaterMark).addClass("bbi-designer-txtmark");this.divDialog.find("#"+this.id+"_label_user_validation").css("display","none");this.divDialog.find("#"+this.id+"_label_pass_validation").css("display","none");this.divDialog.find("#"+this.id+"_label_alert").css("display","none");this.datasourceInfo=null;this.targetInstance=null;this.targetMethod=null},n.prototype.openCredentialDialog=function(n,t,i,r){this.resetCredentialDialog();this.datasourceInfo=t;this.targetInstance=i;this.targetMethod=r;var u=this.divDialog.data("BoldBIDashboardDialog");u.open();u.setModel({title:t.ConnectionProperties.Prompt&&t.ConnectionProperties.Prompt.length>0?t.ConnectionProperties.Prompt:"Credential-  "+n});this.passwordTag.val(this.passwdWaterMark).addClass("bbi-designer-txtmark");this.passwordTag.attr("type","text");this.userNameTag.focus()},n.prototype.closeDialog=function(n){n.isInteraction&&this.dashboardDesigner.modules.queryDesigner.enableDataSourceDwn(!0);this.hideWaitingIndicator()},n.prototype.showIndicator=function(){BoldBIDashboard.DashboardUtil.buttonEnable(this.dashboardDesigner.element.find("#"+this.id+"_btn_login"),!1);this.divDialog.data("BoldBIDashboardWaitingPopup").show()},n.prototype.hideIndicator=function(){BoldBIDashboard.DashboardUtil.buttonEnable(this.dashboardDesigner.element.find("#"+this.id+"_btn_login"),!0);this.divDialog.data("BoldBIDashboardWaitingPopup").hide()},n.prototype.hideWaitingIndicator=function(){this.divDialog.data("BoldBIDashboardWaitingPopup")&&this.divDialog.data("BoldBIDashboardWaitingPopup").hide()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.CredentialDialog",InternalCredentialDialog,window);ConfigurationPanel=function(){function n(n,t){this.dashboardDesigner=null;this.occupyFullWidth=!1;this.resizeObj={isPropertyPanel:!0,isDataSet:!0,isParameter:!1,isImageManager:!1};this.collapseDiv=null;this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.targetTag=t;this.rendererItemPanel()}return n.prototype.rendererItemPanel=function(){var n=this.dashboardDesigner._id,i={GroupName:"Properties",DisplayName:this.locale.dataConfigurationPanel.properties,GroupClass:"bbi-dashboardicon bbi-designer-configuration-settings",GroupId:n+"_Properties"},r={GroupName:"DataSource",DisplayName:this.locale.dataConfigurationPanel.dataSource,GroupClass:"bbi-dashboardicon bbi-designer-configuration-dataset",GroupId:n+"_DataSource"},u={GroupName:"Parameters",DisplayName:"Parameters",GroupClass:"bbi-dashboardicon e-reportdesigner-configuration-parameters",GroupId:n+"_Parameters"},t;this.panelItems=[i];this.dashboardDesigner.model.designerSettings.dataSourceConfig.hideDataSourceConfig||(t=Array.prototype.slice.call(this.panelItems),t.push(r),this.panelItems=t);this.expandablePanel=BoldBIDashboard.buildTag("div.bbi-dashboard-designer-configuration","",{width:"463px",height:"100%",display:"block",overflow:"hidden",float:"left","box-sizing":"border-box"},{id:n+"_designerConfigurationPanel"});this.targetTag.append(this.expandablePanel);this.expandablePanel.css("display","none");this.renderToolBarPanel(this.panelItems)},n.prototype.showDataConfigurationPanel=function(){this.expandablePanel.css("display","block");this.expandablePanel.css("width","100%")},n.prototype.renderToolBarPanel=function(n){var r=Array.prototype.slice.call(n),t;for(this.toolBarPanel=BoldBIDashboard.buildTag("div.bbi-designer-itempanel-header","",{width:"36px",height:"100%"},{id:this.dashboardDesigner._id+"_configurationHeaderPanel"}),this.renderTooltip(),t=0;t<r.length;t++){var i=r[t],u=BoldBIDashboard.buildTag("div.bbi-designer-itempanel-wrapper bbi-dbrd-icon-background-theme","",{width:"35px",height:"35px"},{id:i.GroupId+"_wrapper"}),f=BoldBIDashboard.buildTag("div","",{cursor:"pointer"},{id:this.dashboardDesigner._id+"_"+i.GroupName,"class":i.GroupClass+" bbi-designer-itempanel-icon bbi-dbrd-designer-hoverable","data-tooltip":i.DisplayName});u.on("click",this.bbdesigner$.proxy(this.onGroupItemsClick,this,n[t]));u.append(f);this.toolBarPanel.append(u)}r.length>0&&this.renderCollapseItem();this.targetTag.append(this.toolBarPanel)},n.prototype.renderCollapseItem=function(){var n;if(this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_collapse_wrapper").length===0){this.collapseDiv=BoldBIDashboard.buildTag("div.bbi-designer-itempanel-wrapper bbi-dashboarddesigner-collapsable-item bbi-dbrd-icon-background-theme","",{},{id:this.dashboardDesigner._id+"_collapse_wrapper"});n=BoldBIDashboard.buildTag("div","",{cursor:"pointer"},{id:this.dashboardDesigner._id+"_collapseItem","class":"bbi-dashboardicon bbi-dashboarddesigner-configuration-collapse bbi-designer-itempanel-icon bbi-dbrd-icon-theme bbi-dbrd-designer-hoverable","data-tooltip":this.locale.dataConfigurationPanel.collapse});this.collapseDiv.on("click",this.bbdesigner$.proxy(this.onCollapseItemClick,this));this.collapseDiv.append(n);this.targetTag.append(this.collapseDiv)}},n.prototype.renderTooltip=function(){var n=this.dashboardDesigner._id,i=BoldBIDashboard.buildTag("div.e-tooltip-wrap e-widget bbi-userselect bbi-designer-config-tooltip","",{display:"none"},{id:n+"_config_tooltip"}),r=BoldBIDashboard.buildTag("div.e-arrowTip","",{height:"20px",width:"10px",top:"4px",display:"block"},{id:n+"_config_arrow_tooltip"}),f=BoldBIDashboard.buildTag("div.e-arrowTipOuter","",{}),e=BoldBIDashboard.buildTag("div.e-arrowTipInner","",{left:"0px",top:"1px"}),t,u;r.append(f).append(e);t=BoldBIDashboard.buildTag("div.e-tipContainer","",{});u=BoldBIDashboard.buildTag("div.e-tipcontent e-def","",{},{id:n+"_config_content_tooltip"});t.append(u);i.append(r).append(t);this.toolBarPanel.append(i)},n.prototype.onGroupItemsClick=function(n){this.selectedItem===n?(this.showConfigurationPanel(!1,n.GroupName,n),this.collapseDiv.css("display","none")):(this.showConfigurationPanel(!0,n.GroupName,n),this.collapseDiv.css("display","block"));BoldBIDashboard.DashboardUtil.refreshIndicator(this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_designSurfaceContainer"))},n.prototype.onCollapseItemClick=function(){this.collapseDiv.css("display","none");this.showConfigurationPanel(!1,this.selectedItem.GroupName,this.selectedItem);this.dashboardDesigner.modules.propertyPanel.resetDataTab()},n.prototype.getPanelItem=function(n){for(var i=Array.prototype.slice.call(this.panelItems),t=0;t<i.length;t++)if(i[t].GroupName===n)return i[t]},n.prototype.showConfigurationPanel=function(n,t,i){var h=Array.prototype.slice.call(this.panelItems),u,o,s,f,r;if(BoldBIDashboard.isNullOrUndefined(i))for(u=0;u<h.length;u++)if(this.panelItems[u].GroupName===t){i=this.panelItems[u];break}if(n||BoldBIDashboard.isNullOrUndefined(this.selectedItem)){if(n){if(o=this.validatePanelSwitch(t),!o)if(this.selectedItem.GroupName==="DataSource")if(s=this.dashboardDesigner.modules.dataSet,s.isDataSourceWiz()){var f=this.dashboardDesigner.modules.dataSource.isEdit,e=this.locale.alertDialogTitle.CancelDataSourceCreation,r=this.locale.alertWindowMesages.datasourceCancel;f&&(e=this.locale.alertDialogTitle.EditDataSourceConnection,r=this.locale.alertWindowMesages.datasourceEditing);this.dashboardDesigner.modules.util.alertDialog(e,r,IconType.information,AlertType.Confirm,!1,"",{dataInfo:{Name:t,Item:i},instance:this,method:"confirmSwitchWiz"})}else{var f=this.dashboardDesigner.modules.dataSet.isEdit,e=this.locale.alertDialogTitle.CancelDataSourceCreation,r=this.locale.alertWindowMesages.datasourceCancel;f&&(e=this.locale.alertDialogTitle.EditDataSourceConnection,r=this.locale.alertWindowMesages.datasourceEditing);this.dashboardDesigner.modules.util.alertDialog(e,r,IconType.question,AlertType.Confirm,!1,"",{dataInfo:{Name:t,Item:i},instance:this,method:"confirmSwitchWiz"})}else this.selectedItem.GroupName==="Parameters"&&(f=this.dashboardDesigner.modules.parameter.isEdit,r=this.locale.alertWindowMesages.parameterCancel,f&&(r=this.locale.alertWindowMesages.parameterEditing),this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.parameter,r,IconType.information,AlertType.Confirm,!1,"",{dataInfo:{Name:t,Item:i},instance:this,method:"confirmSwitchWiz"}));o&&this.updatePanelDisplay(t,i,!1)}}else this.toolBarPanel.find("#"+i.GroupId+"_wrapper").css("background-color","transparent"),this.validateDisplay(this.selectedItem.GroupName,!1),this.expandablePanel.css("display","none"),this.targetTag.css("width","36px"),BoldBIDashboard.isNullOrUndefined(this.dashboardDesigner)||this.updateDesignContainerWidth(this.selectedItem.GroupName==="Properties"||"DataSource"?464:254),this.selectedItem=null},n.prototype.confirmSwitchWiz=function(n,t){n&&!BoldBIDashboard.isNullOrUndefined(t)&&this.updatePanelDisplay(t.Name,t.Item,!0)},n.prototype.updatePanelDisplay=function(n,t,i){var r,u;this.expandablePanel.css("display","block");this.targetTag.css("width",n==="Properties"||"DataSource"?"500px":"290px");this.expandablePanel.css("width",n==="Properties"||"DataSource"?"464px":"254px");BoldBIDashboard.isNullOrUndefined(this.selectedItem)?BoldBIDashboard.isNullOrUndefined(this.dashboardDesigner)||this.updateDesignContainerWidth(n==="Properties"||"DataSource"?-464:-254):(this.toolBarPanel.find("#"+this.selectedItem.GroupId+"_wrapper").css("background-color","transparent"),this.validateDisplay(this.selectedItem.GroupName,!1),this.selectedItem.GroupName!==t.GroupName&&(this.selectedItem.GroupName==="Properties"||"DataSource"||t.GroupName==="Properties"||"DataSource")&&(BoldBIDashboard.isNullOrUndefined(this.dashboardDesigner)||this.updateDesignContainerWidth(t.GroupName==="Properties"||"DataSource"?-210:210)));this.selectedItem=t;this.validateDisplay(t.GroupName,!0);this.toolBarPanel.find("#"+t.GroupId+"_wrapper").css("background-color","white");this.toolBarPanel.find("#"+t.GroupId+"_wrapper").css("border-bottom-width","1px");i&&(r=this.dashboardDesigner.designerPanel.selectedItems,r.length>0&&this.selectedItem.GroupName==="Properties"&&this.bbdesigner$(r[0]).attr("designPanel")&&(u=this.dashboardDesigner.designerPanel.getDesignProperty(),this.dashboardDesigner.modules.propertyPanel.showPropertyItem(u,"Dashboard")))},n.prototype.loadDataSet=function(){var n=this.dashboardDesigner.modules.dataSet;n.isLoaded()||this.dashboardDesigner.modules.dataSet.renderContainer(this.expandablePanel)},n.prototype.validatePanelSwitch=function(n){var t=!1,r=this.expandablePanel.find("#"+this.dashboardDesigner._id+"_datasetSourceTag"),i=this.expandablePanel.find("#"+this.dashboardDesigner._id+"_dataSourceTag"),u=this.expandablePanel.find("#"+this.dashboardDesigner._id+"_parameterList");return BoldBIDashboard.isNullOrUndefined(this.selectedItem)||this.selectedItem.GroupName===n?t=!0:BoldBIDashboard.isNullOrUndefined(this.selectedItem)||(t=this.selectedItem.GroupName==="Datasource"?i.length===0||i.length>0&&i.css("display")==="block":this.selectedItem.GroupName==="DataSource"?r.length===0||r.length>0&&!this.dashboardDesigner.modules.dataSet.isConfigWizard():this.selectedItem.GroupName==="Parameters"?u.length===0||u.length>0&&!this.dashboardDesigner.modules.parameter.isConfigWizard():!0),t},n.prototype.resizeConfigurationPanel=function(n){n||this.targetTag.css("width","500px");this.occupyFullWidth=n;this.updateDesignAreaWidth(n)},n.prototype.showDataSetPanel=function(n){var t=this.dashboardDesigner.modules.dataSet,i;t.isLoaded()||this.dashboardDesigner.modules.dataSet.renderContainer(this.expandablePanel);t.showDataSet(n,this.resizeObj);i=this.dashboardDesigner.modules.sharedDataSource;i.abortRequest()},n.prototype.showParameterPanel=function(n){var t=this.dashboardDesigner.modules.parameter;t.isLoaded()||this.dashboardDesigner.modules.parameter.renderContainer(this.expandablePanel);t.showParameter(n,this.resizeObj)},n.prototype.showPropertyPanel=function(n){var t=this.dashboardDesigner.modules.propertyPanel;t.isLoaded()||this.dashboardDesigner.modules.propertyPanel.renderContainer(this.expandablePanel);t.showPropertyPanel(n,this.resizeObj)},n.prototype.validateDisplay=function(n,t){t?(this.targetTag.find("#"+this.dashboardDesigner._id+"_"+n).addClass("bbi-designer-itempanel-selection"),this.targetTag.find("#"+this.dashboardDesigner._id+"_"+n+"_wrapper").addClass("bbi-designer-itempanel-selection")):(this.targetTag.find("#"+this.dashboardDesigner._id+"_"+n).removeClass("bbi-designer-itempanel-selection"),this.targetTag.find("#"+this.dashboardDesigner._id+"_"+n+"_wrapper").removeClass("bbi-designer-itempanel-selection"));switch(n){case"Properties":this.showPropertyPanel(t);break;case"DataSource":this.showDataSetPanel(t);break;case"Parameters":this.showParameterPanel(t)}},n.prototype.updateSize=function(){this.resizeObj.isPropertyPanel=this.resizeObj.isDataSource=this.resizeObj.isDataSet=this.resizeObj.isParameter=this.resizeObj.isImageManager=!0;this.expandablePanel.find("#"+this.dashboardDesigner._id+"_propertyPanel").is(":visible")?(this.dashboardDesigner.modules.propertyPanel.updatePanelSize(),this.resizeObj.isPropertyPanel=!1):this.expandablePanel.find("#"+this.dashboardDesigner._id+"_datasetContainer").is(":visible")?(this.dashboardDesigner.modules.dataSet.updateSize(),this.resizeObj.isDataSet=!1):this.targetTag.find("#"+this.dashboardDesigner._id+"_param_Container").is(":visible")&&(this.dashboardDesigner.modules.parameter.updateSize(),this.resizeObj.isParameter=!1)},n.prototype.updateDesignAreaWidth=function(n){this.dashboardDesigner.updateConfigPanel(n);BoldBIDashboard.isNullOrUndefined(this.dashboardDesigner.designerPanel)||this.dashboardDesigner.designerPanel.updateScrollBar()},n.prototype.updateDesignContainerWidth=function(){this.dashboardDesigner.updateDesignPanel();this.dashboardDesigner.designerPanel.updateScrollBar();var n=this.dashboardDesigner.modules.layoutDialog;BoldBIDashboard.isNullOrUndefined(n)||n.getCookie()||n.updatePosition()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.DataConfigurationPanel",ConfigurationPanel,window),function(n){var t;(function(n){var t=function(){function n(){this.ShowVisibility=!1;this.ShowNodeIcon=!0;this.ShowDataTypeIcon=!1;this.ShowSettings=!1;this.CanDragDrop=!0}return n}();n.HierachialModel=t})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){var t;(function(t){var i=function(){function i(){this.key="Designer";this.locale=window[this.key].App.LocalizationContent}return i.prototype.getNumberDataJson=function(){return this.jsonData=[{ID:"ABS",Name:"ABS",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.absDesc,Example:this.locale.expressionDesigner.expressionHelper.absEx,State:2},{ID:"ACOS",Name:"ACOS",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.acosDesc,Example:this.locale.expressionDesigner.expressionHelper.acosEx,State:0},{ID:"ASIN",Name:"ASIN",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.asinDesc,Example:this.locale.expressionDesigner.expressionHelper.asinEx,State:0},{ID:"ATAN",Name:"ATAN",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.atanDesc,Example:this.locale.expressionDesigner.expressionHelper.atanEx,State:0},{ID:"COS",Name:"COS",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.cosDesc,Example:this.locale.expressionDesigner.expressionHelper.cosEx,State:0},{ID:"COT",Name:"COT",CategoryName:"Numbers",Description:"Returns the cotangent of the angle specified in radians of the given expression.",Example:"COT(numeric_expression)",State:0},{ID:"CEIL",Name:"CEIL",CategoryName:"Numbers",Description:"Returns the smallest integer value that is greater than or equal to the given numeric expression",Example:"CEIL(numeric_expression)",State:0},{ID:"DEGREES",Name:"DEGREES",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.degDesc,Example:this.locale.expressionDesigner.expressionHelper.degEx,State:0},{ID:"EXP",Name:"EXP",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.expDesc,Example:this.locale.expressionDesigner.expressionHelper.expEx,State:0},{ID:"FLOOR",Name:"FLOOR",CategoryName:"Numbers",Description:"Returns the largest integer value that is less than or equal to the given numeric expression.",Example:"FLOOR(numeric_expression)",State:0},{ID:"LOG",Name:"LOG",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.logDesc,Example:this.locale.expressionDesigner.expressionHelper.logEx,State:0},{ID:"MOD",Name:"MOD",CategoryName:"Numbers",Description:"Returns the remainder of the first numeric expression divided by second numeric expression.",Example:"MOD(numeric_expression, numeric_expression)",State:0},{ID:"PI",Name:"PI",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.piDesc,Example:this.locale.expressionDesigner.expressionHelper.piEx,State:0},{ID:"POWER",Name:"POWER",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.powerDesc,Example:this.locale.expressionDesigner.expressionHelper.powerEx,State:0},{ID:"RADIANS",Name:"RADIANS",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.radDesc,Example:this.locale.expressionDesigner.expressionHelper.radEx,State:0},{ID:"ROUND",Name:"ROUND",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.roundDesc,Example:this.locale.expressionDesigner.expressionHelper.roundEx,State:0},{ID:"SIGN",Name:"SIGN",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.signDesc,Example:this.locale.expressionDesigner.expressionHelper.signEx,State:0},{ID:"SIN",Name:"SIN",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.sinDesc,Example:this.locale.expressionDesigner.expressionHelper.sinEx,State:0},{ID:"SQRT",Name:"SQRT",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.sqrtDesc,Example:this.locale.expressionDesigner.expressionHelper.sqrtEx,State:0},{ID:"TOTALPERCENTAGE",Name:"TOTALPERCENTAGE",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.percentageDesc,Example:this.locale.expressionDesigner.expressionHelper.percentageEx,State:0},{ID:"TAN",Name:"TAN",CategoryName:"Numbers",Description:this.locale.expressionDesigner.expressionHelper.tanDesc,Example:this.locale.expressionDesigner.expressionHelper.tanEx,State:0}]},i.prototype.getConditonalDataJson=function(){return this.jsonData=[{ID:"COALESCE",Name:"COALESCE",CategoryName:"Conditional",Description:"Returns the first non-NULL expression among its arguments, or NULL if all its arguments are NULL",Example:"COALESCE(exp1,exp2,...exp(n))",State:0},{ID:"IF",Name:"IF",CategoryName:"Conditional",Description:this.locale.expressionDesigner.expressionHelper.ifDesc,Example:this.locale.expressionDesigner.expressionHelper.ifEx,State:0},{ID:"IFNULL",Name:"IFNULL",CategoryName:"Conditional",Description:this.locale.expressionDesigner.expressionHelper.ifNullDesc,Example:this.locale.expressionDesigner.expressionHelper.ifNullEx,State:0},{ID:"ISNOTNULL",Name:"ISNOTNULL",CategoryName:"Conditional",Description:this.locale.expressionDesigner.expressionHelper.isNotNullDesc,Example:this.locale.expressionDesigner.expressionHelper.isNotNullEx,State:0},{ID:"ISNULL",Name:"ISNULL",CategoryName:"Conditional",Description:this.locale.expressionDesigner.expressionHelper.isNullDesc,Example:this.locale.expressionDesigner.expressionHelper.isNullEx,State:0}]},i.prototype.getLogicalDataJson=function(){return this.jsonData=[{ID:"AND",Name:"AND",CategoryName:"Logical",Description:this.locale.expressionDesigner.expressionHelper.andDesc,Example:this.locale.expressionDesigner.expressionHelper.andEx,State:0},{ID:"NOT",Name:"NOT",CategoryName:"Logical",Description:this.locale.expressionDesigner.expressionHelper.notDesc,Example:this.locale.expressionDesigner.expressionHelper.notEx,State:0},{ID:"OR",Name:"OR",CategoryName:"Logical",Description:this.locale.expressionDesigner.expressionHelper.orDesc,Example:this.locale.expressionDesigner.expressionHelper.orEx,State:0}]},i.prototype.getDateDataJson=function(){return this.jsonData=[{ID:"CURRENTYEAR",Name:"CURRENTYEAR",CategoryName:"Date",Description:"Returns the current year.",Example:"CURRENTYEAR()",State:0},{ID:"CURRENTMONTH",Name:"CURRENTMONTH",CategoryName:"Date",Description:"Returns the current month.",Example:"CURRENTMONTH()",State:0},{ID:"DATEADD",Name:"DATEADD",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.dateAddDesc,Example:this.locale.expressionDesigner.expressionHelper.dateAddEx,State:0},{ID:"DATEDIFF",Name:"DATEDIFF",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.dateDiffDesc,Example:this.locale.expressionDesigner.expressionHelper.dateDiffEx,State:0},{ID:"DATENAME",Name:"DATENAME",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.dateNameDesc,Example:this.locale.expressionDesigner.expressionHelper.dateNameEx,State:0},{ID:"DATEPART",Name:"DATEPART",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.datePartDesc,Example:this.locale.expressionDesigner.expressionHelper.datePartEx,State:0},{ID:"DATESUB",Name:"DATESUB",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.dateSubDesc,Example:this.locale.expressionDesigner.expressionHelper.dateSubEx,State:0},{ID:"DAY",Name:"DAY",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.dayDesc,Example:this.locale.expressionDesigner.expressionHelper.dayEx,State:0},{ID:"DAYDIFF",Name:"DAYDIFF",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.dayDiffDesc,Example:this.locale.expressionDesigner.expressionHelper.dayDiffEx,State:0},{ID:"HOUR",Name:"HOUR",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.hourDesc,Example:this.locale.expressionDesigner.expressionHelper.hourEx,State:0},{ID:"MAX",Name:"MAX",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.maxDesc,Example:this.locale.expressionDesigner.expressionHelper.maxEx,State:0},{ID:"MIN",Name:"MIN",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.minDesc,Example:this.locale.expressionDesigner.expressionHelper.minEx,State:0},{ID:"MINUTE",Name:"MINUTE",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.minutesDesc,Example:this.locale.expressionDesigner.expressionHelper.minutesEx,State:0},{ID:"MONTH",Name:"MONTH",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.monthDesc,Example:this.locale.expressionDesigner.expressionHelper.monthEx,State:0},{ID:"NOW",Name:"NOW",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.nowDesc,Example:this.locale.expressionDesigner.expressionHelper.nowEx,State:0},{ID:"PREVIOUSMONTH",Name:"PREVIOUSMONTH",CategoryName:"Date",Description:"Returns the previous month.",Example:"PREVIOUSMONTH()",State:0},{ID:"PREVIOUSYEAR",Name:"PREVIOUSYEAR",CategoryName:"Date",Description:"Returns the previous year.",Example:"PREVIOUSYEAR()",State:0},{ID:"TODAY",Name:"TODAY",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.todayDesc,Example:this.locale.expressionDesigner.expressionHelper.todayEx,State:0},{ID:"YEAR",Name:"YEAR",CategoryName:"Date",Description:this.locale.expressionDesigner.expressionHelper.yearDesc,Example:this.locale.expressionDesigner.expressionHelper.yearEx,State:0},{ID:"YESTERDAY",Name:"YESTERDAY",CategoryName:"YESTERDAY",Description:"Returns the yesterday date.",Example:"YESTERDAY()",State:0}]},i.prototype.getStringDataJson=function(){return this.jsonData=[{ID:"CHAR",Name:"CHAR",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.charDesc,Example:this.locale.expressionDesigner.expressionHelper.charEx,State:0},{ID:"CONCAT",Name:"CONCAT",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.concatDesc,Example:this.locale.expressionDesigner.expressionHelper.concatEx,State:0},{ID:"CONTAINS",Name:"CONTAINS",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.containsDesc,Example:this.locale.expressionDesigner.expressionHelper.containsEx,State:0},{ID:"ENDSWITH",Name:"ENDSWITH",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.endsWithDesc,Example:this.locale.expressionDesigner.expressionHelper.endsWithEx,State:0},{ID:"LEFT",Name:"LEFT",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.leftDesc,Example:this.locale.expressionDesigner.expressionHelper.leftEx,State:0},{ID:"LEN",Name:"LEN",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.lenDesc,Example:this.locale.expressionDesigner.expressionHelper.lenEx,State:0},{ID:"LOWER",Name:"LOWER",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.lowerDesc,Example:this.locale.expressionDesigner.expressionHelper.lowerEx,State:0},{ID:"LTRIM",Name:"LTRIM",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.ltrimDesc,Example:this.locale.expressionDesigner.expressionHelper.ltrimEx,State:0},{ID:"MAX",Name:"MAX",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.maxStrDesc,Example:this.locale.expressionDesigner.expressionHelper.maxStrEx,State:0},{ID:"MIN",Name:"MIN",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.minStrDesc,Example:this.locale.expressionDesigner.expressionHelper.minStrEx,State:0},{ID:"REPLACE",Name:"REPLACE",CategoryName:"String",Description:"Replaces all occurrences of the substring within the given string expression, with the new_substring.",Example:" REPLACE(string_expression, substring, new_substring)",State:0},{ID:"RIGHT",Name:"RIGHT",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.rightDesc,Example:this.locale.expressionDesigner.expressionHelper.rightEx,State:0},{ID:"RTRIM",Name:"RTRIM",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.rtrimDesc,Example:this.locale.expressionDesigner.expressionHelper.rtrimEx,State:0},{ID:"STARTSWITH",Name:"STARTSWITH",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.startsWithDesc,Example:this.locale.expressionDesigner.expressionHelper.startsWithEx,State:0},{ID:"SUBSTR",Name:"SUBSTR",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.substrDesc,Example:this.locale.expressionDesigner.expressionHelper.substrEx,State:0},{ID:"TRIM",Name:"TRIM",CategoryName:"String",Description:"Removes the leading and trailing spaces from the given string expression.",Example:"TRIM(string_expression)",State:0},{ID:"UPPER",Name:"UPPER",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.upperDesc,Example:this.locale.expressionDesigner.expressionHelper.upperEx,State:0},{ID:"HTML_PPARSER",Name:"HTML_PARSER",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.htmlParseDesc,Example:this.locale.expressionDesigner.expressionHelper.htmlParseEx,State:0},{ID:"XML_PARSER",Name:"XML_PARSER",CategoryName:"String",Description:this.locale.expressionDesigner.expressionHelper.xmlParseDesc,Example:this.locale.expressionDesigner.expressionHelper.xmlParseEx,State:0}]},i.prototype.getAggDataJson=function(){return this.jsonData=[{ID:"AVG",Name:"AVG",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.avgDesc,Example:this.locale.expressionDesigner.expressionHelper.avgEx,State:0},{ID:"AVGD",Name:"AVGD",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.avgdDesc,Example:this.locale.expressionDesigner.expressionHelper.avgdEx,State:0},{ID:"COUNT",Name:"COUNT",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.countDesc,Example:this.locale.expressionDesigner.expressionHelper.countEx,State:0},{ID:"COUNTD",Name:"COUNTD",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.countdDesc,Example:this.locale.expressionDesigner.expressionHelper.countdEx,State:0},{ID:"MAX",Name:"MAX",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.maxAggDesc,Example:this.locale.expressionDesigner.expressionHelper.maxAggEx,State:0},{ID:"MIN",Name:"MIN",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.minAggDesc,Example:this.locale.expressionDesigner.expressionHelper.minAggEx,State:0},{ID:"STDEV",Name:"STDEV",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.stdDevDesc,Example:this.locale.expressionDesigner.expressionHelper.stdDevEx,State:0},{ID:"SUM",Name:"SUM",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.sumDesc,Example:this.locale.expressionDesigner.expressionHelper.sumEx,State:0},{ID:"SUMD",Name:"SUMD",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.sumdDesc,Example:this.locale.expressionDesigner.expressionHelper.sumdEx,State:0},{ID:"VAR",Name:"VAR",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.varDesc,Example:this.locale.expressionDesigner.expressionHelper.varEx,State:0},{ID:"STRING_AGG",Name:"STRING_AGG",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.string_aggDesc,Example:this.locale.expressionDesigner.expressionHelper.string_aggEx,State:0},{ID:"TOTAL",Name:"TOTAL",CategoryName:"Aggregation",Description:this.locale.expressionDesigner.expressionHelper.totalDesc,Example:this.locale.expressionDesigner.expressionHelper.totalEx,State:0}]},i.prototype.getRowDataJson=function(){return this.jsonData=[{ID:"RUNNINGCOUNT",Name:"RUNNINGCOUNT",CategoryName:"Row",Description:this.locale.expressionDesigner.expressionHelper.runningCountDesc,Example:this.locale.expressionDesigner.expressionHelper.runningCountEx,State:0},{ID:"RUNNIGAVG",Name:"RUNNINGAVG",CategoryName:"Row",Description:this.locale.expressionDesigner.expressionHelper.runningAvgDesc,Example:this.locale.expressionDesigner.expressionHelper.runningAvgEx,State:0},{ID:"RUNNINGMAX",Name:"RUNNINGMAX",CategoryName:"Row",Description:this.locale.expressionDesigner.expressionHelper.runningMaxDesc,Example:this.locale.expressionDesigner.expressionHelper.runningMaxEx,State:0},{ID:"RUNNINGMIN",Name:"RUNNINGMIN",CategoryName:"Row",Description:this.locale.expressionDesigner.expressionHelper.runningMinDesc,Example:this.locale.expressionDesigner.expressionHelper.runningMinEx,State:0},{ID:"RUNNINGSUM",Name:"RUNNINGSUM",CategoryName:"Row",Description:this.locale.expressionDesigner.expressionHelper.runningSumDesc,Example:this.locale.expressionDesigner.expressionHelper.runningSumEx,State:0}]},i.prototype.getMultipleData=function(i){var r=[];if(n.isNullOrUndefined(i)){var u=this.getNumberDataJson(),f=this.getAggDataJson(),e=this.getConditonalDataJson(),o=this.getLogicalDataJson(),s=this.getDateDataJson(),h=this.getStringDataJson(),c=this.getRowDataJson();r=[{ID:1,Name:t.FunctionName.Numbers,Value:u},{ID:2,Name:t.FunctionName.Aggregation,Value:f},{ID:3,Name:t.FunctionName.Conditional,Value:e},{ID:4,Name:t.FunctionName.Logical,Value:o},{ID:5,Name:t.FunctionName.Date,Value:s},{ID:6,Name:t.FunctionName.String,Value:h},{ID:7,Name:t.FunctionName.Row,Value:c}]}return r},i.prototype.getMultipleColumnData=function(i,r){var s,u,e,f,o;if(n.isNullOrUndefined(r)){var h=[],c=[],l=[],a=[],y=[],v=[];for(u=0;u<i.length;u++)e=i[u].IsDynamicParam,i[u].DataType||i[u].TypeName!=="UnSupport"?i[u].IsExpression||(f=i[u].DataType||i[u].TypeName,f!=="geography"&&f!=="hierarchyid"&&f!=="xml"&&(o=!n.isNullOrUndefined(i[u].Value)&&i[u].Value!==""?i[u].Value:i[u].Name,f.toLowerCase()==="integer"||f.toLowerCase()==="real"?h.push({ID:u,Name:i[u].Name,Value:o,DataType:f,HasDynamicParams:e}):f.toLowerCase()==="string"?c.push({ID:u,Name:i[u].Name,Value:o,DataType:f,HasDynamicParams:e}):f.toLowerCase()==="date"?l.push({ID:u,Name:i[u].Name,Value:o,DataType:f,HasDynamicParams:e}):f.toLowerCase()==="boolean"&&a.push({ID:u,Name:i[u].Name,Value:o,DataType:f,HasDynamicParams:e}),!n.isNullOrUndefined(e)&&e&&v.push({ID:u,Name:i[u].Name,Value:o,DataType:f,HasDynamicParams:e}))):y.push({ID:u,Name:i[u].Name,Value:i[u].Name,DataType:i[u].DataType||i[u].TypeName,HasDynamicParams:e});s=[{ID:1,Name:t.FieldName.Number,Value:h},{ID:2,Name:t.FieldName.Text,Value:c},{ID:3,Name:t.FieldName.Date,Value:l},{ID:4,Name:t.FieldName.Boolean,Value:a},{ID:5,Name:t.FieldName.Parameter,Value:v},{ID:6,Name:t.FieldName.Miscellaneous,Value:[]}]}return s},i.prototype.getDaMultipleColumnData=function(i,r){var s,u,f,e;if(n.isNullOrUndefined(r)){var h=[],c=[],l=[],a=[],o=!1;for(u=0;u<i.length;u++)f=i[u].Type,e=i[u].Caption,f==="NUMERIC"?h.push({ID:u,Name:i[u].Caption,Value:e,DataType:i[u].Type,HasDynamicParams:o}):f==="STRING"?c.push({ID:u,Name:i[u].Caption,Value:e,DataType:i[u].DataType,HasDynamicParams:o}):f==="DATETIME"?l.push({ID:u,Name:i[u].Caption,Value:e,DataType:i[u].DataType,HasDynamicParams:o}):f==="BOOLEAN"&&a.push({ID:u,Name:i[u].Caption,Value:e,DataType:i[u].DataType,HasDynamicParams:o});s=[{ID:1,Name:t.FieldName.Number,Value:h},{ID:2,Name:t.FieldName.Text,Value:c},{ID:3,Name:t.FieldName.Date,Value:l},{ID:4,Name:t.FieldName.Boolean,Value:a},{ID:5,Name:t.FieldName.Miscellaneous,Value:[]}]}return s},i}();t.ExpressionHelper=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){var t;(function(t){var i=function(){function t(t,i){this.locale=null;n.isNullOrUndefined(i)||(this.dashboardDesigner=t,this.bbdesigner$=this.dashboardDesigner.bbdesigner$,this.locale=this.dashboardDesigner.getLocalizationContent(),this.model=i,this.menuHandler=new n.Dashboard.FieldMenuHandler(this.dashboardDesigner),this.dataConfig=new n.DashboardDesignerUtility.DataConfiguration(this.dashboardDesigner))}return t.prototype.render=function(t,i,r,u,f,e){var s=this,o;e===void 0&&(e=!1);this.scrollerDiv=n.isNullOrUndefined(r)?this.scrollerDiv:r;this.treeView=n.buildTag("div.e-dashboard-treeView","",{display:"inline-block",width:"100%","background-color":e?"transparent":"var(--designer-assigndata-background)"},{id:u+"_treeview_"+i[0].Id});o=new ejdashboard.navigations.TreeView({cssClass:"bbi-hierarchical-treeview",allowDragAndDrop:this.model.CanDragDrop,expandOn:"DblClick",nodeTemplate:e?this.getTreeViewTableTemplateForSSAS():this.getTreeViewTableTemplate(),nodeExpanded:this.bbdesigner$.proxy(this.nodeExpanded,this,this.scrollerDiv,e),nodeCollapsed:this.bbdesigner$.proxy(this.nodeCollapsed,this,this.scrollerDiv),drawNode:this.model.ShowVisibility?null:f?null:this.bbdesigner$.proxy(this.nodeVisibility,this),fields:{dataSource:i,id:"ColumnId",parentID:"ParentId",text:"Name",hasChildren:"HasChild"},dataBound:this.bbdesigner$.proxy(function(){s.bbdesigner$(o.element).find(".bbi-treeview-div .bbi-designer-dataset-column-deselect").closest("li").find(".bbi-text-content").addClass("deselect");f||e||(s.bbdesigner$(o.element).find(".e-text-content.e-icon-wrapper").css("height","25px"),s.bbdesigner$(o.element).find(".e-list-parent.e-ul").css("overflow","hidden"),s.bbdesigner$(o.element).find(".e-icon-expandable").css({float:"right","margin-top":"3px"}),s.bbdesigner$(o.element).find(".e-icon-collapsible").css({float:"right","margin-top":"3px"}),i[0].ContainerName==="Dimensions"&&(s.bbdesigner$(o.element).find(".e-icon-expandable").css("margin-top","3px"),s.bbdesigner$(o.element).find(".e-icon-collapsible").css("margin-top","3px"),i[0].FieldActualType!=="bbi-designer-dataset-datetime"&&(s.bbdesigner$(o.element).find(".e-icon-expandable").css("margin-right","-13px"),s.bbdesigner$(o.element).find(".e-icon-collapsible").css("margin-right","-13px")),s.bbdesigner$(o.element).find(".e-list-item.e-level-1").css("position","relative").css("bottom","5px"),s.bbdesigner$(o.element).find(".e-icon-expandable").appendTo(s.bbdesigner$(o.element).find(".all-elements-div"))),i[0].ContainerName!=="Dimensions"&&(s.bbdesigner$(o.element).find(".e-list-item.e-level-1").css({position:"relative",bottom:"4px"}),s.bbdesigner$(o.element).find(".e-list-parent").addClass("e-treeview"),s.bbdesigner$(o.element).find(".e-list-parent").css("overflow","hidden"),s.bbdesigner$(o.element).find(".e-icon-expandable").appendTo(s.bbdesigner$(o.element).find(".all-elements-div"))))},this)});o.appendTo(this.treeView[0]);t.append(this.treeView);f||e||((i[0].FieldActualType!=="bbi-designer-dataset-datetime"||i[0].ContainerName!=="Dimensions"&&i[0].FieldActualType==="bbi-designer-dataset-datetime")&&(this.unwiredEvents(),this.wiredEvents()),i[0].ContainerName==="Dimensions"&&i[0].FieldActualType==="bbi-designer-dataset-datetime"&&t.find(".e-dashboard-treeView").css("margin-bottom","-5px"),t.find(".e-dashboard-treeView").css({"margin-left":"6px",width:"94%"}));t.data("DesignerPropertyWidget",this)},t.prototype.passOriginalFieldValues=function(n){this.realFieldInfo=n},t.prototype.getTreeViewTableTemplateForSSAS=function(){var n="<div class='bbi-treeview-div'><div style='float: left;'>";return this.model.ShowVisibility&&(n+="${if(ParentId === null && ColumnType === 'Dimension' || TreeNode === 'Measure' && TreeNode === 'Measure')}<span style=margin-right:7px;vertical-align:middle class='bbi-query-selection bbi-dbrd-designer-hoverable e-designer-select${if(IsVisible)} bbi-designer-dataset-column-select'data-tooltip='"+this.locale.queryDesigner.showDataTooltip+"'${else} bbi-designer-dataset-column-deselect'data-tooltip='"+this.locale.queryDesigner.hideDataTooltip+"'${/if} name='${Name}' aliasname='${Name}'><\/span>${/if}"),this.model.ShowNodeIcon&&(n+="<span style=vertical-align:middle class='bbi-heirarchial-icons bbi-designer-content-icon${if(ParentId === null && ColumnType ==='Dimension')} bbi-heirarchial-dimension${else if(ParentId !== null && ColumnType ==='Dimension' && TreeNode !== 'Level')} ${if(HasChild)} e-heirarchial-${TreeNode.toLowerCase()}1${else} e-heirarchial-${TreeNode.toLowerCase()}${LevelDepth}${/if} ${else if(TreeNode === 'Folder')} ${if(ColumnType === 'KPI')} e-heirarchial-${ColumnType.toLowerCase()} ${else} e-heirarchial-${TreeNode.toLowerCase()}${/if}${/if}'><\/span>"),this.model.ShowDataTypeIcon&&(n+="${if(TreeNode === 'Measure')}<span style=vertical-align:middle class='bbi-designer-content-icon bbi-heirarchial-icons${if(ColumnType === 'Measure')} bbi-designer-dataset-number${else if(ColumnType === 'CalculatedMeasure')} bbi-heirarchial-lambda${/if}'><\/span>${/if}"),n+="<span style='margin-left:7px;white-space:nowrap' class='e-user-select bbi-designer-fontfamily bbi-dbrd-designer-hoverable' e-column-type='${DataType}' datatype='${DefaultDataType}' treenode='${TreeNode}' hasChild='${HasChild}' data-tooltip='${Name}'>${Name}<\/span><\/div>",this.model.ShowSettings&&(n+="${if(ColumnType === 'Dimension')}${if(!HasChild)}<div style='margin-right: 5px; float:right' class='e-settings-div'><span id='${ ColumnId }_columnSettings' style=visibility:collapse;line-height:0px class='bbi-designer-content-icon bbi-designer-selection e-settings bbi-designer-click bbi-dbrd-designer-hoverable'/><\/div>${/if}${/if}"),n+"<\/div>"},t.prototype.getTreeViewTableTemplate=function(){var n="<div style='height:35px;${if(ContainerName === 'Dimensions' || ContainerName === 'Measures')}margin-left:-7px ${/if} ' class='bbi-treeview-div'><div style='float: left;height:35px;${if(HasChild)}width:100%${/if}' class='all-elements-div'>";return this.model.ShowVisibility&&(n+="${if(ParentId === null && ColumnType === 'Dimension' || TreeNode === 'Measure' && TreeNode === 'Measure')}<span style=margin-right:7px;vertical-align:middle class='bbi-query-selection bbi-dbrd-designer-hoverable e-designer-select${if(IsVisible)} bbi-designer-dataset-column-select'data-tooltip='"+this.locale.queryDesigner.showDataTooltip+"'${else} bbi-designer-dataset-column-deselect'data-tooltip='"+this.locale.queryDesigner.hideDataTooltip+"'${/if} name='${Name}' aliasname='${Name}'><\/span>${/if}"),this.model.ShowNodeIcon&&(n+="<span style=vertical-align:middle;position:relative;${if(ContainerName !== 'Dimensions' && ContainerName !== 'Measures')}right:25px;font-size:11px;${/if}${if(!HasChild)}bottom:10px${/if} class='bbi-heirarchial-icons bbi-designer-content-icon${if(ParentId === null && ContainerName ==='Dimensions')} bbi-heirarchial-dimension${else if(ColumnType ==='Dimension')} ${if(HasChild)} e-heirarchial-${TreeNode.toLowerCase()}1${else if(ContainerName === 'Dimensions1')} e-heirarchial-${TreeNode.toLowerCase()}${LevelDepth}${/if} ${else if(TreeNode === 'Folder')} ${if(ColumnType === 'KPI')} e-heirarchial-${ColumnType.toLowerCase()} ${else} e-heirarchial-${TreeNode.toLowerCase()}${/if}${/if}'><\/span>",n+="${ if(!HasChild)}",n+="<div class='bbi-treeview-rearrange-content' style=display:flex;flex-direction:column;position:absolute;left:18px;top:5px;${if(ContainerName !== 'Dimensions' && ContainerName !== 'Measures')}left:0px;${/if}>",n+="<span style=font-size:7px;width:3.33px;height:1.67px class='bbi-heirarchial-icons bbi-designer-content-icon bbi-treeview-uparrow-icon'><\/span>",n+="<span style=width:7.78px;height:4.45px;margin-top:5px;margin-left:-2.5px;font-size:12px;${if(ContainerName !== 'Dimensions')}margin-top:4px;${/if} class='bbi-heirarchial-icons bbi-designer-content-icon bbi-treeview-menu-icon'><\/span>",n+="<span style=font-size:7px;width:3.33px;height:1.67px;margin-top:5px;${if(ContainerName !== 'Dimensions')}margin-top:6px;${/if} class='bbi-heirarchial-icons bbi-designer-content-icon bbi-treeview-downarrow-icon'><\/span>",n+="<\/div>${/if}"),this.model.ShowDataTypeIcon&&(n+="${if(TreeNode === 'Measure')}<span style=vertical-align:middle class='bbi-designer-content-icon bbi-heirarchial-icons${if(ColumnType === 'Measure')} bbi-designer-dataset-number${else if(ColumnType === 'CalculatedMeasure')} bbi-heirarchial-lambda${/if}'><\/span>${/if}"),n+="<span style='margin-left:5px;white-space:nowrap;font-size:11px;${if(ContainerName !== 'Dimensions' && ContainerName !== 'Measures')}position:relative;right:30px;${if(HasChild)}margin-left:12px;${/if}${/if}${if(HasChild)}text-overflow:ellipsis;overflow:hidden;max-width:120px;line-height:20px;display:inline-block;position:relative;top:6px;${/if}${if(!HasChild)}position:relative;display:inline-block;top:2px;width:100px;text-overflow:ellipsis;overflow:hidden;margin-left:18px;${/if}${ if(!HasChild && ContainerName === 'Dimensions' && ContainerName === 'Measures')}left:6px;margin-left:7px;${/if}' class='e-user-select bbi-designer-fontfamily bbi-dbrd-designer-hoverable bbi-parent-name' e-column-type='${DataType}' datatype='${DefaultDataType}' treenode='${TreeNode}' hasChild='${HasChild}' data-tooltip='${Name}' id='${ DashboardId }_${ Id }_categoryListLabel_${ UniqueId }'>${DisplayName}<\/span><input style='position:absolute;${if(HasChild)}right:40px;top:8px${/if}${if(!HasChild)}right:41px;top:6px${/if}' class='e-textbox bbi-datafield-edit-fieldName bbi-designer-fontfamily e-treeview-textbox' id='${ DashboardId }_${ Id }_categoryListEditableTextBox_${ UniqueId }'>${if(ContainerName !== 'Dimensions' || ContainerName === 'Dimensions')}${if(HasChild)}",(this.realFieldInfo.ContainerName!=="Dimensions"||this.realFieldInfo.FieldActualType==="bbi-designer-dataset-string")&&this.realFieldInfo.ContainerName!=="Dimensions"&&(n+="<span id='${ DashboardId }_${ Id }_categoryListParentDiv_${ UniqueId }' style='position:relative;top:3px;left:2px;float:right' class='bbi-dbrd-designer-hoverable bbi-dropped-field-close bbi-widgeticons bbi-designer-close bbi-dbrd-designer-hand-cursor e-close-parent e-dimension'><\/span>"),n+="${/if}${/if} ",this.realFieldInfo.FieldActualType==="bbi-designer-dataset-string"&&this.realFieldInfo.ContainerName==="Dimensions"&&(n+="${if(HasChild)}<span id='${ DashboardId }_${ Id }_categoryListSettingsIconHierarchy_${ UniqueId }' style='float:right;margin-right:10px;line-height:40px;margin-top:7px' class='bbi-data-fieldinfo-menu-icon-hierarchy bbi-widgeticons bbi-ch-menu-icon bbi-dbrd-hand-cursor'><\/span>${/if}"),n+="<\/div>",this.model.ShowSettings=!0,this.model.ShowSettings&&(n+="${if(!HasChild)}<div style='margin-right: 5px; float:right' class='e-settings-div'>${if(ContainerName !== 'Dimensions' && ContainerName !== 'Measures')}<span id='${ DashboardId }_${ Id }_categoryListSettingsIcon_${ UniqueId }' style='position:relative;right:22px;top:12px' class='bbi-designer-click bbi-designer-toolbarIconSettings bbi-designer-toolbarsmallfonticonsettings bbi-designer-selection bbi-dbrd-designer-hand-cursor bbi-dbrd-designer-hoverable bbi-dropped-field-settings e-child'><\/span>${/if}",(this.realFieldInfo.ContainerName!=="Dimensions"||this.realFieldInfo.FieldActualType==="bbi-designer-dataset-string")&&(n+="<span id='${ DashboardId }_${ Id }_categoryListIcon_${ UniqueId }' style='position:relative;${if(ContainerName === 'Dimensions' || ContainerName === 'Measures')}left:7px;${/if}${if(ContainerName !== 'Dimensions' && ContainerName !== 'Measures')}bottom:13px;right:6px${/if} ' class='bbi-dbrd-designer-hoverable bbi-dropped-field-close bbi-widgeticons bbi-designer-close bbi-dbrd-designer-hand-cursor e-close-child'><\/span>"),n+="<\/div>${/if}"),n+"<\/div>"},t.prototype.wiredEvents=function(){this.treeView.on("click",".bbi-data-fieldinfo-menu-icon-hierarchy",this.bbdesigner$.proxy(this.dataConfig.updateHierarchyMenuItems,this.dataConfig,this.realFieldInfo));this.treeView.on("click",".bbi-designer-selection.bbi-dropped-field-settings.e-parent",this.bbdesigner$.proxy(this.menuHandler.onSettingsClick,this.menuHandler,this.realFieldInfo));if(this.realFieldInfo.ContainerName==="Dimensions")this.treeView.on("click",".bbi-dropped-field-close.e-close-parent",this.bbdesigner$.proxy(this.dataConfig.onCloseClickHierarchyFields,this.dataConfig,this.realFieldInfo,this.realFieldInfo,!1,!0));else this.treeView.on("click",".bbi-dropped-field-close.e-close-parent",this.bbdesigner$.proxy(this.dataConfig.onCloseClick,this.dataConfig,this.realFieldInfo,!1,!0));for(var t=0;!n.isNullOrUndefined(this.realFieldInfo.ChildHierarchicalFields)&&t<this.realFieldInfo.ChildHierarchicalFields.length;t++){if(this.realFieldInfo.ContainerName==="Dimensions")this.treeView.on("click",".bbi-dropped-field-close.e-close-child",this.bbdesigner$.proxy(this.dataConfig.onCloseClickHierarchyFields,this.dataConfig,this.realFieldInfo.ChildHierarchicalFields[t],this.realFieldInfo,!1,!0));else this.treeView.on("click",".bbi-dropped-field-close.e-close-child",this.bbdesigner$.proxy(this.dataConfig.onCloseClick,this.dataConfig,this.realFieldInfo.ChildHierarchicalFields[t],!1,!0));this.treeView.on("click",".bbi-designer-selection.bbi-dropped-field-settings.e-child",this.bbdesigner$.proxy(this.menuHandler.onSettingsClick,this.menuHandler,this.realFieldInfo.ChildHierarchicalFields[t]))}if(n.isNullOrUndefined(this.realFieldInfo.ChildHierarchicalFields))this.treeView.on("click",".bbi-dropped-field-close.e-close-child",this.bbdesigner$.proxy(this.dataConfig.onCloseClickHierarchyFields,this.dataConfig,this.realFieldInfo,this.realFieldInfo,!1,!0))},t.prototype.unwiredEvents=function(){this.treeView.off("click",".bbi-data-fieldinfo-menu-icon-hierarchy",this.bbdesigner$.proxy(this.dataConfig.updateHierarchyMenuItems,this.dataConfig,this.realFieldInfo));this.treeView.off("click",".bbi-designer-selection.bbi-dropped-field-settings.e-parent",this.bbdesigner$.proxy(this.menuHandler.onSettingsClick,this.menuHandler,this.realFieldInfo));this.realFieldInfo.ContainerName==="Dimensions"?this.treeView.off("click",".bbi-dropped-field-close.e-close-parent",this.bbdesigner$.proxy(this.dataConfig.onCloseClickHierarchyFields,this.dataConfig,this.realFieldInfo,this.realFieldInfo,!1,!0)):this.treeView.off("click",".bbi-dropped-field-close.e-close-parent",this.bbdesigner$.proxy(this.dataConfig.onCloseClick,this.dataConfig,this.realFieldInfo,!1,!0));for(var t=0;!n.isNullOrUndefined(this.realFieldInfo.ChildHierarchicalFields)&&t<this.realFieldInfo.ChildHierarchicalFields.length;t++)this.realFieldInfo.ContainerName==="Dimensions"?this.treeView.off("click",".bbi-dropped-field-close.e-close-child",this.bbdesigner$.proxy(this.dataConfig.onCloseClickHierarchyFields,this.dataConfig,this.realFieldInfo.ChildHierarchicalFields[t],this.realFieldInfo,!1,!0)):this.treeView.off("click",".bbi-dropped-field-close.e-close-child",this.bbdesigner$.proxy(this.dataConfig.onCloseClick,this.dataConfig,this.realFieldInfo.ChildHierarchicalFields[t],!1,!0)),this.treeView.off("click",".bbi-designer-selection.bbi-dropped-field-settings.e-child",this.bbdesigner$.proxy(this.menuHandler.onSettingsClick,this.menuHandler,this.realFieldInfo.ChildHierarchicalFields[t]));n.isNullOrUndefined(this.realFieldInfo.ChildHierarchicalFields)&&this.treeView.off("click",".bbi-dropped-field-close.e-close-child",this.bbdesigner$.proxy(this.dataConfig.onCloseClickHierarchyFields,this.dataConfig,this.realFieldInfo,this.realFieldInfo,!1,!0))},t.prototype.nodeVisibility=function(n){n.nodeData.IsVisible||(n.node.style.display="none")},t.prototype.nodeExpanded=function(t,i,r){var f,u,e;if(!i&&!n.isNullOrUndefined(this.realFieldInfo)){for(this.scrollerDiv.refresh(),this.bbdesigner$(r.node).find(".e-list-item.e-level-2 .e-text-content, .e-list-item.e-level-2 .e-text-content .e-list-text").css("height","35px"),this.bbdesigner$(r.node).find(".e-list-item.e-level-2").addClass("e-heirachy-field"),this.bbdesigner$(r.node).find(".e-list-item.e-level-2").css("height","35px"),f=this.bbdesigner$(r.node).find(".e-list-parent.e-ul"),u=0;u<f[0].childElementCount;u++)this.bbdesigner$(f[0].children[u]).find(".e-treeview-textbox").data("e-treeview-textbox-field",this.realFieldInfo.ChildHierarchicalFields[u]);this.scrollerDiv.refresh()}e=t.siblings(".bbi-querydesigner-table-boxshadow").find(".e-dbrd-query-select");e.hasClass("bbi-designer-dataset-column-deselect")?this.bbdesigner$(r.node).find(".bbi-text-content").find(".bbi-query-selection").removeClass("bbi-designer-dataset-column-select").addClass("bbi-designer-dataset-column-deselect").attr("data-tooltip",this.locale.queryDesigner.hideDataTooltip):e.hasClass("bbi-designer-dataset-column-select")&&this.bbdesigner$(r.node).find(".bbi-text-content").find(".bbi-query-selection").removeClass("bbi-designer-dataset-column-deselect").addClass("bbi-designer-dataset-column-select").attr("data-tooltip",this.locale.queryDesigner.showDataTooltip);this.model.ShowSettings&&this.bbdesigner$(r.node).find(".bbi-text-content").hasClass("deselect")&&this.bbdesigner$(r.node).find(".bbi-text-content").addClass("deselect");this.scrollerRefresh(t)},t.prototype.nodeCollapsed=function(n,t){this.bbdesigner$(t.node).find(".e-list-item.e-level-2.e-active").removeClass("e-active");this.scrollerRefresh(n)},t.prototype.scrollerRefresh=function(t){if(!n.isNullOrUndefined(t)){var i=t.data("BoldBIDashboardScroller");n.isNullOrUndefined(i)||i.refresh()}},t}();t.HierachicalSchemaView=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n){var t;(function(t){var i=function(){function t(t){this.locale=null;this.designer=t;this.bbdesigner$=this.designer.bbdesigner$;this.locale=t.getLocalizationContent();this.queryDesigner=this.designer.modules.queryDesigner;this.dataField=[];this.id=this.designer._id+"_hierarchy_init_fltr";this.multiSelectionComboBox=new n.DashboardDesignerUtility.MultiSelectionComboBox(this.designer);this.dateRangePopup=this.designer.modules.dateRangePopup;this.createHierarchicalUI()}return t.prototype.createHierarchicalUI=function(){var i=n.buildTag("div.bbi-dashboard-designer-configuration bbi-userselect bbi-designer-query-dialog","",{},{title:this.locale.initialFilter.dialogTitle,id:this.id+"_query_filter_dialog"}),t=n.buildTag("div","",{height:"100%",display:"grid","grid-template-columns":"24% 1% 75%"}),u=n.buildTag("div.e-left-container","",{display:"inline-block",height:"100%"},{}),r,f;this.treeViewScroller=n.buildTag("div.bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","",{position:"relative",width:"100%",height:"100%"},{id:this.id+"_query_parentContainer"});r=n.buildTag("div","",{width:"auto"},{id:this.id+"_query_container_div"});t.append(u);u.append(this.treeViewScroller);f='<span class="bbi-vertical-line" style="float:left"><\/span>';t.append(f);this.rightContainerDiv=n.buildTag("div.e-droppable","",{display:"inline-block",margin:"10px 0px"},{});t.append(this.rightContainerDiv);this.listViewScroller=n.buildTag("div.bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","",{position:"relative"},{id:this.id+"_query_parentContainer"});this.listView=n.buildTag("div.e-heirarcial-list","",{width:"100%"},{id:this.id+"_query_container_list"});this.rightContainerDiv.append(this.listViewScroller);i.append(t);this.designer.element.append(i);this.ejdialogInst=i.BoldBIDashboardDialog({minWidth:900,minHeight:400,width:"auto",height:"auto",enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,cssClass:"bbi-designer-dialog boldbi-dashboarddesigner",containment:"#"+this.designer._id,target:"#"+this.designer._id,close:this.bbdesigner$.proxy(n.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText}).data("BoldBIDashboardDialog");var e=n.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.dialogOptions.okButtonText,{float:"right"},{id:this.id+"_query_btn_ok",type:"button"}),o=n.buildTag("button.bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_query_btn_cancel",type:"button"}),s=this.designer.element.find("#"+this.id+"_query_filter_dialog_foot");s.append(o,e);e.on("click",this.bbdesigner$.proxy(this.saveQueryFilter,this,!0));o.on("click",this.bbdesigner$.proxy(this.closeDialog,this,!0));this.treeViewDiv=n.buildTag("div.e-heirarchial-parent","",{},{});r.append(this.treeViewDiv);this.treeViewScroller.append(r);this.treeViewScroller.BoldBIDashboardScroller({height:"420px",width:"100%",scrollerSize:this.designer.scrollerSize.scrollSize,enableTouchScroll:!0,autoHide:!0,buttonSize:this.designer.scrollerSize.buttonSize});this.listViewScroller.append(this.listView);this.listViewScroller.BoldBIDashboardScroller({height:"400px",scrollerSize:this.designer.scrollerSize.scrollSize,enableTouchScroll:!0,autoHide:!0,buttonSize:this.designer.scrollerSize.buttonSize})},t.prototype.closeDialog=function(){this.multiSelectionComboBox.hideMultiSelectionWaitingPopup(!0);this.designer.element.find("#"+this.id+"_query_filter_dialog").data("BoldBIDashboardDialog").close()},t.prototype.renderTreeview=function(t){var i=new n.Dashboard.HierachicalSchemaView(this.designer,this.getModel());i.render(this.treeViewDiv,t,this.treeViewScroller,this.designer._id,!0,!0);this.treeViewEvents(this.treeViewDiv)},t.prototype.getModel=function(){var t=new n.Dashboard.HierachialModel;return t.CanDragDrop=!0,t},t.prototype.treeViewEvents=function(n){var t=ejdashboard.base.getComponent(n.children().first()[0],"treeview"),r,i;for(t.allowEditing=!0,t.nodeDragStart=this.bbdesigner$.proxy(this.nodeDragStart,this),t.nodeDragStop=this.bbdesigner$.proxy(this.nodeDragStop,this),t.nodeEditing=this.bbdesigner$.proxy(this.nodeDoubleClick,this),r=t.element.ej2_instances,i=0;i<r.length;i++)if(r[i].getModuleName()==="draggable"){r[i].dragArea="#"+this.id+"_query_filter_dialog";break}},t.prototype.nodeDoubleClick=function(n){if(!n.nodeData.hasChildren){var t=this.bbdesigner$(n.node).children().find(".e-user-select").attr("e-column-type");this.getUIForListView(n.nodeData,t,!1)}this.cancelEvent(n)},t.prototype.nodeDragStart=function(t){if(t.draggedNodeData.hasChildren)this.cancelEvent(t);else{var i=this.designer.element.find("#"+this.ejdialogInst.element.attr("id")+"_overLay");t.clonedNode.style.zIndex=n.parseInt(i.css("zIndex"),10)+10}},t.prototype.nodeDragStop=function(n){if(this.bbdesigner$(n.target).find(".e-heirarcial-list").length>0){var t=this.bbdesigner$(n.draggedNode).children().find(".e-user-select").attr("e-column-type");this.getUIForListView(n.draggedNodeData,t,!1)}this.cancelEvent(n)},t.prototype.cancelEvent=function(n){n.cancel=!0},t.prototype.resetDialog=function(){this.treeViewDiv.empty();this.listView.children().remove();this.dataField=[]},t.prototype.openDialog=function(t,i){var r,u;if(this.resetDialog(),this.buttonModel=t,this.renderTreeview(i),!n.isNullOrUndefined(this.queryDesigner.queryFilter))for(r=0;r<this.queryDesigner.queryFilter.length;r++)this.getUIForListView({id:this.queryDesigner.queryFilter[r].Id,text:this.queryDesigner.queryFilter[r].Name},this.queryDesigner.queryFilter[r].DataType,!0,this.queryDesigner.queryFilter[r]);this.ejdialogInst.open();u=this.treeViewScroller.data("BoldBIDashboardScroller");n.isNullOrUndefined(u)||u.refresh();this.listViewScrollerRefresh()},t.prototype.getUIForListView=function(t,i,r,u){var e=i,f=n.getGuid(this.id+"_row_"),s,o;this.dataField.push({Id:f,ColumnId:t.id,Name:t.text,DataType:e});this.listView.append(this.getTemplate(f,t,e));s=this.listView.find("#"+f+"_query_operator_type");s.BoldBIDashboardDropDownList({width:"130px",height:"26px",dataSource:[{value:"And",text:"AND"},{value:"Or",text:"OR"}],fields:{text:"text",value:"value"},enabled:!0,selectedIndex:0,showRoundedCorner:!0,cssClass:"bbi-designer-param-assign bbi-designer-ejwidgets bbi-dbrd-control bbi-background"});this.setDataToDropdown(f,t,e);r&&this.populateDataSet(f,u);o=this.listView.find("#"+f+"_query_delete_icon");o.off("click",this.bbdesigner$.proxy(this.deleteQueryFilter,this,this.bbdesigner$("#"+f)));o.on("click",this.bbdesigner$.proxy(this.deleteQueryFilter,this,this.bbdesigner$("#"+f)));this.listViewScrollerRefresh()},t.prototype.populateDataSet=function(n,t){var r;if(this.isString(t.DataType)){var u=this.multiSelectionComboBox.getMultiSelectionComboBox(n),i=t.DimensionFilterSchemaInfo,f={FilterValues:i.FilterValues,IsInclude:i.IsInclude,IsCheckAll:i.IsCheckAll,CheckAllState:i.CheckAllState};u.parent().data("MultiSelectionComboBox").populateMultiSelectionItem(n,f)}else r=t.DateFilterSchemaInfo,this.multiSelectionComboBox.getMultiSelectionComboBox(n).css("display","none"),this.dateRangePopup.populateDateRangePopup(n,r.DateFormatInfo)},t.prototype.getTemplate=function(n,t,i){return"<div class='bbi-designer-query-row' id='"+n+"' style = 'margin: 0px 10px 0px 2px;'><div class='bbi-initialfil-opterator' id = '"+n+"_query_operator_type_div' style = 'position: relative; padding-left: 14px; top: 10px; z-index: 1;'><input type='text' id = '"+n+"_query_operator_type'><\/div><div class='bbi-designer-table-dialog' id='"+n+"_query_container_table' style=\"border: 1px solid var(--querydesigner-primary-border-color); height: 45px; display: flex; align-items: center; justify-content: space-between;\"><div class='e-contentWrapper' style='margin: 2%; width: 100%; display: grid; align-items: center; grid-template-columns: 30% 30% 40%;'> <span class='bbi-designer-label bbi-dbrd-designer-hoverable' style ='overflow:hidden; text-overflow:ellipsis' data-tooltip='"+t.text+"'>"+t.text+"<\/span >"+(this.isString(i)?"":"<div class='e-columninfo-content'><\/div>")+"<div class='e-columninfo-data' id ='datacollection'><div class='e-multi-combobox' id='"+n+"_query_datasource' style='position: relative; font-size: 12px; background-color: white; width: "+(this.isString(i)?"170px":"130px")+"; height: 26px'><\/div><\/div><\/div><div class=error-msg id='"+n+"_error_msg' style='visibility: collapse;margin-right: 2%'><span class='bbi-designer-error-icon bbi-designer-errorinfo bbi-dbrd-designer-hoverable' style='float: right; display: block;' data-tooltip='Invalid Formatting.'><\/span><\/div><span class='bbi-drbd-close-icon bbi-dbrd-designer-hoverable' id = '"+n+"_query_delete_icon' data-tooltip='Delete' style ='cursor: pointer; font-size: 10px; float: right; margin-right:5%'><\/span><\/div>"},t.prototype.setDataToDropdown=function(t,i,r){var f=this.listView.find("#"+t+"_query_datasource"),s=this.listView.find("#"+t+" .e-columninfo-content"),e,u,o;this.isString(r)?(new n.DashboardDesignerUtility.MultiSelectionComboBox(this.designer).renderMultiSelectionComboBox(f,t,this.queryDesigner.dataset.Id),e=this.multiSelectionComboBox.getMultiSelectionComboBox(t),e.attr({"data-fieldValue":i.id,"data-fieldText":i.text,"data-dateFormat":null})):(u=n.buildTag("input.e-combobox-element","",{position:"relative","font-size":"12px","background-color":"white"},{id:t+"combobox-data"}),o=JSON.parse('[{"column1":"Date"}]'),s.append(u),u.BoldBIDashboardDropDownList({cssClass:"bbi-dbrd-control e-combobox-control",dataSource:o,fields:{text:"column1",value:"id"},selectedIndex:0,enabled:!1,width:"130px",height:"26px"}),this.dateRangePopup.renderDateRangeDrpDwn(t,f,this.queryDesigner.dataset.Id,{Id:i.id,Name:i.text},null,"QueryFilter"),this.listView.find("#"+t+"_dateRange_multidDrpDwn").css("display","block"))},t.prototype.saveQueryFilter=function(){var t=this.getQueryFilter();t.hasError||(n.DashboardUtil.invokeMethod(this.buttonModel.callBackInstance,this.buttonModel.callBackMethod,[t]),this.closeDialog())},t.prototype.getQueryFilter=function(){for(var c,u,f,h=[],l=this.designer.element.find("#"+this.queryDesigner.id+"_div_dragSurface .bbi-data-table"),e=this.bbdesigner$(l[0]).data("e-table"),o=!1,s=0;s<this.dataField.length;s++){var t=new InitialFilterInfo,i=this.dataField[s],r=i.Id;this.bbdesigner$(this.rightContainerDiv).find("#"+r+"_error_msg").css("visibility","collapse");t.Name=i.Name;t.Id=i.ColumnId;t.DataType=this.getTypeName(i.DataType);this.isString(t.DataType)?(t.Type=n.DashboardDesignerUtility.Serialization.enumToString(InitialFilterType,InitialFilterType.Dimension),c=this.multiSelectionComboBox.getMultiSelectionComboBox(r),u=c.parent().data("MultiSelectionComboBox").getPopupContainerInformation(r),t.DimensionFilterSchemaInfo={ColumnName:i.Name,ColumnId:i.ColumnId,DimensionFilterCondition:DimensionFilterCondition.Inclusion,FilterValues:u.FilterValues,IsInclude:u.IsInclude,IsCheckAll:u.IsCheckAll,IsTopNApplied:!1,CheckAllState:u.CheckAllState},u.IsCheckAll&&(this.bbdesigner$(this.rightContainerDiv).find("#"+r+"_error_msg").css("visibility","visible"),o=!0)):(t.Type=n.DashboardDesignerUtility.Serialization.enumToString(InitialFilterType,InitialFilterType.Date),f=this.dateRangePopup.getDateRangeValues(r),t.DateFilterSchemaInfo={ColumnName:i.Name,ColumnId:i.ColumnId,DateAndTimeFormatCondition:DateTimeFormatForFilter.Date,FilterValues:[],IsInclude:!1,IsCheckAll:!1,IsTopNApplied:!1,CheckAllState:!1,TopNFilterConditionInfo:null,DateFormatInfo:{DateFormatCondition:f.DateFormatCondition,StartDate:f.StartDate,EndDate:f.EndDate}},f.IsFilterApplied||(this.bbdesigner$(this.rightContainerDiv).find("#"+r+"_error_msg").css("visibility","visible"),o=!0));t.Schema=e.schema;t.TableName=e.name;t.TableId=e.id;t.IsTypeCast=!1;t.TypeCastValue="";h.push(t)}return{queryFilters:h,hasError:o}},t.prototype.getTypeName=function(n){var t=n.toLowerCase();return t==="nchar"||t==="ntext"||t==="nvarchar"||t==="text"||t==="varchar"||t==="char"||t==="string"?"System.String":t==="datetime"||t==="datetime2"||t==="smalldatetime"||t==="date"?"System.DateTime":t==="datetimeoffset"?"System.DateTimeOffset":t==="time"?"System.TimeSpan":n},t.prototype.deleteQueryFilter=function(n){var t=n.attr("id");n.remove();this.bbdesigner$("#"+n.attr("rowId")+"_popup_container").remove();this.bbdesigner$("#"+n.attr("rowId")+"_dateRange_popup").remove();this.dataField=this.dataField.filter(function(n){if(n.Id!==t)return n});this.listViewScrollerRefresh()},t.prototype.listViewScrollerRefresh=function(){var t=this.listViewScroller.data("BoldBIDashboardScroller");n.isNullOrUndefined(t)||t.refresh()},t.prototype.isString=function(n){return n==="System.Guid"||n==="System.String"||n==="Text"||n.toLowerCase()==="string"?!0:!1},t}();t.HierarchicalMainFilterDialog=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={}));InternalDropDownTreeview=function(){function n(n,t,i){this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.id=(i.attr("id")!==""?i.attr("id"):this.dashboardDesigner._id)+"_drop_tree";this.targetContainer=i;this.targetContainer.data("DesignerPropertyWidget",this);this.renderDropDown(t,i)}return n.prototype.renderDropDown=function(n,t){BoldBIDashboard.isNullOrUndefined(t)||BoldBIDashboard.isNullOrUndefined(n)||(this.dropDownBtnModel=n,BoldBIDashboard.isNullOrUndefined(this.treeViewObj)||BoldBIDashboard.isNullOrUndefined(this.dropDownBtnModel.fields)?(this.createDropDownElement(t),this.wireEvents()):(this.treeViewObj.fields=this.dropDownBtnModel.fields,this.treeViewObj.refresh()))},n.prototype.createDropDownElement=function(n){var t=this,r=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_wrapper"}),i=BoldBIDashboard.buildTag("input","",{},{id:this.id+"_wrapper_input"}),u=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_wrapper_target"}),f=BoldBIDashboard.buildTag("ul","",{},{}),e=BoldBIDashboard.buildTag("li","",{},{}),o=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-treeview-target","",{},{id:this.id+"_treeview_target"}),v=this.treeviewDiv=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-treeviewdiv","",{},{id:this.id+"_main_treeviewDiv"}),s=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-drpdwn-footer","",{},{id:this.id+"_dropdown_footer"}),h=BoldBIDashboard.buildTag("footer.bbi-dbrd-designer-footer-element","",{},{id:this.id+"_footer_element"}),y=this.applyButton=BoldBIDashboard.buildTag("button.bbi-dbrd-designer-apply-button bbi-dbrd-btn-primary e-dbrd-btn bbi-dbrd-btn-small",this.locale.dialogOptions.applyButtonText,{},{id:this.id+"_apply_button",type:"button"}),p=BoldBIDashboard.buildTag("button.bbi-dbrd-designer-cancel-button bbi-dbrd-btn-secondary e-dbrd-btn bbi-dbrd-btn-small bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{},{id:this.id+"_cancel_button",type:"button"}),c,l,a;h.append(p,y);s.append(h);o.append(v);e.append(o);f.append(e);u.append(f);r.append(i,u);n.append(r);c=BoldBIDashboard.DropDownList.prototype._OnKeyUp;l=BoldBIDashboard.DropDownList.prototype._OnKeyDown;this.bbdesigner$.extend(!0,BoldBIDashboard.DropDownList.prototype,{_OnKeyUp:function(n){if(this.popup.find(".bbi-dbrd-designer-treeviewdiv").length===0)c.call(this,n);else return},_OnKeyDown:function(n){if(this.popup.find(".bbi-dbrd-designer-treeviewdiv").length===0)l.call(this,n);else return}});this.dropDownObj=i.BoldBIDashboardDropDownList({targetID:this.id+"_wrapper_target",popupHeight:BoldBIDashboard.isNullOrUndefined(this.dropDownBtnModel.popupHeight)?"":this.dropDownBtnModel.popupHeight,watermarkText:BoldBIDashboard.isNullOrUndefined(this.dropDownBtnModel.watermarkText)?"":this.dropDownBtnModel.watermarkText,width:BoldBIDashboard.isNullOrUndefined(this.dropDownBtnModel.width)?"145px":this.dropDownBtnModel.width,height:BoldBIDashboard.isNullOrUndefined(this.dropDownBtnModel.height)?"26px":this.dropDownBtnModel.height,cssClass:"boldbi-dashboarddesigner "+(BoldBIDashboard.isNullOrUndefined(this.dropDownBtnModel.cssClass)?"":this.dropDownBtnModel.cssClass),create:function(){var n=i.BoldBIDashboardDropDownList("instance");n.ultag.off("click",t.bbdesigner$.proxy(n._OnMouseClick,n));n.ultag.off("mouseenter",t.bbdesigner$.proxy(n._OnMouseEnter,n));n.ultag.off("mouseleave",t.bbdesigner$.proxy(n._OnMouseLeave,n));t.bbdesigner$(n.popupList,n.wrapper).off("keyup",t.bbdesigner$.proxy(n._OnKeyUp,n));t.bbdesigner$(n.popupList,n.wrapper).off("keydown",t.bbdesigner$.proxy(n._OnKeyDown,n));n.ultag.parents("#"+t.id+"_wrapper_input_popup_list_wrapper").append(s);n.ultag.parents("#"+t.id+"_wrapper_input_popup").css("background","white")},popupShown:function(){t.applyButton.prop("disabled","true")}}).data("BoldBIDashboardDropDownList");a=i.BoldBIDashboardDropDownList("instance");this.parentElement=a.ultag.parents("#"+this.id+"_wrapper_input_popup_list_wrapper");this.dropDownBtnModel.fields.dataSource.length>0&&(this.renderTreeview(this.treeviewDiv,this.dropDownBtnModel.fields.dataSource),this.dropDownObj.scrollerObj.refresh())},n.prototype.wireEvents=function(){this.parentElement.on("click","#"+this.id+"_apply_button",this.bbdesigner$.proxy(this.applyAction,this));this.parentElement.on("click","#"+this.id+"_cancel_button",this.bbdesigner$.proxy(this.cancelAction,this))},n.prototype.renderTreeview=function(n,t){var i=new BoldBIDashboard.Dashboard.HierachialModel,r;i.ShowDataTypeIcon=!0;r=new BoldBIDashboard.Dashboard.HierachicalSchemaView(this.dashboardDesigner,i);r.render(n,t,this.dropDownObj.popup,null,null,!0);this.treeViewObj=ejdashboard.base.getComponent(n.children().first()[0],"treeview");this.treeViewObj.nodeSelected=this.bbdesigner$.proxy(this.onNodeSelect,this)},n.prototype.onNodeSelect=function(n){n.nodeData.text!==null&&n.nodeData.parentID!==null&&n.nodeData.hasChildren===!1?(this.selectedItemValue=n.nodeData.id,this.selectedItemText=n.nodeData.text,this.dropDownObj.model.value===n.nodeData.id?this.applyButton.prop("disabled","true"):this.applyButton.removeProp("disabled")):this.applyButton.prop("disabled","true")},n.prototype.addOrRemoveItem=function(n,t){this.dropDownObj._hiddenValue=n;t&&this.dropDownObj._addText(n);this.dropDownObj.model.value=this.selectedItemValue;this.dropDownObj.model.text=n},n.prototype.applyAction=function(){this.dropDownObj._clearTextboxValue();this.addOrRemoveItem(this.selectedItemText,!0);this.dropDownObj.hidePopup();BoldBIDashboard.isNullOrUndefined(this.dropDownBtnModel.optionalArgs)?BoldBIDashboard.DashboardUtil.invokeMethod(this.dropDownBtnModel.callBackInstance,this.dropDownBtnModel.callBackMethod):BoldBIDashboard.DashboardUtil.invokeMethod(this.dropDownBtnModel.callBackInstance,this.dropDownBtnModel.callBackMethod,[this.dropDownBtnModel.optionalArgs])},n.prototype.getSelection=function(){return{name:this.selectedItemText,value:this.selectedItemValue}},n.prototype.selectItem=function(n){var t,i;return!BoldBIDashboard.isNullOrUndefined(this.treeViewObj)&&!BoldBIDashboard.isNullOrUndefined(n)&&n.trim()!==""?(this.treeViewObj.selectedNodes.pop(),this.treeViewObj.selectedNodes.push(n),t=this.getParentNodes(n),this.treeViewObj.expandedNodes=t.parents,this.treeViewObj.refresh(),this.dropDownObj._removeText(this.dropDownObj.model.text),i=BoldBIDashboard.isNullOrUndefined(t.item)?"":t.item.Name,i!==""&&(this.selectedItemText=this.dropDownObj.model.text=i,this.selectedItemValue=this.dropDownObj.model.value=n,this.dropDownObj._addText(i)),!BoldBIDashboard.isNullOrUndefined(t.item)):!1},n.prototype.updateText=function(n,t){this.dropDownObj._removeText(this.dropDownObj.model.text);this.dropDownObj.model.text=n;this.dropDownObj.model.value=t;this.dropDownObj._addText(n)},n.prototype.getParentNodes=function(n){for(var i=this.treeViewObj.getTreeData(),r=[],u=null,t=0;t<i.length;t++)if(BoldBIDashboard.isNullOrUndefined(i[t].ParentId)||i[t].ParentId.trim()===""?r=[]:r.indexOf(i[t].ParentId)===-1&&r.pop(),i[t].HasChild&&r.push(i[t].ColumnId),i[t].ColumnId===n){u=i[t];break}return BoldBIDashboard.isNullOrUndefined(u)||(r=[]),{parents:r,item:u}},n.prototype.cancelAction=function(){this.dropDownObj.hidePopup()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.DropdownTreeview",InternalDropDownTreeview,window);InternalSortDialog=function(){function n(n){this.dashboardDesigner=null;this.dialogContainer=null;this.sortContainer=null;this.fieldContainer=null;this.sortOrderContainer=null;this.manualContainer=null;this.targetMethod="";this.menuItem=null;this.customSorting=null;this.datasetFields=[];this.measuresList=[];this.dimensionsList=[];this.measureFormats=[];this.dimensionFormats=[];this.listBoxField="text";this.sortType=CustomSortType[CustomSortType.Alphabetic];this.sortOrder=SortingOrder[SortingOrder.Ascending];this.fieldCell=null;this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.id=this.dashboardDesigner._id;this.renderSortDialog();this.dimensionFormats=this.getSummaryTypeArrayforDimension();this.measureFormats=this.getmeasureFormatsList()}return n.prototype.getmeasureFormatsList=function(){var n=this.dashboardDesigner.modules.util;return[{value:SummaryType.SUM,text:n.getSummaryTypeLocalizedText(SummaryType.SUM)},{value:SummaryType.AVG,text:n.getSummaryTypeLocalizedText(SummaryType.AVG)},{value:SummaryType.COUNT,text:n.getSummaryTypeLocalizedText(SummaryType.COUNT)},{value:SummaryType.MAX,text:n.getSummaryTypeLocalizedText(SummaryType.MAX)},{value:SummaryType.MIN,text:n.getSummaryTypeLocalizedText(SummaryType.MIN)},{value:SummaryType.COUNTD,text:n.getSummaryTypeLocalizedText(SummaryType.COUNTD)},{value:SummaryType.VAR,text:n.getSummaryTypeLocalizedText(SummaryType.VAR)}]},n.prototype.getSummaryTypeArrayforDimension=function(){var n=this.dashboardDesigner.modules.util;return[{value:SummaryType.COUNT,text:n.getSummaryTypeLocalizedText(SummaryType.COUNT)},{value:SummaryType.COUNTD,text:n.getSummaryTypeLocalizedText(SummaryType.COUNTD)}]},n.prototype.renderSortDialog=function(){this.dialogContainer=BoldBIDashboard.buildTag("div.bbi-dashboard-designer-configuration bbi-userselect","",{height:"auto"},{title:"Advanced Sorting Options",id:this.id+"_sort_dialog"});this.dashboardDesigner.element.append(this.dialogContainer);this.sortContainer=this.getSortContainer();this.fieldContainer=this.getFieldContainer();this.sortOrderContainer=this.getSortOrderContainer();this.manualContainer=this.getManualContainer();this.dialogContainer.append(this.sortContainer,this.fieldContainer,this.sortOrderContainer,this.manualContainer);this.dialogContainer.BoldBIDashboardDialog({width:"auto",height:"auto",minWidth:600,minHeight:333,enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id,cssClass:"bbi-designer-dialog boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.renderFooter();this.getColumnField().BoldBIDashboardDropDownList({width:"100%",fields:{text:"text",value:"value"},enabled:!0,showRoundedCorner:!0,watermarkText:"Choose Field",cssClass:"bbi-designer-param-assign bbi-designer-border bbi-designer-ejwidgets bbi-dbrd-control",change:this.bbdesigner$.proxy(this.updateColumnField,this)});this.getSummaryField().BoldBIDashboardDropDownList({width:"100%",fields:{text:"text",value:"value"},enabled:!0,showRoundedCorner:!0,watermarkText:"Choose Field",cssClass:"bbi-designer-param-assign bbi-designer-border bbi-designer-ejwidgets bbi-dbrd-control"});this.getListBox().BoldBIDashboardListBox({dataSource:[{text:""}],fields:{value:this.listBoxField},width:"100%",height:"100%",allowDrag:!0,allowDrop:!0,itemDragStart:this.bbdesigner$.proxy(this.listItemDragStart,this),create:this.bbdesigner$.proxy(this.createScrollBar,this),cssClass:"bbi-dbrd-control"});this.getListBoxDiv().BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup "+this.id+"_designer_waiting_popup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()})},n.prototype.renderFooter=function(){var i=this.dashboardDesigner.element.find("#"+this.id+"_sort_dialog_foot"),n=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_sort_dialog_btn_cancel",type:"button"}),t=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-primary bbi-dbrd-btn-small",this.locale.dialogOptions.applyButtonText,{float:"right"},{id:this.id+"_sort_dialog_btn_ok",type:"button"});i.append(n,t);t.on("click",this.bbdesigner$.proxy(this.updateSortInfo,this));n.on("click",this.bbdesigner$.proxy(this.closeDialog,this,!0))},n.prototype.getSortContainer=function(){var n=BoldBIDashboard.buildTag("div","",{padding:"5px 0px"},{}),f=BoldBIDashboard.buildTag("label","Sort By",{},{type:"label"}),t=BoldBIDashboard.buildTag("div","",{},{}),i=BoldBIDashboard.buildTag("tr","",{},{}),r=BoldBIDashboard.buildTag("td","",{padding:"5px 0px"},{}),u=BoldBIDashboard.buildTag("td","",{padding:"5px 0px"},{});this.fieldCell=BoldBIDashboard.buildTag("td","",{padding:"5px 25px"},{});var h=BoldBIDashboard.buildTag("td","",{width:"25%",padding:"5px 0px"},{}),e={callBackInstance:this,callBackMethod:"updateSortType",groupName:"sortby",labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:this.id+"_sort_dialog_alphabetic",label:"Alphabetic",isChecked:!0,value:"alphabetic"}]},o={callBackInstance:this,callBackMethod:"updateSortType",groupName:"sortby",labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:this.id+"_sort_dialog_dataSource",label:"Data Source Order",isChecked:!1,value:"datasource"}]},s={callBackInstance:this,callBackMethod:"updateSortType",groupName:"sortby",labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:this.id+"_sort_dialog_field",label:"Field",isChecked:!1,value:"field"}]};return this.sortbyAlpha=new BoldBIDashboard.Dashboard.RadioButton(e,r),this.sortbyDatasource=new BoldBIDashboard.Dashboard.RadioButton(o,u),this.sortbyField=new BoldBIDashboard.Dashboard.RadioButton(s,this.fieldCell),i.append(r,u,this.fieldCell),t.append(i),n.append(f).append(t),n},n.prototype.getFieldContainer=function(){var n=BoldBIDashboard.buildTag("div","",{padding:"5px 0px 10px",display:"none"},{}),t=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),i=BoldBIDashboard.buildTag("tr","",{},{}),r=BoldBIDashboard.buildTag("td","",{padding:"5px 0px",width:"250px"},{}),u=BoldBIDashboard.buildTag("td","",{padding:"5px 10px",width:"150px"},{}),f=BoldBIDashboard.buildTag("td","",{padding:"5px 0px"},{}),e=BoldBIDashboard.buildTag("input.e-field e-ejinputtext","",{},{type:"text",id:this.id+"_sort_dialog_column"}),o=BoldBIDashboard.buildTag("input.e-field e-ejinputtext","",{},{type:"text",id:this.id+"_sort_dialog_summary"});return r.append(e),u.append(o),i.append(r).append(u).append(f),t.append(i),n.append(t),n},n.prototype.getSortOrderContainer=function(){var n=BoldBIDashboard.buildTag("div","",{padding:"5px 0px"},{}),f=BoldBIDashboard.buildTag("label","Sort Order",{},{type:"label"}),t=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),i=BoldBIDashboard.buildTag("tr","",{},{}),r=BoldBIDashboard.buildTag("td","",{padding:"5px 0px",width:"25%"},{}),u=BoldBIDashboard.buildTag("td","",{padding:"5px 0px"},{}),e={callBackInstance:this,callBackMethod:"updateSortOrder",groupName:"sortOrder",labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:this.id+"_sort_dialog_ascending",label:"Ascending",isChecked:!0,value:"ascending"}]},o={callBackInstance:this,callBackMethod:"updateSortOrder",groupName:"sortOrder",labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:this.id+"_sort_dialog_descending",label:"Descending",value:"descending"}]};return this.sortOrderAscending=new BoldBIDashboard.Dashboard.RadioButton(e,r),this.sortOrderDescending=new BoldBIDashboard.Dashboard.RadioButton(o,u),t.append(i),i.append(r,u),n.append(f,t),n},n.prototype.getManualContainer=function(){var n=BoldBIDashboard.buildTag("div","",{padding:"5px 0px",height:"262px",display:"none"},{}),i=BoldBIDashboard.buildTag("label","Drag and drop to re-arrange the below values in desired order.",{},{type:"label"}),t=BoldBIDashboard.buildTag("div","",{height:"250px",padding:"5px 0px 0px","box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box"},{id:this.id+"_sort_dialog_listbox_Div"}),r=BoldBIDashboard.buildTag("ul","",{},{id:this.id+"_sort_dialog_listbox"});return t.append(r),n.append(i).append(t),n},n.prototype.listItemDragStart=function(){this.bbdesigner$(".e-draggable.e-droppable.dragClone.e-dragClonelist").css("z-index",BoldBIDashboard.getMaxZindex())},n.prototype.createScrollBar=function(){this.bbdesigner$(this.getListBox().BoldBIDashboardListBox("instance").listContainer).BoldBIDashboardScroller({enableTouchScroll:!1,autoHide:!0,buttonSize:this.dashboardDesigner.scrollerSize.buttonSize,scrollSize:this.dashboardDesigner.scrollerSize.scrollSize,cssClass:"bbi-dbrd-designer-scroller bbi-dbrd-control"})},n.prototype.updateColumnField=function(n){var i=this.getItemType(n.text),r=i==="Dimensions"?this.dimensionFormats:this.measureFormats,t=this.getSummaryField().data("BoldBIDashboardDropDownList");t.setModel({dataSource:r});t.selectItemByIndex(0)},n.prototype.updateSortType=function(n){var i=!BoldBIDashboard.isNullOrUndefined(n)&&!BoldBIDashboard.isNullOrUndefined(n.args)&&!BoldBIDashboard.isNullOrUndefined(n.args.value)?n.args.value:n,t;switch(i.toLowerCase()){case"alphabetic":this.fieldContainer.css("display","none");this.sortOrderContainer.css("display","block");this.manualContainer.css("display","none");this.enableSortOrder(!0);this.sortType=CustomSortType[CustomSortType.Alphabetic];break;case"datasource":this.fieldContainer.css("display","none");this.sortOrderContainer.css("display","block");this.manualContainer.css("display","none");this.enableSortOrder(!1);this.sortType=CustomSortType[CustomSortType.DataSource];break;case"field":this.fieldContainer.css("display","block");this.sortOrderContainer.css("display","block");this.manualContainer.css("display","none");this.enableSortOrder(!0);this.sortType=CustomSortType[CustomSortType.Field];break;case"manual":this.fieldContainer.css("display","none");this.sortOrderContainer.css("display","none");this.manualContainer.css("display","block");this.sortType=CustomSortType[CustomSortType.Manual];t=this.getListBoxDiv().attr("data-isLoaded");BoldBIDashboard.isNullOrUndefined(t)&&this.getListBoxDatas()}},n.prototype.getListBoxDatas=function(){var n=[{Id:this.dataInfo.Id,Name:this.dataInfo.Name,SummaryType:this.dataInfo.SummaryType,FieldType:this.dataInfo.FieldType,MeasureFormatting:this.dataInfo.MeasureFormatting,DateTimeFormat:this.dataInfo.DateTimeFormat,FilterInfo:this.dataInfo.FilterInfo,UniqueColumnName:this.dataInfo.UniqueColumnName,CustomSorting:this.dataInfo.CustomSorting}];this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.getData,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.FilterAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.getData,fieldInfo:n,dataSetId:this.dataInfo.DatasourceID,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.setListBoxValues,this,this.dataInfo.UniqueColumnName),indicator:[this.bbdesigner$.proxy(this.showLoadingIndicator,this),this.bbdesigner$.proxy(this.hideLoadingIndicator,this)]})},n.prototype.setListBoxValues=function(n,t){var i=JSON.parse(t.jsonData);!BoldBIDashboard.isNullOrUndefined(i)&&i.length>0&&(this.listBoxField=n,this.getListBox().data("BoldBIDashboardListBox").setModel({dataSource:i,fields:{value:this.listBoxField}}),this.getListBoxDiv().attr("data-isLoaded","true"))},n.prototype.showLoadingIndicator=function(){this.getListBoxDiv().BoldBIDashboardWaitingPopup("show")},n.prototype.hideLoadingIndicator=function(){this.getListBoxDiv().BoldBIDashboardWaitingPopup("hide")},n.prototype.updateSortOrder=function(n){switch(n.args.value){case"ascending":this.sortOrder=BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(SortingOrder,SortingOrder.Ascending);break;case"descending":this.sortOrder=BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(SortingOrder,SortingOrder.Descending)}},n.prototype.enableSortOrder=function(n){var t=this.getAscendingRadioButton(),i=this.getDescendingRadioButton();n?(t.prop("disabled",!1),i.prop("disabled",!1),this.sortOrderContainer.removeClass("e-radio-btn-disabled")):(t.prop("disabled",!0),i.prop("disabled",!0),this.sortOrderContainer.addClass("e-radio-btn-disabled"))},n.prototype.openSortDialog=function(n,t,i,r){this.resetSortDialog();this.targetInstance=n;this.targetMethod=t;this.dataInfo=i;this.menuItem=r;this.dialogContainer.data("BoldBIDashboardDialog").open();BoldBIDashboard.isNullOrUndefined(i)||(this.dataInfo.FieldType===FieldType.Measures?(this.getFieldRadioButton().prop("disabled",!0),this.fieldCell.addClass("e-radio-btn-disabled"),this.sortOrderContainer.find("#"+this.id+"_sort_dialog_ascending_rdo_input").prop("label","Value")):(this.getFieldRadioButton().prop("disabled",!1),this.fieldCell.removeClass("e-radio-btn-disabled"),this.sortOrderContainer.find("#"+this.id+"_sort_dialog_ascending_rdo_input").prop("label","Alphabetic")),this.customSorting=BoldBIDashboard.isNullOrUndefined(i.ChildHierarchicalFields)||BoldBIDashboard.isNullOrUndefined(i.ChildHierarchicalFields[0].CustomSorting)?BoldBIDashboard.isNullOrUndefined(i.ChildHierarchicalFields)||BoldBIDashboard.isNullOrUndefined(i.ChildHierarchicalFields[0].CustomSorting)?i.CustomSorting:i.ChildHierarchicalFields[0].CustomSorting:i.ChildHierarchicalFields[0].CustomSorting,this.populateSortInformation())},n.prototype.resetSortDialog=function(){this.customSorting=null;this.targetInstance=null;this.targetMethod=null;this.dataInfo=null;this.datasetFields=[];this.measuresList=[];this.dimensionsList=[]},n.prototype.populateSortInformation=function(){this.updateDatasetFields();this.dataInfo.IsCustomSortApplied||(this.customSorting.CustomSortType===""&&(this.customSorting.CustomSortType=CustomSortType[CustomSortType.Alphabetic]),this.customSorting.CustomSortOrder===""&&(this.customSorting.CustomSortOrder=SortingOrder[SortingOrder.Ascending]));switch(this.customSorting.CustomSortType){case CustomSortType[CustomSortType.Alphabetic]:this.getAlphabeticRadioButton().prop("checked",!0);this.updateSortType(this.customSorting.CustomSortType);break;case CustomSortType[CustomSortType.DataSource]:this.getDataSourceRadioButton().prop("checked",!0);this.updateSortType(this.customSorting.CustomSortType);break;case CustomSortType[CustomSortType.Field]:this.getFieldRadioButton().prop("checked",!0);this.updateSortType(this.customSorting.CustomSortType);break;case CustomSortType[CustomSortType.Manual]:this.getManualRadioButton().data("BoldBIDashboardRadioButton").setModel({checked:!0})}switch(this.customSorting.CustomSortOrder){case SortingOrder[SortingOrder.Ascending]:this.getAscendingRadioButton().prop("checked",!0);break;case SortingOrder[SortingOrder.Descending]:this.getDescendingRadioButton().prop("checked",!0)}this.populateFieldInfo()},n.prototype.populateFieldInfo=function(){var n=this.getColumnField().data("BoldBIDashboardDropDownList"),t=this.getSummaryField().data("BoldBIDashboardDropDownList"),i,r;n.setModel({dataSource:this.datasetFields});BoldBIDashboard.isNullOrUndefined(this.customSorting.FieldId)||this.customSorting.FieldId===""?n.selectItemByIndex(0):n.selectItemByValue(this.customSorting.FieldId);i=!BoldBIDashboard.isNullOrUndefined(this.customSorting.FieldName)&&this.customSorting.FieldName!==""?this.getItemType(this.customSorting.FieldName):this.getItemType(n.selectedTextValue.toString());r=i==="Dimensions"?this.dimensionFormats:this.measureFormats;t.setModel({dataSource:r});BoldBIDashboard.isNullOrUndefined(this.customSorting.SummaryType)?t.selectItemByIndex(0):t.selectItemByValue(this.customSorting.SummaryType)},n.prototype.updateDatasetFields=function(){var f=BoldBIDashboard.Dashboard.ConnectionHelper.getConnectionInsFromDSId(this.dashboardDesigner,this.dataInfo.DatasourceID),r=BoldBIDashboard.Dashboard.ConnectionHelper.isHierarchicalConnection(f),u,t,n,i;for(this.getSummaryField().data("BoldBIDashboardDropDownList").setModel({enabled:!r}),u=this.dashboardDesigner.modules.dataSet.datasets,t=BoldBIDashboard.DashboardUtil.getCurrentField(u,this.dataInfo.DatasourceID,r),n=0;n<t.length;n++)this.datasetFields.push({text:t[n].Name,value:t[n].Id}),i=BoldBIDashboard.DashboardUtil.getDatasetTypeIcon(t[n].TypeName),i==="bbi-designer-dataset-number"?this.measuresList.push({Name:t[n].Name,DatasetIcon:i,DataField:t[n].Id}):this.dimensionsList.push({Name:t[n].Name,DatasetIcon:i,DataField:t[n].Id})},n.prototype.getItemType=function(n){for(var i="",t=0;t<this.measuresList.length;t++)this.measuresList[t].Name===n&&(i="Measures");for(t=0;t<this.dimensionsList.length;t++)this.dimensionsList[t].Name===n&&(i="Dimensions");return i},n.prototype.updateSortInfo=function(){var i,t,n;if(!BoldBIDashboard.isNullOrUndefined(this.targetInstance)){if(i=this.getSummaryField().data("BoldBIDashboardDropDownList").model.value,t=this.getColumnField().data("BoldBIDashboardDropDownList"),this.customSorting={FieldId:t.getSelectedValue(),FieldName:this.bbdesigner$(t.getSelectedItem()).text(),SummaryType:BoldBIDashboard.DashboardDesignerUtility.Serialization.getSummaryType(i.toUpperCase()),ManualOrderList:this.getManulOrderList(),CustomSortOrder:this.sortOrder,CustomSortType:this.sortType},BoldBIDashboard.isNullOrUndefined(this.dataInfo.ChildHierarchicalFields))this.applySorting(this.dataInfo);else for(n=0;n<this.dataInfo.ChildHierarchicalFields.length;n++)this.applySorting(this.dataInfo.ChildHierarchicalFields[n]);this.getListBoxDiv().removeAttr("data-isLoaded")}this.closeDialog()},n.prototype.applySorting=function(n){n.IsCustomSortApplied=!0;n.Sorting=BoldBIDashboard.DashboardDesignerUtility.Serialization.stringtoEnum(SortingOrder,this.customSorting.CustomSortOrder);n.CustomSorting=this.customSorting;BoldBIDashboard.DashboardUtil.invokeMethod(this.targetInstance,this.targetMethod,[this.customSorting,n,this.menuItem])},n.prototype.getManulOrderList=function(){for(var t=[],i=this.getListBox().data("BoldBIDashboardListBox").getListData(),n=0;n<i.length;n++)t.push(i[n][this.listBoxField]);return t},n.prototype.closeDialog=function(){this.getListBoxDiv().removeAttr("data-isLoaded");this.dialogContainer.data("BoldBIDashboardDialog").close()},n.prototype.getAscendingRadioButton=function(){return this.sortOrderContainer.find("#"+this.id+"_sort_dialog_ascending_rdo_input")},n.prototype.getDescendingRadioButton=function(){return this.sortOrderContainer.find("#"+this.id+"_sort_dialog_descending_rdo_input")},n.prototype.getAlphabeticRadioButton=function(){return this.sortContainer.find("#"+this.id+"_sort_dialog_alphabetic_rdo_input")},n.prototype.getDataSourceRadioButton=function(){return this.sortContainer.find("#"+this.id+"_sort_dialog_dataSource_rdo_input")},n.prototype.getFieldRadioButton=function(){return this.sortContainer.find("#"+this.id+"_sort_dialog_field_rdo_input")},n.prototype.getManualRadioButton=function(){return this.sortContainer.find("#"+this.id+"_sort_dialog_manual")},n.prototype.getColumnField=function(){return this.fieldContainer.find("#"+this.id+"_sort_dialog_column")},n.prototype.getSummaryField=function(){return this.fieldContainer.find("#"+this.id+"_sort_dialog_summary")},n.prototype.getListBox=function(){return this.manualContainer.find("#"+this.id+"_sort_dialog_listbox")},n.prototype.getListBoxDiv=function(){return this.manualContainer.find("#"+this.id+"_sort_dialog_listbox_Div")},n.prototype.destroy=function(){BoldBIDashboard.DashboardUtil.destroyEjObjects(this.dialogContainer);this.dialogContainer.length>0&&this.dashboardDesigner.element.find("#"+this.id+"_sort_dialog").remove()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.SortDialog",InternalSortDialog,window),function(n){n[n.Alphabetic="Alphabetic"]="Alphabetic";n[n.DataSource="DataSource"]="DataSource";n[n.Field="Field"]="Field";n[n.Manual="Manual"]="Manual";n[n.None="None"]="None"}(CustomSortType||(CustomSortType={})),function(n){var t;(function(t){var i=function(){function t(t){this.id=null;this.dashboardDesigner=null;this.localizationContent=null;this.selectedFieldName=null;this.value=null;this.columnDetails=null;this.id=t._id;this.dashboardDesigner=t;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.widgetHelper=this.dashboardDesigner.modules.widgetHelper;this.localizationContent=this.dashboardDesigner.getLocalizationContent();this.dataconfiguration=new n.DashboardDesignerUtility.DataConfiguration(this.dashboardDesigner)}return t.prototype.onSettingsClick=function(t,i){var r,o,s;r=n.isNullOrUndefined(t.ChildHierarchicalFields)?this.bbdesigner$("#"+this.id+"_"+t.Id+"_categoryAggregateListUl_"+t.UniqueId):this.bbdesigner$("#"+this.id+"_"+t.Id+"_categoryAggregateListUlHierarchy_"+t.UniqueId);var u=r.data("BoldBIDashboardMenu"),f=this.getMenuJson(r,[],t),e=n.isNullOrUndefined(t.ChildHierarchicalFields)?"_categoryListSettingsIcon_":"_categoryListSettingsIconHierarchy_",l=this.id+"_"+t.Id+e+t.UniqueId;if(l===i.target.id)if(r.is(":visible"))u.hide();else if(r.children().length>0){o=this.dashboardDesigner.designerPanel.selectedReportItems[0];s=n.Dashboard.WidgetHelper.getWidgetInstance(o);f=s.onFieldSettingsClick(t,f);this.updateMenuJsonIntoMenu(f,u,t);var h=this.dashboardDesigner.element.find("#"+this.id+"_"+t.Id+e+t.UniqueId),a=new n.Dashboard.CreateFieldMenu(this.dashboardDesigner),c=a.calculateMenuPosition(h,h.offset(),r);u.show(c.left,c.top,this.dashboardDesigner.element.find("#"+this.id+"_"+t.Id+"_categoryListDiv_"+t.UniqueId),i)}},t.prototype.updateMenuJsonIntoMenu=function(n,t,i){for(var u=0;u<n.length;u++){var r=n[u],f=this.id+"_"+r.Name+"_"+i.UniqueId,e=this.bbdesigner$("#"+f);r.IsVisible=this.updateMenuVisibilityForFilterColumn(r,i);e.length>0&&(this.updateMenuSelection(r,e,i),this.hideOrShowMenuItem(r,f,t),this.disableOrEnableMenuItem(r,f,t),this.enableOrDisableSeperator(r,e));r.Items.length>0&&this.updateMenuJsonIntoMenu(r.Items,t,i)}},t.prototype.updateMenuVisibilityForFilterColumn=function(n,t){return t.IsFilterColumn?n.Name==="Sort"||n.Name==="RelativeDateOptions"?!1:n.Name==="DimensionFilters"||n.Name==="RelativeDateFilter"?!0:n.IsVisible:n.IsVisible},t.prototype.hideOrShowMenuItem=function(n,t,i){n.IsVisible?i.enableItemByID(t):i.hideItems(["#"+t])},t.prototype.disableOrEnableMenuItem=function(n,t,i){n.IsDisable?i.disableItemByID(t):i.enableItemByID(t)},t.prototype.enableOrDisableSeperator=function(n,t){n.EnableSeparator?t.addClass("e-separator"):t.removeClass("e-separator")},t.prototype.updateMenuSelection=function(t,i,r){var u;n.isNullOrUndefined(t.Icon)&&t.IsSelected?(u=i.find(">.e-fieldmenuListName>.e-fieldmenuListIcon"),u.addClass("e-dashboardtick-icon e-selectedfieldmenu"),t.Name!=="DimensionFilters"||n.isNullOrUndefined(r.FilterInfo)||n.isNullOrUndefined(r.FilterInfo.DimensionFilterInfo)?t.Name!=="RelativeDateFilter"||n.isNullOrUndefined(r.FilterInfo)||n.isNullOrUndefined(r.FilterInfo.RelativeDateFilterInfo)?n.isNullOrUndefined(ShowValueType[t.Name])?t.Name!=="MeasureFormat"&&t.Name!=="MeasureFilter"&&t.Name!=="RelativeDateOptions"&&t.Name!=="RelativeDateFilter"&&t.Name!=="DimensionFilters"&&u.addClass("e-summaryselectedfieldmenu"):u.addClass("e-showvaluefieldmenu"):u.addClass("e-relativefiltermenu"):u.addClass("e-filtermenu")):(u=i.find(">.e-fieldmenuListName>.e-fieldmenuListIcon"),u.removeClass("e-dashboardtick-icon e-selectedfieldmenu e-relativefiltermenu e-filtermenu e-summaryselectedfieldmenu e-showvaluefieldmenu"))},t.prototype.getPropertyChangedMenuItems=function(n,t,i,r){var f=this.getPropertyMenuList(n,t,i),u;for(f.length>0&&r.push(f[0]),u=void 0;u<n.length;u++)n[u].Items.length>0&&this.getPropertyChangedMenuItems(n[u].Items,t,i,r);return r},t.prototype.getPropertyMenuList=function(n,t,i){var r=[];switch(t){case"Visiblity":r=n.filter(function(n){return n.IsVisible===i});break;case"Selection":r=n.filter(function(n){return n.IsSelected===i});break;case"Disable":r=n.filter(function(n){return n.IsDisable===i});break;case"Separator":r=n.filter(function(n){return n.EnableSeparator===i})}return r},t.prototype.getMenuJson=function(t,i,r){var e,f,o,u;if(!n.isNullOrUndefined(t)&&t.length>0)for(e=t.find(">.e-list"),f=0;f<e.length;f++)o=this.bbdesigner$(e[f]),u=o.data("menuitem-info"),u=n.isNullOrUndefined(r.DateBucketInfo)||n.isNullOrUndefined(r.DateBucketInfo.DatebucketId)||n.DashboardUtil.IsStringNullorWhiteSpace(r.DateBucketInfo.DatebucketId)?this.updateFilterItemSelection(r,u):this.updateDateBucketFilterSelection(r.DateBucketInfo.DatebucketId,r.DateTimeFormat.toString(),u),u=this.updateEnableOrDisableForFirstLastOption(u,r),u.Items=this.getMenuJson(o.find(">ul"),[],r),i.push(u);return i},t.prototype.updateEnableOrDisableForFirstLastOption=function(t,i){var f=this.getCurrentFieldFilterInfo(i.UniqueId,i.ContainerName),u,r;if(t.Name==="First"||t.Name==="Last")for(u=this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo,r=0;r<u.FieldContainers.length;r++)(u.FieldContainers[r].DisplayName===this.localizationContent.fieldContainer.values||u.FieldContainers[r].DisplayName===this.localizationContent.fieldContainer.value||u.FieldContainers[r].DisplayName===this.localizationContent.fieldContainer.locationValue)&&(t.IsDisable=u.FieldContainers[r].FieldInfos.length===0?!0:!1);else t.Name==="MeasureFormat"&&(t.IsDisable=n.isNullOrUndefined(f)||n.isNullOrUndefined(f.DimensionFilterInfo)||n.isNullOrUndefined(f.DimensionFilterInfo.TopNFilterInfo)?!1:!0);return t},t.prototype.updateFilterItemSelection=function(t,i){var r=this.getCurrentFieldFilterInfo(t.UniqueId,t.ContainerName),u;return n.isNullOrUndefined(r)&&this.validateSubFilterInfo(i.Name)?i.IsDisable=!0:n.isNullOrUndefined(r)&&i.IsSelected?(i.Name==="RelativeDateFilter"||i.Name==="DimensionFilters"||i.Name==="RelativeDateOptions"||i.Name==="MeasureFilter"||i.Name==="Settings")&&(i.IsSelected=!1):n.isNullOrUndefined(r)||(i.Name==="DimensionFilters"?i.IsSelected=!n.isNullOrUndefined(r.DimensionFilterInfo):i.Name==="MeasureFilter"?i.IsSelected=!n.isNullOrUndefined(r.MeasureFilterInfo):i.Name==="RelativeDateFilter"?i.IsSelected=!n.isNullOrUndefined(r.RelativeDateFilterInfo):i.Name==="RelativeDateOptions"?i.IsSelected=!n.isNullOrUndefined(r.RelativeDateOptions):i.Name==="Settings"?i.IsSelected=!n.isNullOrUndefined(r.CustomDateSettingsInfo):i.Name!=="First"||t.ContainerName!=="Tooltip"||n.isNullOrUndefined(r.DimensionFilterInfo)||n.isNullOrUndefined(r.DimensionFilterInfo.TopNFilterInfo)?i.Name!=="Last"||t.ContainerName!=="Tooltip"||n.isNullOrUndefined(r.DimensionFilterInfo)||n.isNullOrUndefined(r.DimensionFilterInfo.TopNFilterInfo)||(i.IsSelected=r.DimensionFilterInfo.TopNFilterInfo.Mode===RankType.Bottom):i.IsSelected=r.DimensionFilterInfo.TopNFilterInfo.Mode===RankType.Top,u=this.validateSubFilterInfo(i.Name),n.isNullOrUndefined(r.MeasureFilterInfo)&&i.Name==="ClearMeasureFilter"||n.isNullOrUndefined(r.DimensionFilterInfo)&&i.Name==="ClearDimensionFilter"||n.isNullOrUndefined(r.RelativeDateFilterInfo)&&i.Name==="ClearRelativeDate"||n.isNullOrUndefined(r.RelativeDateOptions)&&i.Name==="ClearRelativeDateOptions"||n.isNullOrUndefined(r.CustomDateSettingsInfo)&&i.Name==="ClearCustomDateSettings"?i.IsDisable=!0:u&&(i.IsDisable=!1)),i},t.prototype.validateSubFilterInfo=function(n){return n==="ClearMeasureFilter"||n==="ClearDimensionFilter"||n==="ClearRelativeDateOptions"||n==="ClearRelativeDate"||n==="ClearCustomDateSettings"},t.prototype.getCurrentFieldFilterInfo=function(n,t){var u=this.widgetHelper.getCurrentWidgetInstance(),f=u.DataGroupInfo,r=f.FieldContainers.filter(function(n){return n.Name===t}),i;return r.length>0&&(i=r[0].FieldInfos.filter(function(t){return t.UniqueId===n}),i.length>0)?i[0].FilterInfo:null},t.prototype.updateDateBucketFilterSelection=function(n,t,i){var r=i.Name.toString().replace(/\s/g,"");r=this.isDatebucketFieldInfo(i.Name)?this.getDateBucketWidgetID(i.Name):r;switch(r){case n:i.IsSelected=!0;break;case t:i.IsSelected=!1;break;default:return i}return i},t.prototype.getDateBucketWidgetID=function(t){if(!n.DashboardUtil.IsStringNullorWhiteSpace(t))return t.split("DateBucket_")[1]},t.prototype.getFieldMenuName=function(t,i){for(var e,o,r=t.Name.replace(/\s/g,""),s=DateTimeFormat[r]||DateTimeFormatForFilter[r],f=this.dashboardDesigner.modules.widgetHelper.getAllDatebucketWidgets(),u=0;u<f.length;u++)if(n.isNullOrUndefined(s)&&this.isDatebucketFieldInfo(r)){if(f[u].isDefaultDataWidget()&&f[u].getContainerSettings().Title===t.DisplayName)return e=f[u],r=e.getJson().selectedValue.replace(/\s/g,""),n.isNullOrUndefined(i.DateBucketInfo)&&(i.DateBucketInfo=new DateBucketInformation),i.DateBucketInfo.DatebucketId="",o=t.Name.split("DateBucket_")[1],i.DateBucketInfo.DatebucketId=o,i.DateBucketInfo.DateBucketFormat=DateTimeFormat[r],n.DashboardUtil.invokeMethod(f[u],"updateConfiguredWidgetsInfoList",[i]),r}else this.isDatebucketFieldInfo(r)||n.isNullOrUndefined(i.DateBucketInfo)||(i.DateBucketInfo=null,n.DashboardUtil.invokeMethod(f[u],"removeConfiguredWidgetsInfoList",[i]));return r},t.prototype.isDatebucketFieldInfo=function(n){return n.indexOf("DateBucket_")!==-1},t.prototype.onSettingsMenuItemClick=function(t,i){var o=this.bbdesigner$("#"+this.id+"_"+t.Id+"_categoryAggregateListUl_"+t.UniqueId).find(".e-mhover"),v,h,p,w,a,b,k;o=n.isNullOrUndefined(t.ChildHierarchicalFields)?o:this.bbdesigner$("#"+this.id+"_"+t.Id+"_categoryAggregateListUlHierarchy_"+t.UniqueId).find(".e-mhover");var e=o.closest("li").data("menuitem-info"),d=o.closest("li").data("hierarchy-info"),u=this.getFieldMenuName(e,t),f=o.closest("li").children("ul").length===0;if(this.selectedFieldName=t.DateTimeFormat.toString(),v=this.selectedFieldName,!n.isNullOrUndefined(o)&&u!==this.dashboardDesigner.getLocalizationContent().dataconfiguration.menuItems.more&&!0){h=this.bbdesigner$("#"+this.id+"_"+t.Id+"_categoryAggregateListUl_"+t.UniqueId).data("BoldBIDashboardMenu");h=n.isNullOrUndefined(t.ChildHierarchicalFields)?h:this.bbdesigner$("#"+this.id+"_"+t.Id+"_categoryAggregateListUlHierarchy_"+t.UniqueId).data("BoldBIDashboardMenu");f&&h.hide();var s=this.dashboardDesigner.element.find("#"+this.id+"_"+t.Id+"_categoryListLabel_"+t.UniqueId),c=this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo,l=this.widgetHelper.getCurrentWidgetInstance().dataConfigurationInstance.dimensionsList,r=this.getCurrentFieldInfoByUniqueName(c,t.UniqueColumnName),y=this.getCurrentDimensionFieldInfoById(l,t.Id);u==="Rename"&&(f=!1,p=this.dashboardDesigner.element.find("#"+this.id+"_"+t.Id+"_categoryListEditableTextBox_"+t.UniqueId),this.enableFieldRenameOption(p,s));u==="Sort"?(f=!1,this.sortClick(r,e)):u==="CreateHierarchy"?(f=!1,this.editCreateHierarchyFilterClick(y,l,t)):u==="Remove"?(f=!1,this.editRemoveCustomHierarchy(t)):u==="AddToHierarchy"?(f=!1,this.editAddToHierarchyFilterClick(y,l,d)):u==="EditDimensionFilter"?(f=!1,this.editDimensionFilterClick(r)):u==="EditMeasureFilter"?(f=!1,this.editMeasureFilterClick(r)):u==="ClearMeasureFilter"?this.clearMeasureFilterClick(r):u==="ClearDimensionFilter"||u==="ClearRelativeDate"?this.clearDimensionOrClearRelativeDateClick(r,e):u==="MeasureFormat"?(f=!1,this.measureFormatClick(r)):u==="EditSettings"?(f=!1,this.customDateDialog(r,v)):u==="EditRelativeDate"?(f=!1,this.editRelativeDateClick(r,e)):u==="EditRelativeDateOptions"?(f=!1,this.widgetHelper.getCurrentWidgetInstance().Type==="ListBox"||this.widgetHelper.getCurrentWidgetInstance().Type==="ComboBox"?!n.isNullOrUndefined(c.FieldContainers[1].FieldInfos)&&c.FieldContainers[1].FieldInfos.length>0?this.dashboardDesigner.modules.util.alertDialog(this.localizationContent.alertDialogTitle.relativeDatesAlert,this.localizationContent.relativeDateMessages.displayColumnBinded,IconType.warning,AlertType.Alert,!1,""):this.editRelativeDateOptionsClick(r):this.editRelativeDateOptionsClick(r)):u==="ClearRelativeDateOptions"?(f=!1,this.clearRelativeDateOptionsClick(r,e)):u==="First"?(f=!1,this.updateFirstAndLastFilterInfo(r,!0),this.updateLabelText(r,e)):u==="Last"?(f=!1,this.updateFirstAndLastFilterInfo(r,!1),this.updateLabelText(r,e)):n.isNullOrUndefined(SummaryType[e.Name])?n.isNullOrUndefined(ShowValueType[e.Name])?u!=="MeasureFormat"&&u!=="MeasureFilter"&&u!=="RelativeDateOptions"&&u!=="RelativeDateFilter"&&u!=="DimensionFilters"&&u!=="MeasureFormat"&&u!=="Rename"&&i.text!==n.DashboardDesignerUtility.Serialization.enumToString(DateTimeFormat,r.DateTimeFormat)&&(r.IsShowAllRecords=!0,r.FilterInfo=null,e.IsSelected=!0,this.removeMenuSelection(r),this.widgetHelper.getCurrentWidgetInstance().clearFilter(),a=this.isDatebucketFieldInfo(e.Name.replace(/\s/g,"")),n.isNullOrUndefined(DateTimeFormat[u])||a||(r.DateTimeFormat=t.DateTimeFormat=DateTimeFormat[u]),a?f=!1:(b=i.text===this.dashboardDesigner.getLocalizationContent().dataconfiguration.summary.none?r.Name:u+"("+r.Name+")",r.IsDisplayNameEdited||(r.DisplayName=this.dashboardDesigner.modules.util.getDisplayName(r),s.text(r.DisplayName)),s.parents(".bbi-assigndata-dropped-field").attr("data-tooltip",b))):(this.removeSelectedShowValueType(r),e.IsSelected=!0,r.ShowValueType=e.Name):(t.ContainerName!=="Tooltip"||n.isNullOrUndefined(r.FilterInfo)||(r.FilterInfo=null),this.removeMenuSelection(r),e.IsSelected=!0,r.SummaryType=e.Name,w=this.dashboardDesigner.modules.util.getSummaryTypeLocalizedText(r.SummaryType)+"("+r.Name+")",r.IsDisplayNameEdited||(r.DisplayName=this.dashboardDesigner.modules.util.getDisplayName(r),s.text(r.DisplayName)),s.parents(".bbi-assigndata-dropped-field").attr("data-tooltip",w));k={update:!0,columnUpdate:!1,rowUpdate:!1,valueUpdate:!1};this.widgetHelper.getCurrentWidgetInstance().updateDataGroupInfo(c,k);f&&this.getDataConfigInstance().postDraggedFields()}},t.prototype.removeSelectedShowValueType=function(t){var r=this.bbdesigner$("#"+this.id+"_"+t.ShowValueType+"_"+t.UniqueId).find(".e-showvaluefieldmenu"),i=r.closest("li.e-list").data("menuitem-info");n.isNullOrUndefined(i)||n.isNullOrUndefined(ShowValueType[i.Name])||(i.IsSelected=!1)},t.prototype.updateLabelText=function(n,t){this.removeMenuSelection(n);var i=this.dashboardDesigner.element.find("#"+this.id+"_"+n.Id+"_categoryListLabel_"+n.UniqueId);t.IsSelected=!0;n.IsDisplayNameEdited||(n.DisplayName=this.dashboardDesigner.modules.util.getDisplayName(n),i.text(n.DisplayName));i.parents(".bbi-assigndata-dropped-field").attr("data-tooltip",n.DisplayName)},t.prototype.updateFirstAndLastFilterInfo=function(t,i){for(var r,s,o,h,f=this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo,e,u=0;u<f.FieldContainers.length;u++)(f.FieldContainers[u].DisplayName===this.localizationContent.fieldContainer.values||f.FieldContainers[u].DisplayName===this.localizationContent.fieldContainer.measure||f.FieldContainers[u].DisplayName===this.localizationContent.fieldContainer.value||f.FieldContainers[u].DisplayName===this.localizationContent.fieldContainer.locationValue||f.FieldContainers[u].DisplayName===this.localizationContent.fieldContainer.xAxis||f.FieldContainers[u].DisplayName===this.localizationContent.fieldContainer.actualValue)&&(e=f.FieldContainers[u].FieldInfos[0]);r=new DimensionFilterInfo;r.IsTopNFilteringApplied=!0;r.TopNFilterInfo=new TopNFilteringInfo;r.TopNFilterInfo.ColumnId=e.Id;r.TopNFilterInfo.ColumnName=e.Name;r.TopNFilterInfo.Mode=i?RankType.Top:RankType.Bottom;r.TopNFilterInfo.IsBasedOnDateAndTimeField=!1;r.TopNFilterInfo.NoOfRecords=1;s=this.widgetHelper.getCurrentWidgetInstance();o=s.getJson().FilterSettings;r.TopNFilterInfo.IsHierarchicalFilter=n.isNullOrUndefined(o)?!0:o.HierarchicalFilter;r.TopNFilterInfo.SummaryType=e.SummaryType;h=[r,t];t.DisplayName=t.Name;t.SummaryType=SummaryType.NONE;n.DashboardUtil.invokeMethod(this,"dimensionFilterAction",h)},t.prototype.enableFieldRenameOption=function(n,t){n.val(t.text());n.addClass("show-fieldInfo-textbox");t.addClass("hide-fieldInfo-label");n.focus()},t.prototype.removeMenuSelection=function(t){var r=this.bbdesigner$("#"+this.id+"_"+t.Id+"_categoryAggregateListUl_"+t.UniqueId).find(".e-summaryselectedfieldmenu"),i=r.parents("li.e-list").data("menuitem-info");n.isNullOrUndefined(i)||(i.IsSelected=!1)},t.prototype.createCustomSorting=function(){return new n.Dashboard.CustomSortForUI},t.prototype.sortClick=function(t,i){var r=JSON.parse(JSON.stringify(t)),f=this.dashboardDesigner.modules.sortDialog,u;n.isNullOrUndefined(r.CustomSorting)&&(r.CustomSorting=this.createCustomSorting(),r.CustomSorting.CustomSortType=r.ContainerName.toLowerCase()==="row"&&r.Sorting===SortingOrder.None?CustomSortType[CustomSortType.DataSource]:r.CustomSorting.CustomSortType);u=this.widgetHelper.getCurrentWidgetInstance();f.openSortDialog(this,"updateSortInfo",r,i,u.Type)},t.prototype.editRemoveCustomHierarchy=function(n){this.dashboardDesigner.modules.util.alertDialog(this.dashboardDesigner.getLocalizationContent().customHierarchy.titleText,this.dashboardDesigner.getLocalizationContent().customHierarchy.dialogContentText,IconType.question,AlertType.Confirm,!1,"",{height:140,width:500,method:"alertBoxtoRemoveHierarchy",dataInfo:{fieldInfo:n},instance:this.dataconfiguration})},t.prototype.editCreateHierarchyFilterClick=function(t,i,r){var h=0,s=0,v=this.dashboardDesigner.modules.dataSet.datasets,f,l,a,e,o;n.isNullOrUndefined(t.ParentId)||delete t.ParentId;f=JSON.parse(JSON.stringify(t));f.Name=f.Name+" Hierarchy";f.ChildHierarchicalFields=[];f.ChildHierarchicalFields.push(JSON.parse(JSON.stringify(t)));var u=this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_"+t.ContainerName+"_categoryList"),y=this.widgetHelper.getCurrentWidgetInstance().dataConfigurationInstance,p=y.selectedDatasetId,w=v.findIndex(function(n){return n.Id===p}),c=this.dataconfiguration.createLabelForHeirachialDroppedField(f,!0,y,!0);for(v[w].CustomHierarchyFields.push(f),l=this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_Dimensions_categoryListPanel").data("BoldBIDashboardScroller"),a=c.find(".e-heirachy-field").data("fields"),e=0;e<i.length;e++)if(t.Id===i[e].Id){h=e+1;break}for(o=0;o<u[0].children.length;o++)this.dashboardDesigner._id+"_"+r.Id+"_categoryListDiv"===u[0].children[o].id&&(s=o+1);!n.isNullOrUndefined(u)&&u.length>0&&(s>-1&&u.children().length>0&&s<u.children().length?c.insertBefore(u.children().eq(s)):c.insertBefore(u.children().last()));this.dataconfiguration.setParentId(a);a.forEach(function(n){i.splice(h,0,n);h++});n.isNullOrUndefined(l)||l.refresh()},t.prototype.editAddToHierarchyFilterClick=function(t,i,r){var u,o,k,y,c;n.isNullOrUndefined(t.ChildHierarchicalFields)||delete t.ChildHierarchicalFields;var v=0,l=0,p=!1,e,s=this.dashboardDesigner.modules.dataSet.datasets,f=this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_"+t.ContainerName+"_categoryList"),w=this.widgetHelper.getCurrentWidgetInstance().dataConfigurationInstance,d=w.selectedDatasetId,h=s.findIndex(function(n){return n.Id===d}),a,b=this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_Dimensions_categoryListPanel").data("BoldBIDashboardScroller");for(u=0;u<i.length;u++)i[u].Id===r.Id&&!n.isNullOrUndefined(i[u].HasChild)&&i[u].HasChild&&(e=JSON.parse(JSON.stringify(i[u])),n.isNullOrUndefined(e.ChildHierarchicalFields)||delete e.ChildHierarchicalFields,v=u),(i[u].Id!==r.Id||i[u].TreeNode!=="hierarchy")&&(n.isNullOrUndefined(i[u].ParentId)||i[u].ParentId!==r.Id)||(i.splice(u,1),u=u-1);if(o=s[h].CustomHierarchyFields.find(function(n){return n.Id===r.Id}),o=n.isNullOrUndefined(o)?r:o,e.ChildHierarchicalFields=[],o.ChildHierarchicalFields.forEach(function(n){e.ChildHierarchicalFields.push(n);n.Id===t.Id&&(p=!0)}),e.ChildHierarchicalFields.push(JSON.parse(JSON.stringify(t))),!p){for(n.isNullOrUndefined(s[h].CustomHierarchyFields[s[h].CustomHierarchyFields.indexOf(o)])||this.dashboardDesigner.modules.dataSet.datasets[h].CustomHierarchyFields[s[h].CustomHierarchyFields.indexOf(o)].ChildHierarchicalFields.push(JSON.parse(JSON.stringify(t))),a=this.dataconfiguration.createLabelForHeirachialDroppedField(e,!0,w,!0),k=f.children().length,f.children().remove("#"+this.dashboardDesigner._id+"_Dimension_categoryList_treeview_"+r.Id),k===f.children().length&&f.children().remove("#"+this.dashboardDesigner._id+"_"+r.Id+"_categoryListParentDiv_"+r.UniqueId),y=a.find(".e-heirachy-field").data("fields"),c=0;c<f[0].children.length;c++)this.dashboardDesigner._id+"_"+r.Id+"_categoryListDiv"===f[0].children[c].id&&(l=c+1);!n.isNullOrUndefined(f)&&f.length>0&&(l>-1&&f.children().length>0&&l<f.children().length?a.insertBefore(f.children().eq(l)):a.insertBefore(f.children().last()));this.dataconfiguration.setParentId(y);y.forEach(function(n){i.splice(v,0,n);v++});n.isNullOrUndefined(b)||b.refresh()}},t.prototype.editDimensionFilterClick=function(t){var i=JSON.parse(JSON.stringify(t)),u=!n.isNullOrUndefined(i)&&!n.isNullOrUndefined(i.FilterInfo)?i.FilterInfo.DimensionFilterInfo:null,r=this.widgetHelper.getCurrentWidgetInstance();r.Type==="DatePicker"||r.Type==="PeriodOverPeriod"?this.dashboardDesigner.modules.rangeFilterDialog.openFilterDialog(this,"dimensionFilterAction",i,u):this.dashboardDesigner.modules.dimensionFilter.openDimensionFilterWindow(this,"dimensionFilterAction",i,u,r)},t.prototype.customDateDialog=function(t,i){var r=JSON.parse(JSON.stringify(t)),u=r.FilterInfo!=null&&!n.isNullOrUndefined(r.FilterInfo.CustomDateSettingsInfo)?r.FilterInfo.CustomDateSettingsInfo:new n.Dashboard.DatesettingInfoForUI,f=this.dashboardDesigner.modules.dateinfo;u.UniqueColumnName=r.UniqueColumnName;f.selectedFieldName=i;f.openDatesettingClick(this,"dateSettingsAction",r,u)},t.prototype.editMeasureFilterClick=function(t){var i=JSON.parse(JSON.stringify(t)),r=i.FilterInfo!=null&&!n.isNullOrUndefined(i.FilterInfo.MeasureFilterInfo)?i.FilterInfo.MeasureFilterInfo:new n.Dashboard.MeasureFilterInfoForUI;r.UniqueColumnName=i.UniqueColumnName;this.dashboardDesigner.modules.measureFilter.openMeasureFilter(this,"measureFilterAction",i,r,!1)},t.prototype.clearMeasureFilterClick=function(n){n.FilterInfo=null;n.IsShowAllRecords=!0},t.prototype.clearDimensionOrClearRelativeDateClick=function(t,i){t.FilterInfo.DimensionFilterInfo=null;n.isNullOrUndefined(t.FilterInfo.RelativeDateFilterInfo)||(t.FilterInfo.RelativeDateFilterInfo=null);t.IsShowAllRecords=!0;i.IsDisable=!0;this.widgetHelper.getCurrentWidgetInstance().clearFilter()},t.prototype.measureFormatClick=function(t){var i=this,r=n.isNullOrUndefined(t.MeasureFormatting)?new MeasureFormatting:JSON.parse(JSON.stringify(t.MeasureFormatting));this.dashboardDesigner.modules.formatDialog.openFormatDialog(r,this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo.DataSourceName,function(n){t.MeasureFormatting=n;i.getDataConfigInstance().postDraggedFields()})},t.prototype.editRelativeDateClick=function(t,i){var r=JSON.parse(JSON.stringify(t)),u=null;n.isNullOrUndefined(r.FilterInfo)||n.isNullOrUndefined(r.FilterInfo.RelativeDateFilterInfo)?(u=new RelativeDateFilterInfo,u.ColumnId=r.Id,u.ColumnName=r.Name):u=r.FilterInfo.RelativeDateFilterInfo;u.UniqueColumnName=r.UniqueColumnName;this.dashboardDesigner.modules.relativeDateFilter.openRelativeDateFilter(this,"relativeDateFilterAction",u,r,i)},t.prototype.editRelativeDateOptionsClick=function(t){this.columnDetails=t;var i=!n.isNullOrUndefined(t.FilterInfo)&&!n.isNullOrUndefined(t.FilterInfo.RelativeDateOptions)?t.FilterInfo.RelativeDateOptions:[],r=this.bbdesigner$.extend([],!0,i);this.dashboardDesigner.modules.relativeDates.openRelativeDatesDialog(this,"relativeDateOptionsAction",r)},t.prototype.clearRelativeDateOptionsClick=function(t,i){var r,u;n.isNullOrUndefined(t.FilterInfo)||n.isNullOrUndefined(t.FilterInfo.RelativeDateOptions)||(t.FilterInfo.RelativeDateOptions=null,i.IsDisable=!0,r=this.widgetHelper.getCurrentWidgetInstance(),r.clearFilter(),(r.Type==="ComboBox"||r.Type==="ListBox")&&(u=this.dashboardDesigner.element.find("#"+this.id+"_"+t.Id+"_categoryListLabel_"+t.UniqueId),t.DisplayName=this.dashboardDesigner.modules.util.getDisplayName(t),u.text(t.DisplayName),u.parents(".bbi-assigndata-dropped-field").attr("data-tooltip",t.DisplayName)))},t.prototype.getCurrentFieldInfoByUniqueName=function(t,i){var r,f,u;if(!n.isNullOrUndefined(t))for(r=0;r<t.FieldContainers.length;r++)if(f=t.FieldContainers[r].FieldInfos,u=f.filter(function(n){return n.UniqueColumnName===i}),u.length>0)return u[0];return null},t.prototype.getCurrentDimensionFieldInfoById=function(t,i){if(!n.isNullOrUndefined(t)&&!n.isNullOrUndefined(i)){var r=t.filter(function(t){return t.Id===i&&n.isNullOrUndefined(t.ParentId)&&n.isNullOrUndefined(t.TreeNode)});if(r.length>0)return r[0]}return null},t.prototype.getDataConfigInstance=function(){return this.dashboardDesigner.modules.dataConfiguration},t.prototype.dimensionFilterAction=function(t,i){for(var u,r,e,o=this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo,f=0;f<o.FieldContainers.length;f++)for(u=o.FieldContainers[f].FieldInfos,r=0;r<u.length;r++)u[r].UniqueColumnName===i.UniqueColumnName&&(n.isNullOrUndefined(u[r].FilterInfo)?n.isNullOrUndefined(t)?u[r].FilterInfo=null:(e=new n.Dashboard.FilterInfoForUI,e.DimensionFilterInfo=t,u[r].FilterInfo=e):(u[r].FilterInfo.RelativeDateFilterInfo=null,u[r].FilterInfo.DimensionFilterInfo=t)),i.UniqueId===u[r].UniqueId&&(i.DateTimeFormat=u[r].DateTimeFormat);n.isNullOrUndefined(t)||(this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo.IsShowAllRecords=!1);this.getDataConfigInstance().postDraggedFields()},t.prototype.measureFilterAction=function(n){for(var u,i,f,e=this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo,r=new MeasureCondition,t=0;t<n.Values.length;t++)u=n.Values[t],r.Values.push(u);i={MeasureFilterInfo:{ColumnName:n.ColumnName,SummaryType:n.SummaryType,UniqueColumnName:n.UniqueColumnName,Conditions:n.Conditions,Values:r.Values}};f=this.getCurrentFieldInfoByUniqueName(e,n.UniqueColumnName);f.FilterInfo=i.MeasureFilterInfo.Values.length!==0?i:null;this.getDataConfigInstance().postDraggedFields()},t.prototype.relativeDateOptionsAction=function(n){var u=this.widgetHelper.getCurrentWidgetInstance(),f=u.DataGroupInfo,e={RelativeDateOptions:n},r,i,t,o,s;if(f.FieldContainers.length>=1)for(r=0;r<f.FieldContainers.length;r++)for(i=f.FieldContainers[r].FieldInfos,t=0;t<i.length;t++)o=e.RelativeDateOptions.length===0?null:e.RelativeDateOptions.length>=1&&i[t].UniqueColumnName?e:i[t].FilterInfo,u.Type==="ComboBox"||u.Type==="ListBox"?this.columnDetails.UniqueColumnName===i[t].UniqueColumnName&&(i[t].FilterInfo=o,s=this.dashboardDesigner.element.find("#"+this.id+"_"+i[t].Id+"_categoryListLabel_"+i[t].UniqueId),i[t].DisplayName="Relative Dates("+i[t].Name+")",s.text(i[t].DisplayName),s.parents(".bbi-assigndata-dropped-field").attr("data-tooltip","Relative Dates("+i[t].Name+")")):i[t].FilterInfo=o;this.getDataConfigInstance().postDraggedFields()},t.prototype.relativeDateFilterAction=function(t,i){var e=i,f=this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo,r,u;f.FieldContainers.length>=1&&(r=this.getCurrentFieldInfoByUniqueName(f,e.UniqueColumnName),n.isNullOrUndefined(r.FilterInfo)?(u=new n.Dashboard.FilterInfoForUI,u.RelativeDateFilterInfo=t,r.FilterInfo=u):(r.FilterInfo.DimensionFilterInfo=null,r.FilterInfo.RelativeDateFilterInfo=t));n.isNullOrUndefined(t)||(this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo.IsShowAllRecords=!1);this.getDataConfigInstance().postDraggedFields()},t.prototype.dateSettingsAction=function(n){var i=this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo,t={CustomDateSettingsInfo:{Format:n.Format,CustomFormat:n.CustomFormat,FiscalYear:n.FiscalYear,UniqueColumnName:n.UniqueColumnName}},r=this.getCurrentFieldInfoByUniqueName(i,n.UniqueColumnName);r.FilterInfo=t.CustomDateSettingsInfo!=null?t:null;this.getDataConfigInstance().postDraggedFields()},t.prototype.updateSortInfo=function(t,i,r){var s,e,f,o,u,h,c;if(BoldBIDashboardDesigner.editManager.isPerformAction||(r.IsSelected=!0),s=this.dashboardDesigner.designerPanel,s.selectedReportItems.length>0)for(e=this.widgetHelper.getCurrentWidgetInstance().DataGroupInfo,f=0;f<e.FieldContainers.length;f++)if(i.ContainerName===e.FieldContainers[f].Name)for(o=0;o<e.FieldContainers[f].FieldInfos.length;o++)u=e.FieldContainers[f].FieldInfos[o],n.isNullOrUndefined(u.UniqueId)&&(u.UniqueId="LabelData"+(o+1)),u.UniqueId===i.UniqueId&&(h=[u.CustomSorting,i,r],c=[t,i,r],BoldBIDashboardDesigner.editManager.addCmdAction(CommandAction.UpdateSort,"updateSortInfo","DataConfiguration","",h,c),u.CustomSorting=t,u.IsCustomSortApplied=i.IsCustomSortApplied);this.getDataConfigInstance().postDraggedFields()},t}();t.FieldMenuHandler=i})(t=n.Dashboard||(n.Dashboard={}))}(BoldBIDashboard||(BoldBIDashboard={}));InternalSqlEditor=function(){function n(n){this.value="";this.editorTag=null;this.indicesTag=null;this.bbdesigner$=n.bbdesigner$;this.id=n._id;this.manager=new SqlEditorUndoManager(n)}return n.prototype.renderQueryEditor=function(n){this.queryEditor=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_queryEditor"});var i=this.indicesTag=BoldBIDashboard.buildTag("div","",{height:"100%",width:"40px","text-align":"right","padding-top":"10px","background-color":"#ececec",overflow:"hidden",position:"absolute",display:"block"},{id:this.id+"_queryEditor_indices"}),t=this.editorTag=BoldBIDashboard.buildTag("div.bbi-designer-queryEditor","",{"padding-left":"15px","padding-top":"10px",height:"100%",width:"96.5%","margin-left":"40px","white-space":"pre",position:"absolute",overflow:"hidden",display:"block","border-color":"#cbcbcb","border-style":"solid","border-width":"0.4px","border-top-width":"0px"},{id:this.id+"_queryEditor_editor",contenteditable:"true"}),r=BoldBIDashboard.buildTag("div","1",{"padding-right":"4px"},{id:this.id+"_queryEditor_indices0"});i.append(r);t.bind("keydown",this.bbdesigner$.proxy(this.onEditorKeydown,this));t.bind("scroll",this.bbdesigner$.proxy(this.scrollLeft,this));t.bind("keypress",this.bbdesigner$.proxy(this.onEditorKeyPress,this));t.bind("keyup",this.bbdesigner$.proxy(this.onEditorKeyUp,this));this.queryEditor.append(i);this.queryEditor.append(t);n.append(this.queryEditor)},n.prototype.onEditorKeydown=function(n){this.updateIndices();n.ctrlKey&&(n.keyCode===90||n.keyCode===89)&&(n.preventDefault(),n.stopPropagation())},n.prototype.onEditorKeyUp=function(n){var p,s,w,b,c,k,r,l,a,v,t,i,u,f,y;if(n.keyCode===13)for(p=0,t=0;t<this.editorTag[0].childNodes.length;t++)this.editorTag[0].childNodes[t].nodeName.substr(1).trim()==="p"&&(p===0||t===1?(s=this.editorTag[0].childNodes[t],w=document.createElement("div"),s.parentNode.replaceChild(w,s),w.innerHTML=s.textContent===""?"<br/>":s.textContent,p++):this.bbdesigner$(this.editorTag[0].childNodes[t]).remove());if(n.ctrlKey&&n.keyCode!==65&&n.keyCode!==67)if(b=n.keyCode?n.keyCode:n.which,n.ctrlKey&&n.keyCode===90)this.manager.isUndo()&&this.manager.undo();else if(n.ctrlKey&&n.keyCode===89)this.manager.isRedo()&&this.manager.redo();else if(n.ctrlKey&&n.keyCode===86){this.queryEditor.find("#"+this.id+"_queryEditor_editor")[0].innerHTML!=="<br>"&&this.setQuery(this.queryEditor.find("#"+this.id+"_queryEditor_editor")[0].innerText);this.updateDivIndices();var o=this.queryEditor.find("#"+this.id+"_queryEditor_editor"),d=this.editorTag[0].children.length,e=[],h=0;for(t=0;t<d;t++)if(o[0].childNodes[t].children&&o[0].childNodes[t].children.length)for(r=0;r<o[0].childNodes[t].childNodes.length;r++)o[0].childNodes[t].childNodes[r].id&&(h=t,e.push(o[0].childNodes[t].childNodes[r]));for(c=0;c<e.length;c++)e[c].id=this.id+"_queryEditor_editor_childNode"+c;for(k=this.queryEditor.find("#"+this.id+"_queryEditor_editor"+h),r=0;r<e.length;r++)if(r===0){var g=e[0].innerHTML,nt=o[0].childNodes[h].innerHTML,tt=nt+g;this.queryEditor.find("#"+this.id+"_queryEditor_editor"+h)[0].innerHTML=tt}else this.bbdesigner$("#"+e[r].id).insertAfter(k),k=this.bbdesigner$("#"+e[r].id);for(this.updateDivIndices(),l=this.queryEditor.find("#"+this.id+"_queryEditor_editor"+h)[0],a=0;a<l.childNodes.length;a++)l.childNodes[a].id&&l.removeChild(l.childNodes[a])}else{for(v=this.editorTag,t=0;t<v[0].children.length;t++)v[0].children[t].innerHTML==="<br>"&&(v[0].children[t].innerHTML="");if(i=window.getSelection().anchorNode.parentNode,b!==13&&b!==8||window.getSelection().anchorNode.textContent!==" ")if(i.id&&i.id!==this.id+"_queryEditor_editor")if(u=i.children,i.id===this.id+"_queryEditor"&&u.length===2)for(f=0;f<u.length;f++)u[f].id===this.id+"_queryEditor_editor"&&this.updateText(u[f],n);else this.updateText(i,n);else this.updateText(i.parentNode,n)}if((n.keyCode>=65&&n.keyCode<=90||window.getSelection().anchorNode.textContent!==" ")&&!n.ctrlKey&&n.keyCode!==37&&n.keyCode!==38&&n.keyCode!==39&&n.keyCode!==40&&n.keyCode!==13&&n.keyCode!==16&&n.keyCode!==17)if(i=window.getSelection().anchorNode.parentNode,i.id&&i.id!==this.id+"_queryEditor_editor")if(u=i.children,i.id===this.id+"_queryEditor"&&u.length===2)for(f=0;f<u.length;f++)u[f].id===this.id+"_queryEditor_editor"&&this.updateText(u[f],n);else this.updateText(i,n);else this.updateText(i.parentNode,n);this.updateIndices();n.ctrlKey&&n.keyCode===90&&this.manager.isUndo()||n.ctrlKey&&n.keyCode===89&&this.manager.isRedo()||(y=this.editorTag[0].innerHTML,this.value!==y&&(this.manager.addCmdAction("TextUndo",this.value,y),this.value=y))},n.prototype.updateIndices=function(){var u=this.editorTag,i=u[0].children.length,n,r,t;if(i>0)for(this.indicesTag.empty(),n=0;n<i;n++)r=n+1,t=BoldBIDashboard.buildTag("div","",{"padding-right":"4px"},{}),t.attr({id:this.id+"_queryEditor_indices"+n}),this.indicesTag.append(t),this.queryEditor.find("#"+this.id+"_queryEditor_indices"+n).text(r.toString())},n.prototype.getQuery=function(){var n=this.editorTag;return n[0].innerText.replace(/\r?\n/g,"\n")},n.prototype.setQuery=function(n){var c,r,u,i,f,t,e,l,a,o,s,h;if(this.manager.reset(),this.editorTag.empty(),this.indicesTag.empty(),this.indicesTag[0].children.length||(c=BoldBIDashboard.buildTag("div","1",{"padding-right":"4px"},{id:this.id+"_queryEditor_indices0"}),this.indicesTag.append(c)),n.length===0)this.editorTag[0].children.length||(t=BoldBIDashboard.buildTag("div.bbi-designer-queryEditor","",{},{id:this.id+"_queryEditor_editor0"}),this.editorTag.append(t),t[0].innerHTML="<br>",this.value===""&&(this.value=this.editorTag[0].innerHTML));else for(r=void 0,n?(n=n.replace(/<\/?span[^>]*>/g,""),n=n.replace(/\r?\n/g,"\n"),n=n.replace(/</g,"&lt;"),n=n.replace(/>/g,"&gt;")):(n="",r=""),r=this.setKeyword(n),u=r===""?[]:r.split("\n"),i=0;i<u.length;i++)f=this.indicesTag[0].children.length,t=BoldBIDashboard.buildTag("div.bbi-designer-queryEditor","",{},{id:this.id+"_queryEditor_editor"+i}),t.attr("spellcheck","false"),e=BoldBIDashboard.buildTag("div","",{"padding-right":"4px"},{id:this.id+"_queryEditor_indices"+i}),l=this.editorTag[0].children.length,f>=l&&(a=this.queryEditor.find("#"+this.id+"_queryEditor_indices"+i)[0].innerHTML,o=parseInt(a,10)+1,t[0].innerHTML=u[i]?u[i]:"<br/>",this.editorTag.append(t),o<=u.length&&(e.attr({id:this.id+"_queryEditor_indices"+f}),this.indicesTag.append(e),this.queryEditor.find("#"+this.id+"_queryEditor_indices"+f).text(o.toString())),s=document.createRange(),s.setStart(t[0],t.length),h=window.getSelection(),h.removeAllRanges(),h.addRange(s))},n.prototype.setHTML=function(n){this.editorTag[0].innerHTML=n;this.updateIndices()},n.prototype.scrollLeft=function(){var n=this.editorTag.scrollTop();this.indicesTag.scrollTop(n)},n.prototype.onEditorKeyPress=function(n){var o=n.keyCode?n.keyCode:n.which,e,u,t,r,i,f;if(o===13){for(e=this.editorTag[0].children,u=0;u<e.length;u++)if(t=e[u].childNodes,t.length>1)for(r=0;r<t.length;r++)t&&t[r].localName==="br"&&(i=t[r],f=BoldBIDashboard.buildTag("div.bbi-designer-queryEditor","",{},{}),f[0].innerHTML=i.textContent===""?"<br>":i.textContent,this.editorTag.append(f),f.insertAfter(i.parentNode),i.parentNode.removeChild(i));this.updateDivIndices();this.updateIndices()}},n.prototype.updateDivIndices=function(){for(var t=this.editorTag[0].children,n=0;n<t.length;n++)t[n].id=this.id+"_queryEditor_editor"+n},n.prototype.updateText=function(n){var u=n,i=u.innerHTML,r;n.id===this.id+"_queryEditor_editor"?this.setQuery(i==="<br>"?"":i):n.innerHTML=this.setKeyword(i);var f=document.createRange(),e=this.getCaretPosition(n),t=this.getChildElement(n,e);BoldBIDashboard.isNullOrUndefined(t)||t.Element.nodeName==="SPAN"||(f.setStart(t.Element,t.Position),r=window.getSelection(),r.removeAllRanges(),r.addRange(f),u.focus())},n.prototype.getChildElement=function(n,t){for(var u,r=0,i=0;i<n.childNodes.length;i++){if(u=n.childNodes[i].textContent.length,r+u>t)return{Element:n.childNodes[i],Position:t-r};r+=u}if(n.childNodes.length===1)return{Element:n.childNodes[0],Position:t}},n.prototype.getCaretPosition=function(n){var e=0,i=n.ownerDocument||n.document,o=i.defaultView||i.parentWindow,t,r,u,s,f;return typeof o.getSelection!="undefined"?(t=o.getSelection(),t.rangeCount>0&&(r=o.getSelection().getRangeAt(0),u=r.cloneRange(),u.selectNodeContents(n),u.setEnd(r.endContainer,r.endOffset),e=u.toString().length)):t===i.selection&&t.type!=="Control"&&(s=t.createRange(),f=i.body.createTextRange(),f.moveToElementText(n),f.setEndPoint("EndToEnd",s),e=f.text.length),e},n.prototype.setKeyword=function(n){n=n.replace(/<\/?span[^>]*>/g,"");return this.bbdesigner$.each(["ADD","EXCEPT","ALTER","EXEC","SELECT","PLAN","EXECUTE","PRECISION","AND","EXISTS","PRIMARY","AN","EXI","PRINT","AS","FETCH","PROC","ASC","FILE","PROCEDURE","AUTHORIZATION","FILLFACTOR","PUBLIC","BACKUP"," FOR","RAISERROR","BEGIN","FOREIGN","READ","BETWEEN","FREETEXT","READTEXT","BREAK","FREETEXTTABLE","RECONFIGURE","BROWSE,","FROM","REFERENCES","BULK","FULL","REPLICATION","BY","FUNCTION","RESTORE","CASCADE","GOTO","RESTRICT","CASE","GRANT","RETURN","CHECK","GROUP","REVOKE","CHECKPOINT","HAVING","RIGHT","CLOSE","HOLDLOCK","ROLLBACK","CLUSTERED","IDENTITY","ROWCOUNT","COALESCE","IDENTITY_INSERT","ROWGUIDCOL","LIKE","THEN","CURRENT_TIMESTAMP","LINENO","TO","CURRENT_USER","LOAD","TOP","CURSOR","NATIONAL","TRAN","DATABASE","NOCHECK","TRANSACTION","DBCC","NONCLUSTERED","TRIGGER","DEALLOCATE","NOT","TRUNCATE","DECLARE","NULL","TSEQUAL","DEFAULT","NULLIF","UNION","DELETE","OF","UNIQUE","DENY","OFF","UPDATE","DESC","OFFSETS","UPDATETEXT","DISK","ON","USE","DISTINCT","OPEN","USER","DISTRIBUTED","OPENDATASOURCE","VALUES","DOUBLE","OPENQUERY","VARYING","DROP","OPENROWSET","VIEW","DUMMY","OPENXML","WAITFOR","DUMP","OPTION","WHEN","ELSE","OR","WHERE","END","ORDER","WHILE","ERRLVL","OUTER","WITH","ESCAPE","OVER","WRITETEXT","ABSOLUTE","FOUND","PRESERVE","ACTION","FREE","PRIOR","ADMIN","GENERAL","PRIVILEGES","AFTER","GET","READS","AGGREGATE","GLOBAL","REAL","ALIAS","GO","RECURSIVE","ALLOCATE","GROUPING","REF","ARE","HOST","REFERENCING","ARRAY","HOUR","RELATIVE","ASSERTION","IGNORE","RESULT","AT","IMMEDIATE","RETURNS","BEFORE","INDICATOR","ROLE","BINARY","INITIALIZE","ROLLUP","BIT","INITIALLY","ROUTINE","BLOB","INOUT","ROW","BOOLEAN","INPUT","ROWS","BOTH","INT","SAVEPOINT","BREADTH","INTEGER","SCROLL","CALL","INTERVAL","SCOPE","CASCADED","ISOLATION","SEARCH","CAST","ITERATE","SECOND","CATALOG","LANGUAGE","SECTION","CHAR","LARGE","SEQUENCE","CHARACTER","LAST","SESSION","LATERAL","SETS","CLOB","LEADING","SIZE","COLLATION","LESS","SMALLINT","COMPLETION","LEVEL","SPACE","CONNECT","LIMIT","SPECIFIC","CONNECTION","LOCAL","SPECIFICTYPE","CONSTRAINTS","LOCALTIME","SQL","CONSTRUCTOR","LOCALTIMESTAMP","SQLEXCEPTION","CORRESPONDING","LOCATOR","SQLSTATE","CUBE","MAP","SQLWARNING","CURRENT_PATH","MATCH","START","CURRENT_ROLE","MINUTE","STATE","CYCLE","MODIFIES","STATEMENT","DATA","MODIFY","STATIC","DATE","MODULE","STRUCTURE","DAY","MONTH","TEMPORARY","DEC","NAMES","TERMINATE","DECIMAL","NATURAL","THAN","DEFERRABLE","NCHAR","TIME","DEFERRED","NCLOB","TIMESTAMP","DEPTH","NEW","TIMEZONE_HOUR","DEREF","NEXT","TIMEZONE_MINUTE","DESCRIBE","NO","TRAILING","DESCRIPTOR","NONE","TRANSLATION","DESTROY","NUMERIC","TREAT","DESTRUCTOR","OBJECT","TRUE","DETERMINISTIC","OLD","UNDER","DICTIONARY","ONLY","UNKNOWN","DIAGNOSTICS","OPERATION","UNNEST","DISCONNECT","ORDINALITY","USAGE","DOMAIN","OUT","USING","DYNAMIC","OUTPUT","VALUE","EACH","PAD","VARCHAR","END - EXEC","PARAMETER","VARIABLE","EQUALS","PARAMETERS","WHENEVER","EVERY","PARTIAL","WITHOUT","EXCEPTION","PATH","WORK","EXTERNAL","POSTFIX","WRITE","PREFIX","YEAR","FIRST","PREORDER","ZONE","FLOAT","PREPARE","ADA","AVG","BIT_LENGTH","CHAR_LENGTH","CHARACTER_LENGTH","COUNT","EXTRACT","FORTRAN","INCLUDE","INSENSITIVE","LOWER","MAX","MIN","OCTET_LENGTH","OVERLAPS","PASCAL","POSITION","SQLCA","SQLCODE","SQLERROR","SUBSTRING","SUM","TRANSLATE","TRIM","UPPER"],function(t,i){var r=new RegExp("\\b("+i+")\\b","gi");n=n.replace(r,function(n){return'<span class="bbi-designer-queryEditor" style="color:blue;">'+n+"<\/span>"})}),n},n}();SqlEditorUndoManager=function(){function n(n){this.stack=[];this.currentIndex=-1;this.stack=[];this.id=n._id;this.dashboardDesigner=n}return n.prototype.isUndo=function(){return this.currentIndex>=0},n.prototype.undo=function(){if(this.currentIndex>=0){var n=this.stack[this.currentIndex];BoldBIDashboard.DashboardUtil.invokeMethod(this.dashboardDesigner.modules.sqlEditor,"setHTML",[n.oldVal]);this.currentIndex--}},n.prototype.isRedo=function(){return this.currentIndex<this.stack.length-1},n.prototype.redo=function(){this.currentIndex++;var n=this.stack[this.currentIndex];BoldBIDashboard.DashboardUtil.invokeMethod(this.dashboardDesigner.modules.sqlEditor,"setHTML",[n.newVal])},n.prototype.addCmdAction=function(n,t,i){this.stack.push({action:n,oldVal:t,newVal:i});this.currentIndex++},n.prototype.reset=function(){this.currentIndex=-1;this.stack=[]},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.SqlEditor",InternalSqlEditor,window);InternalStoreParameter=function(){function n(n){this.dashboardDesigner=null;this.id=null;this.parameters=[];this.updatedParameters=[];this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.id=this.queryDesigner.id;this.renderStoreParameter()}return n.prototype.renderStoreParameter=function(){var t,i,r,u;this.targetTag=BoldBIDashboard.buildTag("div.bbi-userselect","",{display:"block"},{title:"Parameters",id:this.id+"_parameter_dialog"});var f=BoldBIDashboard.buildTag("div","",{height:"280px",width:"100%",margin:"4px 0px"}),e=BoldBIDashboard.buildTag("div.bbi-dbrd-store-connect-type-container","",{},{id:this.id+"_store_connect_type_container_div"}),n=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","",{border:"0.5px solid var(--primary-border-color)","border-radius":"2px",height:"280px",width:"100%","background-color":"transparent"},{id:this.id+"_topDiv_parameter_dialog"}),o=BoldBIDashboard.buildTag("div","",{},{}),a=BoldBIDashboard.buildTag("table.bbi-designer-exp-table","",{padding:"0px 8px"},{id:this.id+"_proc_parameters"}),s=BoldBIDashboard.buildTag("table.bbi-designer-exp-table bbi-dbrd-store-connect-type-table","",{},{id:this.id+"_store_connect_type_table"});e.append(s);t=BoldBIDashboard.buildTag("tr.bbi-dbrd-store-connect-type-table-row","",{});i=BoldBIDashboard.buildTag("td.bbi-dbrd-store-connect-type-table-col","",{});t.append(i);s.append(t);r=BoldBIDashboard.buildTag("div.bbi-dbrd-store-connect-type-table-radiobtndiv","",{},{id:this.id+"_store_connect_type_radiobtndiv"});this.openQueryRadiobtn=BoldBIDashboard.buildTag("div.bbi-dbrd-store-connect-type-table-radiobtndiv-openquery","",{},{id:this.id+"_store_connect_type_radiobtndiv_openquery"});this.internalCacheRadiobtn=BoldBIDashboard.buildTag("div.bbi-dbrd-store-connect-type-table-radiobtndiv-internalcache","",{},{id:this.id+"_store_connect_type_radiobtndiv_internalcache"});r.append(this.openQueryRadiobtn,this.getOpenQueryInfoIcon(),this.internalCacheRadiobtn);i.append(r);o.append(a);n.append(o);f.append(n);this.targetTag.append(e,f);var h=this.locale.dialogOptions,c=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",h.cancelButtonText,{float:"right"},{id:this.id+"_proc_btn_cancel",type:"button"}),l=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",h.okButtonText,{float:"right"},{id:this.id+"_proc_btn_save",type:"button"});this.targetTag.BoldBIDashboardDialog({minWidth:570,minHeight:230,height:"auto",width:"auto",target:"#"+this.id,enableResize:!1,containment:"#"+this.dashboardDesigner._id,showFooter:!0,cssClass:"bbi-designer-dialog boldbi-dashboarddesigner",showOnInit:!1,enableModal:!0,close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.targetTag.BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup "+this.id+"_designer_waiting_popup bbi-designer-loader",template:this.dashboardDesigner.getWaitingPopupTemplate()});u=this.dashboardDesigner.element.find("#"+this.id+"_parameter_dialog_foot");u.append(c);u.append(l);l.on("click",this.bbdesigner$.proxy(this.doneProcDialog,this));c.on("click",this.bbdesigner$.proxy(this.closeProcDialog,this));n.BoldBIDashboardScroller({height:"280px",scrollerSize:this.dashboardDesigner.scrollerSize.scrollSize,enableTouchScroll:!0,autoHide:!0,buttonSize:this.dashboardDesigner.scrollerSize.buttonSize})},n.prototype.getOpenQueryInfoIcon=function(){var n=this.dashboardDesigner.isHelpLinkHidden()?"":"<a href='"+this.dashboardDesigner.getHelpDocLink("StoredProcedureOpenQuery")+"'  target='_blank' class ='bbi-dbrd-store-connect-type-table-info-icon bbi-dbrd-designer-icon bbi-dbrd-designer-hoverable' data-tooltip =\""+this.locale.storedProcedure.openQueryHelpInfo+'"><\/a>';return"<div class ='bbi-dbrd-store-connect-type-table-help-info-icon'>"+n+"<\/div>"},n.prototype.renderRadioItem=function(n,t,i,r,u){var f=BoldBIDashboard.buildTag("div","",{},{}),e;r.append(f);e={callBackInstance:this,callBackMethod:"",groupName:i,labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:t,label:n,isChecked:u}]};this.selectRadioButton=new BoldBIDashboard.Dashboard.RadioButton(e,f)},n.prototype.closeProcDialog=function(){this.dashboardDesigner.element.find("#"+this.id+"_parameter_dialog").data("BoldBIDashboardDialog").close();this.setParameter(this.updatedParameters)},n.prototype.doneProcDialog=function(){this.dashboardDesigner.element.find("#"+this.id+"_div_dragSurface .e-Stored.Procedures").length>0?this.queryDesigner.executeQuery():(this.queryDesigner.dragSurfaceTag.append(this.queryDesigner.tableContainer),this.queryDesigner.loadProcedureSchema())},n.prototype.isOpenQuery=function(){return!BoldBIDashboard.isNullOrUndefined(this.targetTag.find("#"+this.id+"_store_connect_type_radiobtn_openquery_rdo_input"))||this.targetTag.find("#"+this.id+"_store_connect_type_radiobtn_openquery_rdo_input").length>0?this.targetTag.find("#"+this.id+"_store_connect_type_radiobtn_openquery_rdo_input").prop("checked"):!1},n.prototype.hideStoreProcedureConnectTypes=function(){BoldBIDashboard.isNullOrUndefined(this.targetTag.find("#"+this.id+"_store_connect_type_container_div"))||this.targetTag.find("#"+this.id+"_store_connect_type_container_div").css("display")!=="block"||this.targetTag.find("#"+this.id+"_store_connect_type_container_div").css("display","none")},n.prototype.showStoreProcedureConnectTypes=function(){BoldBIDashboard.isNullOrUndefined(this.targetTag.find("#"+this.id+"_store_connect_type_container_div"))||this.targetTag.find("#"+this.id+"_store_connect_type_container_div").css("display")!=="none"||this.targetTag.find("#"+this.id+"_store_connect_type_container_div").css("display","block");(!BoldBIDashboard.isNullOrUndefined(this.targetTag.find("#"+this.id+"_store_connect_type_radiobtn_internalcache_rdo_input"))||this.targetTag.find("#"+this.id+"_store_connect_type_radiobtn_internalcache_rdo_input").length>0)&&this.targetTag.find("#"+this.id+"_store_connect_type_radiobtn_internalcache_rdo_input").prop("checked",!0)},n.prototype.getProcParams=function(){var t=[],e,f,u;if(this.parameters&&(e=Object.keys(this.parameters),f=this.parameters[e],e.length>0)){for(u=0;u<f.length;u++){var n=f[u],r=n.Name.substring(1),i=this.bbdesigner$("#"+this.id+"_dropdown_"+r).val();switch(i){case"Custom":f[u].DataType==="bit"?t.push({Name:n.Name,IsNull:!1,DataType:n.DataType,ValueType:i,Value:this.dashboardDesigner.element.find("#"+this.id+"_proc_"+r).data("BoldBIDashboardCheckBox").isChecked()}):BoldBIDashboard.DashboardUtil.contains(n.DataType,"datetime",!0)?t.push({Name:n.Name,IsNull:!1,DataType:n.DataType,ValueType:i,Value:this.dashboardDesigner.element.find("#"+this.id+"_proc_"+r).data("BoldBIDashboardDateTimePicker").getValue()}):BoldBIDashboard.DashboardUtil.contains(n.DataType,"date",!0)?t.push({Name:n.Name,IsNull:!1,DataType:n.DataType,ValueType:i,Value:this.bbdesigner$("#"+this.id+"_proc_"+r).data("BoldBIDashboardDatePicker").getValue()}):BoldBIDashboard.DashboardUtil.contains(n.DataType,"int",!0)||n.DataType==="numeric"?t.push({Name:n.Name,IsNull:!1,DataType:n.DataType,ValueType:i,Value:parseInt(this.dashboardDesigner.element.find("#"+this.id+"_proc_"+r).val(),10)}):BoldBIDashboard.DashboardUtil.contains(n.DataType,"money",!0)||n.DataType==="float"||n.DataType==="decimal"?t.push({Name:n.Name,IsNull:!1,DataType:n.DataType,ValueType:i,Value:parseFloat(this.dashboardDesigner.element.find("#"+this.id+"_proc_"+r).val())}):t.push({Name:n.Name,IsNull:!1,DataType:n.DataType,ValueType:i,Value:this.dashboardDesigner.element.find("#"+this.id+"_proc_"+r).val()});break;case"Parameter":t.push({Name:n.Name,IsNull:!1,DataType:n.DataType,ValueType:i,Value:"@{{:"+this.dashboardDesigner.element.find("#"+this.id+"_proc_"+r).val()+"}}"});break;case"Null":t.push({Name:n.Name,IsNull:!0,DataType:n.DataType,ValueType:i,Value:null})}}return t}return null},n.prototype.updateProceParams=function(n){var t=this;BoldBIDashboard.isNullOrUndefined(n)||n.filter(function(n){t.updatedParameters.filter(function(i){var r,u;n.Name===i.Name&&(r=i.Name.substring(1),i.Value=n.Value,u=BoldBIDashboard.isNullOrUndefined(t.id)?t.dashboardDesigner.modules.queryDesigner._id:t.id,t.dashboardDesigner.element.find("#"+u+"_proc_"+r).data("BoldBIDashboardDropDownList").setModel({dataSource:t.getParameterDataSource()}),t.dashboardDesigner.element.find("#"+u+"_proc_"+r).data("BoldBIDashboardDropDownList").selectItemByValue(n.Value.match("@{{:(.*)}}")[1]))})})},n.prototype.setParameter=function(n){var r,t,i;if(n&&n.length>0)for(r=function(i){var r=n[i].Name.substring(1),u=t.getParameterDataSource(),f;n[i].ValueType=n[i].ValueType==="Parameter"&&(u.length===0||u.filter(function(t){return"@{{:"+t.value+"}}"===n[i].Value}).length===0)?"Custom":n[i].ValueType;t.bbdesigner$("#"+t.id+"_dropdown_"+r).data("BoldBIDashboardDropDownList").selectItemByValue(n[i].ValueType);switch(n[i].ValueType){case"Custom":f={id:t.id+"_proc_"+r,dataType:n[i].DataType};t.checkNullable(f,{isChecked:n[i].IsNull});n[i].DataType==="bit"?t.dashboardDesigner.element.find("#"+t.id+"_proc_"+r).data("BoldBIDashboardCheckBox").setModel({checked:n[i].Value===!0}):BoldBIDashboard.DashboardUtil.contains(n[i].DataType,"int",!0)?t.dashboardDesigner.element.find("#"+t.id+"_proc_"+r).val(n[i].Value):BoldBIDashboard.DashboardUtil.contains(n[i].DataType,"datetime",!0)?t.dashboardDesigner.element.find("#"+t.id+"_proc_"+r).data("BoldBIDashboardDateTimePicker").setModel({value:n[i].Value}):BoldBIDashboard.DashboardUtil.contains(n[i].DataType,"date",!0)?t.dashboardDesigner.element.find("#"+t.id+"_proc_"+r).data("BoldBIDashboardDatePicker").setModel({value:n[i].Value}):t.dashboardDesigner.element.find("#"+t.id+"_proc_"+r).val(n[i].Value);break;case"Parameter":t.dashboardDesigner.element.find("#"+t.id+"_proc_"+r).data("BoldBIDashboardDropDownList").setModel({dataSource:u});t.dashboardDesigner.element.find("#"+t.id+"_proc_"+r).data("BoldBIDashboardDropDownList").selectItemByValue(n[i].Value.match("@{{:(.*)}}")[1])}},t=this,i=0;i<n.length;i++)r(i)},n.prototype.renderElementsForCustomType=function(n,t,i){var r,e,u,f,o;t==="bit"?(r=BoldBIDashboard.buildTag("input","",{},{type:"checkbox",id:this.id+"_proc_"+i}),n.append(r),r.BoldBIDashboardCheckBox({showRoundedCorner:!0,cssClass:"bbi-designer-border"})):BoldBIDashboard.DashboardUtil.contains(t,"int",!0)||BoldBIDashboard.DashboardUtil.contains("money",t,!0)||t==="float"||t==="numeric"||t==="decimal"?(e=BoldBIDashboard.buildTag("input.e-textbox e-animation bbi-designer-border","",{height:"25px",width:"147px","padding-left":"10px"},{type:"number",id:this.id+"_proc_"+i}),n.append(e)):BoldBIDashboard.DashboardUtil.contains(t,"datetime",!0)?(u=BoldBIDashboard.buildTag("input","",{"font-style":"normal"},{type:"text",id:this.id+"_proc_"+i}),n.append(u),u.BoldBIDashboardDateTimePicker({width:"100%",height:"30px",locale:this.dashboardDesigner.model.localeSettings.culture,dateTimeFormat:this.dashboardDesigner.model.localeSettings.dateFormat+" "+this.dashboardDesigner.model.localeSettings.timeFormat,cssClass:"bbi-designer-border e-dashboarddesigner-widget"})):BoldBIDashboard.DashboardUtil.contains(t,"date",!0)?(f=BoldBIDashboard.buildTag("input","",{"font-style":"normal"},{type:"text",id:this.id+"_proc_"+i}),n.append(f),f.BoldBIDashboardDatePicker({width:"100%",height:"30px",showRoundedCorner:!0,cssClass:"bbi-designer-border e-dbrd-designer-relative-picker e-dashboarddesigner-widget"})):(o=BoldBIDashboard.buildTag("input.e-textbox e-animation bbi-designer-border","",{height:"25px",width:"147px","padding-left":"10px"},{type:"text",id:this.id+"_proc_"+i}),n.append(o))},n.prototype.parameterChangeEvent=function(n,t){var i=this.getProcParams(),r=i.filter(function(t){return t.Name===n})[0];this.dashboardDesigner.modules.util.doAjaxPost("POST",this.queryDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.ParameterAction,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.ParameterAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.ValidateDynamicParameter,parameters:r,dataSetId:t.model.dataSource[t.itemId].id,dataSetName:t.model.dataSource[t.itemId].dsName,selectedText:t.model.dataSource[t.itemId].name,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.validateParameter,this,t)})},n.prototype.validateParameter=function(n,t){if(!BoldBIDashboard.isNullOrUndefined(t)){var i=JSON.parse(t.data);i||(this.bbdesigner$(n.target).data("BoldBIDashboardDropDownList").clearText(),this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.StoredProcedure,this.locale.dataSource.InValidParameter,IconType.warning,AlertType.Alert,!1,null))}},n.prototype.renderValueContainer=function(n,t){if(!BoldBIDashboard.isNullOrUndefined(n.column)){n.column.children().length>0&&n.column.children().remove();switch(t){case"Custom":this.renderElementsForCustomType(n.column,n.dataType,n.id);break;case"Parameter":this.renderElementForParameterType(n);break;case"Null":var i=BoldBIDashboard.buildTag("input.e-textbox","",{height:"25px",width:"147px","padding-left":"10px"},{type:"text",value:"null",id:this.id+"_proc_"+n.id,disabled:"disabled"});n.column.append(i)}}},n.prototype.renderElementForParameterType=function(n){var t=BoldBIDashboard.buildTag("input.e-textbox","",{height:"30px",width:"160px"},{type:"text",id:this.id+"_proc_"+n.id});n.column.append(t);t.BoldBIDashboardDropDownList({width:"100%",height:"30px",popupWidth:t.width(),field:{text:"text",value:"value",name:"name",id:"id"},dataSource:this.getParameterDataSource(),enabled:!0,selectedIndex:null,showRoundedCorner:!0,cssClass:"bbi-dbrd-control",change:this.bbdesigner$.proxy(this.parameterChangeEvent,this,n.name)})},n.prototype.onDropDownChange=function(n,t){BoldBIDashboard.isNullOrUndefined(t)||this.renderValueContainer(n,t.selectedText)},n.prototype.getParameterDataSource=function(){var i=this,f=this.bbdesigner$.extend(!0,{},this.queryDesigner.dataset),e;f.Query.DashboardParameters=this.queryDesigner.queryParamCollection;var u=[],n=!1,t=null,r=[];return u.push(f),e=this.dashboardDesigner.rdlParser.rdlJsonObj.DataSets,e.length>0&&this.dashboardDesigner.rdlParser.rdlJsonObj.DataSets.forEach(function(n){n.Id!==u[0].Id&&u.push(i.bbdesigner$.extend(!0,{},n))}),u.forEach(function(u){BoldBIDashboard.isNullOrUndefined(u)||BoldBIDashboard.isNullOrUndefined(u.Query)||BoldBIDashboard.isNullOrUndefined(u.Query.DashboardParameters)||(n=u.Id===i.queryDesigner.dataset.Id,u.Query.DashboardParameters=n?i.queryDesigner.queryParamCollection:u.Query.DashboardParameters,t=u.Name,u.Query.DashboardParameters.forEach(function(u){var f=u.ParameterName,e,h,o,s;switch(u.Mode){case ParameterMode.Literal:e=u.LiteralModeInfo;h=!BoldBIDashboard.isNullOrUndefined(e.StartValue)&&!BoldBIDashboard.isNullOrUndefined(e.EndValue)||!BoldBIDashboard.isNullOrUndefined(e.RangeStartDate)&&!BoldBIDashboard.isNullOrUndefined(e.RangeEndDate)||!BoldBIDashboard.isNullOrUndefined(e.RelativeDateItems);h?(o=f+".START",s=f+".END",r.push(i.getParamItems(f+".START",n?o:o+" ("+t+")",n?o:t+"."+o,u.DatasourceId,u.DatasourceName,u.DateFormat,u.DataType,u.ParameterID)),r.push(i.getParamItems(f+".END",n?s:s+" ("+t+")",n?s:t+"."+s,u.DatasourceId,u.DatasourceName,u.DateFormat,u.DataType,u.ParameterID))):r.push(i.getParamItems(f,n?f:f+" ("+t+")",n?f:t+"."+f,u.DatasourceId,u.DatasourceName,u.DateFormat,u.DataType,u.ParameterID));break;case ParameterMode.List:r.push(i.getParamItems(f,n?f:f+" ("+t+")",n?f:t+"."+f,u.DatasourceId,u.DatasourceName,u.DateFormat,u.DataType,u.ParameterID))}}))}),r},n.prototype.getParamItems=function(n,t,i,r,u,f,e,o){return{text:t,name:n,value:i,id:r,dsName:u,dateFormat:f,dataType:e,parameterID:o}},n.prototype.renderParameter=function(n,t,i){var f=n.Name.substring(1),e=BoldBIDashboard.buildTag("tr","",{height:"36px"}),h=BoldBIDashboard.buildTag("td",n.Name,{height:"30px",width:"150px"}),c=BoldBIDashboard.buildTag("td",n.DataType,{height:"30px",width:"100px"}),o=BoldBIDashboard.buildTag("td","",{height:"30px",width:"160px"}),s=BoldBIDashboard.buildTag("td","",{height:"30px",width:"160px"}),r=BoldBIDashboard.buildTag("input.e-textbox","",{},{type:"text",id:this.id+"_dropdown_"+f}),u;e.append(h).append(c).append(o).append(s);t.append(e);o.append(r);u={column:s,dataType:n.DataType,id:f,name:n.Name};r.BoldBIDashboardDropDownList({width:"150px",height:"30px",popupWidth:"150px",dataSource:[{text:"Custom"},{text:"Parameter"},{text:"Null"}],fields:{text:"text",value:"value"},enabled:!0,change:this.bbdesigner$.proxy(this.onDropDownChange,this,u),selectedIndex:0,showRoundedCorner:!0,cssClass:"bbi-dbrd-control"});this.renderValueContainer(u,BoldBIDashboard.isNullOrUndefined(i)?r.val():i)},n.prototype.renderProcParameters=function(n){var u=this.dashboardDesigner.element.find("#"+this.id+"_proc_parameters"),r,f,t;u.empty();var e=BoldBIDashboard.buildTag("tr"),o=BoldBIDashboard.buildTag("td","<b>Parameter<\/b>",{height:"30px",width:"150px"}),s=BoldBIDashboard.buildTag("td","<b>DataType<\/b>",{height:"30px",width:"100px"}),h=BoldBIDashboard.buildTag("td","<b>Value Type<\/b>",{height:"30px",width:"100px"}),c=BoldBIDashboard.buildTag("td","<b>Value<\/b>",{height:"30px",width:"150px"}),i=null;if(this.queryDesigner.columnList.length>0)for(t=0;t<this.queryDesigner.columnList.length;t++)if(this.queryDesigner.tableList[t]===n.id){i=this.queryDesigner.columnList[t];break}if((BoldBIDashboard.isNullOrUndefined(this.targetTag.find("#"+this.id+"_store_connect_type_radiobtn_openquery_rdo_input"))&&BoldBIDashboard.isNullOrUndefined(this.targetTag.find("#"+this.id+"_store_connect_type_radiobtn_internalcache_rdo_input"))||this.targetTag.find("#"+this.id+"_store_connect_type_radiobtn_openquery_rdo_input").length===0)&&(this.renderRadioItem(this.locale.storedProcedure.openQuery,this.id+"_store_connect_type_radiobtn_openquery","connecttype",this.openQueryRadiobtn,!1),this.renderRadioItem(this.locale.storedProcedure.internalCache,this.id+"_store_connect_type_radiobtn_internalcache","connecttype",this.internalCacheRadiobtn,!0)),r=Object.keys(i),f=i[r],r.length>0&&i[r].length>0){for(this.parameters=i,e.append(o).append(s).append(h).append(c),u.append(e),t=0;t<f.length;t++)this.renderParameter(f[t],u);return!0}return this.parameters=null,!1},n.prototype.checkNullable=function(n,t){n.dataType==="bit"?t.isChecked?this.dashboardDesigner.element.find("#"+n.id).data("BoldBIDashboardCheckBox").disable():this.dashboardDesigner.element.find("#"+n.id).data("BoldBIDashboardCheckBox").enable():BoldBIDashboard.DashboardUtil.contains(n.dataType,"datetime",!0)?t.isChecked?this.dashboardDesigner.element.find("#"+n.id).data("BoldBIDashboardDateTimePicker").disable():this.dashboardDesigner.element.find("#"+n.id).data("BoldBIDashboardDateTimePicker").enable():BoldBIDashboard.DashboardUtil.contains(n.dataType,"date",!0)?t.isChecked?this.dashboardDesigner.element.find("#"+n.id).data("BoldBIDashboardDatePicker").disable():this.dashboardDesigner.element.find("#"+n.id).data("BoldBIDashboardDatePicker").enable():t.isChecked?(this.dashboardDesigner.element.find("#"+n.id).attr("disabled","disabled"),this.dashboardDesigner.element.find("#"+n.id).val(""),this.dashboardDesigner.element.find("#"+n.id).val("null")):(this.dashboardDesigner.element.find("#"+n.id).removeAttr("disabled"),this.dashboardDesigner.element.find("#"+n.id).val(""))},n.prototype.showParameterDialog=function(){this.setParameter(this.updatedParameters);this.dashboardDesigner.element.find("#"+this.id+"_parameter_dialog").data("BoldBIDashboardDialog").open();this.targetTag.find("#"+this.id+"_topDiv_parameter_dialog").height()>this.dashboardDesigner.element.find("#"+this.id+"_proc_parameters").height()?this.dashboardDesigner.element.find("#"+this.id+"_proc_parameters").css("padding","0px 12px"):this.dashboardDesigner.element.find("#"+this.id+"_proc_parameters").css("padding","0px 8px");this.targetTag.find("#"+this.id+"_topDiv_parameter_dialog").data("BoldBIDashboardScroller")!==null&&this.targetTag.find("#"+this.id+"_topDiv_parameter_dialog").data("BoldBIDashboardScroller").refresh();BoldBIDashboard.isNullOrUndefined(this.targetTag.find("#"+this.id+"_store_connect_type_container_div"))||this.targetTag.find("#"+this.id+"_store_connect_type_container_div").css("display")!=="none"||this.targetTag.find("#"+this.id+"_store_connect_type_container_div").css("display","block")},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.StoreParameter",InternalStoreParameter,window);ParameterDataInfo=function(){function n(){}return n}(),function(n){n[n.None=0]="None";n[n.Google=1]="Google";n[n.Facebook=2]="Facebook";n[n.Twitter=3]="Twitter";n[n.Salesforce=4]="Salesforce";n[n.Smartsheet=5]="Smartsheet";n[n.Bitly=6]="Bitly";n[n.Asana=7]="Asana";n[n.Slack=8]="Slack";n[n.ZohoCRM=9]="ZohoCRM";n[n.Buffer=10]="Buffer";n[n.Todoist=11]="Todoist";n[n.MicrosoftDynamicsCRM=12]="MicrosoftDynamicsCRM";n[n.QuickBooks=13]="QuickBooks";n[n.BaseCrm=14]="BaseCrm";n[n.Basecamp3=15]="Basecamp3";n[n.Intercom=16]="Intercom";n[n.Optimizely=17]="Optimizely";n[n.Pipedrive=18]="Pipedrive";n[n.Pinterest=19]="Pinterest";n[n.LinkedIn=20]="LinkedIn";n[n.Microsoft=21]="Microsoft";n[n.SurveyMonkey=22]="SurveyMonkey";n[n.HelpScout=23]="HelpScout";n[n.FreshBooks=24]="FreshBooks";n[n.Basecamp2=25]="Basecamp2";n[n.Infusionsoft=26]="Infusionsoft";n[n.Box=27]="Box";n[n.EventBrite=28]="EventBrite";n[n.GenesysPureCloud=29]="GenesysPureCloud";n[n.Dropbox=30]="Dropbox";n[n.AzureDevOps=31]="AzureDevOps";n[n.WordPress=32]="WordPress";n[n.Projectplace=33]="Projectplace";n[n.Podio=34]="Podio";n[n.Vimeo=35]="Vimeo";n[n.MicrosoftKaizala=36]="MicrosoftKaizala";n[n.Wistia=37]="Wistia";n[n.ApplicationInsights=38]="ApplicationInsights";n[n.MarkupTrace=39]="MarkupTrace";n[n.Xero=40]="Xero";n[n.Zoom=41]="Zoom";n[n.Fitbit=42]="Fitbit";n[n.DecisionLens=43]="DecisionLens";n[n.XeroWorkflowMax=44]="XeroWorkflowMax";n[n.Gohighlevel=45]="Gohighlevel"}(OAuthProvider||(OAuthProvider={}));InternalOAuthLoginHelper=function(){function n(n){this.oAuthModel=null;this.designerInstance=n;this.bbdesigner$=this.designerInstance.bbdesigner$;this.id=this.designerInstance._id+"_oauth_config"}return n.prototype.initialize=function(n,t){this.bbdesigner$(window).off("message",this.bbdesigner$.proxy(this.notifyOAuthStatus,this));this.bbdesigner$(window).on("message",this.bbdesigner$.proxy(this.notifyOAuthStatus,this));this.isWindowPresent()&&this.closeOAuthWindow();this.oAuthModel=n;this.launchWindow(t)},n.prototype.launchWindow=function(n){var i=this,t;this.isWindowPresent()&&this.closeOAuthWindow();t=BoldBIDashboard.isNullOrUndefined(n.id)?this.getConnectUrl():this.getReAuthUrl(n);BoldBIDashboard.isNullOrUndefined(n.organizationUrl)||(t+="&resourceurl="+n.organizationUrl);this.oAuthWindow=window.open(t,"OAuthPopUp","width=600,height=800,scrollbars=yes");BoldBIDashboard.isNullOrUndefined(this.oAuthModel.windowCloseHandler)||(this.timer=setInterval(this.bbdesigner$.proxy(function(){i.isWindowPresent()||i.notifyChildWindowClose()},this),2e3))},n.prototype.notifyChildWindowClose=function(){clearInterval(this.timer);BoldBIDashboard.isNullOrUndefined(this.oAuthModel.windowCloseHandler)||BoldBIDashboard.DashboardUtil.invokeCallBack(this.oAuthModel.windowCloseHandler,{})},n.prototype.getReAuthUrl=function(n){var t=this.designerInstance.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.oauthreauthorize+"?";return this.designerInstance.model.serviceAuthorizationToken&&(t+="token="+this.designerInstance.model.serviceAuthorizationToken),BoldBIDashboard.isNullOrUndefined(n.id)||(t+="&id="+n.id),BoldBIDashboard.isNullOrUndefined(this.designerInstance.model.serverUrl)||(t+="&server="+this.designerInstance.model.serverUrl),this.oAuthModel.serviceId&&(t+="&service="+this.oAuthModel.serviceId),t+("&origin="+window.location.origin)},n.prototype.getConnectUrl=function(){var n=this.designerInstance.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.oauthauthenticate+"?";return this.oAuthModel.provider&&(n+="provider="+BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(OAuthProvider,this.oAuthModel.provider)),this.oAuthModel.serviceId&&(n+="&service="+this.oAuthModel.serviceId),this.designerInstance.model.serviceAuthorizationToken&&(n+="&token="+this.designerInstance.model.serviceAuthorizationToken),n+="&origin="+window.location.origin,BoldBIDashboard.isNullOrUndefined(this.designerInstance.model.serverUrl)||(n+="&server="+this.designerInstance.model.serverUrl),n},n.prototype.closeOAuthWindow=function(){this.windowCheckInterval&&(clearInterval(this.windowCheckInterval),this.windowCheckInterval=null);this.oAuthWindow&&!this.oAuthWindow.closed&&this.oAuthWindow.close()},n.prototype.isWindowPresent=function(){return this.oAuthWindow&&!this.oAuthWindow.closed},n.prototype.notifyOAuthStatus=function(n){this.bbdesigner$(window).off("message",this.bbdesigner$.proxy(this.notifyOAuthStatus,this));this.notifyChildWindowClose();this.oAuthModel.handler&&BoldBIDashboard.DashboardUtil.invokeCallBack(this.oAuthModel.handler,JSON.parse(n.originalEvent.data))},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.OAuthHelper",InternalOAuthLoginHelper,window);InternalRangeFilterDialog=function(){function n(n){this.dashboardDesigner=null;this.dialogContainer=null;this.isModified=!1;this.filterInfo=null;this.fieldDetails=null;this.loadTimer=null;this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.id=this.dashboardDesigner._id;this.rowId=this.id+"_range_filter_dialog";this.dateFormat=this.dashboardDesigner.model.localeSettings.dateFormat+" "+this.dashboardDesigner.model.localeSettings.timeFormat;this.renderRangeFilterDialog()}return n.prototype.renderRangeFilterDialog=function(){this.dialogContainer=BoldBIDashboard.buildTag("div.bbi-dashboard-designer-configuration bbi-userselect","",{height:"auto"},{title:this.locale.dateRangeFilterDialog.titleText,id:this.rowId});this.dashboardDesigner.element.append(this.dialogContainer);this.renderTopContainer();this.renderFieldContainer();this.dialogContainer.BoldBIDashboardDialog({width:"auto",height:"auto",minWidth:400,minHeight:235,enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id,cssClass:"boldbi-dashboarddesigner bbi-designer-dialog e-flat-mode",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.renderFooter()},n.prototype.renderTopContainer=function(){var i=BoldBIDashboard.buildTag("div","",{height:"25px","border-bottom":"1px solid var(--primary-border-color)",padding:"15px 20px"}),r=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),n=BoldBIDashboard.buildTag("tr","",{},{}),t=this.locale.dateRangeFilterDialog;this.renderRadioButton(t.rangesText,this.rowId+"_RangeBtn",!0,n,this.onRangeTypeChange,this);this.renderRadioButton(t.startDateText,this.rowId+"_startBtn",!1,n,this.onRangeTypeChange,this);this.renderRadioButton(t.endDateText,this.rowId+"_endBtn",!1,n,this.onRangeTypeChange,this);r.append(n);i.append(r);this.dialogContainer.append(i)},n.prototype.renderFieldContainer=function(){var n=BoldBIDashboard.buildTag("div","",{height:"140px","background-color":"var(--secondary-background-color)","box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box",padding:"10px 20px"},{id:this.rowId+"_dateRange_fieldDiv"}),i=BoldBIDashboard.buildTag("div","",{"margin-top":"15px"},{id:this.rowId+"_dateRange_start_tr"}),r=BoldBIDashboard.buildTag("div","",{"margin-top":"15px"},{id:this.rowId+"_dateRange_end_tr"}),u=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),f=BoldBIDashboard.buildTag("table","",{width:"100%"},{}),e=BoldBIDashboard.buildTag("tr","",{},{}),o=BoldBIDashboard.buildTag("tr","",{},{}),t;n.append(i,r);i.append(u);u.append(e);r.append(f);f.append(o);t=this.locale.dateRangeFilterDialog;this.renderDateRangePicker(this.rowId+"_dateRange_Start",t.startLabel,e,this.onPickerChange,this);this.renderDateRangePicker(this.rowId+"_dateRange_end",t.endLabel,o,this.onPickerChange,this);this.dialogContainer.append(n);n.BoldBIDashboardWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup bbi-propertyPanel-waitingPopup",template:this.dashboardDesigner.getWaitingPopupTemplate()})},n.prototype.renderFooter=function(){var i=this.dashboardDesigner.element.find("#"+this.rowId+"_foot"),n=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.rowId+"_btn_cancel",type:"button"}),t=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.dialogOptions.okButtonText,{float:"right"},{id:this.rowId+"_btn_ok",type:"button"});i.append(n,t);t.on("click",this.bbdesigner$.proxy(this.saveDateRangeAttr,this));n.on("click",this.bbdesigner$.proxy(this.closeDialog,this,!0))},n.prototype.renderRadioButton=function(n,t,i,r,u,f){var o=this.bbdesigner$("<td unselectable='on'/>"),e,s;r.append(o);e=BoldBIDashboard.buildTag("div","",{},{});s={callBackInstance:this,callBackMethod:"onRangeTypeChange",optionalArgs:f,groupName:"formatting",labelPosition:BoldBIDashboard.Dashboard.LabelPosition.After,dataSource:[{id:t,label:n,isChecked:i}]};this.selectRadioButton=new BoldBIDashboard.Dashboard.RadioButton(s,e);o.append(e)},n.prototype.renderDateRangePicker=function(n,t,i,r,u){var e=BoldBIDashboard.buildTag("td","",{width:"25%"}),s=BoldBIDashboard.buildTag("Label.bbi-designer-add-label",t,{},{type:"label"}),o=BoldBIDashboard.buildTag("td","",{},{id:n}),f=BoldBIDashboard.buildTag("input.bbi-popup-button","",{},{type:"text",id:n+"_picker"});e.append(s);o.append(f);i.append(e,o);f.BoldBIDashboardDateTimePicker({width:"225px",height:"26px",cssClass:"bbi-designer-border bbi-popup-button e-dashboarddesigner-widget",change:this.bbdesigner$.proxy(r,u)});f.on("keyup",this.bbdesigner$.proxy(this.onPickerChange,this))},n.prototype.openFilterDialog=function(n,t,i,r){var f=this,e,u;this.dialogContainer.data("BoldBIDashboardDialog").open();this.targetInstance=n;this.targetMethod=t;this.fieldDetails=i;this.dataSetId=this.fieldDetails.DatasourceID;this.filterInfo=BoldBIDashboard.isNullOrUndefined(r)?new DimensionFilterInfo:this.bbdesigner$.extend(!0,{},r);this.resetRadioBtnSelection();this.resetAttributes();this.getStartTr().css("display","none");this.getEndTr().css("display","none");e=[{Id:this.fieldDetails.Id,Name:this.fieldDetails.Name,SummaryType:SummaryType.NONE,Sorting:"Ascending",FieldType:"Dimensions",MeasureFormatting:null,DateTimeFormat:"Date",FilterInfo:null}];this.loadTimer&&(clearTimeout(this.loadTimer),this.loadTimer=null);u=this;this.loadTimer=setTimeout(this.bbdesigner$.proxy(function(){u.showLoadingIndicator();f.dashboardDesigner.modules.util.doAjaxPost("POST",u.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.FilterAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,fieldInfo:e,dataSetId:u.dataSetId,type:"date",isQueryDesignerMode:f.dashboardDesigner.isQueryDesignerMode})},{fnction:f.bbdesigner$.proxy(u.setFieldInformation,u)});clearTimeout(u.loadTimer);u.loadTimer=null},this),300);BoldBIDashboard.DashboardUtil.buttonEnable(this.getApplyBtn(),!0)},n.prototype.resetAttributes=function(){this.dialogContainer.removeAttr("Range");this.dialogContainer.removeAttr("StartDate");this.dialogContainer.removeAttr("EndDate");this.getStartPicker().removeAttr("minDateTime");this.getEndPicker().removeAttr("minDateTime")},n.prototype.setFieldInformation=function(n){var r=this.dashboardDesigner.element.find("#"+this.rowId+"_dateRange_Start_picker"),u=this.dashboardDesigner.element.find("#"+this.rowId+"_dateRange_end_picker"),t,i;BoldBIDashboard.isNullOrUndefined(r.data("BoldBIDashboardDateTimePicker").model)||(r.data("BoldBIDashboardDateTimePicker").model.dateTimeFormat=this.dateFormat,u.data("BoldBIDashboardDateTimePicker").model.dateTimeFormat=this.dateFormat);t=BoldBIDashboard.format(new Date(n.MinValue),this.dateFormat);i=BoldBIDashboard.format(new Date(n.MaxValue),this.dateFormat);r.attr({minDateTime:t,maxDateTime:i});u.attr({minDateTime:t,maxDateTime:i});r.data("BoldBIDashboardDateTimePicker").setModel({minDateTime:t,maxDateTime:i,value:t});u.data("BoldBIDashboardDateTimePicker").setModel({minDateTime:t,maxDateTime:i,value:i});this.getStartTr().css("display","block");this.getEndTr().css("display","block");this.hideLoadingIndicator();BoldBIDashboard.isNullOrUndefined(this.filterInfo)||BoldBIDashboard.isNullOrUndefined(this.filterInfo.AllowFilterInfo)||BoldBIDashboard.isNullOrUndefined(this.filterInfo.AllowFilterInfo.DateFilterInfo)||this.populateDateRangeFilter(this.filterInfo.AllowFilterInfo.DateFilterInfo)},n.prototype.showLoadingIndicator=function(){this.getFieldDiv().BoldBIDashboardWaitingPopup("show");this.getRangeRadioBtn().prop("disabled",!0);this.getStartRadioBtn().prop("disabled",!0);this.getEndRadioBtn().prop("disabled",!0)},n.prototype.hideLoadingIndicator=function(){this.getRangeRadioBtn().prop("disabled",!1);this.getStartRadioBtn().prop("disabled",!1);this.getEndRadioBtn().prop("disabled",!1);this.getFieldDiv().BoldBIDashboardWaitingPopup("hide")},n.prototype.populateDateRangeFilter=function(n){this.isModified=!1;this.dialogContainer.attr({StartDate:n.StartDate,EndDate:n.EndDate,Range:n.DateFormatCondition});var r=n.DateFormatCondition,u=this.getRangeRadioBtn(),f=this.getStartRadioBtn(),e=this.getEndRadioBtn(),t="block",i="block";r===DateFormatOption.StartDate.toString()?(u.prop("checked",!1),f.prop("checked",!0),e.prop("checked",!1),i="none",t="block"):r===DateFormatOption.EndDate.toString()?(u.prop("checked",!1),f.prop("checked",!1),e.prop("checked",!0),i="block",t="none"):this.resetRadioBtnSelection();this.getStartTr().css("display",t);this.getEndTr().css("display",i);this.getStartPicker().data("BoldBIDashboardDateTimePicker").setModel({value:n.StartDate});this.getEndPicker().data("BoldBIDashboardDateTimePicker").setModel({value:n.EndDate})},n.prototype.resetRadioBtnSelection=function(){var n=this.getRangeRadioBtn(),t=this.getStartRadioBtn(),i=this.getEndRadioBtn();n.prop("checked",!0);t.prop("checked",!1);i.prop("checked",!1)},n.prototype.onRangeTypeChange=function(n){var r=this.getStartRadioBtn().prop("checked"),u=this.getEndRadioBtn().prop("checked"),t=this.getStartTr(),i=this.getEndTr();n.args.event.type==="change"&&(r?(t.css("display","block"),i.css("display","none")):u?(t.css("display","none"),i.css({display:"block"})):(t.css("display","block"),i.css({display:"block"})));this.enableApplyButton()},n.prototype.onPickerChange=function(n){(n.isInteraction||!BoldBIDashboard.isNullOrUndefined(n.currentTarget)&&this.bbdesigner$(n.currentTarget).val()=="")&&this.enableApplyButton()},n.prototype.saveDateRangeAttr=function(){var n,t;if(!BoldBIDashboard.isNullOrUndefined(this.targetInstance)){var i=this.getStartRadioBtn().prop("checked"),r=this.getEndRadioBtn().prop("checked"),u=this.getStartPicker().data("BoldBIDashboardDateTimePicker").getValue(),f=this.getEndPicker().data("BoldBIDashboardDateTimePicker").getValue();this.isModified=this.validateDateRangeValues();this.dialogContainer.attr({StartDate:u,EndDate:f});r?this.dialogContainer.attr("Range",DateFormatOption.EndDate.toString()):i?this.dialogContainer.attr("Range",DateFormatOption.StartDate.toString()):this.dialogContainer.attr("Range",DateFormatOption.Range.toString());n=this.getDateRangeValues();this.filterInfo=new DimensionFilterInfo;this.filterInfo.IsAllowFilteringApplied=!0;BoldBIDashboard.isNullOrUndefined(this.filterInfo.AllowFilterInfo)&&(this.filterInfo.AllowFilterInfo=new AllowFilteringInfo);this.filterInfo.AllowFilterInfo.IsDateFormatFilteringApplied=!0;this.filterInfo.AllowFilterInfo.DateFilterInfo=new DateRangeFilterInfo;this.filterInfo.AllowFilterInfo.DateFilterInfo.DateFormatCondition=n.DateFormatCondition;this.filterInfo.AllowFilterInfo.DateFilterInfo.StartDate=n.StartDate;this.filterInfo.AllowFilterInfo.DateFilterInfo.EndDate=n.EndDate;t=[this.filterInfo,this.fieldDetails];BoldBIDashboard.DashboardUtil.invokeMethod(this.targetInstance,this.targetMethod,t)}this.closeDialog()},n.prototype.closeDialog=function(){var n=this.getStartPicker().data("BoldBIDashboardDateTimePicker"),t=this.getEndPicker().data("BoldBIDashboardDateTimePicker");!BoldBIDashboard.isNullOrUndefined(n)&&n.isPopupOpen?n.hide():!BoldBIDashboard.isNullOrUndefined(t)&&t.isPopupOpen&&t.hide();this.dialogContainer.data("BoldBIDashboardDialog").close()},n.prototype.validateDateRangeValues=function(){var n=this.getStartPicker().data("BoldBIDashboardDateTimePicker").getValue(),t=this.getEndPicker().data("BoldBIDashboardDateTimePicker").getValue(),i=!BoldBIDashboard.isNullOrUndefined(this.filterInfo)&&!BoldBIDashboard.isNullOrUndefined(this.filterInfo.AllowFilterInfo)&&!BoldBIDashboard.isNullOrUndefined(this.filterInfo.AllowFilterInfo.DateFilterInfo)?this.filterInfo.AllowFilterInfo.DateFilterInfo.DateFormatCondition:DateFormatOption.Range;return this.dialogContainer.attr("StartDate")!==n||this.dialogContainer.attr("EndDate")!==t||this.dialogContainer.attr("Range")!==i.toString()?!0:!1},n.prototype.getDateRangeValues=function(){var n="Range",t=BoldBIDashboard.isNullOrUndefined(this.dialogContainer.attr("Range"))?DateFormatOption.Range.toString():this.dialogContainer.attr("Range"),i,r;return n=t===DateFormatOption.StartDate.toString()?DateFormatOption.StartDate.toString():t===DateFormatOption.EndDate.toString()?DateFormatOption.EndDate.toString():DateFormatOption.Range.toString(),i=BoldBIDashboard.isNullOrUndefined(this.dialogContainer.attr("StartDate"))?"":this.dialogContainer.attr("StartDate"),r=BoldBIDashboard.isNullOrUndefined(this.dialogContainer.attr("EndDate"))?"":this.dialogContainer.attr("EndDate"),{StartDate:i,EndDate:r,DateFormatCondition:n,IsModified:this.isModified}},n.prototype.enableApplyButton=function(){var n=this.dialogContainer.find("#"+this.rowId+"_dateRange_Start_picker").val(),t=this.dialogContainer.find("#"+this.rowId+"_dateRange_end_picker").val(),r=this.getApplyBtn(),u=this.getStartRadioBtn().prop("checked"),f=this.getEndRadioBtn().prop("checked"),i=!0;i=u&&!BoldBIDashboard.isNullOrUndefined(n)&&n!==""||f&&!BoldBIDashboard.isNullOrUndefined(t)&&t!==""||!BoldBIDashboard.isNullOrUndefined(n)&&n!==""&&!BoldBIDashboard.isNullOrUndefined(t)&&t!=="";BoldBIDashboard.DashboardUtil.buttonEnable(r,i)},n.prototype.getRangeRadioBtn=function(){return this.dialogContainer.find("#"+this.rowId+"_RangeBtn_rdo_input")},n.prototype.getStartRadioBtn=function(){return this.dialogContainer.find("#"+this.rowId+"_startBtn_rdo_input")},n.prototype.getEndRadioBtn=function(){return this.dialogContainer.find("#"+this.rowId+"_endBtn_rdo_input")},n.prototype.getStartPicker=function(){return this.dialogContainer.find("#"+this.rowId+"_dateRange_Start_picker")},n.prototype.getEndPicker=function(){return this.dialogContainer.find("#"+this.rowId+"_dateRange_end_picker")},n.prototype.getStartTr=function(){return this.dialogContainer.find("#"+this.rowId+"_dateRange_start_tr")},n.prototype.getEndTr=function(){return this.dialogContainer.find("#"+this.rowId+"_dateRange_end_tr")},n.prototype.getApplyBtn=function(){return this.dashboardDesigner.element.find("#"+this.rowId+"_btn_ok")},n.prototype.getFieldDiv=function(){return this.dialogContainer.find("#"+this.rowId+"_dateRange_fieldDiv")},n.prototype.destroy=function(){BoldBIDashboard.DashboardUtil.destroyEjObjects(this.dialogContainer);this.dialogContainer.length>0&&this.dashboardDesigner.element.find("#"+this.rowId).remove()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.RangeFilterDialog",InternalRangeFilterDialog,window);InternalRelativeDateFilter=function(){function n(n){this.dashboardDesigner=null;this.dateFilterDialog=null;this.footerTag=null;this.formatDropdown=null;this.periodDropdown=null;this.rangeNumeric=null;this.textDiv=null;this.rangeFormat=null;this.previewTag=null;this.linkDate=null;this.anchorDate=null;this.targetInstance=null;this.targetMethod=null;this.dateFilterInfo=null;this.userFilterInfo=null;this.columnDetails=null;this.menuInfo=null;this.endDate=null;this.startDate=null;this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.id=this.dashboardDesigner._id;this.dateFormat=this.dashboardDesigner.model.localeSettings.dateFormat;this.timeFormat=this.dashboardDesigner.model.localeSettings.timeFormat;this.renderRelativeDateFilterWindow()}return n.prototype.renderRelativeDateFilterWindow=function(){var n=this.dateFilterDialog=BoldBIDashboard.buildTag("div.bbi-userselect","",{},{id:this.id+"_relative_date_filter"}),u=BoldBIDashboard.buildTag("div","",{},{id:this.id+"_relative_date_filter_container"}),f=BoldBIDashboard.buildTag("table.bbi-designer-exp-table","",{width:"100%",padding:"5px 0px 15px"},{}),e=this.bbdesigner$("<tr><\/tr>"),o=BoldBIDashboard.buildTag("td","",{width:"80px"},{}),st=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily","Range",{"font-size":"12px"},{type:"label"}),s=BoldBIDashboard.buildTag("td","",{},{}),h=this.formatDropdown=BoldBIDashboard.buildTag("input","",{},{type:"text",id:this.id+"_relative_date_filter_formatdrop"}),t,ot,i,r;o.append(st);s.append(h);e.append(o).append(s);f.append(e);var ht=BoldBIDashboard.buildTag("div","",{width:"100%",height:"5px","border-top":"1px solid var(--primary-border-color)"},{}),c=BoldBIDashboard.buildTag("table.bbi-designer-exp-table","",{width:"100%",padding:"10px 0px 5px"},{}),l=this.bbdesigner$("<tr><\/tr>"),a=BoldBIDashboard.buildTag("td","",{width:"80px"},{}),ct=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily","Period",{"font-size":"12px"},{type:"label"}),v=BoldBIDashboard.buildTag("td","",{},{}),y=this.periodDropdown=BoldBIDashboard.buildTag("input","",{},{type:"text",id:this.id+"_relative_date_filter_perioddrop"}),p=BoldBIDashboard.buildTag("td","",{"padding-left":"5px"},{}),w=this.rangeNumeric=BoldBIDashboard.buildTag("input","",{},{type:"text",id:this.id+"_relative_date_filter_rangeNumeric"}),b=BoldBIDashboard.buildTag("td","",{width:"70px"},{}),k=this.textDiv=BoldBIDashboard.buildTag("div","",{padding:"0px 5px"},{id:this.id+"_relative_date_filter_rangeFormatDiv"}),lt=this.rangeFormat=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily","",{"font-size":"12px"},{type:"label",id:this.id+"_relative_date_filter_rangeFormat"});a.append(ct);v.append(y);p.append(w);b.append(k);k.append(lt);l.append(a).append(v,p,b);c.append(l);var d=BoldBIDashboard.buildTag("table.bbi-designer-exp-table","",{width:"100%",padding:"5px 0px"},{}),g=BoldBIDashboard.buildTag("tr","",{},{}),at=BoldBIDashboard.buildTag("td.bbi-designer-fontfamily","",{"font-size":"12px",width:"80px"},{}),nt=BoldBIDashboard.buildTag("td","",{}),tt=this.linkDate=BoldBIDashboard.buildTag("input","",{},{type:"checkbox",id:this.id+"_relative_date_filter_linkDate"});nt.append(tt);g.append(at).append(nt);d.append(g);var it=BoldBIDashboard.buildTag("table.bbi-designer-exp-table","",{width:"100%",padding:"5px 0px"},{}),rt=BoldBIDashboard.buildTag("tr","",{},{}),vt=BoldBIDashboard.buildTag("td.bbi-designer-fontfamily","",{"font-size":"12px",width:"80px"},{}),ut=BoldBIDashboard.buildTag("td","",{}),ft=BoldBIDashboard.buildTag("div","",{float:"left"}),et=this.anchorDate=BoldBIDashboard.buildTag("input.bbi-designer-param-assign","",{},{id:this.id+"_relative_date_filter_anchorDate"});ut.append(ft);ft.append(et);rt.append(vt).append(ut);it.append(rt);t=BoldBIDashboard.buildTag("div","",{width:"210px",height:"28px","padding-left":"3px",float:"left","line-height":"28px"},{});ot=this.previewTag=BoldBIDashboard.buildTag("span","",{"font-size":"10px","vertical-align":"middle"},{id:this.id+"_relative_date_filter_preview"});t.append(ot);i=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_relative_date_filter_cancel",type:"button"});r=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.dialogOptions.okButtonText,{float:"right"},{id:this.id+"_relative_date_filter_ok",type:"button"});u.append(f,ht,c,d,it);n.append(u);this.dashboardDesigner.element.append(n);n.BoldBIDashboardDialog({title:"Relative Date Filter",width:"auto",height:"auto",minWidth:240,minHeight:250,enableResize:!1,showOnInit:!1,enableModal:!0,containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id,showFooter:!0,cssClass:"bbi-designer-dialog boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.footerTag=this.dashboardDesigner.element.find("#"+this.id+"_relative_date_filter_foot");this.footerTag.append(t).append(i).append(r);r.on("click",this.bbdesigner$.proxy(this.updateDateFilterInfo,this));i.on("click",this.bbdesigner$.proxy(this.closeRelativeDateFilter,this));h.BoldBIDashboardDropDownList({width:"150px",height:"28px",dataSource:this.formatTypeList(),fields:{text:"text",value:"value"},enabled:!0,showRoundedCorner:!0,popupWidth:"160px",cssClass:"bbi-designer-param-assign bbi-designer-border bbi-designer-ejwidgets bbi-dbrd-control",change:this.bbdesigner$.proxy(this.changeFormatType,this)});y.BoldBIDashboardDropDownList({width:"150px",height:"28px",dataSource:[],fields:{text:"text",value:"dateInstance"},enabled:!0,showRoundedCorner:!0,popupWidth:"160px",popupHeight:"100px",cssClass:"bbi-designer-param-assign bbi-designer-border bbi-designer-ejwidgets bbi-dbrd-control",change:this.bbdesigner$.proxy(this.changePeriodType,this)});w.ejNumericTextbox({showSpinButton:!0,decimalPlaces:0,minValue:1,maxvalue:1e9,value:1,width:"70px",height:"28px",showRoundedCorner:!0,cssClass:"bbi-designer-ejwidgets bbi-designer-ejwidgets-updown bbi-designer-content-label",change:this.bbdesigner$.proxy(this.changeTextBoxValue,this)});tt.BoldBIDashboardCheckBox({text:"Link to specific date",checked:!1,width:"35px",cssClass:"bbi-designer-case-sensitive",change:this.bbdesigner$.proxy(this.changeCheckBoxValue,this)});et.BoldBIDashboardDatePicker({width:"150px",height:"28px",showRoundedCorner:!0,cssClass:"bbi-designer-border bbi-designer-relative-datepicker",enabled:!1,minDate:"01/01/0001",maxDate:"01/01/9999",change:this.bbdesigner$.proxy(this.changeDatePickerValue,this)})},n.prototype.changeDatePickerValue=function(n){BoldBIDashboard.isNullOrUndefined(n)||this.UpdatePreviewRelativeDate()},n.prototype.changeTextBoxValue=function(n){BoldBIDashboard.isNullOrUndefined(n.value)?this.rangeNumeric.data("ejNumericTextbox").setModel({value:1}):this.UpdatePreviewRelativeDate()},n.prototype.changeFormatType=function(n){var i;if(!BoldBIDashboard.isNullOrUndefined(n)&&n.text.length>0){this.linkDate.data("BoldBIDashboardCheckBox").enable();(n.value===RelativeDateFormat.Minute||n.value===RelativeDateFormat.Hour)&&(this.dashboardDesigner.element.find("#"+this.id+"_relative_date_filter_linkDate").data("BoldBIDashboardCheckBox").setModel({checked:!1}),this.linkDate.data("BoldBIDashboardCheckBox").disable());var f=this.linkDate.data("BoldBIDashboardCheckBox").isChecked(),u=this.periodTypeList(n.text,f),t=this.periodDropdown.data("BoldBIDashboardDropDownList"),r=this.bbdesigner$(t.getSelectedItem()).attr("data-value");if(t.setModel({dataSource:u}),BoldBIDashboard.isNullOrUndefined(r))t.selectItemsByIndices(1);else for(i=0;i<u.length;i++)if(u[i].dateInstance===r){t.selectItemsByIndices(i);break}else if((r===DateInstance.Custom||r===DateInstance.ToDate)&&(n.value===RelativeDateFormat.Day||n.value===RelativeDateFormat.Hour)){t.selectItemsByIndices(1);break}this.UpdatePreviewRelativeDate()}},n.prototype.changeCheckBoxValue=function(n){var t;if(!BoldBIDashboard.isNullOrUndefined(n)){var f=this.formatDropdown.data("BoldBIDashboardDropDownList").getSelectedValue(),r=this.periodTypeList(f,n.isChecked),i=this.periodDropdown.data("BoldBIDashboardDropDownList"),u=this.bbdesigner$(i.getSelectedItem()).attr("data-value");if(i.setModel({dataSource:r}),BoldBIDashboard.isNullOrUndefined(u))i.selectItemsByIndices(1);else for(t=0;t<r.length;t++)if(r[t].dateInstance===u){i.selectItemsByIndices(t);break}this.anchorDate.data("BoldBIDashboardDatePicker").setModel({enabled:n.isChecked});this.UpdatePreviewRelativeDate()}},n.prototype.changePeriodType=function(n){if(!BoldBIDashboard.isNullOrUndefined(n)&&n.text.length>0){var t=n.text;t==="Last"||t==="Next"||t==="Past"||t==="Upcoming"?this.enableRangeNumericTextBox(!0):this.enableRangeNumericTextBox(!1);this.UpdatePreviewRelativeDate()}},n.prototype.enableRangeNumericTextBox=function(n){if(n){var t=this.formatDropdown.data("BoldBIDashboardDropDownList").getSelectedValue();this.rangeNumeric.data("ejNumericTextbox").enable();this.rangeFormat.text(t.toLowerCase()+"(s)")}else this.rangeNumeric.data("ejNumericTextbox").disable(),this.rangeFormat.text("")},n.prototype.UpdatePreviewRelativeDate=function(){var t=this.formatDropdown.data("BoldBIDashboardDropDownList").getSelectedValue(),n=null,i;t==="Year"?n=this.filterRelativeDateByYear():t==="Quarter"?n=this.filterRelativeDateByQuarter():t==="Month"?n=this.filterRelativeDateByMonth():t==="Week"?n=this.filterRelativeDateByWeek():t==="Day"?n=this.filterRelativeDateByDay():t==="Hour"?n=this.filterRelativeDateByHour():t==="Minute"&&(n=this.filterRelativeDateByMinute());BoldBIDashboard.isNullOrUndefined(n)?this.previewTag.text(""):(i=n.startPreviewDate.length>0?n.startPreviewDate+" to "+n.endPreviewDate:n.endPreviewDate,this.previewTag.text(i))},n.prototype.getPreviewRelatedDetails=function(){var t=this.periodDropdown.data("BoldBIDashboardDropDownList").getListData(),i=BoldBIDashboard.isNullOrUndefined(this.periodDropdown.data("BoldBIDashboardDropDownList").model.selectedIndex)?1:this.periodDropdown.data("BoldBIDashboardDropDownList").model.selectedIndex,n=t[i].dateInstance,r=this.isCommonDateInstance(n)?this.rangeNumeric.data("ejNumericTextbox").getValue():1;return{useAnchorDate:this.linkDate.data("BoldBIDashboardCheckBox").isChecked(),anchorDate:this.anchorDate.data("BoldBIDashboardDatePicker").getValue(),dateInstance:n,range:r}},n.prototype.filterRelativeDateByYear=function(){var o=this.getPreviewRelatedDetails(),s=o.anchorDate,u=o.range,t=new Date,f,e;o.useAnchorDate&&!BoldBIDashboard.isNullOrUndefined(s)&&(t=BoldBIDashboard.globalize.parseDate(s,this.dateFormat));var r=t.getFullYear(),n=null,i=null;switch(o.dateInstance){case DateInstance.Current:n=new Date(r,0,1,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear()+1,n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Previous:r--;n=new Date(r,0,1,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear()+1,n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Succeeding:r++;n=new Date(r,0,1,0,0,0);i=this.updateEndDate(new Date(n.getFullYear()+u,n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.ToDate:n=new Date(r,0,1,0,0,0,0);i=this.updateEndDate(new Date(r,t.getMonth(),t.getDate()+1));break;case DateInstance.Last:r-=u;n=new Date(r,0,1,0,0,0);i=this.updateEndDate(new Date(n.getFullYear()+u,n.getMonth()));break;case DateInstance.Next:n=new Date(r+1,0,1,0,0,0);i=this.updateEndDate(new Date(n.getFullYear()+u,n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Past:n=new Date(r-u,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());i=this.updateEndDate(t);break;case DateInstance.Upcoming:n=t;i=this.updateEndDate(new Date(r+u,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))}return f=null,e=null,BoldBIDashboard.isNullOrUndefined(n)||(f=this.convertDateToString(n),f=BoldBIDashboard.format(new Date(f),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(i)||(e=this.convertDateToString(i),e=BoldBIDashboard.format(new Date(e),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(n)||(n=this.convertDateTimeToMeridiemTimeString(n)),BoldBIDashboard.isNullOrUndefined(i)||(i=this.convertDateTimeToMeridiemTimeString(i)),this.startDate=n,this.endDate=i,{startPreviewDate:f,endPreviewDate:e}},n.prototype.filterRelativeDateByQuarter=function(){var o=this.getPreviewRelatedDetails(),s=o.anchorDate,u=o.range,n=new Date,f,e;o.useAnchorDate&&!BoldBIDashboard.isNullOrUndefined(s)&&(n=BoldBIDashboard.globalize.parseDate(s,this.dateFormat));var r=Math.ceil((n.getMonth()+1)/3),t=null,i=null;switch(o.dateInstance){case DateInstance.Current:t=new Date(n.getFullYear(),Math.ceil((r-1)*3),1,0,0,0,0);i=this.updateEndDate(new Date(t.getFullYear(),t.getMonth()+3,1,0,0,0,0));break;case DateInstance.Previous:t=new Date(n.getFullYear(),Math.ceil((r-1)*3-3),1,0,0,0,0);i=this.updateEndDate(new Date(t.getFullYear(),t.getMonth()+3,1,0,0,0,0));break;case DateInstance.Succeeding:t=new Date(n.getFullYear(),Math.ceil((r-1)*3+3),1,0,0,0,0);i=this.updateEndDate(new Date(t.getFullYear(),t.getMonth()+3,1,0,0,0,0));break;case DateInstance.ToDate:t=new Date(n.getFullYear(),Math.ceil((r-1)*3),1,0,0,0,0);i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,99);break;case DateInstance.Next:t=new Date(n.getFullYear(),Math.ceil((r-1)*3+3),1,0,0,0);i=this.updateEndDate(new Date(t.getFullYear(),t.getMonth()+3*u,1,0,0,0,0));break;case DateInstance.Last:t=new Date(n.getFullYear(),Math.ceil((r-1)*3-3*u),1,0,0,0);i=this.updateEndDate(new Date(t.getFullYear(),t.getMonth()+3*u,1,0,0,0,0));break;case DateInstance.Past:t=new Date(n.getFullYear(),n.getMonth()-3*u,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds());i=this.updateEndDate(n);break;case DateInstance.Upcoming:t=n;i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth()+3*u,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()))}return f=null,e=null,BoldBIDashboard.isNullOrUndefined(t)||(f=this.convertDateToString(t),f=BoldBIDashboard.format(new Date(f),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(i)||(e=this.convertDateToString(i),e=BoldBIDashboard.format(new Date(e),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(t)||(t=this.convertDateTimeToMeridiemTimeString(t)),BoldBIDashboard.isNullOrUndefined(i)||(i=this.convertDateTimeToMeridiemTimeString(i)),this.startDate=t,this.endDate=i,{startPreviewDate:f,endPreviewDate:e}},n.prototype.filterRelativeDateByMonth=function(){var e=this.getPreviewRelatedDetails(),s=e.anchorDate,o=e.range,t=new Date,u,f;e.useAnchorDate&&!BoldBIDashboard.isNullOrUndefined(s)&&(t=BoldBIDashboard.globalize.parseDate(s,this.dateFormat));var r=t.getFullYear(),n=null,i=null;switch(e.dateInstance){case DateInstance.Current:n=new Date(r,t.getMonth(),1,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth()+1));break;case DateInstance.Previous:n=new Date(r,t.getMonth()-1,1,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth()+1));break;case DateInstance.Succeeding:n=new Date(r,t.getMonth()+1,1,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth()+1));break;case DateInstance.ToDate:n=new Date(r,t.getMonth(),1,0,0,0,0);i=t;break;case DateInstance.Last:n=new Date(r,t.getMonth()-o,1,0,0,0,0);i=this.updateEndDate(new Date(r,t.getMonth(),1,0,0,0,0));break;case DateInstance.Next:n=new Date(r,t.getMonth()+1,1,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth()+o));break;case DateInstance.Past:n=new Date(r,t.getMonth()-o,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());i=this.updateEndDate(t);break;case DateInstance.Upcoming:n=t;i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth()+o,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()))}return u=null,f=null,BoldBIDashboard.isNullOrUndefined(n)||(u=this.convertDateToString(n),u=BoldBIDashboard.format(new Date(u),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(i)||(f=this.convertDateToString(i),f=BoldBIDashboard.format(new Date(f),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(n)||(n=this.convertDateTimeToMeridiemTimeString(n)),BoldBIDashboard.isNullOrUndefined(i)||(i=this.convertDateTimeToMeridiemTimeString(i)),this.startDate=n,this.endDate=i,{startPreviewDate:u,endPreviewDate:f}},n.prototype.filterRelativeDateByWeek=function(){var s=this.getPreviewRelatedDetails(),c=s.anchorDate,h=s.range,t=new Date,r,e,o;s.useAnchorDate&&!BoldBIDashboard.isNullOrUndefined(c)&&(t=BoldBIDashboard.globalize.parseDate(c,this.dateFormat));var u=t.getFullYear(),n=null,i=null,f=0-t.getDay();switch(s.dateInstance){case DateInstance.Current:n=new Date(u,t.getMonth(),t.getDate()+f,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+7,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Previous:n=new Date(u,t.getMonth(),t.getDate()+f-7,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+7,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Succeeding:n=new Date(u,t.getMonth(),t.getDate()+f+7,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+7,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.ToDate:n=new Date(u,t.getMonth(),t.getDate()+f,0,0,0,0);i=new Date(n.getFullYear(),n.getMonth(),n.getDate()+t.getDay(),n.getHours()+t.getHours(),n.getMinutes()+t.getMinutes(),n.getSeconds()+t.getSeconds(),n.getMilliseconds()+t.getMilliseconds());break;case DateInstance.Next:r=h*7;n=new Date(u,t.getMonth(),t.getDate()+f+7,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+r,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Last:r=h*7;n=new Date(u,t.getMonth(),t.getDate()+f-r,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+r,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Past:r=h*7;n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-r,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());i=this.updateEndDate(t);break;case DateInstance.Upcoming:r=h*7;n=t;i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+r,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()))}return e=null,o=null,BoldBIDashboard.isNullOrUndefined(n)||(e=this.convertDateToString(n),e=BoldBIDashboard.format(new Date(e),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(i)||(o=this.convertDateToString(i),o=BoldBIDashboard.format(new Date(o),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(n)||(n=this.convertDateTimeToMeridiemTimeString(n)),BoldBIDashboard.isNullOrUndefined(i)||(i=this.convertDateTimeToMeridiemTimeString(i)),this.startDate=n,this.endDate=i,{startPreviewDate:e,endPreviewDate:o}},n.prototype.filterRelativeDateByDay=function(){var o=this.getPreviewRelatedDetails(),s=o.anchorDate,r=o.range,u=!1,t=new Date,n,i,f,e;o.useAnchorDate&&!BoldBIDashboard.isNullOrUndefined(s)&&(t=BoldBIDashboard.globalize.parseDate(s,this.dateFormat));n=null;i=null;switch(o.dateInstance){case DateInstance.Current:n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+1,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));u=!0;break;case DateInstance.Previous:n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+1,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));u=!0;break;case DateInstance.Succeeding:n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+1,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));u=!0;break;case DateInstance.Last:n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-r,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+r,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Next:n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate()+r,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Past:n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-r,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());i=this.updateEndDate(t);break;case DateInstance.Upcoming:n=t;i=this.updateEndDate(new Date(t.getFullYear(),t.getMonth(),t.getDate()+r,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))}return f=null,e=null,BoldBIDashboard.isNullOrUndefined(n)||(f=u?"":this.convertDateToString(n),f=u?"":BoldBIDashboard.format(new Date(f),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(i)||(e=this.convertDateToString(i),e=BoldBIDashboard.format(new Date(e),this.dateFormat)),BoldBIDashboard.isNullOrUndefined(n)||(n=this.convertDateTimeToMeridiemTimeString(n)),BoldBIDashboard.isNullOrUndefined(i)||(i=this.convertDateTimeToMeridiemTimeString(i)),this.startDate=n,this.endDate=i,{startPreviewDate:f,endPreviewDate:e}},n.prototype.filterRelativeDateByHour=function(){var o=this.getPreviewRelatedDetails(),s=o.anchorDate,u=o.range,t=new Date,f,e;o.useAnchorDate&&!BoldBIDashboard.isNullOrUndefined(s)&&(t=BoldBIDashboard.globalize.parseDate(s,this.dateFormat));var r=t.getFullYear(),n=null,i=null;switch(o.dateInstance){case DateInstance.Current:n=new Date(r,t.getMonth(),t.getDate(),t.getHours(),0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours()+1,n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Previous:n=new Date(r,t.getMonth(),t.getDate(),t.getHours()-1,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours()+1,n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Succeeding:n=new Date(r,t.getMonth(),t.getDate(),t.getHours()+1,0,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours()+1,n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.ToDate:n=new Date(r,t.getMonth(),t.getDate(),t.getHours(),0,0,0);i=t;break;case DateInstance.Next:n=new Date(r,t.getMonth(),t.getDate(),t.getHours()+u,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours()+u,n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Last:n=new Date(r,t.getMonth(),t.getDate(),t.getHours()-u,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours()+u,n.getMinutes(),n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Past:n=new Date(r,t.getMonth(),t.getDate(),t.getHours()-u,t.getMinutes(),t.getSeconds(),t.getMilliseconds());i=this.updateEndDate(t);break;case DateInstance.Upcoming:n=t;i=this.updateEndDate(new Date(r,t.getMonth(),t.getDate(),t.getHours()+u,t.getMinutes(),t.getSeconds(),t.getMilliseconds()))}return f=null,e=null,BoldBIDashboard.isNullOrUndefined(n)||(f=this.convertDateTimeToMeridiemTimeString(n),f=BoldBIDashboard.format(new Date(f),this.timeFormat)),BoldBIDashboard.isNullOrUndefined(i)||(e=this.convertDateTimeToMeridiemTimeString(i),e=BoldBIDashboard.format(new Date(e),this.timeFormat)),BoldBIDashboard.isNullOrUndefined(n)||(n=this.convertDateTimeToMeridiemTimeString(n)),BoldBIDashboard.isNullOrUndefined(i)||(i=this.convertDateTimeToMeridiemTimeString(i)),this.startDate=n,this.endDate=i,{startPreviewDate:f,endPreviewDate:e}},n.prototype.filterRelativeDateByMinute=function(){var o=this.getPreviewRelatedDetails(),s=o.anchorDate,u=o.range,t=new Date,f,e;o.useAnchorDate&&!BoldBIDashboard.isNullOrUndefined(s)&&(t=BoldBIDashboard.globalize.parseDate(s,this.dateFormat));var r=t.getFullYear(),n=null,i=null;switch(o.dateInstance){case DateInstance.Current:n=new Date(r,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()+1,n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Previous:n=new Date(r,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()-1,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()-1,n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Succeeding:n=new Date(r,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()+1,0,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()+1,n.getSeconds(),n.getMilliseconds()));break;case DateInstance.ToDate:n=new Date(r,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),0,0);i=t;break;case DateInstance.Next:n=new Date(r,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()+u,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()+u,n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Last:n=new Date(r,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()-u,0);i=this.updateEndDate(new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()+u,n.getSeconds(),n.getMilliseconds()));break;case DateInstance.Past:n=new Date(r,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()-u,t.getSeconds(),t.getMilliseconds());i=this.updateEndDate(t);break;case DateInstance.Upcoming:n=t;i=this.updateEndDate(new Date(r,t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()+u,t.getSeconds(),t.getMilliseconds()))}return f=null,e=null,BoldBIDashboard.isNullOrUndefined(n)||(f=this.convertDateTimeToMeridiemTimeString(n),f=BoldBIDashboard.format(new Date(f),this.timeFormat)),BoldBIDashboard.isNullOrUndefined(i)||(e=this.convertDateTimeToMeridiemTimeString(i),e=BoldBIDashboard.format(new Date(e),this.timeFormat)),BoldBIDashboard.isNullOrUndefined(n)||(n=this.convertDateTimeToMeridiemTimeString(n)),BoldBIDashboard.isNullOrUndefined(i)||(i=this.convertDateTimeToMeridiemTimeString(i)),this.startDate=n,this.endDate=i,{startPreviewDate:f,endPreviewDate:e}},n.prototype.convertDateTimeToMeridiemTimeString=function(n){var i=(n.getMonth()+1>=10?"":"0")+(n.getMonth()+1),t=n.getHours()===0?12:n.getHours()>12?n.getHours()-12:n.getHours(),r=n.getHours()>=12?"PM":"AM",u=(t<10?"0":"")+t,f=(n.getMinutes()<10?"0":"")+n.getMinutes();return i+"/"+n.getDate()+"/"+n.getFullYear()+" "+u+":"+f+" "+r},n.prototype.updateEndDate=function(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()-2)},n.prototype.isCommonDateInstance=function(n){return n===DateInstance.Last||n===DateInstance.Next||n===DateInstance.Past||n===DateInstance.Upcoming},n.prototype.populateDateFilterInfo=function(n){var i=BoldBIDashboard.DashboardDesignerUtility.Serialization.enumToString(RelativeDateFormat,n.RelativeDateFormat),t;this.formatDropdown.data("BoldBIDashboardDropDownList").selectItemByValue(i);this.periodDropdown.data("BoldBIDashboardDropDownList").selectItemByValue(n.DateInstance);this.isCommonDateInstance(n.DateInstance)?(this.enableRangeNumericTextBox(!0),this.rangeNumeric.data("ejNumericTextbox").setModel({value:n.Range>0?n.Range:1})):this.enableRangeNumericTextBox(!1);this.linkDate.data("BoldBIDashboardCheckBox").setModel({checked:n.UseAnchorDate});t=null;t=!BoldBIDashboard.isNullOrUndefined(n.AnchorDate)&&n.AnchorDate.length>0?BoldBIDashboard.globalize.parseDate(n.AnchorDate,this.dateFormat):new Date(this.getCurrentDate());this.anchorDate.data("BoldBIDashboardDatePicker").setModel({enabled:n.UseAnchorDate,value:t});this.startDate=n.StartDate;this.endDate=n.EndDate;this.UpdatePreviewRelativeDate()},n.prototype.getRelativeDateFilterInfo=function(){var n=new RelativeDateFilterInfo,i=this.formatDropdown.data("BoldBIDashboardDropDownList").getSelectedValue(),t;return n.RelativeDateFormat=BoldBIDashboard.DashboardDesignerUtility.Serialization.stringtoEnum(RelativeDateFormat,i),t=this.periodDropdown.data("BoldBIDashboardDropDownList").getSelectedValue(),n.DateInstance=t,n.Range=this.isCommonDateInstance(t)?this.rangeNumeric.data("ejNumericTextbox").getValue():1,n.StartDate=this.startDate,n.EndDate=this.endDate,n.UseAnchorDate=this.linkDate.data("BoldBIDashboardCheckBox").isChecked(),n.AnchorDate=this.anchorDate.data("BoldBIDashboardDatePicker").getValue(),n},n.prototype.getCurrentDate=function(){var n=new Date;return this.convertDateToString(n)},n.prototype.convertDateToString=function(n){if(!BoldBIDashboard.isNullOrUndefined(n)){var t=(n.getMonth()+1>=10?"":"0")+(n.getMonth()+1);return t+"/"+n.getDate()+"/"+n.getFullYear()}return null},n.prototype.updateDateFilterInfo=function(){var t=this.getRelativeDateFilterInfo(),n;if(!BoldBIDashboard.isNullOrUndefined(this.targetInstance)){if(BoldBIDashboard.isNullOrUndefined(this.columnDetails.ChildHierarchicalFields))BoldBIDashboard.DashboardUtil.invokeMethod(this.targetInstance,this.targetMethod,[t,this.columnDetails,this.menuInfo,this.additionalArgs,this.userFilterInfo]);else for(n=0;n<this.columnDetails.ChildHierarchicalFields.length;n++)BoldBIDashboard.DashboardUtil.invokeMethod(this.targetInstance,this.targetMethod,[t,this.columnDetails.ChildHierarchicalFields[n],this.menuInfo,this.additionalArgs]);this.closeRelativeDateFilter()}},n.prototype.openRelativeDateFilter=function(n,t,i,r,u,f,e){f===void 0&&(f=null);this.dateFilterDialog.data("BoldBIDashboardDialog").open();this.resetDateFilerDialog();this.targetInstance=n;this.targetMethod=t;this.dateFilterInfo=i;this.columnDetails=r;this.userFilterInfo=e;this.additionalArgs=f;this.menuInfo=u;BoldBIDashboard.isNullOrUndefined(i)?this.formatDropdown.data("BoldBIDashboardDropDownList").setModel({selectedIndex:0}):this.populateDateFilterInfo(i,e)},n.prototype.closeRelativeDateFilter=function(){this.dateFilterDialog.data("BoldBIDashboardDialog").close()},n.prototype.resetDateFilerDialog=function(){this.targetInstance=null;this.targetMethod=null;this.dateFilterInfo=null;this.columnDetails=null;this.additionalArgs=null;this.rangeNumeric.data("ejNumericTextbox").setModel({value:1});this.enableRangeNumericTextBox(!1);BoldBIDashboard.isNullOrUndefined(this.anchorDate.data("BoldBIDashboardDatePicker"))||(this.anchorDate.data("BoldBIDashboardDatePicker").model.dateFormat=this.dateFormat);this.anchorDate.data("BoldBIDashboardDatePicker").setModel({enabled:!1,value:BoldBIDashboard.format(new Date(this.getCurrentDate()),this.dateFormat)});this.startDate=null;this.endDate=null;this.previewTag.text("");this.linkDate.data("BoldBIDashboardCheckBox").setModel({checked:!1})},n.prototype.destroy=function(){BoldBIDashboard.DashboardUtil.destroyEjObjects(this.dashboardDesigner.element.find("#"+this.id+"_relative_date_filter"));this.dashboardDesigner.element.find("#"+this.id+"_relative_date_filter").length>0&&this.dashboardDesigner.element.find("#"+this.id+"_relative_date_filter").remove()},n.prototype.periodTypeList=function(n,t){var r=[],i,u;return t?r=[{text:"Previous "+n,value:"Previous "+n,dateInstance:DateInstance.Previous},{text:"Link "+n,value:"Link "+n,dateInstance:DateInstance.Current},{text:"Next "+n,value:"Next "+n,dateInstance:DateInstance.Succeeding}]:(i=n==="Day",r=[{text:i?"Yesterday":"Previous "+n,value:i?"Yesterday":"Previous "+n,dateInstance:DateInstance.Previous},{text:i?"Today":"Current "+n,value:i?"Today":"Current "+n,dateInstance:DateInstance.Current},{text:i?"Tomorrow":"Next "+n,value:i?"Tomorrow":"Next "+n,dateInstance:DateInstance.Succeeding}]),u=[{text:"Last",value:"Last",dateInstance:DateInstance.Last},{text:"Next",value:"Next",dateInstance:DateInstance.Next},{text:"Past",value:"Past",dateInstance:DateInstance.Past},{text:"Upcoming",value:"Upcoming",dateInstance:DateInstance.Upcoming}],n!=="Day"&&n!=="Hour"&&n!=="Minute"&&u.push({text:n+" to "+(t?"LINK":"date"),value:n+" to "+(t?"LINK":"date"),dateInstance:DateInstance.ToDate}),r.concat(u)},n.prototype.formatTypeList=function(){return[{text:"Year",value:"Year"},{text:"Quarter",value:"Quarter"},{text:"Month",value:"Month"},{text:"Week",value:"Week"},{text:"Day",value:"Day"},{text:"Hour",value:"Hour"},{text:"Minute",value:"Minute"}]},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.RelativeDateFilter",InternalRelativeDateFilter,window);InternalRelativeDates=function(){function n(n){this.relativeDatesDialog=null;this.relativeDateItemTable=null;this.rangeTextBoxTd=null;this.formatDropdownTd=null;this.startDateTd=null;this.endDateTd=null;this.customTextBoxTd=null;this.addButtonTd=null;this.confirmationTd=null;this.previewTag=null;this.containerDiv=null;this.deleteIcon=null;this.editIcon=null;this.upIcon=null;this.downIcon=null;this.relativeDateList=[];this.targetInstance=null;this.targetMethod=null;this.addBtnTag=null;this.applyButton=null;this.periodDropdown=null;this.rangeTextBox=null;this.formatDropdown=null;this.startDatePicker=null;this.endDatePicker=null;this.customTextBox=null;this.listBoxContent=null;this.locale=null;this.id=n._id;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.designPanel=this.dashboardDesigner.designerPanel;this.renderRelativeDatesWindow()}return n.prototype.renderRelativeDatesWindow=function(){var u=this.relativeDatesDialog=BoldBIDashboard.buildTag("div.bbi-userselect bbi-dbrd-designer-scroll-style-3","",{},{id:this.id+"_relative_dates"}),f=BoldBIDashboard.buildTag("div","",{}),w=this.relativeDateItemTable=BoldBIDashboard.buildTag("table.bbi-designer-exp-table","",{width:"100%",padding:"5px 0px"},{}),b=this.bbdesigner$("<tr><\/tr>"),k=BoldBIDashboard.buildTag("td","",{"padding-left":"3px"},{id:this.id+"_relative_dates_periodTd"}),e=BoldBIDashboard.buildTag("input","",{},{type:"text",id:this.id+"_relative_dates_perioddrop"}),o,n,s,t,h,i,c,r,a,v,ut,y,ft,p,et;k.append(e);o=this.rangeTextBoxTd=BoldBIDashboard.buildTag("td","",{"padding-left":"5px",float:"left",display:"block"},{id:this.id+"_relative_dates_rangeTd"});n=BoldBIDashboard.buildTag("input","",{},{type:"text",id:this.id+"_relative_dates_range_textbox"});o.append(n);s=this.formatDropdownTd=BoldBIDashboard.buildTag("td","",{"padding-left":"5px",float:"right",display:"block"},{id:this.id+"_relative_dates_formatTd"});t=BoldBIDashboard.buildTag("input","",{},{type:"text",id:this.id+"_relative_dates_formatdrop"});s.append(t);h=this.startDateTd=BoldBIDashboard.buildTag("td","",{float:"right","padding-right":"7px",display:"none"},{id:this.id+"_relative_dates_startDateTd"});i=BoldBIDashboard.buildTag("input.bbi-designer-param-assign","",{},{type:"text",id:this.id+"_relative_dates_startDatePicker"});h.append(i);c=this.endDateTd=BoldBIDashboard.buildTag("td","",{float:"right",display:"none"},{id:this.id+"_relative_dates_endDateTd"});r=BoldBIDashboard.buildTag("input.bbi-designer-param-assign","",{},{type:"text",id:this.id+"_relative_dates_endDatePicker"});c.append(r);b.append(k).append(o).append(s).append(c).append(h);w.append(b);var d=this.relativeDateItemTable=BoldBIDashboard.buildTag("table.bbi-designer-exp-table","",{width:"100%",padding:"5px 0px 10px"},{}),g=this.bbdesigner$("<tr><\/tr>"),nt=this.customTextBoxTd=BoldBIDashboard.buildTag("td","",{"padding-left":"3px",float:"left"},{id:this.id+"_relative_dates_customTd"}),l=BoldBIDashboard.buildTag("input.bbi-designer-param-assign","",{},{type:"text",id:this.id+"_relative_dates_customTextBox"});nt.append(l);var tt=this.confirmationTd=BoldBIDashboard.buildTag("td","",{display:"none"},{id:this.id+"_relative_dates_confirmationTd"}),it=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_relative_dates_cancel",type:"button"}),rt=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary","Update",{float:"right"},{id:this.id+"_relative_dates_update",type:"button"});tt.append(it,rt);a=this.addButtonTd=BoldBIDashboard.buildTag("td","",{"padding-left":"3px",display:"block"},{id:this.id+"_relative_dates_addTd"});v=this.addBtnTag=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary","Add",{float:"right"},{id:this.id+"_relative_dates_add",type:"button"});a.append(v);g.append(nt).append(tt).append(a);d.append(g);ut=BoldBIDashboard.buildTag("div","",{height:"5px",margin:"0px 2px 0px 5px","border-top":"1px solid #cecece"},{});f.append(w).append(d).append(ut);this.renderDateOptionsContainer(f);y=BoldBIDashboard.buildTag("div","",{width:"210px",height:"28px",display:"table","padding-left":"3px",float:"left"},{});ft=this.previewTag=BoldBIDashboard.buildTag("span","",{display:"table-cell","font-size":"10px","vertical-align":"middle"},{id:this.id+"_relative_dates_preview"});y.append(ft);p=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.dialogOptions.cancelButtonText,{float:"right"},{id:this.id+"_relative_dates_close",type:"button"});this.applyButton=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.dialogOptions.applyButtonText,{float:"right"},{id:this.id+"_relative_dates_ok",type:"button"});u.append(f);this.dashboardDesigner.element.append(u);u.BoldBIDashboardDialog({title:"Relative Date Options",width:"auto",height:"auto",minWidth:500,minHeight:400,enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id,cssClass:"bbi-designer-dialog boldbi-dashboarddesigner",close:this.bbdesigner$.proxy(BoldBIDashboard.DashboardUtil.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});et=this.dashboardDesigner.element.find("#"+this.id+"_relative_dates_foot");et.append(y).append(p,this.applyButton);this.applyButton.on("click",this.bbdesigner$.proxy(this.applyRelativeDateInfo,this));p.on("click",this.bbdesigner$.proxy(this.closeRelativeDateInfo,this));t.BoldBIDashboardDropDownList({width:"160px",height:"28px",dataSource:this.formatTypeList(),fields:{text:"text",value:"value"},showRoundedCorner:!0,popupWidth:"160px",cssClass:"bbi-designer-param-assign bbi-designer-border bbi-designer-ejwidgets bbi-dbrd-control",change:this.bbdesigner$.proxy(this.changeFormatType,this)});n.ejNumericTextbox({showSpinButton:!0,decimalPlaces:0,minValue:1,maxvalue:1e9,value:1,width:"120px",height:"28px",showRoundedCorner:!0,cssClass:"bbi-designer-ejwidgets bbi-designer-ejwidgets-updown bbi-designer-content-label",change:this.bbdesigner$.proxy(this.getPreviewDateRange,this)});e.BoldBIDashboardDropDownList({width:"160px",height:"28px",dataSource:[],fields:{text:"text",value:"value"},showRoundedCorner:!0,popupWidth:"160px",cssClass:"bbi-designer-param-assign bbi-designer-border bbi-designer-ejwidgets bbi-dbrd-control",change:this.bbdesigner$.proxy(this.changePeriodType,this)});i.BoldBIDashboardDatePicker({width:"145px",height:"28px",watermarkText:"Start date",showRoundedCorner:!0,cssClass:"bbi-designer-border e-dbrd-designer-relative-picker e-dashboarddesigner-widget",startDate:"01/01/0001",endDate:"01/01/9999",change:this.bbdesigner$.proxy(this.getPreviewDateRange,this)});r.BoldBIDashboardDatePicker({width:"145px",height:"28px",watermarkText:"End date",showRoundedCorner:!0,cssClass:"bbi-designer-border e-dbrd-designer-relative-picker e-dashboarddesigner-widget",startDate:"01/01/0001",endDate:"01/01/9999",change:this.bbdesigner$.proxy(this.getPreviewDateRange,this)});l.BoldBIDashboardMaskEdit({inputMode:BoldBIDashboard.InputMode.Text,width:"200px",height:"26px",watermarkText:"Display Text",showRoundedCorner:!0,cssClass:"bbi-designer-border",change:this.bbdesigner$.proxy(this.changeCustomValue,this)});v.on("click",this.bbdesigner$.proxy(this.appendRelativeDateList,this));rt.on("click",this.bbdesigner$.proxy(this.updateRelativeDateInfo,this));it.on("click",this.bbdesigner$.proxy(this.cancelDateInfoUpdation,this));this.periodDropdown=e.data("BoldBIDashboardDropDownList");this.rangeTextBox=n.data("ejNumericTextbox");this.formatDropdown=t.data("BoldBIDashboardDropDownList");this.startDatePicker=i.data("BoldBIDashboardDatePicker");this.endDatePicker=r.data("BoldBIDashboardDatePicker");this.customTextBox=l.data("BoldBIDashboardMaskEdit")},n.prototype.renderDateOptionsContainer=function(n){var i=BoldBIDashboard.buildTag("div.e-dashboarddesigner-relative-filter-toolbar","",{height:"20px",margin:"5px","margin-right":"2px"},{}),s=BoldBIDashboard.buildTag("span","Date Options",{float:"left"},{}),r=this.upIcon=BoldBIDashboard.buildTag("span.e-icon bbi-widgeticon bbi-dashboarddesigner-up-arrow bbi-dbrd-designer-hoverable","",{float:"right","font-size":"14px",width:"30px",height:"100%","line-height":"20px"},{id:this.id+"_relative_dates_up_icon","data-tooltip":"Move Up"}),u=this.downIcon=BoldBIDashboard.buildTag("span.e-icon bbi-widgeticon bbi-dashboarddesigner-down-arrow bbi-dbrd-designer-hoverable","",{float:"right","font-size":"14px",width:"30px",height:"100%","line-height":"20px"},{id:this.id+"_relative_dates_down_icon","data-tooltip":"Move Down"}),f=this.deleteIcon=BoldBIDashboard.buildTag("span.e-icon bbi-widgeticon bbi-designer-toolbar-delete bbi-dbrd-designer-hoverable","",{float:"right","font-size":"14px","padding-right":"3px",width:"30px",height:"100%","line-height":"20px",cursor:"pointer"},{id:this.id+"_relative_dates_delete_icon","data-tooltip":"Delete"}),e=this.editIcon=BoldBIDashboard.buildTag("span.e-icon bbi-widgeticon bbi-designer-parameter-edit bbi-dbrd-designer-hoverable","",{float:"right","font-size":"14px",width:"30px",height:"100%","line-height":"20px",cursor:"pointer"},{id:this.id+"_relative_dates_edit_icon","data-tooltip":"Edit"}),o=this.containerDiv=BoldBIDashboard.buildTag("div","",{"margin-left":"5px"},{id:this.id+"_relative_dates_display_container_div"}),t=BoldBIDashboard.buildTag("ul","",{},{id:this.id+"_relative_dates_display_container"}),h=BoldBIDashboard.buildTag("span","",{float:"right",height:"21px",width:"1px",background:"gray","margin-right":"3px","margin-left":"3px"},{id:this.id+"_relative_separator"});o.append(t);i.append(s).append(f,e,h,r,u);n.append(i).append(o);e.bind("click",this.bbdesigner$.proxy(this.editDateListInfo,this));f.bind("click",this.bbdesigner$.proxy(this.deleteDateListInfo,this));r.bind("click",this.bbdesigner$.proxy(this.moveUpDateListInfo,this));u.bind("click",this.bbdesigner$.proxy(this.moveDownDateListInfo,this));t.BoldBIDashboardListBox({height:"216px",width:"466px",fields:{text:"DisplayText",value:"DisplayText"},dataSource:[],showRoundedCorner:!0,cssClass:"bbi-designer-param-assign bbi-designer-border bbi-dbrd-control",create:this.bbdesigner$.proxy(this.createScrollBar,this),change:this.bbdesigner$.proxy(this.getPreviewDateRangeForSelectedItems,this),select:this.bbdesigner$.proxy(this.disableUpandDownArrow,this)});this.listBoxContent=t.data("BoldBIDashboardListBox")},n.prototype.createScrollBar=function(){this.bbdesigner$(this.relativeDatesDialog.find("#"+this.id+"_relative_dates_display_container").BoldBIDashboardListBox("instance").listContainer).BoldBIDashboardScroller({enableTouchScroll:!1,autoHide:!0,buttonSize:this.dashboardDesigner.scrollerSize.buttonSize,scrollerSize:this.dashboardDesigner.scrollerSize.scrollSize,cssClass:"bbi-dbrd-designer-scroller bbi-dbrd-control"})},n.prototype.disableUpandDownArrow=function(n){n.isSelected&&(n.model.dataSource.length===1?(this.upIcon.addClass("bbi-relativedate-filter-icon-disable").attr("disabled","disabled"),this.downIcon.addClass("bbi-relativedate-filter-icon-disable").attr("disabled","disabled")):n.index===0&&n.model.dataSource.length>1?(this.upIcon.addClass("bbi-relativedate-filter-icon-disable").attr("disabled","disabled"),this.downIcon.removeClass("bbi-relativedate-filter-icon-disable").removeAttr("disabled")):n.index===n.model.dataSource.length-1?(this.downIcon.addClass("bbi-relativedate-filter-icon-disable").attr("disabled","disabled"),this.upIcon.removeClass("bbi-relativedate-filter-icon-disable").removeAttr("disabled")):(this.upIcon.removeClass("bbi-relativedate-filter-icon-disable").removeAttr("disabled"),this.downIcon.removeClass("bbi-relativedate-filter-icon-disable").removeAttr("disabled")))},n.prototype.moveUpDateListInfo=function(n){BoldBIDashboard.isNullOrUndefined(this.bbdesigner$(n.currentTarget).attr("disabled"))&&(this.listBoxContent.moveUp(),this.swapData(this.listBoxContent.model.selectedIndex,this.listBoxContent.model.selectedIndex-1),this.disableUpandDownArrow({isSelected:!0,index:--this.listBoxContent.model.selectedIndex,model:this.listBoxContent.model}))},n.prototype.moveDownDateListInfo=function(n){BoldBIDashboard.isNullOrUndefined(this.bbdesigner$(n.currentTarget).attr("disabled"))&&(this.listBoxContent.moveDown(),this.swapData(this.listBoxContent.model.selectedIndex,this.listBoxContent.model.selectedIndex+1),this.disableUpandDownArrow({isSelected:!0,index:++this.listBoxContent.model.selectedIndex,model:this.listBoxContent.model}))},n.prototype.swapData=function(n,t){if(n!==-1&&t!==-1){var i=this.listBoxContent.model.dataSource[n];this.listBoxContent.model.dataSource[n]=this.listBoxContent.model.dataSource[t];this.listBoxContent.model.dataSource[t]=i}},n.prototype.editDateListInfo=function(){var n=this.listBoxContent.model.selectedIndex;BoldBIDashboard.isNullOrUndefined(n)||(this.populateDateListInfo(this.listBoxContent.model.dataSource[n],!0),this.showUpdateButton(!0),this.disableDateOptionsContainer(!0))},n.prototype.deleteDateListInfo=function(){var n=this.listBoxContent.model.selectedIndex;BoldBIDashboard.isNullOrUndefined(n)||(this.listBoxContent.removeItemByIndex(n),this.relativeDateList=this.listBoxContent.model.dataSource,this.listBoxContent.model.dataSource.length>0?(this.listBoxContent.selectItemByIndex(0),this.disableApplyButton(!1)):(this.disableToobarIcons(!0),this.disableApplyButton(!0)))},n.prototype.updateRelativeDateInfo=function(){var f=this.periodDropdown.getSelectedValue(),r=!1,u=f==="Custom",t,n,i;u&&(t=this.customTextBox.get_UnstrippedValue(),r=BoldBIDashboard.isNullOrUndefined(t)||t.length===0);r?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.relativeDateOptions,this.locale.relativeDateMessages.relativeRangeNotEmpty,IconType.errors,AlertType.Alert,!1,""):(n=this.getRelativeDateInfo(),BoldBIDashboard.isNullOrUndefined(n)?(this.disableDateOptionsContainer(!1),this.showUpdateButton(!1)):(i=this.listBoxContent.model.selectedIndex,this.isExistDateInfo(n,i)?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.relativeDateOptions,this.locale.relativeDateMessages.itemExist,IconType.warning,AlertType.Alert,!1,""):(this.resetCustomValues(u),this.listBoxContent.model.dataSource[i]=n,this.listBoxContent.refresh(!0),this.relativeDateList=this.listBoxContent.model.dataSource,this.disableDateOptionsContainer(!1),this.showUpdateButton(!1),this.disableApplyButton(!1),this.previewTag[0].innerText===""&&this.getPreviewDateRangeForSelectedItems())))},n.prototype.cancelDateInfoUpdation=function(){var n=this.periodDropdown.getSelectedValue();this.resetCustomValues(n==="Custom");this.showUpdateButton(!1);this.disableDateOptionsContainer(!1)},n.prototype.appendRelativeDateList=function(){var i=this.periodDropdown.getSelectedValue(),n,t;BoldBIDashboard.isNullOrUndefined(this.customTextBox.get_UnstrippedValue())?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.relativeDateOptions,this.locale.dataSource.emptyName,IconType.errors,AlertType.Alert,!1,""):(n=this.getRelativeDateInfo(),BoldBIDashboard.isNullOrUndefined(n)||(this.isExistDateInfo(n)?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.relativeDateOptions,this.locale.relativeDateMessages.itemExist,IconType.warning,AlertType.Alert,!1,""):(i==="Custom"&&this.resetCustomValues(!0),this.listBoxContent.model.dataSource.length===0&&this.disableApplyButton(!1),t=this.listBoxContent.model.dataSource.length===0,this.listBoxContent.addItem(n,this.listBoxContent.model.dataSource.length),this.relativeDateList=this.listBoxContent.model.dataSource,this.listBoxContent.selectItemByIndex(t?0:this.listBoxContent.model.selectedIndex),this.disableUpandDownArrow({isSelected:!0,index:this.listBoxContent.model.selectedIndex||0,model:this.listBoxContent.model}),this.disableToobarIcons(!1),this.previewTag[0].innerText===""&&this.getPreviewDateRangeForSelectedItems())))},n.prototype.isExistDateInfo=function(n,t){for(var r,f,u,i=0;i<this.relativeDateList.length;i++){if(r=!1,BoldBIDashboard.isNullOrUndefined(t)||t!==i||(r=!0),f=this.relativeDateList[i],u=f.DisplayText===n.DisplayText,u&&r)return!1;if(u&&!r)return!0}return!1},n.prototype.resetCustomValues=function(n){var t=(BoldBIDashboard.isNullOrUndefined(this.bbdesigner$(this.periodDropdown.element).attr("disabled"))?this.periodDropdown.getSelectedValue():"")+" "+(BoldBIDashboard.isNullOrUndefined(this.bbdesigner$(this.rangeTextBox.element).attr("disabled"))?this.rangeTextBox.getValue():"")+" "+(BoldBIDashboard.isNullOrUndefined(this.bbdesigner$(this.formatDropdown.element).attr("disabled"))?this.formatDropdown.model.text:"");this.customTextBox.setModel({value:n?"":t});this.startDatePicker.setModel({value:""});this.endDatePicker.setModel({value:""})},n.prototype.dateComparison=function(n,t){var i=Date.parse(n),r=Date.parse(t);return i>r},n.prototype.getPreviewDateRangeForSelectedItems=function(){var n=this.listBoxContent.model,i,r,t;if(BoldBIDashboard.isNullOrUndefined(this.queryDesigner)||BoldBIDashboard.isNullOrUndefined(this.queryDesigner.dataset)?(r=this.dashboardDesigner.designerPanel.selectedReportItems[0],i=BoldBIDashboard.Dashboard.WidgetHelper.getWidgetInstance(r).DataGroupInfo.DataSourceID):i=this.queryDesigner.dataset.Id,!BoldBIDashboard.isNullOrUndefined(n.dataSource)&&n.dataSource.length>1&&!BoldBIDashboard.isNullOrUndefined(n.selectedText)&&n.selectedText!=="")for(t=0;t<n.dataSource.length;t++)n.selectedText===n.dataSource[t].DisplayText&&this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.FilterAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,fieldInfo:n.dataSource[t],dataSetId:i,type:"date",dateRangeType:"RelativeDate",isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.updatePreviewDateRange,this)});else!BoldBIDashboard.isNullOrUndefined(n.dataSource)&&n.dataSource.length>0&&this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.FilterAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,fieldInfo:n.dataSource[0],dataSetId:i,type:"date",dateRangeType:"RelativeDate",isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.updatePreviewDateRange,this)})},n.prototype.getPreviewDateRange=function(){var t,n,u;if(!BoldBIDashboard.isNullOrUndefined(this.startDatePicker)&&!BoldBIDashboard.isNullOrUndefined(this.endDatePicker)&&!BoldBIDashboard.isNullOrUndefined(this.periodDropdown)){var i=this.startDatePicker.getValue(),f=this.endDatePicker.getValue(),r=this.periodDropdown.getSelectedValue(),e=(BoldBIDashboard.isNullOrUndefined(this.bbdesigner$(this.periodDropdown.element).attr("disabled"))?this.periodDropdown.getSelectedValue():"")+" "+(BoldBIDashboard.isNullOrUndefined(this.bbdesigner$(this.rangeTextBox.element).attr("disabled"))?this.rangeTextBox.getValue():"")+" "+(BoldBIDashboard.isNullOrUndefined(this.bbdesigner$(this.formatDropdown.element).attr("disabled"))?this.formatDropdown.model.text:"");r==="Custom"?this.customTextBox.setModel({value:"",watermarkText:"Custom date range"}):this.customTextBox.setModel({value:e});r==="Custom"&&BoldBIDashboard.isNullOrUndefined(i)||!BoldBIDashboard.isNullOrUndefined(i)&&BoldBIDashboard.isNullOrUndefined(f)?this.previewTag.text(""):(t=this.getRelativeDateInfo(),BoldBIDashboard.isNullOrUndefined(t)?this.previewTag.text(""):(n=void 0,BoldBIDashboard.isNullOrUndefined(this.queryDesigner)||BoldBIDashboard.isNullOrUndefined(this.queryDesigner.dataset)?(u=this.dashboardDesigner.designerPanel.selectedReportItems[0],n=BoldBIDashboard.Dashboard.WidgetHelper.getWidgetInstance(u).DataGroupInfo.DataSourceID):n=this.queryDesigner.dataset.Id,this.dashboardDesigner.modules.util.doAjaxPost("POST",this.dashboardDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.FilterAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.getDateRange,fieldInfo:t,dataSetId:n,type:"date",dateRangeType:"RelativeDate",isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.updatePreviewDateRange,this)})))}},n.prototype.updatePreviewDateRange=function(n){var t=null;BoldBIDashboard.isNullOrUndefined(n)||BoldBIDashboard.isNullOrUndefined(n.DateRange)?this.previewTag.text(""):(t=BoldBIDashboard.isNullOrUndefined(n.DateRange.StartDateTime)||BoldBIDashboard.isNullOrUndefined(n.DateRange.EndDateTime)?n.DateRange.StartDate.length>0?n.DateRange.StartDate+" to "+n.DateRange.EndDate:n.DateRange.EndDate:n.DateRange.StartDateTime+" to "+n.DateRange.EndDateTime,this.previewTag.text(t))},n.prototype.getRelativeDateInfo=function(){var n=this.formatDropdown.getSelectedValue(),t=this.periodDropdown.getSelectedValue();return t==="Custom"?this.getCustomDateInfo("Year"):n==="Year to date"?this.getTillNowDateInfo("Year",n):n==="Quarter to date"?this.getTillNowDateInfo("Quarter",n):n==="Month to date"?this.getTillNowDateInfo("Month",n):n==="Week to date"?this.getTillNowDateInfo("Week",n):this.getPeriodBasedDateInfo(n)},n.prototype.getCustomDateInfo=function(n){var t=null,i=this.startDatePicker.getValue(),r=this.endDatePicker.getValue(),f=this.customTextBox.get_UnstrippedValue(),u=" 12:00:00 AM";return!BoldBIDashboard.isNullOrUndefined(i)&&!BoldBIDashboard.isNullOrUndefined(r)&&i.length>0&&r.length>0?this.dateComparison(i,r)?this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.relativeDateOptions,this.locale.relativeDateMessages.startDateNotLessEndDate,IconType.errors,AlertType.Alert,!1,""):(t=new RelativeDateFilterOptions,t.DisplayText=f,t.IsCustomRange=!0,t.Filter.RelativeDateFormat=BoldBIDashboard.DashboardDesignerUtility.Serialization.stringtoEnum(RelativeDateFormat,n),t.Filter.DateInstance=DateInstance.Custom,t.Filter.Range=0,t.Filter.StartDate=i+u,t.Filter.EndDate=r+u):this.dashboardDesigner.modules.util.alertDialog(this.locale.alertDialogTitle.relativeDateOptions,this.locale.relativeDateMessages.dateNotEmpty,IconType.errors,AlertType.Alert,!1,""),t},n.prototype.getPeriodBasedDateInfo=function(n){var f,i=new RelativeDateFilterOptions,e=this.periodDropdown.getListData(),t=e[this.periodDropdown.model.selectedIndex].dateInstance,r=t===DateInstance.Last||t===DateInstance.Next||t===DateInstance.Past||t===DateInstance.Upcoming,u=r?this.rangeTextBox.getValue():1,o=this.formatDropdown.model.dataSource[this.formatDropdown.model.selectedIndex].text;return f=n.toLowerCase()==="day"&&t===DateInstance.Current?this.periodDropdown.model.value:t+" "+(r?u:"")+" "+o,i.DisplayText=this.customTextBox.get_UnstrippedValue(),i.Filter.RelativeDateFormat=BoldBIDashboard.DashboardDesignerUtility.Serialization.stringtoEnum(RelativeDateFormat,n),i.Filter.DateInstance=t,i.Filter.Range=u,i},n.prototype.getTillNowDateInfo=function(n){var t=new RelativeDateFilterOptions;return t.DisplayText=this.customTextBox.get_UnstrippedValue(),t.Filter.RelativeDateFormat=BoldBIDashboard.DashboardDesignerUtility.Serialization.stringtoEnum(RelativeDateFormat,n),t.Filter.DateInstance=DateInstance.TillNow,t},n.prototype.changeCustomValue=function(n){var t=BoldBIDashboard.isNullOrUndefined(n.value)||n.value===0},n.prototype.changeFormatType=function(n){if(!BoldBIDashboard.isNullOrUndefined(n)&&n.value.length>0){var t=n.value,i=this.periodDropdown.model.value,r=BoldBIDashboard.isNullOrUndefined(this.periodDropdown.model.selectedIndex)?1:this.periodDropdown.model.selectedIndex;this.periodDropdown.setModel({dataSource:this.periodTypeList(t==="Day")});this.periodDropdown.selectItemsByIndices(r);t==="Year to date"||t==="Quarter to date"||t==="Month to date"||t==="Week to date"?(this.disablePeriodDropdown(!0),this.rangeTextBox.disable()):(this.disablePeriodDropdown(!1),this.rangeTextBox.enable());(i==="Today"||i==="Current")&&this.rangeTextBox.disable()}this.getPreviewDateRange()},n.prototype.changePeriodType=function(n){if(!BoldBIDashboard.isNullOrUndefined(n)&&n.text.length>0){var t=n.text,i=t==="Custom";this.showFormatDropdown(!i);t==="Last"||t==="Next"||t==="Past"||t==="Upcoming"?this.rangeTextBox.enable():this.rangeTextBox.disable()}this.getPreviewDateRange()},n.prototype.disableToobarIcons=function(n){n?(this.deleteIcon.addClass("bbi-relativedate-filter-icon-disable").attr("disabled","disabled"),this.editIcon.addClass("bbi-relativedate-filter-icon-disable").attr("disabled","disabled"),this.upIcon.addClass("bbi-relativedate-filter-icon-disable").attr("disabled","disabled"),this.downIcon.addClass("bbi-relativedate-filter-icon-disable").attr("disabled","disabled")):(this.deleteIcon.removeClass("bbi-relativedate-filter-icon-disable").removeAttr("disabled"),this.editIcon.removeClass("bbi-relativedate-filter-icon-disable").removeAttr("disabled"))},n.prototype.disableDateOptionsContainer=function(n){n?this.listBoxContent.disable():this.listBoxContent.enable();this.disableToobarIcons(n)},n.prototype.showUpdateButton=function(n){n?(this.confirmationTd.css("display","block"),this.addButtonTd.css("display","none")):(this.addButtonTd.css("display","block"),this.confirmationTd.css("display","none"))},n.prototype.showFormatDropdown=function(n){n?(this.rangeTextBoxTd.css("display","block"),this.formatDropdownTd.css("display","block"),this.startDateTd.css("display","none"),this.endDateTd.css("display","none")):(this.rangeTextBoxTd.css("display","none"),this.formatDropdownTd.css("display","none"),this.startDateTd.css("display","block"),this.endDateTd.css("display","block"))},n.prototype.disableAddButton=function(n){n?BoldBIDashboard.DashboardUtil.buttonEnable(this.addBtnTag,!1):BoldBIDashboard.DashboardUtil.buttonEnable(this.addBtnTag,!0)},n.prototype.disableApplyButton=function(n){n?BoldBIDashboard.DashboardUtil.buttonEnable(this.applyButton,!1):BoldBIDashboard.DashboardUtil.buttonEnable(this.applyButton,!0)},n.prototype.disablePeriodDropdown=function(n){n?(this.periodDropdown.disable(),this.rangeTextBox.disable()):(this.periodDropdown.enable(),this.rangeTextBox.enable())},n.prototype.populateDateListInfo=function(n,t){var i=n.Filter,e=i.DateInstance===DateInstance.TillNow,o=i.DateInstance===DateInstance.Custom,s=i.RelativeDateFormat+(e?" to date":""),r=null,f,u;if(this.formatDropdown.selectItemByValue(s),e||o)e?r="Last":o&&(r="Custom");else for(f=this.periodDropdown.getListData(),u=0;u<f.length;u++)i.DateInstance===f[u].dateInstance&&(r=f[u].text);this.periodDropdown.selectItemByText(r);this.rangeTextBox.setModel({value:i.Range===0?1:i.Range});o?(this.startDatePicker.setModel({value:new Date(i.StartDate)}),this.endDatePicker.setModel({value:new Date(i.EndDate)}),this.customTextBox.setModel({value:n.DisplayText})):(this.startDatePicker.setModel({value:""}),this.endDatePicker.setModel({value:""}),this.customTextBox.setModel({value:t?n.DisplayText:r+" "+this.rangeTextBox.getValue()+" "+this.formatDropdown.model.text}))},n.prototype.populateRelativeDateInfo=function(n){n.length>0&&(this.listBoxContent.setModel({dataSource:n}),this.listBoxContent.selectItemByIndex(0),this.disableUpandDownArrow({isSelected:!0,index:0,model:this.listBoxContent.model}),this.populateDateListInfo(n[0]),this.disableToobarIcons(!1))},n.prototype.applyRelativeDateInfo=function(){BoldBIDashboard.isNullOrUndefined(this.targetInstance)||(BoldBIDashboard.DashboardUtil.invokeMethod(this.targetInstance,this.targetMethod,[this.bbdesigner$.extend([],!0,this.relativeDateList)]),this.closeRelativeDateInfo())},n.prototype.openRelativeDatesDialog=function(n,t,i){this.relativeDatesDialog.data("BoldBIDashboardDialog").open();this.resetRelativeDateDialog();this.targetInstance=n;this.targetMethod=t;!BoldBIDashboard.isNullOrUndefined(i)&&i.length>0?(this.relativeDateList=i,this.populateRelativeDateInfo(i)):(this.formatDropdown.setModel({selectedIndex:0}),this.disableApplyButton(!0));this.previewTag[0].innerText===""&&this.getPreviewDateRangeForSelectedItems()},n.prototype.resetRelativeDateDialog=function(){this.targetInstance=null;this.targetMethod=null;this.relativeDateList=[];this.listBoxContent.setModel({dataSource:[]});this.rangeTextBox.setModel({value:1});this.disableToobarIcons(!0);this.listBoxContent.enable();this.showFormatDropdown(!0);this.showUpdateButton(!1);this.formatDropdown.setModel({selectedIndex:0});this.periodDropdown.setModel({selectedIndex:1});this.resetCustomValues(!1)},n.prototype.closeRelativeDateInfo=function(){this.relativeDatesDialog.data("BoldBIDashboardDialog").close()},n.prototype.destroy=function(){BoldBIDashboard.DashboardUtil.destroyEjObjects(this.dashboardDesigner.element.find("#"+this.id+"_relative_dates"));this.dashboardDesigner.element.find("#"+this.id+"_relative_dates").length>0&&this.dashboardDesigner.element.find("#"+this.id+"_relative_dates").remove()},n.prototype.periodTypeList=function(n){return[{text:n?"Today":"Current",value:n?"Today":"Current",dateInstance:DateInstance.Current},{text:"Last",value:"Last",dateInstance:DateInstance.Last},{text:"Next",value:"Next",dateInstance:DateInstance.Next},{text:"Past",value:"Past",dateInstance:DateInstance.Past},{text:"Upcoming",value:"Upcoming",dateInstance:DateInstance.Upcoming},{text:"Custom",value:"Custom",dateInstance:DateInstance.Custom}]},n.prototype.formatTypeList=function(){return[{text:"Year(s)",value:"Year"},{text:"Quarter(s)",value:"Quarter"},{text:"Month(s)",value:"Month"},{text:"Week",value:"Week"},{text:"Day(s)",value:"Day"},{text:"Hour",value:"Hour"},{text:"Minute",value:"Minute"},{text:"Year to date",value:"Year to date"},{text:"Quarter to date",value:"Quarter to date"},{text:"Month to date",value:"Month to date"},{text:"Week to date",value:"Week to date"}]},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.RelativeDates",InternalRelativeDates,window);InternalSharedDSMenu=function(){function n(n){this.dashboardDesigner=null;this.locale=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.locale=n.getLocalizationContent();this.id=this.dashboardDesigner._id+"_shared_ds_menu";this.renderSharedDataSourceDetailsMenu()}return n.prototype.renderSharedDataSourceDetailsMenu=function(){var t,n;this.menu=this.bbdesigner$("<ul id ="+this.id+" class = 'bbi-sharedtabledetailsmenu'><\/ul>");t="<li id ="+this.id+"_owner_details_header class = 'e-sharedtable-ownername-header bbi-sharedtable-header'><a class = 'e-sharedtable-ownername-headertxt bbi-sharedtable-menuheader-txt'>"+this.locale.sharedDSMenu.ownerNameHeader+"<a><li><li id ="+this.id+"_owner_name class = 'e-sharedtable-ownername'><a class = 'e-sharedtable-ownername-txt e-sharedtable-details-txt'><a><li><li id ="+this.id+"_ds_lastupdate_details_header class = 'e-sharedtable-updatetime-header bbi-sharedtable-header'><a class = 'e-sharedtable-updatetime-headertxt bbi-sharedtable-menuheader-txt'>"+this.locale.sharedDSMenu.LasteUpdatedTimeHeader+"<a><li><li id ="+this.id+"_ds_lastupdate_details class = 'e-sharedtable-updatetime'><a class = 'e-sharedtable-updatetime-txt e-sharedtable-details-txt'><a><li>";this.menu.append(t);this.menu.BoldBIDashboardMenu({width:180,height:140,container:"#"+this.dashboardDesigner._id,menuType:BoldBIDashboard.MenuType.ContextMenu,cssClass:"bbi-designer-menu"});n=this.menu.data("BoldBIDashboardMenu");n.option("disableItemByID",this.id+"_owner_details_header");n.option("disableItemByID",this.id+"_ds_lastupdate_details_header")},n.prototype.populateMenuDetails=function(n){this.menu.attr("data-dsId",n.Id);this.menu.find(".e-sharedtable-ownername-txt").text(n.OwnerName);this.menu.find(".e-sharedtable-updatetime-txt").text(n.DsLastUpdatedTime)},n.prototype.openSharedDSMenu=function(n,t,i){var r,u;this.populateMenuDetails(n);r=this.menu.data("BoldBIDashboardMenu");r.option("contextMenuTarget",t.find(".bbi-sharedtable-menu-icon"));u=this.dashboardDesigner.element.height()-i.clientY>140?i.clientY:i.clientY-140;r.show(i.clientX,u,t.find(".bbi-sharedtable-menu-icon"),i)},n.prototype.destroy=function(){var n=this.menu.data("BoldBIDashboardMenu");n.destroy();BoldBIDashboard.DashboardUtil.destroyEjObjects(this.dashboardDesigner.element.find("#"+this.id));this.dashboardDesigner.element.find("#"+this.id).remove()},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.SharedDSMenu",InternalSharedDSMenu,window),function(n){var t=function(){function t(n,t,i){this.id=n;this.element=t;this.designer=i}return t.prototype.render=function(t){var r,u,i,f;n.isNullOrUndefined(this.designer.model.datasource)||(r=36,u=240,this.designerContainer=n.buildTag("div.bbi-dashboard-designer boldbi-dashboarddesigner","",{height:"100%","box-sizing":"border-box"},{id:this.id+"_designerContainer"}),i=this.designAreaTag=n.buildTag("div.bbi-dashboard-designer bbi-userselect bbi-dashboarddesigner-designAreaContainer","",{},{id:this.id+"_designAreaContainer"}),this.itemPanelTag=n.buildTag("div.bbi-dbrd-designer-item-panel","",{width:u+"px"},{id:this.id+"_itemPanelContainer"}),this.designPanelTag=n.buildTag("div.bbi-dashboarddesigner-surfaceContainer","",{width:t,border:"0px solid var(--designer-primary-border-color)","border-left-width":"1px",height:"100%",float:"left","background-color":this.designer.modules.themeHelper.getSurfaceContainerBackground(),"box-sizing":"border-box"},{id:this.id+"_designSurfaceContainer"}),f=this.dataPanelTag=n.buildTag("div","",{width:r+"px",height:"100%",float:"right","box-sizing":"border-box","background-color":"white"},{id:this.id+"_dataPanelContainer"}),this.element.append(this.designerContainer),this.renderToolBar(this.designerContainer,t),i.append(f),this.designerContainer.append(i))},t.prototype.renderToolBar=function(t,i){this.designer.rptToolbar=new n.DashboardDesignerUtility.Toolbar(this.designer,t);this.designer.rptToolbar.renderToolBar(t,40,i)},t.prototype.postRender=function(){var r,t,i;new n.DashboardDesignerUtility.OAuthHelper(this.designer);r=this.designer.modules.dataSet;t=this.designer.modules.dataConfigurationPanel;t.resizeConfigurationPanel(!0);t.showDataConfigurationPanel();t.loadDataSet();r.switchPanel(PanelList.QueryBuilder);i=this.designer.model.datasource;n.isNullOrUndefined(this.designer.model.dataSourceVersion)||(i=i+"/"+this.designer.model.dataSourceVersion);this.designer.modules.util.doAjaxPost("POST",this.designer.model.serviceUrl+n.Dashboard.ServiceAPI.importconnection+i,{action:n.DashboardUtil.DesignerAction.ImportDatasources},{fnction:this.designer.bbdesigner$.proxy(this.designer.renderQueryDesigner,this.designer),indicator:[this.designer.bbdesigner$.proxy(this.designer.showDesignIndicator,this.designer),this.designer.bbdesigner$.proxy(this.designer.hideDesignIndicator,this.designer)]},!1,!0)},t.prototype.renderCanvas=function(){this.designCanvas=n.buildTag("div.bbi-dashboarddesigner-designcanvas","",{"box-sizing":"border-box",position:"relative",margin:"0 auto"},{id:this.id+"_designCanvas",tabindex:"0"});this.canvasContainer=n.buildTag("div.bbi-dbrd-designcanvas-container bbi-dbrd-designcanvas-scroller","",{width:"100%",height:"100%",overflow:"auto","box-sizing":"border-box","background-color":this.designer.modules.themeHelper.getSurfaceContainerBackground()},{id:this.id+"_scrollContentDesignPanel"});this.scrollUIItem=n.buildTag("div.bbi-dbrd-scroll-ui-container","",{},{})},t.prototype.setContainerSize=function(){},t.prototype.previewDashboard=function(){},t.prototype.renderCells=function(){},t.prototype.renderCellsForExport=function(){},t.prototype.updateSizeForScrollExport=function(){},t.prototype.resizeCombineWidgetForWidgetExport=function(){},t.prototype.wireEvents=function(){},t.prototype.unwireEvents=function(){},t}();n.DataSourceMode=t}(BoldBIDashboard||(BoldBIDashboard={}));InternalProgressIndicator=function(){function n(n){this.elements=[];BoldBIDashboard.isNullOrUndefined(n)||(this.bbdesigner$=BoldBIDashboardDesigner.bbdesignerstatic$,this.elements=n.progressIndicatorInfoList,this.cursorIndex=n.cursorIndex,this.cursor=n.cursor)}return n.prototype.appendProgressContainer=function(n,t,i,r){var u=BoldBIDashboard.buildTag("div","",{},{id:this.targetId+"_"+t.name}).addClass(i>r?"completed bbi-dbrd-progress-container":i===r?"selected bbi-dbrd-progress-container":"bbi-dbrd-progress-container"),f=BoldBIDashboard.buildTag("div.bbi-dbrd-progress-icon-container","",{},{id:this.targetId+"_iconcontainer_"+t.name}),e=BoldBIDashboard.buildTag("div.bbi-dbrd-progress-label-container",t.displayText,{},{id:this.targetId+"_labelcontainer_"+t.name}).attr("title",t.displayText);u.append(f,e);n.append(u)},n.prototype.appendSplitter=function(n){var t=BoldBIDashboard.buildTag("div.bbi-dbrd-progress-splitter","",{},{});n.append(t)},n.prototype.appendBreadCrumb=function(n){var r,i,t;if(!BoldBIDashboard.isNullOrUndefined(n)){for(this.targetId=n.attr("id"),this.targetElement=n,i=BoldBIDashboard.buildTag("div.bbi-dbrd-breadcrumb-inner-container","",{},{id:this.targetId+"_breadcrumbcontainer"}),BoldBIDashboard.isNullOrUndefined(this.cursor)||(r=this.getSelectedElementIndex(this.cursor)),t=0;t<this.elements.length;t++)this.appendProgressContainer(i,this.elements[t],r>-1?r:this.cursorIndex,t),this.elements.length>t+1&&this.appendSplitter(i);n.append(i).data("progress-indicator",this)}},n.prototype.getSelectedElementIndex=function(n){var t=-1;return this.elements.filter(function(i,r){if(i.name===n||i.id===n){t=r;return}}),t},n.prototype.updateSelection=function(n){var i=this.bbdesigner$(this.targetElement).find(".bbi-dbrd-progress-container"),t;this.bbdesigner$(i).removeClass("completed selected");t=this.bbdesigner$(i)[n];this.bbdesigner$(t).addClass("selected");this.bbdesigner$(t).prevAll(".bbi-dbrd-progress-container").addClass("completed")},n.prototype.updateCursor=function(n){var t=this.getSelectedElementIndex(n);this.elements.length>t&&t!==-1&&(this.cursor=n,this.updateSelection(t))},n.prototype.updateCursorIndex=function(n){this.elements.length>n&&n!==-1&&(this.cursorIndex=n,this.updateSelection(n))},n}();window.BoldBIDashboard.createObject("BoldBIDashboard.DashboardDesignerUtility.ProgressIndicator",InternalProgressIndicator,window),function(n){var t;(function(n){var i=function(){function n(){}return n}(),t;n.ProgressIndicatorCollection=i;t=function(){function n(){}return n}();n.ProgressIndicatorInfo=t})(t=n.Designer||(n.Designer={}))}(BoldBIDashboard||(BoldBIDashboard={})),function(n,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):n.CodeMirror=t()}(this,function(){"use strict";function uf(n){return new RegExp("(^|\\s)"+n+"(?:$|\\s)\\s*")}function ai(n){for(var t=n.childNodes.length;t>0;--t)n.removeChild(n.firstChild);return n}function ct(n,t){return ai(n).appendChild(t)}function i(n,t,i,r){var u=document.createElement(n),f;if(i&&(u.className=i),r&&(u.style.cssText=r),typeof t=="string")u.appendChild(document.createTextNode(t));else if(t)for(f=0;f<t.length;++f)u.appendChild(t[f]);return u}function nu(n,t,r,u){var f=i(n,t,r,u);return f.setAttribute("role","presentation"),f}function vi(n,t){if(t.nodeType==3&&(t=t.parentNode),n.contains)return n.contains(t);do if(t.nodeType==11&&(t=t.host),t==n)return!0;while(t=t.parentNode)}function fi(){var n;try{n=document.activeElement}catch(t){n=document.body||null}while(n&&n.shadowRoot&&n.shadowRoot.activeElement)n=n.shadowRoot.activeElement;return n}function tr(n,t){var i=n.className;uf(t).test(i)||(n.className+=(i?" ":"")+t)}function ys(n,t){for(var r=n.split(" "),i=0;i<r.length;i++)r[i]&&!uf(r[i]).test(t)&&(t+=" "+r[i]);return t}function ps(n){var t=Array.prototype.slice.call(arguments,1);return function(){return n.apply(null,t)}}function ir(n,t,i){t||(t={});for(var r in n)n.hasOwnProperty(r)&&(i!==!1||!t.hasOwnProperty(r))&&(t[r]=n[r]);return t}function at(n,t,i,r,u){var f,e,o;for(t==null&&(t=n.search(/[^\s\u00a0]/),t==-1&&(t=n.length)),f=r||0,e=u||0;;){if(o=n.indexOf("\t",f),o<0||o>=t)return e+(t-f);e+=o-f;e+=i-e%i;f=o+1}}function d(n,t){for(var i=0;i<n.length;++i)if(n[i]==t)return i;return-1}function ws(n,t,i){for(var r,e,u=0,f=0;;){if(r=n.indexOf("\t",u),r==-1&&(r=n.length),e=r-u,r==n.length||f+e>=t)return u+Math.min(e,t-f);if(f+=r-u,f+=i-f%i,u=r+1,f>=t)return u}}function bs(n){while(ae.length<=n)ae.push(s(ae)+" ");return ae[n]}function s(n){return n[n.length-1]}function no(n,t){for(var r=[],i=0;i<n.length;i++)r[i]=t(n[i],i);return r}function ik(n,t,i){for(var r=0,u=i(t);r<n.length&&i(n[r])<=u;)r++;n.splice(r,0,t)}function gl(){}function na(n,t){var i;return Object.create?i=Object.create(n):(gl.prototype=n,i=new gl),t&&ir(t,i),i}function ks(n){return/\w/.test(n)||n>""&&(n.toUpperCase()!=n.toLowerCase()||cb.test(n))}function to(n,t){return t?t.source.indexOf("\\w")>-1&&ks(n)?!0:t.test(n):ks(n)}function ta(n){for(var t in n)if(n.hasOwnProperty(t)&&n[t])return!1;return!0}function ds(n){return n.charCodeAt(0)>=768&&lb.test(n)}function ia(n,t,i){while((i<0?t>0:t<n.length)&&ds(n.charAt(t)))t+=i;return t}function ff(n,t,i){for(var f=t>i?-1:1,u,r;;){if(t==i)return t;if(u=(t+i)/2,r=f<0?Math.ceil(u):Math.floor(u),r==t)return n(r)?t:i;n(r)?i=r:t=r+f}}function rk(n,t,r){var u=this,f;this.input=r;u.scrollbarFiller=i("div",null,"CodeMirror-scrollbar-filler");u.scrollbarFiller.setAttribute("cm-not-content","true");u.gutterFiller=i("div",null,"CodeMirror-gutter-filler");u.gutterFiller.setAttribute("cm-not-content","true");u.lineDiv=nu("div",null,"CodeMirror-code");u.selectionDiv=i("div",null,null,"position: relative; z-index: 1");u.cursorDiv=i("div",null,"CodeMirror-cursors");u.measure=i("div",null,"CodeMirror-measure");u.lineMeasure=i("div",null,"CodeMirror-measure");u.lineSpace=nu("div",[u.measure,u.lineMeasure,u.selectionDiv,u.cursorDiv,u.lineDiv],null,"position: relative; outline: none");f=nu("div",[u.lineSpace],"CodeMirror-lines");u.mover=i("div",[f],null,"position: relative");u.sizer=i("div",[u.mover],"CodeMirror-sizer");u.sizerWidth=null;u.heightForcer=i("div",null,null,"position: absolute; height: "+nk+"px; width: 1px;");u.gutters=i("div",null,"CodeMirror-gutters");u.lineGutter=null;u.scroller=i("div",[u.sizer,u.heightForcer,u.gutters],"CodeMirror-scroll");u.scroller.setAttribute("tabIndex","-1");u.wrapper=i("div",[u.scrollbarFiller,u.gutterFiller,u.scroller],"CodeMirror");e&&l<8&&(u.gutters.style.zIndex=-1,u.scroller.style.paddingRight=0);tt||ki&&le||(u.scroller.draggable=!0);n&&(n.appendChild?n.appendChild(u.wrapper):n(u.wrapper));u.viewFrom=u.viewTo=t.first;u.reportedViewFrom=u.reportedViewTo=t.first;u.view=[];u.renderedView=null;u.externalMeasured=null;u.viewOffset=0;u.lastWrapHeight=u.lastWrapWidth=0;u.updateLineNumbers=null;u.nativeBarWidth=u.barHeight=u.barWidth=0;u.scrollbarsClipped=!1;u.lineNumWidth=u.lineNumInnerWidth=u.lineNumChars=null;u.alignWidgets=!1;u.cachedCharWidth=u.cachedTextHeight=u.cachedPaddingH=null;u.maxLine=null;u.maxLineLength=0;u.maxLineChanged=!1;u.wheelDX=u.wheelDY=u.wheelStartX=u.wheelStartY=null;u.shift=!1;u.selForContextMenu=null;u.activeTouch=null;r.init(u)}function t(n,t){var i,r,u,f;if(t-=n.first,t<0||t>=n.size)throw new Error("There is no line "+(t+n.first)+" in the document.");for(i=n;!i.lines;)for(r=0;;++r){if(u=i.children[r],f=u.chunkSize(),t<f){i=u;break}t-=f}return i.lines[t]}function rr(n,t,i){var u=[],r=t.line;return n.iter(t.line,i.line+1,function(n){var f=n.text;r==i.line&&(f=f.slice(0,i.ch));r==t.line&&(f=f.slice(t.ch));u.push(f);++r}),u}function gs(n,t,i){var r=[];return n.iter(t,i,function(n){r.push(n.text)}),r}function gt(n,t){var r=t-n.height,i;if(r)for(i=n;i;i=i.parent)i.height+=r}function h(n){var i,u,t,r;if(n.parent==null)return null;for(i=n.parent,u=d(i.lines,n),t=i.parent;t;i=t,t=t.parent)for(r=0;;++r){if(t.children[r]==i)break;u+=t.children[r].chunkSize()}return u+i.first}function ur(n,t){var f=n.first,r,u,e,i,s,o;n:do{for(r=0;r<n.children.length;++r){if(u=n.children[r],e=u.height,t<e){n=u;continue n}t-=e;f+=u.chunkSize()}return f}while(!n.lines);for(i=0;i<n.lines.length;++i){if(s=n.lines[i],o=s.height,t<o)break;t-=o}return f+i}function ef(n,t){return t>=n.first&&t<n.first+n.size}function nh(n,t){return String(n.lineNumberFormatter(t+n.firstLineNumber))}function n(t,i,r){if(r===void 0&&(r=null),!(this instanceof n))return new n(t,i,r);this.line=t;this.ch=i;this.sticky=r}function u(n,t){return n.line-t.line||n.ch-t.ch}function th(n,t){return n.sticky==t.sticky&&u(n,t)==0}function ih(t){return n(t.line,t.ch)}function io(n,t){return u(n,t)<0?t:n}function ro(n,t){return u(n,t)<0?n:t}function ra(n,t){return Math.max(n.first,Math.min(t,n.first+n.size-1))}function f(i,r){if(r.line<i.first)return n(i.first,0);var u=i.first+i.size-1;return r.line>u?n(u,t(i,u).text.length):uk(r,t(i,r.line).text.length)}function uk(t,i){var r=t.ch;return r==null||r>i?n(t.line,i):r<0?n(t.line,0):t}function ua(n,t){for(var r=[],i=0;i<t.length;i++)r[i]=f(n,t[i]);return r}function fk(){ol=!0}function ek(){hi=!0}function uo(n,t,i){this.marker=n;this.from=t;this.to=i}function of(n,t){var i,r;if(n)for(i=0;i<n.length;++i)if(r=n[i],r.marker==t)return r}function ok(n,t){for(var r,i=0;i<n.length;++i)n[i]!=t&&(r||(r=[])).push(n[i]);return r}function sk(n,t){n.markedSpans=n.markedSpans?n.markedSpans.concat([t]):[t];t.marker.attachLine(n)}function hk(n,t,i){var e,u,o;if(n)for(u=0;u<n.length;++u){var r=n[u],f=r.marker,s=r.from==null||(f.inclusiveLeft?r.from<=t:r.from<t);!s&&(r.from!=t||f.type!="bookmark"||i&&r.marker.insertLeft)||(o=r.to==null||(f.inclusiveRight?r.to>=t:r.to>t),(e||(e=[])).push(new uo(f,r.from,o?null:r.to)))}return e}function ck(n,t,i){var e,u,o;if(n)for(u=0;u<n.length;++u){var r=n[u],f=r.marker,s=r.to==null||(f.inclusiveRight?r.to>=t:r.to>t);(s||r.from==t&&f.type=="bookmark"&&(!i||r.marker.insertLeft))&&(o=r.from==null||(f.inclusiveLeft?r.from<=t:r.from<t),(e||(e=[])).push(new uo(f,o?null:r.from-t,r.to==null?null:r.to-t)))}return e}function rh(n,i){var w,b,l,o,a,v,f,tt,y,k,d,h,g;if(i.full||(w=ef(n,i.from.line)&&t(n,i.from.line).markedSpans,b=ef(n,i.to.line)&&t(n,i.to.line).markedSpans,!w&&!b))return null;var nt=i.from.ch,rt=i.to.ch,it=u(i.from,i.to)==0,r=hk(w,nt,it),e=ck(b,rt,it),c=i.text.length==1,p=s(i.text).length+(c?nt:0);if(r)for(l=0;l<r.length;++l)o=r[l],o.to==null&&(a=of(e,o.marker),a?c&&(o.to=a.to==null?null:a.to+p):o.to=nt);if(e)for(v=0;v<e.length;++v)f=e[v],f.to!=null&&(f.to+=p),f.from==null?(tt=of(r,f.marker),tt||(f.from=p,c&&(r||(r=[])).push(f))):(f.from+=p,c&&(r||(r=[])).push(f));if(r&&(r=fa(r)),e&&e!=r&&(e=fa(e)),y=[r],!c){if(k=i.text.length-2,k>0&&r)for(h=0;h<r.length;++h)r[h].to==null&&(d||(d=[])).push(new uo(r[h].marker,null,null));for(g=0;g<k;++g)y.push(d);y.push(e)}return y}function fa(n){for(var t,i=0;i<n.length;++i)t=n[i],t.from!=null&&t.from==t.to&&t.marker.clearWhenEmpty!==!1&&n.splice(i--,1);return n.length?n:null}function lk(n,t,i){var r=null,o,h,c,f,s,e;if(n.iter(t.line,i.line+1,function(n){var t,i;if(n.markedSpans)for(t=0;t<n.markedSpans.length;++t)i=n.markedSpans[t].marker,i.readOnly&&(!r||d(r,i)==-1)&&(r||(r=[])).push(i)}),!r)return null;for(o=[{from:t,to:i}],h=0;h<r.length;++h)for(c=r[h],f=c.find(0),s=0;s<o.length;++s)if(e=o[s],!(u(e.to,f.from)<0)&&!(u(e.from,f.to)>0)){var l=[s,1],a=u(e.from,f.from),v=u(e.to,f.to);(a<0||!c.inclusiveLeft&&!a)&&l.push({from:e.from,to:f.from});(v>0||!c.inclusiveRight&&!v)&&l.push({from:f.to,to:e.to});o.splice.apply(o,l);s+=l.length-3}return o}function ea(n){var i=n.markedSpans,t;if(i){for(t=0;t<i.length;++t)i[t].marker.detachLine(n);n.markedSpans=null}}function oa(n,t){if(t){for(var i=0;i<t.length;++i)t[i].marker.attachLine(n);n.markedSpans=t}}function fo(n){return n.inclusiveLeft?-1:0}function eo(n){return n.inclusiveRight?1:0}function sa(n,t){var r=n.lines.length-t.lines.length,i;if(r!=0)return r;var f=n.find(),e=t.find(),o=u(f.from,e.from)||fo(n)-fo(t);return o?-o:(i=u(f.to,e.to)||eo(n)-eo(t),i)?i:t.id-n.id}function ha(n,t){var f=hi&&n.markedSpans,r,i,u;if(f)for(i=void 0,u=0;u<f.length;++u)i=f[u],i.marker.collapsed&&(t?i.from:i.to)==null&&(!r||sa(r,i.marker)<0)&&(r=i.marker);return r}function ca(n){return ha(n,!0)}function sf(n){return ha(n,!1)}function la(n,i,r,f,e){var v=t(n,i),l=hi&&v.markedSpans,h,o;if(l)for(h=0;h<l.length;++h)if(o=l[h],o.marker.collapsed){var s=o.marker.find(0),c=u(s.from,r)||fo(o.marker)-fo(e),a=u(s.to,f)||eo(o.marker)-eo(e);if((!(c>=0)||!(a<=0))&&(!(c<=0)||!(a>=0))&&(c<=0&&(o.marker.inclusiveRight&&e.inclusiveLeft?u(s.to,r)>=0:u(s.to,r)>0)||c>=0&&(o.marker.inclusiveRight&&e.inclusiveLeft?u(s.from,f)<=0:u(s.from,f)<0)))return!0}}function ni(n){for(var t;t=ca(n);)n=t.find(-1,!0).line;return n}function ak(n){for(var t;t=sf(n);)n=t.find(1,!0).line;return n}function vk(n){for(var i,t;i=sf(n);)n=i.find(1,!0).line,(t||(t=[])).push(n);return t}function uh(n,i){var r=t(n,i),u=ni(r);return r==u?i:h(u)}function aa(n,i){if(i>n.lastLine())return i;var r=t(n,i),u;if(!fr(n,r))return i;while(u=sf(r))r=u.find(1,!0).line;return h(r)+1}function fr(n,t){var u=hi&&t.markedSpans,i,r;if(u)for(i=void 0,r=0;r<u.length;++r)if((i=u[r],i.marker.collapsed)&&(i.from==null||!i.marker.widgetNode&&i.from==0&&i.marker.inclusiveLeft&&fh(n,t,i)))return!0}function fh(n,t,i){var f,r,u;if(i.to==null)return f=i.marker.find(1,!0),fh(n,f.line,of(f.line.markedSpans,i.marker));if(i.marker.inclusiveRight&&i.to==t.text.length)return!0;for(r=void 0,u=0;u<t.markedSpans.length;++u)if(r=t.markedSpans[u],r.marker.collapsed&&!r.marker.widgetNode&&r.from==i.to&&(r.to==null||r.to!=i.from)&&(r.marker.inclusiveLeft||i.marker.inclusiveRight)&&fh(n,t,r))return!0}function ei(n){var r,t,u,e,i,f,o;for(n=ni(n),r=0,t=n.parent,u=0;u<t.lines.length;++u)if(e=t.lines[u],e==n)break;else r+=e.height;for(i=t.parent;i;t=i,i=t.parent)for(f=0;f<i.children.length;++f)if(o=i.children[f],o==t)break;else r+=o.height;return r}function oo(n){var i,r,t,u,f;if(n.height==0)return 0;for(i=n.text.length,t=n;r=ca(t);)u=r.find(0,!0),t=u.from.line,i+=u.from.ch-u.to.ch;for(t=n;r=sf(t);)f=r.find(0,!0),i-=t.text.length-f.from.ch,t=f.to.line,i+=t.text.length-f.to.ch;return i}function eh(n){var i=n.display,r=n.doc;i.maxLine=t(r,r.first);i.maxLineLength=oo(i.maxLine);i.maxLineChanged=!0;r.iter(function(n){var t=oo(n);t>i.maxLineLength&&(i.maxLineLength=t,i.maxLine=n)})}function yk(n,t,i,r){var e,f,u;if(!n)return r(t,i,"ltr",0);for(e=!1,f=0;f<n.length;++f)u=n[f],(u.from<i&&u.to>t||t==i&&u.to==t)&&(r(Math.max(u.from,t),Math.min(u.to,i),u.level==1?"rtl":"ltr",f),e=!0);e||r(t,i,"ltr")}function hf(n,t,i){var f,r,u;for(pu=null,r=0;r<n.length;++r){if(u=n[r],u.from<t&&u.to>t)return r;u.to==t&&(u.from!=u.to&&i=="before"?f=r:pu=r);u.from==t&&(u.from!=u.to&&i!="before"?f=r:pu=r)}return f!=null?f:pu}function oi(n,t){var i=n.order;return i==null&&(i=n.order=ab(n.text,t)),i}function oh(n,t){return n._handlers&&n._handlers[t]||sl}function lt(n,t,i){var u,r,f;n.removeEventListener?n.removeEventListener(t,i,!1):n.detachEvent?n.detachEvent("on"+t,i):(u=n._handlers,r=u&&u[t],r&&(f=d(r,i),f>-1&&(u[t]=r.slice(0,f).concat(r.slice(f+1)))))}function y(n,t){var r=oh(n,t),u,i;if(r.length)for(u=Array.prototype.slice.call(arguments,2),i=0;i<r.length;++i)r[i].apply(null,u)}function w(n,t,i){return typeof t=="string"&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),y(n,i||t.type,n,t),sh(t)||t.codemirrorIgnore}function va(n){var i=n._handlers&&n._handlers.cursorActivity,r,t;if(i)for(r=n.curOp.cursorActivityHandlers||(n.curOp.cursorActivityHandlers=[]),t=0;t<i.length;++t)d(r,i[t])==-1&&r.push(i[t])}function vt(n,t){return oh(n,t).length>0}function tu(n){n.prototype.on=function(n,t){r(this,n,t)};n.prototype.off=function(n,t){lt(this,n,t)}}function ft(n){n.preventDefault?n.preventDefault():n.returnValue=!1}function ya(n){n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function sh(n){return n.defaultPrevented!=null?n.defaultPrevented:n.returnValue==!1}function cf(n){ft(n);ya(n)}function hh(n){return n.target||n.srcElement}function pa(n){var t=n.which;return t==null&&(n.button&1?t=1:n.button&2?t=3:n.button&4&&(t=2)),kt&&n.ctrlKey&&t==1&&(t=3),t}function pk(n){var t,r;return hl==null&&(t=i("span","​"),ct(n,i("span",[t,document.createTextNode("x")])),n.firstChild.offsetHeight!=0&&(hl=t.offsetWidth<=1&&t.offsetHeight>2&&!(e&&l<8))),r=hl?i("span","​"):i("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px"),r.setAttribute("cm-text",""),r}function wk(n){if(cl!=null)return cl;var i=ct(n,document.createTextNode("AخA")),t=vu(i,0,1).getBoundingClientRect(),r=vu(i,1,2).getBoundingClientRect();return(ai(n),!t||t.left==t.right)?!1:cl=r.right-t.right<3}function bk(n){if(dl!=null)return dl;var t=ct(n,i("span","x")),r=t.getBoundingClientRect(),u=vu(t,0,1).getBoundingClientRect();return dl=Math.abs(r.left-u.left)>1}function kk(n,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2));ss[n]=t}function dk(n,t){wr[n]=t}function so(n){if(typeof n=="string"&&wr.hasOwnProperty(n))n=wr[n];else if(n&&typeof n.name=="string"&&wr.hasOwnProperty(n.name)){var t=wr[n.name];typeof t=="string"&&(t={name:t});n=na(t,n);n.name=t.name}else{if(typeof n=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(n))return so("application/xml");if(typeof n=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(n))return so("application/json")}return typeof n=="string"?{name:n}:n||{name:"null"}}function ch(n,t){var f,i,u,r,e;if(t=so(t),f=ss[t.name],!f)return ch(n,"text/plain");if(i=f(n,t),br.hasOwnProperty(t.name)){u=br[t.name];for(r in u)u.hasOwnProperty(r)&&(i.hasOwnProperty(r)&&(i["_"+r]=i[r]),i[r]=u[r])}if(i.name=t.name,t.helperType&&(i.helperType=t.helperType),t.modeProps)for(e in t.modeProps)i[e]=t.modeProps[e];return i}function gk(n,t){var i=br.hasOwnProperty(n)?br[n]:br[n]={};ir(t,i)}function er(n,t){var r,u,i;if(t===!0)return t;if(n.copyState)return n.copyState(t);r={};for(u in t)i=t[u],i instanceof Array&&(i=i.concat([])),r[u]=i;return r}function lh(n,t){for(var i;n.innerMode;){if(i=n.innerMode(t),!i||i.mode==n)break;t=i.state;n=i.mode}return i||{mode:n,state:t}}function wa(n,t,i){return n.startState?n.startState(t,i):!0}function ba(n,t,i,r){var u=[n.state.modeGen],f={},o,s,e;for(tv(n,t.text,n.doc.mode,i,function(n,t){return u.push(n,t)},f,r),o=i.state,s=function(r){i.baseTokens=u;var s=n.state.overlays[r],e=1,h=0;i.state=!0;tv(n,t.text,s.mode,i,function(n,t){for(var i=e,r,f;h<n;)r=u[e],r>n&&u.splice(e,1,n,u[e+1],r),e+=2,h=Math.min(n,r);if(t)if(s.opaque)u.splice(i,e-i,n,"overlay "+t),e=i+2;else for(;i<e;i+=2)f=u[i+1],u[i+1]=(f?f+" ":"")+"overlay "+t},f);i.state=o;i.baseTokens=null;i.baseTokenPos=1},e=0;e<n.state.overlays.length;++e)s(e);return{styles:u,classes:f.bgClass||f.textClass?f:null}}function ka(n,t,i){if(!t.styles||t.styles[0]!=n.state.modeGen){var r=lf(n,h(t)),u=t.text.length>n.options.maxHighlightLength&&er(n.doc.mode,r.state),f=ba(n,t,r);u&&(r.state=u);t.stateAfter=r.save(!u);t.styles=f.styles;f.classes?t.styleClasses=f.classes:t.styleClasses&&(t.styleClasses=null);i===n.doc.highlightFrontier&&(n.doc.modeFrontier=Math.max(n.doc.modeFrontier,++n.doc.highlightFrontier))}return t.styles}function lf(n,i,r){var u=n.doc,o=n.display;if(!u.mode.startState)return new dt(u,!0,i);var e=nd(n,i,r),s=e>u.first&&t(u,e-1).stateAfter,f=s?dt.fromSaved(u,s,e):new dt(u,wa(u.mode),e);return u.iter(e,i,function(t){ah(n,t.text,f);var r=f.line;t.stateAfter=r==i-1||r%5==0||r>=o.viewFrom&&r<o.viewTo?f.save():null;f.nextLine()}),r&&(u.modeFrontier=f.line),f}function ah(n,t,i,r){var f=n.doc.mode,u=new v(t,n.options.tabSize,i);for(u.start=u.pos=r||0,t==""&&da(f,i.state);!u.eol();)vh(f,u,i.state),u.start=u.pos}function da(n,t){if(n.blankLine)return n.blankLine(t);if(n.innerMode){var i=lh(n,t);if(i.mode.blankLine)return i.mode.blankLine(i.state)}}function vh(n,t,i,r){for(var u,f=0;f<10;f++)if(r&&(r[0]=lh(n,i).mode),u=n.token(t,i),t.pos>t.start)return u;throw new Error("Mode "+n.name+" failed to advance stream.");}function ga(n,i,r,u){var o=n.doc,l=o.mode,h;i=f(o,i);var a=t(o,i.line),s=lf(n,i.line,r),e=new v(a.text,n.options.tabSize,s),c;for(u&&(c=[]);(u||e.pos<i.ch)&&!e.eol();)e.start=e.pos,h=vh(l,e,s.state),u&&c.push(new ll(e,h,er(o.mode,s.state)));return u?c:new ll(e,h,s.state)}function nv(n,t){var i,r;if(n)for(;;){if(i=n.match(/(?:^|\s+)line-(background-)?(\S+)/),!i)break;n=n.slice(0,i.index)+n.slice(i.index+i[0].length);r=i[1]?"bgClass":"textClass";t[r]==null?t[r]=i[2]:new RegExp("(?:^|s)"+i[2]+"(?:$|s)").test(t[r])||(t[r]+=" "+i[2])}return n}function tv(n,t,i,r,u,f,e){var c=i.flattenSpans,l,y;c==null&&(c=n.options.flattenSpans);var s=0,a=null,o=new v(t,n.options.tabSize,r),h,p=n.options.addModeClass&&[null];for(t==""&&nv(da(i,r.state),f);!o.eol();){if(o.pos>n.options.maxHighlightLength?(c=!1,e&&ah(n,t,r,o.pos),o.pos=t.length,h=null):h=nv(vh(i,o,r.state,p),f),p&&(l=p[0].name,l&&(h="m-"+(h?l+" "+h:l))),!c||a!=h){while(s<o.start)s=Math.min(o.start,s+5e3),u(s,a);a=h}o.start=o.pos}while(s<o.pos)y=Math.min(o.pos,s+5e3),u(y,a),s=y}function nd(n,i,r){for(var o,f,s,c,h,e=n.doc,l=r?-1:i-(n.doc.mode.innerMode?1e3:100),u=i;u>l;--u){if(u<=e.first)return e.first;if(o=t(e,u-1),f=o.stateAfter,f&&(!r||u+(f instanceof ve?f.lookAhead:0)<=e.modeFrontier))return u;s=at(o.text,null,n.options.tabSize);(h==null||c>s)&&(h=u-1,c=s)}return h}function td(n,i){var u,r,f;if(n.modeFrontier=Math.min(n.modeFrontier,i),!(n.highlightFrontier<i-10)){for(u=n.first,r=i-1;r>u;r--)if(f=t(n,r).stateAfter,f&&(!(f instanceof ve)||r+f.lookAhead<i)){u=r+1;break}n.highlightFrontier=Math.min(n.highlightFrontier,u)}}function id(n,t,i,r){n.text=t;n.stateAfter&&(n.stateAfter=null);n.styles&&(n.styles=null);n.order!=null&&(n.order=null);ea(n);oa(n,i);var u=r?r(n):1;u!=n.height&&gt(n,u)}function rd(n){n.parent=null;ea(n)}function iv(n,t){if(!n||/^\s*$/.test(n))return null;var i=t.addModeClass?pb:yb;return i[n]||(i[n]=n.replace(/\S+/g,"cm-$&"))}function rv(n,t){var s=nu("span",null,null,tt?"padding-right: .1px":null),i={pre:nu("pre",[s],"CodeMirror-line"),content:s,col:0,pos:0,cm:n,trailingSpace:!1,splitSpaces:(e||tt)&&n.getOption("lineWrapping")},u,r,o,c,f;for(t.measure={},u=0;u<=(t.rest?t.rest.length:0);u++)r=u?t.rest[u-1]:t.line,o=void 0,i.pos=0,i.addToken=fd,wk(n.display.measure)&&(o=oi(r,n.doc.direction))&&(i.addToken=od(i.addToken,o)),i.map=[],c=t!=n.display.externalMeasured&&h(r),sd(r,i,ka(n,r,c)),r.styleClasses&&(r.styleClasses.bgClass&&(i.bgClass=ys(r.styleClasses.bgClass,i.bgClass||"")),r.styleClasses.textClass&&(i.textClass=ys(r.styleClasses.textClass,i.textClass||""))),i.map.length==0&&i.map.push(0,0,i.content.appendChild(pk(n.display.measure))),u==0?(t.measure.map=i.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(i.map),(t.measure.caches||(t.measure.caches=[])).push({}));return tt&&(f=i.content.lastChild,(/\bcm-tab\b/.test(f.className)||f.querySelector&&f.querySelector(".cm-tab"))&&(i.content.className="cm-tab-wrap-hack")),y(n,"renderLine",n,t.line,i.pre),i.pre.className&&(i.textClass=ys(i.pre.className,i.textClass||"")),i}function ud(n){var t=i("span","•","cm-invalidchar");return t.title="\\u"+n.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function fd(n,t,r,u,f,o,s){var v,h,y,p,c,b,k,w,d;if(t){var g=n.splitSpaces?ed(t,n.trailingSpace):t,nt=n.cm.state.specialChars,tt=!1,a;if(nt.test(t))for(a=document.createDocumentFragment(),v=0;;){if(nt.lastIndex=v,h=nt.exec(t),y=h?h.index-v:t.length-v,y&&(p=document.createTextNode(g.slice(v,v+y)),e&&l<9?a.appendChild(i("span",[p])):a.appendChild(p),n.map.push(n.pos,n.pos+y,p),n.col+=y,n.pos+=y),!h)break;v+=y+1;c=void 0;h[0]=="\t"?(b=n.cm.options.tabSize,k=b-n.col%b,c=a.appendChild(i("span",bs(k),"cm-tab")),c.setAttribute("role","presentation"),c.setAttribute("cm-text","\t"),n.col+=k):h[0]=="\r"||h[0]=="\n"?(c=a.appendChild(i("span",h[0]=="\r"?"␍":"␤","cm-invalidchar")),c.setAttribute("cm-text",h[0]),n.col+=1):(c=n.cm.options.specialCharPlaceholder(h[0]),c.setAttribute("cm-text",h[0]),e&&l<9?a.appendChild(i("span",[c])):a.appendChild(c),n.col+=1);n.map.push(n.pos,n.pos+1,c);n.pos++}else n.col+=t.length,a=document.createTextNode(g),n.map.push(n.pos,n.pos+t.length,a),e&&l<9&&(tt=!0),n.pos+=t.length;if(n.trailingSpace=g.charCodeAt(t.length-1)==32,r||u||f||tt||s)return w=r||"",u&&(w+=u),f&&(w+=f),d=i("span",[a],w,s),o&&(d.title=o),n.content.appendChild(d);n.content.appendChild(a)}}function ed(n,t){var u,f,i,r;if(n.length>1&&!/  /.test(n))return n;for(u=t,f="",i=0;i<n.length;i++)r=n.charAt(i),r==" "&&u&&(i==n.length-1||n.charCodeAt(i+1)==32)&&(r=" "),f+=r,u=r==" ";return f}function od(n,t){return function(i,r,u,f,e,o,s){var c,a,h,l;for(u=u?u+" cm-force-border":"cm-force-border",c=i.pos,a=c+r.length;;){for(h=void 0,l=0;l<t.length;l++)if(h=t[l],h.to>c&&h.from<=c)break;if(h.to>=a)return n(i,r,u,f,e,o,s);n(i,r.slice(0,h.to-c),u,f,null,o,s);f=null;r=r.slice(h.to-c);c=h.to}}}function uv(n,t,i,r){var u=!r&&i.widgetNode;u&&n.map.push(n.pos,n.pos+t,u);!r&&n.cm.display.input.needsContentAttribute&&(u||(u=n.content.appendChild(document.createElement("span"))),u.setAttribute("cm-marker",i.id));u&&(n.cm.display.input.setUneditable(u),n.content.appendChild(u));n.pos+=t;n.trailingSpace=!1}function sd(n,t,i){var it=n.markedSpans,rt=n.text,y=0,l,p,s,w,u,f,a,b,c,k,ut;if(!it){for(l=1;l<i.length;l+=2)t.addToken(t,rt.slice(y,y=i[l]),iv(i[l+1],t.cm.options));return}for(var ft=rt.length,r=0,ot=1,h="",et,v,o=0,d,g,nt,tt,e;;){if(o==r){for(d=g=nt=tt=v="",e=null,o=Infinity,p=[],s=void 0,w=0;w<it.length;++w)u=it[w],f=u.marker,f.type=="bookmark"&&u.from==r&&f.widgetNode?p.push(f):u.from<=r&&(u.to==null||u.to>r||f.collapsed&&u.to==r&&u.from==r)?(u.to!=null&&u.to!=r&&o>u.to&&(o=u.to,g=""),f.className&&(d+=" "+f.className),f.css&&(v=(v?v+";":"")+f.css),f.startStyle&&u.from==r&&(nt+=" "+f.startStyle),f.endStyle&&u.to==o&&(s||(s=[])).push(f.endStyle,u.to),f.title&&!tt&&(tt=f.title),f.collapsed&&(!e||sa(e.marker,f)<0)&&(e=u)):u.from>r&&o>u.from&&(o=u.from);if(s)for(a=0;a<s.length;a+=2)s[a+1]==o&&(g+=" "+s[a]);if(!e||e.from==r)for(b=0;b<p.length;++b)uv(t,0,p[b]);if(e&&(e.from||0)==r){if(uv(t,(e.to==null?ft+1:e.to)-r,e.marker,e.from==null),e.to==null)return;e.to==r&&(e=!1)}}if(r>=ft)break;for(c=Math.min(ft,o);;){if(h){if(k=r+h.length,e||(ut=k>c?h.slice(0,c-r):h,t.addToken(t,ut,et?et+d:d,nt,r+ut.length==o?g:"",tt,v)),k>=c){h=h.slice(c-r);r=c;break}r=k;nt=""}h=rt.slice(y,y=i[ot++]);et=iv(i[ot++],t.cm.options)}}}function fv(n,t,i){this.line=t;this.rest=vk(t);this.size=this.rest?h(s(this.rest))-i+1:1;this.node=this.text=null;this.hidden=fr(n,t)}function ho(n,i,r){for(var f,e=[],o,u=i;u<r;u=o)f=new fv(n.doc,t(n.doc,u),u),o=u+f.size,e.push(f);return e}function hd(n){dr?dr.ops.push(n):n.ownsGroup=dr={ops:[n],delayedCallbacks:[]}}function cd(n){var u=n.delayedCallbacks,i=0,r,t;do{for(;i<u.length;i++)u[i].call(null);for(r=0;r<n.ops.length;r++)if(t=n.ops[r],t.cursorActivityHandlers)while(t.cursorActivityCalled<t.cursorActivityHandlers.length)t.cursorActivityHandlers[t.cursorActivityCalled++].call(null,t.cm)}while(i<u.length)}function ld(n,t){var i=n.ownsGroup;if(i)try{cd(i)}finally{dr=null;t(i)}}function g(n,t){var u=oh(n,t),f,i,e,r;if(u.length)for(f=Array.prototype.slice.call(arguments,2),dr?i=dr.delayedCallbacks:wu?i=wu:(i=wu=[],setTimeout(ad,0)),e=function(n){i.push(function(){return u[n].apply(null,f)})},r=0;r<u.length;++r)e(r)}function ad(){var t=wu,n;for(wu=null,n=0;n<t.length;++n)t[n]()}function ev(n,t,i,r){for(var u,f=0;f<t.changes.length;f++)u=t.changes[f],u=="text"?yd(n,t):u=="gutter"?sv(n,t,i,r):u=="class"?yh(n,t):u=="widget"&&pd(n,t,r);t.changes=null}function af(n){return n.node==n.text&&(n.node=i("div",null,null,"position: relative"),n.text.parentNode&&n.text.parentNode.replaceChild(n.node,n.text),n.node.appendChild(n.text),e&&l<8&&(n.node.style.zIndex=2)),n.node}function vd(n,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass,u;r&&(r+=" CodeMirror-linebackground");t.background?r?t.background.className=r:(t.background.parentNode.removeChild(t.background),t.background=null):r&&(u=af(t),t.background=u.insertBefore(i("div",null,r),u.firstChild),n.display.input.setUneditable(t.background))}function ov(n,t){var i=n.display.externalMeasured;return i&&i.line==t.line?(n.display.externalMeasured=null,t.measure=i.measure,i.built):rv(n,t)}function yd(n,t){var r=t.text.className,i=ov(n,t);t.text==t.node&&(t.node=i.pre);t.text.parentNode.replaceChild(i.pre,t.text);t.text=i.pre;i.bgClass!=t.bgClass||i.textClass!=t.textClass?(t.bgClass=i.bgClass,t.textClass=i.textClass,yh(n,t)):r&&(t.text.className=r)}function yh(n,t){vd(n,t);t.line.wrapClass?af(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var i=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=i||""}function sv(n,t,r,u){var c,f,l,e,s,o,h;if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass&&(c=af(t),t.gutterBackground=i("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(n.options.fixedGutter?u.fixedPos:-u.gutterTotalWidth)+"px; width: "+u.gutterTotalWidth+"px"),n.display.input.setUneditable(t.gutterBackground),c.insertBefore(t.gutterBackground,t.text)),f=t.line.gutterMarkers,(n.options.lineNumbers||f)&&(l=af(t),e=t.gutter=i("div",null,"CodeMirror-gutter-wrapper","left: "+(n.options.fixedGutter?u.fixedPos:-u.gutterTotalWidth)+"px"),n.display.input.setUneditable(e),l.insertBefore(e,t.text),t.line.gutterClass&&(e.className+=" "+t.line.gutterClass),!n.options.lineNumbers||f&&f["CodeMirror-linenumbers"]||(t.lineNumber=e.appendChild(i("div",nh(n.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+u.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+n.display.lineNumInnerWidth+"px"))),f))for(s=0;s<n.options.gutters.length;++s)o=n.options.gutters[s],h=f.hasOwnProperty(o)&&f[o],h&&e.appendChild(i("div",[h],"CodeMirror-gutter-elt","left: "+u.gutterLeft[o]+"px; width: "+u.gutterWidth[o]+"px"))}function pd(n,t,i){t.alignable&&(t.alignable=null);for(var r=t.node.firstChild,u=void 0;r;r=u)u=r.nextSibling,r.className=="CodeMirror-linewidget"&&t.node.removeChild(r);hv(n,t,i)}function wd(n,t,i,r){var u=ov(n,t);return t.text=t.node=u.pre,u.bgClass&&(t.bgClass=u.bgClass),u.textClass&&(t.textClass=u.textClass),yh(n,t),sv(n,t,i,r),hv(n,t,r),t.node}function hv(n,t,i){if(cv(n,t.line,t,i,!0),t.rest)for(var r=0;r<t.rest.length;r++)cv(n,t.rest[r],t,i,!1)}function cv(n,t,r,u,f){var h,s,c,e,o;if(t.widgets)for(h=af(r),s=0,c=t.widgets;s<c.length;++s)e=c[s],o=i("div",[e.node],"CodeMirror-linewidget"),e.handleMouseEvents||o.setAttribute("cm-ignore-events","true"),bd(e,o,r,u),n.display.input.setUneditable(o),f&&e.above?h.insertBefore(o,r.gutter||r.text):h.appendChild(o),g(e,"redraw")}function bd(n,t,i,r){if(n.noHScroll){(i.alignable||(i.alignable=[])).push(t);var u=r.wrapperWidth;t.style.left=r.fixedPos+"px";n.coverGutter||(u-=r.gutterTotalWidth,t.style.paddingLeft=r.gutterTotalWidth+"px");t.style.width=u+"px"}n.coverGutter&&(t.style.zIndex=5,t.style.position="relative",n.noHScroll||(t.style.marginLeft=-r.gutterTotalWidth+"px"))}function vf(n){var t,r;return n.height!=null?n.height:(t=n.doc.cm,!t)?0:(vi(document.body,n.node)||(r="position: relative;",n.coverGutter&&(r+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),n.noHScroll&&(r+="width: "+t.display.wrapper.clientWidth+"px;"),ct(t.display.measure,i("div",[n.node],null,r))),n.height=n.node.parentNode.offsetHeight)}function si(n,t){for(var i=hh(t);i!=n.wrapper;i=i.parentNode)if(!i||i.nodeType==1&&i.getAttribute("cm-ignore-events")=="true"||i.parentNode==n.sizer&&i!=n.mover)return!0}function co(n){return n.lineSpace.offsetTop}function ph(n){return n.mover.offsetHeight-n.lineSpace.offsetHeight}function lv(n){if(n.cachedPaddingH)return n.cachedPaddingH;var r=ct(n.measure,i("pre","x")),u=window.getComputedStyle?window.getComputedStyle(r):r.currentStyle,t={left:parseInt(u.paddingLeft),right:parseInt(u.paddingRight)};return isNaN(t.left)||isNaN(t.right)||(n.cachedPaddingH=t),t}function ti(n){return nk-n.display.nativeBarWidth}function or(n){return n.display.scroller.clientWidth-ti(n)-n.display.barWidth}function wh(n){return n.display.scroller.clientHeight-ti(n)-n.display.barHeight}function kd(n,t,i){var f=n.options.lineWrapping,h=f&&or(n),e,u,r,o,s;if(!t.measure.heights||f&&t.measure.width!=h){if(e=t.measure.heights=[],f)for(t.measure.width=h,u=t.text.firstChild.getClientRects(),r=0;r<u.length-1;r++)o=u[r],s=u[r+1],Math.abs(o.bottom-s.bottom)>2&&e.push((o.bottom+s.top)/2-i.top);e.push(i.bottom-i.top)}}function av(n,t,i){var r,u;if(n.line==t)return{map:n.measure.map,cache:n.measure.cache};for(r=0;r<n.rest.length;r++)if(n.rest[r]==t)return{map:n.measure.maps[r],cache:n.measure.caches[r]};for(u=0;u<n.rest.length;u++)if(h(n.rest[u])>i)return{map:n.measure.maps[u],cache:n.measure.caches[u],before:!0}}function dd(n,t){var r,i,u;return t=ni(t),r=h(t),i=n.display.externalMeasured=new fv(n.doc,t,r),i.lineN=r,u=i.built=rv(n,i),i.text=u.pre,ct(n.display.lineMeasure,u.pre),i}function vv(n,t,i,r){return ii(n,iu(n,t),i,r)}function bh(n,t){if(t>=n.display.viewFrom&&t<n.display.viewTo)return n.display.view[cr(n,t)];var i=n.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size)return i}function iu(n,t){var u=h(t),i=bh(n,u),r;return i&&!i.text?i=null:i&&i.changes&&(ev(n,i,u,ic(n)),n.curOp.forceUpdate=!0),i||(i=dd(n,t)),r=av(i,t,u),{line:t,view:i,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function ii(n,t,i,r,u){t.before&&(i=-1);var e=i+(r||""),f;return t.cache.hasOwnProperty(e)?f=t.cache[e]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(kd(n,t.view,t.rect),t.hasHeights=!0),f=ng(n,t,i,r),f.bogus||(t.cache[e]=f)),{left:f.left,right:f.right,top:u?f.rtop:f.top,bottom:u?f.rbottom:f.bottom}}function yv(n,t,i){for(var s,u,h,o,e,f,r=0;r<n.length;r+=3)if(e=n[r],f=n[r+1],t<e?(u=0,h=1,o="left"):t<f?(u=t-e,h=u+1):(r==n.length-3||t==f&&n[r+3]>t)&&(h=f-e,u=h-1,t>=f&&(o="right")),u!=null){if(s=n[r+2],e==f&&i==(s.insertLeft?"left":"right")&&(o=i),i=="left"&&u==0)while(r&&n[r-2]==n[r-3]&&n[r-1].insertLeft)s=n[(r-=3)+2],o="left";if(i=="right"&&u==f-e)while(r<n.length-3&&n[r+3]==n[r+4]&&!n[r+5].insertLeft)s=n[(r+=3)+2],o="right";break}return{node:s,start:u,end:h,collapse:o,coverStart:e,coverEnd:f}}function gd(n,t){var i=al,r,u;if(t=="left"){for(r=0;r<n.length;r++)if((i=n[r]).left!=i.right)break}else for(u=n.length-1;u>=0;u--)if((i=n[u]).left!=i.right)break;return i}function ng(n,t,i,r){var o=yv(t.map,i,r),s=o.node,f=o.start,h=o.end,v=o.collapse,u,w,b,c;if(s.nodeType==3){for(w=0;w<4;w++){while(f&&ds(t.line.text.charAt(o.coverStart+f)))--f;while(o.coverStart+h<o.coverEnd&&ds(t.line.text.charAt(o.coverStart+h)))++h;if(u=e&&l<9&&f==0&&h==o.coverEnd-o.coverStart?s.parentNode.getBoundingClientRect():gd(vu(s,f,h).getClientRects(),r),u.left||u.right||f==0)break;h=f;f=f-1;v="right"}e&&l<11&&(u=tg(n.display.measure,u))}else f>0&&(v=r="right"),u=n.options.lineWrapping&&(b=s.getClientRects()).length>1?b[r=="right"?b.length-1:0]:s.getBoundingClientRect();e&&l<9&&!f&&(!u||!u.left&&!u.right)&&(c=s.parentNode.getClientRects()[0],u=c?{left:c.left,right:c.left+pf(n.display),top:c.top,bottom:c.bottom}:al);for(var k=u.top-t.rect.top,d=u.bottom-t.rect.top,g=(k+d)/2,y=t.view.measure.heights,a=0;a<y.length-1;a++)if(g<y[a])break;var nt=a?y[a-1]:0,tt=y[a],p={left:(v=="right"?u.right:u.left)-t.rect.left,right:(v=="left"?u.left:u.right)-t.rect.left,top:nt,bottom:tt};return u.left||u.right||(p.bogus=!0),n.options.singleCursorHeightPerLine||(p.rtop=k,p.rbottom=d),p}function tg(n,t){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!bk(n))return t;var i=screen.logicalXDPI/screen.deviceXDPI,r=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*i,right:t.right*i,top:t.top*r,bottom:t.bottom*r}}function pv(n){if(n.measure&&(n.measure.cache={},n.measure.heights=null,n.rest))for(var t=0;t<n.rest.length;t++)n.measure.caches[t]={}}function wv(n){n.display.externalMeasure=null;ai(n.display.lineMeasure);for(var t=0;t<n.display.view.length;t++)pv(n.display.view[t])}function yf(n){wv(n);n.display.cachedCharWidth=n.display.cachedTextHeight=n.display.cachedPaddingH=null;n.options.lineWrapping||(n.display.maxLineChanged=!0);n.display.lineNumChars=null}function bv(){return fs&&es?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function kv(){return fs&&es?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function kh(n){var i=0,t;if(n.widgets)for(t=0;t<n.widgets.length;++t)n.widgets[t].above&&(i+=vf(n.widgets[t]));return i}function lo(n,t,i,r,u){var e,f,o,s;return(u||(e=kh(t),i.top+=e,i.bottom+=e),r=="line")?i:(r||(r="local"),f=ei(t),r=="local"?f+=co(n.display):f-=n.display.viewOffset,(r=="page"||r=="window")&&(o=n.display.lineSpace.getBoundingClientRect(),f+=o.top+(r=="window"?0:kv()),s=o.left+(r=="window"?0:bv()),i.left+=s,i.right+=s),i.top+=f,i.bottom+=f,i)}function dv(n,t,i){var r,u,f,e;return i=="div"?t:(r=t.left,u=t.top,i=="page"?(r-=bv(),u-=kv()):i!="local"&&i||(f=n.display.sizer.getBoundingClientRect(),r+=f.left,u+=f.top),e=n.display.lineSpace.getBoundingClientRect(),{left:r-e.left,top:u-e.top})}function dh(n,i,r,u,f){return u||(u=t(n.doc,i.line)),lo(n,u,vv(n,u,i.ch,f),r)}function pt(n,i,r,u,f,e){function c(t,i){var o=ii(n,f,t,i?"right":"left",e);return i?o.left=o.right:o.right=o.left,lo(n,u,o,r)}function l(n,t,i){var r=h[t],u=r.level==1;return c(i?n-1:n,u!=i)}u=u||t(n.doc,i.line);f||(f=iu(n,u));var h=oi(u,n.doc.direction),o=i.ch,s=i.sticky;if(o>=u.text.length?(o=u.text.length,s="before"):o<=0&&(o=0,s="after"),!h)return c(s=="before"?o-1:o,s=="before");var y=hf(h,o,s),a=pu,v=l(o,y,s=="before");return a!=null&&(v.other=l(o,a,s!="before")),v}function gv(n,i){var r=0,u,e;return i=f(n.doc,i),n.options.lineWrapping||(r=pf(n.display)*i.ch),u=t(n.doc,i.line),e=ei(u)+co(n.display),{left:r,right:r,top:e,bottom:e+u.height}}function gh(t,i,r,u,f){var e=n(t,i,r);return e.xRel=f,u&&(e.outside=!0),e}function nc(n,i,r){var u=n.doc,f,s,e;if(r+=n.display.viewOffset,r<0)return gh(u.first,0,null,!0,-1);if(f=ur(u,r),s=u.first+u.size-1,f>s)return gh(u.first+u.size-1,t(u,s).text.length,null,!0,1);for(i<0&&(i=0),e=t(u,f);;){var o=ig(n,e,f,i,r),c=sf(e),l=c&&c.find(0,!0);if(c&&(o.ch>l.from.ch||o.ch==l.from.ch&&o.xRel>0))f=h(e=l.to.line);else return o}}function ny(n,t,i,r){r-=kh(t);var u=t.text.length,f=ff(function(t){return ii(n,i,t-1).bottom<=r},u,0);return u=ff(function(t){return ii(n,i,t).top>r},f,u),{begin:f,end:u}}function ty(n,t,i,r){i||(i=iu(n,t));var u=lo(n,t,ii(n,i,r),"line").top;return ny(n,t,i,u)}function tc(n,t,i,r){return n.bottom<=i?!1:n.top>i?!0:(r?n.left:n.right)>t}function ig(t,i,r,u,f){var s,v,y,c;f-=ei(i);var l=iu(t,i),p=kh(i),w=0,b=i.text.length,o=!0,d=oi(i,t.doc.direction);d&&(s=(t.options.lineWrapping?ug:rg)(t,i,r,l,d,u,f),o=s.level!=1,w=o?s.from:s.to-1,b=o?s.to:s.from-1);var g=null,h=null,e=ff(function(n){var i=ii(t,l,n);return(i.top+=p,i.bottom+=p,!tc(i,u,f,!1))?!1:(i.top<=f&&i.left<=u&&(g=n,h=i),!0)},w,b),k,a,nt=!1;return h?(v=u-h.left<h.right-u,y=v==o,e=g+(y?0:1),a=y?"after":"before",k=v?h.left:h.right):(o||e!=b&&e!=w||e++,a=e==0?"after":e==i.text.length?"before":ii(t,l,e-(o?1:0)).bottom+p<=f==o?"after":"before",c=pt(t,n(r,e,a),"line",i,l),k=c.left,nt=f<c.top||f>=c.bottom),e=ia(i.text,e,1),gh(r,e,a,nt,u-k)}function rg(t,i,r,u,f,e,o){var h=ff(function(s){var h=f[s],c=h.level!=1;return tc(pt(t,n(r,c?h.to:h.from,c?"before":"after"),"line",i,u),e,o,!0)},0,f.length-1),s=f[h],c,l;return h>0&&(c=s.level!=1,l=pt(t,n(r,c?s.from:s.to,c?"after":"before"),"line",i,u),tc(l,e,o,!0)&&l.top>o&&(s=f[h-1])),s}function ug(n,t,i,r,u,f,e){var y=ny(n,t,r,e),c=y.begin,h=y.end,o,a,l,s;for(/\s/.test(t.text.charAt(h-1))&&h--,o=null,a=null,l=0;l<u.length;l++)if(s=u[l],!(s.from>=h)&&!(s.to<=c)){var w=s.level!=1,v=ii(n,r,w?Math.min(h,s.to)-1:Math.max(c,s.from)).right,p=v<f?f-v+1e9:v-f;(!o||a>p)&&(o=s,a=p)}return o||(o=u[u.length-1]),o.from<c&&(o={from:c,to:o.to,level:o.level}),o.to>h&&(o={from:o.from,to:h,level:o.level}),o}function sr(n){var r,t;if(n.cachedTextHeight!=null)return n.cachedTextHeight;if(gr==null){for(gr=i("pre"),r=0;r<49;++r)gr.appendChild(document.createTextNode("x")),gr.appendChild(i("br"));gr.appendChild(document.createTextNode("x"))}return ct(n.measure,gr),t=gr.offsetHeight/50,t>3&&(n.cachedTextHeight=t),ai(n.measure),t||1}function pf(n){var r,f,u,t;return n.cachedCharWidth!=null?n.cachedCharWidth:(r=i("span","xxxxxxxxxx"),f=i("pre",[r]),ct(n.measure,f),u=r.getBoundingClientRect(),t=(u.right-u.left)/10,t>2&&(n.cachedCharWidth=t),t||10)}function ic(n){for(var i=n.display,u={},f={},e=i.gutters.clientLeft,t=i.gutters.firstChild,r=0;t;t=t.nextSibling,++r)u[n.options.gutters[r]]=t.offsetLeft+t.clientLeft+e,f[n.options.gutters[r]]=t.clientWidth;return{fixedPos:rc(i),gutterTotalWidth:i.gutters.offsetWidth,gutterLeft:u,gutterWidth:f,wrapperWidth:i.wrapper.clientWidth}}function rc(n){return n.scroller.getBoundingClientRect().left-n.sizer.getBoundingClientRect().left}function iy(n){var t=sr(n.display),i=n.options.lineWrapping,r=i&&Math.max(5,n.display.scroller.clientWidth/pf(n.display)-3);return function(u){var e,f;if(fr(n.doc,u))return 0;if(e=0,u.widgets)for(f=0;f<u.widgets.length;f++)u.widgets[f].height&&(e+=u.widgets[f].height);return i?e+(Math.ceil(u.text.length/r)||1)*t:e+t}}function uc(n){var t=n.doc,i=iy(n);t.iter(function(n){var t=i(n);t!=n.height&&gt(n,t)})}function hr(i,r,u,f){var a=i.display,s,c,h,e,o,l;if(!u&&hh(r).getAttribute("cm-not-content")=="true")return null;h=a.lineSpace.getBoundingClientRect();try{s=r.clientX-h.left;c=r.clientY-h.top}catch(r){return null}return e=nc(i,s,c),f&&e.xRel==1&&(o=t(i.doc,e.line).text).length==e.ch&&(l=at(o,o.length,i.options.tabSize)-o.length,e=n(e.line,Math.max(0,Math.round((s-lv(i.display).left)/pf(i.display))-l))),e}function cr(n,t){var r,i;if(t>=n.display.viewTo||(t-=n.display.viewFrom,t<0))return null;for(r=n.display.view,i=0;i<r.length;i++)if(t-=r[i].size,t<0)return i}function wf(n){n.display.input.showSelection(n.display.input.prepareSelection())}function ry(n,t){var r,i,u;t===void 0&&(t=!0);var f=n.doc,e={},o=e.cursors=document.createDocumentFragment(),s=e.selection=document.createDocumentFragment();for(r=0;r<f.sel.ranges.length;r++)(t||r!=f.sel.primIndex)&&((i=f.sel.ranges[r],i.from().line>=n.display.viewTo||i.to().line<n.display.viewFrom)||(u=i.empty(),(u||n.options.showCursorWhenSelecting)&&uy(n,i.head,o),u||fg(n,i,s)));return e}function uy(n,t,r){var u=pt(n,t,"div",null,null,!n.options.singleCursorHeightPerLine),e=r.appendChild(i("div"," ","CodeMirror-cursor")),f;e.style.left=u.left+"px";e.style.top=u.top+"px";e.style.height=Math.max(0,u.bottom-u.top)*n.options.cursorHeight+"px";u.other&&(f=r.appendChild(i("div"," ","CodeMirror-cursor CodeMirror-secondarycursor")),f.style.display="",f.style.left=u.other.left+"px",f.style.top=u.other.top+"px",f.style.height=(u.other.bottom-u.other.top)*.85+"px")}function ao(n,t){return n.top-t.top||n.left-t.left}function fg(r,u,f){function s(n,t,r,u){t<0&&(t=0);t=Math.round(t);u=Math.round(u);k.appendChild(i("div",null,"CodeMirror-selected","position: absolute; left: "+n+"px;\n                             top: "+t+"px; width: "+(r==null?l-n:r)+"px;\n                             height: "+(u-t)+"px"))}function p(i,u,f){function p(t,u){return dh(r,n(i,t),"div",a,u)}function y(n,t,i){var u=ty(r,a,null,n),f=t=="ltr"==(i=="after")?"left":"right",e=i=="after"?u.begin:u.end-(/\s/.test(a.text.charAt(u.end-1))?2:1);return p(e,f)[f]}var a=t(v,i),b=a.text.length,o,c,w=oi(a,v.direction);return yk(w,u||0,f==null?b:f,function(n,t,i,r){var k=i=="ltr",a=p(n,k?"left":"right"),v=p(t-1,k?"right":"left"),d=u==null&&n==0,g=f==null&&t==b,it=r==0,rt=!w||r==w.length-1,nt,ut,tt,ft;if(v.top-a.top<=3){var ot=(e?d:g)&&it,st=(e?g:d)&&rt,et=ot?h:(k?a:v).left,ht=st?l:(k?v:a).right;s(et,a.top,ht-et,a.bottom)}else k?(nt=e&&d&&it?h:a.left,ut=e?l:y(n,i,"before"),tt=e?h:y(t,i,"after"),ft=e&&g&&rt?l:v.right):(nt=e?y(n,i,"before"):h,ut=!e&&d&&it?l:a.right,tt=!e&&g&&rt?h:v.left,ft=e?y(t,i,"after"):l),s(nt,a.top,ut-nt,a.bottom),a.bottom<v.top&&s(h,a.bottom,null,v.top),s(tt,v.top,ft-tt,v.bottom);(!o||ao(a,o)<0)&&(o=a);ao(v,o)<0&&(o=v);(!c||ao(a,c)<0)&&(c=a);ao(v,c)<0&&(c=v)}),{start:o,end:c}}var b=r.display,v=r.doc,k=document.createDocumentFragment(),d=lv(r.display),h=d.left,l=Math.max(b.sizerWidth,or(r)-b.sizer.offsetLeft)-d.right,e=v.direction=="ltr",a=u.from(),y=u.to();if(a.line==y.line)p(a.line,a.ch,y.ch);else{var g=t(v,a.line),nt=t(v,y.line),w=ni(g)==ni(nt),o=p(a.line,a.ch,w?g.text.length+1:null).end,c=p(y.line,w?0:null,y.ch).start;w&&(o.top<c.top-2?(s(o.right,o.top,null,o.bottom),s(h,c.top,c.left,c.bottom)):s(o.right,o.top,c.left-o.right,o.bottom));o.bottom<c.top&&s(h,o.bottom,null,c.top)}f.appendChild(k)}function fc(n){var t,i;n.state.focused&&(t=n.display,clearInterval(t.blinker),i=!0,t.cursorDiv.style.visibility="",n.options.cursorBlinkRate>0?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(i=!i)?"":"hidden"},n.options.cursorBlinkRate):n.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden"))}function fy(n){n.state.focused||(n.display.input.focus(),ec(n))}function ey(n){n.state.delayingBlurEvent=!0;setTimeout(function(){n.state.delayingBlurEvent&&(n.state.delayingBlurEvent=!1,bf(n))},100)}function ec(n,t){(n.state.delayingBlurEvent&&(n.state.delayingBlurEvent=!1),n.options.readOnly!="nocursor")&&(n.state.focused||(y(n,"focus",n,t),n.state.focused=!0,tr(n.display.wrapper,"CodeMirror-focused"),n.curOp||n.display.selForContextMenu==n.doc.sel||(n.display.input.reset(),tt&&setTimeout(function(){return n.display.input.reset(!0)},20)),n.display.input.receivedFocus()),fc(n))}function bf(n,t){n.state.delayingBlurEvent||(n.state.focused&&(y(n,"blur",n,t),n.state.focused=!1,di(n.display.wrapper,"CodeMirror-focused")),clearInterval(n.display.blinker),setTimeout(function(){n.state.focused||(n.display.shift=!1)},150))}function vo(n){for(var t,i,f,o,s,r,u=n.display,c=u.lineDiv.offsetTop,h=0;h<u.view.length;h++)if((t=u.view[h],i=void 0,!t.hidden)&&(e&&l<8?(f=t.node.offsetTop+t.node.offsetHeight,i=f-c,c=f):(o=t.node.getBoundingClientRect(),i=o.bottom-o.top),s=t.line.height-i,i<2&&(i=sr(u)),(s>.005||s<-.005)&&(gt(t.line,i),oy(t.line),t.rest)))for(r=0;r<t.rest.length;r++)oy(t.rest[r])}function oy(n){var t,i,r;if(n.widgets)for(t=0;t<n.widgets.length;++t)i=n.widgets[t],r=i.node.parentNode,r&&(i.height=r.offsetHeight)}function oc(n,i,r){var f=r&&r.top!=null?Math.max(0,r.top):n.scroller.scrollTop,e,o;f=Math.floor(f-co(n));var h=r&&r.bottom!=null?r.bottom:f+n.wrapper.clientHeight,u=ur(i,f),s=ur(i,h);return r&&r.ensure&&(e=r.ensure.from.line,o=r.ensure.to.line,e<u?(u=e,s=ur(i,ei(t(i,e))+n.wrapper.clientHeight)):Math.min(o,i.lastLine())>=s&&(u=ur(i,ei(t(i,o))-n.wrapper.clientHeight),s=o)),{from:u,to:Math.max(s,u+1)}}function sy(n){var i=n.display,r=i.view,t,u,f;if(i.alignWidgets||i.gutters.firstChild&&n.options.fixedGutter){var o=rc(i)-i.scroller.scrollLeft+n.doc.scrollLeft,s=i.gutters.offsetWidth,e=o+"px";for(t=0;t<r.length;t++)if(!r[t].hidden&&(n.options.fixedGutter&&(r[t].gutter&&(r[t].gutter.style.left=e),r[t].gutterBackground&&(r[t].gutterBackground.style.left=e)),u=r[t].alignable,u))for(f=0;f<u.length;f++)u[f].style.left=e;n.options.fixedGutter&&(i.gutters.style.left=o+s+"px")}}function hy(n){if(!n.options.lineNumbers)return!1;var u=n.doc,r=nh(n.options,u.first+u.size-1),t=n.display;if(r.length!=t.lineNumChars){var f=t.measure.appendChild(i("div",[i("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),e=f.firstChild.offsetWidth,o=f.offsetWidth-e;return t.lineGutter.style.width="",t.lineNumInnerWidth=Math.max(e,t.lineGutter.offsetWidth-o)+1,t.lineNumWidth=t.lineNumInnerWidth+o,t.lineNumChars=t.lineNumInnerWidth?r.length:-1,t.lineGutter.style.width=t.lineNumWidth+"px",ac(n),!0}return!1}function eg(n,t){var r;if(!w(n,"scrollCursorIntoView")){var f=n.display,e=f.sizer.getBoundingClientRect(),u=null;t.top+e.top<0?u=!0:t.bottom+e.top>(window.innerHeight||document.documentElement.clientHeight)&&(u=!1);u==null||oit||(r=i("div","​",null,"position: absolute;\n                         top: "+(t.top-f.viewOffset-co(n.display))+"px;\n                         height: "+(t.bottom-t.top+ti(n)+f.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;"),n.display.lineSpace.appendChild(r),r.scrollIntoView(u),n.display.lineSpace.removeChild(r))}}function og(t,i,r,u){var s,h;for(u==null&&(u=0),t.options.lineWrapping||i!=r||(i=i.ch?n(i.line,i.sticky=="before"?i.ch-1:i.ch,"after"):i,r=i.sticky=="before"?n(i.line,i.ch+1,"before"):i),h=0;h<5;h++){var c=!1,f=pt(t,i),e=!r||r==i?f:pt(t,r);s={left:Math.min(f.left,e.left),top:Math.min(f.top,e.top)-u,right:Math.max(f.left,e.left),bottom:Math.max(f.bottom,e.bottom)+u};var o=sc(t,s),l=t.doc.scrollTop,a=t.doc.scrollLeft;if(o.scrollTop!=null&&(df(t,o.scrollTop),Math.abs(t.doc.scrollTop-l)>1&&(c=!0)),o.scrollLeft!=null&&(lr(t,o.scrollLeft),Math.abs(t.doc.scrollLeft-a)>1&&(c=!0)),!c)break}return s}function sg(n,t){var i=sc(n,t);i.scrollTop!=null&&df(n,i.scrollTop);i.scrollLeft!=null&&lr(n,i.scrollLeft)}function sc(n,t){var r=n.display,h=sr(n.display),e;t.top<0&&(t.top=0);var o=n.curOp&&n.curOp.scrollTop!=null?n.curOp.scrollTop:r.scroller.scrollTop,u=wh(n),i={};t.bottom-t.top>u&&(t.bottom=t.top+u);var c=n.doc.height+ph(r),a=t.top<h,v=t.bottom>c-h;t.top<o?i.scrollTop=a?0:t.top:t.bottom>o+u&&(e=Math.min(t.top,(v?c:t.bottom)-u),e!=o&&(i.scrollTop=e));var l=n.curOp&&n.curOp.scrollLeft!=null?n.curOp.scrollLeft:r.scroller.scrollLeft,f=or(n)-(n.options.fixedGutter?r.gutters.offsetWidth:0),s=t.right-t.left>f;return s&&(t.right=t.left+f),t.left<10?i.scrollLeft=0:t.left<l?i.scrollLeft=Math.max(0,t.left-(s?0:10)):t.right>f+l-3&&(i.scrollLeft=t.right+(s?0:10)-f),i}function hc(n,t){t!=null&&(yo(n),n.curOp.scrollTop=(n.curOp.scrollTop==null?n.doc.scrollTop:n.curOp.scrollTop)+t)}function ru(n){yo(n);var t=n.getCursor();n.curOp.scrollToPos={from:t,to:t,margin:n.options.cursorScrollMargin}}function kf(n,t,i){(t!=null||i!=null)&&yo(n);t!=null&&(n.curOp.scrollLeft=t);i!=null&&(n.curOp.scrollTop=i)}function hg(n,t){yo(n);n.curOp.scrollToPos=t}function yo(n){var t=n.curOp.scrollToPos,i,r;t&&(n.curOp.scrollToPos=null,i=gv(n,t.from),r=gv(n,t.to),cy(n,i,r,t.margin))}function cy(n,t,i,r){var u=sc(n,{left:Math.min(t.left,i.left),top:Math.min(t.top,i.top)-r,right:Math.max(t.right,i.right),bottom:Math.max(t.bottom,i.bottom)+r});kf(n,u.scrollLeft,u.scrollTop)}function df(n,t){Math.abs(n.doc.scrollTop-t)<2||(ki||lc(n,{top:t}),ly(n,t,!0),ki&&lc(n),ne(n,100))}function ly(n,t,i){(t=Math.min(n.display.scroller.scrollHeight-n.display.scroller.clientHeight,t),n.display.scroller.scrollTop!=t||i)&&(n.doc.scrollTop=t,n.display.scrollbars.setScrollTop(t),n.display.scroller.scrollTop!=t&&(n.display.scroller.scrollTop=t))}function lr(n,t,i,r){(t=Math.min(t,n.display.scroller.scrollWidth-n.display.scroller.clientWidth),(i?t==n.doc.scrollLeft:Math.abs(n.doc.scrollLeft-t)<2)&&!r)||(n.doc.scrollLeft=t,sy(n),n.display.scroller.scrollLeft!=t&&(n.display.scroller.scrollLeft=t),n.display.scrollbars.setScrollLeft(t))}function gf(n){var t=n.display,i=t.gutters.offsetWidth,r=Math.round(n.doc.height+ph(n.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:n.options.fixedGutter?i:0,docHeight:r,scrollHeight:r+ti(n)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:i}}function uu(n,t){var i,r,u;for(t||(t=gf(n)),i=n.display.barWidth,r=n.display.barHeight,ay(n,t),u=0;u<4&&i!=n.display.barWidth||r!=n.display.barHeight;u++)i!=n.display.barWidth&&n.options.lineWrapping&&vo(n),ay(n,gf(n)),i=n.display.barWidth,r=n.display.barHeight}function ay(n,t){var i=n.display,r=i.scrollbars.update(t);i.sizer.style.paddingRight=(i.barWidth=r.right)+"px";i.sizer.style.paddingBottom=(i.barHeight=r.bottom)+"px";i.heightForcer.style.borderBottom=r.bottom+"px solid transparent";r.right&&r.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=r.bottom+"px",i.scrollbarFiller.style.width=r.right+"px"):i.scrollbarFiller.style.display="";r.bottom&&n.options.coverGutterNextToScrollbar&&n.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=r.bottom+"px",i.gutterFiller.style.width=t.gutterWidth+"px"):i.gutterFiller.style.display=""}function vy(n){n.display.scrollbars&&(n.display.scrollbars.clear(),n.display.scrollbars.addClass&&di(n.display.wrapper,n.display.scrollbars.addClass));n.display.scrollbars=new vl[n.options.scrollbarStyle](function(t){n.display.wrapper.insertBefore(t,n.display.scrollbarFiller);r(t,"mousedown",function(){n.state.focused&&setTimeout(function(){return n.display.input.focus()},0)});t.setAttribute("cm-not-content","true")},function(t,i){i=="horizontal"?lr(n,t):df(n,t)},n);n.display.scrollbars.addClass&&tr(n.display.wrapper,n.display.scrollbars.addClass)}function ar(n){n.curOp={cm:n,viewChanged:!1,startHeight:n.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++wb};hd(n.curOp)}function vr(n){var t=n.curOp;ld(t,function(n){for(var t=0;t<n.ops.length;t++)n.ops[t].cm.curOp=null;cg(n)})}function cg(n){for(var i,r,u,f,t=n.ops,e=0;e<t.length;e++)lg(t[e]);for(i=0;i<t.length;i++)ag(t[i]);for(r=0;r<t.length;r++)vg(t[r]);for(u=0;u<t.length;u++)yg(t[u]);for(f=0;f<t.length;f++)pg(t[f])}function lg(n){var t=n.cm,i=t.display;kg(t);n.updateMaxLine&&eh(t);n.mustUpdate=n.viewChanged||n.forceUpdate||n.scrollTop!=null||n.scrollToPos&&(n.scrollToPos.from.line<i.viewFrom||n.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&t.options.lineWrapping;n.update=n.mustUpdate&&new ye(t,n.mustUpdate&&{top:n.scrollTop,ensure:n.scrollToPos},n.forceUpdate)}function ag(n){n.updatedDisplay=n.mustUpdate&&cc(n.cm,n.update)}function vg(n){var t=n.cm,i=t.display;n.updatedDisplay&&vo(t);n.barMeasure=gf(t);i.maxLineChanged&&!t.options.lineWrapping&&(n.adjustWidthTo=vv(t,i.maxLine,i.maxLine.text.length).left+3,t.display.sizerWidth=n.adjustWidthTo,n.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+n.adjustWidthTo+ti(t)+t.display.barWidth),n.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+n.adjustWidthTo-or(t)));(n.updatedDisplay||n.selectionChanged)&&(n.preparedSelection=i.input.prepareSelection())}function yg(n){var t=n.cm,i;n.adjustWidthTo!=null&&(t.display.sizer.style.minWidth=n.adjustWidthTo+"px",n.maxScrollLeft<t.doc.scrollLeft&&lr(t,Math.min(t.display.scroller.scrollLeft,n.maxScrollLeft),!0),t.display.maxLineChanged=!1);i=n.focus&&n.focus==fi();n.preparedSelection&&t.display.input.showSelection(n.preparedSelection,i);(n.updatedDisplay||n.startHeight!=t.doc.height)&&uu(t,n.barMeasure);n.updatedDisplay&&vc(t,n.barMeasure);n.selectionChanged&&fc(t);t.state.focused&&n.updateInput&&t.display.input.reset(n.typing);i&&fy(n.cm)}function pg(n){var t=n.cm,o=t.display,s=t.doc,h,i,r,u,e;if(n.updatedDisplay&&py(t,n.update),o.wheelStartX!=null&&(n.scrollTop!=null||n.scrollLeft!=null||n.scrollToPos)&&(o.wheelStartX=o.wheelStartY=null),n.scrollTop!=null&&ly(t,n.scrollTop,n.forceScroll),n.scrollLeft!=null&&lr(t,n.scrollLeft,!0,!0),n.scrollToPos&&(h=og(t,f(s,n.scrollToPos.from),f(s,n.scrollToPos.to),n.scrollToPos.margin),eg(t,h)),i=n.maybeHiddenMarkers,r=n.maybeUnhiddenMarkers,i)for(u=0;u<i.length;++u)i[u].lines.length||y(i[u],"hide");if(r)for(e=0;e<r.length;++e)r[e].lines.length&&y(r[e],"unhide");o.wrapper.offsetHeight&&(s.scrollTop=t.display.scroller.scrollTop);n.changeObjs&&y(t,"changes",t,n.changeObjs);n.update&&n.update.finish()}function ot(n,t){if(n.curOp)return t();ar(n);try{return t()}finally{vr(n)}}function b(n,t){return function(){if(n.curOp)return t.apply(n,arguments);ar(n);try{return t.apply(n,arguments)}finally{vr(n)}}}function it(n){return function(){if(this.curOp)return n.apply(this,arguments);ar(this);try{return n.apply(this,arguments)}finally{vr(this)}}}function k(n){return function(){var t=this.cm;if(!t||t.curOp)return n.apply(this,arguments);ar(t);try{return n.apply(this,arguments)}finally{vr(t)}}}function et(n,t,i,r){var u,e,o,s,h,f;t==null&&(t=n.doc.first);i==null&&(i=n.doc.first+n.doc.size);r||(r=0);u=n.display;r&&i<u.viewTo&&(u.updateLineNumbers==null||u.updateLineNumbers>t)&&(u.updateLineNumbers=t);n.curOp.viewChanged=!0;t>=u.viewTo?hi&&uh(n.doc,t)<u.viewTo&&pi(n):i<=u.viewFrom?hi&&aa(n.doc,i+r)>u.viewFrom?pi(n):(u.viewFrom+=r,u.viewTo+=r):t<=u.viewFrom&&i>=u.viewTo?pi(n):t<=u.viewFrom?(e=po(n,i,i+r,1),e?(u.view=u.view.slice(e.index),u.viewFrom=e.lineN,u.viewTo+=r):pi(n)):i>=u.viewTo?(o=po(n,t,t,-1),o?(u.view=u.view.slice(0,o.index),u.viewTo=o.lineN):pi(n)):(s=po(n,t,t,-1),h=po(n,i,i+r,1),s&&h?(u.view=u.view.slice(0,s.index).concat(ho(n,s.lineN,h.lineN)).concat(u.view.slice(h.index)),u.viewTo+=r):pi(n));f=u.externalMeasured;f&&(i<f.lineN?f.lineN+=r:t<f.lineN+f.size&&(u.externalMeasured=null))}function yi(n,t,i){var r,u,f,e;(n.curOp.viewChanged=!0,r=n.display,u=n.display.externalMeasured,u&&t>=u.lineN&&t<u.lineN+u.size&&(r.externalMeasured=null),t<r.viewFrom||t>=r.viewTo)||(f=r.view[cr(n,t)],f.node!=null)&&(e=f.changes||(f.changes=[]),d(e,i)==-1&&e.push(i))}function pi(n){n.display.viewFrom=n.display.viewTo=n.doc.first;n.display.view=[];n.display.viewOffset=0}function po(n,t,i,r){var u=cr(n,t),o,f=n.display.view,e,s;if(!hi||i==n.doc.first+n.doc.size)return{index:u,lineN:i};for(e=n.display.viewFrom,s=0;s<u;s++)e+=f[s].size;if(e!=t){if(r>0){if(u==f.length-1)return null;o=e+f[u].size-t;u++}else o=e-t;t+=o;i+=o}while(uh(n.doc,i)!=i){if(u==(r<0?0:f.length-1))return null;i+=r*f[u-(r<0?1:0)].size;u+=r}return{index:u,lineN:i}}function wg(n,t,i){var r=n.display,u=r.view;u.length==0||t>=r.viewTo||i<=r.viewFrom?(r.view=ho(n,t,i),r.viewFrom=t):(r.viewFrom>t?r.view=ho(n,t,r.viewFrom).concat(r.view):r.viewFrom<t&&(r.view=r.view.slice(cr(n,t))),r.viewFrom=t,r.viewTo<i?r.view=r.view.concat(ho(n,r.viewTo,i)):r.viewTo>i&&(r.view=r.view.slice(0,cr(n,i))));r.viewTo=i}function yy(n){for(var t,r=n.display.view,u=0,i=0;i<r.length;i++)t=r[i],t.hidden||t.node&&!t.changes||++u;return u}function ne(n,t){n.doc.highlightFrontier<n.display.viewTo&&n.state.highlight.set(t,ps(bg,n))}function bg(n){var i=n.doc;if(!(i.highlightFrontier>=n.display.viewTo)){var u=+new Date+n.options.workTime,t=lf(n,i.highlightFrontier),r=[];i.iter(t.line,Math.min(i.first+i.size,n.display.viewTo+500),function(f){var o,e,h,s;if(t.line>=n.display.viewFrom){var c=f.styles,l=f.text.length>n.options.maxHighlightLength?er(i.mode,t.state):null,a=ba(n,f,t,!0);for(l&&(t.state=l),f.styles=a.styles,o=f.styleClasses,e=a.classes,e?f.styleClasses=e:o&&(f.styleClasses=null),h=!c||c.length!=f.styles.length||o!=e&&(!o||!e||o.bgClass!=e.bgClass||o.textClass!=e.textClass),s=0;!h&&s<c.length;++s)h=c[s]!=f.styles[s];h&&r.push(t.line);f.stateAfter=t.save();t.nextLine()}else f.text.length<=n.options.maxHighlightLength&&ah(n,f.text,t),f.stateAfter=t.line%5==0?t.save():null,t.nextLine();if(+new Date>u)return ne(n,n.options.workDelay),!0});i.highlightFrontier=t.line;i.modeFrontier=Math.max(i.modeFrontier,t.line);r.length&&ot(n,function(){for(var t=0;t<r.length;t++)yi(n,r[t],"text")})}}function kg(n){var t=n.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=ti(n)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=ti(n)+"px",t.scrollbarsClipped=!0)}function dg(n){var r,i,t;return n.hasFocus()?null:(r=fi(),!r||!vi(n.display.lineDiv,r))?null:(i={activeElt:r},window.getSelection&&(t=window.getSelection(),t.anchorNode&&t.extend&&vi(n.display.lineDiv,t.anchorNode)&&(i.anchorNode=t.anchorNode,i.anchorOffset=t.anchorOffset,i.focusNode=t.focusNode,i.focusOffset=t.focusOffset)),i)}function gg(n){if(n&&n.activeElt&&n.activeElt!=fi()&&(n.activeElt.focus(),n.anchorNode&&vi(document.body,n.anchorNode)&&vi(document.body,n.focusNode))){var t=window.getSelection(),i=document.createRange();i.setEnd(n.anchorNode,n.anchorOffset);i.collapse(!1);t.removeAllRanges();t.addRange(i);t.extend(n.focusNode,n.focusOffset)}}function cc(n,i){var r=n.display,e=n.doc,s,o,h;if(i.editorIsHidden)return pi(n),!1;if(!i.force&&i.visible.from>=r.viewFrom&&i.visible.to<=r.viewTo&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo)&&r.renderedView==r.view&&yy(n)==0)return!1;hy(n)&&(pi(n),i.dims=ic(n));var c=e.first+e.size,u=Math.max(i.visible.from-n.options.viewportMargin,e.first),f=Math.min(c,i.visible.to+n.options.viewportMargin);return(r.viewFrom<u&&u-r.viewFrom<20&&(u=Math.max(e.first,r.viewFrom)),r.viewTo>f&&r.viewTo-f<20&&(f=Math.min(c,r.viewTo)),hi&&(u=uh(n.doc,u),f=aa(n.doc,f)),s=u!=r.viewFrom||f!=r.viewTo||r.lastWrapHeight!=i.wrapperHeight||r.lastWrapWidth!=i.wrapperWidth,wg(n,u,f),r.viewOffset=ei(t(n.doc,r.viewFrom)),n.display.mover.style.top=r.viewOffset+"px",o=yy(n),!s&&o==0&&!i.force&&r.renderedView==r.view&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo))?!1:(h=dg(n),o>4&&(r.lineDiv.style.display="none"),nn(n,r.updateLineNumbers,i.dims),o>4&&(r.lineDiv.style.display=""),r.renderedView=r.view,gg(h),ai(r.cursorDiv),ai(r.selectionDiv),r.gutters.style.height=r.sizer.style.minHeight=0,s&&(r.lastWrapHeight=i.wrapperHeight,r.lastWrapWidth=i.wrapperWidth,ne(n,400)),r.updateLineNumbers=null,!0)}function py(n,t){for(var r,i=t.viewport,u=!0;;u=!1){if((!u||!n.options.lineWrapping||t.oldDisplayWidth==or(n))&&(i&&i.top!=null&&(i={top:Math.min(n.doc.height+ph(n.display)-wh(n),i.top)}),t.visible=oc(n.display,n.doc,i),t.visible.from>=n.display.viewFrom&&t.visible.to<=n.display.viewTo))break;if(!cc(n,t))break;vo(n);r=gf(n);wf(n);uu(n,r);vc(n,r);t.force=!1}t.signal(n,"update",n);(n.display.viewFrom!=n.display.reportedViewFrom||n.display.viewTo!=n.display.reportedViewTo)&&(t.signal(n,"viewportChange",n,n.display.viewFrom,n.display.viewTo),n.display.reportedViewFrom=n.display.viewFrom,n.display.reportedViewTo=n.display.viewTo)}function lc(n,t){var i=new ye(n,t),r;cc(n,i)&&(vo(n),py(n,i),r=gf(n),wf(n),uu(n,r),vc(n,r),i.finish())}function nn(n,t,i){function c(t){var i=t.nextSibling;return tt&&kt&&n.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),i}for(var r,l,e,o=n.display,v=n.options.lineNumbers,s=o.lineDiv,u=s.firstChild,a=o.view,f=o.viewFrom,h=0;h<a.length;h++){if(r=a[h],!r.hidden)if(r.node&&r.node.parentNode==s){while(u!=r.node)u=c(u);e=v&&t!=null&&t<=f&&r.lineNumber;r.changes&&(d(r.changes,"gutter")>-1&&(e=!1),ev(n,r,f,i));e&&(ai(r.lineNumber),r.lineNumber.appendChild(document.createTextNode(nh(n.options,f))));u=r.node.nextSibling}else l=wd(n,r,f,i),s.insertBefore(l,u);f+=r.size}while(u)u=c(u)}function ac(n){var t=n.display.gutters.offsetWidth;n.display.sizer.style.marginLeft=t+"px"}function vc(n,t){n.display.sizer.style.minHeight=t.docHeight+"px";n.display.heightForcer.style.top=t.docHeight+"px";n.display.gutters.style.height=t.docHeight+n.display.barHeight+ti(n)+"px"}function wy(n){var r=n.display.gutters,e=n.options.gutters,t,u,f;for(ai(r),t=0;t<e.length;++t)u=e[t],f=r.appendChild(i("div",null,"CodeMirror-gutter "+u)),u=="CodeMirror-linenumbers"&&(n.display.lineGutter=f,f.style.width=(n.display.lineNumWidth||1)+"px");r.style.display=t?"":"none";ac(n)}function yc(n){var t=d(n.gutters,"CodeMirror-linenumbers");t==-1&&n.lineNumbers?n.gutters=n.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!n.lineNumbers&&(n.gutters=n.gutters.slice(0),n.gutters.splice(t,1))}function by(n){var i=n.wheelDeltaX,t=n.wheelDeltaY;return i==null&&n.detail&&n.axis==n.HORIZONTAL_AXIS&&(i=n.detail),t==null&&n.detail&&n.axis==n.VERTICAL_AXIS?t=n.detail:t==null&&(t=n.wheelDelta),{x:i,y:t}}function tn(n){var t=by(n);return t.x*=st,t.y*=st,t}function ky(n,t){var v=by(t),e=v.x,u=v.y,i=n.display,r=i.scroller,y=r.scrollWidth>r.clientWidth,h=r.scrollHeight>r.clientHeight,f,c,o;if(e&&y||u&&h){if(u&&kt&&tt)n:for(f=t.target,c=i.view;f!=r;f=f.parentNode)for(o=0;o<c.length;o++)if(c[o].node==f){n.display.currentWheelTarget=f;break n}if(e&&!ki&&!bt&&st!=null){u&&h&&df(n,Math.max(0,r.scrollTop+u*st));lr(n,Math.max(0,r.scrollLeft+e*st));(!u||u&&h)&&ft(t);i.wheelStartX=null;return}if(u&&st!=null){var l=u*st,s=n.doc.scrollTop,a=s+i.wrapper.clientHeight;l<0?s=Math.max(0,s+l-50):a=Math.min(n.doc.height,a+l+50);lc(n,{top:s,bottom:a})}pe<20&&(i.wheelStartX==null?(i.wheelStartX=r.scrollLeft,i.wheelStartY=r.scrollTop,i.wheelDX=e,i.wheelDY=u,setTimeout(function(){if(i.wheelStartX!=null){var n=r.scrollLeft-i.wheelStartX,t=r.scrollTop-i.wheelStartY,u=t&&i.wheelDY&&t/i.wheelDY||n&&i.wheelDX&&n/i.wheelDX;(i.wheelStartX=i.wheelStartY=null,u)&&(st=(st*pe+u)/(pe+1),++pe)}},200)):(i.wheelDX+=e,i.wheelDY+=u))}}function wt(n,t){var c=n[t],i,f,r;for(n.sort(function(n,t){return u(n.from(),t.from())}),t=d(n,c),i=1;i<n.length;i++)if(f=n[i],r=n[i-1],u(r.to(),f.from())>=0){var e=ro(r.from(),f.from()),s=io(r.to(),f.to()),h=r.empty()?f.from()==f.head:r.from()==r.head;i<=t&&--t;n.splice(--i,2,new o(h?s:e,h?e:s))}return new ht(n,t)}function wi(n,t){return new ht([new o(n,t||n)],0)}function bi(t){return t.text?n(t.from.line+t.text.length-1,s(t.text).length+(t.text.length==1?t.from.ch:0)):t.to}function dy(t,i){if(u(t,i.from)<0)return t;if(u(t,i.to)<=0)return bi(i);var f=t.line+i.text.length-(i.to.line-i.from.line)-1,r=t.ch;return t.line==i.to.line&&(r+=bi(i).ch-i.to.ch),n(f,r)}function pc(n,t){for(var i,u=[],r=0;r<n.sel.ranges.length;r++)i=n.sel.ranges[r],u.push(new o(dy(i.anchor,t),dy(i.head,t)));return wt(u,n.sel.primIndex)}function gy(t,i,r){return t.line==i.line?n(r.line,t.ch-i.ch+r.ch):n(r.line+(t.line-i.line),t.ch)}function rn(t,i,r){for(var h,c,l=[],e=n(t.first,0),a=e,f=0;f<i.length;f++){var v=i[f],s=gy(v.from,e,a),y=gy(bi(v),e,a);e=v.to;a=y;r=="around"?(h=t.sel.ranges[f],c=u(h.head,h.anchor)<0,l[f]=new o(c?y:s,c?s:y)):l[f]=new o(s,s)}return new ht(l,t.sel.primIndex)}function wc(n){n.doc.mode=ch(n.options,n.doc.modeOption);te(n)}function te(n){n.doc.iter(function(n){n.stateAfter&&(n.stateAfter=null);n.styles&&(n.styles=null)});n.doc.modeFrontier=n.doc.highlightFrontier=n.doc.first;ne(n,100);n.state.modeGen++;n.curOp&&et(n)}function np(n,t){return t.from.ch==0&&t.to.ch==0&&s(t.text)==""&&(!n.cm||n.cm.options.wholeLineUpdateBefore)}function bc(n,i,r,u){function a(n){return r?r[n]:null}function h(n,t,r){id(n,t,r,u);g(n,"change",n,i)}function y(n,t){for(var r=[],i=n;i<t;++i)r.push(new kr(f[i],a(i),u));return r}var e=i.from,c=i.to,f=i.text,o=t(n,e.line),l=t(n,c.line),w=s(f),p=a(f.length-1),v=c.line-e.line,b,k,d;i.full?(n.insert(0,y(0,f.length)),n.remove(f.length,n.size-f.length)):np(n,i)?(b=y(0,f.length-1),h(l,l.text,p),v&&n.remove(e.line,v),b.length&&n.insert(e.line,b)):o==l?f.length==1?h(o,o.text.slice(0,e.ch)+w+o.text.slice(c.ch),p):(k=y(1,f.length-1),k.push(new kr(w+o.text.slice(c.ch),p,u)),h(o,o.text.slice(0,e.ch)+f[0],a(0)),n.insert(e.line+1,k)):f.length==1?(h(o,o.text.slice(0,e.ch)+f[0]+l.text.slice(c.ch),a(0)),n.remove(e.line+1,v)):(h(o,o.text.slice(0,e.ch)+f[0],a(0)),h(l,w+l.text.slice(c.ch),p),d=y(1,f.length-1),v>1&&n.remove(e.line+1,v-1),n.insert(e.line+1,d));g(n,"change",n,i)}function yr(n,t,i){function r(n,u,f){var o,e,s;if(n.linked)for(o=0;o<n.linked.length;++o)(e=n.linked[o],e.doc!=u)&&(s=f&&e.sharedHist,!i||s)&&(t(e.doc,s),r(e.doc,n,s))}r(n,null,!0)}function tp(n,t){if(t.cm)throw new Error("This document is already in use.");n.doc=t;t.cm=n;uc(n);wc(n);ip(n);n.options.lineWrapping||eh(n);n.options.mode=t.modeOption;et(n)}function ip(n){(n.doc.direction=="rtl"?tr:di)(n.display.lineDiv,"CodeMirror-rtl")}function un(n){ot(n,function(){ip(n);et(n)})}function wo(n){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOp=this.lastSelOp=null;this.lastOrigin=this.lastSelOrigin=null;this.generation=this.maxGeneration=n||1}function kc(n,t){var i={from:ih(t.from),to:bi(t),text:rr(n,t.from,t.to)};return fp(n,i,t.from.line,t.to.line+1),yr(n,function(n){return fp(n,i,t.from.line,t.to.line+1)},!0),i}function rp(n){while(n.length){var t=s(n);if(t.ranges)n.pop();else break}}function fn(n,t){return t?(rp(n.done),s(n.done)):n.done.length&&!s(n.done).ranges?s(n.done):n.done.length>1&&!n.done[n.done.length-2].ranges?(n.done.pop(),s(n.done)):void 0}function up(n,t,i,r){var f=n.history,h,e,o,c;if(f.undone.length=0,h=+new Date,(f.lastOp==r||f.lastOrigin==t.origin&&t.origin&&(t.origin.charAt(0)=="+"&&n.cm&&f.lastModTime>h-n.cm.options.historyEventDelay||t.origin.charAt(0)=="*"))&&(e=fn(f,f.lastOp==r)))o=s(e.changes),u(t.from,t.to)==0&&u(t.from,o.to)==0?o.to=bi(t):e.changes.push(kc(n,t));else for(c=s(f.done),c&&c.ranges||bo(n.sel,f.done),e={changes:[kc(n,t)],generation:f.generation},f.done.push(e);f.done.length>f.undoDepth;)f.done.shift(),f.done[0].ranges||f.done.shift();f.done.push(i);f.generation=++f.maxGeneration;f.lastModTime=f.lastSelTime=h;f.lastOp=f.lastSelOp=r;f.lastOrigin=f.lastSelOrigin=t.origin;o||y(n,"historyAdded")}function en(n,t,i,r){var u=t.charAt(0);return u=="*"||u=="+"&&i.ranges.length==r.ranges.length&&i.somethingSelected()==r.somethingSelected()&&new Date-n.history.lastSelTime<=(n.cm?n.cm.options.historyEventDelay:500)}function on(n,t,i,r){var u=n.history,f=r&&r.origin;i==u.lastSelOp||f&&u.lastSelOrigin==f&&(u.lastModTime==u.lastSelTime&&u.lastOrigin==f||en(n,f,s(u.done),t))?u.done[u.done.length-1]=t:bo(t,u.done);u.lastSelTime=+new Date;u.lastSelOrigin=f;u.lastSelOp=i;r&&r.clearRedo!==!1&&rp(u.undone)}function bo(n,t){var i=s(t);i&&i.ranges&&i.equals(n)||t.push(n)}function fp(n,t,i,r){var u=t["spans_"+n.id],f=0;n.iter(Math.max(n.first,i),Math.min(n.first+n.size,r),function(i){i.markedSpans&&((u||(u=t["spans_"+n.id]={}))[f]=i.markedSpans);++f})}function sn(n){var t,i;if(!n)return null;for(i=0;i<n.length;++i)n[i].marker.explicitlyCleared?t||(t=n.slice(0,i)):t&&t.push(n[i]);return t?t.length?t:null:n}function hn(n,t){var u=t["spans_"+n.id],r,i;if(!u)return null;for(r=[],i=0;i<t.text.length;++i)r.push(sn(u[i]));return r}function ep(n,t){var i=hn(n,t),s=rh(n,t),r,f,u,e,h,o;if(!i)return s;if(!s)return i;for(r=0;r<i.length;++r)if(f=i[r],u=s[r],f&&u)n:for(e=0;e<u.length;++e){for(h=u[e],o=0;o<f.length;++o)if(f[o].marker==h.marker)continue n;f.push(h)}else u&&(i[r]=u);return i}function fu(n,t,i){for(var u,h,e,o,r,c,f,l=[],a=0;a<n.length;++a){if(u=n[a],u.ranges){l.push(i?ht.prototype.deepCopy.call(u):u);continue}for(h=u.changes,e=[],l.push({changes:e}),o=0;o<h.length;++o)if(r=h[o],c=void 0,e.push({from:r.from,to:r.to,text:r.text}),t)for(f in r)(c=f.match(/^spans_(\d+)$/))&&d(t,Number(c[1]))>-1&&(s(e)[f]=r[f],delete r[f])}return l}function dc(n,t,i,r){var f,e;return r?(f=n.anchor,i&&(e=u(t,f)<0,e!=u(i,f)<0?(f=t,t=i):e!=u(t,i)<0&&(t=i)),new o(f,t)):new o(i||t,t)}function ko(n,t,i,r,u){u==null&&(u=n.cm&&(n.cm.display.shift||n.extend));nt(n,new ht([dc(n.sel.primary(),t,i,u)],0),r)}function op(n,t,i){for(var u,f=[],e=n.cm&&(n.cm.display.shift||n.extend),r=0;r<n.sel.ranges.length;r++)f[r]=dc(n.sel.ranges[r],t[r],null,e);u=wt(f,n.sel.primIndex);nt(n,u,i)}function gc(n,t,i,r){var u=n.sel.ranges.slice(0);u[t]=i;nt(n,wt(u,n.sel.primIndex),r)}function sp(n,t,i,r){nt(n,wi(t,i),r)}function cn(n,t,i){var r={ranges:t.ranges,update:function(t){var r=this,i;for(this.ranges=[],i=0;i<t.length;i++)r.ranges[i]=new o(f(n,t[i].anchor),f(n,t[i].head))},origin:i&&i.origin};return y(n,"beforeSelectionChange",n,r),n.cm&&y(n.cm,"beforeSelectionChange",n.cm,r),r.ranges!=t.ranges?wt(r.ranges,r.ranges.length-1):t}function hp(n,t,i){var r=n.history.done,u=s(r);u&&u.ranges?(r[r.length-1]=t,go(n,t,i)):nt(n,t,i)}function nt(n,t,i){go(n,t,i);on(n,n.sel,n.cm?n.cm.curOp.id:NaN,i)}function go(n,t,i){(vt(n,"beforeSelectionChange")||n.cm&&vt(n.cm,"beforeSelectionChange"))&&(t=cn(n,t,i));var r=i&&i.bias||(u(t.primary().head,n.sel.primary().head)<0?-1:1);cp(n,ap(n,t,r,!0));i&&i.scroll===!1||!n.cm||ru(n.cm)}function cp(n,t){t.equals(n.sel)||(n.sel=t,n.cm&&(n.cm.curOp.updateInput=n.cm.curOp.selectionChanged=!0,va(n.cm)),g(n,"cursorActivity",n))}function lp(n){cp(n,ap(n,n.sel,null,!1))}function ap(n,t,i,r){for(var f,u=0;u<t.ranges.length;u++){var e=t.ranges[u],s=t.ranges.length==n.sel.ranges.length&&n.sel.ranges[u],h=nl(n,e.anchor,s&&s.anchor,i,r),c=nl(n,e.head,s&&s.head,i,r);(f||h!=e.anchor||c!=e.head)&&(f||(f=t.ranges.slice(0,u)),f[u]=new o(h,c))}return f?wt(f,t.primIndex):t}function eu(n,i,r,f,e){var c=t(n,i.line),a,h,o,s,v,l;if(c.markedSpans)for(a=0;a<c.markedSpans.length;++a)if(h=c.markedSpans[a],o=h.marker,(h.from==null||(o.inclusiveLeft?h.from<=i.ch:h.from<i.ch))&&(h.to==null||(o.inclusiveRight?h.to>=i.ch:h.to>i.ch))){if(e&&(y(o,"beforeCursorEnter"),o.explicitlyCleared))if(c.markedSpans){--a;continue}else break;if(!o.atomic)continue;return r&&(s=o.find(f<0?1:-1),v=void 0,(f<0?o.inclusiveRight:o.inclusiveLeft)&&(s=vp(n,s,-f,s&&s.line==i.line?c:null)),s&&s.line==i.line&&(v=u(s,r))&&(f<0?v<0:v>0))?eu(n,s,i,f,e):(l=o.find(f<0?-1:1),(f<0?o.inclusiveLeft:o.inclusiveRight)&&(l=vp(n,l,f,l.line==i.line?c:null)),l?eu(n,l,i,f,e):null)}return i}function nl(t,i,r,u,f){var e=u||1,o=eu(t,i,r,e,f)||!f&&eu(t,i,r,e,!0)||eu(t,i,r,-e,f)||!f&&eu(t,i,r,-e,!0);return o?o:(t.cantEdit=!0,n(t.first,0))}function vp(i,r,u,e){return u<0&&r.ch==0?r.line>i.first?f(i,n(r.line-1)):null:u>0&&r.ch==(e||t(i,r.line)).text.length?r.line<i.first+i.size-1?n(r.line+1,0):null:new n(r.line,r.ch+u)}function yp(t){t.setSelection(n(t.firstLine(),0),n(t.lastLine()),ui)}function pp(n,t,i){var r={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return r.canceled=!0}};return(i&&(r.update=function(t,i,u,e){t&&(r.from=f(n,t));i&&(r.to=f(n,i));u&&(r.text=u);e!==undefined&&(r.origin=e)}),y(n,"beforeChange",n,r),n.cm&&y(n.cm,"beforeChange",n.cm,r),r.canceled)?null:{from:r.from,to:r.to,text:r.text,origin:r.origin}}function ou(n,t,i){var u,r;if(n.cm){if(!n.cm.curOp)return b(n.cm,ou)(n,t,i);if(n.cm.state.suppressEdits)return}if(!vt(n,"beforeChange")&&(!n.cm||!vt(n.cm,"beforeChange"))||(t=pp(n,t,!0),t))if(u=ol&&!i&&lk(n,t.from,t.to),u)for(r=u.length-1;r>=0;--r)wp(n,{from:u[r].from,to:u[r].to,text:r?[""]:t.text,origin:t.origin});else wp(n,t)}function wp(n,t){var i,r;(t.text.length!=1||t.text[0]!=""||u(t.from,t.to)!=0)&&(i=pc(n,t),up(n,t,i,n.cm?n.cm.curOp.id:NaN),ie(n,t,i,rh(n,t)),r=[],yr(n,function(n,i){i||d(r,n.history)!=-1||(gp(n.history,t),r.push(n.history));ie(n,t,null,rh(n,t))}))}function ns(n,t,i){var h,a,v,e,c;if(!n.cm||!n.cm.state.suppressEdits||i){for(var u=n.history,r,y=n.sel,f=t=="undo"?u.done:u.undone,l=t=="undo"?u.undone:u.done,o=0;o<f.length;o++)if(r=f[o],i?r.ranges&&!r.equals(n.sel):!r.ranges)break;if(o!=f.length){for(u.lastOrigin=u.lastSelOrigin=null;;)if(r=f.pop(),r.ranges){if(bo(r,l),i&&!r.equals(n.sel)){nt(n,r,{clearRedo:!1});return}y=r}else break;for(h=[],bo(y,l),l.push({changes:h,generation:u.generation}),u.generation=r.generation||++u.maxGeneration,a=vt(n,"beforeChange")||n.cm&&vt(n.cm,"beforeChange"),v=function(i){var u=r.changes[i],o,e;if(u.origin=t,a&&!pp(n,u,!1))return f.length=0,{};h.push(kc(n,u));o=i?pc(n,u):s(f);ie(n,u,o,ep(n,u));!i&&n.cm&&n.cm.scrollIntoView({from:u.from,to:bi(u)});e=[];yr(n,function(n,t){t||d(e,n.history)!=-1||(gp(n.history,u),e.push(n.history));ie(n,u,null,ep(n,u))})},e=r.changes.length-1;e>=0;--e)if(c=v(e),c)return c.v}}}function bp(t,i){if(i!=0&&(t.first+=i,t.sel=new ht(no(t.sel.ranges,function(t){return new o(n(t.anchor.line+i,t.anchor.ch),n(t.head.line+i,t.head.ch))}),t.sel.primIndex),t.cm)){et(t.cm,t.first,t.first-i,i);for(var u=t.cm.display,r=u.viewFrom;r<u.viewTo;r++)yi(t.cm,r,"gutter")}}function ie(i,r,u,f){var o,e;if(i.cm&&!i.cm.curOp)return b(i.cm,ie)(i,r,u,f);if(r.to.line<i.first){bp(i,r.text.length-1-(r.to.line-r.from.line));return}r.from.line>i.lastLine()||(r.from.line<i.first&&(o=r.text.length-1-(i.first-r.from.line),bp(i,o),r={from:n(i.first,0),to:n(r.to.line+o,r.to.ch),text:[s(r.text)],origin:r.origin}),e=i.lastLine(),r.to.line>e&&(r={from:r.from,to:n(e,t(i,e).text.length),text:[r.text[0]],origin:r.origin}),r.removed=rr(i,r.from,r.to),u||(u=pc(i,r)),i.cm?ln(i.cm,r,f):bc(i,r,f),go(i,u,ui))}function ln(n,i,r){var f=n.doc,e=n.display,u=i.from,o=i.to,s=!1,c=u.line,y,l,a,v;n.options.lineWrapping||(c=h(ni(t(f,u.line))),f.iter(c,o.line+1,function(n){if(n==e.maxLine)return s=!0,!0}));f.sel.contains(i.from,i.to)>-1&&va(n);bc(f,i,r,iy(n));n.options.lineWrapping||(f.iter(c,u.line+i.text.length,function(n){var t=oo(n);t>e.maxLineLength&&(e.maxLine=n,e.maxLineLength=t,e.maxLineChanged=!0,s=!1)}),s&&(n.curOp.updateMaxLine=!0));td(f,u.line);ne(n,400);y=i.text.length-(o.line-u.line)-1;i.full?et(n):u.line!=o.line||i.text.length!=1||np(n.doc,i)?et(n,u.line,o.line+1,y):yi(n,u.line,"text");l=vt(n,"changes");a=vt(n,"change");(a||l)&&(v={from:u,to:o,text:i.text,removed:i.removed,origin:i.origin},a&&g(n,"change",n,v),l&&(n.curOp.changeObjs||(n.curOp.changeObjs=[])).push(v));n.display.selForContextMenu=null}function su(n,t,i,r,f){if(r||(r=i),u(r,i)<0){var e;e=[r,i];i=e[0];r=e[1];e}typeof t=="string"&&(t=n.splitLines(t));ou(n,{from:i,to:r,text:t,origin:f})}function kp(n,t,i,r){i<n.line?n.line+=r:t<n.line&&(n.line=t,n.ch=0)}function dp(t,i,r,u){for(var f,c,s,h,e,o=0;o<t.length;++o){if(f=t[o],c=!0,f.ranges){for(f.copied||(f=t[o]=f.deepCopy(),f.copied=!0),s=0;s<f.ranges.length;s++)kp(f.ranges[s].anchor,i,r,u),kp(f.ranges[s].head,i,r,u);continue}for(h=0;h<f.changes.length;++h)if(e=f.changes[h],r<e.from.line)e.from=n(e.from.line+u,e.from.ch),e.to=n(e.to.line+u,e.to.ch);else if(i<=e.to.line){c=!1;break}c||(t.splice(0,o+1),o=0)}}function gp(n,t){var i=t.from.line,r=t.to.line,u=t.text.length-(r-i)-1;dp(n.done,i,r,u);dp(n.undone,i,r,u)}function re(n,i,r,u){var f=i,e=i;return(typeof i=="number"?e=t(n,ra(n,i)):f=h(i),f==null)?null:(u(e,f)&&n.cm&&yi(n.cm,f,r),e)}function ue(n){var r=this,i,t;for(this.lines=n,this.parent=null,i=0,t=0;t<n.length;++t)n[t].parent=r,i+=n[t].height;this.height=i}function fe(n){var f=this,r,u,t,i;for(this.children=n,r=0,u=0,t=0;t<n.length;++t)i=n[t],r+=i.chunkSize(),u+=i.height,i.parent=f;this.size=r;this.height=u;this.parent=null}function nw(n,t,i){ei(t)<(n.curOp&&n.curOp.scrollTop||n.doc.scrollTop)&&hc(n,i)}function an(n,t,i,r){var u=new ku(n,i,r),f=n.cm;return f&&u.noHScroll&&(f.display.alignWidgets=!0),re(n,t,"widget",function(t){var i=t.widgets||(t.widgets=[]),r;return u.insertAt==null?i.push(u):i.splice(Math.min(i.length-1,Math.max(0,u.insertAt)),0,u),u.line=t,f&&!fr(n,t)&&(r=ei(t)<n.scrollTop,gt(t,t.height+vf(u)),r&&hc(f,u.height),f.curOp.forceUpdate=!0),!0}),g(f,"lineWidgetAdded",f,u,typeof t=="number"?t:h(t)),u}function hu(n,t,i,f,e){var o,l,h,s,a,c;if(f&&f.shared)return vn(n,t,i,f,e);if(n.cm&&!n.cm.curOp)return b(n.cm,hu)(n,t,i,f,e);if(o=new ci(n,e),l=u(t,i),f&&ir(f,o,!1),l>0||l==0&&o.clearWhenEmpty!==!1)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=nu("span",[o.replacedWith],"CodeMirror-widget"),f.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),f.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(la(n,t.line,t,i,o)||t.line!=i.line&&la(n,i.line,t,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");ek()}if(o.addToHistory&&up(n,{from:t,to:i,origin:"markText"},n.sel,NaN),h=t.line,s=n.cm,n.iter(h,i.line+1,function(n){s&&o.collapsed&&!s.options.lineWrapping&&ni(n)==s.display.maxLine&&(a=!0);o.collapsed&&h!=t.line&&gt(n,0);sk(n,new uo(o,h==t.line?t.ch:null,h==i.line?i.ch:null));++h}),o.collapsed&&n.iter(t.line,i.line+1,function(t){fr(n,t)&&gt(t,0)}),o.clearOnEnter&&r(o,"beforeCursorEnter",function(){return o.clear()}),o.readOnly&&(fk(),(n.history.done.length||n.history.undone.length)&&n.clearHistory()),o.collapsed&&(o.id=++yl,o.atomic=!0),s){if(a&&(s.curOp.updateMaxLine=!0),o.collapsed)et(s,t.line,i.line+1);else if(o.className||o.title||o.startStyle||o.endStyle||o.css)for(c=t.line;c<=i.line;c++)yi(s,c,"text");o.atomic&&lp(s.doc);g(s,"markerAdded",s,o)}return o}function vn(n,t,i,r,u){r=ir(r);r.shared=!1;var e=[hu(n,t,i,r,u)],o=e[0],h=r.widgetNode;return yr(n,function(n){h&&(r.widgetNode=h.cloneNode(!0));e.push(hu(n,f(n,t),f(n,i),r,u));for(var c=0;c<n.linked.length;++c)if(n.linked[c].isParent)return;o=s(e)}),new du(e,o)}function tw(t){return t.findMarks(n(t.first,0),t.clipPos(n(t.lastLine())),function(n){return n.parent})}function yn(n,t){for(var f,r=0;r<t.length;r++){var i=t[r],e=i.find(),o=n.clipPos(e.from),s=n.clipPos(e.to);u(o,s)&&(f=hu(n,o,s,i.primary,i.primary.type),i.markers.push(f),f.parent=i)}}function pn(n){for(var i=function(t){var i=n[t],f=[i.primary.doc],r,u;for(yr(i.primary.doc,function(n){return f.push(n)}),r=0;r<i.markers.length;r++)u=i.markers[r],d(f,u.doc)==-1&&(u.parent=null,i.markers.splice(r--,1))},t=0;t<n.length;t++)i(t)}function wn(n){var t=this,i,r,u,h,o,s;if((iw(t),!w(t,n)&&!si(t.display,n))&&(ft(n),e&&(pl=+new Date),i=hr(t,n,!0),r=n.dataTransfer.files,i&&!t.isReadOnly()))if(r&&r.length&&window.FileReader&&window.File){var c=r.length,l=Array(c),a=0,v=function(n,r){if(!t.options.allowDropFileTypes||d(t.options.allowDropFileTypes,n.type)!=-1){var u=new FileReader;u.onload=b(t,function(){var n=u.result,e;/[\x00-\x08\x0e-\x1f]{2}/.test(n)&&(n="");l[r]=n;++a==c&&(i=f(t.doc,i),e={from:i,to:i,text:t.doc.splitLines(l.join(t.doc.lineSeparator())),origin:"paste"},ou(t.doc,e),hp(t.doc,wi(i,bi(e))))});u.readAsText(n)}};for(u=0;u<c;++u)v(r[u],u)}else{if(t.state.draggingText&&t.doc.sel.contains(i)>-1){t.state.draggingText(n);setTimeout(function(){return t.display.input.focus()},20);return}try{if(h=n.dataTransfer.getData("Text"),h){if(t.state.draggingText&&!t.state.draggingText.copy&&(o=t.listSelections()),go(t.doc,wi(i,i)),o)for(s=0;s<o.length;++s)su(t.doc,"",o[s].anchor,o[s].head,"drag");t.replaceSelection(h,"around","paste");t.display.input.focus()}}catch(n){}}}function bn(n,t){if(e&&(!n.state.draggingText||+new Date-pl<100)){cf(t);return}if(!w(n,t)&&!si(n.display,t)&&(t.dataTransfer.setData("Text",n.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!hb)){var r=i("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";bt&&(r.width=r.height=1,n.display.wrapper.appendChild(r),r._top=r.offsetTop);t.dataTransfer.setDragImage(r,0,0);bt&&r.parentNode.removeChild(r)}}function kn(n,t){var u=hr(n,t),r;u&&(r=document.createDocumentFragment(),uy(n,u,r),n.display.dragCursor||(n.display.dragCursor=i("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),n.display.lineSpace.insertBefore(n.display.dragCursor,n.display.cursorDiv)),ct(n.display.dragCursor,r))}function iw(n){n.display.dragCursor&&(n.display.lineSpace.removeChild(n.display.dragCursor),n.display.dragCursor=null)}function rw(n){var i,t,r;if(document.getElementsByClassName)for(i=document.getElementsByClassName("CodeMirror"),t=0;t<i.length;t++)r=i[t].CodeMirror,r&&n(r)}function dn(){wl||(gn(),wl=!0)}function gn(){var n;r(window,"resize",function(){n==null&&(n=setTimeout(function(){n=null;rw(ntt)},100))});r(window,"blur",function(){return rw(bf)})}function ntt(n){var t=n.display;(t.lastWrapHeight!=t.wrapper.clientHeight||t.lastWrapWidth!=t.wrapper.clientWidth)&&(t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,n.setSize())}function ttt(n){var i=n.split(/-(?!$)/),u,f,e,o,r,t;for(n=i[i.length-1],r=0;r<i.length-1;r++)if(t=i[r],/^(cmd|meta|m)$/i.test(t))o=!0;else if(/^a(lt)?$/i.test(t))u=!0;else if(/^(c|ctrl|control)$/i.test(t))f=!0;else if(/^s(hift)?$/i.test(t))e=!0;else throw new Error("Unrecognized modifier name: "+t);return u&&(n="Alt-"+n),f&&(n="Ctrl-"+n),o&&(n="Cmd-"+n),e&&(n="Shift-"+n),n}function itt(n){var e={},t,o,r,u,f,i,s,h;for(t in n)if(n.hasOwnProperty(t)){if(o=n[t],/^(name|fallthrough|(de|at)tach)$/.test(t))continue;if(o=="..."){delete n[t];continue}for(r=no(t.split(" "),ttt),u=0;u<r.length;u++)if(f=void 0,i=void 0,u==r.length-1?(i=r.join(" "),f=o):(i=r.slice(0,u+1).join(" "),f="..."),s=e[i],s){if(s!=f)throw new Error("Inconsistent bindings for "+i);}else e[i]=f;delete n[t]}for(h in e)n[h]=e[h];return n}function cu(n,t,i,r){var u,f,e;if(t=ts(t),u=t.call?t.call(n,r):t[n],u===!1)return"nothing";if(u==="...")return"multi";if(u!=null&&i(u))return"handled";if(t.fallthrough){if(Object.prototype.toString.call(t.fallthrough)!="[object Array]")return cu(n,t.fallthrough,i,r);for(f=0;f<t.fallthrough.length;f++)if(e=cu(n,t.fallthrough[f],i,r),e)return e}}function uw(n){var t=typeof n=="string"?n:li[n.keyCode];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function fw(n,t,i){var r=n;return t.altKey&&r!="Alt"&&(n="Alt-"+n),(el?t.metaKey:t.ctrlKey)&&r!="Ctrl"&&(n="Ctrl-"+n),(el?t.ctrlKey:t.metaKey)&&r!="Cmd"&&(n="Cmd-"+n),!i&&t.shiftKey&&r!="Shift"&&(n="Shift-"+n),n}function ew(n,t){if(bt&&n.keyCode==34&&n.char)return!1;var i=li[n.keyCode];return i==null||n.altGraphKey?!1:fw(i,n,t)}function ts(n){return typeof n=="string"?ri[n]:n}function lu(n,t){for(var r,f,o=n.doc.sel.ranges,i=[],e=0;e<o.length;e++){for(r=t(o[e]);i.length&&u(r.from,s(i).to)<=0;)if(f=i.pop(),u(f.from,r.from)<0){r.from=f.from;break}i.push(r)}ot(n,function(){for(var t=i.length-1;t>=0;t--)su(n.doc,"",i[t].from,i[t].to,"+delete");ru(n)})}function tl(n,t,i){var r=ia(n.text,t+i,i);return r<0||r>n.text.length?null:r}function ow(t,i,r){var u=tl(t,i.ch,r);return u==null?null:new n(i.line,u,r<0?"after":"before")}function il(t,i,r,u,f){var h,c,l;if(t&&(h=oi(r,i.doc.direction),h)){var o=f<0?s(h):h[0],v=f<0==(o.level==1),a=v?"after":"before",e;return o.level>0||i.doc.direction=="rtl"?(c=iu(i,r),e=f<0?r.text.length-1:0,l=ii(i,c,e).top,e=ff(function(n){return ii(i,c,n).top==l},f<0==(o.level==1)?o.from:o.to-1,e),a=="before"&&(e=tl(r,e,1))):e=f<0?o.to:o.from,new n(u,e,a)}return new n(u,f<0?r.text.length:0,f<0?"before":"after")}function rtt(t,i,r,u){var o=oi(i,t.doc.direction),v,f,l,e,w,y,s,a;if(!o||(r.ch>=i.text.length?(r.ch=i.text.length,r.sticky="before"):r.ch<=0&&(r.ch=0,r.sticky="after"),v=hf(o,r.ch,r.sticky),f=o[v],t.doc.direction=="ltr"&&f.level%2==0&&(u>0?f.to>r.ch:f.from<r.ch)))return ow(i,r,u);var h=function(t,r){return tl(i,t instanceof n?t.ch:t,r)},p,b=function(n){return t.options.lineWrapping?(p=p||iu(t,i),ty(t,i,p,n)):{begin:0,end:i.text.length}},c=b(r.sticky=="before"?h(r,-1):r.ch);return(t.doc.direction=="rtl"||f.level==1)&&(l=f.level==1==u<0,e=h(r,l?1:-1),e!=null&&(l?e<=f.to&&e<=c.end:e>=f.from&&e>=c.begin))?(w=l?"before":"after",new n(r.line,e,w)):(y=function(t,i,u){for(var c=function(t,i){return i?new n(r.line,h(t,1),"before"):new n(r.line,t,"after")};t>=0&&t<o.length;t+=i){var e=o[t],s=i>0==(e.level!=1),f=s?u.begin:h(u.end,-1);if(e.from<=f&&f<e.to||(f=s?e.from:h(e.to,-1),u.begin<=f&&f<u.end))return c(f,s)}},s=y(v+u,u,c),s)?s:(a=u>0?c.end:h(c.begin,-1),a!=null&&!(u>0&&a==i.text.length)&&(s=y(u>0?0:o.length-1,u,b(a)),s))?s:null}function sw(n,i){var u=t(n.doc,i),r=ni(u);return r!=u&&(i=h(r)),il(!0,n,r,i,1)}function utt(n,i){var r=t(n.doc,i),u=ak(r);return u!=r&&(i=h(u)),il(!0,n,r,i,-1)}function hw(i,r){var u=sw(i,r.line),e=t(i.doc,u.line),o=oi(e,i.doc.direction),f,s;return!o||o[0].level==0?(f=Math.max(0,e.text.search(/\S/)),s=r.line==u.line&&r.ch<=f&&r.ch,n(u.line,s?0:f,u.sticky)):u}function is(n,t,i){if(typeof t=="string"&&(t=tf[t],!t))return!1;n.display.input.ensurePolled();var u=n.display.shift,r=!1;try{n.isReadOnly()&&(n.state.suppressEdits=!0);i&&(n.display.shift=!1);r=t(n)!=as}finally{n.display.shift=u;n.state.suppressEdits=!1}return r}function ftt(n,t,i){for(var r,u=0;u<n.state.keyMaps.length;u++)if(r=cu(t,n.state.keyMaps[u],i,n),r)return r;return n.options.extraKeys&&cu(t,n.options.extraKeys,i,n)||cu(t,n.options.keyMap,i,n)}function ee(n,t,i,r){var u=n.state.keySeq;if(u){if(uw(t))return"handled";if(/\'$/.test(t)?n.state.keySeq=null:kb.set(50,function(){n.state.keySeq==u&&(n.state.keySeq=null,n.display.input.reset())}),cw(n,u+" "+t,i,r))return!0}return cw(n,t,i,r)}function cw(n,t,i,r){var u=ftt(n,t,r);return u=="multi"&&(n.state.keySeq=t),u=="handled"&&g(n,"keyHandled",n,t,i),(u=="handled"||u=="multi")&&(ft(i),fc(n)),!!u}function lw(n,t){var i=ew(t,!0);return i?t.shiftKey&&!n.state.keySeq?ee(n,"Shift-"+i,t,function(t){return is(n,t,!0)})||ee(n,i,t,function(t){if(typeof t=="string"?/^go[A-Z]/.test(t):t.motion)return is(n,t)}):ee(n,i,t,function(t){return is(n,t)}):!1}function ett(n,t,i){return ee(n,"'"+i+"'",t,function(t){return is(n,t,!0)})}function aw(n){var t=this,i,r;(t.curOp.focus=fi(),w(t,n))||(e&&l<11&&n.keyCode==27&&(n.returnValue=!1),i=n.keyCode,t.display.shift=i==16||n.shiftKey,r=lw(t,n),bt&&(hs=r?i:null,r||i!=88||lit||!(kt?n.metaKey:n.ctrlKey)||t.replaceSelection("",null,"cut")),i!=18||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||ott(t))}function ott(n){function t(n){n.keyCode!=18&&n.altKey||(di(i,"CodeMirror-crosshair"),lt(document,"keyup",t),lt(document,"mouseover",t))}var i=n.display.lineDiv;tr(i,"CodeMirror-crosshair");r(document,"keyup",t);r(document,"mouseover",t)}function vw(n){n.keyCode==16&&(this.doc.sel.shift=!1);w(this,n)}function yw(n){var t=this,i,r,u;if(!si(t.display,n)&&!w(t,n)&&(!n.ctrlKey||n.altKey)&&(!kt||!n.metaKey)){if(i=n.keyCode,r=n.charCode,bt&&i==hs){hs=null;ft(n);return}if((!bt||!(!n.which||n.which<10)||!lw(t,n))&&(u=String.fromCharCode(r==null?i:r),u!="\b")&&!ett(t,n,u))t.display.input.onKeyPress(n)}}function stt(n,t){var i=+new Date;return ke&&ke.compare(i,n,t)?(be=ke=null,"triple"):be&&be.compare(i,n,t)?(ke=new cs(i,n,t),be=null,"double"):(be=new cs(i,n,t),ke=null,"single")}function pw(n){var t=this,i=t.display;if(!w(t,n)&&(!i.activeTouch||!i.input.supportsTouch())){if(i.input.ensurePolled(),i.shift=n.shiftKey,si(i,n)){tt||(i.scroller.draggable=!1,setTimeout(function(){return i.scroller.draggable=!0},100));return}if(!rl(t,n)){var r=hr(t,n),u=pa(n),f=r?stt(r,u):"single";(window.focus(),u==1&&t.state.selectingText&&t.state.selectingText(n),r&&htt(t,u,r,f,n))||(u==1?r?ltt(t,r,f,n):hh(n)==i.scroller&&ft(n):u==2?(r&&ko(t.doc,r),setTimeout(function(){return i.input.focus()},20)):u==3&&(os?kw(t,n):ey(t)))}}}function htt(n,t,i,r,u){var f="Click";return r=="double"?f="Double"+f:r=="triple"&&(f="Triple"+f),f=(t==1?"Left":t==2?"Middle":"Right")+f,ee(n,fw(f,u),u,function(t){if(typeof t=="string"&&(t=tf[t]),!t)return!1;var r=!1;try{n.isReadOnly()&&(n.state.suppressEdits=!0);r=t(n,i)!=as}finally{n.state.suppressEdits=!1}return r})}function ctt(n,t,i){var u=n.getOption("configureMouse"),r=u?u(n,t,i):{},f;return r.unit==null&&(f=sit?i.shiftKey&&i.metaKey:i.altKey,r.unit=f?"rectangle":t=="single"?"char":t=="double"?"word":"line"),(r.extend==null||n.doc.extend)&&(r.extend=n.doc.extend||i.shiftKey),r.addNew==null&&(r.addNew=kt?i.metaKey:i.ctrlKey),r.moveOnDrag==null&&(r.moveOnDrag=!(kt?i.altKey:i.ctrlKey)),r}function ltt(n,t,i,r){e?setTimeout(ps(fy,n),0):n.curOp.focus=fi();var o=ctt(n,i,r),s=n.doc.sel,f;n.options.dragDrop&&vb&&!n.isReadOnly()&&i=="single"&&(f=s.contains(t))>-1&&(u((f=s.ranges[f]).from(),t)<0||t.xRel>0)&&(u(f.to(),t)>0||t.xRel<0)?att(n,r,t,o):vtt(n,r,t,o)}function att(n,t,i,u){var f=n.display,s=!1,o=b(n,function(t){tt&&(f.scroller.draggable=!1);n.state.draggingText=!1;lt(document,"mouseup",o);lt(document,"mousemove",h);lt(f.scroller,"dragstart",c);lt(f.scroller,"drop",o);s||(ft(t),u.addNew||ko(n.doc,i,null,null,u.extend),tt||e&&l==9?setTimeout(function(){document.body.focus();f.input.focus()},20):f.input.focus())}),h=function(n){s=s||Math.abs(t.clientX-n.clientX)+Math.abs(t.clientY-n.clientY)>=10},c=function(){return s=!0};tt&&(f.scroller.draggable=!0);n.state.draggingText=o;o.copy=!u.moveOnDrag;f.scroller.dragDrop&&f.scroller.dragDrop();r(document,"mouseup",o);r(document,"mousemove",h);r(f.scroller,"dragstart",c);r(f.scroller,"drop",o);ey(n);setTimeout(function(){return f.input.focus()},20)}function ww(t,i,r){if(r=="char")return new o(i,i);if(r=="word")return t.findWordAt(i);if(r=="line")return new o(n(i.line,0),f(t.doc,n(i.line+1,0)));var u=r(t,i);return new o(u.from,u.to)}function vtt(i,e,s,h){function et(r){var e,ut,b,v,tt;if(u(d,r)!=0)if(d=r,h.unit=="rectangle"){var p=[],k=i.options.tabSize,ft=at(t(c,s.line).text,s.ch,k),et=at(t(c,r.line).text,r.ch,k),ot=Math.min(ft,et),st=Math.max(ft,et);for(e=Math.min(s.line,r.line),ut=Math.min(i.lastLine(),Math.max(s.line,r.line));e<=ut;e++)b=t(c,e).text,v=ws(b,ot,k),ot==st?p.push(new o(n(e,v),n(e,v))):b.length>v&&p.push(new o(n(e,v),n(e,ws(b,st,k))));p.length||p.push(new o(s,s));nt(c,wt(y.ranges.slice(0,l).concat(p),l),{origin:"*mouse",scroll:!1});i.scrollIntoView(r)}else{var it=a,w=ww(i,r,h.unit),g=it.anchor,rt;u(w.anchor,g)>0?(rt=w.head,g=ro(it.from(),w.anchor)):(rt=w.anchor,g=io(it.to(),w.head));tt=y.ranges.slice(0);tt[l]=ytt(i,new o(f(c,g),rt));nt(c,wt(tt,l),bl)}}function tt(n){var e=++p,t=hr(i,n,!0,h.unit=="rectangle"),r,f;t&&(u(t,d)!=0?(i.curOp.focus=fi(),et(t),r=oc(w,c),(t.line>=r.to||t.line<r.from)&&setTimeout(b(i,function(){p==e&&tt(n)}),150)):(f=n.clientY<it.top?-20:n.clientY>it.bottom?20:0,f&&setTimeout(b(i,function(){p==e&&(w.scroller.scrollTop+=f,tt(n))}),50)))}function ut(n){i.state.selectingText=!1;p=Infinity;ft(n);w.input.focus();lt(document,"mousemove",rt);lt(document,"mouseup",g);c.history.lastSelOrigin=null}var w=i.display,c=i.doc,a,l,y,v,k,d,it,p,rt,g;ft(e);y=c.sel;v=y.ranges;h.addNew&&!h.extend?(l=c.sel.contains(s),a=l>-1?v[l]:new o(s,s)):(a=c.sel.primary(),l=c.sel.primIndex);h.unit=="rectangle"?(h.addNew||(a=new o(s,s)),s=hr(i,e,!0,!0),l=-1):(k=ww(i,s,h.unit),a=h.extend?dc(a,k.anchor,k.head,h.extend):k);h.addNew?l==-1?(l=v.length,nt(c,wt(v.concat([a]),l),{scroll:!1,origin:"*mouse"})):v.length>1&&v[l].empty()&&h.unit=="char"&&!h.extend?(nt(c,wt(v.slice(0,l).concat(v.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),y=c.sel):gc(c,l,a,bl):(l=0,nt(c,new ht([a],0),bl),y=c.sel);d=s;it=w.wrapper.getBoundingClientRect();p=0;rt=b(i,function(n){pa(n)?tt(n):ut(n)});g=b(i,ut);i.state.selectingText=g;r(document,"mousemove",rt);r(document,"mouseup",g)}function ytt(i,r){var f=r.anchor,e=r.head,d=t(i.doc,f.line),s,l,h,c,a,v,y;if(u(f,e)==0&&f.sticky==e.sticky||(s=oi(d),!s)||(l=hf(s,f.ch,f.sticky),h=s[l],h.from!=f.ch&&h.to!=f.ch)||(c=l+(h.from==f.ch==(h.level!=1)?0:1),c==0||c==s.length))return r;e.line!=f.line?a=(e.line-f.line)*(i.doc.direction=="ltr"?1:-1)>0:(v=hf(s,e.ch,e.sticky),y=v-l||(e.ch-f.ch)*(h.level==1?-1:1),a=v==c-1||v==c?y<0:y>0);var p=s[c+(a?-1:0)],w=a==(p.level==1),b=w?p.from:p.to,k=w?"after":"before";return f.ch==b&&f.sticky==k?r:new o(new n(f.line,b,k),e)}function bw(n,t,i,r){var e,u,o,s,f,h,c,l;if(t.touches)e=t.touches[0].clientX,u=t.touches[0].clientY;else try{e=t.clientX;u=t.clientY}catch(t){return!1}if(e>=Math.floor(n.display.gutters.getBoundingClientRect().right))return!1;if(r&&ft(t),o=n.display,s=o.lineDiv.getBoundingClientRect(),u>s.bottom||!vt(n,i))return sh(t);for(u-=s.top-o.viewOffset,f=0;f<n.options.gutters.length;++f)if(h=o.gutters.childNodes[f],h&&h.getBoundingClientRect().right>=e)return c=ur(n.doc,u),l=n.options.gutters[f],y(n,i,n,c,l,t),sh(t)}function rl(n,t){return bw(n,t,"gutterClick",!0)}function kw(n,t){if(!si(n.display,t)&&!ptt(n,t)&&!w(n,t,"contextmenu"))n.display.input.onContextMenu(t)}function ptt(n,t){return vt(n,"gutterContextMenu")?bw(n,t,"gutterContextMenu",!1):!1}function dw(n){n.display.wrapper.className=n.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+n.options.theme.replace(/(^|\s)\s*/g," cm-s-");yf(n)}function wtt(t){function i(n,i,u,f){t.defaults[n]=i;u&&(r[n]=f?function(n,t,i){i!=rf&&u(n,t,i)}:u)}var r=t.optionHandlers;t.defineOption=i;t.Init=rf;i("value","",function(n,t){return n.setValue(t)},!0);i("mode",null,function(n,t){n.doc.modeOption=t;wc(n)},!0);i("indentUnit",2,wc,!0);i("indentWithTabs",!1);i("smartIndent",!0);i("tabSize",4,function(n){te(n);yf(n);et(n)},!0);i("lineSeparator",null,function(t,i){var r,f,u;if(t.doc.lineSep=i,i)for(r=[],f=t.doc.first,t.doc.iter(function(t){for(var u,e=0;;){if(u=t.text.indexOf(i,e),u==-1)break;e=u+i.length;r.push(n(f,u))}f++}),u=r.length-1;u>=0;u--)su(t.doc,i,r[u],n(r[u].line,r[u].ch+i.length))});i("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(n,t,i){n.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g");i!=rf&&n.refresh()});i("specialCharPlaceholder",ud,function(n){return n.refresh()},!0);i("electricChars",!0);i("inputStyle",le?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor");},!0);i("spellcheck",!1,function(n,t){return n.getInputField().spellcheck=t},!0);i("rtlMoveVisually",!hit);i("wholeLineUpdateBefore",!0);i("theme","default",function(n){dw(n);oe(n)},!0);i("keyMap","default",function(n,t,i){var u=ts(t),r=i!=rf&&ts(i);r&&r.detach&&r.detach(n,u);u.attach&&u.attach(n,r||null)});i("extraKeys",null);i("configureMouse",null);i("lineWrapping",!1,ktt,!0);i("gutters",[],function(n){yc(n.options);oe(n)},!0);i("fixedGutter",!0,function(n,t){n.display.gutters.style.left=t?rc(n.display)+"px":"0";n.refresh()},!0);i("coverGutterNextToScrollbar",!1,function(n){return uu(n)},!0);i("scrollbarStyle","native",function(n){vy(n);uu(n);n.display.scrollbars.setScrollTop(n.doc.scrollTop);n.display.scrollbars.setScrollLeft(n.doc.scrollLeft)},!0);i("lineNumbers",!1,function(n){yc(n.options);oe(n)},!0);i("firstLineNumber",1,oe,!0);i("lineNumberFormatter",function(n){return n},oe,!0);i("showCursorWhenSelecting",!1,wf,!0);i("resetSelectionOnContextMenu",!0);i("lineWiseCopyCut",!0);i("pasteLinesPerSelection",!0);i("readOnly",!1,function(n,t){t=="nocursor"&&(bf(n),n.display.input.blur());n.display.input.readOnlyChanged(t)});i("disableInput",!1,function(n,t){t||n.display.input.reset()},!0);i("dragDrop",!0,btt);i("allowDropFileTypes",null);i("cursorBlinkRate",530);i("cursorScrollMargin",0);i("cursorHeight",1,wf,!0);i("singleCursorHeightPerLine",!0,wf,!0);i("workTime",100);i("workDelay",100);i("flattenSpans",!0,te,!0);i("addModeClass",!1,te,!0);i("pollInterval",100);i("undoDepth",200,function(n,t){return n.doc.history.undoDepth=t});i("historyEventDelay",1250);i("viewportMargin",10,function(n){return n.refresh()},!0);i("maxHighlightLength",1e4,te,!0);i("moveInputWithCursor",!0,function(n,t){t||n.display.input.resetPosition()});i("tabindex",null,function(n,t){return n.display.input.getField().tabIndex=t||""});i("autofocus",null);i("direction","ltr",function(n,t){return n.doc.setDirection(t)},!0)}function oe(n){wy(n);et(n);sy(n)}function btt(n,t,i){var e=i&&i!=rf,u,f;!t!=!e&&(u=n.display.dragFunctions,f=t?r:lt,f(n.display.scroller,"dragstart",u.start),f(n.display.scroller,"dragenter",u.enter),f(n.display.scroller,"dragover",u.over),f(n.display.scroller,"dragleave",u.leave),f(n.display.scroller,"drop",u.drop))}function ktt(n){n.options.lineWrapping?(tr(n.display.wrapper,"CodeMirror-wrap"),n.display.sizer.style.minWidth="",n.display.sizerWidth=null):(di(n.display.wrapper,"CodeMirror-wrap"),eh(n));uc(n);et(n);yf(n);setTimeout(function(){return uu(n)},100)}function a(n,t){var o=this,i,s,r,u,f;if(!(this instanceof a))return new a(n,t);this.options=t=t?ir(t):{};ir(tk,t,!1);yc(t);i=t.value;typeof i=="string"&&(i=new ut(i,t.mode,null,t.lineSeparator,t.direction));this.doc=i;s=new a.inputStyles[t.inputStyle](this);r=this.display=new rk(n,i,s);r.wrapper.CodeMirror=this;wy(this);dw(this);t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");vy(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new gi,keySeq:null,specialChars:null};t.autofocus&&!le&&r.input.focus();e&&l<11&&setTimeout(function(){return o.display.input.reset(!0)},20);dtt(this);dn();ar(this);this.curOp.forceUpdate=!0;tp(this,i);t.autofocus&&!le||this.hasFocus()?setTimeout(ps(ec,this),20):bf(this);for(u in vs)vs.hasOwnProperty(u)&&vs[u](o,t[u],rf);for(hy(this),t.finishInit&&t.finishInit(this),f=0;f<ls.length;++f)ls[f](o);vr(this);tt&&t.lineWrapping&&getComputedStyle(r.lineDiv).textRendering=="optimizelegibility"&&(r.lineDiv.style.textRendering="auto")}function dtt(t){function h(){i.activeTouch&&(a=setTimeout(function(){return i.activeTouch=null},1e3),s=i.activeTouch,s.end=+new Date)}function v(n){if(n.touches.length!=1)return!1;var t=n.touches[0];return t.radiusX<=1&&t.radiusY<=1}function c(n,t){if(t.left==null)return!0;var i=t.left-n.left,r=t.top-n.top;return i*i+r*r>400}var i=t.display,a,s,u;r(i.scroller,"mousedown",b(t,pw));e&&l<11?r(i.scroller,"dblclick",b(t,function(n){var i,r;w(t,n)||(i=hr(t,n),!i||rl(t,n)||si(t.display,n))||(ft(n),r=t.findWordAt(i),ko(t.doc,r.anchor,r.head))})):r(i.scroller,"dblclick",function(n){return w(t,n)||ft(n)});os||r(i.scroller,"contextmenu",function(n){return kw(t,n)});s={end:0};r(i.scroller,"touchstart",function(n){if(!w(t,n)&&!v(n)&&!rl(t,n)){i.input.ensurePolled();clearTimeout(a);var r=+new Date;i.activeTouch={start:r,moved:!1,prev:r-s.end<=300?s:null};n.touches.length==1&&(i.activeTouch.left=n.touches[0].pageX,i.activeTouch.top=n.touches[0].pageY)}});r(i.scroller,"touchmove",function(){i.activeTouch&&(i.activeTouch.moved=!0)});r(i.scroller,"touchend",function(r){var u=i.activeTouch,e,s;u&&!si(i,r)&&u.left!=null&&!u.moved&&new Date-u.start<300&&(e=t.coordsChar(i.activeTouch,"page"),s=!u.prev||c(u,u.prev)?new o(e,e):!u.prev.prev||c(u,u.prev.prev)?t.findWordAt(e):new o(n(e.line,0),f(t.doc,n(e.line+1,0))),t.setSelection(s.anchor,s.head),t.focus(),ft(r));h()});r(i.scroller,"touchcancel",h);r(i.scroller,"scroll",function(){i.scroller.clientHeight&&(df(t,i.scroller.scrollTop),lr(t,i.scroller.scrollLeft,!0),y(t,"scroll",t))});r(i.scroller,"mousewheel",function(n){return ky(t,n)});r(i.scroller,"DOMMouseScroll",function(n){return ky(t,n)});r(i.wrapper,"scroll",function(){return i.wrapper.scrollTop=i.wrapper.scrollLeft=0});i.dragFunctions={enter:function(n){w(t,n)||cf(n)},over:function(n){w(t,n)||(kn(t,n),cf(n))},start:function(n){return bn(t,n)},drop:b(t,wn),leave:function(n){w(t,n)||iw(t)}};u=i.input.getField();r(u,"keyup",function(n){return vw.call(t,n)});r(u,"keydown",b(t,aw));r(u,"keypress",b(t,yw));r(u,"focus",function(n){return ec(t,n)});r(u,"blur",function(n){return bf(t,n)})}function se(i,r,u,f){var s=i.doc,d,c,e,l,v,p,a,w,b;u==null&&(u="add");u=="smart"&&(s.mode.indent?d=lf(i,r).state:u="prev");var y=i.options.tabSize,h=t(s,r),k=at(h.text,null,y);if(h.stateAfter&&(h.stateAfter=null),c=h.text.match(/^\s*/)[0],f||/\S/.test(h.text)){if(u=="smart"&&(e=s.mode.indent(d,h.text.slice(c.length),h.text),e==as||e>150)){if(!f)return;u="prev"}}else e=0,u="not";if(u=="prev"?e=r>s.first?at(t(s,r-1).text,null,y):0:u=="add"?e=k+i.options.indentUnit:u=="subtract"?e=k-i.options.indentUnit:typeof u=="number"&&(e=k+u),e=Math.max(0,e),l="",v=0,i.options.indentWithTabs)for(p=Math.floor(e/y);p;--p)v+=y,l+="\t";if(v<e&&(l+=bs(e-v)),l!=c)return su(s,l,n(r,0),n(r,c.length),"+input"),h.stateAfter=null,!0;for(a=0;a<s.sel.ranges.length;a++)if(w=s.sel.ranges[a],w.head.line==r&&w.head.ch<c.length){b=n(r,c.length);gc(s,a,new o(b,b));break}}function rs(n){yt=n}function ul(i,r,u,f,e){var p=i.doc,a,k,l,w;i.display.shift=!1;f||(f=p.sel);var v=i.state.pasteIncoming||e=="paste",y=kl(r),o=null;if(v&&f.ranges.length>1)if(yt&&yt.text.join("\n")==r){if(f.ranges.length%yt.text.length==0)for(o=[],a=0;a<yt.text.length;a++)o.push(p.splitLines(yt.text[a]))}else y.length==f.ranges.length&&i.options.pasteLinesPerSelection&&(o=no(y,function(n){return[n]}));for(l=f.ranges.length-1;l>=0;l--){var b=f.ranges[l],h=b.from(),c=b.to();b.empty()&&(u&&u>0?h=n(h.line,h.ch-u):i.state.overwrite&&!v?c=n(c.line,Math.min(t(p,c.line).text.length,c.ch+s(y).length)):yt&&yt.lineWise&&yt.text.join("\n")==r&&(h=c=n(h.line,0)));k=i.curOp.updateInput;w={from:h,to:c,text:o?o[l%o.length]:y,origin:e||(v?"paste":i.state.cutIncoming?"cut":"+input")};ou(i.doc,w);g(i,"inputRead",i,w)}r&&!v&&nb(i,r);ru(i);i.curOp.updateInput=k;i.curOp.typing=!0;i.state.pasteIncoming=i.state.cutIncoming=!1}function gw(n,t){var i=n.clipboardData&&n.clipboardData.getData("Text");if(i)return n.preventDefault(),t.isReadOnly()||t.options.disableInput||ot(t,function(){return ul(t,i,0,null,"paste")}),!0}function nb(n,i){var e,u,r,f,o,s;if(n.options.electricChars&&n.options.smartIndent)for(e=n.doc.sel,u=e.ranges.length-1;u>=0;u--)if(r=e.ranges[u],!(r.head.ch>100)&&(!u||e.ranges[u-1].head.line!=r.head.line)){if(f=n.getModeAt(r.head),o=!1,f.electricChars){for(s=0;s<f.electricChars.length;s++)if(i.indexOf(f.electricChars.charAt(s))>-1){o=se(n,r.head.line,"smart");break}}else f.electricInput&&f.electricInput.test(t(n.doc,r.head.line).text.slice(0,r.head.ch))&&(o=se(n,r.head.line,"smart"));o&&g(n,"electricInput",n,r.head.line)}}function tb(t){for(var r,i,f=[],e=[],u=0;u<t.doc.sel.ranges.length;u++)r=t.doc.sel.ranges[u].head.line,i={anchor:n(r,0),head:n(r+1,0)},e.push(i),f.push(t.getRange(i.anchor,i.head));return{text:f,ranges:e}}function ib(n,t){n.setAttribute("autocorrect","off");n.setAttribute("autocapitalize","off");n.setAttribute("spellcheck",!!t)}function rb(){var n=i("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=i("div",[n],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return tt?n.style.width="1000px":n.setAttribute("wrap","off"),ce&&(n.style.border="1px solid black"),ib(n),t}function gtt(i){var u=i.optionHandlers,r=i.helpers={};i.prototype={constructor:i,focus:function(){window.focus();this.display.input.focus()},setOption:function(n,t){var i=this.options,r=i[n];(i[n]!=t||n=="mode")&&(i[n]=t,u.hasOwnProperty(n)&&b(this,u[n])(this,t,r),y(this,"optionChange",this,n))},getOption:function(n){return this.options[n]},getDoc:function(){return this.doc},addKeyMap:function(n,t){this.state.keyMaps[t?"push":"unshift"](ts(n))},removeKeyMap:function(n){for(var i=this.state.keyMaps,t=0;t<i.length;++t)if(i[t]==n||i[t].name==n)return i.splice(t,1),!0},addOverlay:it(function(n,t){var r=n.token?n:i.getMode(this.options,n);if(r.startState)throw new Error("Overlays may not be stateful.");ik(this.state.overlays,{mode:r,modeSpec:n,opaque:t&&t.opaque,priority:t&&t.priority||0},function(n){return n.priority});this.state.modeGen++;et(this)}),removeOverlay:it(function(n){for(var i,u=this,r=this.state.overlays,t=0;t<r.length;++t)if(i=r[t].modeSpec,i==n||typeof n=="string"&&i.name==n){r.splice(t,1);u.state.modeGen++;et(u);return}}),indentLine:it(function(n,t,i){typeof t!="string"&&typeof t!="number"&&(t=t==null?this.options.smartIndent?"smart":"prev":t?"add":"subtract");ef(this.doc,n)&&se(this,n,t,i)}),indentSelection:it(function(n){for(var t,f,e,i=this,s=this.doc.sel.ranges,u=-1,r=0;r<s.length;r++)if(t=s[r],t.empty())t.head.line>u&&(se(i,t.head.line,n,!0),u=t.head.line,r==i.doc.sel.primIndex&&ru(i));else{var h=t.from(),c=t.to(),l=Math.max(u,h.line);for(u=Math.min(i.lastLine(),c.line-(c.ch?0:1))+1,f=l;f<u;++f)se(i,f,n);e=i.doc.sel.ranges;h.ch==0&&s.length==e.length&&e[r].from().ch>0&&gc(i.doc,r,new o(h,e[r].to()),ui)}}),getTokenAt:function(n,t){return ga(this,n,t)},getLineTokens:function(t,i){return ga(this,n(t),i,!0)},getTokenTypeAt:function(n){var i,e;n=f(this.doc,n);var u=ka(this,t(this.doc,n.line)),s=0,h=(u.length-1)/2,o=n.ch,r;if(o==0)r=u[2];else for(;;)if(i=s+h>>1,(i?u[i*2-1]:0)>=o)h=i;else if(u[i*2+1]<o)s=i+1;else{r=u[i*2+2];break}return e=r?r.indexOf("overlay "):-1,e<0?r:e==0?null:r.slice(0,e-1)},getModeAt:function(n){var t=this.doc.mode;return t.innerMode?i.innerMode(t,this.getTokenAt(n).state).mode:t},getHelper:function(n,t){return this.getHelpers(n,t)[0]},getHelpers:function(n,t){var c=this,f=[],u,i,e,h,o,s;if(!r.hasOwnProperty(t))return f;if(u=r[t],i=this.getModeAt(n),typeof i[t]=="string")u[i[t]]&&f.push(u[i[t]]);else if(i[t])for(e=0;e<i[t].length;e++)h=u[i[t][e]],h&&f.push(h);else i.helperType&&u[i.helperType]?f.push(u[i.helperType]):u[i.name]&&f.push(u[i.name]);for(o=0;o<u._global.length;o++)s=u._global[o],s.pred(i,c)&&d(f,s.val)==-1&&f.push(s.val);return f},getStateAfter:function(n,t){var i=this.doc;return n=ra(i,n==null?i.first+i.size-1:n),lf(this,n+1,t).state},cursorCoords:function(n,t){var r,i=this.doc.sel.primary();return r=n==null?i.head:typeof n=="object"?f(this.doc,n):n?i.from():i.to(),pt(this,r,t||"page")},charCoords:function(n,t){return dh(this,f(this.doc,n),t||"page")},coordsChar:function(n,t){return n=dv(this,n,t||"page"),nc(this,n.left,n.top)},lineAtHeight:function(n,t){return n=dv(this,{top:n,left:0},t||"page").top,ur(this.doc,n+this.display.viewOffset)},heightAtLine:function(n,i,r){var f=!1,u,e;return typeof n=="number"?(e=this.doc.first+this.doc.size-1,n<this.doc.first?n=this.doc.first:n>e&&(n=e,f=!0),u=t(this.doc,n)):u=n,lo(this,u,{top:0,left:0},i||"page",r||f).top+(f?this.doc.height-ei(u):0)},defaultTextHeight:function(){return sr(this.display)},defaultCharWidth:function(){return pf(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(n,t,i,r,u){var s=this.display,o,e,h,c;n=pt(this,f(this.doc,n));o=n.bottom;e=n.left;t.style.position="absolute";t.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(t);s.sizer.appendChild(t);r=="over"?o=n.top:(r=="above"||r=="near")&&(h=Math.max(s.wrapper.clientHeight,this.doc.height),c=Math.max(s.sizer.clientWidth,s.lineSpace.clientWidth),(r=="above"||n.bottom+t.offsetHeight>h)&&n.top>t.offsetHeight?o=n.top-t.offsetHeight:n.bottom+t.offsetHeight<=h&&(o=n.bottom),e+t.offsetWidth>c&&(e=c-t.offsetWidth));t.style.top=o+"px";t.style.left=t.style.right="";u=="right"?(e=s.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):(u=="left"?e=0:u=="middle"&&(e=(s.sizer.clientWidth-t.offsetWidth)/2),t.style.left=e+"px");i&&sg(this,{left:e,top:o,right:e+t.offsetWidth,bottom:o+t.offsetHeight})},triggerOnKeyDown:it(aw),triggerOnKeyPress:it(yw),triggerOnKeyUp:vw,triggerOnMouseDown:it(pw),execCommand:function(n){if(tf.hasOwnProperty(n))return tf[n].call(null,this)},triggerElectric:it(function(n){nb(this,n)}),findPosH:function(n,t,i,r){var s=this,o=1,u,e;for(t<0&&(o=-1,t=-t),u=f(this.doc,n),e=0;e<t;++e)if(u=fl(s.doc,u,o,i,r),u.hitSide)break;return u},moveH:it(function(n,t){var i=this;this.extendSelectionsBy(function(r){return i.display.shift||i.doc.extend||r.empty()?fl(i.doc,r.head,n,t,i.options.rtlMoveVisually):n<0?r.from():r.to()},ge)}),deleteH:it(function(n,t){var r=this.doc.sel,i=this.doc;r.somethingSelected()?i.replaceSelection("",null,"+delete"):lu(this,function(r){var u=fl(i,r.head,n,t,!1);return n<0?{from:u,to:r.head}:{from:r.head,to:u}})}),findPosV:function(n,t,i,r){var h=this,c=1,o=r,u,s,e;for(t<0&&(c=-1,t=-t),u=f(this.doc,n),s=0;s<t;++s)if(e=pt(h,u,"div"),o==null?o=e.left:e.left=o,u=ub(h,e,c,i),u.hitSide)break;return u},moveV:it(function(n,t){var u=this,i=this.doc,f=[],e=!this.display.shift&&!i.extend&&i.sel.somethingSelected(),r;if(i.extendSelectionsBy(function(r){var o,s;return e?n<0?r.from():r.to():(o=pt(u,r.head,"div"),r.goalColumn!=null&&(o.left=r.goalColumn),f.push(o.left),s=ub(u,o,n,t),t=="page"&&r==i.sel.primary()&&hc(u,dh(u,s,"div").top-o.top),s)},ge),f.length)for(r=0;r<i.sel.ranges.length;r++)i.sel.ranges[r].goalColumn=f[r]}),findWordAt:function(i){var c=this.doc,u=t(c,i.line).text,r=i.ch,f=i.ch,e,s,h;if(u){for(e=this.getHelper(i,"wordChars"),(i.sticky=="before"||f==u.length)&&r?--r:++f,s=u.charAt(r),h=to(s,e)?function(n){return to(n,e)}:/\s/.test(s)?function(n){return/\s/.test(n)}:function(n){return!/\s/.test(n)&&!to(n)};r>0&&h(u.charAt(r-1));)--r;while(f<u.length&&h(u.charAt(f)))++f}return new o(n(i.line,r),n(i.line,f))},toggleOverwrite:function(n){(n==null||n!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?tr(this.display.cursorDiv,"CodeMirror-overwrite"):di(this.display.cursorDiv,"CodeMirror-overwrite"),y(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==fi()},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:it(function(n,t){kf(this,n,t)}),getScrollInfo:function(){var n=this.display.scroller;return{left:n.scrollLeft,top:n.scrollTop,height:n.scrollHeight-ti(this)-this.display.barHeight,width:n.scrollWidth-ti(this)-this.display.barWidth,clientHeight:wh(this),clientWidth:or(this)}},scrollIntoView:it(function(t,i){t==null?(t={from:this.doc.sel.primary().head,to:null},i==null&&(i=this.options.cursorScrollMargin)):typeof t=="number"?t={from:n(t,0),to:null}:t.from==null&&(t={from:t,to:null});t.to||(t.to=t.from);t.margin=i||0;t.from.line!=null?hg(this,t):cy(this,t.from,t.to,t.margin)}),setSize:it(function(n,t){var u=this,r=function(n){return typeof n=="number"||/^\d+$/.test(String(n))?n+"px":n},i;n!=null&&(this.display.wrapper.style.width=r(n));t!=null&&(this.display.wrapper.style.height=r(t));this.options.lineWrapping&&wv(this);i=this.display.viewFrom;this.doc.iter(i,this.display.viewTo,function(n){if(n.widgets)for(var t=0;t<n.widgets.length;t++)if(n.widgets[t].noHScroll){yi(u,i,"widget");break}++i});this.curOp.forceUpdate=!0;y(this,"refresh",this)}),operation:function(n){return ot(this,n)},startOperation:function(){return ar(this)},endOperation:function(){return vr(this)},refresh:it(function(){var n=this.display.cachedTextHeight;et(this);this.curOp.forceUpdate=!0;yf(this);kf(this,this.doc.scrollLeft,this.doc.scrollTop);ac(this);(n==null||Math.abs(n-sr(this.display))>.5)&&uc(this);y(this,"refresh",this)}),swapDoc:it(function(n){var t=this.doc;return t.cm=null,tp(this,n),yf(this),this.display.input.reset(),kf(this,n.scrollLeft,n.scrollTop),this.curOp.forceScroll=!0,g(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};tu(i);i.registerHelper=function(n,t,u){r.hasOwnProperty(n)||(r[n]=i[n]={_global:[]});r[n][t]=u};i.registerGlobalHelper=function(n,t,u,f){i.registerHelper(n,t,f);r[n]._global.push({pred:u,val:f})}}function fl(i,r,u,f,e){function w(){var f=r.line+u;return f<i.first||f>=i.first+i.size?!1:(r=new n(f,r.ch,r.sticky),h=t(i,f))}function s(n){var t;if(t=e?rtt(i.cm,h,r,u):ow(h,r,u),t==null)if(!n&&w())r=il(e,i.cm,h,r.line,u);else return!1;else r=t;return!0}var p=r,b=u,h=t(i,r.line),c,l,o,a;if(f=="char")s();else if(f=="column")s(!0);else if(f=="word"||f=="group"){var v=null,y=f=="group",k=i.cm&&i.cm.getHelper(r,"wordChars");for(c=!0;;c=!1){if(u<0&&!s(!c))break;if(l=h.text.charAt(r.ch)||"\n",o=to(l,k)?"w":y&&l=="\n"?"n":!y||/\s/.test(l)?null:"p",!y||c||o||(o="s"),v&&v!=o){u<0&&(u=1,s(),r.sticky="after");break}if(o&&(v=o),u>0&&!s(!c))break}}return a=nl(i,r,p,b,!0),th(p,a)&&(a.hitSide=!0),a}function ub(n,t,i,r){var s=n.doc,h=t.left,u,e,o,f;for(r=="page"?(e=Math.min(n.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),o=Math.max(e-.5*sr(n.display),3),u=(i>0?t.bottom:t.top)+i*o):r=="line"&&(u=i>0?t.bottom+3:t.top-3);;){if(f=nc(n,h,u),!f.outside)break;if(i<0?u<=0:u>=s.height){f.hitSide=!0;break}u+=i*5}return f}function fb(n,i){var u=bh(n,i.line),f,r;if(!u||u.hidden)return null;var e=t(n.doc,i.line),h=av(u,e,i.line),o=oi(e,n.doc.direction),s="left";return o&&(f=hf(o,i.ch),s=f%2?"right":"left"),r=yv(h.map,i.ch,s),r.offset=r.collapse=="right"?r.end:r.start,r}function nit(n){for(var t=n;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function au(n,t){return t&&(n.bad=!0),n}function tit(t,i,r,u,f){function a(n){return function(t){return t.id==n}}function h(){s&&(o+=l,s=!1)}function e(n){n&&(h(),o+=n)}function c(i){var o,v,y,p,w,r;if(i.nodeType==1){if(o=i.getAttribute("cm-text"),o!=null){e(o||i.textContent.replace(/\u200b/g,""));return}if(v=i.getAttribute("cm-marker"),v){p=t.findMarks(n(u,0),n(f+1,0),a(+v));p.length&&(y=p[0].find(0))&&e(rr(t.doc,y.from,y.to).join(l));return}if(i.getAttribute("contenteditable")=="false")return;for(w=/^(pre|div|p)$/i.test(i.nodeName),w&&h(),r=0;r<i.childNodes.length;r++)c(i.childNodes[r]);w&&(s=!0)}else i.nodeType==3&&e(i.nodeValue)}for(var o="",s=!1,l=t.doc.lineSeparator();;){if(c(i),i==r)break;i=i.nextSibling}return o}function us(t,i,r){var u,f,e;if(i==t.display.lineDiv){if(u=t.display.lineDiv.childNodes[r],!u)return au(t.clipPos(n(t.display.viewTo-1)),!0);i=null;r=0}else for(u=i;;u=u.parentNode){if(!u||u==t.display.lineDiv)return null;if(u.parentNode&&u.parentNode==t.display.lineDiv)break}for(f=0;f<t.display.view.length;f++)if(e=t.display.view[f],e.node==u)return iit(e,i,r)}function iit(t,i,r){function y(i,r,u){for(var o,f,s,l,c,e=-1;e<(v?v.length:0);e++)for(o=e<0?w.map:v[e],f=0;f<o.length;f+=3)if(s=o[f+2],s==i||s==r)return l=h(e<0?t.line:t.rest[e]),c=o[f]+u,(u<0||s!=i)&&(c=o[f+(u?1:0)]),n(l,c)}var a=t.text.firstChild,l=!1,p,f,e,w,v,u,o,b,c,k;if(!i||!vi(a,i))return au(n(h(t.line),0),!0);if(i==a&&(l=!0,i=a.childNodes[r],r=0,!i))return p=t.rest?s(t.rest):t.line,au(n(h(p),p.text.length),l);for(f=i.nodeType==3?i:null,e=i,f||i.childNodes.length!=1||i.firstChild.nodeType!=3||(f=i.firstChild,r&&(r=f.nodeValue.length));e.parentNode!=a;)e=e.parentNode;if(w=t.measure,v=w.maps,u=y(f,e,r),u)return au(u,l);for(o=e.nextSibling,b=f?f.nodeValue.length-r:0;o;o=o.nextSibling){if(u=y(o,o.firstChild,0),u)return au(n(u.line,u.ch-b),l);b+=o.textContent.length}for(c=e.previousSibling,k=r;c;c=c.previousSibling){if(u=y(c,c.firstChild,-1),u)return au(n(u.line,u.ch+k),l);k+=c.textContent.length}}function rit(n,t){function u(){n.value=s.getValue()}var f,e,i,o,s;if(t=t?ir(t):{},t.value=n.value,!t.tabindex&&n.tabIndex&&(t.tabindex=n.tabIndex),!t.placeholder&&n.placeholder&&(t.placeholder=n.placeholder),t.autofocus==null&&(f=fi(),t.autofocus=f==n||n.getAttribute("autofocus")!=null&&f==document.body),n.form&&(r(n.form,"submit",u),!t.leaveSubmitMethodAlone)){i=n.form;e=i.submit;try{o=i.submit=function(){u();i.submit=e;i.submit();i.submit=o}}catch(h){}}return t.finishInit=function(t){t.save=u;t.getTextArea=function(){return n};t.toTextArea=function(){t.toTextArea=isNaN;u();n.parentNode.removeChild(t.getWrapperElement());n.style.display="";n.form&&(lt(n.form,"submit",u),typeof n.form.submit=="function"&&(n.form.submit=e))}},n.style.display="none",s=a(function(t){return n.parentNode.insertBefore(t,n.nextSibling)},t)}function uit(t){t.off=lt;t.on=r;t.wheelEventPixels=tn;t.Doc=ut;t.splitLines=kl;t.countColumn=at;t.findColumn=ws;t.isWordChar=ks;t.Pass=as;t.signal=y;t.Line=kr;t.changeEnd=bi;t.scrollbarModel=vl;t.Pos=n;t.cmpPos=u;t.modes=ss;t.mimeModes=wr;t.resolveMode=so;t.getMode=ch;t.modeExtensions=br;t.extendMode=gk;t.copyState=er;t.startState=wa;t.innerMode=lh;t.commands=tf;t.keyMap=ri;t.keyName=ew;t.isModifierKey=uw;t.lookupKey=cu;t.normalizeKeyMap=itt;t.StringStream=v;t.SharedTextMarker=du;t.TextMarker=ci;t.LineWidget=ku;t.e_preventDefault=ft;t.e_stopPropagation=ya;t.e_stop=cf;t.addClass=tr;t.contains=vi;t.rmClass=di;t.keyNames=li}var rt=navigator.userAgent,eb=navigator.platform,ki=/gecko\/\d/i.test(rt),ob=/MSIE \d/.test(rt),sb=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(rt),he=/Edge\/(\d+)/.exec(rt),e=ob||sb||he,l=e&&(ob?document.documentMode||6:+(he||sb)[1]),tt=!he&&/WebKit\//.test(rt),fit=tt&&/Qt\/\d+\.\d+/.test(rt),fs=!he&&/Chrome\//.test(rt),bt=/Opera\//.test(rt),hb=/Apple Computer/.test(navigator.vendor),eit=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(rt),oit=/PhantomJS/.test(rt),ce=!he&&/AppleWebKit/.test(rt)&&/Mobile\/\w+/.test(rt),es=/Android/.test(rt),le=ce||es||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(rt),kt=ce||/Mac/.test(eb),sit=/\bCrOS\b/.test(rt),hit=/win/i.test(eb),pr=bt&&rt.match(/Version\/(\d*\.\d*)/),el,os,di,vu,yu,gi,ae,cb,lb,ol,hi,pu,ab,sl,r,vb,hl,cl,ss,wr,br,v,ve,dt,ll,kr,yb,pb,dr,wu,al,gr,nr,bu,vl,wb,ye,pe,st,ht,o,ku,yl,ci,du,bb,ut,pl,wl,li,gu,we,nf,ri,tf,kb,hs,db,cs,be,ke,ls,yt,c,p,gb,de;pr&&(pr=Number(pr[1]));pr&&pr>=15&&(bt=!1,tt=!0);el=kt&&(fit||bt&&(pr==null||pr<12.11));os=ki||e&&l>=9;di=function(n,t){var r=n.className,i=uf(t).exec(r),u;i&&(u=r.slice(i.index+i[0].length),n.className=r.slice(0,i.index)+(u?i[1]+u:""))};vu=document.createRange?function(n,t,i,r){var u=document.createRange();return u.setEnd(r||n,i),u.setStart(n,t),u}:function(n,t,i){var r=document.body.createTextRange();try{r.moveToElementText(n.parentNode)}catch(u){return r}return r.collapse(!0),r.moveEnd("character",i),r.moveStart("character",t),r};yu=function(n){n.select()};ce?yu=function(n){n.selectionStart=0;n.selectionEnd=n.value.length}:e&&(yu=function(n){try{n.select()}catch(t){}});gi=function(){this.id=null};gi.prototype.set=function(n,t){clearTimeout(this.id);this.id=setTimeout(t,n)};var nk=30,as={toString:function(){return"CodeMirror.Pass"}},ui={scroll:!1},bl={origin:"*mouse"},ge={origin:"+move"};ae=[""];cb=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;lb=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;ol=!1;hi=!1;pu=null;ab=function(){function f(n){return n<=247?e.charAt(n):1424<=n&&n<=1524?"R":1536<=n&&n<=1785?o.charAt(n-1536):1774<=n&&n<=2220?"r":8192<=n&&n<=8203?"w":n==8204?"b":"L"}function n(n,t,i){this.level=n;this.from=t;this.to=i}var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",o="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",h=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,t=/[stwN]/,i=/[LRr]/,r=/[Lb1n]/,u=/[1n]/;return function(e,o){var tt=o=="ltr"?"L":"R",a,c,ot,ut,vt,yt,it,pt,ft,d,g,st,p,wt,w,kt,ht,et,bt,ct,b,k,lt,v,rt,l,dt,nt,at,y,gt;if(e.length==0||o=="ltr"&&!h.test(e))return!1;for(a=e.length,c=[],ot=0;ot<a;++ot)c.push(f(e.charCodeAt(ot)));for(ut=0,vt=tt;ut<a;++ut)yt=c[ut],yt=="m"?c[ut]=vt:vt=yt;for(it=0,pt=tt;it<a;++it)ft=c[it],ft=="1"&&pt=="r"?c[it]="n":i.test(ft)&&(pt=ft,ft=="r"&&(c[it]="R"));for(d=1,g=c[0];d<a-1;++d)st=c[d],st=="+"&&g=="1"&&c[d+1]=="1"?c[d]="1":st==","&&g==c[d+1]&&(g=="1"||g=="n")&&(c[d]=g),g=st;for(p=0;p<a;++p)if(wt=c[p],wt==",")c[p]="N";else if(wt=="%"){for(w=void 0,w=p+1;w<a&&c[w]=="%";++w);for(kt=p&&c[p-1]=="!"||w<a&&c[w]=="1"?"1":"N",ht=p;ht<w;++ht)c[ht]=kt;p=w-1}for(et=0,bt=tt;et<a;++et)ct=c[et],bt=="L"&&ct=="1"?c[et]="L":i.test(ct)&&(bt=ct);for(b=0;b<a;++b)if(t.test(c[b])){for(k=void 0,k=b+1;k<a&&t.test(c[k]);++k);var ni=(b?c[b-1]:tt)=="L",ti=(k<a?c[k]:tt)=="L",ii=ni==ti?ni?"L":"R":tt;for(lt=b;lt<k;++lt)c[lt]=ii;b=k-1}for(v=[],l=0;l<a;)if(r.test(c[l])){for(dt=l,++l;l<a&&r.test(c[l]);++l);v.push(new n(0,dt,l))}else{for(nt=l,at=v.length,++l;l<a&&c[l]!="L";++l);for(y=nt;y<l;)if(u.test(c[y])){for(nt<y&&v.splice(at,0,new n(1,nt,y)),gt=y,++y;y<l&&u.test(c[y]);++y);v.splice(at,0,new n(2,gt,y));nt=y}else++y;nt<l&&v.splice(at,0,new n(1,nt,l))}return o=="ltr"&&(v[0].level==1&&(rt=e.match(/^\s+/))&&(v[0].from=rt[0].length,v.unshift(new n(0,0,rt[0].length))),s(v).level==1&&(rt=e.match(/\s+$/))&&(s(v).to-=rt[0].length,v.push(new n(0,a-rt[0].length,a)))),o=="rtl"?v.reverse():v}}();sl=[];r=function(n,t,i){if(n.addEventListener)n.addEventListener(t,i,!1);else if(n.attachEvent)n.attachEvent("on"+t,i);else{var r=n._handlers||(n._handlers={});r[t]=(r[t]||sl).concat(i)}};vb=function(){if(e&&l<9)return!1;var n=i("div");return"draggable"in n||"dragDrop"in n}();var kl="\n\nb".split(/\n/).length!=3?function(n){for(var i=0,f=[],e=n.length,t,r,u;i<=e;)t=n.indexOf("\n",i),t==-1&&(t=n.length),r=n.slice(i,n.charAt(t-1)=="\r"?t-1:t),u=r.indexOf("\r"),u!=-1?(f.push(r.slice(0,u)),i+=u+1):(f.push(r),i=t+1);return f}:function(n){return n.split(/\r\n?|\n/)},cit=window.getSelection?function(n){try{return n.selectionStart!=n.selectionEnd}catch(t){return!1}}:function(n){var t;try{t=n.ownerDocument.selection.createRange()}catch(i){}return!t||t.parentElement()!=n?!1:t.compareEndPoints("StartToEnd",t)!=0},lit=function(){var n=i("div");return"oncopy"in n?!0:(n.setAttribute("oncopy","return;"),typeof n.oncopy=="function")}(),dl=null;for(ss={},wr={},br={},v=function(n,t,i){this.pos=this.start=0;this.string=n;this.tabSize=t||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;this.lineOracle=i},v.prototype.eol=function(){return this.pos>=this.string.length},v.prototype.sol=function(){return this.pos==this.lineStart},v.prototype.peek=function(){return this.string.charAt(this.pos)||undefined},v.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},v.prototype.eat=function(n){var t=this.string.charAt(this.pos),i;return i=typeof n=="string"?t==n:t&&(n.test?n.test(t):n(t)),i?(++this.pos,t):void 0},v.prototype.eatWhile=function(n){for(var t=this.pos;this.eat(n););return this.pos>t},v.prototype.eatSpace=function(){for(var n=this,t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++n.pos;return this.pos>t},v.prototype.skipToEnd=function(){this.pos=this.string.length},v.prototype.skipTo=function(n){var t=this.string.indexOf(n,this.pos);if(t>-1)return this.pos=t,!0},v.prototype.backUp=function(n){this.pos-=n},v.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=at(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?at(this.string,this.lineStart,this.tabSize):0)},v.prototype.indentation=function(){return at(this.string,null,this.tabSize)-(this.lineStart?at(this.string,this.lineStart,this.tabSize):0)},v.prototype.match=function(n,t,i){var u,f,r;if(typeof n=="string"){if(u=function(n){return i?n.toLowerCase():n},f=this.string.substr(this.pos,n.length),u(f)==u(n))return t!==!1&&(this.pos+=n.length),!0}else return(r=this.string.slice(this.pos).match(n),r&&r.index>0)?null:(r&&t!==!1&&(this.pos+=r[0].length),r)},v.prototype.current=function(){return this.string.slice(this.start,this.pos)},v.prototype.hideFirstChars=function(n,t){this.lineStart+=n;try{return t()}finally{this.lineStart-=n}},v.prototype.lookAhead=function(n){var t=this.lineOracle;return t&&t.lookAhead(n)},v.prototype.baseToken=function(){var n=this.lineOracle;return n&&n.baseToken(this.pos)},ve=function(n,t){this.state=n;this.lookAhead=t},dt=function(n,t,i,r){this.state=t;this.doc=n;this.line=i;this.maxLookAhead=r||0;this.baseTokens=null;this.baseTokenPos=1},dt.prototype.lookAhead=function(n){var t=this.doc.getLine(this.line+n);return t!=null&&n>this.maxLookAhead&&(this.maxLookAhead=n),t},dt.prototype.baseToken=function(n){var i=this,t;if(!this.baseTokens)return null;while(this.baseTokens[this.baseTokenPos]<=n)i.baseTokenPos+=2;return t=this.baseTokens[this.baseTokenPos+1],{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-n}},dt.prototype.nextLine=function(){this.line++;this.maxLookAhead>0&&this.maxLookAhead--},dt.fromSaved=function(n,t,i){return t instanceof ve?new dt(n,er(n.mode,t.state),i,t.lookAhead):new dt(n,er(n.mode,t),i)},dt.prototype.save=function(n){var t=n!==!1?er(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new ve(t,this.maxLookAhead):t},ll=function(n,t,i){this.start=n.start;this.end=n.pos;this.string=n.current();this.type=t||null;this.state=i},kr=function(n,t,i){this.text=n;oa(this,t);this.height=i?i(this):1},kr.prototype.lineNo=function(){return h(this)},tu(kr),yb={},pb={},dr=null,wu=null,al={left:0,right:0,top:0,bottom:0},nr=function(n,t,u){this.cm=u;var f=this.vert=i("div",[i("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),o=this.horiz=i("div",[i("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n(f);n(o);r(f,"scroll",function(){f.clientHeight&&t(f.scrollTop,"vertical")});r(o,"scroll",function(){o.clientWidth&&t(o.scrollLeft,"horizontal")});this.checkedZeroWidth=!1;e&&l<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")},nr.prototype.update=function(n){var i=n.scrollWidth>n.clientWidth+1,r=n.scrollHeight>n.clientHeight+1,t=n.nativeBarWidth,u,f;return r?(this.vert.style.display="block",this.vert.style.bottom=i?t+"px":"0",u=n.viewHeight-(i?t:0),this.vert.firstChild.style.height=Math.max(0,n.scrollHeight-n.clientHeight+u)+"px"):(this.vert.style.display="",this.vert.firstChild.style.height="0"),i?(this.horiz.style.display="block",this.horiz.style.right=r?t+"px":"0",this.horiz.style.left=n.barLeft+"px",f=n.viewWidth-n.barLeft-(r?t:0),this.horiz.firstChild.style.width=Math.max(0,n.scrollWidth-n.clientWidth+f)+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0"),!this.checkedZeroWidth&&n.clientHeight>0&&(t==0&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:r?t:0,bottom:i?t:0}},nr.prototype.setScrollLeft=function(n){this.horiz.scrollLeft!=n&&(this.horiz.scrollLeft=n);this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},nr.prototype.setScrollTop=function(n){this.vert.scrollTop!=n&&(this.vert.scrollTop=n);this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},nr.prototype.zeroWidthHack=function(){var n=kt&&!eit?"12px":"18px";this.horiz.style.height=this.vert.style.width=n;this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";this.disableHoriz=new gi;this.disableVert=new gi},nr.prototype.enableZeroWidthBar=function(n,t,i){function r(){var u=n.getBoundingClientRect(),f=i=="vert"?document.elementFromPoint(u.right-1,(u.top+u.bottom)/2):document.elementFromPoint((u.right+u.left)/2,u.bottom-1);f!=n?n.style.pointerEvents="none":t.set(1e3,r)}n.style.pointerEvents="auto";t.set(1e3,r)},nr.prototype.clear=function(){var n=this.horiz.parentNode;n.removeChild(this.horiz);n.removeChild(this.vert)},bu=function(){},bu.prototype.update=function(){return{bottom:0,right:0}},bu.prototype.setScrollLeft=function(){},bu.prototype.setScrollTop=function(){},bu.prototype.clear=function(){},vl={"native":nr,"null":bu},wb=0,ye=function(n,t,i){var r=n.display;this.viewport=t;this.visible=oc(r,n.doc,t);this.editorIsHidden=!r.wrapper.offsetWidth;this.wrapperHeight=r.wrapper.clientHeight;this.wrapperWidth=r.wrapper.clientWidth;this.oldDisplayWidth=or(n);this.force=i;this.dims=ic(n);this.events=[]},ye.prototype.signal=function(n,t){vt(n,t)&&this.events.push(arguments)},ye.prototype.finish=function(){for(var t=this,n=0;n<this.events.length;n++)y.apply(null,t.events[n])},pe=0,st=null,e?st=-.53:ki?st=15:fs?st=-.7:hb&&(st=-1/3),ht=function(n,t){this.ranges=n;this.primIndex=t},ht.prototype.primary=function(){return this.ranges[this.primIndex]},ht.prototype.equals=function(n){var u=this,t,i,r;if(n==this)return!0;if(n.primIndex!=this.primIndex||n.ranges.length!=this.ranges.length)return!1;for(t=0;t<this.ranges.length;t++)if(i=u.ranges[t],r=n.ranges[t],!th(i.anchor,r.anchor)||!th(i.head,r.head))return!1;return!0},ht.prototype.deepCopy=function(){for(var t=this,i=[],n=0;n<this.ranges.length;n++)i[n]=new o(ih(t.ranges[n].anchor),ih(t.ranges[n].head));return new ht(i,this.primIndex)},ht.prototype.somethingSelected=function(){for(var t=this,n=0;n<this.ranges.length;n++)if(!t.ranges[n].empty())return!0;return!1},ht.prototype.contains=function(n,t){var f=this,i,r;for(t||(t=n),i=0;i<this.ranges.length;i++)if(r=f.ranges[i],u(t,r.from())>=0&&u(n,r.to())<=0)return i;return-1},o=function(n,t){this.anchor=n;this.head=t},o.prototype.from=function(){return ro(this.anchor,this.head)},o.prototype.to=function(){return io(this.anchor,this.head)},o.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},ue.prototype={chunkSize:function(){return this.lines.length},removeInner:function(n,t){for(var i,u=this,r=n,f=n+t;r<f;++r)i=u.lines[r],u.height-=i.height,rd(i),g(i,"delete");this.lines.splice(n,t)},collapse:function(n){n.push.apply(n,this.lines)},insertInner:function(n,t,i){var u=this,r;for(this.height+=i,this.lines=this.lines.slice(0,n).concat(t).concat(this.lines.slice(n)),r=0;r<t.length;++r)t[r].parent=u},iterN:function(n,t,i){for(var r=this,u=n+t;n<u;++n)if(i(r.lines[n]))return!0}},fe.prototype={chunkSize:function(){return this.size},removeInner:function(n,t){var e=this,r,i,u,f,s,o;for(this.size-=t,r=0;r<this.children.length;++r)if(i=e.children[r],u=i.chunkSize(),n<u){if(f=Math.min(t,u-n),s=i.height,i.removeInner(n,f),e.height-=s-i.height,u==f&&(e.children.splice(r--,1),i.parent=null),(t-=f)==0)break;n=0}else n-=u;this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof ue))&&(o=[],this.collapse(o),this.children=[new ue(o)],this.children[0].parent=this)},collapse:function(n){for(var i=this,t=0;t<this.children.length;++t)i.children[t].collapse(n)},insertInner:function(n,t,i){var f=this,u,r,s,h,e,o;for(this.size+=t.length,this.height+=i,u=0;u<this.children.length;++u){if(r=f.children[u],s=r.chunkSize(),n<=s){if(r.insertInner(n,t,i),r.lines&&r.lines.length>50){for(h=r.lines.length%25+25,e=h;e<r.lines.length;)o=new ue(r.lines.slice(e,e+=25)),r.height-=o.height,f.children.splice(++u,0,o),o.parent=f;r.lines=r.lines.slice(0,h);f.maybeSpill()}break}n-=s}},maybeSpill:function(){var n,r,t,i,u;if(!(this.children.length<=10)){n=this;do r=n.children.splice(n.children.length-5,5),t=new fe(r),n.parent?(n.size-=t.size,n.height-=t.height,u=d(n.parent.children,n),n.parent.children.splice(u+1,0,t)):(i=new fe(n.children),i.parent=n,n.children=[i,t],n=i),t.parent=n.parent;while(n.children.length>10);n.parent.maybeSpill()}},iterN:function(n,t,i){for(var u,r,f,o=this,e=0;e<this.children.length;++e)if(u=o.children[e],r=u.chunkSize(),n<r){if(f=Math.min(t,r-n),u.iterN(n,f,i))return!0;if((t-=f)==0)break;n=0}else n-=r}},ku=function(n,t,i){var u=this,r;if(i)for(r in i)i.hasOwnProperty(r)&&(u[r]=i[r]);this.doc=n;this.node=t},ku.prototype.clear=function(){var e=this,n=this.doc.cm,t=this.line.widgets,i=this.line,u=h(i),r,f;if(u!=null&&t){for(r=0;r<t.length;++r)t[r]==e&&t.splice(r--,1);t.length||(i.widgets=null);f=vf(this);gt(i,Math.max(0,i.height-f));n&&(ot(n,function(){nw(n,i,-f);yi(n,u,"widget")}),g(n,"lineWidgetCleared",n,this,u))}},ku.prototype.changed=function(){var r=this,u=this.height,n=this.doc.cm,t=this.line,i;(this.height=null,i=vf(this)-u,i)&&(gt(t,t.height+i),n&&ot(n,function(){n.curOp.forceUpdate=!0;nw(n,t,i);g(n,"lineWidgetChanged",n,r,h(t))}))},tu(ku),yl=0,ci=function(n,t){this.lines=[];this.type=t;this.doc=n;this.id=++yl},ci.prototype.clear=function(){var i=this,n,c,f,r,e,o,t,u,s,l,a;if(!this.explicitlyCleared){for(n=this.doc.cm,c=n&&!n.curOp,c&&ar(n),vt(this,"clear")&&(f=this.find(),f&&g(this,"clear",f.from,f.to)),r=null,e=null,o=0;o<this.lines.length;++o)t=i.lines[o],u=of(t.markedSpans,i),n&&!i.collapsed?yi(n,h(t),"text"):n&&(u.to!=null&&(e=h(t)),u.from!=null&&(r=h(t))),t.markedSpans=ok(t.markedSpans,u),u.from==null&&i.collapsed&&!fr(i.doc,t)&&n&&gt(t,sr(n.display));if(n&&this.collapsed&&!n.options.lineWrapping)for(s=0;s<this.lines.length;++s)l=ni(i.lines[s]),a=oo(l),a>n.display.maxLineLength&&(n.display.maxLine=l,n.display.maxLineLength=a,n.display.maxLineChanged=!0);r!=null&&n&&this.collapsed&&et(n,r,e+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,n&&lp(n.doc));n&&g(n,"markerCleared",n,this,r,e);c&&vr(n);this.parent&&this.parent.clear()}},ci.prototype.find=function(t,i){var s=this,f,o,e,r,u;for(t==null&&this.type=="bookmark"&&(t=1),e=0;e<this.lines.length;++e){if(r=s.lines[e],u=of(r.markedSpans,s),u.from!=null&&(f=n(i?r:h(r),u.from),t==-1))return f;if(u.to!=null&&(o=n(i?r:h(r),u.to),t==1))return o}return f&&{from:f,to:o}},ci.prototype.changed=function(){var r=this,i=this.find(-1,!0),t=this,n=this.doc.cm;i&&n&&ot(n,function(){var u=i.line,s=h(i.line),e=bh(n,s),o,f;e&&(pv(e),n.curOp.selectionChanged=n.curOp.forceUpdate=!0);n.curOp.updateMaxLine=!0;fr(t.doc,u)||t.height==null||(o=t.height,t.height=null,f=vf(t)-o,f&&gt(u,u.height+f));g(n,"markerChanged",n,r)})},ci.prototype.attachLine=function(n){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&d(t.maybeHiddenMarkers,this)!=-1||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(n)},ci.prototype.detachLine=function(n){if(this.lines.splice(d(this.lines,n),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},tu(ci),du=function(n,t){var r=this,i;for(this.markers=n,this.primary=t,i=0;i<n.length;++i)n[i].parent=r},du.prototype.clear=function(){var t=this,n;if(!this.explicitlyCleared){for(this.explicitlyCleared=!0,n=0;n<this.markers.length;++n)t.markers[n].clear();g(this,"clear")}},du.prototype.find=function(n,t){return this.primary.find(n,t)},tu(du),bb=0,ut=function(t,i,r,u,f){if(!(this instanceof ut))return new ut(t,i,r,u,f);r==null&&(r=0);fe.call(this,[new ue([new kr("",null)])]);this.first=r;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.modeFrontier=this.highlightFrontier=r;var e=n(r,0);this.sel=wi(e);this.history=new wo(null);this.id=++bb;this.modeOption=i;this.lineSep=u;this.direction=f=="rtl"?"rtl":"ltr";this.extend=!1;typeof t=="string"&&(t=this.splitLines(t));bc(this,{from:e,to:e,text:t});nt(this,wi(e),ui)},ut.prototype=na(fe.prototype,{constructor:ut,iter:function(n,t,i){i?this.iterN(n-this.first,t-n,i):this.iterN(this.first,this.first+this.size,n)},insert:function(n,t){for(var r=0,i=0;i<t.length;++i)r+=t[i].height;this.insertInner(n-this.first,t,r)},remove:function(n,t){this.removeInner(n-this.first,t)},getValue:function(n){var t=gs(this,this.first,this.first+this.size);return n===!1?t:t.join(n||this.lineSeparator())},setValue:k(function(i){var r=n(this.first,0),u=this.first+this.size-1;ou(this,{from:r,to:n(u,t(this,u).text.length),text:this.splitLines(i),origin:"setValue",full:!0},!0);this.cm&&kf(this.cm,0,0);nt(this,wi(r),ui)}),replaceRange:function(n,t,i,r){t=f(this,t);i=i?f(this,i):t;su(this,n,t,i,r)},getRange:function(n,t,i){var r=rr(this,f(this,n),f(this,t));return i===!1?r:r.join(i||this.lineSeparator())},getLine:function(n){var t=this.getLineHandle(n);return t&&t.text},getLineHandle:function(n){if(ef(this,n))return t(this,n)},getLineNumber:function(n){return h(n)},getLineHandleVisualStart:function(n){return typeof n=="number"&&(n=t(this,n)),ni(n)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(n){return f(this,n)},getCursor:function(n){var t=this.sel.primary();return n==null||n=="head"?t.head:n=="anchor"?t.anchor:n=="end"||n=="to"||n===!1?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:k(function(t,i,r){sp(this,f(this,typeof t=="number"?n(t,i||0):t),null,r)}),setSelection:k(function(n,t,i){sp(this,f(this,n),f(this,t||n),i)}),extendSelection:k(function(n,t,i){ko(this,f(this,n),t&&f(this,t),i)}),extendSelections:k(function(n,t){op(this,ua(this,n),t)}),extendSelectionsBy:k(function(n,t){var i=no(this.sel.ranges,n);op(this,ua(this,i),t)}),setSelections:k(function(n,t,i){var e=this,u,r;if(n.length){for(u=[],r=0;r<n.length;r++)u[r]=new o(f(e,n[r].anchor),f(e,n[r].head));t==null&&(t=Math.min(n.length-1,this.sel.primIndex));nt(this,wt(u,t),i)}}),addSelection:k(function(n,t,i){var r=this.sel.ranges.slice(0);r.push(new o(f(this,n),f(this,t||n)));nt(this,wt(r,r.length-1),i)}),getSelection:function(n){for(var r,f=this,u=this.sel.ranges,t,i=0;i<u.length;i++)r=rr(f,u[i].from(),u[i].to()),t=t?t.concat(r):r;return n===!1?t:t.join(n||this.lineSeparator())},getSelections:function(n){for(var i,u=this,f=[],r=this.sel.ranges,t=0;t<r.length;t++)i=rr(u,r[t].from(),r[t].to()),n!==!1&&(i=i.join(n||u.lineSeparator())),f[t]=i;return f},replaceSelection:function(n,t,i){for(var u=[],r=0;r<this.sel.ranges.length;r++)u[r]=n;this.replaceSelections(u,t,i||"+input")},replaceSelections:k(function(n,t,i){for(var e,o,u,s=this,f=[],h=this.sel,r=0;r<h.ranges.length;r++)e=h.ranges[r],f[r]={from:e.from(),to:e.to(),text:s.splitLines(n[r]),origin:i};for(o=t&&t!="end"&&rn(this,f,t),u=f.length-1;u>=0;u--)ou(s,f[u]);o?hp(this,o):this.cm&&ru(this.cm)}),undo:k(function(){ns(this,"undo")}),redo:k(function(){ns(this,"redo")}),undoSelection:k(function(){ns(this,"undo",!0)}),redoSelection:k(function(){ns(this,"redo",!0)}),setExtending:function(n){this.extend=n},getExtending:function(){return this.extend},historySize:function(){for(var n,t=this.history,r=0,u=0,i=0;i<t.done.length;i++)t.done[i].ranges||++r;for(n=0;n<t.undone.length;n++)t.undone[n].ranges||++u;return{undo:r,redo:u}},clearHistory:function(){this.history=new wo(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(n){return n&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(n){return this.history.generation==(n||this.cleanGeneration)},getHistory:function(){return{done:fu(this.history.done),undone:fu(this.history.undone)}},setHistory:function(n){var t=this.history=new wo(this.history.maxGeneration);t.done=fu(n.done.slice(0),null,!0);t.undone=fu(n.undone.slice(0),null,!0)},setGutterMarker:k(function(n,t,i){return re(this,n,"gutter",function(n){var r=n.gutterMarkers||(n.gutterMarkers={});return r[t]=i,!i&&ta(r)&&(n.gutterMarkers=null),!0})}),clearGutter:k(function(n){var t=this;this.iter(function(i){i.gutterMarkers&&i.gutterMarkers[n]&&re(t,i,"gutter",function(){return i.gutterMarkers[n]=null,ta(i.gutterMarkers)&&(i.gutterMarkers=null),!0})})}),lineInfo:function(n){var i;if(typeof n=="number"){if(!ef(this,n)||(i=n,n=t(this,n),!n))return null}else if(i=h(n),i==null)return null;return{line:i,handle:n,text:n.text,gutterMarkers:n.gutterMarkers,textClass:n.textClass,bgClass:n.bgClass,wrapClass:n.wrapClass,widgets:n.widgets}},addLineClass:k(function(n,t,i){return re(this,n,t=="gutter"?"gutter":"class",function(n){var r=t=="text"?"textClass":t=="background"?"bgClass":t=="gutter"?"gutterClass":"wrapClass";if(n[r]){if(uf(i).test(n[r]))return!1;n[r]+=" "+i}else n[r]=i;return!0})}),removeLineClass:k(function(n,t,i){return re(this,n,t=="gutter"?"gutter":"class",function(n){var f=t=="text"?"textClass":t=="background"?"bgClass":t=="gutter"?"gutterClass":"wrapClass",u=n[f],r,e;if(u)if(i==null)n[f]=null;else{if(r=u.match(uf(i)),!r)return!1;e=r.index+r[0].length;n[f]=u.slice(0,r.index)+(!r.index||e==u.length?"":" ")+u.slice(e)||null}else return!1;return!0})}),addLineWidget:k(function(n,t,i){return an(this,n,t,i)}),removeLineWidget:function(n){n.clear()},markText:function(n,t,i){return hu(this,f(this,n),f(this,t),i,i&&i.type||"range")},setBookmark:function(n,t){var i={replacedWith:t&&(t.nodeType==null?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return n=f(this,n),hu(this,n,n,i,"bookmark")},findMarksAt:function(n){var e,r,u,i;if(n=f(this,n),e=[],r=t(this,n.line).markedSpans,r)for(u=0;u<r.length;++u)i=r[u],(i.from==null||i.from<=n.ch)&&(i.to==null||i.to>=n.ch)&&e.push(i.marker.parent||i.marker);return e},findMarks:function(n,t,i){n=f(this,n);t=f(this,t);var u=[],r=n.line;return this.iter(n.line,t.line+1,function(f){var s=f.markedSpans,o,e;if(s)for(o=0;o<s.length;o++)e=s[o],e.to!=null&&r==n.line&&n.ch>=e.to||e.from==null&&r!=n.line||e.from!=null&&r==t.line&&e.from>=t.ch||i&&!i(e.marker)||u.push(e.marker.parent||e.marker);++r}),u},getAllMarks:function(){var n=[];return this.iter(function(t){var r=t.markedSpans,i;if(r)for(i=0;i<r.length;++i)r[i].from!=null&&n.push(r[i].marker)}),n},posFromIndex:function(t){var i,r=this.first,u=this.lineSeparator().length;return this.iter(function(n){var f=n.text.length+u;if(f>t)return i=t,!0;t-=f;++r}),f(this,n(r,i))},indexFromPos:function(n){var t,i;return(n=f(this,n),t=n.ch,n.line<this.first||n.ch<0)?0:(i=this.lineSeparator().length,this.iter(this.first,n.line,function(n){t+=n.text.length+i}),t)},copy:function(n){var t=new ut(gs(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,n&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(n){var i,r,t;return n||(n={}),i=this.first,r=this.first+this.size,n.from!=null&&n.from>i&&(i=n.from),n.to!=null&&n.to<r&&(r=n.to),t=new ut(gs(this,i,r),n.mode||this.modeOption,i,this.lineSep,this.direction),n.sharedHist&&(t.history=this.history),(this.linked||(this.linked=[])).push({doc:t,sharedHist:n.sharedHist}),t.linked=[{doc:this,isParent:!0,sharedHist:n.sharedHist}],yn(t,tw(this)),t},unlinkDoc:function(n){var i=this,t,u,r;if(n instanceof a&&(n=n.doc),this.linked)for(t=0;t<this.linked.length;++t)if(u=i.linked[t],u.doc==n){i.linked.splice(t,1);n.unlinkDoc(i);pn(tw(i));break}n.history==this.history&&(r=[n.id],yr(n,function(n){return r.push(n.id)},!0),n.history=new wo(null),n.history.done=fu(this.history.done,r),n.history.undone=fu(this.history.undone,r))},iterLinkedDocs:function(n){yr(this,n)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(n){return this.lineSep?n.split(this.lineSep):kl(n)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:k(function(n){(n!="rtl"&&(n="ltr"),n!=this.direction)&&(this.direction=n,this.iter(function(n){return n.order=null}),this.cm&&un(this.cm))})}),ut.prototype.eachLine=ut.prototype.iter,pl=0,wl=!1,li={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},gu=0;gu<10;gu++)li[gu+48]=li[gu+96]=String(gu);for(we=65;we<=90;we++)li[we]=String.fromCharCode(we);for(nf=1;nf<=12;nf++)li[nf+111]=li[nf+63235]="F"+nf;ri={};ri.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};ri.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};ri.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"};ri.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]};ri["default"]=kt?ri.macDefault:ri.pcDefault;tf={selectAll:yp,singleSelection:function(n){return n.setSelection(n.getCursor("anchor"),n.getCursor("head"),ui)},killLine:function(i){return lu(i,function(r){if(r.empty()){var u=t(i.doc,r.head.line).text.length;return r.head.ch==u&&r.head.line<i.lastLine()?{from:r.head,to:n(r.head.line+1,0)}:{from:r.head,to:n(r.head.line,u)}}return{from:r.from(),to:r.to()}})},deleteLine:function(t){return lu(t,function(i){return{from:n(i.from().line,0),to:f(t.doc,n(i.to().line+1,0))}})},delLineLeft:function(t){return lu(t,function(t){return{from:n(t.from().line,0),to:t.from()}})},delWrappedLineLeft:function(n){return lu(n,function(t){var i=n.charCoords(t.head,"div").top+5,r=n.coordsChar({left:0,top:i},"div");return{from:r,to:t.from()}})},delWrappedLineRight:function(n){return lu(n,function(t){var i=n.charCoords(t.head,"div").top+5,r=n.coordsChar({left:n.display.lineDiv.offsetWidth+100,top:i},"div");return{from:t.from(),to:r}})},undo:function(n){return n.undo()},redo:function(n){return n.redo()},undoSelection:function(n){return n.undoSelection()},redoSelection:function(n){return n.redoSelection()},goDocStart:function(t){return t.extendSelection(n(t.firstLine(),0))},goDocEnd:function(t){return t.extendSelection(n(t.lastLine()))},goLineStart:function(n){return n.extendSelectionsBy(function(t){return sw(n,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(n){return n.extendSelectionsBy(function(t){return hw(n,t.head)},{origin:"+move",bias:1})},goLineEnd:function(n){return n.extendSelectionsBy(function(t){return utt(n,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(n){return n.extendSelectionsBy(function(t){var i=n.cursorCoords(t.head,"div").top+5;return n.coordsChar({left:n.display.lineDiv.offsetWidth+100,top:i},"div")},ge)},goLineLeft:function(n){return n.extendSelectionsBy(function(t){var i=n.cursorCoords(t.head,"div").top+5;return n.coordsChar({left:0,top:i},"div")},ge)},goLineLeftSmart:function(n){return n.extendSelectionsBy(function(t){var r=n.cursorCoords(t.head,"div").top+5,i=n.coordsChar({left:0,top:r},"div");return i.ch<n.getLine(i.line).search(/\S/)?hw(n,t.head):i},ge)},goLineUp:function(n){return n.moveV(-1,"line")},goLineDown:function(n){return n.moveV(1,"line")},goPageUp:function(n){return n.moveV(-1,"page")},goPageDown:function(n){return n.moveV(1,"page")},goCharLeft:function(n){return n.moveH(-1,"char")},goCharRight:function(n){return n.moveH(1,"char")},goColumnLeft:function(n){return n.moveH(-1,"column")},goColumnRight:function(n){return n.moveH(1,"column")},goWordLeft:function(n){return n.moveH(-1,"word")},goGroupRight:function(n){return n.moveH(1,"group")},goGroupLeft:function(n){return n.moveH(-1,"group")},goWordRight:function(n){return n.moveH(1,"word")},delCharBefore:function(n){return n.deleteH(-1,"char")},delCharAfter:function(n){return n.deleteH(1,"char")},delWordBefore:function(n){return n.deleteH(-1,"word")},delWordAfter:function(n){return n.deleteH(1,"word")},delGroupBefore:function(n){return n.deleteH(-1,"group")},delGroupAfter:function(n){return n.deleteH(1,"group")},indentAuto:function(n){return n.indentSelection("smart")},indentMore:function(n){return n.indentSelection("add")},indentLess:function(n){return n.indentSelection("subtract")},insertTab:function(n){return n.replaceSelection("\t")},insertSoftTab:function(n){for(var t,u,f=[],e=n.listSelections(),i=n.options.tabSize,r=0;r<e.length;r++)t=e[r].from(),u=at(n.getLine(t.line),t.ch,i),f.push(bs(i-u%i));n.replaceSelections(f)},defaultTab:function(n){n.somethingSelected()?n.indentSelection("add"):n.execCommand("insertTab")},transposeChars:function(i){return ot(i,function(){for(var r,u,f,s=i.listSelections(),h=[],e=0;e<s.length;e++)s[e].empty()&&(r=s[e].head,u=t(i.doc,r.line).text,u&&(r.ch==u.length&&(r=new n(r.line,r.ch-1)),r.ch>0?(r=new n(r.line,r.ch+1),i.replaceRange(u.charAt(r.ch-1)+u.charAt(r.ch-2),n(r.line,r.ch-2),r,"+transpose")):r.line>i.doc.first&&(f=t(i.doc,r.line-1).text,f&&(r=new n(r.line,1),i.replaceRange(u.charAt(0)+i.doc.lineSeparator()+f.charAt(f.length-1),n(r.line-1,f.length-1),r,"+transpose")))),h.push(new o(r,r)));i.setSelections(h)})},newlineAndIndent:function(n){return ot(n,function(){for(var i,t=n.listSelections(),r=t.length-1;r>=0;r--)n.replaceRange(n.doc.lineSeparator(),t[r].anchor,t[r].head,"+input");for(t=n.listSelections(),i=0;i<t.length;i++)n.indentLine(t[i].from().line,null,!0);ru(n)})},openLine:function(n){return n.replaceSelection("\n","start")},toggleOverwrite:function(n){return n.toggleOverwrite()}};kb=new gi;hs=null;db=400;cs=function(n,t,i){this.time=n;this.pos=t;this.button=i};cs.prototype.compare=function(n,t,i){return this.time+db>n&&u(t,this.pos)==0&&i==this.button};var rf={toString:function(){return"CodeMirror.Init"}},tk={},vs={};a.defaults=tk;a.optionHandlers=vs;ls=[];a.defineInitHook=function(n){return ls.push(n)};yt=null;c=function(n){this.cm=n;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new gi;this.composing=null;this.gracePeriod=!1;this.readDOMTimeout=null};c.prototype.init=function(n){function e(n){var r,e,i,o,s;if(!w(t,n)){if(t.somethingSelected())rs({lineWise:!1,text:t.getSelections()}),n.type=="cut"&&t.replaceSelection("",null,"cut");else if(t.options.lineWiseCopyCut)r=tb(t),rs({lineWise:!0,text:r.text}),n.type=="cut"&&t.operation(function(){t.setSelections(r.ranges,0,ui);t.replaceSelection("",null,"cut")});else return;if(n.clipboardData&&(n.clipboardData.clearData(),e=yt.text.join("\n"),n.clipboardData.setData("Text",e),n.clipboardData.getData("Text")==e)){n.preventDefault();return}i=rb();o=i.firstChild;t.display.lineSpace.insertBefore(i,t.display.lineSpace.firstChild);o.value=yt.text.join("\n");s=document.activeElement;yu(o);setTimeout(function(){t.display.lineSpace.removeChild(i);s.focus();s==u&&f.showPrimarySelection()},50)}}var i=this,f=this,t=f.cm,u=f.div=n.lineDiv;ib(u,t.options.spellcheck);r(u,"paste",function(n){w(t,n)||gw(n,t)||l<=11&&setTimeout(b(t,function(){return i.updateFromDOM()}),20)});r(u,"compositionstart",function(n){i.composing={data:n.data,done:!1}});r(u,"compositionupdate",function(n){i.composing||(i.composing={data:n.data,done:!1})});r(u,"compositionend",function(n){i.composing&&(n.data!=i.composing.data&&i.readFromDOMSoon(),i.composing.done=!0)});r(u,"touchstart",function(){return f.forceCompositionEnd()});r(u,"input",function(){i.composing||i.readFromDOMSoon()});r(u,"copy",e);r(u,"cut",e)};c.prototype.prepareSelection=function(){var n=ry(this.cm,!1);return n.focus=this.cm.state.focused,n};c.prototype.showSelection=function(n,t){n&&this.cm.display.view.length&&((n.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(n))};c.prototype.showPrimarySelection=function(){var n=window.getSelection(),t=this.cm,y=t.doc.sel.primary(),c=y.from(),l=y.to(),r,f,e,i,a,o;if(t.display.viewTo==t.display.viewFrom||c.line>=t.display.viewTo||l.line<t.display.viewFrom){n.removeAllRanges();return}if(r=us(t,n.anchorNode,n.anchorOffset),f=us(t,n.focusNode,n.focusOffset),!r||r.bad||!f||f.bad||u(ro(r,f),c)!=0||u(io(r,f),l)!=0){var v=t.display.view,s=c.line>=t.display.viewFrom&&fb(t,c)||{node:v[0].measure.map[2],offset:0},h=l.line<t.display.viewTo&&fb(t,l);if(h||(e=v[v.length-1].measure,i=e.maps?e.maps[e.maps.length-1]:e.map,h={node:i[i.length-1],offset:i[i.length-2]-i[i.length-3]}),!s||!h){n.removeAllRanges();return}a=n.rangeCount&&n.getRangeAt(0);try{o=vu(s.node,s.offset,h.offset,h.node)}catch(p){}o&&(!ki&&t.state.focused?(n.collapse(s.node,s.offset),o.collapsed||(n.removeAllRanges(),n.addRange(o))):(n.removeAllRanges(),n.addRange(o)),a&&n.anchorNode==null?n.addRange(a):ki&&this.startGracePeriod());this.rememberSelection()}};c.prototype.startGracePeriod=function(){var n=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){n.gracePeriod=!1;n.selectionChanged()&&n.cm.operation(function(){return n.cm.curOp.selectionChanged=!0})},20)};c.prototype.showMultipleSelections=function(n){ct(this.cm.display.cursorDiv,n.cursors);ct(this.cm.display.selectionDiv,n.selection)};c.prototype.rememberSelection=function(){var n=window.getSelection();this.lastAnchorNode=n.anchorNode;this.lastAnchorOffset=n.anchorOffset;this.lastFocusNode=n.focusNode;this.lastFocusOffset=n.focusOffset};c.prototype.selectionInEditor=function(){var n=window.getSelection(),t;return n.rangeCount?(t=n.getRangeAt(0).commonAncestorContainer,vi(this.div,t)):!1};c.prototype.focus=function(){this.cm.options.readOnly!="nocursor"&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())};c.prototype.blur=function(){this.div.blur()};c.prototype.getField=function(){return this.div};c.prototype.supportsTouch=function(){return!0};c.prototype.receivedFocus=function(){function t(){n.cm.state.focused&&(n.pollSelection(),n.polling.set(n.cm.options.pollInterval,t))}var n=this;this.selectionInEditor()?this.pollSelection():ot(this.cm,function(){return n.cm.curOp.selectionChanged=!0});this.polling.set(this.cm.options.pollInterval,t)};c.prototype.selectionChanged=function(){var n=window.getSelection();return n.anchorNode!=this.lastAnchorNode||n.anchorOffset!=this.lastAnchorOffset||n.focusNode!=this.lastFocusNode||n.focusOffset!=this.lastFocusOffset};c.prototype.pollSelection=function(){var n,t,i,r;if(this.readDOMTimeout==null&&!this.gracePeriod&&this.selectionChanged()){if(n=window.getSelection(),t=this.cm,es&&fs&&this.cm.options.gutters.length&&nit(n.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs});this.blur();this.focus();return}this.composing||(this.rememberSelection(),i=us(t,n.anchorNode,n.anchorOffset),r=us(t,n.focusNode,n.focusOffset),i&&r&&ot(t,function(){nt(t.doc,wi(i,r),ui);(i.bad||r.bad)&&(t.curOp.selectionChanged=!0)}))}};c.prototype.pollContent=function(){var d,a,b,k,v,g,i,f,nt,tt;this.readDOMTimeout!=null&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var r=this.cm,e=r.display,it=r.doc.sel.primary(),c=it.from(),y=it.to();if((c.ch==0&&c.line>r.firstLine()&&(c=n(c.line-1,t(r.doc,c.line-1).length)),y.ch==t(r.doc,y.line).text.length&&y.line<r.lastLine()&&(y=n(y.line+1,0)),c.line<e.viewFrom||y.line>e.viewTo-1)||(c.line==e.viewFrom||(d=cr(r,c.line))==0?(a=h(e.view[0].line),b=e.view[0].node):(a=h(e.view[d].line),b=e.view[d-1].node.nextSibling),k=cr(r,y.line),k==e.view.length-1?(v=e.viewTo-1,g=e.lineDiv.lastChild):(v=h(e.view[k+1].line)-1,g=e.view[k+1].node.previousSibling),!b))return!1;for(i=r.doc.splitLines(tit(r,b,g,a,v)),f=rr(r.doc,n(a,0),n(v,t(r.doc,v).text.length));i.length>1&&f.length>1;)if(s(i)==s(f))i.pop(),f.pop(),v--;else if(i[0]==f[0])i.shift(),f.shift(),a++;else break;for(var o=0,l=0,rt=i[0],ut=f[0],ft=Math.min(rt.length,ut.length);o<ft&&rt.charCodeAt(o)==ut.charCodeAt(o);)++o;for(var p=s(i),w=s(f),et=Math.min(p.length-(i.length==1?o:0),w.length-(f.length==1?o:0));l<et&&p.charCodeAt(p.length-l-1)==w.charCodeAt(w.length-l-1);)++l;if(i.length==1&&f.length==1&&a==c.line)while(o&&o>c.ch&&p.charCodeAt(p.length-l-1)==w.charCodeAt(w.length-l-1))o--,l++;return i[i.length-1]=p.slice(0,p.length-l).replace(/^\u200b+/,""),i[0]=i[0].slice(o).replace(/\u200b+$/,""),nt=n(a,o),tt=n(v,f.length?s(f).length-l:0),i.length>1||i[0]||u(nt,tt)?(su(r.doc,i,nt,tt,"+input"),!0):void 0};c.prototype.ensurePolled=function(){this.forceCompositionEnd()};c.prototype.reset=function(){this.forceCompositionEnd()};c.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())};c.prototype.readFromDOMSoon=function(){var n=this;this.readDOMTimeout==null&&(this.readDOMTimeout=setTimeout(function(){if(n.readDOMTimeout=null,n.composing)if(n.composing.done)n.composing=null;else return;n.updateFromDOM()},80))};c.prototype.updateFromDOM=function(){var n=this;(this.cm.isReadOnly()||!this.pollContent())&&ot(this.cm,function(){return et(n.cm)})};c.prototype.setUneditable=function(n){n.contentEditable="false"};c.prototype.onKeyPress=function(n){n.charCode!=0&&(n.preventDefault(),this.cm.isReadOnly()||b(this.cm,ul)(this.cm,String.fromCharCode(n.charCode==null?n.keyCode:n.charCode),0))};c.prototype.readOnlyChanged=function(n){this.div.contentEditable=String(n!="nocursor")};c.prototype.onContextMenu=function(){};c.prototype.resetPosition=function(){};c.prototype.needsContentAttribute=!0;p=function(n){this.cm=n;this.prevInput="";this.pollingFast=!1;this.polling=new gi;this.hasSelection=!1;this.composing=null};p.prototype.init=function(n){function f(n){if(!w(t,n)){if(t.somethingSelected())rs({lineWise:!1,text:t.getSelections()});else if(t.options.lineWiseCopyCut){var r=tb(t);rs({lineWise:!0,text:r.text});n.type=="cut"?t.setSelections(r.ranges,null,ui):(i.prevInput="",u.value=r.text.join("\n"),yu(u))}else return;n.type=="cut"&&(t.state.cutIncoming=!0)}}var o=this,i=this,t=this.cm,s=this.wrapper=rb(),u=this.textarea=s.firstChild;n.wrapper.insertBefore(s,n.wrapper.firstChild);ce&&(u.style.width="0px");r(u,"input",function(){e&&l>=9&&o.hasSelection&&(o.hasSelection=null);i.poll()});r(u,"paste",function(n){w(t,n)||gw(n,t)||(t.state.pasteIncoming=!0,i.fastPoll())});r(u,"cut",f);r(u,"copy",f);r(n.scroller,"paste",function(r){si(n,r)||w(t,r)||(t.state.pasteIncoming=!0,i.focus())});r(n.lineSpace,"selectstart",function(t){si(n,t)||ft(t)});r(u,"compositionstart",function(){var n=t.getCursor("from");i.composing&&i.composing.range.clear();i.composing={start:n,range:t.markText(n,t.getCursor("to"),{className:"CodeMirror-composing"})}});r(u,"compositionend",function(){i.composing&&(i.poll(),i.composing.range.clear(),i.composing=null)})};p.prototype.prepareSelection=function(){var n=this.cm,t=n.display,e=n.doc,i=ry(n);if(n.options.moveInputWithCursor){var r=pt(n,e.sel.primary().head,"div"),u=t.wrapper.getBoundingClientRect(),f=t.lineDiv.getBoundingClientRect();i.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+f.top-u.top));i.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+f.left-u.left))}return i};p.prototype.showSelection=function(n){var i=this.cm,t=i.display;ct(t.cursorDiv,n.cursors);ct(t.selectionDiv,n.selection);n.teTop!=null&&(this.wrapper.style.top=n.teTop+"px",this.wrapper.style.left=n.teLeft+"px")};p.prototype.reset=function(n){var t,i;this.contextMenuPending||this.composing||(t=this.cm,t.somethingSelected()?(this.prevInput="",i=t.getSelection(),this.textarea.value=i,t.state.focused&&yu(this.textarea),e&&l>=9&&(this.hasSelection=i)):n||(this.prevInput=this.textarea.value="",e&&l>=9&&(this.hasSelection=null)))};p.prototype.getField=function(){return this.textarea};p.prototype.supportsTouch=function(){return!1};p.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!le||fi()!=this.textarea))try{this.textarea.focus()}catch(n){}};p.prototype.blur=function(){this.textarea.blur()};p.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0};p.prototype.receivedFocus=function(){this.slowPoll()};p.prototype.slowPoll=function(){var n=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){n.poll();n.cm.state.focused&&n.slowPoll()})};p.prototype.fastPoll=function(){function t(){var r=n.poll();r||i?(n.pollingFast=!1,n.slowPoll()):(i=!0,n.polling.set(60,t))}var i=!1,n=this;n.pollingFast=!0;n.polling.set(20,t)};p.prototype.poll=function(){var i=this,n=this.cm,f=this.textarea,r=this.prevInput,t,o,u,s;if(this.contextMenuPending||!n.state.focused||cit(f)&&!r&&!this.composing||n.isReadOnly()||n.options.disableInput||n.state.keySeq||(t=f.value,t==r&&!n.somethingSelected()))return!1;if(e&&l>=9&&this.hasSelection===t||kt&&/[\uf700-\uf7ff]/.test(t))return n.display.input.reset(),!1;if(n.doc.sel==n.display.selForContextMenu&&(o=t.charCodeAt(0),o!=8203||r||(r="​"),o==8666))return this.reset(),this.cm.execCommand("undo");for(u=0,s=Math.min(r.length,t.length);u<s&&r.charCodeAt(u)==t.charCodeAt(u);)++u;return ot(n,function(){ul(n,t.slice(u),r.length-u,null,i.composing?"*compose":null);t.length>1e3||t.indexOf("\n")>-1?f.value=i.prevInput="":i.prevInput=t;i.composing&&(i.composing.range.clear(),i.composing.range=n.markText(i.composing.start,n.getCursor("to"),{className:"CodeMirror-composing"}))}),!0};p.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)};p.prototype.onKeyPress=function(){e&&l>=9&&(this.hasSelection=null);this.fastPoll()};p.prototype.onContextMenu=function(n){function c(){if(u.selectionStart!=null){var n=t.somethingSelected(),r="​"+(n?u.value:"");u.value="⇚";u.value=r;f.prevInput=n?"":"​";u.selectionStart=1;u.selectionEnd=r.length;i.selForContextMenu=t.doc.sel}}function a(){if(f.contextMenuPending=!1,f.wrapper.style.cssText=p,u.style.cssText=y,e&&l<9&&i.scrollbars.setScrollTop(i.scroller.scrollTop=k),u.selectionStart!=null){(!e||e&&l<9)&&c();var r=0,n=function(){i.selForContextMenu==t.doc.sel&&u.selectionStart==0&&u.selectionEnd>0&&f.prevInput=="​"?b(t,yp)(t):r++<10?i.detectingSelectAll=setTimeout(n,500):(i.selForContextMenu=null,i.input.reset())};i.detectingSelectAll=setTimeout(n,200)}}var f=this,t=f.cm,i=t.display,u=f.textarea,o=hr(t,n),k=i.scroller.scrollTop,v,y,p,s,w,h;o&&!bt&&(v=t.options.resetSelectionOnContextMenu,v&&t.doc.sel.contains(o)==-1&&b(t,nt)(t.doc,wi(o),ui),y=u.style.cssText,p=f.wrapper.style.cssText,f.wrapper.style.cssText="position: absolute",s=f.wrapper.getBoundingClientRect(),u.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(n.clientY-s.top-5)+"px; left: "+(n.clientX-s.left-5)+"px;\n      z-index: 1000; background: "+(e?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",tt&&(w=window.scrollY),i.input.focus(),tt&&window.scrollTo(null,w),i.input.reset(),t.somethingSelected()||(u.value=f.prevInput=" "),f.contextMenuPending=!0,i.selForContextMenu=t.doc.sel,clearTimeout(i.detectingSelectAll),e&&l>=9&&c(),os?(cf(n),h=function(){lt(window,"mouseup",h);setTimeout(a,20)},r(window,"mouseup",h)):setTimeout(a,50))};p.prototype.readOnlyChanged=function(n){n||this.reset();this.textarea.disabled=n=="nocursor"};p.prototype.setUneditable=function(){};p.prototype.needsContentAttribute=!1;wtt(a);gtt(a);gb="iter insert remove copy getEditor constructor".split(" ");for(de in ut.prototype)ut.prototype.hasOwnProperty(de)&&d(gb,de)<0&&(a.prototype[de]=function(n){return function(){return n.apply(this.doc,arguments)}}(ut.prototype[de]));return tu(ut),a.inputStyles={textarea:p,contenteditable:c},a.defineMode=function(n){a.defaults.mode||n=="null"||(a.defaults.mode=n);kk.apply(this,arguments)},a.defineMIME=dk,a.defineMode("null",function(){return{token:function(n){return n.skipToEnd()}}}),a.defineMIME("text/plain","null"),a.defineExtension=function(n,t){a.prototype[n]=t},a.defineDocExtension=function(n,t){ut.prototype[n]=t},a.fromTextArea=rit,uit(a),a.version="5.31.1",a}),function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)}(function(n){"use strict";n.defineMode("sql",function(t,i){function u(n,t){var i=n.next(),e,u;if(s[i]&&(e=s[i](n,t),e!==!1))return e;if(r.hexNumber&&(i=="0"&&n.match(/^[xX][0-9a-fA-F]+/)||(i=="x"||i=="X")&&n.match(/^'[0-9a-fA-F]+'/))||r.binaryNumber&&((i=="b"||i=="B")&&n.match(/^'[01]+'/)||i=="0"&&n.match(/^b[01]+/)))return"number";if(i.charCodeAt(0)>47&&i.charCodeAt(0)<58)return n.match(/^[0-9]*(\.[0-9]+)?([eE][-+]?[0-9]+)?/),r.decimallessFloat&&n.match(/^\.(?!\.)/),"number";if(i=="?"&&(n.eatSpace()||n.eol()||n.eat(";")))return"variable-3";if(i=="'"||i=='"'&&r.doubleQuote)return t.tokenize=h(i),t.tokenize(n,t);if((r.nCharCast&&(i=="n"||i=="N")||r.charsetCast&&i=="_"&&n.match(/[a-z][a-z0-9]*/i))&&(n.peek()=="'"||n.peek()=='"'))return"keyword";if(/^[\(\),\;\[\]]/.test(i))return null;if(r.commentSlashSlash&&i=="/"&&n.eat("/")||r.commentHash&&i=="#"||i=="-"&&n.eat("-")&&(!r.commentSpaceRequired||n.eat(" ")))return n.skipToEnd(),"comment";if(i=="/"&&n.eat("*"))return t.tokenize=f(1),t.tokenize(n,t);if(i=="."){if(r.zerolessFloat&&n.match(/^(?:\d+(?:e[+-]?\d+)?)/i))return"number";if(n.match(/^\.+/))return null;if(r.ODBCdotTable&&n.match(/^[\w\d_]+/))return"variable-2"}else return o.test(i)?(n.eatWhile(o),null):i=="{"&&(n.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||n.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/))?"number":(n.eatWhile(/^[_\w\d]/),u=n.current().toLowerCase(),p.hasOwnProperty(u)&&(n.match(/^( )+'[^']*'/)||n.match(/^( )+"[^"]*"/)))?"number":a.hasOwnProperty(u)?"atom":v.hasOwnProperty(u)?"builtin":y.hasOwnProperty(u)?"keyword":l.hasOwnProperty(u)?"string-2":null}function h(n){return function(t,i){for(var r=!1,f;(f=t.next())!=null;){if(f==n&&!r){i.tokenize=u;break}r=!r&&f=="\\"}return"string"}}function f(n){return function(t,i){var r=t.match(/^.*?(\/\*|\*\/)/);return r?i.tokenize=r[1]=="/*"?f(n+1):n>1?f(n-1):u:t.skipToEnd(),"comment"}}function e(n,t,i){t.context={prev:t.context,indent:n.indentation(),col:n.column(),type:i}}function c(n){n.indent=n.context.indent;n.context=n.context.prev}var l=i.client||{},a=i.atoms||{"false":!0,"true":!0,"null":!0},v=i.builtin||{},y=i.keywords||{},o=i.operatorChars||/^[*+\-%<>!=&|~^]/,r=i.support||{},s=i.hooks||{},p=i.dateSQL||{date:!0,time:!0,timestamp:!0};return{startState:function(){return{tokenize:u,context:null}},token:function(n,t){var i,r;return(n.sol()&&t.context&&t.context.align==null&&(t.context.align=!1),t.tokenize==u&&n.eatSpace())?null:(i=t.tokenize(n,t),i=="comment")?i:(t.context&&t.context.align==null&&(t.context.align=!0),r=n.current(),r=="("?e(n,t,")"):r=="["?e(n,t,"]"):t.context&&t.context.type==r&&c(t),i)},indent:function(i,r){var u=i.context,f;return u?(f=r.charAt(0)==u.type,u.align?u.col+(f?0:1):u.indent+(f?0:t.indentUnit)):n.Pass},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:r.commentSlashSlash?"//":r.commentHash?"#":"--"}}),function(){function u(n){for(var t;(t=n.next())!=null;)if(t=="`"&&!n.eat("`"))return"variable-2";return n.backUp(n.current().length-1),n.eatWhile(/\w/)?"variable-2":null}function e(n){for(var t;(t=n.next())!=null;)if(t=='"'&&!n.eat('"'))return"variable-2";return n.backUp(n.current().length-1),n.eatWhile(/\w/)?"variable-2":null}function i(n){return(n.eat("@")&&(n.match(/^session\./),n.match(/^local\./),n.match(/^global\./)),n.eat("'"))?(n.match(/^.*'/),"variable-2"):n.eat('"')?(n.match(/^.*"/),"variable-2"):n.eat("`")?(n.match(/^.*`/),"variable-2"):n.match(/^[0-9a-zA-Z$\.\_]+/)?"variable-2":null}function f(n){return n.eat("N")?"atom":n.match(/^[a-zA-Z.#!?]/)?"variable-2":null}function t(n){for(var i={},r=n.split(" "),t=0;t<r.length;++t)i[r[t]]=!0;return i}var r="alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit ";n.defineMIME("text/x-sql",{name:"sql",keywords:t(r+"begin"),builtin:t("bool boolean bit blob enum long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision real date datetime year unsigned signed decimal numeric"),atoms:t("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:t("date time timestamp"),support:t("ODBCdotTable doubleQuote binaryNumber hexNumber")});n.defineMIME("text/x-mssql",{name:"sql",client:t("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:t(r+"begin trigger proc view index for add constraint key primary foreign collate clustered nonclustered declare exec"),builtin:t("bigint numeric bit smallint decimal smallmoney int tinyint money float real char varchar text nchar nvarchar ntext binary varbinary image cursor timestamp hierarchyid uniqueidentifier sql_variant xml table "),atoms:t("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:t("date datetimeoffset datetime2 smalldatetime datetime time"),hooks:{"@":i}});n.defineMIME("text/x-mysql",{name:"sql",client:t("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:t(r+"accessible action add after algorithm all analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general get global grant grants group group_concat handler hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show signal slave slow smallint snapshot soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),builtin:t("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),atoms:t("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:t("date time timestamp"),support:t("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),hooks:{"@":i,"`":u,"\\":f}});n.defineMIME("text/x-mariadb",{name:"sql",client:t("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:t(r+"accessible action add after algorithm all always analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general generated get global grant grants group groupby_concat handler hard hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password persistent phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show shutdown signal slave slow smallint snapshot soft soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views virtual warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),builtin:t("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),atoms:t("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:t("date time timestamp"),support:t("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),hooks:{"@":i,"`":u,"\\":f}});n.defineMIME("text/x-memsql",{name:"sql",client:t("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:t(r+"accessible action add after algorithm all always analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general generated get global grant grants group groupby_concat handler hard hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password persistent phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show shutdown signal slave slow smallint snapshot soft soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views virtual warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),builtin:t("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),atoms:t("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:t("date time timestamp"),support:t("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),hooks:{"@":i,"`":u,"\\":f}});n.defineMIME("text/x-sqlite",{name:"sql",client:t("auth backup bail binary changes check clone databases dbinfo dump echo eqp exit explain fullschema headers help import imposter indexes iotrace limit lint load log mode nullvalue once open output print prompt quit read restore save scanstats schema separator session shell show stats system tables testcase timeout timer trace vfsinfo vfslist vfsname width"),keywords:t(r+"abort action add after all analyze attach autoincrement before begin cascade case cast check collate column commit conflict constraint cross current_date current_time current_timestamp database default deferrable deferred detach each else end escape except exclusive exists explain fail for foreign full glob if ignore immediate index indexed initially inner instead intersect isnull key left limit match natural no notnull null of offset outer plan pragma primary query raise recursive references regexp reindex release rename replace restrict right rollback row savepoint temp temporary then to transaction trigger unique using vacuum view virtual when with without"),builtin:t("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text clob bigint int int2 int8 integer float double char varchar date datetime year unsigned signed numeric real"),atoms:t("null current_date current_time current_timestamp"),operatorChars:/^[*+\-%<>!=&|/~]/,dateSQL:t("date time timestamp datetime"),support:t("decimallessFloat zerolessFloat"),identifierQuote:'"',hooks:{"@":i,":":i,"?":i,$:i,'"':e,"`":u}});n.defineMIME("text/x-cassandra",{name:"sql",client:{},keywords:t("add all allow alter and any apply as asc authorize batch begin by clustering columnfamily compact consistency count create custom delete desc distinct drop each_quorum exists filtering from grant if in index insert into key keyspace keyspaces level limit local_one local_quorum modify nan norecursive nosuperuser not of on one order password permission permissions primary quorum rename revoke schema select set storage superuser table three to token truncate ttl two type unlogged update use user users using values where with writetime"),builtin:t("ascii bigint blob boolean counter decimal double float frozen inet int list map static text timestamp timeuuid tuple uuid varchar varint"),atoms:t("false true infinity NaN"),operatorChars:/^[<>=]/,dateSQL:{},support:t("commentSlashSlash decimallessFloat"),hooks:{}});n.defineMIME("text/x-plsql",{name:"sql",client:t("appinfo arraysize autocommit autoprint autorecovery autotrace blockterminator break btitle cmdsep colsep compatibility compute concat copycommit copytypecheck define describe echo editfile embedded escape exec execute feedback flagger flush heading headsep instance linesize lno loboffset logsource long longchunksize markup native newpage numformat numwidth pagesize pause pno recsep recsepchar release repfooter repheader serveroutput shiftinout show showmode size spool sqlblanklines sqlcase sqlcode sqlcontinue sqlnumber sqlpluscompatibility sqlprefix sqlprompt sqlterminator suffix tab term termout time timing trimout trimspool ttitle underline verify version wrap"),keywords:t("abort accept access add all alter and any array arraylen as asc assert assign at attributes audit authorization avg base_table begin between binary_integer body boolean by case cast char char_base check close cluster clusters colauth column comment commit compress connect connected constant constraint crash create current currval cursor data_base database date dba deallocate debugoff debugon decimal declare default definition delay delete desc digits dispose distinct do drop else elseif elsif enable end entry escape exception exception_init exchange exclusive exists exit external fast fetch file for force form from function generic goto grant group having identified if immediate in increment index indexes indicator initial initrans insert interface intersect into is key level library like limited local lock log logging long loop master maxextents maxtrans member minextents minus mislabel mode modify multiset new next no noaudit nocompress nologging noparallel not nowait number_base object of off offline on online only open option or order out package parallel partition pctfree pctincrease pctused pls_integer positive positiven pragma primary prior private privileges procedure public raise range raw read rebuild record ref references refresh release rename replace resource restrict return returning returns reverse revoke rollback row rowid rowlabel rownum rows run savepoint schema segment select separate session set share snapshot some space split sql start statement storage subtype successful synonym tabauth table tables tablespace task terminate then to trigger truncate type union unique unlimited unrecoverable unusable update use using validate value values variable view views when whenever where while with work"),builtin:t("abs acos add_months ascii asin atan atan2 average bfile bfilename bigserial bit blob ceil character chartorowid chr clob concat convert cos cosh count dec decode deref dual dump dup_val_on_index empty error exp false float floor found glb greatest hextoraw initcap instr instrb int integer isopen last_day least length lengthb ln lower lpad ltrim lub make_ref max min mlslabel mod months_between natural naturaln nchar nclob new_time next_day nextval nls_charset_decl_len nls_charset_id nls_charset_name nls_initcap nls_lower nls_sort nls_upper nlssort no_data_found notfound null number numeric nvarchar2 nvl others power rawtohex real reftohex round rowcount rowidtochar rowtype rpad rtrim serial sign signtype sin sinh smallint soundex sqlcode sqlerrm sqrt stddev string substr substrb sum sysdate tan tanh to_char text to_date to_label to_multi_byte to_number to_single_byte translate true trunc uid unlogged upper user userenv varchar varchar2 variance varying vsize xml"),operatorChars:/^[*+\-%<>!=~]/,dateSQL:t("date time timestamp"),support:t("doubleQuote nCharCast zerolessFloat binaryNumber hexNumber")});n.defineMIME("text/x-hive",{name:"sql",keywords:t("select alter $elem$ $key$ $value$ add after all analyze and archive as asc before between binary both bucket buckets by cascade case cast change cluster clustered clusterstatus collection column columns comment compute concatenate continue create cross cursor data database databases dbproperties deferred delete delimited desc describe directory disable distinct distribute drop else enable end escaped exclusive exists explain export extended external false fetch fields fileformat first format formatted from full function functions grant group having hold_ddltime idxproperties if import in index indexes inpath inputdriver inputformat insert intersect into is items join keys lateral left like limit lines load local location lock locks mapjoin materialized minus msck no_drop nocompress not of offline on option or order out outer outputdriver outputformat overwrite partition partitioned partitions percent plus preserve procedure purge range rcfile read readonly reads rebuild recordreader recordwriter recover reduce regexp rename repair replace restrict revoke right rlike row schema schemas semi sequencefile serde serdeproperties set shared show show_database sort sorted ssl statistics stored streamtable table tables tablesample tblproperties temporary terminated textfile then tmp to touch transform trigger true unarchive undo union uniquejoin unlock update use using utc utc_tmestamp view when where while with"),builtin:t("bool boolean long timestamp tinyint smallint bigint int float double date datetime unsigned string array struct map uniontype"),atoms:t("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:t("date timestamp"),support:t("ODBCdotTable doubleQuote binaryNumber hexNumber")});n.defineMIME("text/x-pgsql",{name:"sql",client:t("source"),keywords:t(r+"a abort abs absent absolute access according action ada add admin after aggregate all allocate also always analyse analyze any are array array_agg array_max_cardinality asensitive assertion assignment asymmetric at atomic attribute attributes authorization avg backward base64 before begin begin_frame begin_partition bernoulli binary bit_length blob blocked bom both breadth c cache call called cardinality cascade cascaded case cast catalog catalog_name ceil ceiling chain characteristics characters character_length character_set_catalog character_set_name character_set_schema char_length check checkpoint class class_origin clob close cluster coalesce cobol collate collation collation_catalog collation_name collation_schema collect column columns column_name command_function command_function_code comment comments commit committed concurrently condition condition_number configuration conflict connect connection connection_name constraint constraints constraint_catalog constraint_name constraint_schema constructor contains content continue control conversion convert copy corr corresponding cost covar_pop covar_samp cross csv cube cume_dist current current_catalog current_date current_default_transform_group current_path current_role current_row current_schema current_time current_timestamp current_transform_group_for_type current_user cursor cursor_name cycle data database datalink datetime_interval_code datetime_interval_precision day db deallocate dec declare default defaults deferrable deferred defined definer degree delimiter delimiters dense_rank depth deref derived describe descriptor deterministic diagnostics dictionary disable discard disconnect dispatch dlnewcopy dlpreviouscopy dlurlcomplete dlurlcompleteonly dlurlcompletewrite dlurlpath dlurlpathonly dlurlpathwrite dlurlscheme dlurlserver dlvalue do document domain dynamic dynamic_function dynamic_function_code each element else empty enable encoding encrypted end end-exec end_frame end_partition enforced enum equals escape event every except exception exclude excluding exclusive exec execute exists exp explain expression extension external extract false family fetch file filter final first first_value flag float floor following for force foreign fortran forward found frame_row free freeze fs full function functions fusion g general generated get global go goto grant granted greatest grouping groups handler header hex hierarchy hold hour id identity if ignore ilike immediate immediately immutable implementation implicit import including increment indent index indexes indicator inherit inherits initially inline inner inout input insensitive instance instantiable instead integrity intersect intersection invoker isnull isolation k key key_member key_type label lag language large last last_value lateral lead leading leakproof least left length level library like_regex link listen ln load local localtime localtimestamp location locator lock locked logged lower m map mapping match matched materialized max maxvalue max_cardinality member merge message_length message_octet_length message_text method min minute minvalue mod mode modifies module month more move multiset mumps name names namespace national natural nchar nclob nesting new next nfc nfd nfkc nfkd nil no none normalize normalized nothing notify notnull nowait nth_value ntile null nullable nullif nulls number object occurrences_regex octets octet_length of off offset oids old only open operator option options ordering ordinality others out outer output over overlaps overlay overriding owned owner p pad parallel parameter parameter_mode parameter_name parameter_ordinal_position parameter_specific_catalog parameter_specific_name parameter_specific_schema parser partial partition pascal passing passthrough password percent percentile_cont percentile_disc percent_rank period permission placing plans pli policy portion position position_regex power precedes preceding prepare prepared preserve primary prior privileges procedural procedure program public quote range rank read reads reassign recheck recovery recursive ref references referencing refresh regr_avgx regr_avgy regr_count regr_intercept regr_r2 regr_slope regr_sxx regr_sxy regr_syy reindex relative release rename repeatable replace replica requiring reset respect restart restore restrict restricted result return returned_cardinality returned_length returned_octet_length returned_sqlstate returning returns revoke right role rollback rollup routine routine_catalog routine_name routine_schema row rows row_count row_number rule savepoint scale schema schema_name scope scope_catalog scope_name scope_schema scroll search second section security selective self sensitive sequence sequences serializable server server_name session session_user setof sets share show similar simple size skip snapshot some source space specific specifictype specific_name sql sqlcode sqlerror sqlexception sqlstate sqlwarning sqrt stable standalone start state statement static statistics stddev_pop stddev_samp stdin stdout storage strict strip structure style subclass_origin submultiset substring substring_regex succeeds sum symmetric sysid system system_time system_user t tables tablesample tablespace table_name temp template temporary then ties timezone_hour timezone_minute to token top_level_count trailing transaction transactions_committed transactions_rolled_back transaction_active transform transforms translate translate_regex translation treat trigger trigger_catalog trigger_name trigger_schema trim trim_array true truncate trusted type types uescape unbounded uncommitted under unencrypted unique unknown unlink unlisten unlogged unnamed unnest until untyped upper uri usage user user_defined_type_catalog user_defined_type_code user_defined_type_name user_defined_type_schema using vacuum valid validate validator value value_of varbinary variadic var_pop var_samp verbose version versioning view views volatile when whenever whitespace width_bucket window within work wrapper write xmlagg xmlattributes xmlbinary xmlcast xmlcomment xmlconcat xmldeclaration xmldocument xmlelement xmlexists xmlforest xmliterate xmlnamespaces xmlparse xmlpi xmlquery xmlroot xmlschema xmlserialize xmltable xmltext xmlvalidate year yes loop repeat attach path depends detach zone"),builtin:t("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float8 inet integer int int4 interval json jsonb line lseg macaddr macaddr8 money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:t("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^\/#@?~]/,dateSQL:t("date time timestamp"),support:t("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast")});n.defineMIME("text/x-gql",{name:"sql",keywords:t("ancestor and asc by contains desc descendant distinct from group has in is limit offset on order select superset where"),atoms:t("false true"),builtin:t("blob datetime first key __key__ string integer double boolean null"),operatorChars:/^[*+\-%<>!=]/});n.defineMIME("text/x-gpsql",{name:"sql",client:t("source"),keywords:t("abort absolute access action active add admin after aggregate all also alter always analyse analyze and any array as asc assertion assignment asymmetric at authorization backward before begin between bigint binary bit boolean both by cache called cascade cascaded case cast chain char character characteristics check checkpoint class close cluster coalesce codegen collate column comment commit committed concurrency concurrently configuration connection constraint constraints contains content continue conversion copy cost cpu_rate_limit create createdb createexttable createrole createuser cross csv cube current current_catalog current_date current_role current_schema current_time current_timestamp current_user cursor cycle data database day deallocate dec decimal declare decode default defaults deferrable deferred definer delete delimiter delimiters deny desc dictionary disable discard distinct distributed do document domain double drop dxl each else enable encoding encrypted end enum errors escape every except exchange exclude excluding exclusive execute exists explain extension external extract false family fetch fields filespace fill filter first float following for force foreign format forward freeze from full function global grant granted greatest group group_id grouping handler hash having header hold host hour identity if ignore ilike immediate immutable implicit in including inclusive increment index indexes inherit inherits initially inline inner inout input insensitive insert instead int integer intersect interval into invoker is isnull isolation join key language large last leading least left level like limit list listen load local localtime localtimestamp location lock log login mapping master match maxvalue median merge minute minvalue missing mode modifies modify month move name names national natural nchar new newline next no nocreatedb nocreateexttable nocreaterole nocreateuser noinherit nologin none noovercommit nosuperuser not nothing notify notnull nowait null nullif nulls numeric object of off offset oids old on only operator option options or order ordered others out outer over overcommit overlaps overlay owned owner parser partial partition partitions passing password percent percentile_cont percentile_disc placing plans position preceding precision prepare prepared preserve primary prior privileges procedural procedure protocol queue quote randomly range read readable reads real reassign recheck recursive ref references reindex reject relative release rename repeatable replace replica reset resource restart restrict returning returns revoke right role rollback rollup rootpartition row rows rule savepoint scatter schema scroll search second security segment select sequence serializable session session_user set setof sets share show similar simple smallint some split sql stable standalone start statement statistics stdin stdout storage strict strip subpartition subpartitions substring superuser symmetric sysid system table tablespace temp template temporary text then threshold ties time timestamp to trailing transaction treat trigger trim true truncate trusted type unbounded uncommitted unencrypted union unique unknown unlisten until update user using vacuum valid validation validator value values varchar variadic varying verbose version view volatile web when where whitespace window with within without work writable write xml xmlattributes xmlconcat xmlelement xmlexists xmlforest xmlparse xmlpi xmlroot xmlserialize year yes zone"),builtin:t("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float float8 inet integer int int4 interval json jsonb line lseg macaddr macaddr8 money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:t("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^\/#@?~]/,dateSQL:t("date time timestamp"),support:t("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast")});n.defineMIME("text/x-sparksql",{name:"sql",keywords:t("add after all alter analyze and anti archive array as asc at between bucket buckets by cache cascade case cast change clear cluster clustered codegen collection column columns comment commit compact compactions compute concatenate cost create cross cube current current_date current_timestamp database databases datata dbproperties defined delete delimited desc describe dfs directories distinct distribute drop else end escaped except exchange exists explain export extended external false fields fileformat first following for format formatted from full function functions global grant group grouping having if ignore import in index indexes inner inpath inputformat insert intersect interval into is items join keys last lateral lazy left like limit lines list load local location lock locks logical macro map minus msck natural no not null nulls of on option options or order out outer outputformat over overwrite partition partitioned partitions percent preceding principals purge range recordreader recordwriter recover reduce refresh regexp rename repair replace reset restrict revoke right rlike role roles rollback rollup row rows schema schemas select semi separated serde serdeproperties set sets show skewed sort sorted start statistics stored stratify struct table tables tablesample tblproperties temp temporary terminated then to touch transaction transactions transform true truncate unarchive unbounded uncache union unlock unset use using values view when where window with"),builtin:t("tinyint smallint int bigint boolean float double string binary timestamp decimal array map struct uniontype delimited serde sequencefile textfile rcfile inputformat outputformat"),atoms:t("false true null"),operatorChars:/^[*+\-%<>!=~&|^]/,dateSQL:t("date time timestamp"),support:t("ODBCdotTable doubleQuote zerolessFloat")});n.defineMIME("text/x-esper",{name:"sql",client:t("source"),keywords:t("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit after all and as at asc avedev avg between by case cast coalesce count create current_timestamp day days delete define desc distinct else end escape events every exists false first from full group having hour hours in inner insert instanceof into irstream is istream join last lastweekday left limit like max match_recognize matches median measures metadatasql min minute minutes msec millisecond milliseconds not null offset on or order outer output partition pattern prev prior regexp retain-union retain-intersection right rstream sec second seconds select set some snapshot sql stddev sum then true unidirectional until update variable weekday when where window"),builtin:{},atoms:t("false true null"),operatorChars:/^[*+\-%<>!=&|^\/#@?~]/,dateSQL:t("time"),support:t("decimallessFloat zerolessFloat binaryNumber hexNumber")})}()}),function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)}(function(n){"use strict";function r(n,t){this.cm=n;this.options=t;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var i=this;n.on("cursorActivity",this.activityFunc=function(){i.cursorActivity()})}function c(t,i){var r=n.cmpPos(i.from,t.from);return r>0&&t.to.ch-t.from.ch!=i.to.ch-i.from.ch}function l(n,t,r){var e=n.options.hintOptions,f={};for(var u in i)f[u]=i[u];if(e)for(u in e)e[u]!==undefined&&(f[u]=e[u]);if(r)for(u in r)r[u]!==undefined&&(f[u]=r[u]);return f.hint.resolve&&(f.hint=f.hint.resolve(n,t)),f}function u(n){return typeof n=="string"?n:n.text}function a(n,t){function e(n,i){var r;r=typeof i!="string"?function(n){return i(n,t)}:f.hasOwnProperty(i)?f[i]:i;o[n]=r}var f={Up:function(){t.moveFocus(-1)},Down:function(){t.moveFocus(1)},PageUp:function(){t.moveFocus(-t.menuSize()+1,!0)},PageDown:function(){t.moveFocus(t.menuSize()-1,!0)},Home:function(){t.setFocus(0)},End:function(){t.setFocus(t.length-1)},Enter:t.pick,Tab:t.pick,Esc:t.close},r=n.options.customKeys,o=r?{}:f,u,i;if(r)for(i in r)r.hasOwnProperty(i)&&e(i,r[i]);if(u=n.options.extraKeys,u)for(i in u)u.hasOwnProperty(i)&&e(i,u[i]);return o}function f(n,t){while(t&&t!=n){if(t.nodeName.toUpperCase()==="LI"&&t.parentNode==n)return t;t=t.parentNode}}function e(i,r){var y,v,w,k,d,ft,rt,g,b,et;this.completion=i;this.data=r;this.picked=!1;var h=this,o=i.cm,e=this.hints=document.createElement("ul");for(e.className="CodeMirror-hints",this.selectedHint=r.selectedHint||0,y=r.list,v=0;v<y.length;++v){var nt=e.appendChild(document.createElement("li")),l=y[v],ut=p+(v!=this.selectedHint?"":" "+t);l.className!=null&&(ut=l.className+" "+ut);nt.className=ut;l.render?l.render(nt,r,l):nt.appendChild(document.createTextNode(l.displayText||u(l)));nt.hintId=v}var c=o.cursorCoords(i.options.alignWithWord?r.from:null),tt=c.left,it=c.bottom,ot=!0;e.style.left=tt+"px";e.style.top=it+"px";w=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);k=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(i.options.container||document.body).appendChild(e);var s=e.getBoundingClientRect(),ht=s.bottom-k,ct=e.scrollHeight>e.clientHeight+1,st=o.getScrollInfo();if(ht>0&&(d=s.bottom-s.top,ft=c.top-(c.bottom-s.top),ft-d>0?(e.style.top=(it=c.top-d)+"px",ot=!1):d>k&&(e.style.height=k-5+"px",e.style.top=(it=c.bottom-s.top)+"px",rt=o.getCursor(),r.from.ch!=rt.ch&&(c=o.cursorCoords(rt),e.style.left=(tt=c.left)+"px",s=e.getBoundingClientRect()))),g=s.right-w,g>0&&(s.right-s.left>w&&(e.style.width=w-5+"px",g-=s.right-s.left-w),e.style.left=(tt=c.left-g)+"px"),ct)for(b=e.firstChild;b;b=b.nextSibling)b.style.paddingRight=o.display.nativeBarWidth+"px";if(o.addKeyMap(this.keyMap=a(i,{moveFocus:function(n,t){h.changeActive(h.selectedHint+n,t)},setFocus:function(n){h.changeActive(n)},menuSize:function(){return h.screenAmount()},length:y.length,close:function(){i.close()},pick:function(){h.pick()},data:r})),i.options.closeOnUnfocus){o.on("blur",this.onBlur=function(){et=setTimeout(function(){i.close()},100)});o.on("focus",this.onFocus=function(){clearTimeout(et)})}o.on("scroll",this.onScroll=function(){var t=o.getScrollInfo(),r=o.getWrapperElement().getBoundingClientRect(),u=it+st.top-t.top,n=u-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(ot||(n+=e.offsetHeight),n<=r.top||n>=r.bottom)return i.close();e.style.top=u+"px";e.style.left=tt+st.left-t.left+"px"});n.on(e,"dblclick",function(n){var t=f(e,n.target||n.srcElement);t&&t.hintId!=null&&(h.changeActive(t.hintId),h.pick())});n.on(e,"click",function(n){var t=f(e,n.target||n.srcElement);t&&t.hintId!=null&&(h.changeActive(t.hintId),i.options.completeOnSingleClick&&h.pick())});n.on(e,"mousedown",function(){setTimeout(function(){o.focus()},20)});return n.signal(r,"select",y[this.selectedHint],e.childNodes[this.selectedHint]),!0}function v(n,t){var r,i;if(!n.somethingSelected())return t;for(r=[],i=0;i<t.length;i++)t[i].supportsSelection&&r.push(t[i]);return r}function o(n,t,i,r){if(n.async)n(t,r,i);else{var u=n(t,i);u&&u.then?u.then(r):r(u)}}function y(t,i){var u=t.getHelpers(i,"hint"),f,r;return u.length?(r=function(n,t,i){function r(u){if(u==f.length)return t(null);o(f[u],n,i,function(n){n&&n.list.length>0?t(n):r(u+1)})}var f=v(n,u);r(0)},r.async=!0,r.supportsSelection=!0,r):(f=t.getHelper(t.getCursor(),"hintWords"))?function(t){return n.hint.fromList(t,{words:f})}:n.hint.anyword?function(t,i){return n.hint.anyword(t,i)}:function(){}}var p="CodeMirror-hint",t="CodeMirror-hint-active",s,h,i;n.showHint=function(n,t,i){var r,u;if(!t)return n.showHint(i);if(i&&i.async&&(t.async=!0),r={hint:t},i)for(u in i)r[u]=i[u];return n.showHint(r)};n.defineExtension("showHint",function(t){var i,u,f;if(t=l(this,this.getCursor("start"),t),i=this.listSelections(),!(i.length>1)){if(this.somethingSelected()){if(!t.hint.supportsSelection)return;for(u=0;u<i.length;u++)if(i[u].head.line!=i[u].anchor.line)return}(this.state.completionActive&&this.state.completionActive.close(),f=this.state.completionActive=new r(this,t),f.options.hint)&&(n.signal(this,"startCompletion",this),f.update(!0))}});s=window.requestAnimationFrame||function(n){return setTimeout(n,1e3/60)};h=window.cancelAnimationFrame||clearTimeout;r.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&n.signal(this.data,"close"),this.widget&&this.widget.close(),n.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(t,i){var r=t.list[i];r.hint?r.hint(this.cm,t,r):this.cm.replaceRange(u(r),r.from||t.from,r.to||t.to,"complete");n.signal(t,"pick",r);this.close()},cursorActivity:function(){var n,t,i;this.debounce&&(h(this.debounce),this.debounce=0);n=this.cm.getCursor();t=this.cm.getLine(n.line);n.line!=this.startPos.line||t.length-n.ch!=this.startLen-this.startPos.ch||n.ch<this.startPos.ch||this.cm.somethingSelected()||n.ch&&this.options.closeCharacters.test(t.charAt(n.ch-1))?this.close():(i=this,this.debounce=s(function(){i.update()}),this.widget&&this.widget.disable())},update:function(n){if(this.tick!=null){var t=this,i=++this.tick;o(this.options.hint,this.cm,this.options,function(r){t.tick==i&&t.finishUpdate(r,n)})}},finishUpdate:function(t,i){this.data&&n.signal(this.data,"update");var r=this.widget&&this.widget.picked||i&&this.options.completeSingle;(this.widget&&this.widget.close(),t&&this.data&&c(this.data,t))||(this.data=t,t&&t.list.length&&(r&&t.list.length==1?this.pick(t,0):(this.widget=new e(this,t),n.signal(t,"shown"))))}};e.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var n=this.completion.cm;this.completion.options.closeOnUnfocus&&(n.off("blur",this.onBlur),n.off("focus",this.onFocus));n.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var n=this;this.keyMap={Enter:function(){n.picked=!0}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(i,r){if(i>=this.data.list.length?i=r?this.data.list.length-1:0:i<0&&(i=r?0:this.data.list.length-1),this.selectedHint!=i){var u=this.hints.childNodes[this.selectedHint];u.className=u.className.replace(" "+t,"");u=this.hints.childNodes[this.selectedHint=i];u.className+=" "+t;u.offsetTop<this.hints.scrollTop?this.hints.scrollTop=u.offsetTop-3:u.offsetTop+u.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=u.offsetTop+u.offsetHeight-this.hints.clientHeight+3);n.signal(this.data,"select",this.data.list[this.selectedHint],u)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};n.registerHelper("hint","auto",{resolve:y});n.registerHelper("hint","fromList",function(t,i){var o=t.getCursor(),r=t.getTokenAt(o),c=n.Pos(o.line,r.end),u,s,f,e,h;for(r.string&&/\w/.test(r.string[r.string.length-1])?(u=r.string,s=n.Pos(o.line,r.start)):(u="",s=c),f=[],e=0;e<i.words.length;e++)h=i.words[e],h.slice(0,u.length)==u&&f.push(h);if(f.length)return{list:f,from:s,to:c}});n.commands.autocomplete=n.showHint;i={hint:n.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};n.defineOption("hintOptions",null)}),function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("../../mode/sql/sql")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],n):n(CodeMirror)}(function(n){"use strict";function s(n){return Object.prototype.toString.call(n)=="[object Array]"}function b(t){var i=t.doc.modeOption;return i==="sql"&&(i="text/x-sql"),n.resolveMode(i).keywords}function k(t){var i=t.doc.modeOption;return i==="sql"&&(i="text/x-sql"),n.resolveMode(i).identifierQuote||"`"}function f(n){return typeof n=="string"?n:n.text}function l(n,t){return s(t)&&(t={columns:t}),t.text||(t.text=n),t}function d(n){var u={},t,i,r;if(s(n))for(t=n.length-1;t>=0;t--)i=n[t],u[f(i).toUpperCase()]=l(f(i),i);else if(n)for(r in n)u[r.toUpperCase()]=l(r,n[r]);return u}function e(n){return o[n.toUpperCase()]}function a(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i}function v(n,t){var i=n.length,r=f(t).substr(0,i);return n.toUpperCase()===r.toUpperCase()}function u(n,t,i,r){var f,e,u;if(s(i))for(f=0;f<i.length;f++)v(t,i[f])&&n.push(r(i[f]));else for(e in i)i.hasOwnProperty(e)&&(u=i[e],u=u&&u!==!0?u.displayText?{text:u.text,displayText:u.displayText}:u.text:e,v(t,u)&&n.push(r(u)))}function g(n){var i,r;for(n.charAt(0)=="."&&(n=n.substr(1)),i=n.split(t+t),r=0;r<i.length;r++)i[r]=i[r].replace(new RegExp(t,"g"),"");return i.join(t)}function h(n){for(var u,i=f(n).split("."),r=0;r<i.length;r++)i[r]=t+i[r].replace(new RegExp(t,"g"),t+t)+t;return(u=i.join("."),typeof n=="string")?u:(n=a(n),n.text=u,n)}function nt(n,f,s,c){for(var p=!1,b=[],d=f.start,k=!0,w,nt,v;k;)k=f.string.charAt(0)==".",p=p||f.string.charAt(0)==t,d=f.start,b.unshift(g(f.string)),f=c.getTokenAt(r(n.line,f.start)),f.string=="."&&(k=!0,f=c.getTokenAt(r(n.line,f.start)));w=b.join(".");u(s,w,o,function(n){return p?h(n):n});u(s,w,i,function(n){return p?h(n):n});w=b.pop();var l=b.join("."),tt=!1,it=l;return e(l)||(nt=l,l=y(l,c),l!==nt&&(tt=!0)),v=e(l),v&&v.columns&&(v=v.columns),v&&u(s,w,v,function(n){var t=l;return tt==!0&&(t=it),typeof n=="string"?n=t+"."+n:(n=a(n),n.text=t+"."+n.text),p?h(n):n}),d}function tt(n,t){for(var r=n.split(/\s+/),i=0;i<r.length;i++)r[i]&&t(r[i].replace(/[,;]/g,""))}function y(n,t){for(var s=t.doc,p=s.getValue(),k=n.toUpperCase(),h="",l="",u=[],a={start:r(0,0),end:r(t.lastLine(),t.getLineHandle(t.lastLine()).length)},o=p.indexOf(c.QUERY_DIV),f,v,y,i,b;o!=-1;)u.push(s.posFromIndex(o)),o=p.indexOf(c.QUERY_DIV,o+1);for(u.unshift(r(0,0)),u.push(r(t.lastLine(),t.getLineHandle(t.lastLine()).text.length)),f=null,v=t.getCursor(),i=0;i<u.length;i++){if((f==null||w(v,f)>0)&&w(v,u[i])<=0){a={start:f,end:u[i]};break}f=u[i]}for(y=s.getRange(a.start,a.end,!1),i=0;i<y.length;i++)if(b=y[i],tt(b,function(n){var t=n.toUpperCase();t===k&&e(h)&&(l=h);t!==c.ALIAS_KEYWORD&&(h=n)}),l)break;return l}var o,i,p,t,c={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},r=n.Pos,w=n.cmpPos;n.registerHelper("hint","sql",function(n,f){var l,g;o=d(f&&f.tables);l=f&&f.defaultTable;g=f&&f.disableKeywords;i=l&&e(l);p=b(n);t=k(n);l&&!i&&(i=y(l,n));i=i||[];i.columns&&(i=i.columns);var h=n.getCursor(),a=[],s=n.getTokenAt(h),v,w,c;return s.end>h.ch&&(s.end=h.ch,s.string=s.string.slice(0,h.ch-s.start)),s.string.match(/^[.`"\w@]\w*$/)?(c=s.string,v=s.start,w=s.end):(v=w=h.ch,c=""),c.charAt(0)=="."||c.charAt(0)==t?v=nt(h,s,a,n):(u(a,c,o,function(n){return n}),u(a,c,i,function(n){return n}),g||u(a,c,p,function(n){return n.toUpperCase()})),{list:a,from:r(h.line,v),to:r(h.line,w)}})}),function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)}(function(n){function i(n){n.state.placeholder&&(n.state.placeholder.parentNode.removeChild(n.state.placeholder),n.state.placeholder=null)}function r(n){var t,r;i(n);t=n.state.placeholder=document.createElement("pre");t.style.cssText="height: 0; overflow: visible";t.style.direction=n.getOption("direction");t.className="CodeMirror-placeholder CodeMirror-line-like";r=n.getOption("placeholder");typeof r=="string"&&(r=document.createTextNode(r));t.appendChild(r);n.display.lineSpace.insertBefore(t,n.display.lineSpace.firstChild)}function e(n){setTimeout(function(){var u=!1,t;n.lineCount()==1&&(t=n.getInputField(),u=t.nodeName=="TEXTAREA"?!n.getLine(0).length:!/[^\u200b]/.test(t.querySelector(".CodeMirror-line").textContent));u?r(n):i(n)},20)}function u(n){f(n)&&r(n)}function t(n){var t=n.getWrapperElement(),u=f(n);t.className=t.className.replace(" CodeMirror-empty","")+(u?" CodeMirror-empty":"");u?r(n):i(n)}function f(n){return n.lineCount()===1&&n.getLine(0)===""}n.defineOption("placeholder","",function(r,f,o){var h=o&&o!=n.Init,s;if(f&&!h){r.on("blur",u);r.on("change",t);r.on("swapDoc",t);n.on(r.getInputField(),"compositionupdate",r.state.placeholderCompose=function(){e(r)});t(r)}else!f&&h&&(r.off("blur",u),r.off("change",t),r.off("swapDoc",t),n.off(r.getInputField(),"compositionupdate",r.state.placeholderCompose),i(r),s=r.getWrapperElement(),s.className=s.className.replace(" CodeMirror-empty",""));f&&!r.hasFocus()&&u(r)})});__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();InternalReplaceValues=function(){function n(n){this.divDialog=null;this.editRuleTbl=null;this.customTable=null;this.matchCaseRow=null;this.replaceValuesInfo=null;this.headerRowDiv=null;this.textBox=null;this.textBoxOne=null;this.replaceTextBox=null;this.replaceTextBoxOne=null;this.matchCaseCheckBox=null;this.matchEntireStringCheckBox=null;this.ruleMatchCaseCheckBox=null;this.ruleMatchEntireStringCheckBox=null;this.replaceRuleTbl=null;this.replaceRuleCancelBtn=null;this.addRuleBtn=null;this.cancelBtn=null;this.applyButton=null;this.tableRowDiv=null;this.customRuleTableDiv=null;this.headerRow=0;this.customRuleTable=null;this.table=null;this.locale=null;this.target=null;this.replaceValues=[];this.scrollContainer=null;this.replaceValuesScrollElement=null;this.shouldAddRuleActionDiv=!1;this.reloaded=!1;this.isEdited=!1;this.editCancelBtn=null;this.updateBtn=null;this.divDialogFooter=null;this.closeButton=null;this.backButton=null;this.dashboardDesigner=n;this.bbdesigner$=this.dashboardDesigner.bbdesigner$;this.queryDesigner=this.dashboardDesigner.modules.queryDesigner;this.locale=n.getLocalizationContent();this.id=this.queryDesigner.id;var t={id:this.dashboardDesigner.modules.util.generateGuid(),valueToFind:"(Null)",valueToReplace:"(Null)",matchCase:!0,matchEntireString:!0},i={id:this.dashboardDesigner.modules.util.generateGuid(),valueToFind:"(Blanks)",valueToReplace:"(Blanks)",matchCase:!0,matchEntireString:!0};this.replaceValues=[t,i];this.unWireEvents();this.wireEvents()}return n.prototype.renderReplaceValuesDialog=function(){var n,t,i;this.divDialog=BoldBIDashboard.buildTag("div.bbi-userselect","",{},{id:this.dashboardDesigner._id+"_replaceValues_dialog"});this.tableRowDiv=BoldBIDashboard.buildTag("div","",{width:"100%"},{id:this.dashboardDesigner._id+"_replaceValues_dialog_table"});this.customRuleTableDiv=BoldBIDashboard.buildTag("div","",{width:"100%"},{id:this.dashboardDesigner._id+"_replaceValues_customRule_table"});this.scrollContainer=BoldBIDashboard.buildTag("div.bbi-dbrd-designer-scroller bbi-dbrd-control bbi-dbrd-designer-scroll-style-3","",{height:"140px",display:"block"},{id:this.dashboardDesigner._id+"_replaceValues_dialog_individual_container"});this.replaceValuesScrollElement=BoldBIDashboard.buildTag("div","",{height:"140px","padding-top":"5px","padding-bottom":"5px"},{id:this.dashboardDesigner._id+"_replaceValues_dialog_scroll_elements"});this.cancelBtn=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-secondary bbi-dbrd-margin-left",this.locale.replaceValues.cancelBtnText,{float:"right",right:"-6px"},{id:this.dashboardDesigner._id+"_replaceValues_dialog_btn_cancel",type:"button"});this.applyButton=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.replaceValues.applyBtnText,{float:"right",right:"-8px"},{id:this.dashboardDesigner._id+"_replaceValues_dialog_btn_ok",type:"button"});this.divDialog.append(this.tableRowDiv,this.customRuleTableDiv.append(this.scrollContainer.append(this.replaceValuesScrollElement)));this.editRuleTbl=BoldBIDashboard.buildTag("table.bbi-designer-exp-table","",{width:"100%",height:"259px"},{});var r=BoldBIDashboard.buildTag("tr","",{height:"25px"}),u=BoldBIDashboard.buildTag("td","",{position:"absolute",top:"6%",left:"3%"}),f=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily",this.locale.replaceValues.valueToFindText,{padding:"9px","font-weight":"600"},{type:"label"}),e=BoldBIDashboard.buildTag("tr","",{});this.textBox=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-fontfamily","",{position:"absolute",top:"19%",height:"25px",left:"18px",width:"314px"},{type:"text",id:this.id+"_edit_values_textbox_1"});var o=BoldBIDashboard.buildTag("tr","",{height:"25px"}),s=BoldBIDashboard.buildTag("td","",{position:"absolute",left:"11px",top:"36%"}),h=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily",this.locale.replaceValues.valueToReplaceText,{padding:"9px","font-weight":"600"},{type:"label"}),c=BoldBIDashboard.buildTag("tr","",{});this.textBoxOne=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-fontfamily","",{position:"absolute",top:"49%",height:"25px",left:"18px",width:"314px"},{type:"text",id:this.id+"_edit_values_textbox_sec"});this.editRuleTbl.append(r.append(u.append(f)),e.append(this.textBox),o.append(s.append(h)),c.append(this.textBoxOne));this.matchCaseRow=BoldBIDashboard.buildTag("tr","",{height:"20px"},{id:this.id+"_replace_values_matchcase_row"});n=BoldBIDashboard.buildTag("td","",{position:"absolute",float:"left",left:"22px",top:"159px","margin-top":"14px"});this.matchCaseCheckBox=BoldBIDashboard.buildTag("input","",{height:"14px",width:"14px"},{type:"checkbox",id:this.id+"_replace_values_matchcase_checkbox_1"});var l=BoldBIDashboard.buildTag("td","",{position:"absolute",left:"33px",top:"175px"}),a=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily",this.locale.replaceValues.matchCaseText,{padding:"11px"},{type:"label"}),v=BoldBIDashboard.buildTag("td","",{position:"absolute",float:"left",top:"162px",left:"33%","margin-top":"12px"});this.matchEntireStringCheckBox=BoldBIDashboard.buildTag("input","",{height:"14px",width:"14px"},{type:"checkbox",id:this.id+"_replace_values_matchcase_checkbox_2"});t=BoldBIDashboard.buildTag("td","",{position:"absolute",float:"left",top:"171px",left:"137px","margin-top":"5px"});i=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily",this.locale.replaceValues.matchEntireStringText,{padding:"6px",position:"relative"},{type:"label"});this.editRuleTbl.append(this.matchCaseRow.append(n.append(this.matchCaseCheckBox),l.append(a),v.append(this.matchEntireStringCheckBox),t.append(i)));this.textBox.on("keyup",this.bbdesigner$.proxy(this.valueToFindChange,this));this.textBox.on("create",this.bbdesigner$.proxy(this.valueToFindCreate,this));this.matchCaseCheckBox.BoldBIDashboardCheckBox({width:"100%",change:this.bbdesigner$.proxy(this.updateMatchCaseCheckBox,this)});this.matchEntireStringCheckBox.BoldBIDashboardCheckBox({width:"100%",change:this.bbdesigner$.proxy(this.updateMatchEntireStringCheckBox,this)});this.editRuleTbl.hide();this.editCancelBtn=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-margin-left",this.locale.replaceValues.cancelBtnText,{float:"right",right:"5px"},{id:this.id+"_editrule_btn_cancel",type:"button"});this.updateBtn=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.replaceValues.updateBtnText,{float:"right",right:"4px"},{id:this.id+"_editrule_btn_update",type:"button"});this.editCancelBtn.on("click",this.bbdesigner$.proxy(this.editCancelAction,this));this.divDialog.append(this.editRuleTbl);this.replaceRuleTbl=BoldBIDashboard.buildTag("table.bbi-designer-exp-table","",{width:"100%",height:"259px"},{});var y=BoldBIDashboard.buildTag("tr","",{height:"25px"}),p=BoldBIDashboard.buildTag("td","",{position:"absolute",top:"6%",left:"3%"}),w=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily",this.locale.replaceValues.valueToFindText,{padding:"9px","font-weight":"600"},{type:"label"}),b=BoldBIDashboard.buildTag("tr","",{});this.replaceTextBox=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-fontfamily","",{position:"absolute",top:"19%",height:"25px",left:"22px",width:"309px"},{type:"text",id:this.id+"_replace_rule_textbox_1"});this.replaceRuleTbl.append(y.append(p.append(w)),b.append(this.replaceTextBox));var k=BoldBIDashboard.buildTag("tr","",{height:"25px"}),d=BoldBIDashboard.buildTag("td","",{position:"absolute",left:"11px",top:"36%"}),g=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily",this.locale.replaceValues.valueToReplaceText,{padding:"9px","font-weight":"600"},{type:"label"}),nt=BoldBIDashboard.buildTag("tr","",{});this.replaceTextBoxOne=BoldBIDashboard.buildTag("input.e-textbox bbi-designer-fontfamily","",{position:"absolute",top:"49%",height:"25px",left:"22px",width:"309px"},{type:"text",id:this.id+"_replace_rule_textbox_2"});this.replaceRuleTbl.append(k.append(d.append(g)),nt.append(this.replaceTextBoxOne));var tt=BoldBIDashboard.buildTag("tr","",{height:"20px"},{id:this.id+"_replace_rule_matchcase_row"}),it=BoldBIDashboard.buildTag("td","",{position:"absolute",float:"left",left:"22px",top:"160px","margin-top":"14px"}),rt=this.ruleMatchCaseCheckBox=BoldBIDashboard.buildTag("input","",{height:"14px",width:"14px"},{type:"checkbox",id:this.id+"_replace_rule_matchcase_checkbox_1"}),ut=BoldBIDashboard.buildTag("td","",{position:"absolute",left:"9%",top:"176px"}),ft=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily",this.locale.replaceValues.matchCaseText,{padding:"11px"},{type:"label"}),et=BoldBIDashboard.buildTag("td","",{position:"absolute",float:"left",top:"159px",left:"33%","margin-top":"16px"}),ot=this.ruleMatchEntireStringCheckBox=BoldBIDashboard.buildTag("input","",{height:"14px",width:"14px"},{type:"checkbox",id:this.id+"_replace_rule_matchcase_checkbox_2"}),st=BoldBIDashboard.buildTag("td","",{position:"absolute",top:"172px",float:"left",left:"37%","margin-top":"5px"}),ht=BoldBIDashboard.buildTag("editLabel.bbi-designer-fontfamily",this.locale.replaceValues.matchEntireStringText,{padding:"6px",position:"relative"},{type:"label"});this.replaceRuleTbl.append(tt.append(it.append(rt)),ut.append(ft),et.append(ot),st.append(ht));this.replaceTextBox.on("keyup",this.bbdesigner$.proxy(this.valueToFindChangeSec,this));this.replaceTextBox.on("create",this.bbdesigner$.proxy(this.valueToFindCreateSec,this));this.replaceTextBoxOne.on("keyup",this.bbdesigner$.proxy(this.valueToReplaceChangeSec,this));this.replaceTextBoxOne.on("create",this.bbdesigner$.proxy(this.valueToReplaceCreateSec,this));this.ruleMatchCaseCheckBox.BoldBIDashboardCheckBox({width:"100%",change:this.bbdesigner$.proxy(this.ruleUpdateMatchCaseCheckBox,this)});this.ruleMatchEntireStringCheckBox.BoldBIDashboardCheckBox({width:"100%",change:this.bbdesigner$.proxy(this.ruleUpdateMatchEntireStringCheckBox,this)});this.replaceRuleTbl.hide();this.replaceRuleCancelBtn=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-secondary bbi-dbrd-btn-small bbi-dbrd-margin-left",this.locale.replaceValues.cancelBtnText,{float:"right",right:"5px"},{id:this.id+"_replacerule_dialog_btn_ruleCancel",type:"button"});this.addRuleBtn=BoldBIDashboard.buildTag("button.bbi-dbrd-btn-small bbi-dbrd-btn-primary",this.locale.replaceValues.addRuleBtnText,{float:"right",right:"4px"},{type:"button",id:this.id+"_replaceRule_dialog_btn_addRule",disabled:!0});this.replaceRuleCancelBtn.on("click",this.bbdesigner$.proxy(this.closeRuleDialog,this));this.divDialog.append(this.replaceRuleTbl);this.dashboardDesigner.element.append(this.divDialog);this.divDialog.BoldBIDashboardDialog({title:this.locale.replaceValues.title,actionButtons:["close","back"],width:366,height:"auto",minWidth:367,minHeight:275,enableResize:!1,showOnInit:!1,enableModal:!0,showFooter:!0,containment:"#"+this.dashboardDesigner._id,target:"#"+this.dashboardDesigner._id,create:this.bbdesigner$.proxy(this.addActionButtonIcon,this),actionButtonClick:this.bbdesigner$.proxy(this.headerIconClick,this),cssClass:"bbi-designer-dialog e-flat-mode boldbi-dashboarddesigner bbi-mobile-export",close:this.bbdesigner$.proxy(this.closeDialog,this),closeIconTooltip:this.locale.dialogOptions.closeButtonText});this.closeButton=this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_replaceValues_dialog_closebutton");this.backButton=this.dashboardDesigner.element.find("#"+this.dashboardDesigner._id+"_replaceValues_dialog_backbutton");this.closeButton.css("left","4px");this.closeButton.css("top","11px");this.backButton.css("padding","4px 3px 1px 5px");this.backButton.css("font-size","11px");this.backButton.css("margin-left","5px");this.backButton.css("top","10px");this.backButton.css("display","none");this.divDialogFooter=this.bbdesigner$("#"+this.dashboardDesigner._id+"_replaceValues_dialog_foot");this.divDialogFooter.append(this.cancelBtn,this.applyButton,this.editCancelBtn,this.updateBtn,this.replaceRuleCancelBtn,this.addRuleBtn);this.updateBtn.hide();this.editCancelBtn.hide();this.addRuleBtn.hide();this.replaceRuleCancelBtn.hide();this.scrollContainer.BoldBIDashboardScroller({height:"140px",scrollerSize:this.dashboardDesigner.scrollerSize.scrollSize,enableTouchScroll:!0,autoHide:!1,buttonSize:this.dashboardDesigner.scrollerSize.buttonSize});this.divDialog.data("BoldBIDashboardDialog").open()},n.prototype.populateReplacingValues=function(n){var t=this.table=BoldBIDashboard.buildTag("table","",{"border-collapse":"collapse",width:"100%","table-layout":"fixed"},{}),i=this.replaceValues[0].id,r=this.replaceValues[1].id,u=BoldBIDashboard.buildTag("div","",{"margin-top":"7px","margin-left":"9px","margin-right":"22px"},{}),f=BoldBIDashboard.buildTag("tr","",{height:"20px"},{}),e=BoldBIDashboard.buildTag("td.bbi-designer-fontfamily",this.locale.replaceValues.valueToFindText,{position:"absolute",top:"7px",left:"12px","font-weight":"600"}),o=BoldBIDashboard.buildTag("td.bbi-designer-fontfamily",this.locale.replaceValues.replaceText,{position:"relative",left:"145px","font-weight":"600"});t.append(u.append(f.append(e,o)));var s=BoldBIDashboard.buildTag("div.bbi-replacevalues","",{"margin-top":"11px","margin-left":"9px","margin-right":"9px"},{}),h=BoldBIDashboard.buildTag("tr","",{height:"25px"},{id:i}),c=BoldBIDashboard.buildTag("td.bbi-designer-fontfamily",this.locale.replaceValues.nullText,{position:"absolute",top:"44px",left:"14px"}),l=BoldBIDashboard.buildTag("td.bbi-designer-fontfamily",this.locale.replaceValues.nullValueText,{position:"relative",top:"6px",left:"145px"}),a=BoldBIDashboard.buildTag("td.bbi-designer-edit-wrapper value-edit-icon","",{position:"absolute",left:"325px",top:"44px"}),v=BoldBIDashboard.buildTag("span.bbi-designer-content-icon bbi-designer-parameter-edit e-tooltip bbi-designer-click bbi-dbrd-designer-hoverable bb-editbutton","",{float:"right","margin-right":"2px","margin-left":"12px","font-size":"12px"},{id:this.id+"_replace_values_edit_","data-tooltip":this.locale.dataSource.editContextMenu});t.append(s.append(h.append(c,l,a.append(v))));var y=BoldBIDashboard.buildTag("div.bbi-replacevalues","",{"margin-top":"17px","margin-left":"9px","margin-right":"9px"},{}),p=BoldBIDashboard.buildTag("tr","",{height:"25px"},{id:r}),w=BoldBIDashboard.buildTag("td.bbi-designer-fontfamily",this.locale.replaceValues.blanksText,{position:"absolute",top:"86px",left:"13px"}),b=BoldBIDashboard.buildTag("td.bbi-designer-fontfamily",this.locale.replaceValues.blanksValueText,{position:"absolute",top:"86px",left:"153px"}),k=BoldBIDashboard.buildTag("td.bbi-designer-edit-wrapper value-edit-icon","",{position:"relative",left:"315px",top:"6px"}),d=BoldBIDashboard.buildTag("span.bbi-designer-content-icon bbi-designer-parameter-edit e-tooltip bbi-designer-click bbi-dbrd-designer-hoverable bb-editbutton","",{float:"right","margin-right":"2px","margin-left":"12px","font-size":"12px"},{id:this.id+"_replace_values_edit_","data-tooltip":this.locale.dataSource.editContextMenu});t.append(y.append(p.append(w,b,k.append(d))));var g=BoldBIDashboard.buildTag("div.bbi-replacevalues-separator","",{}),nt=BoldBIDashboard.buildTag("tr","",{height:"10px"}),tt=BoldBIDashboard.buildTag("td","",{},{id:this.id+"_replace_values_line_separator"});t.append(g.append(nt).append(tt));this.tableRowDiv.append(t);this.customTable=BoldBIDashboard.buildTag("table","",{"border-collapse":"collapse",width:"100%","table-layout":"fixed"},{});var it=BoldBIDashboard.buildTag("div","",{"margin-top":"10px","margin-left":"9px","margin-right":"22px"},{}),rt=BoldBIDashboard.buildTag("tr","",{height:"10px"},{}),ut=BoldBIDashboard.buildTag("td.bbi-designer-fontfamily",this.locale.replaceValues.customRuleText,{"padding-left":"4px","font-weight":"600"}),ft=BoldBIDashboard.buildTag("div"," ",{cursor:"pointer",position:"absolute",left:"82%",height:"2px",width:"31px"},{id:this.id+"_replaceValues_dialog_btn_newRule"}),et=BoldBIDashboard.buildTag("td.e-chk-image e-icon e-plus bbi-designer-add-icon e-query-filter-add-icon","",{position:"relative",cursor:"pointer",left:"-15px",top:"2px"},{}),ot=BoldBIDashboard.buildTag("td.e-btntxt bbi-designer-add-btn",this.locale.replaceValues.addRuleBtnText,{cursor:"pointer",position:"relative",top:"-16px","white-space":"nowrap",width:"47px"},{});this.customRuleTableDiv.append(this.customTable.append(it.append(rt.append(ut,ft.append(et,ot)))));this.renderRowElement(this.customTable,this.replaceValues,n);this.divDialog.data("BoldBIDashboardDialog").open();this.replaceValuesScrollElement.append(this.customTable);this.scrollerRefresh(this.scrollContainer)},n.prototype.scrollerRefresh=function(n){n.data("BoldBIDashboardScroller")&&n.data("BoldBIDashboardScroller").refresh()},n.prototype.renderRowElement=function(n,t){var l,s,c,i,r;if(this.reloaded){if(l=this.customTable.find(".bbi-header").length,l==0){this.headerRowDiv=BoldBIDashboard.buildTag("div.bbi-header","",{"margin-top":"11px","margin-left":"9px","margin-right":"17px"},{});var c=BoldBIDashboard.buildTag("tr","",{display:"block","margin-left":"9px","margin-right":"22px","margin-top":"14px",height:"25px"}),e=BoldBIDashboard.buildTag("td.bbi-dbrd-designer-hoverable bbi-designer-fontfamily",this.locale.replaceValues.valueToFindText,{"padding-top":"2px",position:"absolute",left:"4%","font-weight":"600"}),o=BoldBIDashboard.buildTag("td.bbi-dbrd-designer-hoverable bbi-designer-fontfamily",this.locale.replaceValues.replaceText,{"padding-top":"2px",position:"absolute",left:"42%","font-weight":"600"});n.append(this.headerRowDiv.append(c.append(e,o)))}for(s=2;s<t.length;s++){var i=t[s],a=i.id,h=BoldBIDashboard.buildTag("div.bbi-replacevalues","",{"margin-top":"11px","margin-left":"9px","margin-right":"9px"},{}),v=BoldBIDashboard.buildTag("tr","",{display:"block","margin-left":"9px","margin-right":"22px","margin-top":"10px",height:"25px"},{id:a}),e=BoldBIDashboard.buildTag("td.bbi-dbrd-designer-hoverable bbi-designer-fontfamily",i.valueToFind,{"padding-top":"6px",position:"absolute",left:"4%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","max-width":"35%"},{"data-tooltip":i.valueToFind}),o=BoldBIDashboard.buildTag("td.bbi-dbrd-designer-hoverable bbi-designer-fontfamily",i.valueToReplace,{"padding-top":"6px",position:"absolute",left:"42%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","max-width":"35%"},{"data-tooltip":i.valueToReplace}),y=BoldBIDashboard.buildTag("td.bbi-designer-edit-wrapper value-edit-icon","",{position:"absolute",right:"10%","padding-top":"6px"},{}),p=BoldBIDashboard.buildTag("span.bbi-designer-content-icon bbi-designer-parameter-edit e-tooltip bbi-designer-click bbi-dbrd-designer-hoverable bb-editbutton","",{float:"right","margin-right":"2px","margin-left":"12px","font-size":"12px"},{id:this.id+"_replace_values_edit_","data-tooltip":this.locale.dataSource.editContextMenu}),w=BoldBIDashboard.buildTag("td.bbi-deleteIcon delete-icon","",{position:"absolute",right:"4%","padding-top":"6px"},{}),b=BoldBIDashboard.buildTag("span.bbi-designer-content-icon bbi-designer-toolbar-delete e-tooltip bbi-designer-click bbi-dbrd-designer-hoverable","",{float:"right","margin-right":"0px","margin-left":"12px","font-size":"12px"},{id:this.id+"_replace_values_delete_","data-tooltip":this.locale.dataSource.deleteContextMenu});h.append(v.append(e,o,y.append(p),w.append(b)));n.append(h);r=this.customTable.find(".bbi-replacevalues");r.length>=1?this.headerRowDiv.show():r.length==0&&this.headerRowDiv.hide();this.scrollerRefresh(this.scrollContainer);BoldBIDashboard.DashboardUtil.buttonEnable(this.applyButton,!0);this.reloaded=!1}}if(this.shouldAddRuleActionDiv&&this.replaceValues.length>=2){if(c=this.customTable.find(".bbi-header").length,c==0){this.headerRowDiv=BoldBIDashboard.buildTag("div.bbi-header","",{"margin-top":"11px","margin-left":"9px","margin-right":"17px"},{});var k=BoldBIDashboard.buildTag("tr","",{display:"block","margin-left":"9px","margin-right":"22px","margin-top":"14px",height:"20px"}),e=BoldBIDashboard.buildTag("td.bbi-dbrd-designer-hoverable bbi-designer-fontfamily",this.locale.replaceValues.valueToFindText,{"padding-top":"2px",position:"absolute",left:"4%","font-weight":"600"}),o=BoldBIDashboard.buildTag("td.bbi-dbrd-designer-hoverable bbi-designer-fontfamily",this.locale.replaceValues.replaceText,{"padding-top":"2px",position:"absolute",left:"42%","font-weight":"600"});n.append(this.headerRowDiv.append(k.append(e,o)))}var u=this.replaceTextBox.val(),f=this.replaceTextBoxOne.val(),d=this.ruleMatchCaseCheckBox.BoldBIDashboardCheckBox("isChecked"),g=this.ruleMatchEntireStringCheckBox.BoldBIDashboardCheckBox("isChecked");if(u!=""&&f!=""){i={id:this.dashboardDesigner.modules.util.generateGuid(),valueToFind:u,valueToReplace:f,matchCase:d,matchEntireString:g};this.replaceValues.push(i);this.replaceTextBox.val("");this.replaceTextBoxOne.val("");this.ruleMatchCaseCheckBox.BoldBIDashboardCheckBox({checked:!1});this.ruleMatchEntireStringCheckBox.BoldBIDashboardCheckBox({checked:!1});var a=i.id,h=BoldBIDashboard.buildTag("div.bbi-replacevalues","",{"margin-top":"11px","margin-left":"9px","margin-right":"9px"},{}),v=BoldBIDashboard.buildTag("tr","",{display:"block","margin-left":"9px","margin-right":"22px","margin-top":"10px",height:"25px"},{id:a}),e=BoldBIDashboard.buildTag("td.bbi-dbrd-designer-hoverable bbi-designer-fontfamily",u,{"padding-top":"6px",position:"absolute",left:"4%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","max-width":"35%"},{"data-tooltip":u}),o=BoldBIDashboard.buildTag("td.bbi-dbrd-designer-hoverable bbi-designer-fontfamily",f,{"padding-top":"6px",position:"absolute",left:"42%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","max-width":"35%"},{"data-tooltip":f}),y=BoldBIDashboard.buildTag("td.bbi-designer-edit-wrapper value-edit-icon","",{position:"absolute",right:"10%","padding-top":"6px"},{}),p=BoldBIDashboard.buildTag("span.bbi-designer-content-icon bbi-designer-parameter-edit e-tooltip bbi-designer-click bbi-dbrd-designer-hoverable bb-editbutton","",{float:"right","margin-right":"2px","margin-left":"12px","font-size":"12px"},{id:this.id+"_replace_values_edit_","data-tooltip":this.locale.dataSource.editContextMenu}),w=BoldBIDashboard.buildTag("td.bbi-deleteIcon delete-icon","",{position:"absolute",right:"4%","padding-top":"6px"},{}),b=BoldBIDashboard.buildTag("span.bbi-designer-content-icon bbi-designer-toolbar-delete e-tooltip bbi-designer-click bbi-dbrd-designer-hoverable","",{float:"right","margin-right":"0px","margin-left":"12px","font-size":"12px"},{id:this.id+"_replace_values_delete_","data-tooltip":this.locale.dataSource.deleteContextMenu});h.append(v.append(e,o,y.append(p),w.append(b)));n.append(h);r=this.customTable.find(".bbi-replacevalues");r.length>=1?this.headerRowDiv.show():r.length==0&&this.headerRowDiv.hide();this.scrollerRefresh(this.scrollContainer);this.shouldAddRuleActionDiv=!1;BoldBIDashboard.DashboardUtil.buttonEnable(this.applyButton,!0)}(u==""||f=="")&&this.headerRowDiv.hide();this.scrollerRefresh(this.scrollContainer)}},n.prototype.handleAddRuleActionClick=function(){this.shouldAddRuleActionDiv=!0;var n=this.target;this.tableRowDiv.show();this.customRuleTableDiv.show();this.editRuleTbl.hide();this.divDialog.data("BoldBIDashboardDialog").setTitle("Replace Values");this.replaceRuleTbl.hide();this.updateButtonVisibility(!1);this.addRuleBtn.prop("disabled",!0);this.renderRowElement(this.customTable,this.replaceValues,n)},n.prototype.addActionButtonIcon=function(){this.dashboardDesigner.element.find("#"+this.id+"_replaceValues_dialog_title").find("#"+this.id+"_replaceValues_dialog_backbutton").addClass("bbi-dbrd-export-titleBackIcon bbi-dbrd-icon-background-theme")},n.prototype.headerIconClick=function(n){var t=this;switch(n.currentTarget){case"back":setTimeout(function(){t.replaceTextBox.val("");t.replaceTextBoxOne.val("");t.ruleMatchCaseCheckBox.BoldBIDashboardCheckBox({checked:!1});t.ruleMatchEntireStringCheckBox.BoldBIDashboardCheckBox({checked:!1});t.addRuleBtn.prop("disabled",!0);t.editRuleTbl.hide();t.tableRowDiv.show();t.replaceRuleTbl.hide();t.customRuleTableDiv.show();t.divDialog.data("BoldBIDashboardDialog").setTitle("Replace Values");t.updateButtonVisibility(!1);var n=t.customTable.find(".bbi-header");n.length>=1&&t.headerRowDiv.show()},100)}},n.prototype.openReplaceValuesDialog=function(n){var r,u,i,f,t;for(this.target=this.bbdesigner$(n.target),this.renderReplaceValuesDialog(this.target),this.populateReplacingValues(this.target),r=this.queryDesigner.dataset.Id,this.replaceValues=this.replaceValues.slice(0,2),u=this.target.closest("li").text(),i=this.queryDesigner.tableType,t=0;t<i.length;t++)if(u==i[t].Name){f=i[t].ID;break}this.dashboardDesigner.modules.util.doAjaxPost("POST",this.queryDesigner.model.serviceUrl+BoldBIDashboard.Dashboard.ServiceAPI.processdata,{action:BoldBIDashboard.DashboardUtil.DesignerAction.ReplaceValuesAction,data:JSON.stringify({className:BoldBIDashboard.DashboardUtil.DesignerAction.DataDesignViewAction,designerAction:BoldBIDashboard.DashboardUtil.DesignerAction.ReplaceValuesAction,dataSetId:r,fieldId:f,isQueryDesignerMode:this.dashboardDesigner.isQueryDesignerMode})},{fnction:this.bbdesigner$.proxy(this.onSuccess,this)})},n.prototype.onSuccess=function(n){var r,u,i,t;if(this.replaceValuesInfo=n,n.length!=0&&!BoldBIDashboard.isNullOrUndefined(n)){for(r=this.replaceValues[0].id,u=this.replaceValues[1].id,this.replaceValues=[],i=0;i<n.length;i++)t=n[i],this.replaceValues.push({id:this.dashboardDesigner.modules.util.generateGuid(),valueToFind:t.ValueToFind,valueToReplace:t.ValueToReplace===" "?"":t.ValueToReplace,matchCase:t.ShouldMatchCase,matchEntireString:t.ShouldMatchEntireString});this.replaceValues[0].id=r;this.replaceValues[1].id=u;this.replaceValues[0].valueToFind="Null";this.replaceValues[1].valueToFind="Blanks";this.replaceValues.length>0&&this.updateReplaceValuesInfo(this.replaceValues)}},n.prototype.updateReplaceValuesInfo=function(){this.populateReplaceValuesInfo(this.replaceValues);BoldBIDashboard.DashboardUtil.buttonEnable(this.applyButton,!0)},n.prototype.populateReplaceValuesInfo=function(){for(var t,n=0;n<this.replaceValues.length;n++){var r=this.replaceValues[n].id,u=this.replaceValues[n].valueToFind,f=this.replaceValues[n].valueToReplace,i=this.table.find("#"+r),e=i.find("td:first"),o=i.find("td:nth-child(2)");e.text(u);o.text(f)}if(t=Math.max(0,this.replaceValues.length-2),t>0)for(this.reloaded=!0,n=0;n<t;n++)this.renderRowElement(this.customTable,this.replaceValues,this.target)},n.prototype.ruleUpdateMatchCaseCheckBox=function(){this.ruleMatchCaseTemp=this.ruleMatchCaseCheckBox.BoldBIDashboardCheckBox("isChecked")},n.prototype.ruleUpdateMatchEntireStringCheckBox=function(){this.ruleMatchEntireStringTemp=this.ruleMatchEntireStringCheckBox.BoldBIDashboardCheckBox("isChecked")},n.prototype.updateMatchCaseCheckBox=function(){this.matchCaseTemp=this.matchCaseCheckBox.BoldBIDashboardCheckBox("isChecked")},n.prototype.updateMatchEntireStringCheckBox=function(){this.matchEntireStringTemp=this.matchEntireStringCheckBox.BoldBIDashboardCheckBox("isChecked")},n.prototype.valueToFindCreate=function(n){var t=this;n.keyup(this.bbdesigner$.proxy(function(n){t.valueToFindChange(t.bbdesigner$(n.target),t.bbdesigner$(n.target).val())},this))},n.prototype.valueToFindChange=function(){var n=this.textBox.val(),t=this.textBoxOne.val();n==""||t==""?this.updateBtn.prop("disabled",!0):this.updateBtn.prop("disabled",!1)},n.prototype.valueToFindCreateSec=function(n){var t=this;n.keyup(this.bbdesigner$.proxy(function(n){t.valueToFindChangeSec(t.bbdesigner$(n.target),t.bbdesigner$(n.target).val())},this))},n.prototype.valueToFindChangeSec=function(){var n=this.replaceTextBox.val(),t=this.replaceTextBoxOne.val();n==""||t==""?this.addRuleBtn.prop("disabled",!0):this.addRuleBtn.prop("disabled",!1)},n.prototype.valueToReplaceCreateSec=function(n){var t=this;n.keyup(this.bbdesigner$.proxy(function(n){t.valueToReplaceChangeSec(t.bbdesigner$(n.target),t.bbdesigner$(n.target).val())},this))},n.prototype.valueToReplaceChangeSec=function(){var n=this.replaceTextBoxOne.val(),t=this.replaceTextBox.val();n==""||t==""?this.addRuleBtn.prop("disabled",!0):this.addRuleBtn.prop("disabled",!1)},n.prototype.ReplaceValues=function(){var u=[],i,r,n,t;for(this.replaceValues[0].valueToFind="(Null)",this.replaceValues[1].valueToFind="(Blanks)",i=0,r=this.replaceValues;i<r.length;i++)n=r[i],t=new BoldBIDashboard.ReplaceValuesInfoForUI,t.ValueToFind=n.valueToFind,t.ValueToReplace=n.valueToReplace===""?" ":n.valueToReplace,t.ShouldMatchCase=n.matchCase,t.ShouldMatchEntireString=n.matchEntireString,u.push(t);return this.replaceValues.length>2&&(this.replaceValues=this.replaceValues.slice(0,2)),u},n.prototype.applyReplaceValues=function(){var n=this.ReplaceValues();this.dashboardDesigner.modules.queryDesigner.renderReplaceValuesDialog(n);BoldBIDashboard.isNullOrUndefined(n)||this.closeDialog();BoldBIDashboard.DashboardUtil.buttonEnable(this.applyButton,!0)},n.prototype.editAction=function(n){var f,i,r;for(this.tableRowDiv.hide(),this.customRuleTableDiv.hide(),this.editRuleTbl.show(),f=n.currentTarget.closest("tr").id,i=-1,r=0;r<this.replaceValues.length;r++)if(this.replaceValues[r].id===f){i=r;break}if(i!==-1){this.editedIndex=i;this.isEdited=!0;var u=this.replaceValues[i],t=u.valueToFind,e=u.valueToReplace,o=u.matchCase,s=u.matchEntireString;this.matchCaseCheckBox.BoldBIDashboardCheckBox({checked:o});this.matchEntireStringCheckBox.BoldBIDashboardCheckBox({checked:s});t=="(Null)"||t=="(Blanks)"||t=="Null"||t=="Blanks"?this.matchCaseRow.hide():this.matchCaseRow.show();t=t==="(Null)"?"Null":t==="(Blanks)"?"Blanks":t;this.textBox.val(t);this.textBoxOne.val(e);this.dashboardDesigner.element.find("#"+this.id+"_replaceValues_dialog_closebutton").hide();this.backButton.css("display","block");this.divDialog.data("BoldBIDashboardDialog").setTitle(this.locale.replaceValues.editRuleTitle);this.applyButton.hide();this.cancelBtn.hide();this.addRuleBtn.hide();this.replaceRuleCancelBtn.hide();this.updateBtn.show();this.editCancelBtn.show()}},n.prototype.deleteAction=function(n){for(var r=n.currentTarget.closest("tr").id,u=n.currentTarget.closest("div"),i=-1,t=0;t<this.replaceValues.length;t++)if(this.replaceValues[t].id===r){i=t;break}i!==-1&&(this.replaceValues.splice(i,1),this.customTable.find("#"+r).remove(),this.dashboardDesigner.element.find(u).remove(),this.scrollerRefresh(this.scrollContainer));this.replaceValues.length==2?this.customTable.find(".bbi-header").remove():this.headerRowDiv.show()},n.prototype.closeRuleDialog=function(){this.tableRowDiv.show();this.customRuleTableDiv.show();this.editRuleTbl.hide();this.divDialog.data("BoldBIDashboardDialog").setTitle("Replace Values");this.replaceRuleTbl.hide();this.updateButtonVisibility(!1);this.replaceTextBox.val("");this.replaceTextBoxOne.val("");this.ruleMatchCaseCheckBox.BoldBIDashboardCheckBox({checked:!1});this.ruleMatchEntireStringCheckBox.BoldBIDashboardCheckBox({checked:!1})},n.prototype.updateRule=function(){var t,u,i,f,e;this.tableRowDiv.show();this.customRuleTableDiv.show();this.editRuleTbl.hide();this.divDialog.data("BoldBIDashboardDialog").setTitle("Replace Values");this.replaceRuleTbl.hide();this.closeButton.show();this.backButton.css("display","none");this.replaceValuesDialogButtons();var n=this.textBox.val(),r=this.textBoxOne.val(),o=this.matchCaseCheckBox.BoldBIDashboardCheckBox("isChecked"),s=this.matchEntireStringCheckBox.BoldBIDashboardCheckBox("isChecked");!BoldBIDashboard.isNullOrUndefined(this.editedIndex)&&this.isEdited&&(t=this.replaceValues[this.editedIndex],BoldBIDashboard.isNullOrUndefined(t)||(t.valueToFind=n,t.valueToReplace=r,t.matchCase=o,t.matchEntireString=s,u=t.id,i=null,i=n==="Null"||n==="(Null)"||n==="Blanks"||n==="(Blanks)"?this.table.find("#"+u):this.customTable.find("#"+u),f=i.find("td:first"),e=i.find("td:nth-child(2)"),f.text(n),e.text(r),f.attr("data-tooltip",n),e.attr("data-tooltip",r),this.editedIndex=-1))},n.prototype.editCancelAction=function(){this.tableRowDiv.show();this.customRuleTableDiv.show();this.editRuleTbl.hide();this.divDialog.data("BoldBIDashboardDialog").setTitle("Replace Values");this.replaceRuleTbl.hide();this.closeButton.show();this.backButton.css("display","none");this.replaceValuesDialogButtons();var n=this.replaceValues[this.editedIndex],t=this.textBox.val(),i=t!==BoldBIDashboard.isNullOrUndefined?t:null,r=this.textBoxOne.val(),u=r!==BoldBIDashboard.isNullOrUndefined?r:null,f=this.matchCaseCheckBox.BoldBIDashboardCheckBox("isChecked"),e=this.matchEntireStringCheckBox.BoldBIDashboardCheckBox("isChecked");this.isEdited=BoldBIDashboard.isNullOrUndefined(n)||BoldBIDashboard.isNullOrUndefined(i)||BoldBIDashboard.isNullOrUndefined(u)||this.textBox.val()==""||this.textBoxOne.val()==""?!1:i!==n.valueToFind||u!==n.valueToReplace||f!==n.matchCase||e!==n.matchEntireString},n.prototype.customRule=function(){this.tableRowDiv.hide();this.customRuleTableDiv.hide();this.editRuleTbl.hide();this.divDialog.data("BoldBIDashboardDialog").setTitle(this.locale.replaceValues.addRuleTitle);this.replaceRuleTbl.show();this.updateButtonVisibility(!0)},n.prototype.replaceValuesDialogButtons=function(){this.applyButton.show();this.cancelBtn.show();this.addRuleBtn.hide();this.replaceRuleCancelBtn.hide();this.updateBtn.hide();this.editCancelBtn.hide()},n.prototype.updateButtonVisibility=function(n){n?(this.closeButton.hide(),this.backButton.css("display","block"),this.applyButton.hide(),this.cancelBtn.hide(),this.editCancelBtn.hide(),this.updateBtn.hide(),this.addRuleBtn.show(),this.replaceRuleCancelBtn.show()):(this.closeButton.show(),this.backButton.css("display","none"),this.replaceValuesDialogButtons())},n.prototype.wireEvents=function(){this.dashboardDesigner.element.on("click","#"+this.id+"_replaceValues_dialog_btn_newRule",this.bbdesigner$.proxy(this.customRule,this));this.dashboardDesigner.element.on("click","#"+this.id+"_replaceValues_dialog_btn_ok",this.bbdesigner$.proxy(this.applyReplaceValues,this));this.dashboardDesigner.element.on("click","#"+this.id+"_replaceValues_dialog_btn_cancel",this.bbdesigner$.proxy(this.closeDialog,this));this.dashboardDesigner.element.on("click","#"+this.id+"_editrule_btn_update",this.bbdesigner$.proxy(this.updateRule,this));this.dashboardDesigner.element.on("click","#"+this.id+"_replace_values_edit_",this.bbdesigner$.proxy(this.editAction,this));this.dashboardDesigner.element.on("click","#"+this.id+"_replace_values_delete_",this.bbdesigner$.proxy(this.deleteAction,this));this.dashboardDesigner.element.on("click","#"+this.id+"_replaceRule_dialog_btn_addRule",this.bbdesigner$.proxy(this.handleAddRuleActionClick,this))},n.prototype.unWireEvents=function(){this.dashboardDesigner.element.off("click","#"+this.id+"_replaceValues_dialog_btn_newRule",this.bbdesigner$.proxy(this.customRule,this));this.dashboardDesigner.element.off("click","#"+this.id+"_replaceValues_dialog_btn_cancel",this.bbdesigner$.proxy(this.closeDialog,this));this.dashboardDesigner.element.off("click","#"+this.id+"_replaceValues_dialog_btn_ok",this.bbdesigner$.proxy(this.applyReplaceValues,this));this.dashboardDesigner.element.off("click","#"+this.id+"_editrule_btn_update",this.bbdesigner$.proxy(this.updateRule,this));this.dashboardDesigner.element.off("click","#"+this.id+"_replace_values_edit_",this.bbdesigner$.proxy(this.editAction,this));this.dashboardDesigner.element.off("click","#"+this.id+"_replace_values_delete_",this.bbdesigner$.proxy(this.deleteAction,this));this.dashboardDesigner.element.off("click","#"+this.id+"_replaceRule_dialog_btn_addRule",this.bbdesigner$.proxy(this.handleAddRuleActionClick,this))},n.prototype.closeDialog=function(){var n=this.divDialog.data("BoldBIDashboardDialog");BoldBIDashboard.isNullOrUndefined(n)||n.close();BoldBIDashboard.isNullOrUndefined(this.replaceValues)||this.replaceValues.length===0||(this.replaceValues[0].valueToFind="Null",this.replaceValues[1].valueToFind="Blanks",this.replaceValues[0].valueToReplace="(Null)",this.replaceValues[1].valueToReplace="(Blanks)")},n.prototype.destroy=function(){this.unWireEvents()},n}(),function(n){var t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(InternalReplaceValues);n.ReplaceValues=t}(BoldBIDashboard||(BoldBIDashboard={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(n){function t(){return n.call(this)||this}return __extends(t,n),t}(ReplaceData);n.ReplaceValuesInfoForUI=t}(BoldBIDashboard||(BoldBIDashboard={}));
