!function(t){"use strict";var e=function(){this.minw=40,this.minh=40,this.maxw=0,this.maxh=0,this.core=null};t.extend(e.prototype,{tag:"backoff",priority:22,filter:function(t){var e=this.bound;return t.x<e.minx&&(t.x=e.minx,t.x2=t.w+t.x),t.y<e.miny&&(t.y=e.miny,t.y2=t.h+t.y),t.x2>e.maxx&&(t.x2=e.maxx,t.x=t.x2-t.w),t.y2>e.maxy&&(t.y2=e.maxy,t.y=t.y2-t.h),t},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.bound={minx:0+t.edge.w,miny:0+t.edge.n,maxx:this.elw+t.edge.e,maxy:this.elh+t.edge.s}}});var i=function(){this.core=null};t.extend(i.prototype,{tag:"constrain",priority:5,filter:function(t,e){return"move"==e?(t.x<this.minx&&(t.x=this.minx,t.x2=t.w+t.x),t.y<this.miny&&(t.y=this.miny,t.y2=t.h+t.y),t.x2>this.maxx&&(t.x2=this.maxx,t.x=t.x2-t.w),t.y2>this.maxy&&(t.y2=this.maxy,t.y=t.y2-t.h)):(t.x<this.minx&&(t.x=this.minx),t.y<this.miny&&(t.y=this.miny),t.x2>this.maxx&&(t.x2=this.maxx),t.y2>this.maxy&&(t.y2=this.maxy)),t.w=t.x2-t.x,t.h=t.y2-t.y,t},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.minx=0+t.edge.w,this.miny=0+t.edge.n,this.maxx=this.elw+t.edge.e,this.maxy=this.elh+t.edge.s}});var r=function(){this.core=null};t.extend(r.prototype,{tag:"extent",priority:12,offsetFromCorner:function(t,e,i){var n=e[0],r=e[1];switch(t){case"bl":return[i.x2-n,i.y,n,r];case"tl":return[i.x2-n,i.y2-r,n,r];case"br":return[i.x,i.y,n,r];case"tr":return[i.x,i.y2-r,n,r]}},getQuadrant:function(t){var e=t.opposite[0]-t.offsetx,i=t.opposite[1]-t.offsety;return 0>e&&0>i?"br":e>=0&&i>=0?"tl":0>e&&i>=0?"tr":"bl"},filter:function(t,e,i){if("move"==e)return t;var n=t.w,r=t.h,o=i.state,s=this.limits,a=o?this.getQuadrant(o):"br";return s.minw&&n<s.minw&&(n=s.minw),s.minh&&r<s.minh&&(r=s.minh),s.maxw&&n>s.maxw&&(n=s.maxw),s.maxh&&r>s.maxh&&(r=s.maxh),n==t.w&&r==t.h?t:y.wrapFromXywh(this.offsetFromCorner(a,[n,r],t))},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.limits={minw:t.minSize[0],minh:t.minSize[1],maxw:t.maxSize[0],maxh:t.maxSize[1]}}});var o=function(){this.stepx=1,this.stepy=1,this.core=null};t.extend(o.prototype,{tag:"grid",priority:19,filter:function(t){var e={x:Math.round(t.x/this.stepx)*this.stepx,y:Math.round(t.y/this.stepy)*this.stepy,x2:Math.round(t.x2/this.stepx)*this.stepx,y2:Math.round(t.y2/this.stepy)*this.stepy};return e.w=e.x2-e.x,e.h=e.y2-e.y,e}});var s=function(){this.ratio=0,this.core=null};t.extend(s.prototype,{tag:"ratio",priority:15,offsetFromCorner:function(t,e,i){var n=e[0],r=e[1];switch(t){case"bl":return[i.x2-n,i.y,n,r];case"tl":return[i.x2-n,i.y2-r,n,r];case"br":return[i.x,i.y,n,r];case"tr":return[i.x,i.y2-r,n,r]}},getBoundRatio:function(t,e){var i=y.getLargestBox(this.ratio,t.w,t.h);return y.wrapFromXywh(this.offsetFromCorner(e,i,t))},getQuadrant:function(t){var e=t.opposite[0]-t.offsetx,i=t.opposite[1]-t.offsety;return 0>e&&0>i?"br":e>=0&&i>=0?"tl":0>e&&i>=0?"tr":"bl"},filter:function(t,e,i){if(!this.ratio)return t;var n=(t.w/t.h,i.state),r=n?this.getQuadrant(n):"br";if(e=e||"se","move"==e)return t;switch(e){case"n":t.x2=this.elw,t.w=t.x2-t.x,r="tr";break;case"s":t.x2=this.elw,t.w=t.x2-t.x,r="br";break;case"e":t.y2=this.elh,t.h=t.y2-t.y,r="br";break;case"w":t.y2=this.elh,t.h=t.y2-t.y,r="bl"}return this.getBoundRatio(t,r)},refresh:function(t){this.ratio=t.aspectRatio,this.elw=t.core.container.width(),this.elh=t.core.container.height()}});var a=function(){this.core=null};t.extend(a.prototype,{tag:"round",priority:90,filter:function(t){var e={x:Math.round(t.x),y:Math.round(t.y),x2:Math.round(t.x2),y2:Math.round(t.y2)};return e.w=e.x2-e.x,e.h=e.y2-e.y,e}});var c=function(t,e){this.color=e||"black",this.opacity=t||.5,this.core=null,this.shades={}};t.extend(c.prototype,{tag:"shader",fade:!0,fadeEasing:"swing",fadeSpeed:320,priority:95,init:function(){var e=this;e.attached||(e.visible=!1,e.container=t("<div />").addClass(e.core.opt.css_shades).prependTo(this.core.container).hide(),e.elh=this.core.container.height(),e.elw=this.core.container.width(),e.shades={top:e.createShade(),right:e.createShade(),left:e.createShade(),bottom:e.createShade()},e.attached=!0)},destroy:function(){this.container.remove()},setColor:function(e,i){var n=this;if(e==n.color)return n;this.color=e;var r=y.supportsColorFade();return t.each(n.shades,function(t,o){n.fade&&!i&&r?o.animate({backgroundColor:e},{queue:!1,duration:n.fadeSpeed,easing:n.fadeEasing}):o.css("backgroundColor",e)}),n},setOpacity:function(e,i){var n=this;return e==n.opacity?n:(n.opacity=e,t.each(n.shades,function(t,r){!n.fade||i?r.css({opacity:e}):r.animate({opacity:e},{queue:!1,duration:n.fadeSpeed,easing:n.fadeEasing})}),n)},createShade:function(){return t("<div />").css({position:"absolute",backgroundColor:this.color,opacity:this.opacity}).appendTo(this.container)},refresh:function(t){var e=this.core,i=this.shades;this.setColor(t.bgColor?t.bgColor:this.core.opt.bgColor),this.setOpacity(t.bgOpacity?t.bgOpacity:this.core.opt.bgOpacity),this.elh=e.container.height(),this.elw=e.container.width(),i.right.css("height",this.elh+"px"),i.left.css("height",this.elh+"px")},filter:function(t,e,i){if(!i.active)return t;var n=this,r=n.shades;return r.top.css({left:Math.round(t.x)+"px",width:Math.round(t.w)+"px",height:Math.round(t.y)+"px"}),r.bottom.css({top:Math.round(t.y2)+"px",left:Math.round(t.x)+"px",width:Math.round(t.w)+"px",height:n.elh-Math.round(t.y2)+"px"}),r.right.css({left:Math.round(t.x2)+"px",width:n.elw-Math.round(t.x2)+"px"}),r.left.css({width:Math.round(t.x)+"px"}),n.visible||(n.container.show(),n.visible=!0),t}});var h=function(t){this.selection=t,this.core=t.core};t.extend(h.prototype,{getElement:function(){var e=this.selection.get();return t("<div />").css({position:"absolute",top:e.y+"px",left:e.x+"px",width:e.w+"px",height:e.h+"px"})},animate:function(t,e,i,n,r){var o=this;o.selection.allowResize(!1),o.getElement().animate({top:e+"px",left:t+"px",width:i+"px",height:n+"px"},{easing:o.core.opt.animEasing,duration:o.core.opt.animDuration,complete:function(){o.selection.allowResize(!0),r&&r.call(this)},progress:function(t){var e,i={},n=t.tweens;for(e=0;e<n.length;e++)i[n[e].prop]=n[e].now;var r={x:parseInt(i.left),y:parseInt(i.top),w:parseInt(i.width),h:parseInt(i.height)};r.x2=r.x+r.w,r.y2=r.y+r.h,o.selection.updateRaw(r,"se")}})}});var u=function(t,e,i){var n=this;n.x=t.pageX,n.y=t.pageY,n.selection=e,n.eventTarget=e.core.opt.dragEventTarget,n.orig=e.get(),e.callFilterFunction("refresh");var r=e.core.container.position();n.elx=r.left,n.ely=r.top,n.offsetx=0,n.offsety=0,n.ord=i,n.opposite=n.getOppositeCornerOffset(),n.initEvents(t)};t.extend(u.prototype,{getOppositeCornerOffset:function(){var t=this.orig,e=this.x-this.elx-t.x,i=this.y-this.ely-t.y;switch(this.ord){case"nw":case"w":return[t.w-e,t.h-i];case"sw":return[t.w-e,-i];case"se":case"s":case"e":return[-e,-i];case"ne":case"n":return[-e,t.h-i]}return[null,null]},initEvents:function(){t(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())},dragEvent:function(t){this.offsetx=t.pageX-this.x,this.offsety=t.pageY-this.y,this.selection.updateRaw(this.getBox(),this.ord)},endDragEvent:function(){var t=this.selection;t.element.trigger("cropend",[t,t.core.unscale(t.get())])},createStopHandler:function(){var e=this;return function(i){return t(e.eventTarget).off(".jcrop"),e.endDragEvent(i),!1}},createDragHandler:function(){var t=this;return function(e){return t.dragEvent(e),!1}},update:function(t,e){var i=this;i.offsetx=t-i.x,i.offsety=e-i.y},resultWrap:function(t){var e={x:Math.min(t[0],t[2]),y:Math.min(t[1],t[3]),x2:Math.max(t[0],t[2]),y2:Math.max(t[1],t[3])};return e.w=e.x2-e.x,e.h=e.y2-e.y,e},getBox:function(){var t=this,e=t.orig,i={x2:e.x+e.w,y2:e.y+e.h};switch(t.ord){case"n":return t.resultWrap([e.x,t.offsety+e.y,i.x2,i.y2]);case"s":return t.resultWrap([e.x,e.y,i.x2,t.offsety+i.y2]);case"e":return t.resultWrap([e.x,e.y,t.offsetx+i.x2,i.y2]);case"w":return t.resultWrap([e.x+t.offsetx,e.y,i.x2,i.y2]);case"sw":return t.resultWrap([t.offsetx+e.x,e.y,i.x2,t.offsety+i.y2]);case"se":return t.resultWrap([e.x,e.y,t.offsetx+i.x2,t.offsety+i.y2]);case"ne":return t.resultWrap([e.x,t.offsety+e.y,t.offsetx+i.x2,i.y2]);case"nw":return t.resultWrap([t.offsetx+e.x,t.offsety+e.y,i.x2,i.y2]);case"move":return i.nx=e.x+t.offsetx,i.ny=e.y+t.offsety,t.resultWrap([i.nx,i.ny,i.nx+e.w,i.ny+e.h])}}});var l=function(t){this.core=t};t.extend(l,{prototype:{on:function(e,i){t(this).on(e,i)},off:function(e){t(this).off(e)},trigger:function(e){t(this).trigger(e)}}});var p=function(t,e,i){this.src=t,e||(e=new Image),this.element=e,this.callback=i,this.load()};t.extend(p,{attach:function(t,e){return new p(t.src,t,e)},prototype:{getDimensions:function(){var t=this.element;return t.naturalWidth?[t.naturalWidth,t.naturalHeight]:t.width?[t.width,t.height]:null},fireCallback:function(){this.element.onload=null,"function"==typeof this.callback&&this.callback.apply(this,this.getDimensions())},isLoaded:function(){return this.element.complete},load:function(){var t=this,e=t.element;e.src=t.src,t.isLoaded()?t.fireCallback():t.element.onload=function(){t.fireCallback()}}}});var f=function(t){this.core=t,this.init()};t.extend(f,{support:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:void 0},prototype:{init:function(){var e=this,i=t.Jcrop.component.DragState.prototype;i.touch||(e.initEvents(),e.shimDragState(),e.shimStageDrag(),i.touch=!0)},shimDragState:function(){var e=this;t.Jcrop.component.DragState.prototype.initEvents=function(i){"touch"==i.type.substr(0,5)?t(this.eventTarget).on("touchmove.jcrop.jcrop-touch",e.dragWrap(this.createDragHandler())).on("touchend.jcrop.jcrop-touch",this.createStopHandler()):t(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())}},shimStageDrag:function(){this.core.container.addClass("jcrop-touch").on("touchstart.jcrop.jcrop-stage",this.dragWrap(this.core.ui.stage.startDragHandler()))},dragWrap:function(t){return function(e){return e.preventDefault(),e.stopPropagation(),"touch"==e.type.substr(0,5)?(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,t(e)):!1}},initEvents:function(){var t=this,e=t.core;e.container.on("touchstart.jcrop.jcrop-touch","."+e.opt.css_drag,t.dragWrap(e.startDrag()))}}});var d=function(t){this.core=t,this.init()};t.extend(d,{defaults:{eventName:"keydown.jcrop",passthru:[9],debug:!1},prototype:{init:function(){t.extend(this,d.defaults),this.enable()},disable:function(){this.core.container.off(this.eventName)},enable:function(){var e=this,i=e.core;i.container.on(e.eventName,function(n){var r=n.shiftKey?16:2;if(t.inArray(n.keyCode,e.passthru)>=0)return!0;switch(n.keyCode){case 37:i.nudge(-r,0);break;case 38:i.nudge(0,-r);break;case 39:i.nudge(r,0);break;case 40:i.nudge(0,r);break;case 46:case 8:return i.requestDelete(),!1;default:e.debug&&console.log("keycode: "+n.keyCode)}n.metaKey||n.ctrlKey||n.preventDefault()})}}});var g=function(){};t.extend(g,{defaults:{minSize:[8,8],maxSize:[0,0],aspectRatio:0,edge:{n:0,s:0,e:0,w:0},bgColor:null,bgOpacity:null,last:null,state:null,active:!0,linked:!0,canDelete:!0,canDrag:!0,canResize:!0,canSelect:!0},prototype:{init:function(t){this.core=t,this.startup(),this.linked=this.core.opt.linked,this.attach(),this.setOptions(this.core.opt),t.container.trigger("cropcreate",[this])},attach:function(){},startup:function(){var e=this,i=e.core.opt;t.extend(e,g.defaults),e.filter=e.core.getDefaultFilters(),e.element=t("<div />").addClass(i.css_selection).data({selection:e}),e.frame=t("<button />").addClass(i.css_button).data("ord","move"),e.element.append(e.frame).appendTo(e.core.container),e.core.opt.is_msie&&e.frame.css({opacity:0,backgroundColor:"white"}),e.insertElements(),e.frame.on("focus.jcrop",function(){e.element.trigger("cropfocus",e),e.core.setSelection(e),e.element.addClass("jcrop-focus")}).on("blur.jcrop",function(){e.element.removeClass("jcrop-focus"),e.element.trigger("cropblur",e)})},propagate:["canDelete","canDrag","canResize","canSelect","minSize","maxSize","aspectRatio","edge"],setOptions:function(t){return y.propagate(this.propagate,t,this),this.refresh(),this},refresh:function(){this.allowResize(),this.allowDrag(),this.allowSelect(),this.callFilterFunction("refresh"),this.updateRaw(this.get(),"se")},callFilterFunction:function(t){for(var e=0;e<this.filter.length;e++)this.filter[e][t]&&this.filter[e][t](this);return this},addFilter:function(t){t.core=this.core,this.hasFilter(t)||(this.filter.push(t),this.sortFilters(),t.init&&t.init(),this.refresh())},hasFilter:function(t){var e,i=this.filter;for(e=0;e<i.length;e++)if(i[e]===t)return!0},sortFilters:function(){this.filter.sort(function(t,e){return t.priority-e.priority})},clearFilters:function(){for(var t,e=this.filter,t=0;t<e.length;t++)e[t].destroy&&e[t].destroy();this.filter=[]},removeFilter:function(t){for(var e,i=this.filter,n=[],e=0;e<i.length;e++)i[e].tag&&i[e].tag==t||t===i[e]?i[e].destroy&&i[e].destroy():n.push(i[e]);this.filter=n},runFilters:function(t,e){for(var i=0;i<this.filter.length;i++)t=this.filter[i].filter(t,e,this);return t},endDrag:function(){this.state&&(t(document.body).off(".jcrop"),this.focus(),this.state=null)},startDrag:function(e,i){{var n=this;n.core}return i=i||t(e.target).data("ord"),this.focus(),"move"==i&&n.element.hasClass(n.core.opt.css_nodrag)?!1:(this.state=new y.component.DragState(e,this,i),!1)},allowSelect:function(t){return void 0===t&&(t=this.canSelect),t&&this.canSelect?this.frame.attr("disabled",!1):this.frame.attr("disabled","disabled"),this},allowDrag:function(t){var e=this,i=e.core.opt;return void 0==t&&(t=e.canDrag),t&&e.canDrag?e.element.removeClass(i.css_nodrag):e.element.addClass(i.css_nodrag),this},allowResize:function(t){var e=this,i=e.core.opt;return void 0==t&&(t=e.canResize),t&&e.canResize?e.element.removeClass(i.css_noresize):e.element.addClass(i.css_noresize),this},remove:function(){this.element.trigger("cropremove",this),this.element.remove()},toBack:function(){this.active=!1,this.element.removeClass("jcrop-current").removeClass("jcrop-focus").css({zIndex:20})},toFront:function(){this.active=!0,this.element.addClass("jcrop-current").css({zIndex:30}),this.callFilterFunction("refresh"),this.refresh()},redraw:function(t){return this.moveTo(t.x,t.y),this.resize(t.w,t.h),this.last=t,this},update:function(t,e){return this.updateRaw(this.core.scale(t),e)},updateRaw:function(t,e){return t=this.runFilters(t,e),this.redraw(t),this.element.trigger("cropmove",[this,this.core.unscale(t)]),this},animateTo:function(t,e){var i=new y.component.Animator(this),n=this.core.scale(y.wrapFromXywh(t));i.animate(n.x,n.y,n.w,n.h,e)},center:function(t){var e=this.get(),i=this.core,n=i.container.width(),r=i.container.height(),o=[(n-e.w)/2,(r-e.h)/2,e.w,e.h];return this[t?"setSelect":"animateTo"](o)},createElement:function(e,i){return t("<div />").addClass(e+" ord-"+i).data("ord",i)},moveTo:function(t,e){this.element.css({top:e+"px",left:t+"px"})},blur:function(){return this.element.blur(),this},focus:function(){return this.core.setSelection(this),this.frame.focus(),this},resize:function(t,e){this.element.css({width:t+"px",height:e+"px"})},get:function(){var t=this.element,e=t.position(),i=t.width(),n=t.height(),r={x:e.left,y:e.top};return r.x2=r.x+i,r.y2=r.y+n,r.w=i,r.h=n,r},insertElements:function(){var t,e=this,i=(e.core,e.element),n=e.core.opt,r=n.borders,o=n.handles,s=n.dragbars;for(t=0;t<r.length;t++)i.append(e.createElement(n.css_borders,r[t]));for(t=0;t<s.length;t++)i.append(e.createElement(n.css_dragbars,s[t]));for(t=0;t<o.length;t++)i.append(e.createElement(n.css_handles,o[t]))}}});var m=function(e,i){t.extend(this,m.defaults,i||{}),this.manager=e,this.core=e.core};m.defaults={offset:[-8,-8],active:!0,minsize:[20,20]},t.extend(m.prototype,{start:function(e){var i=this.core;if(!i.opt.allowSelect)return!1;if(i.opt.multi&&i.opt.multiMax&&i.ui.multi.length>=i.opt.multiMax)return!1;var n=t(e.currentTarget).offset(),r=e.pageX-n.left+this.offset[0],o=e.pageY-n.top+this.offset[1],s=i.ui.multi;if(!i.opt.multi)if(i.opt.multiCleanup){for(var a=0;a<s.length;a++)s[a].remove();i.ui.multi=[]}else i.removeSelection(i.ui.selection);var c=i.newSelection().updateRaw(y.wrapFromXywh([r,o,1,1]));return c.element.trigger("cropstart",[c,this.core.unscale(c.get())]),c.startDrag(e,"se")},end:function(t,e){this.drag(t,e);var i=this.sel.get();i.w<this.minsize[0]||i.h<this.minsize[1]?this.core.requestDelete():this.sel.focus()}});var x=function(t){this.core=t,this.ui=t.ui,this.init()};t.extend(x.prototype,{init:function(){this.setupEvents(),this.dragger=new m(this)},tellConfigUpdate:function(t){for(var e=0,i=this.ui.multi,n=i.length;n>e;e++)i[e].setOptions&&(i[e].linked||this.core.opt.linkCurrent&&i[e]==this.ui.selection)&&i[e].setOptions(t)},startDragHandler:function(){var t=this;return function(e){return!e.button||t.core.opt.is_ie_lt9?t.dragger.start(e):void 0}},removeEvents:function(){this.core.event.off(".jcrop-stage"),this.core.container.off(".jcrop-stage")},shimLegacyHandlers:function(e){var i,n=this.core;t.each(n.opt.legacyHandlers,function(t,r){t in e&&(i=e[t],n.container.off(".jcrop-"+t).on(r+".jcrop.jcrop-"+t,function(t,e,r){i.call(n,r)}),delete e[t])})},setupEvents:function(){var t=this,e=t.core;e.event.on("configupdate.jcrop-stage",function(){t.shimLegacyHandlers(e.opt),t.tellConfigUpdate(e.opt),e.container.trigger("cropconfig",[e,e.opt])}),this.core.container.on("mousedown.jcrop.jcrop-stage",this.startDragHandler())}});var y=function(e,i){var n=navigator.userAgent.toLowerCase();this.opt=t.extend({},y.defaults,i||{}),this.container=t(e),this.opt.is_msie=/msie/.test(n),this.opt.is_ie_lt9=/msie [1-8]\./.test(n),this.container.addClass(this.opt.css_container),this.ui={},this.state=null,this.ui.multi=[],this.ui.selection=null,this.filter={},this.init(),this.setOptions(i),this.applySizeConstraints(),this.container.trigger("cropinit",this),this.opt.is_ie_lt9&&(this.opt.dragEventTarget=document.body)};y.component={Animator:h,DragState:u,EventManager:l,ImageLoader:p,StageManager:x,Selection:g,Keyboard:d,Touch:f},t.extend(y,{defaults:{edge:{n:0,s:0,e:0,w:0},setSelect:null,linked:!0,linkCurrent:!0,canDelete:!0,canSelect:!0,canDrag:!0,canResize:!0,eventManagerComponent:y.component.EventManager,keyboardComponent:y.component.Keyboard,dragstateComponent:y.component.DragState,stagemanagerComponent:y.component.StageManager,animatorComponent:y.component.Animator,selectionComponent:y.component.Selection,allowSelect:!0,multi:!1,multiMax:!1,multiCleanup:!0,animation:!0,animEasing:"swing",animDuration:400,fading:!0,fadeDuration:300,fadeEasing:"swing",bgColor:"black",bgOpacity:.5,applyFilters:["constrain","extent","backoff","ratio","shader","round"],borders:["n","s","e","w"],handles:["n","s","e","w","sw","ne","nw","se"],dragbars:["n","e","w","s"],dragEventTarget:window,xscale:1,yscale:1,boxWidth:null,boxHeight:null,css_nodrag:"jcrop-nodrag",css_drag:"jcrop-drag",css_container:"jcrop-active",css_shades:"jcrop-shades",css_selection:"jcrop-selection",css_borders:"jcrop-border",css_handles:"jcrop-handle jcrop-drag",css_button:"jcrop-box jcrop-drag",css_noresize:"jcrop-noresize",css_dragbars:"jcrop-dragbar jcrop-drag",legacyHandlers:{onChange:"cropmove",onSelect:"cropend"}},filter:{constrain:i,extent:r,grid:o,backoff:e,shader:c,ratio:s,round:a},attach:function(e,i){var n=new t.Jcrop(e,i);return n},supportsCanvas:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},imgCopy:function(t){var e=new Image;return e.src=t.src,e},imageClone:function(t){return y.supportsCanvas()?y.canvasClone(t):y.imgCopy(t)},canvasClone:function(e){var i=document.createElement("canvas"),n=t(i).width(e.width).height(e.height),r=i.getContext("2d");return i.width=e.naturalWidth,i.height=e.naturalHeight,r.drawImage(e,0,0,e.naturalWidth,e.naturalHeight),n},propagate:function(t,e,i){for(var n=0,r=t.length;r>n;n++)e.hasOwnProperty(t[n])&&(i[t[n]]=e[t[n]])},getLargestBox:function(t,e,i){return e/i>t?[i*t,i]:[e,e/t]},supportsColorFade:function(){return t.fx.step.hasOwnProperty("backgroundColor")},wrapFromXywh:function(t){var e={x:t[0],y:t[1],w:t[2],h:t[3]};return e.x2=e.x+e.w,e.y2=e.y+e.h,e}}),t.extend(y.prototype,{init:function(){this.event=new this.opt.eventManagerComponent(this),this.ui.keyboard=new this.opt.keyboardComponent(this),this.ui.stage=new this.opt.stagemanagerComponent(this),this.applyFilters(),t.Jcrop.component.Touch.support()&&new t.Jcrop.component.Touch(this),this.initEvents()},applySizeConstraints:function(){var e=this.opt,i=this.opt.imgTarget;if(i){var n=i.naturalWidth||i.width,r=i.naturalHeight||i.height,o=e.boxWidth||n,s=e.boxHeight||r;if(i&&(n>o||r>s)){var a=y.getLargestBox(n/r,o,s);t(i).width(a[0]).height(a[1]),this.resizeContainer(a[0],a[1]),this.opt.xscale=n/a[0],this.opt.yscale=r/a[1]}}},setOptions:function(e){return t.isPlainObject(e)||(e={}),t.extend(this.opt,e),this.opt.setSelect&&(this.ui.multi.length||this.newSelection(),this.ui.multi[0].update(y.wrapFromXywh(this.opt.setSelect)),this.opt.setSelect=null),this.event.trigger("configupdate"),this},destroy:function(){this.opt.imgTarget?(this.container.before(this.opt.imgTarget),this.container.remove(),t(this.opt.imgTarget).removeData("Jcrop")):this.container.remove()},applyFilters:function(){for(var e,i=0,n=this.opt.applyFilters,r=n.length;r>i;i++)t.Jcrop.filter[n[i]]&&(e=new t.Jcrop.filter[n[i]]),e.core=this,e.init&&e.init(),this.filter[n[i]]=e},getDefaultFilters:function(){for(var t=[],e=0,i=this.opt.applyFilters,n=i.length;n>e;e++)this.filter.hasOwnProperty(i[e])&&t.push(this.filter[i[e]]);return t.sort(function(t,e){return t.priority-e.priority}),t},setSelection:function(t){for(var e=this.ui.multi,i=[],n=0;n<e.length;n++)e[n]!==t&&i.push(e[n]),e[n].toBack();return i.unshift(t),this.ui.multi=i,this.ui.selection=t,t.toFront(),t},getSelection:function(){var t=this.ui.selection.get();return t},newSelection:function(t){return t||(t=new this.opt.selectionComponent),t.init(this),this.setSelection(t),t},hasSelection:function(t){for(var e=0;e<this.ui.multi;e++)if(t===this.ui.multi[e])return!0},removeSelection:function(t){for(var e,i=[],n=this.ui.multi,e=0;e<n.length;e++)t!==n[e]?i.push(n[e]):n[e].remove();return this.ui.multi=i},addFilter:function(t){for(var e=0,i=this.ui.multi,n=i.length;n>e;e++)i[e].addFilter(t);return this},removeFilter:function(t){for(var e=0,i=this.ui.multi,n=i.length;n>e;e++)i[e].removeFilter(t);return this},blur:function(){return this.ui.selection.blur(),this},focus:function(){return this.ui.selection.focus(),this},initEvents:function(){var t=this;t.container.on("selectstart",function(){return!1}).on("mousedown","."+t.opt.css_drag,t.startDrag())},maxSelect:function(){this.setSelect([0,0,this.elw,this.elh])},nudge:function(t,e){var i=this.ui.selection,n=i.get();n.x+=t,n.x2+=t,n.y+=e,n.y2+=e,n.x<0?(n.x2=n.w,n.x=0):n.x2>this.elw&&(n.x2=this.elw,n.x=n.x2-n.w),n.y<0?(n.y2=n.h,n.y=0):n.y2>this.elh&&(n.y2=this.elh,n.y=n.y2-n.h),i.element.trigger("cropstart",[i,this.unscale(n)]),i.updateRaw(n,"move"),i.element.trigger("cropend",[i,this.unscale(n)])},refresh:function(){for(var t=0,e=this.ui.multi,i=e.length;i>t;t++)e[t].refresh()},blurAll:function(){for(var t=this.ui.multi,e=0;e<t.length;e++)t[e]!==sel&&n.push(t[e]),t[e].toBack()},scale:function(t){var e=this.opt.xscale,i=this.opt.yscale;return{x:t.x/e,y:t.y/i,x2:t.x2/e,y2:t.y2/i,w:t.w/e,h:t.h/i}},unscale:function(t){var e=this.opt.xscale,i=this.opt.yscale;return{x:t.x*e,y:t.y*i,x2:t.x2*e,y2:t.y2*i,w:t.w*e,h:t.h*i}},requestDelete:function(){return this.ui.multi.length>1&&this.ui.selection.canDelete?this.deleteSelection():void 0},deleteSelection:function(){this.ui.selection&&(this.removeSelection(this.ui.selection),this.ui.multi[0].focus(),this.ui.selection.refresh())},animateTo:function(t){return this.ui.selection&&this.ui.selection.animateTo(t),this},setSelect:function(t){return this.ui.selection&&this.ui.selection.update(y.wrapFromXywh(t)),this},startDrag:function(){var e=this;return function(i){var n=t(i.target),r=n.closest("."+e.opt.css_selection).data("selection"),o=n.data("ord");return e.container.trigger("cropstart",[r,e.unscale(r.get())]),r.startDrag(i,o),!1}},resizeContainer:function(t,e){this.container.width(t).height(e),this.refresh()},setImage:function(e,i){var n=this,r=n.opt.imgTarget;return r?void new t.Jcrop.component.ImageLoader(e,null,function(o,s){n.resizeContainer(o,s),r.src=e,t(r).width(o).height(s),n.applySizeConstraints(),n.refresh(),n.container.trigger("cropimage",[n,r]),"function"==typeof i&&i.call(n,o,s)}):!1},update:function(t){this.ui.selection&&this.ui.selection.update(t)}}),t.fn.Jcrop=function(e,i){var n=this.eq(0).data("Jcrop"),r=Array.prototype.slice.call(arguments);return"api"==e?n:n&&"string"==typeof e?n[e]?(r.shift(),n[e].apply(n,r),n):!1:void this.each(function(){var n,r=this,o=t(this),s=o.data("Jcrop");return s?s.setOptions(e):"IMG"==this.tagName?t.Jcrop.component.ImageLoader.attach(this,function(s,a){var c=o.wrap("<div />").parent();c.width(s).height(a),n=t.Jcrop.attach(c,t.extend({},e,{imgTarget:r})),o.data("Jcrop",n),"function"==typeof i&&i.call(n)}):(n=t.Jcrop.attach(this,e),o.data("Jcrop",n),"function"==typeof i&&i.call(n)),this})},t.Jcrop=y}(jQuery);